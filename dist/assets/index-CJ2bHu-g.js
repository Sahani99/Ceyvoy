function P$(e,t){for(var r=0;r<t.length;r++){const o=t[r];if(typeof o!="string"&&!Array.isArray(o)){for(const u in o)if(u!=="default"&&!(u in e)){const m=Object.getOwnPropertyDescriptor(o,u);m&&Object.defineProperty(e,u,m.get?m:{enumerable:!0,get:()=>o[u]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))o(u);new MutationObserver(u=>{for(const m of u)if(m.type==="childList")for(const _ of m.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&o(_)}).observe(document,{childList:!0,subtree:!0});function r(u){const m={};return u.integrity&&(m.integrity=u.integrity),u.referrerPolicy&&(m.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?m.credentials="include":u.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function o(u){if(u.ep)return;u.ep=!0;const m=r(u);fetch(u.href,m)}})();var M$=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Y1(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var x4={exports:{}},K1={},v4={exports:{}},ur={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z_=Symbol.for("react.element"),A$=Symbol.for("react.portal"),I$=Symbol.for("react.fragment"),D$=Symbol.for("react.strict_mode"),R$=Symbol.for("react.profiler"),k$=Symbol.for("react.provider"),N$=Symbol.for("react.context"),L$=Symbol.for("react.forward_ref"),O$=Symbol.for("react.suspense"),j$=Symbol.for("react.memo"),z$=Symbol.for("react.lazy"),ok=Symbol.iterator;function F$(e){return e===null||typeof e!="object"?null:(e=ok&&e[ok]||e["@@iterator"],typeof e=="function"?e:null)}var b4={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w4=Object.assign,S4={};function um(e,t,r){this.props=e,this.context=t,this.refs=S4,this.updater=r||b4}um.prototype.isReactComponent={};um.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};um.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function T4(){}T4.prototype=um.prototype;function oP(e,t,r){this.props=e,this.context=t,this.refs=S4,this.updater=r||b4}var aP=oP.prototype=new T4;aP.constructor=oP;w4(aP,um.prototype);aP.isPureReactComponent=!0;var ak=Array.isArray,E4=Object.prototype.hasOwnProperty,lP={current:null},C4={key:!0,ref:!0,__self:!0,__source:!0};function P4(e,t,r){var o,u={},m=null,_=null;if(t!=null)for(o in t.ref!==void 0&&(_=t.ref),t.key!==void 0&&(m=""+t.key),t)E4.call(t,o)&&!C4.hasOwnProperty(o)&&(u[o]=t[o]);var b=arguments.length-2;if(b===1)u.children=r;else if(1<b){for(var s=Array(b),k=0;k<b;k++)s[k]=arguments[k+2];u.children=s}if(e&&e.defaultProps)for(o in b=e.defaultProps,b)u[o]===void 0&&(u[o]=b[o]);return{$$typeof:z_,type:e,key:m,ref:_,props:u,_owner:lP.current}}function B$(e,t){return{$$typeof:z_,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function cP(e){return typeof e=="object"&&e!==null&&e.$$typeof===z_}function V$(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var lk=/\/+/g;function GS(e,t){return typeof e=="object"&&e!==null&&e.key!=null?V$(""+e.key):t.toString(36)}function Iv(e,t,r,o,u){var m=typeof e;(m==="undefined"||m==="boolean")&&(e=null);var _=!1;if(e===null)_=!0;else switch(m){case"string":case"number":_=!0;break;case"object":switch(e.$$typeof){case z_:case A$:_=!0}}if(_)return _=e,u=u(_),e=o===""?"."+GS(_,0):o,ak(u)?(r="",e!=null&&(r=e.replace(lk,"$&/")+"/"),Iv(u,t,r,"",function(k){return k})):u!=null&&(cP(u)&&(u=B$(u,r+(!u.key||_&&_.key===u.key?"":(""+u.key).replace(lk,"$&/")+"/")+e)),t.push(u)),1;if(_=0,o=o===""?".":o+":",ak(e))for(var b=0;b<e.length;b++){m=e[b];var s=o+GS(m,b);_+=Iv(m,t,r,s,u)}else if(s=F$(e),typeof s=="function")for(e=s.call(e),b=0;!(m=e.next()).done;)m=m.value,s=o+GS(m,b++),_+=Iv(m,t,r,s,u);else if(m==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return _}function Z0(e,t,r){if(e==null)return e;var o=[],u=0;return Iv(e,o,"","",function(m){return t.call(r,m,u++)}),o}function U$(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var zs={current:null},Dv={transition:null},$$={ReactCurrentDispatcher:zs,ReactCurrentBatchConfig:Dv,ReactCurrentOwner:lP};function M4(){throw Error("act(...) is not supported in production builds of React.")}ur.Children={map:Z0,forEach:function(e,t,r){Z0(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return Z0(e,function(){t++}),t},toArray:function(e){return Z0(e,function(t){return t})||[]},only:function(e){if(!cP(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};ur.Component=um;ur.Fragment=I$;ur.Profiler=R$;ur.PureComponent=oP;ur.StrictMode=D$;ur.Suspense=O$;ur.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$$;ur.act=M4;ur.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=w4({},e.props),u=e.key,m=e.ref,_=e._owner;if(t!=null){if(t.ref!==void 0&&(m=t.ref,_=lP.current),t.key!==void 0&&(u=""+t.key),e.type&&e.type.defaultProps)var b=e.type.defaultProps;for(s in t)E4.call(t,s)&&!C4.hasOwnProperty(s)&&(o[s]=t[s]===void 0&&b!==void 0?b[s]:t[s])}var s=arguments.length-2;if(s===1)o.children=r;else if(1<s){b=Array(s);for(var k=0;k<s;k++)b[k]=arguments[k+2];o.children=b}return{$$typeof:z_,type:e.type,key:u,ref:m,props:o,_owner:_}};ur.createContext=function(e){return e={$$typeof:N$,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:k$,_context:e},e.Consumer=e};ur.createElement=P4;ur.createFactory=function(e){var t=P4.bind(null,e);return t.type=e,t};ur.createRef=function(){return{current:null}};ur.forwardRef=function(e){return{$$typeof:L$,render:e}};ur.isValidElement=cP;ur.lazy=function(e){return{$$typeof:z$,_payload:{_status:-1,_result:e},_init:U$}};ur.memo=function(e,t){return{$$typeof:j$,type:e,compare:t===void 0?null:t}};ur.startTransition=function(e){var t=Dv.transition;Dv.transition={};try{e()}finally{Dv.transition=t}};ur.unstable_act=M4;ur.useCallback=function(e,t){return zs.current.useCallback(e,t)};ur.useContext=function(e){return zs.current.useContext(e)};ur.useDebugValue=function(){};ur.useDeferredValue=function(e){return zs.current.useDeferredValue(e)};ur.useEffect=function(e,t){return zs.current.useEffect(e,t)};ur.useId=function(){return zs.current.useId()};ur.useImperativeHandle=function(e,t,r){return zs.current.useImperativeHandle(e,t,r)};ur.useInsertionEffect=function(e,t){return zs.current.useInsertionEffect(e,t)};ur.useLayoutEffect=function(e,t){return zs.current.useLayoutEffect(e,t)};ur.useMemo=function(e,t){return zs.current.useMemo(e,t)};ur.useReducer=function(e,t,r){return zs.current.useReducer(e,t,r)};ur.useRef=function(e){return zs.current.useRef(e)};ur.useState=function(e){return zs.current.useState(e)};ur.useSyncExternalStore=function(e,t,r){return zs.current.useSyncExternalStore(e,t,r)};ur.useTransition=function(){return zs.current.useTransition()};ur.version="18.3.1";v4.exports=ur;var W=v4.exports;const Gn=Y1(W),Jv=P$({__proto__:null,default:Gn},[W]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G$=W,W$=Symbol.for("react.element"),H$=Symbol.for("react.fragment"),q$=Object.prototype.hasOwnProperty,Z$=G$.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,X$={key:!0,ref:!0,__self:!0,__source:!0};function A4(e,t,r){var o,u={},m=null,_=null;r!==void 0&&(m=""+r),t.key!==void 0&&(m=""+t.key),t.ref!==void 0&&(_=t.ref);for(o in t)q$.call(t,o)&&!X$.hasOwnProperty(o)&&(u[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps,t)u[o]===void 0&&(u[o]=t[o]);return{$$typeof:W$,type:e,key:m,ref:_,props:u,_owner:Z$.current}}K1.Fragment=H$;K1.jsx=A4;K1.jsxs=A4;x4.exports=K1;var S=x4.exports,I4={exports:{}},Io={},D4={exports:{}},R4={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(tt,Ft){var St=tt.length;tt.push(Ft);e:for(;0<St;){var hn=St-1>>>1,Un=tt[hn];if(0<u(Un,Ft))tt[hn]=Ft,tt[St]=Un,St=hn;else break e}}function r(tt){return tt.length===0?null:tt[0]}function o(tt){if(tt.length===0)return null;var Ft=tt[0],St=tt.pop();if(St!==Ft){tt[0]=St;e:for(var hn=0,Un=tt.length,wr=Un>>>1;hn<wr;){var Ut=2*(hn+1)-1,Cr=tt[Ut],or=Ut+1,Qt=tt[or];if(0>u(Cr,St))or<Un&&0>u(Qt,Cr)?(tt[hn]=Qt,tt[or]=St,hn=or):(tt[hn]=Cr,tt[Ut]=St,hn=Ut);else if(or<Un&&0>u(Qt,St))tt[hn]=Qt,tt[or]=St,hn=or;else break e}}return Ft}function u(tt,Ft){var St=tt.sortIndex-Ft.sortIndex;return St!==0?St:tt.id-Ft.id}if(typeof performance=="object"&&typeof performance.now=="function"){var m=performance;e.unstable_now=function(){return m.now()}}else{var _=Date,b=_.now();e.unstable_now=function(){return _.now()-b}}var s=[],k=[],O=1,F=null,q=3,H=!1,J=!1,U=!1,te=typeof setTimeout=="function"?setTimeout:null,Q=typeof clearTimeout=="function"?clearTimeout:null,ee=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function re(tt){for(var Ft=r(k);Ft!==null;){if(Ft.callback===null)o(k);else if(Ft.startTime<=tt)o(k),Ft.sortIndex=Ft.expirationTime,t(s,Ft);else break;Ft=r(k)}}function xe(tt){if(U=!1,re(tt),!J)if(r(s)!==null)J=!0,It(Ee);else{var Ft=r(k);Ft!==null&&Et(xe,Ft.startTime-tt)}}function Ee(tt,Ft){J=!1,U&&(U=!1,Q(Ne),Ne=-1),H=!0;var St=q;try{for(re(Ft),F=r(s);F!==null&&(!(F.expirationTime>Ft)||tt&&!mt());){var hn=F.callback;if(typeof hn=="function"){F.callback=null,q=F.priorityLevel;var Un=hn(F.expirationTime<=Ft);Ft=e.unstable_now(),typeof Un=="function"?F.callback=Un:F===r(s)&&o(s),re(Ft)}else o(s);F=r(s)}if(F!==null)var wr=!0;else{var Ut=r(k);Ut!==null&&Et(xe,Ut.startTime-Ft),wr=!1}return wr}finally{F=null,q=St,H=!1}}var He=!1,qe=null,Ne=-1,ft=5,ut=-1;function mt(){return!(e.unstable_now()-ut<ft)}function pt(){if(qe!==null){var tt=e.unstable_now();ut=tt;var Ft=!0;try{Ft=qe(!0,tt)}finally{Ft?en():(He=!1,qe=null)}}else He=!1}var en;if(typeof ee=="function")en=function(){ee(pt)};else if(typeof MessageChannel<"u"){var Yt=new MessageChannel,dn=Yt.port2;Yt.port1.onmessage=pt,en=function(){dn.postMessage(null)}}else en=function(){te(pt,0)};function It(tt){qe=tt,He||(He=!0,en())}function Et(tt,Ft){Ne=te(function(){tt(e.unstable_now())},Ft)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(tt){tt.callback=null},e.unstable_continueExecution=function(){J||H||(J=!0,It(Ee))},e.unstable_forceFrameRate=function(tt){0>tt||125<tt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ft=0<tt?Math.floor(1e3/tt):5},e.unstable_getCurrentPriorityLevel=function(){return q},e.unstable_getFirstCallbackNode=function(){return r(s)},e.unstable_next=function(tt){switch(q){case 1:case 2:case 3:var Ft=3;break;default:Ft=q}var St=q;q=Ft;try{return tt()}finally{q=St}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(tt,Ft){switch(tt){case 1:case 2:case 3:case 4:case 5:break;default:tt=3}var St=q;q=tt;try{return Ft()}finally{q=St}},e.unstable_scheduleCallback=function(tt,Ft,St){var hn=e.unstable_now();switch(typeof St=="object"&&St!==null?(St=St.delay,St=typeof St=="number"&&0<St?hn+St:hn):St=hn,tt){case 1:var Un=-1;break;case 2:Un=250;break;case 5:Un=1073741823;break;case 4:Un=1e4;break;default:Un=5e3}return Un=St+Un,tt={id:O++,callback:Ft,priorityLevel:tt,startTime:St,expirationTime:Un,sortIndex:-1},St>hn?(tt.sortIndex=St,t(k,tt),r(s)===null&&tt===r(k)&&(U?(Q(Ne),Ne=-1):U=!0,Et(xe,St-hn))):(tt.sortIndex=Un,t(s,tt),J||H||(J=!0,It(Ee))),tt},e.unstable_shouldYield=mt,e.unstable_wrapCallback=function(tt){var Ft=q;return function(){var St=q;q=Ft;try{return tt.apply(this,arguments)}finally{q=St}}}})(R4);D4.exports=R4;var Y$=D4.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K$=W,Co=Y$;function Vt(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var k4=new Set,i_={};function Gh(e,t){Zp(e,t),Zp(e+"Capture",t)}function Zp(e,t){for(i_[e]=t,e=0;e<t.length;e++)k4.add(t[e])}var ic=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),dE=Object.prototype.hasOwnProperty,J$=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ck={},uk={};function Q$(e){return dE.call(uk,e)?!0:dE.call(ck,e)?!1:J$.test(e)?uk[e]=!0:(ck[e]=!0,!1)}function eG(e,t,r,o){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return o?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function tG(e,t,r,o){if(t===null||typeof t>"u"||eG(e,t,r,o))return!0;if(o)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Fs(e,t,r,o,u,m,_){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=o,this.attributeNamespace=u,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=m,this.removeEmptyString=_}var os={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){os[e]=new Fs(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];os[t]=new Fs(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){os[e]=new Fs(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){os[e]=new Fs(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){os[e]=new Fs(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){os[e]=new Fs(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){os[e]=new Fs(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){os[e]=new Fs(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){os[e]=new Fs(e,5,!1,e.toLowerCase(),null,!1,!1)});var uP=/[\-:]([a-z])/g;function dP(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(uP,dP);os[t]=new Fs(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(uP,dP);os[t]=new Fs(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(uP,dP);os[t]=new Fs(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){os[e]=new Fs(e,1,!1,e.toLowerCase(),null,!1,!1)});os.xlinkHref=new Fs("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){os[e]=new Fs(e,1,!1,e.toLowerCase(),null,!0,!0)});function hP(e,t,r,o){var u=os.hasOwnProperty(t)?os[t]:null;(u!==null?u.type!==0:o||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(tG(t,r,u,o)&&(r=null),o||u===null?Q$(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):u.mustUseProperty?e[u.propertyName]=r===null?u.type===3?!1:"":r:(t=u.attributeName,o=u.attributeNamespace,r===null?e.removeAttribute(t):(u=u.type,r=u===3||u===4&&r===!0?"":""+r,o?e.setAttributeNS(o,t,r):e.setAttribute(t,r))))}var mc=K$.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,X0=Symbol.for("react.element"),bp=Symbol.for("react.portal"),wp=Symbol.for("react.fragment"),fP=Symbol.for("react.strict_mode"),hE=Symbol.for("react.profiler"),N4=Symbol.for("react.provider"),L4=Symbol.for("react.context"),pP=Symbol.for("react.forward_ref"),fE=Symbol.for("react.suspense"),pE=Symbol.for("react.suspense_list"),mP=Symbol.for("react.memo"),Eu=Symbol.for("react.lazy"),O4=Symbol.for("react.offscreen"),dk=Symbol.iterator;function dy(e){return e===null||typeof e!="object"?null:(e=dk&&e[dk]||e["@@iterator"],typeof e=="function"?e:null)}var pi=Object.assign,WS;function Py(e){if(WS===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);WS=t&&t[1]||""}return`
`+WS+e}var HS=!1;function qS(e,t){if(!e||HS)return"";HS=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(k){var o=k}Reflect.construct(e,[],t)}else{try{t.call()}catch(k){o=k}e.call(t.prototype)}else{try{throw Error()}catch(k){o=k}e()}}catch(k){if(k&&o&&typeof k.stack=="string"){for(var u=k.stack.split(`
`),m=o.stack.split(`
`),_=u.length-1,b=m.length-1;1<=_&&0<=b&&u[_]!==m[b];)b--;for(;1<=_&&0<=b;_--,b--)if(u[_]!==m[b]){if(_!==1||b!==1)do if(_--,b--,0>b||u[_]!==m[b]){var s=`
`+u[_].replace(" at new "," at ");return e.displayName&&s.includes("<anonymous>")&&(s=s.replace("<anonymous>",e.displayName)),s}while(1<=_&&0<=b);break}}}finally{HS=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?Py(e):""}function nG(e){switch(e.tag){case 5:return Py(e.type);case 16:return Py("Lazy");case 13:return Py("Suspense");case 19:return Py("SuspenseList");case 0:case 2:case 15:return e=qS(e.type,!1),e;case 11:return e=qS(e.type.render,!1),e;case 1:return e=qS(e.type,!0),e;default:return""}}function mE(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case wp:return"Fragment";case bp:return"Portal";case hE:return"Profiler";case fP:return"StrictMode";case fE:return"Suspense";case pE:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case L4:return(e.displayName||"Context")+".Consumer";case N4:return(e._context.displayName||"Context")+".Provider";case pP:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case mP:return t=e.displayName||null,t!==null?t:mE(e.type)||"Memo";case Eu:t=e._payload,e=e._init;try{return mE(e(t))}catch{}}return null}function rG(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return mE(t);case 8:return t===fP?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Vu(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function j4(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function iG(e){var t=j4(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),o=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var u=r.get,m=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return u.call(this)},set:function(_){o=""+_,m.call(this,_)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return o},setValue:function(_){o=""+_},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Y0(e){e._valueTracker||(e._valueTracker=iG(e))}function z4(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),o="";return e&&(o=j4(e)?e.checked?"true":"false":e.value),e=o,e!==r?(t.setValue(e),!0):!1}function Qv(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function gE(e,t){var r=t.checked;return pi({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function hk(e,t){var r=t.defaultValue==null?"":t.defaultValue,o=t.checked!=null?t.checked:t.defaultChecked;r=Vu(t.value!=null?t.value:r),e._wrapperState={initialChecked:o,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function F4(e,t){t=t.checked,t!=null&&hP(e,"checked",t,!1)}function yE(e,t){F4(e,t);var r=Vu(t.value),o=t.type;if(r!=null)o==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(o==="submit"||o==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?_E(e,t.type,r):t.hasOwnProperty("defaultValue")&&_E(e,t.type,Vu(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function fk(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var o=t.type;if(!(o!=="submit"&&o!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function _E(e,t,r){(t!=="number"||Qv(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var My=Array.isArray;function zp(e,t,r,o){if(e=e.options,t){t={};for(var u=0;u<r.length;u++)t["$"+r[u]]=!0;for(r=0;r<e.length;r++)u=t.hasOwnProperty("$"+e[r].value),e[r].selected!==u&&(e[r].selected=u),u&&o&&(e[r].defaultSelected=!0)}else{for(r=""+Vu(r),t=null,u=0;u<e.length;u++){if(e[u].value===r){e[u].selected=!0,o&&(e[u].defaultSelected=!0);return}t!==null||e[u].disabled||(t=e[u])}t!==null&&(t.selected=!0)}}function xE(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Vt(91));return pi({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function pk(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Vt(92));if(My(r)){if(1<r.length)throw Error(Vt(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:Vu(r)}}function B4(e,t){var r=Vu(t.value),o=Vu(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),o!=null&&(e.defaultValue=""+o)}function mk(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function V4(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function vE(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?V4(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var K0,U4=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,o,u){MSApp.execUnsafeLocalFunction(function(){return e(t,r,o,u)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(K0=K0||document.createElement("div"),K0.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=K0.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function s_(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var zy={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},sG=["Webkit","ms","Moz","O"];Object.keys(zy).forEach(function(e){sG.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),zy[t]=zy[e]})});function $4(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||zy.hasOwnProperty(e)&&zy[e]?(""+t).trim():t+"px"}function G4(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var o=r.indexOf("--")===0,u=$4(r,t[r],o);r==="float"&&(r="cssFloat"),o?e.setProperty(r,u):e[r]=u}}var oG=pi({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function bE(e,t){if(t){if(oG[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Vt(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Vt(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Vt(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Vt(62))}}function wE(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var SE=null;function gP(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var TE=null,Fp=null,Bp=null;function gk(e){if(e=V_(e)){if(typeof TE!="function")throw Error(Vt(280));var t=e.stateNode;t&&(t=nb(t),TE(e.stateNode,e.type,t))}}function W4(e){Fp?Bp?Bp.push(e):Bp=[e]:Fp=e}function H4(){if(Fp){var e=Fp,t=Bp;if(Bp=Fp=null,gk(e),t)for(e=0;e<t.length;e++)gk(t[e])}}function q4(e,t){return e(t)}function Z4(){}var ZS=!1;function X4(e,t,r){if(ZS)return e(t,r);ZS=!0;try{return q4(e,t,r)}finally{ZS=!1,(Fp!==null||Bp!==null)&&(Z4(),H4())}}function o_(e,t){var r=e.stateNode;if(r===null)return null;var o=nb(r);if(o===null)return null;r=o[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(e=e.type,o=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!o;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Vt(231,t,typeof r));return r}var EE=!1;if(ic)try{var hy={};Object.defineProperty(hy,"passive",{get:function(){EE=!0}}),window.addEventListener("test",hy,hy),window.removeEventListener("test",hy,hy)}catch{EE=!1}function aG(e,t,r,o,u,m,_,b,s){var k=Array.prototype.slice.call(arguments,3);try{t.apply(r,k)}catch(O){this.onError(O)}}var Fy=!1,e1=null,t1=!1,CE=null,lG={onError:function(e){Fy=!0,e1=e}};function cG(e,t,r,o,u,m,_,b,s){Fy=!1,e1=null,aG.apply(lG,arguments)}function uG(e,t,r,o,u,m,_,b,s){if(cG.apply(this,arguments),Fy){if(Fy){var k=e1;Fy=!1,e1=null}else throw Error(Vt(198));t1||(t1=!0,CE=k)}}function Wh(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function Y4(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function yk(e){if(Wh(e)!==e)throw Error(Vt(188))}function dG(e){var t=e.alternate;if(!t){if(t=Wh(e),t===null)throw Error(Vt(188));return t!==e?null:e}for(var r=e,o=t;;){var u=r.return;if(u===null)break;var m=u.alternate;if(m===null){if(o=u.return,o!==null){r=o;continue}break}if(u.child===m.child){for(m=u.child;m;){if(m===r)return yk(u),e;if(m===o)return yk(u),t;m=m.sibling}throw Error(Vt(188))}if(r.return!==o.return)r=u,o=m;else{for(var _=!1,b=u.child;b;){if(b===r){_=!0,r=u,o=m;break}if(b===o){_=!0,o=u,r=m;break}b=b.sibling}if(!_){for(b=m.child;b;){if(b===r){_=!0,r=m,o=u;break}if(b===o){_=!0,o=m,r=u;break}b=b.sibling}if(!_)throw Error(Vt(189))}}if(r.alternate!==o)throw Error(Vt(190))}if(r.tag!==3)throw Error(Vt(188));return r.stateNode.current===r?e:t}function K4(e){return e=dG(e),e!==null?J4(e):null}function J4(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=J4(e);if(t!==null)return t;e=e.sibling}return null}var Q4=Co.unstable_scheduleCallback,_k=Co.unstable_cancelCallback,hG=Co.unstable_shouldYield,fG=Co.unstable_requestPaint,Ti=Co.unstable_now,pG=Co.unstable_getCurrentPriorityLevel,yP=Co.unstable_ImmediatePriority,ej=Co.unstable_UserBlockingPriority,n1=Co.unstable_NormalPriority,mG=Co.unstable_LowPriority,tj=Co.unstable_IdlePriority,J1=null,hl=null;function gG(e){if(hl&&typeof hl.onCommitFiberRoot=="function")try{hl.onCommitFiberRoot(J1,e,void 0,(e.current.flags&128)===128)}catch{}}var Ra=Math.clz32?Math.clz32:xG,yG=Math.log,_G=Math.LN2;function xG(e){return e>>>=0,e===0?32:31-(yG(e)/_G|0)|0}var J0=64,Q0=4194304;function Ay(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function r1(e,t){var r=e.pendingLanes;if(r===0)return 0;var o=0,u=e.suspendedLanes,m=e.pingedLanes,_=r&268435455;if(_!==0){var b=_&~u;b!==0?o=Ay(b):(m&=_,m!==0&&(o=Ay(m)))}else _=r&~u,_!==0?o=Ay(_):m!==0&&(o=Ay(m));if(o===0)return 0;if(t!==0&&t!==o&&!(t&u)&&(u=o&-o,m=t&-t,u>=m||u===16&&(m&4194240)!==0))return t;if(o&4&&(o|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=o;0<t;)r=31-Ra(t),u=1<<r,o|=e[r],t&=~u;return o}function vG(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bG(e,t){for(var r=e.suspendedLanes,o=e.pingedLanes,u=e.expirationTimes,m=e.pendingLanes;0<m;){var _=31-Ra(m),b=1<<_,s=u[_];s===-1?(!(b&r)||b&o)&&(u[_]=vG(b,t)):s<=t&&(e.expiredLanes|=b),m&=~b}}function PE(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function nj(){var e=J0;return J0<<=1,!(J0&4194240)&&(J0=64),e}function XS(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function F_(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Ra(t),e[t]=r}function wG(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var o=e.eventTimes;for(e=e.expirationTimes;0<r;){var u=31-Ra(r),m=1<<u;t[u]=0,o[u]=-1,e[u]=-1,r&=~m}}function _P(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var o=31-Ra(r),u=1<<o;u&t|e[o]&t&&(e[o]|=t),r&=~u}}var Dr=0;function rj(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var ij,xP,sj,oj,aj,ME=!1,ev=[],Ru=null,ku=null,Nu=null,a_=new Map,l_=new Map,Pu=[],SG="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function xk(e,t){switch(e){case"focusin":case"focusout":Ru=null;break;case"dragenter":case"dragleave":ku=null;break;case"mouseover":case"mouseout":Nu=null;break;case"pointerover":case"pointerout":a_.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":l_.delete(t.pointerId)}}function fy(e,t,r,o,u,m){return e===null||e.nativeEvent!==m?(e={blockedOn:t,domEventName:r,eventSystemFlags:o,nativeEvent:m,targetContainers:[u]},t!==null&&(t=V_(t),t!==null&&xP(t)),e):(e.eventSystemFlags|=o,t=e.targetContainers,u!==null&&t.indexOf(u)===-1&&t.push(u),e)}function TG(e,t,r,o,u){switch(t){case"focusin":return Ru=fy(Ru,e,t,r,o,u),!0;case"dragenter":return ku=fy(ku,e,t,r,o,u),!0;case"mouseover":return Nu=fy(Nu,e,t,r,o,u),!0;case"pointerover":var m=u.pointerId;return a_.set(m,fy(a_.get(m)||null,e,t,r,o,u)),!0;case"gotpointercapture":return m=u.pointerId,l_.set(m,fy(l_.get(m)||null,e,t,r,o,u)),!0}return!1}function lj(e){var t=mh(e.target);if(t!==null){var r=Wh(t);if(r!==null){if(t=r.tag,t===13){if(t=Y4(r),t!==null){e.blockedOn=t,aj(e.priority,function(){sj(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Rv(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=AE(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var o=new r.constructor(r.type,r);SE=o,r.target.dispatchEvent(o),SE=null}else return t=V_(r),t!==null&&xP(t),e.blockedOn=r,!1;t.shift()}return!0}function vk(e,t,r){Rv(e)&&r.delete(t)}function EG(){ME=!1,Ru!==null&&Rv(Ru)&&(Ru=null),ku!==null&&Rv(ku)&&(ku=null),Nu!==null&&Rv(Nu)&&(Nu=null),a_.forEach(vk),l_.forEach(vk)}function py(e,t){e.blockedOn===t&&(e.blockedOn=null,ME||(ME=!0,Co.unstable_scheduleCallback(Co.unstable_NormalPriority,EG)))}function c_(e){function t(u){return py(u,e)}if(0<ev.length){py(ev[0],e);for(var r=1;r<ev.length;r++){var o=ev[r];o.blockedOn===e&&(o.blockedOn=null)}}for(Ru!==null&&py(Ru,e),ku!==null&&py(ku,e),Nu!==null&&py(Nu,e),a_.forEach(t),l_.forEach(t),r=0;r<Pu.length;r++)o=Pu[r],o.blockedOn===e&&(o.blockedOn=null);for(;0<Pu.length&&(r=Pu[0],r.blockedOn===null);)lj(r),r.blockedOn===null&&Pu.shift()}var Vp=mc.ReactCurrentBatchConfig,i1=!0;function CG(e,t,r,o){var u=Dr,m=Vp.transition;Vp.transition=null;try{Dr=1,vP(e,t,r,o)}finally{Dr=u,Vp.transition=m}}function PG(e,t,r,o){var u=Dr,m=Vp.transition;Vp.transition=null;try{Dr=4,vP(e,t,r,o)}finally{Dr=u,Vp.transition=m}}function vP(e,t,r,o){if(i1){var u=AE(e,t,r,o);if(u===null)sT(e,t,o,s1,r),xk(e,o);else if(TG(u,e,t,r,o))o.stopPropagation();else if(xk(e,o),t&4&&-1<SG.indexOf(e)){for(;u!==null;){var m=V_(u);if(m!==null&&ij(m),m=AE(e,t,r,o),m===null&&sT(e,t,o,s1,r),m===u)break;u=m}u!==null&&o.stopPropagation()}else sT(e,t,o,null,r)}}var s1=null;function AE(e,t,r,o){if(s1=null,e=gP(o),e=mh(e),e!==null)if(t=Wh(e),t===null)e=null;else if(r=t.tag,r===13){if(e=Y4(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return s1=e,null}function cj(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(pG()){case yP:return 1;case ej:return 4;case n1:case mG:return 16;case tj:return 536870912;default:return 16}default:return 16}}var Au=null,bP=null,kv=null;function uj(){if(kv)return kv;var e,t=bP,r=t.length,o,u="value"in Au?Au.value:Au.textContent,m=u.length;for(e=0;e<r&&t[e]===u[e];e++);var _=r-e;for(o=1;o<=_&&t[r-o]===u[m-o];o++);return kv=u.slice(e,1<o?1-o:void 0)}function Nv(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function tv(){return!0}function bk(){return!1}function Do(e){function t(r,o,u,m,_){this._reactName=r,this._targetInst=u,this.type=o,this.nativeEvent=m,this.target=_,this.currentTarget=null;for(var b in e)e.hasOwnProperty(b)&&(r=e[b],this[b]=r?r(m):m[b]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?tv:bk,this.isPropagationStopped=bk,this}return pi(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=tv)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=tv)},persist:function(){},isPersistent:tv}),t}var dm={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},wP=Do(dm),B_=pi({},dm,{view:0,detail:0}),MG=Do(B_),YS,KS,my,Q1=pi({},B_,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:SP,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==my&&(my&&e.type==="mousemove"?(YS=e.screenX-my.screenX,KS=e.screenY-my.screenY):KS=YS=0,my=e),YS)},movementY:function(e){return"movementY"in e?e.movementY:KS}}),wk=Do(Q1),AG=pi({},Q1,{dataTransfer:0}),IG=Do(AG),DG=pi({},B_,{relatedTarget:0}),JS=Do(DG),RG=pi({},dm,{animationName:0,elapsedTime:0,pseudoElement:0}),kG=Do(RG),NG=pi({},dm,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),LG=Do(NG),OG=pi({},dm,{data:0}),Sk=Do(OG),jG={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},zG={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},FG={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function BG(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=FG[e])?!!t[e]:!1}function SP(){return BG}var VG=pi({},B_,{key:function(e){if(e.key){var t=jG[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Nv(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?zG[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:SP,charCode:function(e){return e.type==="keypress"?Nv(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Nv(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),UG=Do(VG),$G=pi({},Q1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Tk=Do($G),GG=pi({},B_,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:SP}),WG=Do(GG),HG=pi({},dm,{propertyName:0,elapsedTime:0,pseudoElement:0}),qG=Do(HG),ZG=pi({},Q1,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),XG=Do(ZG),YG=[9,13,27,32],TP=ic&&"CompositionEvent"in window,By=null;ic&&"documentMode"in document&&(By=document.documentMode);var KG=ic&&"TextEvent"in window&&!By,dj=ic&&(!TP||By&&8<By&&11>=By),Ek=" ",Ck=!1;function hj(e,t){switch(e){case"keyup":return YG.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fj(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Sp=!1;function JG(e,t){switch(e){case"compositionend":return fj(t);case"keypress":return t.which!==32?null:(Ck=!0,Ek);case"textInput":return e=t.data,e===Ek&&Ck?null:e;default:return null}}function QG(e,t){if(Sp)return e==="compositionend"||!TP&&hj(e,t)?(e=uj(),kv=bP=Au=null,Sp=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return dj&&t.locale!=="ko"?null:t.data;default:return null}}var e7={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Pk(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!e7[e.type]:t==="textarea"}function pj(e,t,r,o){W4(o),t=o1(t,"onChange"),0<t.length&&(r=new wP("onChange","change",null,r,o),e.push({event:r,listeners:t}))}var Vy=null,u_=null;function t7(e){Ej(e,0)}function eb(e){var t=Cp(e);if(z4(t))return e}function n7(e,t){if(e==="change")return t}var mj=!1;if(ic){var QS;if(ic){var eT="oninput"in document;if(!eT){var Mk=document.createElement("div");Mk.setAttribute("oninput","return;"),eT=typeof Mk.oninput=="function"}QS=eT}else QS=!1;mj=QS&&(!document.documentMode||9<document.documentMode)}function Ak(){Vy&&(Vy.detachEvent("onpropertychange",gj),u_=Vy=null)}function gj(e){if(e.propertyName==="value"&&eb(u_)){var t=[];pj(t,u_,e,gP(e)),X4(t7,t)}}function r7(e,t,r){e==="focusin"?(Ak(),Vy=t,u_=r,Vy.attachEvent("onpropertychange",gj)):e==="focusout"&&Ak()}function i7(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return eb(u_)}function s7(e,t){if(e==="click")return eb(t)}function o7(e,t){if(e==="input"||e==="change")return eb(t)}function a7(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var La=typeof Object.is=="function"?Object.is:a7;function d_(e,t){if(La(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),o=Object.keys(t);if(r.length!==o.length)return!1;for(o=0;o<r.length;o++){var u=r[o];if(!dE.call(t,u)||!La(e[u],t[u]))return!1}return!0}function Ik(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Dk(e,t){var r=Ik(e);e=0;for(var o;r;){if(r.nodeType===3){if(o=e+r.textContent.length,e<=t&&o>=t)return{node:r,offset:t-e};e=o}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Ik(r)}}function yj(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?yj(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function _j(){for(var e=window,t=Qv();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=Qv(e.document)}return t}function EP(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function l7(e){var t=_j(),r=e.focusedElem,o=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&yj(r.ownerDocument.documentElement,r)){if(o!==null&&EP(r)){if(t=o.start,e=o.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var u=r.textContent.length,m=Math.min(o.start,u);o=o.end===void 0?m:Math.min(o.end,u),!e.extend&&m>o&&(u=o,o=m,m=u),u=Dk(r,m);var _=Dk(r,o);u&&_&&(e.rangeCount!==1||e.anchorNode!==u.node||e.anchorOffset!==u.offset||e.focusNode!==_.node||e.focusOffset!==_.offset)&&(t=t.createRange(),t.setStart(u.node,u.offset),e.removeAllRanges(),m>o?(e.addRange(t),e.extend(_.node,_.offset)):(t.setEnd(_.node,_.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var c7=ic&&"documentMode"in document&&11>=document.documentMode,Tp=null,IE=null,Uy=null,DE=!1;function Rk(e,t,r){var o=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;DE||Tp==null||Tp!==Qv(o)||(o=Tp,"selectionStart"in o&&EP(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),Uy&&d_(Uy,o)||(Uy=o,o=o1(IE,"onSelect"),0<o.length&&(t=new wP("onSelect","select",null,t,r),e.push({event:t,listeners:o}),t.target=Tp)))}function nv(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Ep={animationend:nv("Animation","AnimationEnd"),animationiteration:nv("Animation","AnimationIteration"),animationstart:nv("Animation","AnimationStart"),transitionend:nv("Transition","TransitionEnd")},tT={},xj={};ic&&(xj=document.createElement("div").style,"AnimationEvent"in window||(delete Ep.animationend.animation,delete Ep.animationiteration.animation,delete Ep.animationstart.animation),"TransitionEvent"in window||delete Ep.transitionend.transition);function tb(e){if(tT[e])return tT[e];if(!Ep[e])return e;var t=Ep[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in xj)return tT[e]=t[r];return e}var vj=tb("animationend"),bj=tb("animationiteration"),wj=tb("animationstart"),Sj=tb("transitionend"),Tj=new Map,kk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function rd(e,t){Tj.set(e,t),Gh(t,[e])}for(var nT=0;nT<kk.length;nT++){var rT=kk[nT],u7=rT.toLowerCase(),d7=rT[0].toUpperCase()+rT.slice(1);rd(u7,"on"+d7)}rd(vj,"onAnimationEnd");rd(bj,"onAnimationIteration");rd(wj,"onAnimationStart");rd("dblclick","onDoubleClick");rd("focusin","onFocus");rd("focusout","onBlur");rd(Sj,"onTransitionEnd");Zp("onMouseEnter",["mouseout","mouseover"]);Zp("onMouseLeave",["mouseout","mouseover"]);Zp("onPointerEnter",["pointerout","pointerover"]);Zp("onPointerLeave",["pointerout","pointerover"]);Gh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Gh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Gh("onBeforeInput",["compositionend","keypress","textInput","paste"]);Gh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Gh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Gh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Iy="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),h7=new Set("cancel close invalid load scroll toggle".split(" ").concat(Iy));function Nk(e,t,r){var o=e.type||"unknown-event";e.currentTarget=r,uG(o,t,void 0,e),e.currentTarget=null}function Ej(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var o=e[r],u=o.event;o=o.listeners;e:{var m=void 0;if(t)for(var _=o.length-1;0<=_;_--){var b=o[_],s=b.instance,k=b.currentTarget;if(b=b.listener,s!==m&&u.isPropagationStopped())break e;Nk(u,b,k),m=s}else for(_=0;_<o.length;_++){if(b=o[_],s=b.instance,k=b.currentTarget,b=b.listener,s!==m&&u.isPropagationStopped())break e;Nk(u,b,k),m=s}}}if(t1)throw e=CE,t1=!1,CE=null,e}function Xr(e,t){var r=t[OE];r===void 0&&(r=t[OE]=new Set);var o=e+"__bubble";r.has(o)||(Cj(t,e,2,!1),r.add(o))}function iT(e,t,r){var o=0;t&&(o|=4),Cj(r,e,o,t)}var rv="_reactListening"+Math.random().toString(36).slice(2);function h_(e){if(!e[rv]){e[rv]=!0,k4.forEach(function(r){r!=="selectionchange"&&(h7.has(r)||iT(r,!1,e),iT(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[rv]||(t[rv]=!0,iT("selectionchange",!1,t))}}function Cj(e,t,r,o){switch(cj(t)){case 1:var u=CG;break;case 4:u=PG;break;default:u=vP}r=u.bind(null,t,r,e),u=void 0,!EE||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(u=!0),o?u!==void 0?e.addEventListener(t,r,{capture:!0,passive:u}):e.addEventListener(t,r,!0):u!==void 0?e.addEventListener(t,r,{passive:u}):e.addEventListener(t,r,!1)}function sT(e,t,r,o,u){var m=o;if(!(t&1)&&!(t&2)&&o!==null)e:for(;;){if(o===null)return;var _=o.tag;if(_===3||_===4){var b=o.stateNode.containerInfo;if(b===u||b.nodeType===8&&b.parentNode===u)break;if(_===4)for(_=o.return;_!==null;){var s=_.tag;if((s===3||s===4)&&(s=_.stateNode.containerInfo,s===u||s.nodeType===8&&s.parentNode===u))return;_=_.return}for(;b!==null;){if(_=mh(b),_===null)return;if(s=_.tag,s===5||s===6){o=m=_;continue e}b=b.parentNode}}o=o.return}X4(function(){var k=m,O=gP(r),F=[];e:{var q=Tj.get(e);if(q!==void 0){var H=wP,J=e;switch(e){case"keypress":if(Nv(r)===0)break e;case"keydown":case"keyup":H=UG;break;case"focusin":J="focus",H=JS;break;case"focusout":J="blur",H=JS;break;case"beforeblur":case"afterblur":H=JS;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":H=wk;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":H=IG;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":H=WG;break;case vj:case bj:case wj:H=kG;break;case Sj:H=qG;break;case"scroll":H=MG;break;case"wheel":H=XG;break;case"copy":case"cut":case"paste":H=LG;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":H=Tk}var U=(t&4)!==0,te=!U&&e==="scroll",Q=U?q!==null?q+"Capture":null:q;U=[];for(var ee=k,re;ee!==null;){re=ee;var xe=re.stateNode;if(re.tag===5&&xe!==null&&(re=xe,Q!==null&&(xe=o_(ee,Q),xe!=null&&U.push(f_(ee,xe,re)))),te)break;ee=ee.return}0<U.length&&(q=new H(q,J,null,r,O),F.push({event:q,listeners:U}))}}if(!(t&7)){e:{if(q=e==="mouseover"||e==="pointerover",H=e==="mouseout"||e==="pointerout",q&&r!==SE&&(J=r.relatedTarget||r.fromElement)&&(mh(J)||J[sc]))break e;if((H||q)&&(q=O.window===O?O:(q=O.ownerDocument)?q.defaultView||q.parentWindow:window,H?(J=r.relatedTarget||r.toElement,H=k,J=J?mh(J):null,J!==null&&(te=Wh(J),J!==te||J.tag!==5&&J.tag!==6)&&(J=null)):(H=null,J=k),H!==J)){if(U=wk,xe="onMouseLeave",Q="onMouseEnter",ee="mouse",(e==="pointerout"||e==="pointerover")&&(U=Tk,xe="onPointerLeave",Q="onPointerEnter",ee="pointer"),te=H==null?q:Cp(H),re=J==null?q:Cp(J),q=new U(xe,ee+"leave",H,r,O),q.target=te,q.relatedTarget=re,xe=null,mh(O)===k&&(U=new U(Q,ee+"enter",J,r,O),U.target=re,U.relatedTarget=te,xe=U),te=xe,H&&J)t:{for(U=H,Q=J,ee=0,re=U;re;re=dp(re))ee++;for(re=0,xe=Q;xe;xe=dp(xe))re++;for(;0<ee-re;)U=dp(U),ee--;for(;0<re-ee;)Q=dp(Q),re--;for(;ee--;){if(U===Q||Q!==null&&U===Q.alternate)break t;U=dp(U),Q=dp(Q)}U=null}else U=null;H!==null&&Lk(F,q,H,U,!1),J!==null&&te!==null&&Lk(F,te,J,U,!0)}}e:{if(q=k?Cp(k):window,H=q.nodeName&&q.nodeName.toLowerCase(),H==="select"||H==="input"&&q.type==="file")var Ee=n7;else if(Pk(q))if(mj)Ee=o7;else{Ee=i7;var He=r7}else(H=q.nodeName)&&H.toLowerCase()==="input"&&(q.type==="checkbox"||q.type==="radio")&&(Ee=s7);if(Ee&&(Ee=Ee(e,k))){pj(F,Ee,r,O);break e}He&&He(e,q,k),e==="focusout"&&(He=q._wrapperState)&&He.controlled&&q.type==="number"&&_E(q,"number",q.value)}switch(He=k?Cp(k):window,e){case"focusin":(Pk(He)||He.contentEditable==="true")&&(Tp=He,IE=k,Uy=null);break;case"focusout":Uy=IE=Tp=null;break;case"mousedown":DE=!0;break;case"contextmenu":case"mouseup":case"dragend":DE=!1,Rk(F,r,O);break;case"selectionchange":if(c7)break;case"keydown":case"keyup":Rk(F,r,O)}var qe;if(TP)e:{switch(e){case"compositionstart":var Ne="onCompositionStart";break e;case"compositionend":Ne="onCompositionEnd";break e;case"compositionupdate":Ne="onCompositionUpdate";break e}Ne=void 0}else Sp?hj(e,r)&&(Ne="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(Ne="onCompositionStart");Ne&&(dj&&r.locale!=="ko"&&(Sp||Ne!=="onCompositionStart"?Ne==="onCompositionEnd"&&Sp&&(qe=uj()):(Au=O,bP="value"in Au?Au.value:Au.textContent,Sp=!0)),He=o1(k,Ne),0<He.length&&(Ne=new Sk(Ne,e,null,r,O),F.push({event:Ne,listeners:He}),qe?Ne.data=qe:(qe=fj(r),qe!==null&&(Ne.data=qe)))),(qe=KG?JG(e,r):QG(e,r))&&(k=o1(k,"onBeforeInput"),0<k.length&&(O=new Sk("onBeforeInput","beforeinput",null,r,O),F.push({event:O,listeners:k}),O.data=qe))}Ej(F,t)})}function f_(e,t,r){return{instance:e,listener:t,currentTarget:r}}function o1(e,t){for(var r=t+"Capture",o=[];e!==null;){var u=e,m=u.stateNode;u.tag===5&&m!==null&&(u=m,m=o_(e,r),m!=null&&o.unshift(f_(e,m,u)),m=o_(e,t),m!=null&&o.push(f_(e,m,u))),e=e.return}return o}function dp(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Lk(e,t,r,o,u){for(var m=t._reactName,_=[];r!==null&&r!==o;){var b=r,s=b.alternate,k=b.stateNode;if(s!==null&&s===o)break;b.tag===5&&k!==null&&(b=k,u?(s=o_(r,m),s!=null&&_.unshift(f_(r,s,b))):u||(s=o_(r,m),s!=null&&_.push(f_(r,s,b)))),r=r.return}_.length!==0&&e.push({event:t,listeners:_})}var f7=/\r\n?/g,p7=/\u0000|\uFFFD/g;function Ok(e){return(typeof e=="string"?e:""+e).replace(f7,`
`).replace(p7,"")}function iv(e,t,r){if(t=Ok(t),Ok(e)!==t&&r)throw Error(Vt(425))}function a1(){}var RE=null,kE=null;function NE(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var LE=typeof setTimeout=="function"?setTimeout:void 0,m7=typeof clearTimeout=="function"?clearTimeout:void 0,jk=typeof Promise=="function"?Promise:void 0,g7=typeof queueMicrotask=="function"?queueMicrotask:typeof jk<"u"?function(e){return jk.resolve(null).then(e).catch(y7)}:LE;function y7(e){setTimeout(function(){throw e})}function oT(e,t){var r=t,o=0;do{var u=r.nextSibling;if(e.removeChild(r),u&&u.nodeType===8)if(r=u.data,r==="/$"){if(o===0){e.removeChild(u),c_(t);return}o--}else r!=="$"&&r!=="$?"&&r!=="$!"||o++;r=u}while(r);c_(t)}function Lu(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function zk(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var hm=Math.random().toString(36).slice(2),ul="__reactFiber$"+hm,p_="__reactProps$"+hm,sc="__reactContainer$"+hm,OE="__reactEvents$"+hm,_7="__reactListeners$"+hm,x7="__reactHandles$"+hm;function mh(e){var t=e[ul];if(t)return t;for(var r=e.parentNode;r;){if(t=r[sc]||r[ul]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=zk(e);e!==null;){if(r=e[ul])return r;e=zk(e)}return t}e=r,r=e.parentNode}return null}function V_(e){return e=e[ul]||e[sc],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Cp(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Vt(33))}function nb(e){return e[p_]||null}var jE=[],Pp=-1;function id(e){return{current:e}}function Yr(e){0>Pp||(e.current=jE[Pp],jE[Pp]=null,Pp--)}function $r(e,t){Pp++,jE[Pp]=e.current,e.current=t}var Uu={},bs=id(Uu),Ys=id(!1),Ch=Uu;function Xp(e,t){var r=e.type.contextTypes;if(!r)return Uu;var o=e.stateNode;if(o&&o.__reactInternalMemoizedUnmaskedChildContext===t)return o.__reactInternalMemoizedMaskedChildContext;var u={},m;for(m in r)u[m]=t[m];return o&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=u),u}function Ks(e){return e=e.childContextTypes,e!=null}function l1(){Yr(Ys),Yr(bs)}function Fk(e,t,r){if(bs.current!==Uu)throw Error(Vt(168));$r(bs,t),$r(Ys,r)}function Pj(e,t,r){var o=e.stateNode;if(t=t.childContextTypes,typeof o.getChildContext!="function")return r;o=o.getChildContext();for(var u in o)if(!(u in t))throw Error(Vt(108,rG(e)||"Unknown",u));return pi({},r,o)}function c1(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Uu,Ch=bs.current,$r(bs,e),$r(Ys,Ys.current),!0}function Bk(e,t,r){var o=e.stateNode;if(!o)throw Error(Vt(169));r?(e=Pj(e,t,Ch),o.__reactInternalMemoizedMergedChildContext=e,Yr(Ys),Yr(bs),$r(bs,e)):Yr(Ys),$r(Ys,r)}var Zl=null,rb=!1,aT=!1;function Mj(e){Zl===null?Zl=[e]:Zl.push(e)}function v7(e){rb=!0,Mj(e)}function sd(){if(!aT&&Zl!==null){aT=!0;var e=0,t=Dr;try{var r=Zl;for(Dr=1;e<r.length;e++){var o=r[e];do o=o(!0);while(o!==null)}Zl=null,rb=!1}catch(u){throw Zl!==null&&(Zl=Zl.slice(e+1)),Q4(yP,sd),u}finally{Dr=t,aT=!1}}return null}var Mp=[],Ap=0,u1=null,d1=0,Yo=[],Ko=0,Ph=null,Xl=1,Yl="";function ch(e,t){Mp[Ap++]=d1,Mp[Ap++]=u1,u1=e,d1=t}function Aj(e,t,r){Yo[Ko++]=Xl,Yo[Ko++]=Yl,Yo[Ko++]=Ph,Ph=e;var o=Xl;e=Yl;var u=32-Ra(o)-1;o&=~(1<<u),r+=1;var m=32-Ra(t)+u;if(30<m){var _=u-u%5;m=(o&(1<<_)-1).toString(32),o>>=_,u-=_,Xl=1<<32-Ra(t)+u|r<<u|o,Yl=m+e}else Xl=1<<m|r<<u|o,Yl=e}function CP(e){e.return!==null&&(ch(e,1),Aj(e,1,0))}function PP(e){for(;e===u1;)u1=Mp[--Ap],Mp[Ap]=null,d1=Mp[--Ap],Mp[Ap]=null;for(;e===Ph;)Ph=Yo[--Ko],Yo[Ko]=null,Yl=Yo[--Ko],Yo[Ko]=null,Xl=Yo[--Ko],Yo[Ko]=null}var wo=null,xo=null,ri=!1,Ia=null;function Ij(e,t){var r=Qo(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function Vk(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,wo=e,xo=Lu(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,wo=e,xo=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Ph!==null?{id:Xl,overflow:Yl}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Qo(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,wo=e,xo=null,!0):!1;default:return!1}}function zE(e){return(e.mode&1)!==0&&(e.flags&128)===0}function FE(e){if(ri){var t=xo;if(t){var r=t;if(!Vk(e,t)){if(zE(e))throw Error(Vt(418));t=Lu(r.nextSibling);var o=wo;t&&Vk(e,t)?Ij(o,r):(e.flags=e.flags&-4097|2,ri=!1,wo=e)}}else{if(zE(e))throw Error(Vt(418));e.flags=e.flags&-4097|2,ri=!1,wo=e}}}function Uk(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;wo=e}function sv(e){if(e!==wo)return!1;if(!ri)return Uk(e),ri=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!NE(e.type,e.memoizedProps)),t&&(t=xo)){if(zE(e))throw Dj(),Error(Vt(418));for(;t;)Ij(e,t),t=Lu(t.nextSibling)}if(Uk(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Vt(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){xo=Lu(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}xo=null}}else xo=wo?Lu(e.stateNode.nextSibling):null;return!0}function Dj(){for(var e=xo;e;)e=Lu(e.nextSibling)}function Yp(){xo=wo=null,ri=!1}function MP(e){Ia===null?Ia=[e]:Ia.push(e)}var b7=mc.ReactCurrentBatchConfig;function gy(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Vt(309));var o=r.stateNode}if(!o)throw Error(Vt(147,e));var u=o,m=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===m?t.ref:(t=function(_){var b=u.refs;_===null?delete b[m]:b[m]=_},t._stringRef=m,t)}if(typeof e!="string")throw Error(Vt(284));if(!r._owner)throw Error(Vt(290,e))}return e}function ov(e,t){throw e=Object.prototype.toString.call(t),Error(Vt(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function $k(e){var t=e._init;return t(e._payload)}function Rj(e){function t(Q,ee){if(e){var re=Q.deletions;re===null?(Q.deletions=[ee],Q.flags|=16):re.push(ee)}}function r(Q,ee){if(!e)return null;for(;ee!==null;)t(Q,ee),ee=ee.sibling;return null}function o(Q,ee){for(Q=new Map;ee!==null;)ee.key!==null?Q.set(ee.key,ee):Q.set(ee.index,ee),ee=ee.sibling;return Q}function u(Q,ee){return Q=Fu(Q,ee),Q.index=0,Q.sibling=null,Q}function m(Q,ee,re){return Q.index=re,e?(re=Q.alternate,re!==null?(re=re.index,re<ee?(Q.flags|=2,ee):re):(Q.flags|=2,ee)):(Q.flags|=1048576,ee)}function _(Q){return e&&Q.alternate===null&&(Q.flags|=2),Q}function b(Q,ee,re,xe){return ee===null||ee.tag!==6?(ee=pT(re,Q.mode,xe),ee.return=Q,ee):(ee=u(ee,re),ee.return=Q,ee)}function s(Q,ee,re,xe){var Ee=re.type;return Ee===wp?O(Q,ee,re.props.children,xe,re.key):ee!==null&&(ee.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===Eu&&$k(Ee)===ee.type)?(xe=u(ee,re.props),xe.ref=gy(Q,ee,re),xe.return=Q,xe):(xe=Vv(re.type,re.key,re.props,null,Q.mode,xe),xe.ref=gy(Q,ee,re),xe.return=Q,xe)}function k(Q,ee,re,xe){return ee===null||ee.tag!==4||ee.stateNode.containerInfo!==re.containerInfo||ee.stateNode.implementation!==re.implementation?(ee=mT(re,Q.mode,xe),ee.return=Q,ee):(ee=u(ee,re.children||[]),ee.return=Q,ee)}function O(Q,ee,re,xe,Ee){return ee===null||ee.tag!==7?(ee=bh(re,Q.mode,xe,Ee),ee.return=Q,ee):(ee=u(ee,re),ee.return=Q,ee)}function F(Q,ee,re){if(typeof ee=="string"&&ee!==""||typeof ee=="number")return ee=pT(""+ee,Q.mode,re),ee.return=Q,ee;if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case X0:return re=Vv(ee.type,ee.key,ee.props,null,Q.mode,re),re.ref=gy(Q,null,ee),re.return=Q,re;case bp:return ee=mT(ee,Q.mode,re),ee.return=Q,ee;case Eu:var xe=ee._init;return F(Q,xe(ee._payload),re)}if(My(ee)||dy(ee))return ee=bh(ee,Q.mode,re,null),ee.return=Q,ee;ov(Q,ee)}return null}function q(Q,ee,re,xe){var Ee=ee!==null?ee.key:null;if(typeof re=="string"&&re!==""||typeof re=="number")return Ee!==null?null:b(Q,ee,""+re,xe);if(typeof re=="object"&&re!==null){switch(re.$$typeof){case X0:return re.key===Ee?s(Q,ee,re,xe):null;case bp:return re.key===Ee?k(Q,ee,re,xe):null;case Eu:return Ee=re._init,q(Q,ee,Ee(re._payload),xe)}if(My(re)||dy(re))return Ee!==null?null:O(Q,ee,re,xe,null);ov(Q,re)}return null}function H(Q,ee,re,xe,Ee){if(typeof xe=="string"&&xe!==""||typeof xe=="number")return Q=Q.get(re)||null,b(ee,Q,""+xe,Ee);if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case X0:return Q=Q.get(xe.key===null?re:xe.key)||null,s(ee,Q,xe,Ee);case bp:return Q=Q.get(xe.key===null?re:xe.key)||null,k(ee,Q,xe,Ee);case Eu:var He=xe._init;return H(Q,ee,re,He(xe._payload),Ee)}if(My(xe)||dy(xe))return Q=Q.get(re)||null,O(ee,Q,xe,Ee,null);ov(ee,xe)}return null}function J(Q,ee,re,xe){for(var Ee=null,He=null,qe=ee,Ne=ee=0,ft=null;qe!==null&&Ne<re.length;Ne++){qe.index>Ne?(ft=qe,qe=null):ft=qe.sibling;var ut=q(Q,qe,re[Ne],xe);if(ut===null){qe===null&&(qe=ft);break}e&&qe&&ut.alternate===null&&t(Q,qe),ee=m(ut,ee,Ne),He===null?Ee=ut:He.sibling=ut,He=ut,qe=ft}if(Ne===re.length)return r(Q,qe),ri&&ch(Q,Ne),Ee;if(qe===null){for(;Ne<re.length;Ne++)qe=F(Q,re[Ne],xe),qe!==null&&(ee=m(qe,ee,Ne),He===null?Ee=qe:He.sibling=qe,He=qe);return ri&&ch(Q,Ne),Ee}for(qe=o(Q,qe);Ne<re.length;Ne++)ft=H(qe,Q,Ne,re[Ne],xe),ft!==null&&(e&&ft.alternate!==null&&qe.delete(ft.key===null?Ne:ft.key),ee=m(ft,ee,Ne),He===null?Ee=ft:He.sibling=ft,He=ft);return e&&qe.forEach(function(mt){return t(Q,mt)}),ri&&ch(Q,Ne),Ee}function U(Q,ee,re,xe){var Ee=dy(re);if(typeof Ee!="function")throw Error(Vt(150));if(re=Ee.call(re),re==null)throw Error(Vt(151));for(var He=Ee=null,qe=ee,Ne=ee=0,ft=null,ut=re.next();qe!==null&&!ut.done;Ne++,ut=re.next()){qe.index>Ne?(ft=qe,qe=null):ft=qe.sibling;var mt=q(Q,qe,ut.value,xe);if(mt===null){qe===null&&(qe=ft);break}e&&qe&&mt.alternate===null&&t(Q,qe),ee=m(mt,ee,Ne),He===null?Ee=mt:He.sibling=mt,He=mt,qe=ft}if(ut.done)return r(Q,qe),ri&&ch(Q,Ne),Ee;if(qe===null){for(;!ut.done;Ne++,ut=re.next())ut=F(Q,ut.value,xe),ut!==null&&(ee=m(ut,ee,Ne),He===null?Ee=ut:He.sibling=ut,He=ut);return ri&&ch(Q,Ne),Ee}for(qe=o(Q,qe);!ut.done;Ne++,ut=re.next())ut=H(qe,Q,Ne,ut.value,xe),ut!==null&&(e&&ut.alternate!==null&&qe.delete(ut.key===null?Ne:ut.key),ee=m(ut,ee,Ne),He===null?Ee=ut:He.sibling=ut,He=ut);return e&&qe.forEach(function(pt){return t(Q,pt)}),ri&&ch(Q,Ne),Ee}function te(Q,ee,re,xe){if(typeof re=="object"&&re!==null&&re.type===wp&&re.key===null&&(re=re.props.children),typeof re=="object"&&re!==null){switch(re.$$typeof){case X0:e:{for(var Ee=re.key,He=ee;He!==null;){if(He.key===Ee){if(Ee=re.type,Ee===wp){if(He.tag===7){r(Q,He.sibling),ee=u(He,re.props.children),ee.return=Q,Q=ee;break e}}else if(He.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===Eu&&$k(Ee)===He.type){r(Q,He.sibling),ee=u(He,re.props),ee.ref=gy(Q,He,re),ee.return=Q,Q=ee;break e}r(Q,He);break}else t(Q,He);He=He.sibling}re.type===wp?(ee=bh(re.props.children,Q.mode,xe,re.key),ee.return=Q,Q=ee):(xe=Vv(re.type,re.key,re.props,null,Q.mode,xe),xe.ref=gy(Q,ee,re),xe.return=Q,Q=xe)}return _(Q);case bp:e:{for(He=re.key;ee!==null;){if(ee.key===He)if(ee.tag===4&&ee.stateNode.containerInfo===re.containerInfo&&ee.stateNode.implementation===re.implementation){r(Q,ee.sibling),ee=u(ee,re.children||[]),ee.return=Q,Q=ee;break e}else{r(Q,ee);break}else t(Q,ee);ee=ee.sibling}ee=mT(re,Q.mode,xe),ee.return=Q,Q=ee}return _(Q);case Eu:return He=re._init,te(Q,ee,He(re._payload),xe)}if(My(re))return J(Q,ee,re,xe);if(dy(re))return U(Q,ee,re,xe);ov(Q,re)}return typeof re=="string"&&re!==""||typeof re=="number"?(re=""+re,ee!==null&&ee.tag===6?(r(Q,ee.sibling),ee=u(ee,re),ee.return=Q,Q=ee):(r(Q,ee),ee=pT(re,Q.mode,xe),ee.return=Q,Q=ee),_(Q)):r(Q,ee)}return te}var Kp=Rj(!0),kj=Rj(!1),h1=id(null),f1=null,Ip=null,AP=null;function IP(){AP=Ip=f1=null}function DP(e){var t=h1.current;Yr(h1),e._currentValue=t}function BE(e,t,r){for(;e!==null;){var o=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,o!==null&&(o.childLanes|=t)):o!==null&&(o.childLanes&t)!==t&&(o.childLanes|=t),e===r)break;e=e.return}}function Up(e,t){f1=e,AP=Ip=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Zs=!0),e.firstContext=null)}function ta(e){var t=e._currentValue;if(AP!==e)if(e={context:e,memoizedValue:t,next:null},Ip===null){if(f1===null)throw Error(Vt(308));Ip=e,f1.dependencies={lanes:0,firstContext:e}}else Ip=Ip.next=e;return t}var gh=null;function RP(e){gh===null?gh=[e]:gh.push(e)}function Nj(e,t,r,o){var u=t.interleaved;return u===null?(r.next=r,RP(t)):(r.next=u.next,u.next=r),t.interleaved=r,oc(e,o)}function oc(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var Cu=!1;function kP(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Lj(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ql(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ou(e,t,r){var o=e.updateQueue;if(o===null)return null;if(o=o.shared,br&2){var u=o.pending;return u===null?t.next=t:(t.next=u.next,u.next=t),o.pending=t,oc(e,r)}return u=o.interleaved,u===null?(t.next=t,RP(o)):(t.next=u.next,u.next=t),o.interleaved=t,oc(e,r)}function Lv(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var o=t.lanes;o&=e.pendingLanes,r|=o,t.lanes=r,_P(e,r)}}function Gk(e,t){var r=e.updateQueue,o=e.alternate;if(o!==null&&(o=o.updateQueue,r===o)){var u=null,m=null;if(r=r.firstBaseUpdate,r!==null){do{var _={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};m===null?u=m=_:m=m.next=_,r=r.next}while(r!==null);m===null?u=m=t:m=m.next=t}else u=m=t;r={baseState:o.baseState,firstBaseUpdate:u,lastBaseUpdate:m,shared:o.shared,effects:o.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function p1(e,t,r,o){var u=e.updateQueue;Cu=!1;var m=u.firstBaseUpdate,_=u.lastBaseUpdate,b=u.shared.pending;if(b!==null){u.shared.pending=null;var s=b,k=s.next;s.next=null,_===null?m=k:_.next=k,_=s;var O=e.alternate;O!==null&&(O=O.updateQueue,b=O.lastBaseUpdate,b!==_&&(b===null?O.firstBaseUpdate=k:b.next=k,O.lastBaseUpdate=s))}if(m!==null){var F=u.baseState;_=0,O=k=s=null,b=m;do{var q=b.lane,H=b.eventTime;if((o&q)===q){O!==null&&(O=O.next={eventTime:H,lane:0,tag:b.tag,payload:b.payload,callback:b.callback,next:null});e:{var J=e,U=b;switch(q=t,H=r,U.tag){case 1:if(J=U.payload,typeof J=="function"){F=J.call(H,F,q);break e}F=J;break e;case 3:J.flags=J.flags&-65537|128;case 0:if(J=U.payload,q=typeof J=="function"?J.call(H,F,q):J,q==null)break e;F=pi({},F,q);break e;case 2:Cu=!0}}b.callback!==null&&b.lane!==0&&(e.flags|=64,q=u.effects,q===null?u.effects=[b]:q.push(b))}else H={eventTime:H,lane:q,tag:b.tag,payload:b.payload,callback:b.callback,next:null},O===null?(k=O=H,s=F):O=O.next=H,_|=q;if(b=b.next,b===null){if(b=u.shared.pending,b===null)break;q=b,b=q.next,q.next=null,u.lastBaseUpdate=q,u.shared.pending=null}}while(!0);if(O===null&&(s=F),u.baseState=s,u.firstBaseUpdate=k,u.lastBaseUpdate=O,t=u.shared.interleaved,t!==null){u=t;do _|=u.lane,u=u.next;while(u!==t)}else m===null&&(u.shared.lanes=0);Ah|=_,e.lanes=_,e.memoizedState=F}}function Wk(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var o=e[t],u=o.callback;if(u!==null){if(o.callback=null,o=r,typeof u!="function")throw Error(Vt(191,u));u.call(o)}}}var U_={},fl=id(U_),m_=id(U_),g_=id(U_);function yh(e){if(e===U_)throw Error(Vt(174));return e}function NP(e,t){switch($r(g_,t),$r(m_,e),$r(fl,U_),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:vE(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=vE(t,e)}Yr(fl),$r(fl,t)}function Jp(){Yr(fl),Yr(m_),Yr(g_)}function Oj(e){yh(g_.current);var t=yh(fl.current),r=vE(t,e.type);t!==r&&($r(m_,e),$r(fl,r))}function LP(e){m_.current===e&&(Yr(fl),Yr(m_))}var ci=id(0);function m1(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var lT=[];function OP(){for(var e=0;e<lT.length;e++)lT[e]._workInProgressVersionPrimary=null;lT.length=0}var Ov=mc.ReactCurrentDispatcher,cT=mc.ReactCurrentBatchConfig,Mh=0,hi=null,ji=null,Wi=null,g1=!1,$y=!1,y_=0,w7=0;function ps(){throw Error(Vt(321))}function jP(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!La(e[r],t[r]))return!1;return!0}function zP(e,t,r,o,u,m){if(Mh=m,hi=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Ov.current=e===null||e.memoizedState===null?C7:P7,e=r(o,u),$y){m=0;do{if($y=!1,y_=0,25<=m)throw Error(Vt(301));m+=1,Wi=ji=null,t.updateQueue=null,Ov.current=M7,e=r(o,u)}while($y)}if(Ov.current=y1,t=ji!==null&&ji.next!==null,Mh=0,Wi=ji=hi=null,g1=!1,t)throw Error(Vt(300));return e}function FP(){var e=y_!==0;return y_=0,e}function cl(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Wi===null?hi.memoizedState=Wi=e:Wi=Wi.next=e,Wi}function na(){if(ji===null){var e=hi.alternate;e=e!==null?e.memoizedState:null}else e=ji.next;var t=Wi===null?hi.memoizedState:Wi.next;if(t!==null)Wi=t,ji=e;else{if(e===null)throw Error(Vt(310));ji=e,e={memoizedState:ji.memoizedState,baseState:ji.baseState,baseQueue:ji.baseQueue,queue:ji.queue,next:null},Wi===null?hi.memoizedState=Wi=e:Wi=Wi.next=e}return Wi}function __(e,t){return typeof t=="function"?t(e):t}function uT(e){var t=na(),r=t.queue;if(r===null)throw Error(Vt(311));r.lastRenderedReducer=e;var o=ji,u=o.baseQueue,m=r.pending;if(m!==null){if(u!==null){var _=u.next;u.next=m.next,m.next=_}o.baseQueue=u=m,r.pending=null}if(u!==null){m=u.next,o=o.baseState;var b=_=null,s=null,k=m;do{var O=k.lane;if((Mh&O)===O)s!==null&&(s=s.next={lane:0,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null}),o=k.hasEagerState?k.eagerState:e(o,k.action);else{var F={lane:O,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null};s===null?(b=s=F,_=o):s=s.next=F,hi.lanes|=O,Ah|=O}k=k.next}while(k!==null&&k!==m);s===null?_=o:s.next=b,La(o,t.memoizedState)||(Zs=!0),t.memoizedState=o,t.baseState=_,t.baseQueue=s,r.lastRenderedState=o}if(e=r.interleaved,e!==null){u=e;do m=u.lane,hi.lanes|=m,Ah|=m,u=u.next;while(u!==e)}else u===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function dT(e){var t=na(),r=t.queue;if(r===null)throw Error(Vt(311));r.lastRenderedReducer=e;var o=r.dispatch,u=r.pending,m=t.memoizedState;if(u!==null){r.pending=null;var _=u=u.next;do m=e(m,_.action),_=_.next;while(_!==u);La(m,t.memoizedState)||(Zs=!0),t.memoizedState=m,t.baseQueue===null&&(t.baseState=m),r.lastRenderedState=m}return[m,o]}function jj(){}function zj(e,t){var r=hi,o=na(),u=t(),m=!La(o.memoizedState,u);if(m&&(o.memoizedState=u,Zs=!0),o=o.queue,BP(Vj.bind(null,r,o,e),[e]),o.getSnapshot!==t||m||Wi!==null&&Wi.memoizedState.tag&1){if(r.flags|=2048,x_(9,Bj.bind(null,r,o,u,t),void 0,null),Hi===null)throw Error(Vt(349));Mh&30||Fj(r,t,u)}return u}function Fj(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=hi.updateQueue,t===null?(t={lastEffect:null,stores:null},hi.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function Bj(e,t,r,o){t.value=r,t.getSnapshot=o,Uj(t)&&$j(e)}function Vj(e,t,r){return r(function(){Uj(t)&&$j(e)})}function Uj(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!La(e,r)}catch{return!0}}function $j(e){var t=oc(e,1);t!==null&&ka(t,e,1,-1)}function Hk(e){var t=cl();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:__,lastRenderedState:e},t.queue=e,e=e.dispatch=E7.bind(null,hi,e),[t.memoizedState,e]}function x_(e,t,r,o){return e={tag:e,create:t,destroy:r,deps:o,next:null},t=hi.updateQueue,t===null?(t={lastEffect:null,stores:null},hi.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(o=r.next,r.next=e,e.next=o,t.lastEffect=e)),e}function Gj(){return na().memoizedState}function jv(e,t,r,o){var u=cl();hi.flags|=e,u.memoizedState=x_(1|t,r,void 0,o===void 0?null:o)}function ib(e,t,r,o){var u=na();o=o===void 0?null:o;var m=void 0;if(ji!==null){var _=ji.memoizedState;if(m=_.destroy,o!==null&&jP(o,_.deps)){u.memoizedState=x_(t,r,m,o);return}}hi.flags|=e,u.memoizedState=x_(1|t,r,m,o)}function qk(e,t){return jv(8390656,8,e,t)}function BP(e,t){return ib(2048,8,e,t)}function Wj(e,t){return ib(4,2,e,t)}function Hj(e,t){return ib(4,4,e,t)}function qj(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Zj(e,t,r){return r=r!=null?r.concat([e]):null,ib(4,4,qj.bind(null,t,e),r)}function VP(){}function Xj(e,t){var r=na();t=t===void 0?null:t;var o=r.memoizedState;return o!==null&&t!==null&&jP(t,o[1])?o[0]:(r.memoizedState=[e,t],e)}function Yj(e,t){var r=na();t=t===void 0?null:t;var o=r.memoizedState;return o!==null&&t!==null&&jP(t,o[1])?o[0]:(e=e(),r.memoizedState=[e,t],e)}function Kj(e,t,r){return Mh&21?(La(r,t)||(r=nj(),hi.lanes|=r,Ah|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Zs=!0),e.memoizedState=r)}function S7(e,t){var r=Dr;Dr=r!==0&&4>r?r:4,e(!0);var o=cT.transition;cT.transition={};try{e(!1),t()}finally{Dr=r,cT.transition=o}}function Jj(){return na().memoizedState}function T7(e,t,r){var o=zu(e);if(r={lane:o,action:r,hasEagerState:!1,eagerState:null,next:null},Qj(e))ez(t,r);else if(r=Nj(e,t,r,o),r!==null){var u=Os();ka(r,e,o,u),tz(r,t,o)}}function E7(e,t,r){var o=zu(e),u={lane:o,action:r,hasEagerState:!1,eagerState:null,next:null};if(Qj(e))ez(t,u);else{var m=e.alternate;if(e.lanes===0&&(m===null||m.lanes===0)&&(m=t.lastRenderedReducer,m!==null))try{var _=t.lastRenderedState,b=m(_,r);if(u.hasEagerState=!0,u.eagerState=b,La(b,_)){var s=t.interleaved;s===null?(u.next=u,RP(t)):(u.next=s.next,s.next=u),t.interleaved=u;return}}catch{}finally{}r=Nj(e,t,u,o),r!==null&&(u=Os(),ka(r,e,o,u),tz(r,t,o))}}function Qj(e){var t=e.alternate;return e===hi||t!==null&&t===hi}function ez(e,t){$y=g1=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function tz(e,t,r){if(r&4194240){var o=t.lanes;o&=e.pendingLanes,r|=o,t.lanes=r,_P(e,r)}}var y1={readContext:ta,useCallback:ps,useContext:ps,useEffect:ps,useImperativeHandle:ps,useInsertionEffect:ps,useLayoutEffect:ps,useMemo:ps,useReducer:ps,useRef:ps,useState:ps,useDebugValue:ps,useDeferredValue:ps,useTransition:ps,useMutableSource:ps,useSyncExternalStore:ps,useId:ps,unstable_isNewReconciler:!1},C7={readContext:ta,useCallback:function(e,t){return cl().memoizedState=[e,t===void 0?null:t],e},useContext:ta,useEffect:qk,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,jv(4194308,4,qj.bind(null,t,e),r)},useLayoutEffect:function(e,t){return jv(4194308,4,e,t)},useInsertionEffect:function(e,t){return jv(4,2,e,t)},useMemo:function(e,t){var r=cl();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var o=cl();return t=r!==void 0?r(t):t,o.memoizedState=o.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},o.queue=e,e=e.dispatch=T7.bind(null,hi,e),[o.memoizedState,e]},useRef:function(e){var t=cl();return e={current:e},t.memoizedState=e},useState:Hk,useDebugValue:VP,useDeferredValue:function(e){return cl().memoizedState=e},useTransition:function(){var e=Hk(!1),t=e[0];return e=S7.bind(null,e[1]),cl().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var o=hi,u=cl();if(ri){if(r===void 0)throw Error(Vt(407));r=r()}else{if(r=t(),Hi===null)throw Error(Vt(349));Mh&30||Fj(o,t,r)}u.memoizedState=r;var m={value:r,getSnapshot:t};return u.queue=m,qk(Vj.bind(null,o,m,e),[e]),o.flags|=2048,x_(9,Bj.bind(null,o,m,r,t),void 0,null),r},useId:function(){var e=cl(),t=Hi.identifierPrefix;if(ri){var r=Yl,o=Xl;r=(o&~(1<<32-Ra(o)-1)).toString(32)+r,t=":"+t+"R"+r,r=y_++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=w7++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},P7={readContext:ta,useCallback:Xj,useContext:ta,useEffect:BP,useImperativeHandle:Zj,useInsertionEffect:Wj,useLayoutEffect:Hj,useMemo:Yj,useReducer:uT,useRef:Gj,useState:function(){return uT(__)},useDebugValue:VP,useDeferredValue:function(e){var t=na();return Kj(t,ji.memoizedState,e)},useTransition:function(){var e=uT(__)[0],t=na().memoizedState;return[e,t]},useMutableSource:jj,useSyncExternalStore:zj,useId:Jj,unstable_isNewReconciler:!1},M7={readContext:ta,useCallback:Xj,useContext:ta,useEffect:BP,useImperativeHandle:Zj,useInsertionEffect:Wj,useLayoutEffect:Hj,useMemo:Yj,useReducer:dT,useRef:Gj,useState:function(){return dT(__)},useDebugValue:VP,useDeferredValue:function(e){var t=na();return ji===null?t.memoizedState=e:Kj(t,ji.memoizedState,e)},useTransition:function(){var e=dT(__)[0],t=na().memoizedState;return[e,t]},useMutableSource:jj,useSyncExternalStore:zj,useId:Jj,unstable_isNewReconciler:!1};function Ma(e,t){if(e&&e.defaultProps){t=pi({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function VE(e,t,r,o){t=e.memoizedState,r=r(o,t),r=r==null?t:pi({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var sb={isMounted:function(e){return(e=e._reactInternals)?Wh(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var o=Os(),u=zu(e),m=Ql(o,u);m.payload=t,r!=null&&(m.callback=r),t=Ou(e,m,u),t!==null&&(ka(t,e,u,o),Lv(t,e,u))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var o=Os(),u=zu(e),m=Ql(o,u);m.tag=1,m.payload=t,r!=null&&(m.callback=r),t=Ou(e,m,u),t!==null&&(ka(t,e,u,o),Lv(t,e,u))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Os(),o=zu(e),u=Ql(r,o);u.tag=2,t!=null&&(u.callback=t),t=Ou(e,u,o),t!==null&&(ka(t,e,o,r),Lv(t,e,o))}};function Zk(e,t,r,o,u,m,_){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(o,m,_):t.prototype&&t.prototype.isPureReactComponent?!d_(r,o)||!d_(u,m):!0}function nz(e,t,r){var o=!1,u=Uu,m=t.contextType;return typeof m=="object"&&m!==null?m=ta(m):(u=Ks(t)?Ch:bs.current,o=t.contextTypes,m=(o=o!=null)?Xp(e,u):Uu),t=new t(r,m),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=sb,e.stateNode=t,t._reactInternals=e,o&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=u,e.__reactInternalMemoizedMaskedChildContext=m),t}function Xk(e,t,r,o){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,o),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,o),t.state!==e&&sb.enqueueReplaceState(t,t.state,null)}function UE(e,t,r,o){var u=e.stateNode;u.props=r,u.state=e.memoizedState,u.refs={},kP(e);var m=t.contextType;typeof m=="object"&&m!==null?u.context=ta(m):(m=Ks(t)?Ch:bs.current,u.context=Xp(e,m)),u.state=e.memoizedState,m=t.getDerivedStateFromProps,typeof m=="function"&&(VE(e,t,m,r),u.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof u.getSnapshotBeforeUpdate=="function"||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(t=u.state,typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount(),t!==u.state&&sb.enqueueReplaceState(u,u.state,null),p1(e,r,u,o),u.state=e.memoizedState),typeof u.componentDidMount=="function"&&(e.flags|=4194308)}function Qp(e,t){try{var r="",o=t;do r+=nG(o),o=o.return;while(o);var u=r}catch(m){u=`
Error generating stack: `+m.message+`
`+m.stack}return{value:e,source:t,stack:u,digest:null}}function hT(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function $E(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var A7=typeof WeakMap=="function"?WeakMap:Map;function rz(e,t,r){r=Ql(-1,r),r.tag=3,r.payload={element:null};var o=t.value;return r.callback=function(){x1||(x1=!0,QE=o),$E(e,t)},r}function iz(e,t,r){r=Ql(-1,r),r.tag=3;var o=e.type.getDerivedStateFromError;if(typeof o=="function"){var u=t.value;r.payload=function(){return o(u)},r.callback=function(){$E(e,t)}}var m=e.stateNode;return m!==null&&typeof m.componentDidCatch=="function"&&(r.callback=function(){$E(e,t),typeof o!="function"&&(ju===null?ju=new Set([this]):ju.add(this));var _=t.stack;this.componentDidCatch(t.value,{componentStack:_!==null?_:""})}),r}function Yk(e,t,r){var o=e.pingCache;if(o===null){o=e.pingCache=new A7;var u=new Set;o.set(t,u)}else u=o.get(t),u===void 0&&(u=new Set,o.set(t,u));u.has(r)||(u.add(r),e=$7.bind(null,e,t,r),t.then(e,e))}function Kk(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Jk(e,t,r,o,u){return e.mode&1?(e.flags|=65536,e.lanes=u,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Ql(-1,1),t.tag=2,Ou(r,t,1))),r.lanes|=1),e)}var I7=mc.ReactCurrentOwner,Zs=!1;function ks(e,t,r,o){t.child=e===null?kj(t,null,r,o):Kp(t,e.child,r,o)}function Qk(e,t,r,o,u){r=r.render;var m=t.ref;return Up(t,u),o=zP(e,t,r,o,m,u),r=FP(),e!==null&&!Zs?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~u,ac(e,t,u)):(ri&&r&&CP(t),t.flags|=1,ks(e,t,o,u),t.child)}function eN(e,t,r,o,u){if(e===null){var m=r.type;return typeof m=="function"&&!XP(m)&&m.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=m,sz(e,t,m,o,u)):(e=Vv(r.type,null,o,t,t.mode,u),e.ref=t.ref,e.return=t,t.child=e)}if(m=e.child,!(e.lanes&u)){var _=m.memoizedProps;if(r=r.compare,r=r!==null?r:d_,r(_,o)&&e.ref===t.ref)return ac(e,t,u)}return t.flags|=1,e=Fu(m,o),e.ref=t.ref,e.return=t,t.child=e}function sz(e,t,r,o,u){if(e!==null){var m=e.memoizedProps;if(d_(m,o)&&e.ref===t.ref)if(Zs=!1,t.pendingProps=o=m,(e.lanes&u)!==0)e.flags&131072&&(Zs=!0);else return t.lanes=e.lanes,ac(e,t,u)}return GE(e,t,r,o,u)}function oz(e,t,r){var o=t.pendingProps,u=o.children,m=e!==null?e.memoizedState:null;if(o.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},$r(Rp,yo),yo|=r;else{if(!(r&1073741824))return e=m!==null?m.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,$r(Rp,yo),yo|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},o=m!==null?m.baseLanes:r,$r(Rp,yo),yo|=o}else m!==null?(o=m.baseLanes|r,t.memoizedState=null):o=r,$r(Rp,yo),yo|=o;return ks(e,t,u,r),t.child}function az(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function GE(e,t,r,o,u){var m=Ks(r)?Ch:bs.current;return m=Xp(t,m),Up(t,u),r=zP(e,t,r,o,m,u),o=FP(),e!==null&&!Zs?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~u,ac(e,t,u)):(ri&&o&&CP(t),t.flags|=1,ks(e,t,r,u),t.child)}function tN(e,t,r,o,u){if(Ks(r)){var m=!0;c1(t)}else m=!1;if(Up(t,u),t.stateNode===null)zv(e,t),nz(t,r,o),UE(t,r,o,u),o=!0;else if(e===null){var _=t.stateNode,b=t.memoizedProps;_.props=b;var s=_.context,k=r.contextType;typeof k=="object"&&k!==null?k=ta(k):(k=Ks(r)?Ch:bs.current,k=Xp(t,k));var O=r.getDerivedStateFromProps,F=typeof O=="function"||typeof _.getSnapshotBeforeUpdate=="function";F||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(b!==o||s!==k)&&Xk(t,_,o,k),Cu=!1;var q=t.memoizedState;_.state=q,p1(t,o,_,u),s=t.memoizedState,b!==o||q!==s||Ys.current||Cu?(typeof O=="function"&&(VE(t,r,O,o),s=t.memoizedState),(b=Cu||Zk(t,r,b,o,q,s,k))?(F||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(t.flags|=4194308)):(typeof _.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=o,t.memoizedState=s),_.props=o,_.state=s,_.context=k,o=b):(typeof _.componentDidMount=="function"&&(t.flags|=4194308),o=!1)}else{_=t.stateNode,Lj(e,t),b=t.memoizedProps,k=t.type===t.elementType?b:Ma(t.type,b),_.props=k,F=t.pendingProps,q=_.context,s=r.contextType,typeof s=="object"&&s!==null?s=ta(s):(s=Ks(r)?Ch:bs.current,s=Xp(t,s));var H=r.getDerivedStateFromProps;(O=typeof H=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(b!==F||q!==s)&&Xk(t,_,o,s),Cu=!1,q=t.memoizedState,_.state=q,p1(t,o,_,u);var J=t.memoizedState;b!==F||q!==J||Ys.current||Cu?(typeof H=="function"&&(VE(t,r,H,o),J=t.memoizedState),(k=Cu||Zk(t,r,k,o,q,J,s)||!1)?(O||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(o,J,s),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(o,J,s)),typeof _.componentDidUpdate=="function"&&(t.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof _.componentDidUpdate!="function"||b===e.memoizedProps&&q===e.memoizedState||(t.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||b===e.memoizedProps&&q===e.memoizedState||(t.flags|=1024),t.memoizedProps=o,t.memoizedState=J),_.props=o,_.state=J,_.context=s,o=k):(typeof _.componentDidUpdate!="function"||b===e.memoizedProps&&q===e.memoizedState||(t.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||b===e.memoizedProps&&q===e.memoizedState||(t.flags|=1024),o=!1)}return WE(e,t,r,o,m,u)}function WE(e,t,r,o,u,m){az(e,t);var _=(t.flags&128)!==0;if(!o&&!_)return u&&Bk(t,r,!1),ac(e,t,m);o=t.stateNode,I7.current=t;var b=_&&typeof r.getDerivedStateFromError!="function"?null:o.render();return t.flags|=1,e!==null&&_?(t.child=Kp(t,e.child,null,m),t.child=Kp(t,null,b,m)):ks(e,t,b,m),t.memoizedState=o.state,u&&Bk(t,r,!0),t.child}function lz(e){var t=e.stateNode;t.pendingContext?Fk(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Fk(e,t.context,!1),NP(e,t.containerInfo)}function nN(e,t,r,o,u){return Yp(),MP(u),t.flags|=256,ks(e,t,r,o),t.child}var HE={dehydrated:null,treeContext:null,retryLane:0};function qE(e){return{baseLanes:e,cachePool:null,transitions:null}}function cz(e,t,r){var o=t.pendingProps,u=ci.current,m=!1,_=(t.flags&128)!==0,b;if((b=_)||(b=e!==null&&e.memoizedState===null?!1:(u&2)!==0),b?(m=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(u|=1),$r(ci,u&1),e===null)return FE(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(_=o.children,e=o.fallback,m?(o=t.mode,m=t.child,_={mode:"hidden",children:_},!(o&1)&&m!==null?(m.childLanes=0,m.pendingProps=_):m=lb(_,o,0,null),e=bh(e,o,r,null),m.return=t,e.return=t,m.sibling=e,t.child=m,t.child.memoizedState=qE(r),t.memoizedState=HE,e):UP(t,_));if(u=e.memoizedState,u!==null&&(b=u.dehydrated,b!==null))return D7(e,t,_,o,b,u,r);if(m){m=o.fallback,_=t.mode,u=e.child,b=u.sibling;var s={mode:"hidden",children:o.children};return!(_&1)&&t.child!==u?(o=t.child,o.childLanes=0,o.pendingProps=s,t.deletions=null):(o=Fu(u,s),o.subtreeFlags=u.subtreeFlags&14680064),b!==null?m=Fu(b,m):(m=bh(m,_,r,null),m.flags|=2),m.return=t,o.return=t,o.sibling=m,t.child=o,o=m,m=t.child,_=e.child.memoizedState,_=_===null?qE(r):{baseLanes:_.baseLanes|r,cachePool:null,transitions:_.transitions},m.memoizedState=_,m.childLanes=e.childLanes&~r,t.memoizedState=HE,o}return m=e.child,e=m.sibling,o=Fu(m,{mode:"visible",children:o.children}),!(t.mode&1)&&(o.lanes=r),o.return=t,o.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=o,t.memoizedState=null,o}function UP(e,t){return t=lb({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function av(e,t,r,o){return o!==null&&MP(o),Kp(t,e.child,null,r),e=UP(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function D7(e,t,r,o,u,m,_){if(r)return t.flags&256?(t.flags&=-257,o=hT(Error(Vt(422))),av(e,t,_,o)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(m=o.fallback,u=t.mode,o=lb({mode:"visible",children:o.children},u,0,null),m=bh(m,u,_,null),m.flags|=2,o.return=t,m.return=t,o.sibling=m,t.child=o,t.mode&1&&Kp(t,e.child,null,_),t.child.memoizedState=qE(_),t.memoizedState=HE,m);if(!(t.mode&1))return av(e,t,_,null);if(u.data==="$!"){if(o=u.nextSibling&&u.nextSibling.dataset,o)var b=o.dgst;return o=b,m=Error(Vt(419)),o=hT(m,o,void 0),av(e,t,_,o)}if(b=(_&e.childLanes)!==0,Zs||b){if(o=Hi,o!==null){switch(_&-_){case 4:u=2;break;case 16:u=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:u=32;break;case 536870912:u=268435456;break;default:u=0}u=u&(o.suspendedLanes|_)?0:u,u!==0&&u!==m.retryLane&&(m.retryLane=u,oc(e,u),ka(o,e,u,-1))}return ZP(),o=hT(Error(Vt(421))),av(e,t,_,o)}return u.data==="$?"?(t.flags|=128,t.child=e.child,t=G7.bind(null,e),u._reactRetry=t,null):(e=m.treeContext,xo=Lu(u.nextSibling),wo=t,ri=!0,Ia=null,e!==null&&(Yo[Ko++]=Xl,Yo[Ko++]=Yl,Yo[Ko++]=Ph,Xl=e.id,Yl=e.overflow,Ph=t),t=UP(t,o.children),t.flags|=4096,t)}function rN(e,t,r){e.lanes|=t;var o=e.alternate;o!==null&&(o.lanes|=t),BE(e.return,t,r)}function fT(e,t,r,o,u){var m=e.memoizedState;m===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:o,tail:r,tailMode:u}:(m.isBackwards=t,m.rendering=null,m.renderingStartTime=0,m.last=o,m.tail=r,m.tailMode=u)}function uz(e,t,r){var o=t.pendingProps,u=o.revealOrder,m=o.tail;if(ks(e,t,o.children,r),o=ci.current,o&2)o=o&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&rN(e,r,t);else if(e.tag===19)rN(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}o&=1}if($r(ci,o),!(t.mode&1))t.memoizedState=null;else switch(u){case"forwards":for(r=t.child,u=null;r!==null;)e=r.alternate,e!==null&&m1(e)===null&&(u=r),r=r.sibling;r=u,r===null?(u=t.child,t.child=null):(u=r.sibling,r.sibling=null),fT(t,!1,u,r,m);break;case"backwards":for(r=null,u=t.child,t.child=null;u!==null;){if(e=u.alternate,e!==null&&m1(e)===null){t.child=u;break}e=u.sibling,u.sibling=r,r=u,u=e}fT(t,!0,r,null,m);break;case"together":fT(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function zv(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function ac(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Ah|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Vt(153));if(t.child!==null){for(e=t.child,r=Fu(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Fu(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function R7(e,t,r){switch(t.tag){case 3:lz(t),Yp();break;case 5:Oj(t);break;case 1:Ks(t.type)&&c1(t);break;case 4:NP(t,t.stateNode.containerInfo);break;case 10:var o=t.type._context,u=t.memoizedProps.value;$r(h1,o._currentValue),o._currentValue=u;break;case 13:if(o=t.memoizedState,o!==null)return o.dehydrated!==null?($r(ci,ci.current&1),t.flags|=128,null):r&t.child.childLanes?cz(e,t,r):($r(ci,ci.current&1),e=ac(e,t,r),e!==null?e.sibling:null);$r(ci,ci.current&1);break;case 19:if(o=(r&t.childLanes)!==0,e.flags&128){if(o)return uz(e,t,r);t.flags|=128}if(u=t.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),$r(ci,ci.current),o)break;return null;case 22:case 23:return t.lanes=0,oz(e,t,r)}return ac(e,t,r)}var dz,ZE,hz,fz;dz=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};ZE=function(){};hz=function(e,t,r,o){var u=e.memoizedProps;if(u!==o){e=t.stateNode,yh(fl.current);var m=null;switch(r){case"input":u=gE(e,u),o=gE(e,o),m=[];break;case"select":u=pi({},u,{value:void 0}),o=pi({},o,{value:void 0}),m=[];break;case"textarea":u=xE(e,u),o=xE(e,o),m=[];break;default:typeof u.onClick!="function"&&typeof o.onClick=="function"&&(e.onclick=a1)}bE(r,o);var _;r=null;for(k in u)if(!o.hasOwnProperty(k)&&u.hasOwnProperty(k)&&u[k]!=null)if(k==="style"){var b=u[k];for(_ in b)b.hasOwnProperty(_)&&(r||(r={}),r[_]="")}else k!=="dangerouslySetInnerHTML"&&k!=="children"&&k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&k!=="autoFocus"&&(i_.hasOwnProperty(k)?m||(m=[]):(m=m||[]).push(k,null));for(k in o){var s=o[k];if(b=u!=null?u[k]:void 0,o.hasOwnProperty(k)&&s!==b&&(s!=null||b!=null))if(k==="style")if(b){for(_ in b)!b.hasOwnProperty(_)||s&&s.hasOwnProperty(_)||(r||(r={}),r[_]="");for(_ in s)s.hasOwnProperty(_)&&b[_]!==s[_]&&(r||(r={}),r[_]=s[_])}else r||(m||(m=[]),m.push(k,r)),r=s;else k==="dangerouslySetInnerHTML"?(s=s?s.__html:void 0,b=b?b.__html:void 0,s!=null&&b!==s&&(m=m||[]).push(k,s)):k==="children"?typeof s!="string"&&typeof s!="number"||(m=m||[]).push(k,""+s):k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&(i_.hasOwnProperty(k)?(s!=null&&k==="onScroll"&&Xr("scroll",e),m||b===s||(m=[])):(m=m||[]).push(k,s))}r&&(m=m||[]).push("style",r);var k=m;(t.updateQueue=k)&&(t.flags|=4)}};fz=function(e,t,r,o){r!==o&&(t.flags|=4)};function yy(e,t){if(!ri)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var o=null;r!==null;)r.alternate!==null&&(o=r),r=r.sibling;o===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:o.sibling=null}}function ms(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,o=0;if(t)for(var u=e.child;u!==null;)r|=u.lanes|u.childLanes,o|=u.subtreeFlags&14680064,o|=u.flags&14680064,u.return=e,u=u.sibling;else for(u=e.child;u!==null;)r|=u.lanes|u.childLanes,o|=u.subtreeFlags,o|=u.flags,u.return=e,u=u.sibling;return e.subtreeFlags|=o,e.childLanes=r,t}function k7(e,t,r){var o=t.pendingProps;switch(PP(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ms(t),null;case 1:return Ks(t.type)&&l1(),ms(t),null;case 3:return o=t.stateNode,Jp(),Yr(Ys),Yr(bs),OP(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(e===null||e.child===null)&&(sv(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Ia!==null&&(nC(Ia),Ia=null))),ZE(e,t),ms(t),null;case 5:LP(t);var u=yh(g_.current);if(r=t.type,e!==null&&t.stateNode!=null)hz(e,t,r,o,u),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!o){if(t.stateNode===null)throw Error(Vt(166));return ms(t),null}if(e=yh(fl.current),sv(t)){o=t.stateNode,r=t.type;var m=t.memoizedProps;switch(o[ul]=t,o[p_]=m,e=(t.mode&1)!==0,r){case"dialog":Xr("cancel",o),Xr("close",o);break;case"iframe":case"object":case"embed":Xr("load",o);break;case"video":case"audio":for(u=0;u<Iy.length;u++)Xr(Iy[u],o);break;case"source":Xr("error",o);break;case"img":case"image":case"link":Xr("error",o),Xr("load",o);break;case"details":Xr("toggle",o);break;case"input":hk(o,m),Xr("invalid",o);break;case"select":o._wrapperState={wasMultiple:!!m.multiple},Xr("invalid",o);break;case"textarea":pk(o,m),Xr("invalid",o)}bE(r,m),u=null;for(var _ in m)if(m.hasOwnProperty(_)){var b=m[_];_==="children"?typeof b=="string"?o.textContent!==b&&(m.suppressHydrationWarning!==!0&&iv(o.textContent,b,e),u=["children",b]):typeof b=="number"&&o.textContent!==""+b&&(m.suppressHydrationWarning!==!0&&iv(o.textContent,b,e),u=["children",""+b]):i_.hasOwnProperty(_)&&b!=null&&_==="onScroll"&&Xr("scroll",o)}switch(r){case"input":Y0(o),fk(o,m,!0);break;case"textarea":Y0(o),mk(o);break;case"select":case"option":break;default:typeof m.onClick=="function"&&(o.onclick=a1)}o=u,t.updateQueue=o,o!==null&&(t.flags|=4)}else{_=u.nodeType===9?u:u.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=V4(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=_.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof o.is=="string"?e=_.createElement(r,{is:o.is}):(e=_.createElement(r),r==="select"&&(_=e,o.multiple?_.multiple=!0:o.size&&(_.size=o.size))):e=_.createElementNS(e,r),e[ul]=t,e[p_]=o,dz(e,t,!1,!1),t.stateNode=e;e:{switch(_=wE(r,o),r){case"dialog":Xr("cancel",e),Xr("close",e),u=o;break;case"iframe":case"object":case"embed":Xr("load",e),u=o;break;case"video":case"audio":for(u=0;u<Iy.length;u++)Xr(Iy[u],e);u=o;break;case"source":Xr("error",e),u=o;break;case"img":case"image":case"link":Xr("error",e),Xr("load",e),u=o;break;case"details":Xr("toggle",e),u=o;break;case"input":hk(e,o),u=gE(e,o),Xr("invalid",e);break;case"option":u=o;break;case"select":e._wrapperState={wasMultiple:!!o.multiple},u=pi({},o,{value:void 0}),Xr("invalid",e);break;case"textarea":pk(e,o),u=xE(e,o),Xr("invalid",e);break;default:u=o}bE(r,u),b=u;for(m in b)if(b.hasOwnProperty(m)){var s=b[m];m==="style"?G4(e,s):m==="dangerouslySetInnerHTML"?(s=s?s.__html:void 0,s!=null&&U4(e,s)):m==="children"?typeof s=="string"?(r!=="textarea"||s!=="")&&s_(e,s):typeof s=="number"&&s_(e,""+s):m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&m!=="autoFocus"&&(i_.hasOwnProperty(m)?s!=null&&m==="onScroll"&&Xr("scroll",e):s!=null&&hP(e,m,s,_))}switch(r){case"input":Y0(e),fk(e,o,!1);break;case"textarea":Y0(e),mk(e);break;case"option":o.value!=null&&e.setAttribute("value",""+Vu(o.value));break;case"select":e.multiple=!!o.multiple,m=o.value,m!=null?zp(e,!!o.multiple,m,!1):o.defaultValue!=null&&zp(e,!!o.multiple,o.defaultValue,!0);break;default:typeof u.onClick=="function"&&(e.onclick=a1)}switch(r){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break e;case"img":o=!0;break e;default:o=!1}}o&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return ms(t),null;case 6:if(e&&t.stateNode!=null)fz(e,t,e.memoizedProps,o);else{if(typeof o!="string"&&t.stateNode===null)throw Error(Vt(166));if(r=yh(g_.current),yh(fl.current),sv(t)){if(o=t.stateNode,r=t.memoizedProps,o[ul]=t,(m=o.nodeValue!==r)&&(e=wo,e!==null))switch(e.tag){case 3:iv(o.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&iv(o.nodeValue,r,(e.mode&1)!==0)}m&&(t.flags|=4)}else o=(r.nodeType===9?r:r.ownerDocument).createTextNode(o),o[ul]=t,t.stateNode=o}return ms(t),null;case 13:if(Yr(ci),o=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(ri&&xo!==null&&t.mode&1&&!(t.flags&128))Dj(),Yp(),t.flags|=98560,m=!1;else if(m=sv(t),o!==null&&o.dehydrated!==null){if(e===null){if(!m)throw Error(Vt(318));if(m=t.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(Vt(317));m[ul]=t}else Yp(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;ms(t),m=!1}else Ia!==null&&(nC(Ia),Ia=null),m=!0;if(!m)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(o=o!==null,o!==(e!==null&&e.memoizedState!==null)&&o&&(t.child.flags|=8192,t.mode&1&&(e===null||ci.current&1?zi===0&&(zi=3):ZP())),t.updateQueue!==null&&(t.flags|=4),ms(t),null);case 4:return Jp(),ZE(e,t),e===null&&h_(t.stateNode.containerInfo),ms(t),null;case 10:return DP(t.type._context),ms(t),null;case 17:return Ks(t.type)&&l1(),ms(t),null;case 19:if(Yr(ci),m=t.memoizedState,m===null)return ms(t),null;if(o=(t.flags&128)!==0,_=m.rendering,_===null)if(o)yy(m,!1);else{if(zi!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(_=m1(e),_!==null){for(t.flags|=128,yy(m,!1),o=_.updateQueue,o!==null&&(t.updateQueue=o,t.flags|=4),t.subtreeFlags=0,o=r,r=t.child;r!==null;)m=r,e=o,m.flags&=14680066,_=m.alternate,_===null?(m.childLanes=0,m.lanes=e,m.child=null,m.subtreeFlags=0,m.memoizedProps=null,m.memoizedState=null,m.updateQueue=null,m.dependencies=null,m.stateNode=null):(m.childLanes=_.childLanes,m.lanes=_.lanes,m.child=_.child,m.subtreeFlags=0,m.deletions=null,m.memoizedProps=_.memoizedProps,m.memoizedState=_.memoizedState,m.updateQueue=_.updateQueue,m.type=_.type,e=_.dependencies,m.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return $r(ci,ci.current&1|2),t.child}e=e.sibling}m.tail!==null&&Ti()>em&&(t.flags|=128,o=!0,yy(m,!1),t.lanes=4194304)}else{if(!o)if(e=m1(_),e!==null){if(t.flags|=128,o=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),yy(m,!0),m.tail===null&&m.tailMode==="hidden"&&!_.alternate&&!ri)return ms(t),null}else 2*Ti()-m.renderingStartTime>em&&r!==1073741824&&(t.flags|=128,o=!0,yy(m,!1),t.lanes=4194304);m.isBackwards?(_.sibling=t.child,t.child=_):(r=m.last,r!==null?r.sibling=_:t.child=_,m.last=_)}return m.tail!==null?(t=m.tail,m.rendering=t,m.tail=t.sibling,m.renderingStartTime=Ti(),t.sibling=null,r=ci.current,$r(ci,o?r&1|2:r&1),t):(ms(t),null);case 22:case 23:return qP(),o=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==o&&(t.flags|=8192),o&&t.mode&1?yo&1073741824&&(ms(t),t.subtreeFlags&6&&(t.flags|=8192)):ms(t),null;case 24:return null;case 25:return null}throw Error(Vt(156,t.tag))}function N7(e,t){switch(PP(t),t.tag){case 1:return Ks(t.type)&&l1(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Jp(),Yr(Ys),Yr(bs),OP(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return LP(t),null;case 13:if(Yr(ci),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Vt(340));Yp()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Yr(ci),null;case 4:return Jp(),null;case 10:return DP(t.type._context),null;case 22:case 23:return qP(),null;case 24:return null;default:return null}}var lv=!1,ys=!1,L7=typeof WeakSet=="function"?WeakSet:Set,cn=null;function Dp(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(o){yi(e,t,o)}else r.current=null}function XE(e,t,r){try{r()}catch(o){yi(e,t,o)}}var iN=!1;function O7(e,t){if(RE=i1,e=_j(),EP(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var o=r.getSelection&&r.getSelection();if(o&&o.rangeCount!==0){r=o.anchorNode;var u=o.anchorOffset,m=o.focusNode;o=o.focusOffset;try{r.nodeType,m.nodeType}catch{r=null;break e}var _=0,b=-1,s=-1,k=0,O=0,F=e,q=null;t:for(;;){for(var H;F!==r||u!==0&&F.nodeType!==3||(b=_+u),F!==m||o!==0&&F.nodeType!==3||(s=_+o),F.nodeType===3&&(_+=F.nodeValue.length),(H=F.firstChild)!==null;)q=F,F=H;for(;;){if(F===e)break t;if(q===r&&++k===u&&(b=_),q===m&&++O===o&&(s=_),(H=F.nextSibling)!==null)break;F=q,q=F.parentNode}F=H}r=b===-1||s===-1?null:{start:b,end:s}}else r=null}r=r||{start:0,end:0}}else r=null;for(kE={focusedElem:e,selectionRange:r},i1=!1,cn=t;cn!==null;)if(t=cn,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,cn=e;else for(;cn!==null;){t=cn;try{var J=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(J!==null){var U=J.memoizedProps,te=J.memoizedState,Q=t.stateNode,ee=Q.getSnapshotBeforeUpdate(t.elementType===t.type?U:Ma(t.type,U),te);Q.__reactInternalSnapshotBeforeUpdate=ee}break;case 3:var re=t.stateNode.containerInfo;re.nodeType===1?re.textContent="":re.nodeType===9&&re.documentElement&&re.removeChild(re.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Vt(163))}}catch(xe){yi(t,t.return,xe)}if(e=t.sibling,e!==null){e.return=t.return,cn=e;break}cn=t.return}return J=iN,iN=!1,J}function Gy(e,t,r){var o=t.updateQueue;if(o=o!==null?o.lastEffect:null,o!==null){var u=o=o.next;do{if((u.tag&e)===e){var m=u.destroy;u.destroy=void 0,m!==void 0&&XE(t,r,m)}u=u.next}while(u!==o)}}function ob(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var o=r.create;r.destroy=o()}r=r.next}while(r!==t)}}function YE(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function pz(e){var t=e.alternate;t!==null&&(e.alternate=null,pz(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[ul],delete t[p_],delete t[OE],delete t[_7],delete t[x7])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function mz(e){return e.tag===5||e.tag===3||e.tag===4}function sN(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||mz(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function KE(e,t,r){var o=e.tag;if(o===5||o===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=a1));else if(o!==4&&(e=e.child,e!==null))for(KE(e,t,r),e=e.sibling;e!==null;)KE(e,t,r),e=e.sibling}function JE(e,t,r){var o=e.tag;if(o===5||o===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(o!==4&&(e=e.child,e!==null))for(JE(e,t,r),e=e.sibling;e!==null;)JE(e,t,r),e=e.sibling}var rs=null,Aa=!1;function _u(e,t,r){for(r=r.child;r!==null;)gz(e,t,r),r=r.sibling}function gz(e,t,r){if(hl&&typeof hl.onCommitFiberUnmount=="function")try{hl.onCommitFiberUnmount(J1,r)}catch{}switch(r.tag){case 5:ys||Dp(r,t);case 6:var o=rs,u=Aa;rs=null,_u(e,t,r),rs=o,Aa=u,rs!==null&&(Aa?(e=rs,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):rs.removeChild(r.stateNode));break;case 18:rs!==null&&(Aa?(e=rs,r=r.stateNode,e.nodeType===8?oT(e.parentNode,r):e.nodeType===1&&oT(e,r),c_(e)):oT(rs,r.stateNode));break;case 4:o=rs,u=Aa,rs=r.stateNode.containerInfo,Aa=!0,_u(e,t,r),rs=o,Aa=u;break;case 0:case 11:case 14:case 15:if(!ys&&(o=r.updateQueue,o!==null&&(o=o.lastEffect,o!==null))){u=o=o.next;do{var m=u,_=m.destroy;m=m.tag,_!==void 0&&(m&2||m&4)&&XE(r,t,_),u=u.next}while(u!==o)}_u(e,t,r);break;case 1:if(!ys&&(Dp(r,t),o=r.stateNode,typeof o.componentWillUnmount=="function"))try{o.props=r.memoizedProps,o.state=r.memoizedState,o.componentWillUnmount()}catch(b){yi(r,t,b)}_u(e,t,r);break;case 21:_u(e,t,r);break;case 22:r.mode&1?(ys=(o=ys)||r.memoizedState!==null,_u(e,t,r),ys=o):_u(e,t,r);break;default:_u(e,t,r)}}function oN(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new L7),t.forEach(function(o){var u=W7.bind(null,e,o);r.has(o)||(r.add(o),o.then(u,u))})}}function Pa(e,t){var r=t.deletions;if(r!==null)for(var o=0;o<r.length;o++){var u=r[o];try{var m=e,_=t,b=_;e:for(;b!==null;){switch(b.tag){case 5:rs=b.stateNode,Aa=!1;break e;case 3:rs=b.stateNode.containerInfo,Aa=!0;break e;case 4:rs=b.stateNode.containerInfo,Aa=!0;break e}b=b.return}if(rs===null)throw Error(Vt(160));gz(m,_,u),rs=null,Aa=!1;var s=u.alternate;s!==null&&(s.return=null),u.return=null}catch(k){yi(u,t,k)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)yz(t,e),t=t.sibling}function yz(e,t){var r=e.alternate,o=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Pa(t,e),ll(e),o&4){try{Gy(3,e,e.return),ob(3,e)}catch(U){yi(e,e.return,U)}try{Gy(5,e,e.return)}catch(U){yi(e,e.return,U)}}break;case 1:Pa(t,e),ll(e),o&512&&r!==null&&Dp(r,r.return);break;case 5:if(Pa(t,e),ll(e),o&512&&r!==null&&Dp(r,r.return),e.flags&32){var u=e.stateNode;try{s_(u,"")}catch(U){yi(e,e.return,U)}}if(o&4&&(u=e.stateNode,u!=null)){var m=e.memoizedProps,_=r!==null?r.memoizedProps:m,b=e.type,s=e.updateQueue;if(e.updateQueue=null,s!==null)try{b==="input"&&m.type==="radio"&&m.name!=null&&F4(u,m),wE(b,_);var k=wE(b,m);for(_=0;_<s.length;_+=2){var O=s[_],F=s[_+1];O==="style"?G4(u,F):O==="dangerouslySetInnerHTML"?U4(u,F):O==="children"?s_(u,F):hP(u,O,F,k)}switch(b){case"input":yE(u,m);break;case"textarea":B4(u,m);break;case"select":var q=u._wrapperState.wasMultiple;u._wrapperState.wasMultiple=!!m.multiple;var H=m.value;H!=null?zp(u,!!m.multiple,H,!1):q!==!!m.multiple&&(m.defaultValue!=null?zp(u,!!m.multiple,m.defaultValue,!0):zp(u,!!m.multiple,m.multiple?[]:"",!1))}u[p_]=m}catch(U){yi(e,e.return,U)}}break;case 6:if(Pa(t,e),ll(e),o&4){if(e.stateNode===null)throw Error(Vt(162));u=e.stateNode,m=e.memoizedProps;try{u.nodeValue=m}catch(U){yi(e,e.return,U)}}break;case 3:if(Pa(t,e),ll(e),o&4&&r!==null&&r.memoizedState.isDehydrated)try{c_(t.containerInfo)}catch(U){yi(e,e.return,U)}break;case 4:Pa(t,e),ll(e);break;case 13:Pa(t,e),ll(e),u=e.child,u.flags&8192&&(m=u.memoizedState!==null,u.stateNode.isHidden=m,!m||u.alternate!==null&&u.alternate.memoizedState!==null||(WP=Ti())),o&4&&oN(e);break;case 22:if(O=r!==null&&r.memoizedState!==null,e.mode&1?(ys=(k=ys)||O,Pa(t,e),ys=k):Pa(t,e),ll(e),o&8192){if(k=e.memoizedState!==null,(e.stateNode.isHidden=k)&&!O&&e.mode&1)for(cn=e,O=e.child;O!==null;){for(F=cn=O;cn!==null;){switch(q=cn,H=q.child,q.tag){case 0:case 11:case 14:case 15:Gy(4,q,q.return);break;case 1:Dp(q,q.return);var J=q.stateNode;if(typeof J.componentWillUnmount=="function"){o=q,r=q.return;try{t=o,J.props=t.memoizedProps,J.state=t.memoizedState,J.componentWillUnmount()}catch(U){yi(o,r,U)}}break;case 5:Dp(q,q.return);break;case 22:if(q.memoizedState!==null){lN(F);continue}}H!==null?(H.return=q,cn=H):lN(F)}O=O.sibling}e:for(O=null,F=e;;){if(F.tag===5){if(O===null){O=F;try{u=F.stateNode,k?(m=u.style,typeof m.setProperty=="function"?m.setProperty("display","none","important"):m.display="none"):(b=F.stateNode,s=F.memoizedProps.style,_=s!=null&&s.hasOwnProperty("display")?s.display:null,b.style.display=$4("display",_))}catch(U){yi(e,e.return,U)}}}else if(F.tag===6){if(O===null)try{F.stateNode.nodeValue=k?"":F.memoizedProps}catch(U){yi(e,e.return,U)}}else if((F.tag!==22&&F.tag!==23||F.memoizedState===null||F===e)&&F.child!==null){F.child.return=F,F=F.child;continue}if(F===e)break e;for(;F.sibling===null;){if(F.return===null||F.return===e)break e;O===F&&(O=null),F=F.return}O===F&&(O=null),F.sibling.return=F.return,F=F.sibling}}break;case 19:Pa(t,e),ll(e),o&4&&oN(e);break;case 21:break;default:Pa(t,e),ll(e)}}function ll(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(mz(r)){var o=r;break e}r=r.return}throw Error(Vt(160))}switch(o.tag){case 5:var u=o.stateNode;o.flags&32&&(s_(u,""),o.flags&=-33);var m=sN(e);JE(e,m,u);break;case 3:case 4:var _=o.stateNode.containerInfo,b=sN(e);KE(e,b,_);break;default:throw Error(Vt(161))}}catch(s){yi(e,e.return,s)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function j7(e,t,r){cn=e,_z(e)}function _z(e,t,r){for(var o=(e.mode&1)!==0;cn!==null;){var u=cn,m=u.child;if(u.tag===22&&o){var _=u.memoizedState!==null||lv;if(!_){var b=u.alternate,s=b!==null&&b.memoizedState!==null||ys;b=lv;var k=ys;if(lv=_,(ys=s)&&!k)for(cn=u;cn!==null;)_=cn,s=_.child,_.tag===22&&_.memoizedState!==null?cN(u):s!==null?(s.return=_,cn=s):cN(u);for(;m!==null;)cn=m,_z(m),m=m.sibling;cn=u,lv=b,ys=k}aN(e)}else u.subtreeFlags&8772&&m!==null?(m.return=u,cn=m):aN(e)}}function aN(e){for(;cn!==null;){var t=cn;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:ys||ob(5,t);break;case 1:var o=t.stateNode;if(t.flags&4&&!ys)if(r===null)o.componentDidMount();else{var u=t.elementType===t.type?r.memoizedProps:Ma(t.type,r.memoizedProps);o.componentDidUpdate(u,r.memoizedState,o.__reactInternalSnapshotBeforeUpdate)}var m=t.updateQueue;m!==null&&Wk(t,m,o);break;case 3:var _=t.updateQueue;if(_!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}Wk(t,_,r)}break;case 5:var b=t.stateNode;if(r===null&&t.flags&4){r=b;var s=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":s.autoFocus&&r.focus();break;case"img":s.src&&(r.src=s.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var k=t.alternate;if(k!==null){var O=k.memoizedState;if(O!==null){var F=O.dehydrated;F!==null&&c_(F)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Vt(163))}ys||t.flags&512&&YE(t)}catch(q){yi(t,t.return,q)}}if(t===e){cn=null;break}if(r=t.sibling,r!==null){r.return=t.return,cn=r;break}cn=t.return}}function lN(e){for(;cn!==null;){var t=cn;if(t===e){cn=null;break}var r=t.sibling;if(r!==null){r.return=t.return,cn=r;break}cn=t.return}}function cN(e){for(;cn!==null;){var t=cn;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{ob(4,t)}catch(s){yi(t,r,s)}break;case 1:var o=t.stateNode;if(typeof o.componentDidMount=="function"){var u=t.return;try{o.componentDidMount()}catch(s){yi(t,u,s)}}var m=t.return;try{YE(t)}catch(s){yi(t,m,s)}break;case 5:var _=t.return;try{YE(t)}catch(s){yi(t,_,s)}}}catch(s){yi(t,t.return,s)}if(t===e){cn=null;break}var b=t.sibling;if(b!==null){b.return=t.return,cn=b;break}cn=t.return}}var z7=Math.ceil,_1=mc.ReactCurrentDispatcher,$P=mc.ReactCurrentOwner,ea=mc.ReactCurrentBatchConfig,br=0,Hi=null,ki=null,ss=0,yo=0,Rp=id(0),zi=0,v_=null,Ah=0,ab=0,GP=0,Wy=null,qs=null,WP=0,em=1/0,Hl=null,x1=!1,QE=null,ju=null,cv=!1,Iu=null,v1=0,Hy=0,eC=null,Fv=-1,Bv=0;function Os(){return br&6?Ti():Fv!==-1?Fv:Fv=Ti()}function zu(e){return e.mode&1?br&2&&ss!==0?ss&-ss:b7.transition!==null?(Bv===0&&(Bv=nj()),Bv):(e=Dr,e!==0||(e=window.event,e=e===void 0?16:cj(e.type)),e):1}function ka(e,t,r,o){if(50<Hy)throw Hy=0,eC=null,Error(Vt(185));F_(e,r,o),(!(br&2)||e!==Hi)&&(e===Hi&&(!(br&2)&&(ab|=r),zi===4&&Mu(e,ss)),Js(e,o),r===1&&br===0&&!(t.mode&1)&&(em=Ti()+500,rb&&sd()))}function Js(e,t){var r=e.callbackNode;bG(e,t);var o=r1(e,e===Hi?ss:0);if(o===0)r!==null&&_k(r),e.callbackNode=null,e.callbackPriority=0;else if(t=o&-o,e.callbackPriority!==t){if(r!=null&&_k(r),t===1)e.tag===0?v7(uN.bind(null,e)):Mj(uN.bind(null,e)),g7(function(){!(br&6)&&sd()}),r=null;else{switch(rj(o)){case 1:r=yP;break;case 4:r=ej;break;case 16:r=n1;break;case 536870912:r=tj;break;default:r=n1}r=Cz(r,xz.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function xz(e,t){if(Fv=-1,Bv=0,br&6)throw Error(Vt(327));var r=e.callbackNode;if($p()&&e.callbackNode!==r)return null;var o=r1(e,e===Hi?ss:0);if(o===0)return null;if(o&30||o&e.expiredLanes||t)t=b1(e,o);else{t=o;var u=br;br|=2;var m=bz();(Hi!==e||ss!==t)&&(Hl=null,em=Ti()+500,vh(e,t));do try{V7();break}catch(b){vz(e,b)}while(!0);IP(),_1.current=m,br=u,ki!==null?t=0:(Hi=null,ss=0,t=zi)}if(t!==0){if(t===2&&(u=PE(e),u!==0&&(o=u,t=tC(e,u))),t===1)throw r=v_,vh(e,0),Mu(e,o),Js(e,Ti()),r;if(t===6)Mu(e,o);else{if(u=e.current.alternate,!(o&30)&&!F7(u)&&(t=b1(e,o),t===2&&(m=PE(e),m!==0&&(o=m,t=tC(e,m))),t===1))throw r=v_,vh(e,0),Mu(e,o),Js(e,Ti()),r;switch(e.finishedWork=u,e.finishedLanes=o,t){case 0:case 1:throw Error(Vt(345));case 2:uh(e,qs,Hl);break;case 3:if(Mu(e,o),(o&130023424)===o&&(t=WP+500-Ti(),10<t)){if(r1(e,0)!==0)break;if(u=e.suspendedLanes,(u&o)!==o){Os(),e.pingedLanes|=e.suspendedLanes&u;break}e.timeoutHandle=LE(uh.bind(null,e,qs,Hl),t);break}uh(e,qs,Hl);break;case 4:if(Mu(e,o),(o&4194240)===o)break;for(t=e.eventTimes,u=-1;0<o;){var _=31-Ra(o);m=1<<_,_=t[_],_>u&&(u=_),o&=~m}if(o=u,o=Ti()-o,o=(120>o?120:480>o?480:1080>o?1080:1920>o?1920:3e3>o?3e3:4320>o?4320:1960*z7(o/1960))-o,10<o){e.timeoutHandle=LE(uh.bind(null,e,qs,Hl),o);break}uh(e,qs,Hl);break;case 5:uh(e,qs,Hl);break;default:throw Error(Vt(329))}}}return Js(e,Ti()),e.callbackNode===r?xz.bind(null,e):null}function tC(e,t){var r=Wy;return e.current.memoizedState.isDehydrated&&(vh(e,t).flags|=256),e=b1(e,t),e!==2&&(t=qs,qs=r,t!==null&&nC(t)),e}function nC(e){qs===null?qs=e:qs.push.apply(qs,e)}function F7(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var o=0;o<r.length;o++){var u=r[o],m=u.getSnapshot;u=u.value;try{if(!La(m(),u))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Mu(e,t){for(t&=~GP,t&=~ab,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Ra(t),o=1<<r;e[r]=-1,t&=~o}}function uN(e){if(br&6)throw Error(Vt(327));$p();var t=r1(e,0);if(!(t&1))return Js(e,Ti()),null;var r=b1(e,t);if(e.tag!==0&&r===2){var o=PE(e);o!==0&&(t=o,r=tC(e,o))}if(r===1)throw r=v_,vh(e,0),Mu(e,t),Js(e,Ti()),r;if(r===6)throw Error(Vt(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,uh(e,qs,Hl),Js(e,Ti()),null}function HP(e,t){var r=br;br|=1;try{return e(t)}finally{br=r,br===0&&(em=Ti()+500,rb&&sd())}}function Ih(e){Iu!==null&&Iu.tag===0&&!(br&6)&&$p();var t=br;br|=1;var r=ea.transition,o=Dr;try{if(ea.transition=null,Dr=1,e)return e()}finally{Dr=o,ea.transition=r,br=t,!(br&6)&&sd()}}function qP(){yo=Rp.current,Yr(Rp)}function vh(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,m7(r)),ki!==null)for(r=ki.return;r!==null;){var o=r;switch(PP(o),o.tag){case 1:o=o.type.childContextTypes,o!=null&&l1();break;case 3:Jp(),Yr(Ys),Yr(bs),OP();break;case 5:LP(o);break;case 4:Jp();break;case 13:Yr(ci);break;case 19:Yr(ci);break;case 10:DP(o.type._context);break;case 22:case 23:qP()}r=r.return}if(Hi=e,ki=e=Fu(e.current,null),ss=yo=t,zi=0,v_=null,GP=ab=Ah=0,qs=Wy=null,gh!==null){for(t=0;t<gh.length;t++)if(r=gh[t],o=r.interleaved,o!==null){r.interleaved=null;var u=o.next,m=r.pending;if(m!==null){var _=m.next;m.next=u,o.next=_}r.pending=o}gh=null}return e}function vz(e,t){do{var r=ki;try{if(IP(),Ov.current=y1,g1){for(var o=hi.memoizedState;o!==null;){var u=o.queue;u!==null&&(u.pending=null),o=o.next}g1=!1}if(Mh=0,Wi=ji=hi=null,$y=!1,y_=0,$P.current=null,r===null||r.return===null){zi=1,v_=t,ki=null;break}e:{var m=e,_=r.return,b=r,s=t;if(t=ss,b.flags|=32768,s!==null&&typeof s=="object"&&typeof s.then=="function"){var k=s,O=b,F=O.tag;if(!(O.mode&1)&&(F===0||F===11||F===15)){var q=O.alternate;q?(O.updateQueue=q.updateQueue,O.memoizedState=q.memoizedState,O.lanes=q.lanes):(O.updateQueue=null,O.memoizedState=null)}var H=Kk(_);if(H!==null){H.flags&=-257,Jk(H,_,b,m,t),H.mode&1&&Yk(m,k,t),t=H,s=k;var J=t.updateQueue;if(J===null){var U=new Set;U.add(s),t.updateQueue=U}else J.add(s);break e}else{if(!(t&1)){Yk(m,k,t),ZP();break e}s=Error(Vt(426))}}else if(ri&&b.mode&1){var te=Kk(_);if(te!==null){!(te.flags&65536)&&(te.flags|=256),Jk(te,_,b,m,t),MP(Qp(s,b));break e}}m=s=Qp(s,b),zi!==4&&(zi=2),Wy===null?Wy=[m]:Wy.push(m),m=_;do{switch(m.tag){case 3:m.flags|=65536,t&=-t,m.lanes|=t;var Q=rz(m,s,t);Gk(m,Q);break e;case 1:b=s;var ee=m.type,re=m.stateNode;if(!(m.flags&128)&&(typeof ee.getDerivedStateFromError=="function"||re!==null&&typeof re.componentDidCatch=="function"&&(ju===null||!ju.has(re)))){m.flags|=65536,t&=-t,m.lanes|=t;var xe=iz(m,b,t);Gk(m,xe);break e}}m=m.return}while(m!==null)}Sz(r)}catch(Ee){t=Ee,ki===r&&r!==null&&(ki=r=r.return);continue}break}while(!0)}function bz(){var e=_1.current;return _1.current=y1,e===null?y1:e}function ZP(){(zi===0||zi===3||zi===2)&&(zi=4),Hi===null||!(Ah&268435455)&&!(ab&268435455)||Mu(Hi,ss)}function b1(e,t){var r=br;br|=2;var o=bz();(Hi!==e||ss!==t)&&(Hl=null,vh(e,t));do try{B7();break}catch(u){vz(e,u)}while(!0);if(IP(),br=r,_1.current=o,ki!==null)throw Error(Vt(261));return Hi=null,ss=0,zi}function B7(){for(;ki!==null;)wz(ki)}function V7(){for(;ki!==null&&!hG();)wz(ki)}function wz(e){var t=Ez(e.alternate,e,yo);e.memoizedProps=e.pendingProps,t===null?Sz(e):ki=t,$P.current=null}function Sz(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=N7(r,t),r!==null){r.flags&=32767,ki=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{zi=6,ki=null;return}}else if(r=k7(r,t,yo),r!==null){ki=r;return}if(t=t.sibling,t!==null){ki=t;return}ki=t=e}while(t!==null);zi===0&&(zi=5)}function uh(e,t,r){var o=Dr,u=ea.transition;try{ea.transition=null,Dr=1,U7(e,t,r,o)}finally{ea.transition=u,Dr=o}return null}function U7(e,t,r,o){do $p();while(Iu!==null);if(br&6)throw Error(Vt(327));r=e.finishedWork;var u=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Vt(177));e.callbackNode=null,e.callbackPriority=0;var m=r.lanes|r.childLanes;if(wG(e,m),e===Hi&&(ki=Hi=null,ss=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||cv||(cv=!0,Cz(n1,function(){return $p(),null})),m=(r.flags&15990)!==0,r.subtreeFlags&15990||m){m=ea.transition,ea.transition=null;var _=Dr;Dr=1;var b=br;br|=4,$P.current=null,O7(e,r),yz(r,e),l7(kE),i1=!!RE,kE=RE=null,e.current=r,j7(r),fG(),br=b,Dr=_,ea.transition=m}else e.current=r;if(cv&&(cv=!1,Iu=e,v1=u),m=e.pendingLanes,m===0&&(ju=null),gG(r.stateNode),Js(e,Ti()),t!==null)for(o=e.onRecoverableError,r=0;r<t.length;r++)u=t[r],o(u.value,{componentStack:u.stack,digest:u.digest});if(x1)throw x1=!1,e=QE,QE=null,e;return v1&1&&e.tag!==0&&$p(),m=e.pendingLanes,m&1?e===eC?Hy++:(Hy=0,eC=e):Hy=0,sd(),null}function $p(){if(Iu!==null){var e=rj(v1),t=ea.transition,r=Dr;try{if(ea.transition=null,Dr=16>e?16:e,Iu===null)var o=!1;else{if(e=Iu,Iu=null,v1=0,br&6)throw Error(Vt(331));var u=br;for(br|=4,cn=e.current;cn!==null;){var m=cn,_=m.child;if(cn.flags&16){var b=m.deletions;if(b!==null){for(var s=0;s<b.length;s++){var k=b[s];for(cn=k;cn!==null;){var O=cn;switch(O.tag){case 0:case 11:case 15:Gy(8,O,m)}var F=O.child;if(F!==null)F.return=O,cn=F;else for(;cn!==null;){O=cn;var q=O.sibling,H=O.return;if(pz(O),O===k){cn=null;break}if(q!==null){q.return=H,cn=q;break}cn=H}}}var J=m.alternate;if(J!==null){var U=J.child;if(U!==null){J.child=null;do{var te=U.sibling;U.sibling=null,U=te}while(U!==null)}}cn=m}}if(m.subtreeFlags&2064&&_!==null)_.return=m,cn=_;else e:for(;cn!==null;){if(m=cn,m.flags&2048)switch(m.tag){case 0:case 11:case 15:Gy(9,m,m.return)}var Q=m.sibling;if(Q!==null){Q.return=m.return,cn=Q;break e}cn=m.return}}var ee=e.current;for(cn=ee;cn!==null;){_=cn;var re=_.child;if(_.subtreeFlags&2064&&re!==null)re.return=_,cn=re;else e:for(_=ee;cn!==null;){if(b=cn,b.flags&2048)try{switch(b.tag){case 0:case 11:case 15:ob(9,b)}}catch(Ee){yi(b,b.return,Ee)}if(b===_){cn=null;break e}var xe=b.sibling;if(xe!==null){xe.return=b.return,cn=xe;break e}cn=b.return}}if(br=u,sd(),hl&&typeof hl.onPostCommitFiberRoot=="function")try{hl.onPostCommitFiberRoot(J1,e)}catch{}o=!0}return o}finally{Dr=r,ea.transition=t}}return!1}function dN(e,t,r){t=Qp(r,t),t=rz(e,t,1),e=Ou(e,t,1),t=Os(),e!==null&&(F_(e,1,t),Js(e,t))}function yi(e,t,r){if(e.tag===3)dN(e,e,r);else for(;t!==null;){if(t.tag===3){dN(t,e,r);break}else if(t.tag===1){var o=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(ju===null||!ju.has(o))){e=Qp(r,e),e=iz(t,e,1),t=Ou(t,e,1),e=Os(),t!==null&&(F_(t,1,e),Js(t,e));break}}t=t.return}}function $7(e,t,r){var o=e.pingCache;o!==null&&o.delete(t),t=Os(),e.pingedLanes|=e.suspendedLanes&r,Hi===e&&(ss&r)===r&&(zi===4||zi===3&&(ss&130023424)===ss&&500>Ti()-WP?vh(e,0):GP|=r),Js(e,t)}function Tz(e,t){t===0&&(e.mode&1?(t=Q0,Q0<<=1,!(Q0&130023424)&&(Q0=4194304)):t=1);var r=Os();e=oc(e,t),e!==null&&(F_(e,t,r),Js(e,r))}function G7(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),Tz(e,r)}function W7(e,t){var r=0;switch(e.tag){case 13:var o=e.stateNode,u=e.memoizedState;u!==null&&(r=u.retryLane);break;case 19:o=e.stateNode;break;default:throw Error(Vt(314))}o!==null&&o.delete(t),Tz(e,r)}var Ez;Ez=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Ys.current)Zs=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return Zs=!1,R7(e,t,r);Zs=!!(e.flags&131072)}else Zs=!1,ri&&t.flags&1048576&&Aj(t,d1,t.index);switch(t.lanes=0,t.tag){case 2:var o=t.type;zv(e,t),e=t.pendingProps;var u=Xp(t,bs.current);Up(t,r),u=zP(null,t,o,e,u,r);var m=FP();return t.flags|=1,typeof u=="object"&&u!==null&&typeof u.render=="function"&&u.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ks(o)?(m=!0,c1(t)):m=!1,t.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,kP(t),u.updater=sb,t.stateNode=u,u._reactInternals=t,UE(t,o,e,r),t=WE(null,t,o,!0,m,r)):(t.tag=0,ri&&m&&CP(t),ks(null,t,u,r),t=t.child),t;case 16:o=t.elementType;e:{switch(zv(e,t),e=t.pendingProps,u=o._init,o=u(o._payload),t.type=o,u=t.tag=q7(o),e=Ma(o,e),u){case 0:t=GE(null,t,o,e,r);break e;case 1:t=tN(null,t,o,e,r);break e;case 11:t=Qk(null,t,o,e,r);break e;case 14:t=eN(null,t,o,Ma(o.type,e),r);break e}throw Error(Vt(306,o,""))}return t;case 0:return o=t.type,u=t.pendingProps,u=t.elementType===o?u:Ma(o,u),GE(e,t,o,u,r);case 1:return o=t.type,u=t.pendingProps,u=t.elementType===o?u:Ma(o,u),tN(e,t,o,u,r);case 3:e:{if(lz(t),e===null)throw Error(Vt(387));o=t.pendingProps,m=t.memoizedState,u=m.element,Lj(e,t),p1(t,o,null,r);var _=t.memoizedState;if(o=_.element,m.isDehydrated)if(m={element:o,isDehydrated:!1,cache:_.cache,pendingSuspenseBoundaries:_.pendingSuspenseBoundaries,transitions:_.transitions},t.updateQueue.baseState=m,t.memoizedState=m,t.flags&256){u=Qp(Error(Vt(423)),t),t=nN(e,t,o,r,u);break e}else if(o!==u){u=Qp(Error(Vt(424)),t),t=nN(e,t,o,r,u);break e}else for(xo=Lu(t.stateNode.containerInfo.firstChild),wo=t,ri=!0,Ia=null,r=kj(t,null,o,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(Yp(),o===u){t=ac(e,t,r);break e}ks(e,t,o,r)}t=t.child}return t;case 5:return Oj(t),e===null&&FE(t),o=t.type,u=t.pendingProps,m=e!==null?e.memoizedProps:null,_=u.children,NE(o,u)?_=null:m!==null&&NE(o,m)&&(t.flags|=32),az(e,t),ks(e,t,_,r),t.child;case 6:return e===null&&FE(t),null;case 13:return cz(e,t,r);case 4:return NP(t,t.stateNode.containerInfo),o=t.pendingProps,e===null?t.child=Kp(t,null,o,r):ks(e,t,o,r),t.child;case 11:return o=t.type,u=t.pendingProps,u=t.elementType===o?u:Ma(o,u),Qk(e,t,o,u,r);case 7:return ks(e,t,t.pendingProps,r),t.child;case 8:return ks(e,t,t.pendingProps.children,r),t.child;case 12:return ks(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(o=t.type._context,u=t.pendingProps,m=t.memoizedProps,_=u.value,$r(h1,o._currentValue),o._currentValue=_,m!==null)if(La(m.value,_)){if(m.children===u.children&&!Ys.current){t=ac(e,t,r);break e}}else for(m=t.child,m!==null&&(m.return=t);m!==null;){var b=m.dependencies;if(b!==null){_=m.child;for(var s=b.firstContext;s!==null;){if(s.context===o){if(m.tag===1){s=Ql(-1,r&-r),s.tag=2;var k=m.updateQueue;if(k!==null){k=k.shared;var O=k.pending;O===null?s.next=s:(s.next=O.next,O.next=s),k.pending=s}}m.lanes|=r,s=m.alternate,s!==null&&(s.lanes|=r),BE(m.return,r,t),b.lanes|=r;break}s=s.next}}else if(m.tag===10)_=m.type===t.type?null:m.child;else if(m.tag===18){if(_=m.return,_===null)throw Error(Vt(341));_.lanes|=r,b=_.alternate,b!==null&&(b.lanes|=r),BE(_,r,t),_=m.sibling}else _=m.child;if(_!==null)_.return=m;else for(_=m;_!==null;){if(_===t){_=null;break}if(m=_.sibling,m!==null){m.return=_.return,_=m;break}_=_.return}m=_}ks(e,t,u.children,r),t=t.child}return t;case 9:return u=t.type,o=t.pendingProps.children,Up(t,r),u=ta(u),o=o(u),t.flags|=1,ks(e,t,o,r),t.child;case 14:return o=t.type,u=Ma(o,t.pendingProps),u=Ma(o.type,u),eN(e,t,o,u,r);case 15:return sz(e,t,t.type,t.pendingProps,r);case 17:return o=t.type,u=t.pendingProps,u=t.elementType===o?u:Ma(o,u),zv(e,t),t.tag=1,Ks(o)?(e=!0,c1(t)):e=!1,Up(t,r),nz(t,o,u),UE(t,o,u,r),WE(null,t,o,!0,e,r);case 19:return uz(e,t,r);case 22:return oz(e,t,r)}throw Error(Vt(156,t.tag))};function Cz(e,t){return Q4(e,t)}function H7(e,t,r,o){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Qo(e,t,r,o){return new H7(e,t,r,o)}function XP(e){return e=e.prototype,!(!e||!e.isReactComponent)}function q7(e){if(typeof e=="function")return XP(e)?1:0;if(e!=null){if(e=e.$$typeof,e===pP)return 11;if(e===mP)return 14}return 2}function Fu(e,t){var r=e.alternate;return r===null?(r=Qo(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Vv(e,t,r,o,u,m){var _=2;if(o=e,typeof e=="function")XP(e)&&(_=1);else if(typeof e=="string")_=5;else e:switch(e){case wp:return bh(r.children,u,m,t);case fP:_=8,u|=8;break;case hE:return e=Qo(12,r,t,u|2),e.elementType=hE,e.lanes=m,e;case fE:return e=Qo(13,r,t,u),e.elementType=fE,e.lanes=m,e;case pE:return e=Qo(19,r,t,u),e.elementType=pE,e.lanes=m,e;case O4:return lb(r,u,m,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case N4:_=10;break e;case L4:_=9;break e;case pP:_=11;break e;case mP:_=14;break e;case Eu:_=16,o=null;break e}throw Error(Vt(130,e==null?e:typeof e,""))}return t=Qo(_,r,t,u),t.elementType=e,t.type=o,t.lanes=m,t}function bh(e,t,r,o){return e=Qo(7,e,o,t),e.lanes=r,e}function lb(e,t,r,o){return e=Qo(22,e,o,t),e.elementType=O4,e.lanes=r,e.stateNode={isHidden:!1},e}function pT(e,t,r){return e=Qo(6,e,null,t),e.lanes=r,e}function mT(e,t,r){return t=Qo(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Z7(e,t,r,o,u){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=XS(0),this.expirationTimes=XS(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=XS(0),this.identifierPrefix=o,this.onRecoverableError=u,this.mutableSourceEagerHydrationData=null}function YP(e,t,r,o,u,m,_,b,s){return e=new Z7(e,t,r,b,s),t===1?(t=1,m===!0&&(t|=8)):t=0,m=Qo(3,null,null,t),e.current=m,m.stateNode=e,m.memoizedState={element:o,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},kP(m),e}function X7(e,t,r){var o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:bp,key:o==null?null:""+o,children:e,containerInfo:t,implementation:r}}function Pz(e){if(!e)return Uu;e=e._reactInternals;e:{if(Wh(e)!==e||e.tag!==1)throw Error(Vt(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ks(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Vt(171))}if(e.tag===1){var r=e.type;if(Ks(r))return Pj(e,r,t)}return t}function Mz(e,t,r,o,u,m,_,b,s){return e=YP(r,o,!0,e,u,m,_,b,s),e.context=Pz(null),r=e.current,o=Os(),u=zu(r),m=Ql(o,u),m.callback=t??null,Ou(r,m,u),e.current.lanes=u,F_(e,u,o),Js(e,o),e}function cb(e,t,r,o){var u=t.current,m=Os(),_=zu(u);return r=Pz(r),t.context===null?t.context=r:t.pendingContext=r,t=Ql(m,_),t.payload={element:e},o=o===void 0?null:o,o!==null&&(t.callback=o),e=Ou(u,t,_),e!==null&&(ka(e,u,_,m),Lv(e,u,_)),_}function w1(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function hN(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function KP(e,t){hN(e,t),(e=e.alternate)&&hN(e,t)}function Y7(){return null}var Az=typeof reportError=="function"?reportError:function(e){console.error(e)};function JP(e){this._internalRoot=e}ub.prototype.render=JP.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Vt(409));cb(e,t,null,null)};ub.prototype.unmount=JP.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Ih(function(){cb(null,e,null,null)}),t[sc]=null}};function ub(e){this._internalRoot=e}ub.prototype.unstable_scheduleHydration=function(e){if(e){var t=oj();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Pu.length&&t!==0&&t<Pu[r].priority;r++);Pu.splice(r,0,e),r===0&&lj(e)}};function QP(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function db(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function fN(){}function K7(e,t,r,o,u){if(u){if(typeof o=="function"){var m=o;o=function(){var k=w1(_);m.call(k)}}var _=Mz(t,o,e,0,null,!1,!1,"",fN);return e._reactRootContainer=_,e[sc]=_.current,h_(e.nodeType===8?e.parentNode:e),Ih(),_}for(;u=e.lastChild;)e.removeChild(u);if(typeof o=="function"){var b=o;o=function(){var k=w1(s);b.call(k)}}var s=YP(e,0,!1,null,null,!1,!1,"",fN);return e._reactRootContainer=s,e[sc]=s.current,h_(e.nodeType===8?e.parentNode:e),Ih(function(){cb(t,s,r,o)}),s}function hb(e,t,r,o,u){var m=r._reactRootContainer;if(m){var _=m;if(typeof u=="function"){var b=u;u=function(){var s=w1(_);b.call(s)}}cb(t,_,e,u)}else _=K7(r,t,e,u,o);return w1(_)}ij=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=Ay(t.pendingLanes);r!==0&&(_P(t,r|1),Js(t,Ti()),!(br&6)&&(em=Ti()+500,sd()))}break;case 13:Ih(function(){var o=oc(e,1);if(o!==null){var u=Os();ka(o,e,1,u)}}),KP(e,1)}};xP=function(e){if(e.tag===13){var t=oc(e,134217728);if(t!==null){var r=Os();ka(t,e,134217728,r)}KP(e,134217728)}};sj=function(e){if(e.tag===13){var t=zu(e),r=oc(e,t);if(r!==null){var o=Os();ka(r,e,t,o)}KP(e,t)}};oj=function(){return Dr};aj=function(e,t){var r=Dr;try{return Dr=e,t()}finally{Dr=r}};TE=function(e,t,r){switch(t){case"input":if(yE(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var o=r[t];if(o!==e&&o.form===e.form){var u=nb(o);if(!u)throw Error(Vt(90));z4(o),yE(o,u)}}}break;case"textarea":B4(e,r);break;case"select":t=r.value,t!=null&&zp(e,!!r.multiple,t,!1)}};q4=HP;Z4=Ih;var J7={usingClientEntryPoint:!1,Events:[V_,Cp,nb,W4,H4,HP]},_y={findFiberByHostInstance:mh,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Q7={bundleType:_y.bundleType,version:_y.version,rendererPackageName:_y.rendererPackageName,rendererConfig:_y.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:mc.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=K4(e),e===null?null:e.stateNode},findFiberByHostInstance:_y.findFiberByHostInstance||Y7,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var uv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!uv.isDisabled&&uv.supportsFiber)try{J1=uv.inject(Q7),hl=uv}catch{}}Io.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=J7;Io.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!QP(t))throw Error(Vt(200));return X7(e,t,null,r)};Io.createRoot=function(e,t){if(!QP(e))throw Error(Vt(299));var r=!1,o="",u=Az;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(o=t.identifierPrefix),t.onRecoverableError!==void 0&&(u=t.onRecoverableError)),t=YP(e,1,!1,null,null,r,!1,o,u),e[sc]=t.current,h_(e.nodeType===8?e.parentNode:e),new JP(t)};Io.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Vt(188)):(e=Object.keys(e).join(","),Error(Vt(268,e)));return e=K4(t),e=e===null?null:e.stateNode,e};Io.flushSync=function(e){return Ih(e)};Io.hydrate=function(e,t,r){if(!db(t))throw Error(Vt(200));return hb(null,e,t,!0,r)};Io.hydrateRoot=function(e,t,r){if(!QP(e))throw Error(Vt(405));var o=r!=null&&r.hydratedSources||null,u=!1,m="",_=Az;if(r!=null&&(r.unstable_strictMode===!0&&(u=!0),r.identifierPrefix!==void 0&&(m=r.identifierPrefix),r.onRecoverableError!==void 0&&(_=r.onRecoverableError)),t=Mz(t,null,e,1,r??null,u,!1,m,_),e[sc]=t.current,h_(e),o)for(e=0;e<o.length;e++)r=o[e],u=r._getVersion,u=u(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,u]:t.mutableSourceEagerHydrationData.push(r,u);return new ub(t)};Io.render=function(e,t,r){if(!db(t))throw Error(Vt(200));return hb(null,e,t,!1,r)};Io.unmountComponentAtNode=function(e){if(!db(e))throw Error(Vt(40));return e._reactRootContainer?(Ih(function(){hb(null,null,e,!1,function(){e._reactRootContainer=null,e[sc]=null})}),!0):!1};Io.unstable_batchedUpdates=HP;Io.unstable_renderSubtreeIntoContainer=function(e,t,r,o){if(!db(r))throw Error(Vt(200));if(e==null||e._reactInternals===void 0)throw Error(Vt(38));return hb(e,t,r,!1,o)};Io.version="18.3.1-next-f1338f8080-20240426";function Iz(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Iz)}catch(e){console.error(e)}}Iz(),I4.exports=Io;var Hh=I4.exports;const Dz=Y1(Hh);var Rz,pN=Hh;Rz=pN.createRoot,pN.hydrateRoot;var kz={exports:{}},Nz={};/**
 * @license React
 * use-sync-external-store-with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $_=W;function e9(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var t9=typeof Object.is=="function"?Object.is:e9,n9=$_.useSyncExternalStore,r9=$_.useRef,i9=$_.useEffect,s9=$_.useMemo,o9=$_.useDebugValue;Nz.useSyncExternalStoreWithSelector=function(e,t,r,o,u){var m=r9(null);if(m.current===null){var _={hasValue:!1,value:null};m.current=_}else _=m.current;m=s9(function(){function s(H){if(!k){if(k=!0,O=H,H=o(H),u!==void 0&&_.hasValue){var J=_.value;if(u(J,H))return F=J}return F=H}if(J=F,t9(O,H))return J;var U=o(H);return u!==void 0&&u(J,U)?J:(O=H,F=U)}var k=!1,O,F,q=r===void 0?null:r;return[function(){return s(t())},q===null?void 0:function(){return s(q())}]},[t,r,o,u]);var b=n9(e,m[0],m[1]);return i9(function(){_.hasValue=!0,_.value=b},[b]),o9(b),b};kz.exports=Nz;var a9=kz.exports,vo="default"in Jv?Gn:Jv,mN=Symbol.for("react-redux-context"),gN=typeof globalThis<"u"?globalThis:{};function l9(){if(!vo.createContext)return{};const e=gN[mN]??(gN[mN]=new Map);let t=e.get(vo.createContext);return t||(t=vo.createContext(null),e.set(vo.createContext,t)),t}var $u=l9(),c9=()=>{throw new Error("uSES not initialized!")};function eM(e=$u){return function(){return vo.useContext(e)}}var Lz=eM(),Oz=c9,u9=e=>{Oz=e},d9=(e,t)=>e===t;function h9(e=$u){const t=e===$u?Lz:eM(e),r=(o,u={})=>{const{equalityFn:m=d9,devModeChecks:_={}}=typeof u=="function"?{equalityFn:u}:u,{store:b,subscription:s,getServerState:k,stabilityCheck:O,identityFunctionCheck:F}=t();vo.useRef(!0);const q=vo.useCallback({[o.name](J){return o(J)}}[o.name],[o,O,_.stabilityCheck]),H=Oz(s.addNestedSub,b.getState,k||b.getState,q,m);return vo.useDebugValue(H),H};return Object.assign(r,{withTypes:()=>r}),r}var qi=h9();function f9(e){e()}function p9(){let e=null,t=null;return{clear(){e=null,t=null},notify(){f9(()=>{let r=e;for(;r;)r.callback(),r=r.next})},get(){const r=[];let o=e;for(;o;)r.push(o),o=o.next;return r},subscribe(r){let o=!0;const u=t={callback:r,next:null,prev:t};return u.prev?u.prev.next=u:e=u,function(){!o||e===null||(o=!1,u.next?u.next.prev=u.prev:t=u.prev,u.prev?u.prev.next=u.next:e=u.next)}}}}var yN={notify(){},get:()=>[]};function m9(e,t){let r,o=yN,u=0,m=!1;function _(U){O();const te=o.subscribe(U);let Q=!1;return()=>{Q||(Q=!0,te(),F())}}function b(){o.notify()}function s(){J.onStateChange&&J.onStateChange()}function k(){return m}function O(){u++,r||(r=e.subscribe(s),o=p9())}function F(){u--,r&&u===0&&(r(),r=void 0,o.clear(),o=yN)}function q(){m||(m=!0,O())}function H(){m&&(m=!1,F())}const J={addNestedSub:_,notifyNestedSubs:b,handleChangeWrapper:s,isSubscribed:k,trySubscribe:q,tryUnsubscribe:H,getListeners:()=>o};return J}var g9=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",y9=typeof navigator<"u"&&navigator.product==="ReactNative",_9=g9||y9?vo.useLayoutEffect:vo.useEffect;function x9({store:e,context:t,children:r,serverState:o,stabilityCheck:u="once",identityFunctionCheck:m="once"}){const _=vo.useMemo(()=>{const k=m9(e);return{store:e,subscription:k,getServerState:o?()=>o:void 0,stabilityCheck:u,identityFunctionCheck:m}},[e,o,u,m]),b=vo.useMemo(()=>e.getState(),[e]);_9(()=>{const{subscription:k}=_;return k.onStateChange=k.notifyNestedSubs,k.trySubscribe(),b!==e.getState()&&k.notifyNestedSubs(),()=>{k.tryUnsubscribe(),k.onStateChange=void 0}},[_,b]);const s=t||$u;return vo.createElement(s.Provider,{value:_},r)}var v9=x9;function jz(e=$u){const t=e===$u?Lz:eM(e),r=()=>{const{store:o}=t();return o};return Object.assign(r,{withTypes:()=>r}),r}var b9=jz();function w9(e=$u){const t=e===$u?b9:jz(e),r=()=>t().dispatch;return Object.assign(r,{withTypes:()=>r}),r}var xl=w9();u9(a9.useSyncExternalStoreWithSelector);function ns(e){return`Minified Redux error #${e}; visit https://redux.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var S9=typeof Symbol=="function"&&Symbol.observable||"@@observable",_N=S9,gT=()=>Math.random().toString(36).substring(7).split("").join("."),T9={INIT:`@@redux/INIT${gT()}`,REPLACE:`@@redux/REPLACE${gT()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${gT()}`},S1=T9;function tM(e){if(typeof e!="object"||e===null)return!1;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||Object.getPrototypeOf(e)===null}function zz(e,t,r){if(typeof e!="function")throw new Error(ns(2));if(typeof t=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(ns(0));if(typeof t=="function"&&typeof r>"u"&&(r=t,t=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(ns(1));return r(zz)(e,t)}let o=e,u=t,m=new Map,_=m,b=0,s=!1;function k(){_===m&&(_=new Map,m.forEach((te,Q)=>{_.set(Q,te)}))}function O(){if(s)throw new Error(ns(3));return u}function F(te){if(typeof te!="function")throw new Error(ns(4));if(s)throw new Error(ns(5));let Q=!0;k();const ee=b++;return _.set(ee,te),function(){if(Q){if(s)throw new Error(ns(6));Q=!1,k(),_.delete(ee),m=null}}}function q(te){if(!tM(te))throw new Error(ns(7));if(typeof te.type>"u")throw new Error(ns(8));if(typeof te.type!="string")throw new Error(ns(17));if(s)throw new Error(ns(9));try{s=!0,u=o(u,te)}finally{s=!1}return(m=_).forEach(ee=>{ee()}),te}function H(te){if(typeof te!="function")throw new Error(ns(10));o=te,q({type:S1.REPLACE})}function J(){const te=F;return{subscribe(Q){if(typeof Q!="object"||Q===null)throw new Error(ns(11));function ee(){const xe=Q;xe.next&&xe.next(O())}return ee(),{unsubscribe:te(ee)}},[_N](){return this}}}return q({type:S1.INIT}),{dispatch:q,subscribe:F,getState:O,replaceReducer:H,[_N]:J}}function E9(e){Object.keys(e).forEach(t=>{const r=e[t];if(typeof r(void 0,{type:S1.INIT})>"u")throw new Error(ns(12));if(typeof r(void 0,{type:S1.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(ns(13))})}function C9(e){const t=Object.keys(e),r={};for(let m=0;m<t.length;m++){const _=t[m];typeof e[_]=="function"&&(r[_]=e[_])}const o=Object.keys(r);let u;try{E9(r)}catch(m){u=m}return function(_={},b){if(u)throw u;let s=!1;const k={};for(let O=0;O<o.length;O++){const F=o[O],q=r[F],H=_[F],J=q(H,b);if(typeof J>"u")throw b&&b.type,new Error(ns(14));k[F]=J,s=s||J!==H}return s=s||o.length!==Object.keys(_).length,s?k:_}}function T1(...e){return e.length===0?t=>t:e.length===1?e[0]:e.reduce((t,r)=>(...o)=>t(r(...o)))}function P9(...e){return t=>(r,o)=>{const u=t(r,o);let m=()=>{throw new Error(ns(15))};const _={getState:u.getState,dispatch:(s,...k)=>m(s,...k)},b=e.map(s=>s(_));return m=T1(...b)(u.dispatch),{...u,dispatch:m}}}function M9(e){return tM(e)&&"type"in e&&typeof e.type=="string"}var Fz=Symbol.for("immer-nothing"),xN=Symbol.for("immer-draftable"),Po=Symbol.for("immer-state");function Da(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var tm=Object.getPrototypeOf;function Dh(e){return!!e&&!!e[Po]}function lc(e){var t;return e?Bz(e)||Array.isArray(e)||!!e[xN]||!!((t=e.constructor)!=null&&t[xN])||pb(e)||mb(e):!1}var A9=Object.prototype.constructor.toString();function Bz(e){if(!e||typeof e!="object")return!1;const t=tm(e);if(t===null)return!0;const r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===A9}function E1(e,t){fb(e)===0?Reflect.ownKeys(e).forEach(r=>{t(r,e[r],e)}):e.forEach((r,o)=>t(o,r,e))}function fb(e){const t=e[Po];return t?t.type_:Array.isArray(e)?1:pb(e)?2:mb(e)?3:0}function rC(e,t){return fb(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Vz(e,t,r){const o=fb(e);o===2?e.set(t,r):o===3?e.add(r):e[t]=r}function I9(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function pb(e){return e instanceof Map}function mb(e){return e instanceof Set}function dh(e){return e.copy_||e.base_}function iC(e,t){if(pb(e))return new Map(e);if(mb(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const r=Bz(e);if(t===!0||t==="class_only"&&!r){const o=Object.getOwnPropertyDescriptors(e);delete o[Po];let u=Reflect.ownKeys(o);for(let m=0;m<u.length;m++){const _=u[m],b=o[_];b.writable===!1&&(b.writable=!0,b.configurable=!0),(b.get||b.set)&&(o[_]={configurable:!0,writable:!0,enumerable:b.enumerable,value:e[_]})}return Object.create(tm(e),o)}else{const o=tm(e);if(o!==null&&r)return{...e};const u=Object.create(o);return Object.assign(u,e)}}function nM(e,t=!1){return gb(e)||Dh(e)||!lc(e)||(fb(e)>1&&(e.set=e.add=e.clear=e.delete=D9),Object.freeze(e),t&&Object.entries(e).forEach(([r,o])=>nM(o,!0))),e}function D9(){Da(2)}function gb(e){return Object.isFrozen(e)}var R9={};function Rh(e){const t=R9[e];return t||Da(0,e),t}var b_;function Uz(){return b_}function k9(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function vN(e,t){t&&(Rh("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function sC(e){oC(e),e.drafts_.forEach(N9),e.drafts_=null}function oC(e){e===b_&&(b_=e.parent_)}function bN(e){return b_=k9(b_,e)}function N9(e){const t=e[Po];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function wN(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];return e!==void 0&&e!==r?(r[Po].modified_&&(sC(t),Da(4)),lc(e)&&(e=C1(t,e),t.parent_||P1(t,e)),t.patches_&&Rh("Patches").generateReplacementPatches_(r[Po].base_,e,t.patches_,t.inversePatches_)):e=C1(t,r,[]),sC(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==Fz?e:void 0}function C1(e,t,r){if(gb(t))return t;const o=t[Po];if(!o)return E1(t,(u,m)=>SN(e,o,t,u,m,r)),t;if(o.scope_!==e)return t;if(!o.modified_)return P1(e,o.base_,!0),o.base_;if(!o.finalized_){o.finalized_=!0,o.scope_.unfinalizedDrafts_--;const u=o.copy_;let m=u,_=!1;o.type_===3&&(m=new Set(u),u.clear(),_=!0),E1(m,(b,s)=>SN(e,o,u,b,s,r,_)),P1(e,u,!1),r&&e.patches_&&Rh("Patches").generatePatches_(o,r,e.patches_,e.inversePatches_)}return o.copy_}function SN(e,t,r,o,u,m,_){if(Dh(u)){const b=m&&t&&t.type_!==3&&!rC(t.assigned_,o)?m.concat(o):void 0,s=C1(e,u,b);if(Vz(r,o,s),Dh(s))e.canAutoFreeze_=!1;else return}else _&&r.add(u);if(lc(u)&&!gb(u)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;C1(e,u),(!t||!t.scope_.parent_)&&typeof o!="symbol"&&Object.prototype.propertyIsEnumerable.call(r,o)&&P1(e,u)}}function P1(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&nM(t,r)}function L9(e,t){const r=Array.isArray(e),o={type_:r?1:0,scope_:t?t.scope_:Uz(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let u=o,m=rM;r&&(u=[o],m=w_);const{revoke:_,proxy:b}=Proxy.revocable(u,m);return o.draft_=b,o.revoke_=_,b}var rM={get(e,t){if(t===Po)return e;const r=dh(e);if(!rC(r,t))return O9(e,r,t);const o=r[t];return e.finalized_||!lc(o)?o:o===yT(e.base_,t)?(_T(e),e.copy_[t]=lC(o,e)):o},has(e,t){return t in dh(e)},ownKeys(e){return Reflect.ownKeys(dh(e))},set(e,t,r){const o=$z(dh(e),t);if(o!=null&&o.set)return o.set.call(e.draft_,r),!0;if(!e.modified_){const u=yT(dh(e),t),m=u==null?void 0:u[Po];if(m&&m.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(I9(r,u)&&(r!==void 0||rC(e.base_,t)))return!0;_T(e),aC(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return yT(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,_T(e),aC(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const r=dh(e),o=Reflect.getOwnPropertyDescriptor(r,t);return o&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:o.enumerable,value:r[t]}},defineProperty(){Da(11)},getPrototypeOf(e){return tm(e.base_)},setPrototypeOf(){Da(12)}},w_={};E1(rM,(e,t)=>{w_[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});w_.deleteProperty=function(e,t){return w_.set.call(this,e,t,void 0)};w_.set=function(e,t,r){return rM.set.call(this,e[0],t,r,e[0])};function yT(e,t){const r=e[Po];return(r?dh(r):e)[t]}function O9(e,t,r){var u;const o=$z(t,r);return o?"value"in o?o.value:(u=o.get)==null?void 0:u.call(e.draft_):void 0}function $z(e,t){if(!(t in e))return;let r=tm(e);for(;r;){const o=Object.getOwnPropertyDescriptor(r,t);if(o)return o;r=tm(r)}}function aC(e){e.modified_||(e.modified_=!0,e.parent_&&aC(e.parent_))}function _T(e){e.copy_||(e.copy_=iC(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var j9=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,r,o)=>{if(typeof t=="function"&&typeof r!="function"){const m=r;r=t;const _=this;return function(s=m,...k){return _.produce(s,O=>r.call(this,O,...k))}}typeof r!="function"&&Da(6),o!==void 0&&typeof o!="function"&&Da(7);let u;if(lc(t)){const m=bN(this),_=lC(t,void 0);let b=!0;try{u=r(_),b=!1}finally{b?sC(m):oC(m)}return vN(m,o),wN(u,m)}else if(!t||typeof t!="object"){if(u=r(t),u===void 0&&(u=t),u===Fz&&(u=void 0),this.autoFreeze_&&nM(u,!0),o){const m=[],_=[];Rh("Patches").generateReplacementPatches_(t,u,m,_),o(m,_)}return u}else Da(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(_,...b)=>this.produceWithPatches(_,s=>t(s,...b));let o,u;return[this.produce(t,r,(_,b)=>{o=_,u=b}),o,u]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){lc(e)||Da(8),Dh(e)&&(e=z9(e));const t=bN(this),r=lC(e,void 0);return r[Po].isManual_=!0,oC(t),r}finishDraft(e,t){const r=e&&e[Po];(!r||!r.isManual_)&&Da(9);const{scope_:o}=r;return vN(o,t),wN(void 0,o)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const u=t[r];if(u.path.length===0&&u.op==="replace"){e=u.value;break}}r>-1&&(t=t.slice(r+1));const o=Rh("Patches").applyPatches_;return Dh(e)?o(e,t):this.produce(e,u=>o(u,t))}};function lC(e,t){const r=pb(e)?Rh("MapSet").proxyMap_(e,t):mb(e)?Rh("MapSet").proxySet_(e,t):L9(e,t);return(t?t.scope_:Uz()).drafts_.push(r),r}function z9(e){return Dh(e)||Da(10,e),Gz(e)}function Gz(e){if(!lc(e)||gb(e))return e;const t=e[Po];let r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=iC(e,t.scope_.immer_.useStrictShallowCopy_)}else r=iC(e,!0);return E1(r,(o,u)=>{Vz(r,o,Gz(u))}),t&&(t.finalized_=!1),r}var Mo=new j9,Wz=Mo.produce;Mo.produceWithPatches.bind(Mo);Mo.setAutoFreeze.bind(Mo);Mo.setUseStrictShallowCopy.bind(Mo);Mo.applyPatches.bind(Mo);Mo.createDraft.bind(Mo);Mo.finishDraft.bind(Mo);function Hz(e){return({dispatch:r,getState:o})=>u=>m=>typeof m=="function"?m(r,o,e):u(m)}var F9=Hz(),B9=Hz,V9=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?T1:T1.apply(null,arguments)};function TN(e,t){function r(...o){if(t){let u=t(...o);if(!u)throw new Error(Na(0));return{type:e,payload:u.payload,..."meta"in u&&{meta:u.meta},..."error"in u&&{error:u.error}}}return{type:e,payload:o[0]}}return r.toString=()=>`${e}`,r.type=e,r.match=o=>M9(o)&&o.type===e,r}var qz=class Dy extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,Dy.prototype)}static get[Symbol.species](){return Dy}concat(...t){return super.concat.apply(this,t)}prepend(...t){return t.length===1&&Array.isArray(t[0])?new Dy(...t[0].concat(this)):new Dy(...t.concat(this))}};function EN(e){return lc(e)?Wz(e,()=>{}):e}function CN(e,t,r){if(e.has(t)){let u=e.get(t);return r.update&&(u=r.update(u,t,e),e.set(t,u)),u}if(!r.insert)throw new Error(Na(10));const o=r.insert(t,e);return e.set(t,o),o}function U9(e){return typeof e=="boolean"}var $9=()=>function(t){const{thunk:r=!0,immutableCheck:o=!0,serializableCheck:u=!0,actionCreatorCheck:m=!0}=t??{};let _=new qz;return r&&(U9(r)?_.push(F9):_.push(B9(r.extraArgument))),_},G9="RTK_autoBatch",Zz=e=>t=>{setTimeout(t,e)},W9=typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:Zz(10),H9=(e={type:"raf"})=>t=>(...r)=>{const o=t(...r);let u=!0,m=!1,_=!1;const b=new Set,s=e.type==="tick"?queueMicrotask:e.type==="raf"?W9:e.type==="callback"?e.queueNotification:Zz(e.timeout),k=()=>{_=!1,m&&(m=!1,b.forEach(O=>O()))};return Object.assign({},o,{subscribe(O){const F=()=>u&&O(),q=o.subscribe(F);return b.add(O),()=>{q(),b.delete(O)}},dispatch(O){var F;try{return u=!((F=O==null?void 0:O.meta)!=null&&F[G9]),m=!u,m&&(_||(_=!0,s(k))),o.dispatch(O)}finally{u=!0}}})},q9=e=>function(r){const{autoBatch:o=!0}=r??{};let u=new qz(e);return o&&u.push(H9(typeof o=="object"?o:void 0)),u};function Z9(e){const t=$9(),{reducer:r=void 0,middleware:o,devTools:u=!0,preloadedState:m=void 0,enhancers:_=void 0}=e||{};let b;if(typeof r=="function")b=r;else if(tM(r))b=C9(r);else throw new Error(Na(1));let s;typeof o=="function"?s=o(t):s=t();let k=T1;u&&(k=V9({trace:!1,...typeof u=="object"&&u}));const O=P9(...s),F=q9(O);let q=typeof _=="function"?_(F):F();const H=k(...q);return zz(b,m,H)}function Xz(e){const t={},r=[];let o;const u={addCase(m,_){const b=typeof m=="string"?m:m.type;if(!b)throw new Error(Na(28));if(b in t)throw new Error(Na(29));return t[b]=_,u},addMatcher(m,_){return r.push({matcher:m,reducer:_}),u},addDefaultCase(m){return o=m,u}};return e(u),[t,r,o]}function X9(e){return typeof e=="function"}function Y9(e,t){let[r,o,u]=Xz(t),m;if(X9(e))m=()=>EN(e());else{const b=EN(e);m=()=>b}function _(b=m(),s){let k=[r[s.type],...o.filter(({matcher:O})=>O(s)).map(({reducer:O})=>O)];return k.filter(O=>!!O).length===0&&(k=[u]),k.reduce((O,F)=>{if(F)if(Dh(O)){const H=F(O,s);return H===void 0?O:H}else{if(lc(O))return Wz(O,q=>F(q,s));{const q=F(O,s);if(q===void 0){if(O===null)return O;throw new Error(Na(9))}return q}}return O},b)}return _.getInitialState=m,_}var K9=Symbol.for("rtk-slice-createasyncthunk");function J9(e,t){return`${e}/${t}`}function Q9({creators:e}={}){var r;const t=(r=e==null?void 0:e.asyncThunk)==null?void 0:r[K9];return function(u){const{name:m,reducerPath:_=m}=u;if(!m)throw new Error(Na(11));typeof process<"u";const b=(typeof u.reducers=="function"?u.reducers(tW()):u.reducers)||{},s=Object.keys(b),k={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},O={addCase(re,xe){const Ee=typeof re=="string"?re:re.type;if(!Ee)throw new Error(Na(12));if(Ee in k.sliceCaseReducersByType)throw new Error(Na(13));return k.sliceCaseReducersByType[Ee]=xe,O},addMatcher(re,xe){return k.sliceMatchers.push({matcher:re,reducer:xe}),O},exposeAction(re,xe){return k.actionCreators[re]=xe,O},exposeCaseReducer(re,xe){return k.sliceCaseReducersByName[re]=xe,O}};s.forEach(re=>{const xe=b[re],Ee={reducerName:re,type:J9(m,re),createNotation:typeof u.reducers=="function"};rW(xe)?sW(Ee,xe,O,t):nW(Ee,xe,O)});function F(){const[re={},xe=[],Ee=void 0]=typeof u.extraReducers=="function"?Xz(u.extraReducers):[u.extraReducers],He={...re,...k.sliceCaseReducersByType};return Y9(u.initialState,qe=>{for(let Ne in He)qe.addCase(Ne,He[Ne]);for(let Ne of k.sliceMatchers)qe.addMatcher(Ne.matcher,Ne.reducer);for(let Ne of xe)qe.addMatcher(Ne.matcher,Ne.reducer);Ee&&qe.addDefaultCase(Ee)})}const q=re=>re,H=new Map;let J;function U(re,xe){return J||(J=F()),J(re,xe)}function te(){return J||(J=F()),J.getInitialState()}function Q(re,xe=!1){function Ee(qe){let Ne=qe[re];return typeof Ne>"u"&&xe&&(Ne=te()),Ne}function He(qe=q){const Ne=CN(H,xe,{insert:()=>new WeakMap});return CN(Ne,qe,{insert:()=>{const ft={};for(const[ut,mt]of Object.entries(u.selectors??{}))ft[ut]=eW(mt,qe,te,xe);return ft}})}return{reducerPath:re,getSelectors:He,get selectors(){return He(Ee)},selectSlice:Ee}}const ee={name:m,reducer:U,actions:k.actionCreators,caseReducers:k.sliceCaseReducersByName,getInitialState:te,...Q(_),injectInto(re,{reducerPath:xe,...Ee}={}){const He=xe??_;return re.inject({reducerPath:He,reducer:U},Ee),{...ee,...Q(He,!0)}}};return ee}}function eW(e,t,r,o){function u(m,..._){let b=t(m);return typeof b>"u"&&o&&(b=r()),e(b,..._)}return u.unwrapped=e,u}var Yz=Q9();function tW(){function e(t,r){return{_reducerDefinitionType:"asyncThunk",payloadCreator:t,...r}}return e.withTypes=()=>e,{reducer(t){return Object.assign({[t.name](...r){return t(...r)}}[t.name],{_reducerDefinitionType:"reducer"})},preparedReducer(t,r){return{_reducerDefinitionType:"reducerWithPrepare",prepare:t,reducer:r}},asyncThunk:e}}function nW({type:e,reducerName:t,createNotation:r},o,u){let m,_;if("reducer"in o){if(r&&!iW(o))throw new Error(Na(17));m=o.reducer,_=o.prepare}else m=o;u.addCase(e,m).exposeCaseReducer(t,m).exposeAction(t,_?TN(e,_):TN(e))}function rW(e){return e._reducerDefinitionType==="asyncThunk"}function iW(e){return e._reducerDefinitionType==="reducerWithPrepare"}function sW({type:e,reducerName:t},r,o,u){if(!u)throw new Error(Na(18));const{payloadCreator:m,fulfilled:_,pending:b,rejected:s,settled:k,options:O}=r,F=u(e,m,O);o.exposeAction(t,F),_&&o.addCase(F.fulfilled,_),b&&o.addCase(F.pending,b),s&&o.addCase(F.rejected,s),k&&o.addMatcher(F.settled,k),o.exposeCaseReducer(t,{fulfilled:_||dv,pending:b||dv,rejected:s||dv,settled:k||dv})}function dv(){}function Na(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}const oW={user:null},Kz=Yz({name:"user",initialState:oW,reducers:{setUserValue:(e,t)=>{e.user=t.payload},resetUserValue:e=>{e.user=null}}}),{setUserValue:fm,resetUserValue:nm}=Kz.actions,aW=Kz.reducer,js={category:[{value:"economy",label:"Economy/Budget"},{value:"mid-range",label:"Mid-Range"},{value:"luxury",label:"Luxury"}],budget:[{value:5e4,label:"Upto LKR 50,000"},{value:1e5,label:"Upto LKR 100,000"},{value:2e5,label:"Upto LKR 200,000"},{value:5e5,label:"Upto LKR 500,000"},{value:1e6,label:"Upto LKR 1,000,000"}],languages:[{value:"english",label:"English"},{value:"spanish",label:"Spanish"},{value:"german",label:"German"},{value:"japanese",label:"Japanese"},{value:"chinese",label:"Chinese"},{value:"portuguese",label:"Portuguese"},{value:"italian",label:"Italian"},{value:"russian",label:"Russian"},{value:"french",label:"French"},{value:"hindi",label:"Hindi"}],environments:["beach","forest","cultural","religious","mountain","urban","rural","lake","river","countryside","island","historical","wildlife","safari","adventure"]},lW={locations:[],distanceAndDurations:[],questionnaire:{people:1,arrival:new Date,days:1,budget:js.budget[0].value,language:js.languages[0].value,environment:[]},summery:{accommodations:[],accommodationPrices:[],guide:null,guidePrice:0}},Jz=Yz({name:"trip",initialState:lW,reducers:{addOrRemoveLocation:(e,t)=>{const r=e.locations.findIndex(o=>o.id===t.payload.id);r===-1?e.locations.push(t.payload):e.locations.splice(r,1)},clearLocations:e=>{e.locations=[]},setTrip:(e,t)=>{e.locations=t.payload},setDistanceAndDurations:(e,t)=>{e.distanceAndDurations=t.payload},resetDistanceAndDurations:e=>{e.distanceAndDurations=[]},setQuestionnaire:(e,t)=>{const{key:r,value:o}=t.payload;e.questionnaire[r]=o},resetQuestionnaire:e=>{e.questionnaire={people:1,arrival:new Date().getUTCDate(),days:1,budget:js.budget[0].value,language:js.languages[0].value,environment:[]}},addOrRemoveSummeryGuide:(e,t)=>{e.summery.guide===t.payload.id?(e.summery.guide=null,e.summery.guidePrice=0):(e.summery.guide=t.payload.id,e.summery.guidePrice=t.payload.price)},addOrRemoveSummerAccommodations:(e,t)=>{const r=e.summery.accommodations.findIndex(o=>o===t.payload.id);r===-1?(e.summery.accommodations.push(t.payload.id),e.summery.accommodationPrices.push(t.payload.price)):(e.summery.accommodations.splice(r,1),e.summery.accommodationPrices.splice(r,1))},resetSummery:e=>{e.summery={accommodations:[],accommodationPrices:[],guide:null,guidePrice:0}}}}),{addOrRemoveLocation:Qz,clearLocations:cW,setTrip:uW,setDistanceAndDurations:dW,resetDistanceAndDurations:e2,setQuestionnaire:ah,resetQuestionnaire:hW,addOrRemoveSummeryGuide:fW,addOrRemoveSummerAccommodations:pW,resetSummery:mW}=Jz.actions,gW=Jz.reducer,yW=Z9({reducer:{user:aW,trip:gW},middleware:e=>e({serializableCheck:!1})});/**
 * @remix-run/router v1.19.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function S_(){return S_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},S_.apply(this,arguments)}var Du;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Du||(Du={}));const PN="popstate";function _W(e){e===void 0&&(e={});function t(o,u){let{pathname:m,search:_,hash:b}=o.location;return cC("",{pathname:m,search:_,hash:b},u.state&&u.state.usr||null,u.state&&u.state.key||"default")}function r(o,u){return typeof u=="string"?u:M1(u)}return vW(t,r,null,e)}function Ai(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function t2(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function xW(){return Math.random().toString(36).substr(2,8)}function MN(e,t){return{usr:e.state,key:e.key,idx:t}}function cC(e,t,r,o){return r===void 0&&(r=null),S_({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?pm(t):t,{state:r,key:t&&t.key||o||xW()})}function M1(e){let{pathname:t="/",search:r="",hash:o=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),o&&o!=="#"&&(t+=o.charAt(0)==="#"?o:"#"+o),t}function pm(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let o=e.indexOf("?");o>=0&&(t.search=e.substr(o),e=e.substr(0,o)),e&&(t.pathname=e)}return t}function vW(e,t,r,o){o===void 0&&(o={});let{window:u=document.defaultView,v5Compat:m=!1}=o,_=u.history,b=Du.Pop,s=null,k=O();k==null&&(k=0,_.replaceState(S_({},_.state,{idx:k}),""));function O(){return(_.state||{idx:null}).idx}function F(){b=Du.Pop;let te=O(),Q=te==null?null:te-k;k=te,s&&s({action:b,location:U.location,delta:Q})}function q(te,Q){b=Du.Push;let ee=cC(U.location,te,Q);k=O()+1;let re=MN(ee,k),xe=U.createHref(ee);try{_.pushState(re,"",xe)}catch(Ee){if(Ee instanceof DOMException&&Ee.name==="DataCloneError")throw Ee;u.location.assign(xe)}m&&s&&s({action:b,location:U.location,delta:1})}function H(te,Q){b=Du.Replace;let ee=cC(U.location,te,Q);k=O();let re=MN(ee,k),xe=U.createHref(ee);_.replaceState(re,"",xe),m&&s&&s({action:b,location:U.location,delta:0})}function J(te){let Q=u.location.origin!=="null"?u.location.origin:u.location.href,ee=typeof te=="string"?te:M1(te);return ee=ee.replace(/ $/,"%20"),Ai(Q,"No window.location.(origin|href) available to create URL for href: "+ee),new URL(ee,Q)}let U={get action(){return b},get location(){return e(u,_)},listen(te){if(s)throw new Error("A history only accepts one active listener");return u.addEventListener(PN,F),s=te,()=>{u.removeEventListener(PN,F),s=null}},createHref(te){return t(u,te)},createURL:J,encodeLocation(te){let Q=J(te);return{pathname:Q.pathname,search:Q.search,hash:Q.hash}},push:q,replace:H,go(te){return _.go(te)}};return U}var AN;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(AN||(AN={}));function bW(e,t,r){return r===void 0&&(r="/"),wW(e,t,r,!1)}function wW(e,t,r,o){let u=typeof t=="string"?pm(t):t,m=iM(u.pathname||"/",r);if(m==null)return null;let _=n2(e);SW(_);let b=null;for(let s=0;b==null&&s<_.length;++s){let k=NW(m);b=RW(_[s],k,o)}return b}function n2(e,t,r,o){t===void 0&&(t=[]),r===void 0&&(r=[]),o===void 0&&(o="");let u=(m,_,b)=>{let s={relativePath:b===void 0?m.path||"":b,caseSensitive:m.caseSensitive===!0,childrenIndex:_,route:m};s.relativePath.startsWith("/")&&(Ai(s.relativePath.startsWith(o),'Absolute route path "'+s.relativePath+'" nested under path '+('"'+o+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),s.relativePath=s.relativePath.slice(o.length));let k=Bu([o,s.relativePath]),O=r.concat(s);m.children&&m.children.length>0&&(Ai(m.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+k+'".')),n2(m.children,t,O,k)),!(m.path==null&&!m.index)&&t.push({path:k,score:IW(k,m.index),routesMeta:O})};return e.forEach((m,_)=>{var b;if(m.path===""||!((b=m.path)!=null&&b.includes("?")))u(m,_);else for(let s of r2(m.path))u(m,_,s)}),t}function r2(e){let t=e.split("/");if(t.length===0)return[];let[r,...o]=t,u=r.endsWith("?"),m=r.replace(/\?$/,"");if(o.length===0)return u?[m,""]:[m];let _=r2(o.join("/")),b=[];return b.push(..._.map(s=>s===""?m:[m,s].join("/"))),u&&b.push(..._),b.map(s=>e.startsWith("/")&&s===""?"/":s)}function SW(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:DW(t.routesMeta.map(o=>o.childrenIndex),r.routesMeta.map(o=>o.childrenIndex)))}const TW=/^:[\w-]+$/,EW=3,CW=2,PW=1,MW=10,AW=-2,IN=e=>e==="*";function IW(e,t){let r=e.split("/"),o=r.length;return r.some(IN)&&(o+=AW),t&&(o+=CW),r.filter(u=>!IN(u)).reduce((u,m)=>u+(TW.test(m)?EW:m===""?PW:MW),o)}function DW(e,t){return e.length===t.length&&e.slice(0,-1).every((o,u)=>o===t[u])?e[e.length-1]-t[t.length-1]:0}function RW(e,t,r){let{routesMeta:o}=e,u={},m="/",_=[];for(let b=0;b<o.length;++b){let s=o[b],k=b===o.length-1,O=m==="/"?t:t.slice(m.length)||"/",F=DN({path:s.relativePath,caseSensitive:s.caseSensitive,end:k},O),q=s.route;if(!F&&k&&r&&!o[o.length-1].route.index&&(F=DN({path:s.relativePath,caseSensitive:s.caseSensitive,end:!1},O)),!F)return null;Object.assign(u,F.params),_.push({params:u,pathname:Bu([m,F.pathname]),pathnameBase:zW(Bu([m,F.pathnameBase])),route:q}),F.pathnameBase!=="/"&&(m=Bu([m,F.pathnameBase]))}return _}function DN(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,o]=kW(e.path,e.caseSensitive,e.end),u=t.match(r);if(!u)return null;let m=u[0],_=m.replace(/(.)\/+$/,"$1"),b=u.slice(1);return{params:o.reduce((k,O,F)=>{let{paramName:q,isOptional:H}=O;if(q==="*"){let U=b[F]||"";_=m.slice(0,m.length-U.length).replace(/(.)\/+$/,"$1")}const J=b[F];return H&&!J?k[q]=void 0:k[q]=(J||"").replace(/%2F/g,"/"),k},{}),pathname:m,pathnameBase:_,pattern:e}}function kW(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),t2(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let o=[],u="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(_,b,s)=>(o.push({paramName:b,isOptional:s!=null}),s?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(o.push({paramName:"*"}),u+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?u+="\\/*$":e!==""&&e!=="/"&&(u+="(?:(?=\\/|$))"),[new RegExp(u,t?void 0:"i"),o]}function NW(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return t2(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function iM(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,o=e.charAt(r);return o&&o!=="/"?null:e.slice(r)||"/"}function LW(e,t){t===void 0&&(t="/");let{pathname:r,search:o="",hash:u=""}=typeof e=="string"?pm(e):e;return{pathname:r?r.startsWith("/")?r:OW(r,t):t,search:FW(o),hash:BW(u)}}function OW(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(u=>{u===".."?r.length>1&&r.pop():u!=="."&&r.push(u)}),r.length>1?r.join("/"):"/"}function xT(e,t,r,o){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(o)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function jW(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function sM(e,t){let r=jW(e);return t?r.map((o,u)=>u===r.length-1?o.pathname:o.pathnameBase):r.map(o=>o.pathnameBase)}function oM(e,t,r,o){o===void 0&&(o=!1);let u;typeof e=="string"?u=pm(e):(u=S_({},e),Ai(!u.pathname||!u.pathname.includes("?"),xT("?","pathname","search",u)),Ai(!u.pathname||!u.pathname.includes("#"),xT("#","pathname","hash",u)),Ai(!u.search||!u.search.includes("#"),xT("#","search","hash",u)));let m=e===""||u.pathname==="",_=m?"/":u.pathname,b;if(_==null)b=r;else{let F=t.length-1;if(!o&&_.startsWith("..")){let q=_.split("/");for(;q[0]==="..";)q.shift(),F-=1;u.pathname=q.join("/")}b=F>=0?t[F]:"/"}let s=LW(u,b),k=_&&_!=="/"&&_.endsWith("/"),O=(m||_===".")&&r.endsWith("/");return!s.pathname.endsWith("/")&&(k||O)&&(s.pathname+="/"),s}const Bu=e=>e.join("/").replace(/\/\/+/g,"/"),zW=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),FW=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,BW=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function VW(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const i2=["post","put","patch","delete"];new Set(i2);const UW=["get",...i2];new Set(UW);/**
 * React Router v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function T_(){return T_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},T_.apply(this,arguments)}const aM=W.createContext(null),$W=W.createContext(null),od=W.createContext(null),yb=W.createContext(null),gc=W.createContext({outlet:null,matches:[],isDataRoute:!1}),s2=W.createContext(null);function GW(e,t){let{relative:r}=t===void 0?{}:t;mm()||Ai(!1);let{basename:o,navigator:u}=W.useContext(od),{hash:m,pathname:_,search:b}=a2(e,{relative:r}),s=_;return o!=="/"&&(s=_==="/"?o:Bu([o,_])),u.createHref({pathname:s,search:b,hash:m})}function mm(){return W.useContext(yb)!=null}function ad(){return mm()||Ai(!1),W.useContext(yb).location}function o2(e){W.useContext(od).static||W.useLayoutEffect(e)}function yc(){let{isDataRoute:e}=W.useContext(gc);return e?sH():WW()}function WW(){mm()||Ai(!1);let e=W.useContext(aM),{basename:t,future:r,navigator:o}=W.useContext(od),{matches:u}=W.useContext(gc),{pathname:m}=ad(),_=JSON.stringify(sM(u,r.v7_relativeSplatPath)),b=W.useRef(!1);return o2(()=>{b.current=!0}),W.useCallback(function(k,O){if(O===void 0&&(O={}),!b.current)return;if(typeof k=="number"){o.go(k);return}let F=oM(k,JSON.parse(_),m,O.relative==="path");e==null&&t!=="/"&&(F.pathname=F.pathname==="/"?t:Bu([t,F.pathname])),(O.replace?o.replace:o.push)(F,O.state,O)},[t,o,_,m,e])}const HW=W.createContext(null);function qW(e){let t=W.useContext(gc).outlet;return t&&W.createElement(HW.Provider,{value:e},t)}function a2(e,t){let{relative:r}=t===void 0?{}:t,{future:o}=W.useContext(od),{matches:u}=W.useContext(gc),{pathname:m}=ad(),_=JSON.stringify(sM(u,o.v7_relativeSplatPath));return W.useMemo(()=>oM(e,JSON.parse(_),m,r==="path"),[e,_,m,r])}function ZW(e,t){return XW(e,t)}function XW(e,t,r,o){mm()||Ai(!1);let{navigator:u}=W.useContext(od),{matches:m}=W.useContext(gc),_=m[m.length-1],b=_?_.params:{};_&&_.pathname;let s=_?_.pathnameBase:"/";_&&_.route;let k=ad(),O;if(t){var F;let te=typeof t=="string"?pm(t):t;s==="/"||(F=te.pathname)!=null&&F.startsWith(s)||Ai(!1),O=te}else O=k;let q=O.pathname||"/",H=q;if(s!=="/"){let te=s.replace(/^\//,"").split("/");H="/"+q.replace(/^\//,"").split("/").slice(te.length).join("/")}let J=bW(e,{pathname:H}),U=eH(J&&J.map(te=>Object.assign({},te,{params:Object.assign({},b,te.params),pathname:Bu([s,u.encodeLocation?u.encodeLocation(te.pathname).pathname:te.pathname]),pathnameBase:te.pathnameBase==="/"?s:Bu([s,u.encodeLocation?u.encodeLocation(te.pathnameBase).pathname:te.pathnameBase])})),m,r,o);return t&&U?W.createElement(yb.Provider,{value:{location:T_({pathname:"/",search:"",hash:"",state:null,key:"default"},O),navigationType:Du.Pop}},U):U}function YW(){let e=iH(),t=VW(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,u={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return W.createElement(W.Fragment,null,W.createElement("h2",null,"Unexpected Application Error!"),W.createElement("h3",{style:{fontStyle:"italic"}},t),r?W.createElement("pre",{style:u},r):null,null)}const KW=W.createElement(YW,null);class JW extends W.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?W.createElement(gc.Provider,{value:this.props.routeContext},W.createElement(s2.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function QW(e){let{routeContext:t,match:r,children:o}=e,u=W.useContext(aM);return u&&u.static&&u.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(u.staticContext._deepestRenderedBoundaryId=r.route.id),W.createElement(gc.Provider,{value:t},o)}function eH(e,t,r,o){var u;if(t===void 0&&(t=[]),r===void 0&&(r=null),o===void 0&&(o=null),e==null){var m;if(!r)return null;if(r.errors)e=r.matches;else if((m=o)!=null&&m.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let _=e,b=(u=r)==null?void 0:u.errors;if(b!=null){let O=_.findIndex(F=>F.route.id&&(b==null?void 0:b[F.route.id])!==void 0);O>=0||Ai(!1),_=_.slice(0,Math.min(_.length,O+1))}let s=!1,k=-1;if(r&&o&&o.v7_partialHydration)for(let O=0;O<_.length;O++){let F=_[O];if((F.route.HydrateFallback||F.route.hydrateFallbackElement)&&(k=O),F.route.id){let{loaderData:q,errors:H}=r,J=F.route.loader&&q[F.route.id]===void 0&&(!H||H[F.route.id]===void 0);if(F.route.lazy||J){s=!0,k>=0?_=_.slice(0,k+1):_=[_[0]];break}}}return _.reduceRight((O,F,q)=>{let H,J=!1,U=null,te=null;r&&(H=b&&F.route.id?b[F.route.id]:void 0,U=F.route.errorElement||KW,s&&(k<0&&q===0?(J=!0,te=null):k===q&&(J=!0,te=F.route.hydrateFallbackElement||null)));let Q=t.concat(_.slice(0,q+1)),ee=()=>{let re;return H?re=U:J?re=te:F.route.Component?re=W.createElement(F.route.Component,null):F.route.element?re=F.route.element:re=O,W.createElement(QW,{match:F,routeContext:{outlet:O,matches:Q,isDataRoute:r!=null},children:re})};return r&&(F.route.ErrorBoundary||F.route.errorElement||q===0)?W.createElement(JW,{location:r.location,revalidation:r.revalidation,component:U,error:H,children:ee(),routeContext:{outlet:null,matches:Q,isDataRoute:!0}}):ee()},null)}var l2=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(l2||{}),A1=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(A1||{});function tH(e){let t=W.useContext(aM);return t||Ai(!1),t}function nH(e){let t=W.useContext($W);return t||Ai(!1),t}function rH(e){let t=W.useContext(gc);return t||Ai(!1),t}function c2(e){let t=rH(),r=t.matches[t.matches.length-1];return r.route.id||Ai(!1),r.route.id}function iH(){var e;let t=W.useContext(s2),r=nH(A1.UseRouteError),o=c2(A1.UseRouteError);return t!==void 0?t:(e=r.errors)==null?void 0:e[o]}function sH(){let{router:e}=tH(l2.UseNavigateStable),t=c2(A1.UseNavigateStable),r=W.useRef(!1);return o2(()=>{r.current=!0}),W.useCallback(function(u,m){m===void 0&&(m={}),r.current&&(typeof u=="number"?e.navigate(u):e.navigate(u,T_({fromRouteId:t},m)))},[e,t])}function qy(e){let{to:t,replace:r,state:o,relative:u}=e;mm()||Ai(!1);let{future:m,static:_}=W.useContext(od),{matches:b}=W.useContext(gc),{pathname:s}=ad(),k=yc(),O=oM(t,sM(b,m.v7_relativeSplatPath),s,u==="path"),F=JSON.stringify(O);return W.useEffect(()=>k(JSON.parse(F),{replace:r,state:o,relative:u}),[k,F,u,r,o]),null}function Uv(e){return qW(e.context)}function vr(e){Ai(!1)}function oH(e){let{basename:t="/",children:r=null,location:o,navigationType:u=Du.Pop,navigator:m,static:_=!1,future:b}=e;mm()&&Ai(!1);let s=t.replace(/^\/*/,"/"),k=W.useMemo(()=>({basename:s,navigator:m,static:_,future:T_({v7_relativeSplatPath:!1},b)}),[s,b,m,_]);typeof o=="string"&&(o=pm(o));let{pathname:O="/",search:F="",hash:q="",state:H=null,key:J="default"}=o,U=W.useMemo(()=>{let te=iM(O,s);return te==null?null:{location:{pathname:te,search:F,hash:q,state:H,key:J},navigationType:u}},[s,O,F,q,H,J,u]);return U==null?null:W.createElement(od.Provider,{value:k},W.createElement(yb.Provider,{children:r,value:U}))}function aH(e){let{children:t,location:r}=e;return ZW(uC(t),r)}new Promise(()=>{});function uC(e,t){t===void 0&&(t=[]);let r=[];return W.Children.forEach(e,(o,u)=>{if(!W.isValidElement(o))return;let m=[...t,u];if(o.type===W.Fragment){r.push.apply(r,uC(o.props.children,m));return}o.type!==vr&&Ai(!1),!o.props.index||!o.props.children||Ai(!1);let _={id:o.props.id||m.join("-"),caseSensitive:o.props.caseSensitive,element:o.props.element,Component:o.props.Component,index:o.props.index,path:o.props.path,loader:o.props.loader,action:o.props.action,errorElement:o.props.errorElement,ErrorBoundary:o.props.ErrorBoundary,hasErrorBoundary:o.props.ErrorBoundary!=null||o.props.errorElement!=null,shouldRevalidate:o.props.shouldRevalidate,handle:o.props.handle,lazy:o.props.lazy};o.props.children&&(_.children=uC(o.props.children,m)),r.push(_)}),r}/**
 * React Router DOM v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function dC(){return dC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},dC.apply(this,arguments)}function lH(e,t){if(e==null)return{};var r={},o=Object.keys(e),u,m;for(m=0;m<o.length;m++)u=o[m],!(t.indexOf(u)>=0)&&(r[u]=e[u]);return r}function cH(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function uH(e,t){return e.button===0&&(!t||t==="_self")&&!cH(e)}function hC(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,r)=>{let o=e[r];return t.concat(Array.isArray(o)?o.map(u=>[r,u]):[[r,o]])},[]))}function dH(e,t){let r=hC(e);return t&&t.forEach((o,u)=>{r.has(u)||t.getAll(u).forEach(m=>{r.append(u,m)})}),r}const hH=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],fH="6";try{window.__reactRouterVersion=fH}catch{}const pH="startTransition",RN=Jv[pH];function mH(e){let{basename:t,children:r,future:o,window:u}=e,m=W.useRef();m.current==null&&(m.current=_W({window:u,v5Compat:!0}));let _=m.current,[b,s]=W.useState({action:_.action,location:_.location}),{v7_startTransition:k}=o||{},O=W.useCallback(F=>{k&&RN?RN(()=>s(F)):s(F)},[s,k]);return W.useLayoutEffect(()=>_.listen(O),[_,O]),W.createElement(oH,{basename:t,children:r,location:b.location,navigationType:b.action,navigator:_,future:o})}const gH=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",yH=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ui=W.forwardRef(function(t,r){let{onClick:o,relative:u,reloadDocument:m,replace:_,state:b,target:s,to:k,preventScrollReset:O,unstable_viewTransition:F}=t,q=lH(t,hH),{basename:H}=W.useContext(od),J,U=!1;if(typeof k=="string"&&yH.test(k)&&(J=k,gH))try{let re=new URL(window.location.href),xe=k.startsWith("//")?new URL(re.protocol+k):new URL(k),Ee=iM(xe.pathname,H);xe.origin===re.origin&&Ee!=null?k=Ee+xe.search+xe.hash:U=!0}catch{}let te=GW(k,{relative:u}),Q=_H(k,{replace:_,state:b,target:s,preventScrollReset:O,relative:u,unstable_viewTransition:F});function ee(re){o&&o(re),re.defaultPrevented||Q(re)}return W.createElement("a",dC({},q,{href:J||te,onClick:U||m?o:ee,ref:r,target:s}))});var kN;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(kN||(kN={}));var NN;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(NN||(NN={}));function _H(e,t){let{target:r,replace:o,state:u,preventScrollReset:m,relative:_,unstable_viewTransition:b}=t===void 0?{}:t,s=yc(),k=ad(),O=a2(e,{relative:_});return W.useCallback(F=>{if(uH(F,r)){F.preventDefault();let q=o!==void 0?o:M1(k)===M1(O);s(e,{replace:q,state:u,preventScrollReset:m,relative:_,unstable_viewTransition:b})}},[k,s,O,o,u,r,e,m,_,b])}function u2(e){let t=W.useRef(hC(e)),r=W.useRef(!1),o=ad(),u=W.useMemo(()=>dH(o.search,r.current?null:t.current),[o.search]),m=yc(),_=W.useCallback((b,s)=>{const k=hC(typeof b=="function"?b(u):b);r.current=!0,m("?"+k,s)},[m,u]);return[u,_]}function d2(e,t){return function(){return e.apply(t,arguments)}}const{toString:xH}=Object.prototype,{getPrototypeOf:lM}=Object,_b=(e=>t=>{const r=xH.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Ba=e=>(e=e.toLowerCase(),t=>_b(t)===e),xb=e=>t=>typeof t===e,{isArray:gm}=Array,E_=xb("undefined");function vH(e){return e!==null&&!E_(e)&&e.constructor!==null&&!E_(e.constructor)&&So(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const h2=Ba("ArrayBuffer");function bH(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&h2(e.buffer),t}const wH=xb("string"),So=xb("function"),f2=xb("number"),vb=e=>e!==null&&typeof e=="object",SH=e=>e===!0||e===!1,$v=e=>{if(_b(e)!=="object")return!1;const t=lM(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},TH=Ba("Date"),EH=Ba("File"),CH=Ba("Blob"),PH=Ba("FileList"),MH=e=>vb(e)&&So(e.pipe),AH=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||So(e.append)&&((t=_b(e))==="formdata"||t==="object"&&So(e.toString)&&e.toString()==="[object FormData]"))},IH=Ba("URLSearchParams"),[DH,RH,kH,NH]=["ReadableStream","Request","Response","Headers"].map(Ba),LH=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function G_(e,t,{allOwnKeys:r=!1}={}){if(e===null||typeof e>"u")return;let o,u;if(typeof e!="object"&&(e=[e]),gm(e))for(o=0,u=e.length;o<u;o++)t.call(null,e[o],o,e);else{const m=r?Object.getOwnPropertyNames(e):Object.keys(e),_=m.length;let b;for(o=0;o<_;o++)b=m[o],t.call(null,e[b],b,e)}}function p2(e,t){t=t.toLowerCase();const r=Object.keys(e);let o=r.length,u;for(;o-- >0;)if(u=r[o],t===u.toLowerCase())return u;return null}const _h=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,m2=e=>!E_(e)&&e!==_h;function fC(){const{caseless:e}=m2(this)&&this||{},t={},r=(o,u)=>{const m=e&&p2(t,u)||u;$v(t[m])&&$v(o)?t[m]=fC(t[m],o):$v(o)?t[m]=fC({},o):gm(o)?t[m]=o.slice():t[m]=o};for(let o=0,u=arguments.length;o<u;o++)arguments[o]&&G_(arguments[o],r);return t}const OH=(e,t,r,{allOwnKeys:o}={})=>(G_(t,(u,m)=>{r&&So(u)?e[m]=d2(u,r):e[m]=u},{allOwnKeys:o}),e),jH=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),zH=(e,t,r,o)=>{e.prototype=Object.create(t.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},FH=(e,t,r,o)=>{let u,m,_;const b={};if(t=t||{},e==null)return t;do{for(u=Object.getOwnPropertyNames(e),m=u.length;m-- >0;)_=u[m],(!o||o(_,e,t))&&!b[_]&&(t[_]=e[_],b[_]=!0);e=r!==!1&&lM(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},BH=(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const o=e.indexOf(t,r);return o!==-1&&o===r},VH=e=>{if(!e)return null;if(gm(e))return e;let t=e.length;if(!f2(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},UH=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&lM(Uint8Array)),$H=(e,t)=>{const o=(e&&e[Symbol.iterator]).call(e);let u;for(;(u=o.next())&&!u.done;){const m=u.value;t.call(e,m[0],m[1])}},GH=(e,t)=>{let r;const o=[];for(;(r=e.exec(t))!==null;)o.push(r);return o},WH=Ba("HTMLFormElement"),HH=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,o,u){return o.toUpperCase()+u}),LN=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),qH=Ba("RegExp"),g2=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),o={};G_(r,(u,m)=>{let _;(_=t(u,m,e))!==!1&&(o[m]=_||u)}),Object.defineProperties(e,o)},ZH=e=>{g2(e,(t,r)=>{if(So(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const o=e[r];if(So(o)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},XH=(e,t)=>{const r={},o=u=>{u.forEach(m=>{r[m]=!0})};return gm(e)?o(e):o(String(e).split(t)),r},YH=()=>{},KH=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,vT="abcdefghijklmnopqrstuvwxyz",ON="0123456789",y2={DIGIT:ON,ALPHA:vT,ALPHA_DIGIT:vT+vT.toUpperCase()+ON},JH=(e=16,t=y2.ALPHA_DIGIT)=>{let r="";const{length:o}=t;for(;e--;)r+=t[Math.random()*o|0];return r};function QH(e){return!!(e&&So(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])}const eq=e=>{const t=new Array(10),r=(o,u)=>{if(vb(o)){if(t.indexOf(o)>=0)return;if(!("toJSON"in o)){t[u]=o;const m=gm(o)?[]:{};return G_(o,(_,b)=>{const s=r(_,u+1);!E_(s)&&(m[b]=s)}),t[u]=void 0,m}}return o};return r(e,0)},tq=Ba("AsyncFunction"),nq=e=>e&&(vb(e)||So(e))&&So(e.then)&&So(e.catch),_2=((e,t)=>e?setImmediate:t?((r,o)=>(_h.addEventListener("message",({source:u,data:m})=>{u===_h&&m===r&&o.length&&o.shift()()},!1),u=>{o.push(u),_h.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",So(_h.postMessage)),rq=typeof queueMicrotask<"u"?queueMicrotask.bind(_h):typeof process<"u"&&process.nextTick||_2,wt={isArray:gm,isArrayBuffer:h2,isBuffer:vH,isFormData:AH,isArrayBufferView:bH,isString:wH,isNumber:f2,isBoolean:SH,isObject:vb,isPlainObject:$v,isReadableStream:DH,isRequest:RH,isResponse:kH,isHeaders:NH,isUndefined:E_,isDate:TH,isFile:EH,isBlob:CH,isRegExp:qH,isFunction:So,isStream:MH,isURLSearchParams:IH,isTypedArray:UH,isFileList:PH,forEach:G_,merge:fC,extend:OH,trim:LH,stripBOM:jH,inherits:zH,toFlatObject:FH,kindOf:_b,kindOfTest:Ba,endsWith:BH,toArray:VH,forEachEntry:$H,matchAll:GH,isHTMLForm:WH,hasOwnProperty:LN,hasOwnProp:LN,reduceDescriptors:g2,freezeMethods:ZH,toObjectSet:XH,toCamelCase:HH,noop:YH,toFiniteNumber:KH,findKey:p2,global:_h,isContextDefined:m2,ALPHABET:y2,generateString:JH,isSpecCompliantForm:QH,toJSONObject:eq,isAsyncFn:tq,isThenable:nq,setImmediate:_2,asap:rq};function Hn(e,t,r,o,u){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),o&&(this.request=o),u&&(this.response=u,this.status=u.status?u.status:null)}wt.inherits(Hn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:wt.toJSONObject(this.config),code:this.code,status:this.status}}});const x2=Hn.prototype,v2={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{v2[e]={value:e}});Object.defineProperties(Hn,v2);Object.defineProperty(x2,"isAxiosError",{value:!0});Hn.from=(e,t,r,o,u,m)=>{const _=Object.create(x2);return wt.toFlatObject(e,_,function(s){return s!==Error.prototype},b=>b!=="isAxiosError"),Hn.call(_,e.message,t,r,o,u),_.cause=e,_.name=e.name,m&&Object.assign(_,m),_};const iq=null;function pC(e){return wt.isPlainObject(e)||wt.isArray(e)}function b2(e){return wt.endsWith(e,"[]")?e.slice(0,-2):e}function jN(e,t,r){return e?e.concat(t).map(function(u,m){return u=b2(u),!r&&m?"["+u+"]":u}).join(r?".":""):t}function sq(e){return wt.isArray(e)&&!e.some(pC)}const oq=wt.toFlatObject(wt,{},null,function(t){return/^is[A-Z]/.test(t)});function bb(e,t,r){if(!wt.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,r=wt.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(U,te){return!wt.isUndefined(te[U])});const o=r.metaTokens,u=r.visitor||O,m=r.dots,_=r.indexes,s=(r.Blob||typeof Blob<"u"&&Blob)&&wt.isSpecCompliantForm(t);if(!wt.isFunction(u))throw new TypeError("visitor must be a function");function k(J){if(J===null)return"";if(wt.isDate(J))return J.toISOString();if(!s&&wt.isBlob(J))throw new Hn("Blob is not supported. Use a Buffer instead.");return wt.isArrayBuffer(J)||wt.isTypedArray(J)?s&&typeof Blob=="function"?new Blob([J]):Buffer.from(J):J}function O(J,U,te){let Q=J;if(J&&!te&&typeof J=="object"){if(wt.endsWith(U,"{}"))U=o?U:U.slice(0,-2),J=JSON.stringify(J);else if(wt.isArray(J)&&sq(J)||(wt.isFileList(J)||wt.endsWith(U,"[]"))&&(Q=wt.toArray(J)))return U=b2(U),Q.forEach(function(re,xe){!(wt.isUndefined(re)||re===null)&&t.append(_===!0?jN([U],xe,m):_===null?U:U+"[]",k(re))}),!1}return pC(J)?!0:(t.append(jN(te,U,m),k(J)),!1)}const F=[],q=Object.assign(oq,{defaultVisitor:O,convertValue:k,isVisitable:pC});function H(J,U){if(!wt.isUndefined(J)){if(F.indexOf(J)!==-1)throw Error("Circular reference detected in "+U.join("."));F.push(J),wt.forEach(J,function(Q,ee){(!(wt.isUndefined(Q)||Q===null)&&u.call(t,Q,wt.isString(ee)?ee.trim():ee,U,q))===!0&&H(Q,U?U.concat(ee):[ee])}),F.pop()}}if(!wt.isObject(e))throw new TypeError("data must be an object");return H(e),t}function zN(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(o){return t[o]})}function cM(e,t){this._pairs=[],e&&bb(e,this,t)}const w2=cM.prototype;w2.append=function(t,r){this._pairs.push([t,r])};w2.toString=function(t){const r=t?function(o){return t.call(this,o,zN)}:zN;return this._pairs.map(function(u){return r(u[0])+"="+r(u[1])},"").join("&")};function aq(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function S2(e,t,r){if(!t)return e;const o=r&&r.encode||aq,u=r&&r.serialize;let m;if(u?m=u(t,r):m=wt.isURLSearchParams(t)?t.toString():new cM(t,r).toString(o),m){const _=e.indexOf("#");_!==-1&&(e=e.slice(0,_)),e+=(e.indexOf("?")===-1?"?":"&")+m}return e}class FN{constructor(){this.handlers=[]}use(t,r,o){return this.handlers.push({fulfilled:t,rejected:r,synchronous:o?o.synchronous:!1,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){wt.forEach(this.handlers,function(o){o!==null&&t(o)})}}const T2={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},lq=typeof URLSearchParams<"u"?URLSearchParams:cM,cq=typeof FormData<"u"?FormData:null,uq=typeof Blob<"u"?Blob:null,dq={isBrowser:!0,classes:{URLSearchParams:lq,FormData:cq,Blob:uq},protocols:["http","https","file","blob","url","data"]},uM=typeof window<"u"&&typeof document<"u",mC=typeof navigator=="object"&&navigator||void 0,hq=uM&&(!mC||["ReactNative","NativeScript","NS"].indexOf(mC.product)<0),fq=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",pq=uM&&window.location.href||"http://localhost",mq=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:uM,hasStandardBrowserEnv:hq,hasStandardBrowserWebWorkerEnv:fq,navigator:mC,origin:pq},Symbol.toStringTag,{value:"Module"})),Qs={...mq,...dq};function gq(e,t){return bb(e,new Qs.classes.URLSearchParams,Object.assign({visitor:function(r,o,u,m){return Qs.isNode&&wt.isBuffer(r)?(this.append(o,r.toString("base64")),!1):m.defaultVisitor.apply(this,arguments)}},t))}function yq(e){return wt.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function _q(e){const t={},r=Object.keys(e);let o;const u=r.length;let m;for(o=0;o<u;o++)m=r[o],t[m]=e[m];return t}function E2(e){function t(r,o,u,m){let _=r[m++];if(_==="__proto__")return!0;const b=Number.isFinite(+_),s=m>=r.length;return _=!_&&wt.isArray(u)?u.length:_,s?(wt.hasOwnProp(u,_)?u[_]=[u[_],o]:u[_]=o,!b):((!u[_]||!wt.isObject(u[_]))&&(u[_]=[]),t(r,o,u[_],m)&&wt.isArray(u[_])&&(u[_]=_q(u[_])),!b)}if(wt.isFormData(e)&&wt.isFunction(e.entries)){const r={};return wt.forEachEntry(e,(o,u)=>{t(yq(o),u,r,0)}),r}return null}function xq(e,t,r){if(wt.isString(e))try{return(t||JSON.parse)(e),wt.trim(e)}catch(o){if(o.name!=="SyntaxError")throw o}return(0,JSON.stringify)(e)}const W_={transitional:T2,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const o=r.getContentType()||"",u=o.indexOf("application/json")>-1,m=wt.isObject(t);if(m&&wt.isHTMLForm(t)&&(t=new FormData(t)),wt.isFormData(t))return u?JSON.stringify(E2(t)):t;if(wt.isArrayBuffer(t)||wt.isBuffer(t)||wt.isStream(t)||wt.isFile(t)||wt.isBlob(t)||wt.isReadableStream(t))return t;if(wt.isArrayBufferView(t))return t.buffer;if(wt.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let b;if(m){if(o.indexOf("application/x-www-form-urlencoded")>-1)return gq(t,this.formSerializer).toString();if((b=wt.isFileList(t))||o.indexOf("multipart/form-data")>-1){const s=this.env&&this.env.FormData;return bb(b?{"files[]":t}:t,s&&new s,this.formSerializer)}}return m||u?(r.setContentType("application/json",!1),xq(t)):t}],transformResponse:[function(t){const r=this.transitional||W_.transitional,o=r&&r.forcedJSONParsing,u=this.responseType==="json";if(wt.isResponse(t)||wt.isReadableStream(t))return t;if(t&&wt.isString(t)&&(o&&!this.responseType||u)){const _=!(r&&r.silentJSONParsing)&&u;try{return JSON.parse(t)}catch(b){if(_)throw b.name==="SyntaxError"?Hn.from(b,Hn.ERR_BAD_RESPONSE,this,null,this.response):b}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Qs.classes.FormData,Blob:Qs.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};wt.forEach(["delete","get","head","post","put","patch"],e=>{W_.headers[e]={}});const vq=wt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),bq=e=>{const t={};let r,o,u;return e&&e.split(`
`).forEach(function(_){u=_.indexOf(":"),r=_.substring(0,u).trim().toLowerCase(),o=_.substring(u+1).trim(),!(!r||t[r]&&vq[r])&&(r==="set-cookie"?t[r]?t[r].push(o):t[r]=[o]:t[r]=t[r]?t[r]+", "+o:o)}),t},BN=Symbol("internals");function xy(e){return e&&String(e).trim().toLowerCase()}function Gv(e){return e===!1||e==null?e:wt.isArray(e)?e.map(Gv):String(e)}function wq(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let o;for(;o=r.exec(e);)t[o[1]]=o[2];return t}const Sq=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function bT(e,t,r,o,u){if(wt.isFunction(o))return o.call(this,t,r);if(u&&(t=r),!!wt.isString(t)){if(wt.isString(o))return t.indexOf(o)!==-1;if(wt.isRegExp(o))return o.test(t)}}function Tq(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,o)=>r.toUpperCase()+o)}function Eq(e,t){const r=wt.toCamelCase(" "+t);["get","set","has"].forEach(o=>{Object.defineProperty(e,o+r,{value:function(u,m,_){return this[o].call(this,t,u,m,_)},configurable:!0})})}class eo{constructor(t){t&&this.set(t)}set(t,r,o){const u=this;function m(b,s,k){const O=xy(s);if(!O)throw new Error("header name must be a non-empty string");const F=wt.findKey(u,O);(!F||u[F]===void 0||k===!0||k===void 0&&u[F]!==!1)&&(u[F||s]=Gv(b))}const _=(b,s)=>wt.forEach(b,(k,O)=>m(k,O,s));if(wt.isPlainObject(t)||t instanceof this.constructor)_(t,r);else if(wt.isString(t)&&(t=t.trim())&&!Sq(t))_(bq(t),r);else if(wt.isHeaders(t))for(const[b,s]of t.entries())m(s,b,o);else t!=null&&m(r,t,o);return this}get(t,r){if(t=xy(t),t){const o=wt.findKey(this,t);if(o){const u=this[o];if(!r)return u;if(r===!0)return wq(u);if(wt.isFunction(r))return r.call(this,u,o);if(wt.isRegExp(r))return r.exec(u);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=xy(t),t){const o=wt.findKey(this,t);return!!(o&&this[o]!==void 0&&(!r||bT(this,this[o],o,r)))}return!1}delete(t,r){const o=this;let u=!1;function m(_){if(_=xy(_),_){const b=wt.findKey(o,_);b&&(!r||bT(o,o[b],b,r))&&(delete o[b],u=!0)}}return wt.isArray(t)?t.forEach(m):m(t),u}clear(t){const r=Object.keys(this);let o=r.length,u=!1;for(;o--;){const m=r[o];(!t||bT(this,this[m],m,t,!0))&&(delete this[m],u=!0)}return u}normalize(t){const r=this,o={};return wt.forEach(this,(u,m)=>{const _=wt.findKey(o,m);if(_){r[_]=Gv(u),delete r[m];return}const b=t?Tq(m):String(m).trim();b!==m&&delete r[m],r[b]=Gv(u),o[b]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return wt.forEach(this,(o,u)=>{o!=null&&o!==!1&&(r[u]=t&&wt.isArray(o)?o.join(", "):o)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const o=new this(t);return r.forEach(u=>o.set(u)),o}static accessor(t){const o=(this[BN]=this[BN]={accessors:{}}).accessors,u=this.prototype;function m(_){const b=xy(_);o[b]||(Eq(u,_),o[b]=!0)}return wt.isArray(t)?t.forEach(m):m(t),this}}eo.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);wt.reduceDescriptors(eo.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(o){this[r]=o}}});wt.freezeMethods(eo);function wT(e,t){const r=this||W_,o=t||r,u=eo.from(o.headers);let m=o.data;return wt.forEach(e,function(b){m=b.call(r,m,u.normalize(),t?t.status:void 0)}),u.normalize(),m}function C2(e){return!!(e&&e.__CANCEL__)}function ym(e,t,r){Hn.call(this,e??"canceled",Hn.ERR_CANCELED,t,r),this.name="CanceledError"}wt.inherits(ym,Hn,{__CANCEL__:!0});function P2(e,t,r){const o=r.config.validateStatus;!r.status||!o||o(r.status)?e(r):t(new Hn("Request failed with status code "+r.status,[Hn.ERR_BAD_REQUEST,Hn.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function Cq(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function Pq(e,t){e=e||10;const r=new Array(e),o=new Array(e);let u=0,m=0,_;return t=t!==void 0?t:1e3,function(s){const k=Date.now(),O=o[m];_||(_=k),r[u]=s,o[u]=k;let F=m,q=0;for(;F!==u;)q+=r[F++],F=F%e;if(u=(u+1)%e,u===m&&(m=(m+1)%e),k-_<t)return;const H=O&&k-O;return H?Math.round(q*1e3/H):void 0}}function Mq(e,t){let r=0,o=1e3/t,u,m;const _=(k,O=Date.now())=>{r=O,u=null,m&&(clearTimeout(m),m=null),e.apply(null,k)};return[(...k)=>{const O=Date.now(),F=O-r;F>=o?_(k,O):(u=k,m||(m=setTimeout(()=>{m=null,_(u)},o-F)))},()=>u&&_(u)]}const I1=(e,t,r=3)=>{let o=0;const u=Pq(50,250);return Mq(m=>{const _=m.loaded,b=m.lengthComputable?m.total:void 0,s=_-o,k=u(s),O=_<=b;o=_;const F={loaded:_,total:b,progress:b?_/b:void 0,bytes:s,rate:k||void 0,estimated:k&&b&&O?(b-_)/k:void 0,event:m,lengthComputable:b!=null,[t?"download":"upload"]:!0};e(F)},r)},VN=(e,t)=>{const r=e!=null;return[o=>t[0]({lengthComputable:r,total:e,loaded:o}),t[1]]},UN=e=>(...t)=>wt.asap(()=>e(...t)),Aq=Qs.hasStandardBrowserEnv?function(){const t=Qs.navigator&&/(msie|trident)/i.test(Qs.navigator.userAgent),r=document.createElement("a");let o;function u(m){let _=m;return t&&(r.setAttribute("href",_),_=r.href),r.setAttribute("href",_),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return o=u(window.location.href),function(_){const b=wt.isString(_)?u(_):_;return b.protocol===o.protocol&&b.host===o.host}}():function(){return function(){return!0}}(),Iq=Qs.hasStandardBrowserEnv?{write(e,t,r,o,u,m){const _=[e+"="+encodeURIComponent(t)];wt.isNumber(r)&&_.push("expires="+new Date(r).toGMTString()),wt.isString(o)&&_.push("path="+o),wt.isString(u)&&_.push("domain="+u),m===!0&&_.push("secure"),document.cookie=_.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Dq(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function Rq(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function M2(e,t){return e&&!Dq(t)?Rq(e,t):t}const $N=e=>e instanceof eo?{...e}:e;function kh(e,t){t=t||{};const r={};function o(k,O,F){return wt.isPlainObject(k)&&wt.isPlainObject(O)?wt.merge.call({caseless:F},k,O):wt.isPlainObject(O)?wt.merge({},O):wt.isArray(O)?O.slice():O}function u(k,O,F){if(wt.isUndefined(O)){if(!wt.isUndefined(k))return o(void 0,k,F)}else return o(k,O,F)}function m(k,O){if(!wt.isUndefined(O))return o(void 0,O)}function _(k,O){if(wt.isUndefined(O)){if(!wt.isUndefined(k))return o(void 0,k)}else return o(void 0,O)}function b(k,O,F){if(F in t)return o(k,O);if(F in e)return o(void 0,k)}const s={url:m,method:m,data:m,baseURL:_,transformRequest:_,transformResponse:_,paramsSerializer:_,timeout:_,timeoutMessage:_,withCredentials:_,withXSRFToken:_,adapter:_,responseType:_,xsrfCookieName:_,xsrfHeaderName:_,onUploadProgress:_,onDownloadProgress:_,decompress:_,maxContentLength:_,maxBodyLength:_,beforeRedirect:_,transport:_,httpAgent:_,httpsAgent:_,cancelToken:_,socketPath:_,responseEncoding:_,validateStatus:b,headers:(k,O)=>u($N(k),$N(O),!0)};return wt.forEach(Object.keys(Object.assign({},e,t)),function(O){const F=s[O]||u,q=F(e[O],t[O],O);wt.isUndefined(q)&&F!==b||(r[O]=q)}),r}const A2=e=>{const t=kh({},e);let{data:r,withXSRFToken:o,xsrfHeaderName:u,xsrfCookieName:m,headers:_,auth:b}=t;t.headers=_=eo.from(_),t.url=S2(M2(t.baseURL,t.url),e.params,e.paramsSerializer),b&&_.set("Authorization","Basic "+btoa((b.username||"")+":"+(b.password?unescape(encodeURIComponent(b.password)):"")));let s;if(wt.isFormData(r)){if(Qs.hasStandardBrowserEnv||Qs.hasStandardBrowserWebWorkerEnv)_.setContentType(void 0);else if((s=_.getContentType())!==!1){const[k,...O]=s?s.split(";").map(F=>F.trim()).filter(Boolean):[];_.setContentType([k||"multipart/form-data",...O].join("; "))}}if(Qs.hasStandardBrowserEnv&&(o&&wt.isFunction(o)&&(o=o(t)),o||o!==!1&&Aq(t.url))){const k=u&&m&&Iq.read(m);k&&_.set(u,k)}return t},kq=typeof XMLHttpRequest<"u",Nq=kq&&function(e){return new Promise(function(r,o){const u=A2(e);let m=u.data;const _=eo.from(u.headers).normalize();let{responseType:b,onUploadProgress:s,onDownloadProgress:k}=u,O,F,q,H,J;function U(){H&&H(),J&&J(),u.cancelToken&&u.cancelToken.unsubscribe(O),u.signal&&u.signal.removeEventListener("abort",O)}let te=new XMLHttpRequest;te.open(u.method.toUpperCase(),u.url,!0),te.timeout=u.timeout;function Q(){if(!te)return;const re=eo.from("getAllResponseHeaders"in te&&te.getAllResponseHeaders()),Ee={data:!b||b==="text"||b==="json"?te.responseText:te.response,status:te.status,statusText:te.statusText,headers:re,config:e,request:te};P2(function(qe){r(qe),U()},function(qe){o(qe),U()},Ee),te=null}"onloadend"in te?te.onloadend=Q:te.onreadystatechange=function(){!te||te.readyState!==4||te.status===0&&!(te.responseURL&&te.responseURL.indexOf("file:")===0)||setTimeout(Q)},te.onabort=function(){te&&(o(new Hn("Request aborted",Hn.ECONNABORTED,e,te)),te=null)},te.onerror=function(){o(new Hn("Network Error",Hn.ERR_NETWORK,e,te)),te=null},te.ontimeout=function(){let xe=u.timeout?"timeout of "+u.timeout+"ms exceeded":"timeout exceeded";const Ee=u.transitional||T2;u.timeoutErrorMessage&&(xe=u.timeoutErrorMessage),o(new Hn(xe,Ee.clarifyTimeoutError?Hn.ETIMEDOUT:Hn.ECONNABORTED,e,te)),te=null},m===void 0&&_.setContentType(null),"setRequestHeader"in te&&wt.forEach(_.toJSON(),function(xe,Ee){te.setRequestHeader(Ee,xe)}),wt.isUndefined(u.withCredentials)||(te.withCredentials=!!u.withCredentials),b&&b!=="json"&&(te.responseType=u.responseType),k&&([q,J]=I1(k,!0),te.addEventListener("progress",q)),s&&te.upload&&([F,H]=I1(s),te.upload.addEventListener("progress",F),te.upload.addEventListener("loadend",H)),(u.cancelToken||u.signal)&&(O=re=>{te&&(o(!re||re.type?new ym(null,e,te):re),te.abort(),te=null)},u.cancelToken&&u.cancelToken.subscribe(O),u.signal&&(u.signal.aborted?O():u.signal.addEventListener("abort",O)));const ee=Cq(u.url);if(ee&&Qs.protocols.indexOf(ee)===-1){o(new Hn("Unsupported protocol "+ee+":",Hn.ERR_BAD_REQUEST,e));return}te.send(m||null)})},Lq=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let o=new AbortController,u;const m=function(k){if(!u){u=!0,b();const O=k instanceof Error?k:this.reason;o.abort(O instanceof Hn?O:new ym(O instanceof Error?O.message:O))}};let _=t&&setTimeout(()=>{_=null,m(new Hn(`timeout ${t} of ms exceeded`,Hn.ETIMEDOUT))},t);const b=()=>{e&&(_&&clearTimeout(_),_=null,e.forEach(k=>{k.unsubscribe?k.unsubscribe(m):k.removeEventListener("abort",m)}),e=null)};e.forEach(k=>k.addEventListener("abort",m));const{signal:s}=o;return s.unsubscribe=()=>wt.asap(b),s}},Oq=function*(e,t){let r=e.byteLength;if(r<t){yield e;return}let o=0,u;for(;o<r;)u=o+t,yield e.slice(o,u),o=u},jq=async function*(e,t){for await(const r of zq(e))yield*Oq(r,t)},zq=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:r,value:o}=await t.read();if(r)break;yield o}}finally{await t.cancel()}},GN=(e,t,r,o)=>{const u=jq(e,t);let m=0,_,b=s=>{_||(_=!0,o&&o(s))};return new ReadableStream({async pull(s){try{const{done:k,value:O}=await u.next();if(k){b(),s.close();return}let F=O.byteLength;if(r){let q=m+=F;r(q)}s.enqueue(new Uint8Array(O))}catch(k){throw b(k),k}},cancel(s){return b(s),u.return()}},{highWaterMark:2})},wb=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",I2=wb&&typeof ReadableStream=="function",Fq=wb&&(typeof TextEncoder=="function"?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),D2=(e,...t)=>{try{return!!e(...t)}catch{return!1}},Bq=I2&&D2(()=>{let e=!1;const t=new Request(Qs.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),WN=64*1024,gC=I2&&D2(()=>wt.isReadableStream(new Response("").body)),D1={stream:gC&&(e=>e.body)};wb&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!D1[t]&&(D1[t]=wt.isFunction(e[t])?r=>r[t]():(r,o)=>{throw new Hn(`Response type '${t}' is not supported`,Hn.ERR_NOT_SUPPORT,o)})})})(new Response);const Vq=async e=>{if(e==null)return 0;if(wt.isBlob(e))return e.size;if(wt.isSpecCompliantForm(e))return(await new Request(Qs.origin,{method:"POST",body:e}).arrayBuffer()).byteLength;if(wt.isArrayBufferView(e)||wt.isArrayBuffer(e))return e.byteLength;if(wt.isURLSearchParams(e)&&(e=e+""),wt.isString(e))return(await Fq(e)).byteLength},Uq=async(e,t)=>{const r=wt.toFiniteNumber(e.getContentLength());return r??Vq(t)},$q=wb&&(async e=>{let{url:t,method:r,data:o,signal:u,cancelToken:m,timeout:_,onDownloadProgress:b,onUploadProgress:s,responseType:k,headers:O,withCredentials:F="same-origin",fetchOptions:q}=A2(e);k=k?(k+"").toLowerCase():"text";let H=Lq([u,m&&m.toAbortSignal()],_),J;const U=H&&H.unsubscribe&&(()=>{H.unsubscribe()});let te;try{if(s&&Bq&&r!=="get"&&r!=="head"&&(te=await Uq(O,o))!==0){let Ee=new Request(t,{method:"POST",body:o,duplex:"half"}),He;if(wt.isFormData(o)&&(He=Ee.headers.get("content-type"))&&O.setContentType(He),Ee.body){const[qe,Ne]=VN(te,I1(UN(s)));o=GN(Ee.body,WN,qe,Ne)}}wt.isString(F)||(F=F?"include":"omit");const Q="credentials"in Request.prototype;J=new Request(t,{...q,signal:H,method:r.toUpperCase(),headers:O.normalize().toJSON(),body:o,duplex:"half",credentials:Q?F:void 0});let ee=await fetch(J);const re=gC&&(k==="stream"||k==="response");if(gC&&(b||re&&U)){const Ee={};["status","statusText","headers"].forEach(ft=>{Ee[ft]=ee[ft]});const He=wt.toFiniteNumber(ee.headers.get("content-length")),[qe,Ne]=b&&VN(He,I1(UN(b),!0))||[];ee=new Response(GN(ee.body,WN,qe,()=>{Ne&&Ne(),U&&U()}),Ee)}k=k||"text";let xe=await D1[wt.findKey(D1,k)||"text"](ee,e);return!re&&U&&U(),await new Promise((Ee,He)=>{P2(Ee,He,{data:xe,headers:eo.from(ee.headers),status:ee.status,statusText:ee.statusText,config:e,request:J})})}catch(Q){throw U&&U(),Q&&Q.name==="TypeError"&&/fetch/i.test(Q.message)?Object.assign(new Hn("Network Error",Hn.ERR_NETWORK,e,J),{cause:Q.cause||Q}):Hn.from(Q,Q&&Q.code,e,J)}}),yC={http:iq,xhr:Nq,fetch:$q};wt.forEach(yC,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const HN=e=>`- ${e}`,Gq=e=>wt.isFunction(e)||e===null||e===!1,R2={getAdapter:e=>{e=wt.isArray(e)?e:[e];const{length:t}=e;let r,o;const u={};for(let m=0;m<t;m++){r=e[m];let _;if(o=r,!Gq(r)&&(o=yC[(_=String(r)).toLowerCase()],o===void 0))throw new Hn(`Unknown adapter '${_}'`);if(o)break;u[_||"#"+m]=o}if(!o){const m=Object.entries(u).map(([b,s])=>`adapter ${b} `+(s===!1?"is not supported by the environment":"is not available in the build"));let _=t?m.length>1?`since :
`+m.map(HN).join(`
`):" "+HN(m[0]):"as no adapter specified";throw new Hn("There is no suitable adapter to dispatch the request "+_,"ERR_NOT_SUPPORT")}return o},adapters:yC};function ST(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ym(null,e)}function qN(e){return ST(e),e.headers=eo.from(e.headers),e.data=wT.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),R2.getAdapter(e.adapter||W_.adapter)(e).then(function(o){return ST(e),o.data=wT.call(e,e.transformResponse,o),o.headers=eo.from(o.headers),o},function(o){return C2(o)||(ST(e),o&&o.response&&(o.response.data=wT.call(e,e.transformResponse,o.response),o.response.headers=eo.from(o.response.headers))),Promise.reject(o)})}const k2="1.7.7",dM={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{dM[e]=function(o){return typeof o===e||"a"+(t<1?"n ":" ")+e}});const ZN={};dM.transitional=function(t,r,o){function u(m,_){return"[Axios v"+k2+"] Transitional option '"+m+"'"+_+(o?". "+o:"")}return(m,_,b)=>{if(t===!1)throw new Hn(u(_," has been removed"+(r?" in "+r:"")),Hn.ERR_DEPRECATED);return r&&!ZN[_]&&(ZN[_]=!0,console.warn(u(_," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(m,_,b):!0}};function Wq(e,t,r){if(typeof e!="object")throw new Hn("options must be an object",Hn.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let u=o.length;for(;u-- >0;){const m=o[u],_=t[m];if(_){const b=e[m],s=b===void 0||_(b,m,e);if(s!==!0)throw new Hn("option "+m+" must be "+s,Hn.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new Hn("Unknown option "+m,Hn.ERR_BAD_OPTION)}}const _C={assertOptions:Wq,validators:dM},xu=_C.validators;class wh{constructor(t){this.defaults=t,this.interceptors={request:new FN,response:new FN}}async request(t,r){try{return await this._request(t,r)}catch(o){if(o instanceof Error){let u;Error.captureStackTrace?Error.captureStackTrace(u={}):u=new Error;const m=u.stack?u.stack.replace(/^.+\n/,""):"";try{o.stack?m&&!String(o.stack).endsWith(m.replace(/^.+\n.+\n/,""))&&(o.stack+=`
`+m):o.stack=m}catch{}}throw o}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=kh(this.defaults,r);const{transitional:o,paramsSerializer:u,headers:m}=r;o!==void 0&&_C.assertOptions(o,{silentJSONParsing:xu.transitional(xu.boolean),forcedJSONParsing:xu.transitional(xu.boolean),clarifyTimeoutError:xu.transitional(xu.boolean)},!1),u!=null&&(wt.isFunction(u)?r.paramsSerializer={serialize:u}:_C.assertOptions(u,{encode:xu.function,serialize:xu.function},!0)),r.method=(r.method||this.defaults.method||"get").toLowerCase();let _=m&&wt.merge(m.common,m[r.method]);m&&wt.forEach(["delete","get","head","post","put","patch","common"],J=>{delete m[J]}),r.headers=eo.concat(_,m);const b=[];let s=!0;this.interceptors.request.forEach(function(U){typeof U.runWhen=="function"&&U.runWhen(r)===!1||(s=s&&U.synchronous,b.unshift(U.fulfilled,U.rejected))});const k=[];this.interceptors.response.forEach(function(U){k.push(U.fulfilled,U.rejected)});let O,F=0,q;if(!s){const J=[qN.bind(this),void 0];for(J.unshift.apply(J,b),J.push.apply(J,k),q=J.length,O=Promise.resolve(r);F<q;)O=O.then(J[F++],J[F++]);return O}q=b.length;let H=r;for(F=0;F<q;){const J=b[F++],U=b[F++];try{H=J(H)}catch(te){U.call(this,te);break}}try{O=qN.call(this,H)}catch(J){return Promise.reject(J)}for(F=0,q=k.length;F<q;)O=O.then(k[F++],k[F++]);return O}getUri(t){t=kh(this.defaults,t);const r=M2(t.baseURL,t.url);return S2(r,t.params,t.paramsSerializer)}}wt.forEach(["delete","get","head","options"],function(t){wh.prototype[t]=function(r,o){return this.request(kh(o||{},{method:t,url:r,data:(o||{}).data}))}});wt.forEach(["post","put","patch"],function(t){function r(o){return function(m,_,b){return this.request(kh(b||{},{method:t,headers:o?{"Content-Type":"multipart/form-data"}:{},url:m,data:_}))}}wh.prototype[t]=r(),wh.prototype[t+"Form"]=r(!0)});class hM{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(m){r=m});const o=this;this.promise.then(u=>{if(!o._listeners)return;let m=o._listeners.length;for(;m-- >0;)o._listeners[m](u);o._listeners=null}),this.promise.then=u=>{let m;const _=new Promise(b=>{o.subscribe(b),m=b}).then(u);return _.cancel=function(){o.unsubscribe(m)},_},t(function(m,_,b){o.reason||(o.reason=new ym(m,_,b),r(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=o=>{t.abort(o)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new hM(function(u){t=u}),cancel:t}}}function Hq(e){return function(r){return e.apply(null,r)}}function qq(e){return wt.isObject(e)&&e.isAxiosError===!0}const xC={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(xC).forEach(([e,t])=>{xC[t]=e});function N2(e){const t=new wh(e),r=d2(wh.prototype.request,t);return wt.extend(r,wh.prototype,t,{allOwnKeys:!0}),wt.extend(r,t,null,{allOwnKeys:!0}),r.create=function(u){return N2(kh(e,u))},r}const Jt=N2(W_);Jt.Axios=wh;Jt.CanceledError=ym;Jt.CancelToken=hM;Jt.isCancel=C2;Jt.VERSION=k2;Jt.toFormData=bb;Jt.AxiosError=Hn;Jt.Cancel=Jt.CanceledError;Jt.all=function(t){return Promise.all(t)};Jt.spread=Hq;Jt.isAxiosError=qq;Jt.mergeConfig=kh;Jt.AxiosHeaders=eo;Jt.formToJSON=e=>E2(wt.isHTMLForm(e)?new FormData(e):e);Jt.getAdapter=R2.getAdapter;Jt.HttpStatusCode=xC;Jt.default=Jt;var L2={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},XN=Gn.createContext&&Gn.createContext(L2),Zq=["attr","size","title"];function Xq(e,t){if(e==null)return{};var r=Yq(e,t),o,u;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(u=0;u<m.length;u++)o=m[u],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}function Yq(e,t){if(e==null)return{};var r={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;r[o]=e[o]}return r}function R1(){return R1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},R1.apply(this,arguments)}function YN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),r.push.apply(r,o)}return r}function k1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?YN(Object(r),!0).forEach(function(o){Kq(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):YN(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}function Kq(e,t,r){return t=Jq(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Jq(e){var t=Qq(e,"string");return typeof t=="symbol"?t:t+""}function Qq(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var o=r.call(e,t||"default");if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function O2(e){return e&&e.map((t,r)=>Gn.createElement(t.tag,k1({key:r},t.attr),O2(t.child)))}function Kr(e){return t=>Gn.createElement(eZ,R1({attr:k1({},e.attr)},t),O2(e.child))}function eZ(e){var t=r=>{var{attr:o,size:u,title:m}=e,_=Xq(e,Zq),b=u||r.size||"1em",s;return r.className&&(s=r.className),e.className&&(s=(s?s+" ":"")+e.className),Gn.createElement("svg",R1({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,o,_,{className:s,style:k1(k1({color:e.color||r.color},r.style),e.style),height:b,width:b,xmlns:"http://www.w3.org/2000/svg"}),m&&Gn.createElement("title",null,m),e.children)};return XN!==void 0?Gn.createElement(XN.Consumer,null,r=>t(r)):t(L2)}function tZ(e){return Kr({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184.49,167.51a12,12,0,0,1,0,17l-48,48a12,12,0,0,1-17,0l-48-48a12,12,0,0,1,17-17L128,207l39.51-39.52A12,12,0,0,1,184.49,167.51Zm-96-79L128,49l39.51,39.52a12,12,0,0,0,17-17l-48-48a12,12,0,0,0-17,0l-48,48a12,12,0,0,0,17,17Z"},child:[]}]})(e)}function nZ(e){return Kr({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M140,32V64a12,12,0,0,1-24,0V32a12,12,0,0,1,24,0Zm33.25,62.75a12,12,0,0,0,8.49-3.52L204.37,68.6a12,12,0,0,0-17-17L164.77,74.26a12,12,0,0,0,8.48,20.49ZM224,116H192a12,12,0,0,0,0,24h32a12,12,0,0,0,0-24Zm-42.26,48.77a12,12,0,1,0-17,17l22.63,22.63a12,12,0,0,0,17-17ZM128,180a12,12,0,0,0-12,12v32a12,12,0,0,0,24,0V192A12,12,0,0,0,128,180ZM74.26,164.77,51.63,187.4a12,12,0,0,0,17,17l22.63-22.63a12,12,0,1,0-17-17ZM76,128a12,12,0,0,0-12-12H32a12,12,0,0,0,0,24H64A12,12,0,0,0,76,128ZM68.6,51.63a12,12,0,1,0-17,17L74.26,91.23a12,12,0,0,0,17-17Z"},child:[]}]})(e)}const vy=({allowedRoles:e})=>{const t=ad(),r=xl(),{user:o}=qi(_=>_.user),[u,m]=W.useState(!0);return W.useEffect(()=>{if(o!==null){m(!1);return}let _=!0;return o||Jt.get("/authorize").then(async({data:b})=>{b!=null&&b.user&&r(fm(b==null?void 0:b.user))}).catch(()=>{r(nm())}).finally(()=>{_&&m(!1)}),()=>{_=!1}},[o,r]),u?S.jsx("div",{className:"flex h-screen items-center justify-center",children:S.jsx(nZ,{className:"mr-1 h-14 w-14 animate-spin font-bold text-sky-400"})}):o?e.includes(o.role)?S.jsx(Uv,{}):o?S.jsx(qy,{to:"/unauthorized",state:{from:t},replace:!0}):S.jsx(qy,{to:"/login",state:{from:t},replace:!0}):S.jsx(qy,{to:"/login",state:{from:t},replace:!0})},Ro=()=>S.jsxs("footer",{className:"w-full text-blue-800 border-t border-t-black/10",children:[S.jsxs("div",{className:"flex w-full flex-wrap justify-center gap-10 bg-white px-5 py-10",children:[S.jsx(ui,{to:"/",className:"text-sm hover:text-blue-950",children:"Home"}),S.jsx(ui,{to:"/about-us",className:"text-sm hover:text-blue-950",children:"About Us"}),S.jsx(ui,{to:"/contact-us",className:"text-sm hover:text-blue-950",children:"Contact Us"}),S.jsx(ui,{to:"/login",className:"text-sm hover:text-blue-950",children:"Login"}),S.jsx(ui,{to:"/sign-up",className:"text-sm hover:text-blue-950",children:"Register"}),S.jsx(ui,{to:"/get-start",className:"text-sm hover:text-blue-950",children:"Get Started"})]}),S.jsx("div",{className:"border-t border-blue-500 bg-sky-600 py-3 text-sm",children:S.jsx("div",{className:"col-span-2 text-center text-white md:col-span-4 lg:col-span-6",children:"Copyright 2024 Ceyvoy"})})]}),fM=()=>S.jsxs("h1",{className:"text-3xl font-medium tracking-wide text-sky-800",children:[S.jsx("span",{className:"text-sky-600",children:"C"}),"eyVoy"]}),rZ=[{title:"Gallery",url:"/gallery"},{title:"Events",url:"/events"},{title:"About Us",url:"/about-us"},{title:"Contact Us",url:"/contact-us"}],ko=()=>{const[e,t]=W.useState(!1),{user:r}=qi(m=>m.user),o=xl(),u=W.useCallback(async()=>{r===null&&(r||Jt.get("/authorize").then(async({data:m})=>{m!=null&&m.user&&o(fm(m==null?void 0:m.user))}).catch(()=>{o(nm())}))},[o,r]);return W.useEffect(()=>{u()},[u]),S.jsx("header",{className:"fixed z-20 w-full border-b border-black/10 bg-white/90 backdrop-blur-sm",children:S.jsx("div",{className:"relative mx-auto max-w-full px-6 lg:max-w-5xl xl:max-w-6xl",children:S.jsxs("nav",{className:"flex h-[3.5rem] items-center justify-between font-medium text-blue-500 sm:h-[4rem]",role:"navigation",children:[S.jsx(ui,{className:"relative",to:"/",children:S.jsx(fM,{})}),S.jsx("button",{className:`relative order-10 block h-10 w-10 self-center lg:hidden${e?"visible opacity-100 [&_span:nth-child(1)]:w-6 [&_span:nth-child(1)]:translate-y-0 [&_span:nth-child(1)]:rotate-45 [&_span:nth-child(2)]:-rotate-45 [&_span:nth-child(3)]:w-0":""}`,onClick:()=>t(!e),"aria-expanded":e?"true":"false",children:S.jsxs("div",{className:"absolute left-1/2 top-1/2 w-6 -translate-x-1/2 -translate-y-1/2 transform",children:[S.jsx("span",{"aria-hidden":"true",className:"absolute block h-0.5 w-9/12 -translate-y-2 transform rounded-full bg-blue-400 transition-all duration-300"}),S.jsx("span",{"aria-hidden":"true",className:"absolute block h-0.5 w-6 transform rounded-full bg-blue-400 transition duration-300"}),S.jsx("span",{"aria-hidden":"true",className:"absolute block h-0.5 w-1/2 origin-top-left translate-y-2 transform rounded-full bg-blue-400 transition-all duration-300"})]})}),S.jsx("ul",{role:"menubar","aria-label":"Select page",className:`absolute left-0 top-0 z-[-1] h-fit w-full justify-center overflow-hidden overflow-y-auto overscroll-contain bg-white px-8 pb-5 pt-20 font-medium backdrop-blur-md transition-[opacity,visibility] duration-300 lg:visible lg:relative lg:top-0 lg:z-0 lg:flex lg:h-full lg:w-auto lg:items-stretch lg:overflow-visible lg:px-0 lg:py-0 lg:pt-0 lg:opacity-100 ${e?"visible border-b border-b-blue-700/20 opacity-100 backdrop-blur-sm":"invisible opacity-0"}`,children:rZ.map((m,_)=>S.jsx("li",{role:"none",className:"flex items-stretch",children:S.jsx(ui,{role:"menuitem",className:"flex items-center gap-2 py-3 transition-colors duration-300 hover:text-blue-700 focus:text-blue-600 focus:outline-none focus-visible:outline-none lg:px-8",to:m.url,children:S.jsx("span",{children:m.title})})},_))}),S.jsxs("div",{className:"flex w-full items-center justify-end px-6 lg:ml-0 lg:w-auto lg:p-0",children:[r&&S.jsx(ui,{to:"/dashboard",children:S.jsxs("div",{className:"flex min-h-[2rem] w-full min-w-0 flex-col items-start justify-center gap-0 text-center",children:[(r==null?void 0:r.profileImage)==null&&S.jsx("div",{className:"relative",children:S.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-full bg-sky-500 text-2xl text-white",children:r==null?void 0:r.name.charAt(0)})}),(r==null?void 0:r.profileImage)!=null&&S.jsx("div",{className:"relative",children:S.jsx("img",{src:"http://localhost:8000/"+(r==null?void 0:r.profileImage)+`?${new Date().getSeconds()}`,alt:r==null?void 0:r.name.charAt(0),className:"flex h-9 w-9 items-center justify-center rounded-full border-2 border-sky-500 bg-sky-500 text-7xl text-white"})})]})}),!r&&S.jsx("div",{className:"flex items-center",children:S.jsx(ui,{to:"/login",children:S.jsx("button",{className:"inline-flex h-8 items-center justify-center gap-2 whitespace-nowrap rounded-md bg-blue-500 px-4 text-sm font-medium tracking-wide text-white duration-300 hover:bg-blue-600",children:S.jsx("span",{children:"Sign in"})})})})]})]})})})};function iZ(e){if(typeof Proxy>"u")return e;const t=new Map,r=(...o)=>e(...o);return new Proxy(r,{get:(o,u)=>u==="create"?e:(t.has(u)||t.set(u,e(u)),t.get(u))})}function C_(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const vC=e=>Array.isArray(e);function j2(e,t){if(!Array.isArray(t))return!1;const r=t.length;if(r!==e.length)return!1;for(let o=0;o<r;o++)if(t[o]!==e[o])return!1;return!0}function P_(e){return typeof e=="string"||Array.isArray(e)}function KN(e){const t=[{},{}];return e==null||e.values.forEach((r,o)=>{t[0][o]=r.get(),t[1][o]=r.getVelocity()}),t}function pM(e,t,r,o){if(typeof t=="function"){const[u,m]=KN(o);t=t(r!==void 0?r:e.custom,u,m)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[u,m]=KN(o);t=t(r!==void 0?r:e.custom,u,m)}return t}function Sb(e,t,r){const o=e.getProps();return pM(o,t,r!==void 0?r:o.custom,e)}const mM=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],gM=["initial",...mM],H_=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],ld=new Set(H_),ec=e=>e*1e3,tc=e=>e/1e3,sZ={type:"spring",stiffness:500,damping:25,restSpeed:10},oZ=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),aZ={type:"keyframes",duration:.8},lZ={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},cZ=(e,{keyframes:t})=>t.length>2?aZ:ld.has(e)?e.startsWith("scale")?oZ(t[1]):sZ:lZ;function uZ({when:e,delay:t,delayChildren:r,staggerChildren:o,staggerDirection:u,repeat:m,repeatType:_,repeatDelay:b,from:s,elapsed:k,...O}){return!!Object.keys(O).length}function yM(e,t){return e[t]||e.default||e}const dZ={skipAnimations:!1,useManualTiming:!1},hZ=e=>e!==null;function Tb(e,{repeat:t,repeatType:r="loop"},o){const u=e.filter(hZ),m=t&&r!=="loop"&&t%2===1?0:u.length-1;return!m||o===void 0?u[m]:o}const vs=e=>e;function fZ(e){let t=new Set,r=new Set,o=!1,u=!1;const m=new WeakSet;let _={delta:0,timestamp:0,isProcessing:!1};function b(k){m.has(k)&&(s.schedule(k),e()),k(_)}const s={schedule:(k,O=!1,F=!1)=>{const H=F&&o?t:r;return O&&m.add(k),H.has(k)||H.add(k),k},cancel:k=>{r.delete(k),m.delete(k)},process:k=>{if(_=k,o){u=!0;return}o=!0,[t,r]=[r,t],r.clear(),t.forEach(b),o=!1,u&&(u=!1,s.process(k))}};return s}const hv=["read","resolveKeyframes","update","preRender","render","postRender"],pZ=40;function z2(e,t){let r=!1,o=!0;const u={delta:0,timestamp:0,isProcessing:!1},m=()=>r=!0,_=hv.reduce((Q,ee)=>(Q[ee]=fZ(m),Q),{}),{read:b,resolveKeyframes:s,update:k,preRender:O,render:F,postRender:q}=_,H=()=>{const Q=performance.now();r=!1,u.delta=o?1e3/60:Math.max(Math.min(Q-u.timestamp,pZ),1),u.timestamp=Q,u.isProcessing=!0,b.process(u),s.process(u),k.process(u),O.process(u),F.process(u),q.process(u),u.isProcessing=!1,r&&t&&(o=!1,e(H))},J=()=>{r=!0,o=!0,u.isProcessing||e(H)};return{schedule:hv.reduce((Q,ee)=>{const re=_[ee];return Q[ee]=(xe,Ee=!1,He=!1)=>(r||J(),re.schedule(xe,Ee,He)),Q},{}),cancel:Q=>{for(let ee=0;ee<hv.length;ee++)_[hv[ee]].cancel(Q)},state:u,steps:_}}const{schedule:Ir,cancel:cc,state:is,steps:TT}=z2(typeof requestAnimationFrame<"u"?requestAnimationFrame:vs,!0),F2=e=>/^0[^.\s]+$/u.test(e);function mZ(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||F2(e):!0}let bC=vs;const B2=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),V2=e=>t=>typeof t=="string"&&t.startsWith(e),U2=V2("--"),gZ=V2("var(--"),_M=e=>gZ(e)?yZ.test(e.split("/*")[0].trim()):!1,yZ=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,_Z=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function xZ(e){const t=_Z.exec(e);if(!t)return[,];const[,r,o,u]=t;return[`--${r??o}`,u]}function $2(e,t,r=1){const[o,u]=xZ(e);if(!o)return;const m=window.getComputedStyle(t).getPropertyValue(o);if(m){const _=m.trim();return B2(_)?parseFloat(_):_}return _M(u)?$2(u,t,r+1):u}const Gu=(e,t,r)=>r>t?t:r<e?e:r,_m={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Zy={..._m,transform:e=>Gu(0,1,e)},fv={..._m,default:1},Xy=e=>Math.round(e*1e5)/1e5,xM=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu,vZ=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu,bZ=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu;function q_(e){return typeof e=="string"}function wZ(e){return e==null}const Z_=e=>({test:t=>q_(t)&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),Su=Z_("deg"),pl=Z_("%"),An=Z_("px"),SZ=Z_("vh"),TZ=Z_("vw"),JN={...pl,parse:e=>pl.parse(e)/100,transform:e=>pl.transform(e*100)},EZ=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),QN=e=>e===_m||e===An,eL=(e,t)=>parseFloat(e.split(", ")[t]),tL=(e,t)=>(r,{transform:o})=>{if(o==="none"||!o)return 0;const u=o.match(/^matrix3d\((.+)\)$/u);if(u)return eL(u[1],t);{const m=o.match(/^matrix\((.+)\)$/u);return m?eL(m[1],e):0}},CZ=new Set(["x","y","z"]),PZ=H_.filter(e=>!CZ.has(e));function MZ(e){const t=[];return PZ.forEach(r=>{const o=e.getValue(r);o!==void 0&&(t.push([r,o.get()]),o.set(r.startsWith("scale")?1:0))}),t}const rm={width:({x:e},{paddingLeft:t="0",paddingRight:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),height:({y:e},{paddingTop:t="0",paddingBottom:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:tL(4,13),y:tL(5,14)};rm.translateX=rm.x;rm.translateY=rm.y;const G2=e=>t=>t.test(e),AZ={test:e=>e==="auto",parse:e=>e},W2=[_m,An,pl,Su,TZ,SZ,AZ],nL=e=>W2.find(G2(e)),Sh=new Set;let wC=!1,SC=!1;function H2(){if(SC){const e=Array.from(Sh).filter(o=>o.needsMeasurement),t=new Set(e.map(o=>o.element)),r=new Map;t.forEach(o=>{const u=MZ(o);u.length&&(r.set(o,u),o.render())}),e.forEach(o=>o.measureInitialState()),t.forEach(o=>{o.render();const u=r.get(o);u&&u.forEach(([m,_])=>{var b;(b=o.getValue(m))===null||b===void 0||b.set(_)})}),e.forEach(o=>o.measureEndState()),e.forEach(o=>{o.suspendedScrollY!==void 0&&window.scrollTo(0,o.suspendedScrollY)})}SC=!1,wC=!1,Sh.forEach(e=>e.complete()),Sh.clear()}function q2(){Sh.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(SC=!0)})}function IZ(){q2(),H2()}class vM{constructor(t,r,o,u,m,_=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=r,this.name=o,this.motionValue=u,this.element=m,this.isAsync=_}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Sh.add(this),wC||(wC=!0,Ir.read(q2),Ir.resolveKeyframes(H2))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:r,element:o,motionValue:u}=this;for(let m=0;m<t.length;m++)if(t[m]===null)if(m===0){const _=u==null?void 0:u.get(),b=t[t.length-1];if(_!==void 0)t[0]=_;else if(o&&r){const s=o.readValue(r,b);s!=null&&(t[0]=s)}t[0]===void 0&&(t[0]=b),u&&_===void 0&&u.set(t[0])}else t[m]=t[m-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Sh.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Sh.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const bM=(e,t)=>r=>!!(q_(r)&&bZ.test(r)&&r.startsWith(e)||t&&!wZ(r)&&Object.prototype.hasOwnProperty.call(r,t)),Z2=(e,t,r)=>o=>{if(!q_(o))return o;const[u,m,_,b]=o.match(xM);return{[e]:parseFloat(u),[t]:parseFloat(m),[r]:parseFloat(_),alpha:b!==void 0?parseFloat(b):1}},DZ=e=>Gu(0,255,e),ET={..._m,transform:e=>Math.round(DZ(e))},xh={test:bM("rgb","red"),parse:Z2("red","green","blue"),transform:({red:e,green:t,blue:r,alpha:o=1})=>"rgba("+ET.transform(e)+", "+ET.transform(t)+", "+ET.transform(r)+", "+Xy(Zy.transform(o))+")"};function RZ(e){let t="",r="",o="",u="";return e.length>5?(t=e.substring(1,3),r=e.substring(3,5),o=e.substring(5,7),u=e.substring(7,9)):(t=e.substring(1,2),r=e.substring(2,3),o=e.substring(3,4),u=e.substring(4,5),t+=t,r+=r,o+=o,u+=u),{red:parseInt(t,16),green:parseInt(r,16),blue:parseInt(o,16),alpha:u?parseInt(u,16)/255:1}}const TC={test:bM("#"),parse:RZ,transform:xh.transform},kp={test:bM("hsl","hue"),parse:Z2("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:r,alpha:o=1})=>"hsla("+Math.round(e)+", "+pl.transform(Xy(t))+", "+pl.transform(Xy(r))+", "+Xy(Zy.transform(o))+")"},gs={test:e=>xh.test(e)||TC.test(e)||kp.test(e),parse:e=>xh.test(e)?xh.parse(e):kp.test(e)?kp.parse(e):TC.parse(e),transform:e=>q_(e)?e:e.hasOwnProperty("red")?xh.transform(e):kp.transform(e)};function kZ(e){var t,r;return isNaN(e)&&q_(e)&&(((t=e.match(xM))===null||t===void 0?void 0:t.length)||0)+(((r=e.match(vZ))===null||r===void 0?void 0:r.length)||0)>0}const X2="number",Y2="color",NZ="var",LZ="var(",rL="${}",OZ=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function M_(e){const t=e.toString(),r=[],o={color:[],number:[],var:[]},u=[];let m=0;const b=t.replace(OZ,s=>(gs.test(s)?(o.color.push(m),u.push(Y2),r.push(gs.parse(s))):s.startsWith(LZ)?(o.var.push(m),u.push(NZ),r.push(s)):(o.number.push(m),u.push(X2),r.push(parseFloat(s))),++m,rL)).split(rL);return{values:r,split:b,indexes:o,types:u}}function K2(e){return M_(e).values}function J2(e){const{split:t,types:r}=M_(e),o=t.length;return u=>{let m="";for(let _=0;_<o;_++)if(m+=t[_],u[_]!==void 0){const b=r[_];b===X2?m+=Xy(u[_]):b===Y2?m+=gs.transform(u[_]):m+=u[_]}return m}}const jZ=e=>typeof e=="number"?0:e;function zZ(e){const t=K2(e);return J2(e)(t.map(jZ))}const Wu={test:kZ,parse:K2,createTransformer:J2,getAnimatableNone:zZ},FZ=new Set(["brightness","contrast","saturate","opacity"]);function BZ(e){const[t,r]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[o]=r.match(xM)||[];if(!o)return e;const u=r.replace(o,"");let m=FZ.has(t)?1:0;return o!==r&&(m*=100),t+"("+m+u+")"}const VZ=/\b([a-z-]*)\(.*?\)/gu,EC={...Wu,getAnimatableNone:e=>{const t=e.match(VZ);return t?t.map(BZ).join(" "):e}},iL={..._m,transform:Math.round},wM={borderWidth:An,borderTopWidth:An,borderRightWidth:An,borderBottomWidth:An,borderLeftWidth:An,borderRadius:An,radius:An,borderTopLeftRadius:An,borderTopRightRadius:An,borderBottomRightRadius:An,borderBottomLeftRadius:An,width:An,maxWidth:An,height:An,maxHeight:An,size:An,top:An,right:An,bottom:An,left:An,padding:An,paddingTop:An,paddingRight:An,paddingBottom:An,paddingLeft:An,margin:An,marginTop:An,marginRight:An,marginBottom:An,marginLeft:An,rotate:Su,rotateX:Su,rotateY:Su,rotateZ:Su,scale:fv,scaleX:fv,scaleY:fv,scaleZ:fv,skew:Su,skewX:Su,skewY:Su,distance:An,translateX:An,translateY:An,translateZ:An,x:An,y:An,z:An,perspective:An,transformPerspective:An,opacity:Zy,originX:JN,originY:JN,originZ:An,zIndex:iL,backgroundPositionX:An,backgroundPositionY:An,fillOpacity:Zy,strokeOpacity:Zy,numOctaves:iL},UZ={...wM,color:gs,backgroundColor:gs,outlineColor:gs,fill:gs,stroke:gs,borderColor:gs,borderTopColor:gs,borderRightColor:gs,borderBottomColor:gs,borderLeftColor:gs,filter:EC,WebkitFilter:EC},SM=e=>UZ[e];function Q2(e,t){let r=SM(e);return r!==EC&&(r=Wu),r.getAnimatableNone?r.getAnimatableNone(t):void 0}const $Z=new Set(["auto","none","0"]);function GZ(e,t,r){let o=0,u;for(;o<e.length&&!u;){const m=e[o];typeof m=="string"&&!$Z.has(m)&&M_(m).values.length&&(u=e[o]),o++}if(u&&r)for(const m of t)e[m]=Q2(r,u)}class e5 extends vM{constructor(t,r,o,u,m){super(t,r,o,u,m,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:r,name:o}=this;if(!r||!r.current)return;super.readKeyframes();for(let s=0;s<t.length;s++){let k=t[s];if(typeof k=="string"&&(k=k.trim(),_M(k))){const O=$2(k,r.current);O!==void 0&&(t[s]=O),s===t.length-1&&(this.finalKeyframe=k)}}if(this.resolveNoneKeyframes(),!EZ.has(o)||t.length!==2)return;const[u,m]=t,_=nL(u),b=nL(m);if(_!==b)if(QN(_)&&QN(b))for(let s=0;s<t.length;s++){const k=t[s];typeof k=="string"&&(t[s]=parseFloat(k))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:r}=this,o=[];for(let u=0;u<t.length;u++)mZ(t[u])&&o.push(u);o.length&&GZ(t,o,r)}measureInitialState(){const{element:t,unresolvedKeyframes:r,name:o}=this;if(!t||!t.current)return;o==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=rm[o](t.measureViewportBox(),window.getComputedStyle(t.current)),r[0]=this.measuredOrigin;const u=r[r.length-1];u!==void 0&&t.getValue(o,u).jump(u,!1)}measureEndState(){var t;const{element:r,name:o,unresolvedKeyframes:u}=this;if(!r||!r.current)return;const m=r.getValue(o);m&&m.jump(this.measuredOrigin,!1);const _=u.length-1,b=u[_];u[_]=rm[o](r.measureViewportBox(),window.getComputedStyle(r.current)),b!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=b),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([s,k])=>{r.getValue(s).set(k)}),this.resolveNoneKeyframes()}}function t5(e){let t;return()=>(t===void 0&&(t=e()),t)}function TM(e){return typeof e=="function"}let Wv;function WZ(){Wv=void 0}const ml={now:()=>(Wv===void 0&&ml.set(is.isProcessing||dZ.useManualTiming?is.timestamp:performance.now()),Wv),set:e=>{Wv=e,queueMicrotask(WZ)}},sL=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Wu.test(e)||e==="0")&&!e.startsWith("url("));function HZ(e){const t=e[0];if(e.length===1)return!0;for(let r=0;r<e.length;r++)if(e[r]!==t)return!0}function qZ(e,t,r,o){const u=e[0];if(u===null)return!1;if(t==="display"||t==="visibility")return!0;const m=e[e.length-1],_=sL(u,t),b=sL(m,t);return!_||!b?!1:HZ(e)||(r==="spring"||TM(r))&&o}const ZZ=40;class n5{constructor({autoplay:t=!0,delay:r=0,type:o="keyframes",repeat:u=0,repeatDelay:m=0,repeatType:_="loop",...b}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=ml.now(),this.options={autoplay:t,delay:r,type:o,repeat:u,repeatDelay:m,repeatType:_,...b},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>ZZ?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&IZ(),this._resolved}onKeyframesResolved(t,r){this.resolvedAt=ml.now(),this.hasAttemptedResolve=!0;const{name:o,type:u,velocity:m,delay:_,onComplete:b,onUpdate:s,isGenerator:k}=this.options;if(!k&&!qZ(t,o,u,m))if(_)this.options.duration=0;else{s==null||s(Tb(t,this.options,r)),b==null||b(),this.resolveFinishedPromise();return}const O=this.initPlayback(t,r);O!==!1&&(this._resolved={keyframes:t,finalKeyframe:r,...O},this.onPostResolved())}onPostResolved(){}then(t,r){return this.currentFinishedPromise.then(t,r)}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}function r5(e,t){return t?e*(1e3/t):0}const XZ=5;function i5(e,t,r){const o=Math.max(t-XZ,0);return r5(r-e(o),t-o)}const CT=.001,YZ=.01,KZ=10,JZ=.05,QZ=1;function eX({duration:e=800,bounce:t=.25,velocity:r=0,mass:o=1}){let u,m,_=1-t;_=Gu(JZ,QZ,_),e=Gu(YZ,KZ,tc(e)),_<1?(u=k=>{const O=k*_,F=O*e,q=O-r,H=CC(k,_),J=Math.exp(-F);return CT-q/H*J},m=k=>{const F=k*_*e,q=F*r+r,H=Math.pow(_,2)*Math.pow(k,2)*e,J=Math.exp(-F),U=CC(Math.pow(k,2),_);return(-u(k)+CT>0?-1:1)*((q-H)*J)/U}):(u=k=>{const O=Math.exp(-k*e),F=(k-r)*e+1;return-CT+O*F},m=k=>{const O=Math.exp(-k*e),F=(r-k)*(e*e);return O*F});const b=5/e,s=nX(u,m,b);if(e=ec(e),isNaN(s))return{stiffness:100,damping:10,duration:e};{const k=Math.pow(s,2)*o;return{stiffness:k,damping:_*2*Math.sqrt(o*k),duration:e}}}const tX=12;function nX(e,t,r){let o=r;for(let u=1;u<tX;u++)o=o-e(o)/t(o);return o}function CC(e,t){return e*Math.sqrt(1-t*t)}const rX=["duration","bounce"],iX=["stiffness","damping","mass"];function oL(e,t){return t.some(r=>e[r]!==void 0)}function sX(e){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...e};if(!oL(e,iX)&&oL(e,rX)){const r=eX(e);t={...t,...r,mass:1},t.isResolvedFromDuration=!0}return t}function s5({keyframes:e,restDelta:t,restSpeed:r,...o}){const u=e[0],m=e[e.length-1],_={done:!1,value:u},{stiffness:b,damping:s,mass:k,duration:O,velocity:F,isResolvedFromDuration:q}=sX({...o,velocity:-tc(o.velocity||0)}),H=F||0,J=s/(2*Math.sqrt(b*k)),U=m-u,te=tc(Math.sqrt(b/k)),Q=Math.abs(U)<5;r||(r=Q?.01:2),t||(t=Q?.005:.5);let ee;if(J<1){const re=CC(te,J);ee=xe=>{const Ee=Math.exp(-J*te*xe);return m-Ee*((H+J*te*U)/re*Math.sin(re*xe)+U*Math.cos(re*xe))}}else if(J===1)ee=re=>m-Math.exp(-te*re)*(U+(H+te*U)*re);else{const re=te*Math.sqrt(J*J-1);ee=xe=>{const Ee=Math.exp(-J*te*xe),He=Math.min(re*xe,300);return m-Ee*((H+J*te*U)*Math.sinh(He)+re*U*Math.cosh(He))/re}}return{calculatedDuration:q&&O||null,next:re=>{const xe=ee(re);if(q)_.done=re>=O;else{let Ee=0;J<1&&(Ee=re===0?ec(H):i5(ee,re,xe));const He=Math.abs(Ee)<=r,qe=Math.abs(m-xe)<=t;_.done=He&&qe}return _.value=_.done?m:xe,_}}}function aL({keyframes:e,velocity:t=0,power:r=.8,timeConstant:o=325,bounceDamping:u=10,bounceStiffness:m=500,modifyTarget:_,min:b,max:s,restDelta:k=.5,restSpeed:O}){const F=e[0],q={done:!1,value:F},H=Ne=>b!==void 0&&Ne<b||s!==void 0&&Ne>s,J=Ne=>b===void 0?s:s===void 0||Math.abs(b-Ne)<Math.abs(s-Ne)?b:s;let U=r*t;const te=F+U,Q=_===void 0?te:_(te);Q!==te&&(U=Q-F);const ee=Ne=>-U*Math.exp(-Ne/o),re=Ne=>Q+ee(Ne),xe=Ne=>{const ft=ee(Ne),ut=re(Ne);q.done=Math.abs(ft)<=k,q.value=q.done?Q:ut};let Ee,He;const qe=Ne=>{H(q.value)&&(Ee=Ne,He=s5({keyframes:[q.value,J(q.value)],velocity:i5(re,Ne,q.value),damping:u,stiffness:m,restDelta:k,restSpeed:O}))};return qe(0),{calculatedDuration:null,next:Ne=>{let ft=!1;return!He&&Ee===void 0&&(ft=!0,xe(Ne),qe(Ne)),Ee!==void 0&&Ne>=Ee?He.next(Ne-Ee):(!ft&&xe(Ne),q)}}}const o5=(e,t,r)=>(((1-3*r+3*t)*e+(3*r-6*t))*e+3*t)*e,oX=1e-7,aX=12;function lX(e,t,r,o,u){let m,_,b=0;do _=t+(r-t)/2,m=o5(_,o,u)-e,m>0?r=_:t=_;while(Math.abs(m)>oX&&++b<aX);return _}function X_(e,t,r,o){if(e===t&&r===o)return vs;const u=m=>lX(m,0,1,e,r);return m=>m===0||m===1?m:o5(u(m),t,o)}const cX=X_(.42,0,1,1),uX=X_(0,0,.58,1),a5=X_(.42,0,.58,1),dX=e=>Array.isArray(e)&&typeof e[0]!="number",l5=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,c5=e=>t=>1-e(1-t),EM=e=>1-Math.sin(Math.acos(e)),u5=c5(EM),hX=l5(EM),d5=X_(.33,1.53,.69,.99),CM=c5(d5),fX=l5(CM),pX=e=>(e*=2)<1?.5*CM(e):.5*(2-Math.pow(2,-10*(e-1))),lL={linear:vs,easeIn:cX,easeInOut:a5,easeOut:uX,circIn:EM,circInOut:hX,circOut:u5,backIn:CM,backInOut:fX,backOut:d5,anticipate:pX},cL=e=>{if(Array.isArray(e)){bC(e.length===4);const[t,r,o,u]=e;return X_(t,r,o,u)}else if(typeof e=="string")return bC(lL[e]!==void 0),lL[e];return e},mX=(e,t)=>r=>t(e(r)),nc=(...e)=>e.reduce(mX),A_=(e,t,r)=>{const o=t-e;return o===0?1:(r-e)/o},di=(e,t,r)=>e+(t-e)*r;function PT(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function gX({hue:e,saturation:t,lightness:r,alpha:o}){e/=360,t/=100,r/=100;let u=0,m=0,_=0;if(!t)u=m=_=r;else{const b=r<.5?r*(1+t):r+t-r*t,s=2*r-b;u=PT(s,b,e+1/3),m=PT(s,b,e),_=PT(s,b,e-1/3)}return{red:Math.round(u*255),green:Math.round(m*255),blue:Math.round(_*255),alpha:o}}function N1(e,t){return r=>r>0?t:e}const MT=(e,t,r)=>{const o=e*e,u=r*(t*t-o)+o;return u<0?0:Math.sqrt(u)},yX=[TC,xh,kp],_X=e=>yX.find(t=>t.test(e));function uL(e){const t=_X(e);if(!t)return!1;let r=t.parse(e);return t===kp&&(r=gX(r)),r}const dL=(e,t)=>{const r=uL(e),o=uL(t);if(!r||!o)return N1(e,t);const u={...r};return m=>(u.red=MT(r.red,o.red,m),u.green=MT(r.green,o.green,m),u.blue=MT(r.blue,o.blue,m),u.alpha=di(r.alpha,o.alpha,m),xh.transform(u))},PC=new Set(["none","hidden"]);function xX(e,t){return PC.has(e)?r=>r<=0?e:t:r=>r>=1?t:e}function vX(e,t){return r=>di(e,t,r)}function PM(e){return typeof e=="number"?vX:typeof e=="string"?_M(e)?N1:gs.test(e)?dL:SX:Array.isArray(e)?h5:typeof e=="object"?gs.test(e)?dL:bX:N1}function h5(e,t){const r=[...e],o=r.length,u=e.map((m,_)=>PM(m)(m,t[_]));return m=>{for(let _=0;_<o;_++)r[_]=u[_](m);return r}}function bX(e,t){const r={...e,...t},o={};for(const u in r)e[u]!==void 0&&t[u]!==void 0&&(o[u]=PM(e[u])(e[u],t[u]));return u=>{for(const m in o)r[m]=o[m](u);return r}}function wX(e,t){var r;const o=[],u={color:0,var:0,number:0};for(let m=0;m<t.values.length;m++){const _=t.types[m],b=e.indexes[_][u[_]],s=(r=e.values[b])!==null&&r!==void 0?r:0;o[m]=s,u[_]++}return o}const SX=(e,t)=>{const r=Wu.createTransformer(t),o=M_(e),u=M_(t);return o.indexes.var.length===u.indexes.var.length&&o.indexes.color.length===u.indexes.color.length&&o.indexes.number.length>=u.indexes.number.length?PC.has(e)&&!u.values.length||PC.has(t)&&!o.values.length?xX(e,t):nc(h5(wX(o,u),u.values),r):N1(e,t)};function f5(e,t,r){return typeof e=="number"&&typeof t=="number"&&typeof r=="number"?di(e,t,r):PM(e)(e,t)}function TX(e,t,r){const o=[],u=r||f5,m=e.length-1;for(let _=0;_<m;_++){let b=u(e[_],e[_+1]);if(t){const s=Array.isArray(t)?t[_]||vs:t;b=nc(s,b)}o.push(b)}return o}function EX(e,t,{clamp:r=!0,ease:o,mixer:u}={}){const m=e.length;if(bC(m===t.length),m===1)return()=>t[0];if(m===2&&e[0]===e[1])return()=>t[1];e[0]>e[m-1]&&(e=[...e].reverse(),t=[...t].reverse());const _=TX(t,o,u),b=_.length,s=k=>{let O=0;if(b>1)for(;O<e.length-2&&!(k<e[O+1]);O++);const F=A_(e[O],e[O+1],k);return _[O](F)};return r?k=>s(Gu(e[0],e[m-1],k)):s}function CX(e,t){const r=e[e.length-1];for(let o=1;o<=t;o++){const u=A_(0,t,o);e.push(di(r,1,u))}}function PX(e){const t=[0];return CX(t,e.length-1),t}function MX(e,t){return e.map(r=>r*t)}function AX(e,t){return e.map(()=>t||a5).splice(0,e.length-1)}function L1({duration:e=300,keyframes:t,times:r,ease:o="easeInOut"}){const u=dX(o)?o.map(cL):cL(o),m={done:!1,value:t[0]},_=MX(r&&r.length===t.length?r:PX(t),e),b=EX(_,t,{ease:Array.isArray(u)?u:AX(t,u)});return{calculatedDuration:e,next:s=>(m.value=b(s),m.done=s>=e,m)}}const hL=2e4;function IX(e){let t=0;const r=50;let o=e.next(t);for(;!o.done&&t<hL;)t+=r,o=e.next(t);return t>=hL?1/0:t}const DX=e=>{const t=({timestamp:r})=>e(r);return{start:()=>Ir.update(t,!0),stop:()=>cc(t),now:()=>is.isProcessing?is.timestamp:ml.now()}},RX={decay:aL,inertia:aL,tween:L1,keyframes:L1,spring:s5},kX=e=>e/100;class MM extends n5{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:s}=this.options;s&&s()};const{name:r,motionValue:o,element:u,keyframes:m}=this.options,_=(u==null?void 0:u.KeyframeResolver)||vM,b=(s,k)=>this.onKeyframesResolved(s,k);this.resolver=new _(m,b,r,o,u),this.resolver.scheduleResolve()}initPlayback(t){const{type:r="keyframes",repeat:o=0,repeatDelay:u=0,repeatType:m,velocity:_=0}=this.options,b=TM(r)?r:RX[r]||L1;let s,k;b!==L1&&typeof t[0]!="number"&&(s=nc(kX,f5(t[0],t[1])),t=[0,100]);const O=b({...this.options,keyframes:t});m==="mirror"&&(k=b({...this.options,keyframes:[...t].reverse(),velocity:-_})),O.calculatedDuration===null&&(O.calculatedDuration=IX(O));const{calculatedDuration:F}=O,q=F+u,H=q*(o+1)-u;return{generator:O,mirroredGenerator:k,mapPercentToKeyframes:s,calculatedDuration:F,resolvedDuration:q,totalDuration:H}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,r=!1){const{resolved:o}=this;if(!o){const{keyframes:Ne}=this.options;return{done:!0,value:Ne[Ne.length-1]}}const{finalKeyframe:u,generator:m,mirroredGenerator:_,mapPercentToKeyframes:b,keyframes:s,calculatedDuration:k,totalDuration:O,resolvedDuration:F}=o;if(this.startTime===null)return m.next(0);const{delay:q,repeat:H,repeatType:J,repeatDelay:U,onUpdate:te}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-O/this.speed,this.startTime)),r?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const Q=this.currentTime-q*(this.speed>=0?1:-1),ee=this.speed>=0?Q<0:Q>O;this.currentTime=Math.max(Q,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=O);let re=this.currentTime,xe=m;if(H){const Ne=Math.min(this.currentTime,O)/F;let ft=Math.floor(Ne),ut=Ne%1;!ut&&Ne>=1&&(ut=1),ut===1&&ft--,ft=Math.min(ft,H+1),!!(ft%2)&&(J==="reverse"?(ut=1-ut,U&&(ut-=U/F)):J==="mirror"&&(xe=_)),re=Gu(0,1,ut)*F}const Ee=ee?{done:!1,value:s[0]}:xe.next(re);b&&(Ee.value=b(Ee.value));let{done:He}=Ee;!ee&&k!==null&&(He=this.speed>=0?this.currentTime>=O:this.currentTime<=0);const qe=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&He);return qe&&u!==void 0&&(Ee.value=Tb(s,this.options,u)),te&&te(Ee.value),qe&&this.finish(),Ee}get duration(){const{resolved:t}=this;return t?tc(t.calculatedDuration):0}get time(){return tc(this.currentTime)}set time(t){t=ec(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const r=this.playbackSpeed!==t;this.playbackSpeed=t,r&&(this.time=tc(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=DX,onPlay:r,startTime:o}=this.options;this.driver||(this.driver=t(m=>this.tick(m))),r&&r();const u=this.driver.now();this.holdTime!==null?this.startTime=u-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=u):this.startTime=o??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const p5=new Set(["opacity","clipPath","filter","transform"]),m5=e=>Array.isArray(e)&&typeof e[0]=="number";function g5(e){return!!(!e||typeof e=="string"&&e in AM||m5(e)||Array.isArray(e)&&e.every(g5))}const Ry=([e,t,r,o])=>`cubic-bezier(${e}, ${t}, ${r}, ${o})`,AM={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Ry([0,.65,.55,1]),circOut:Ry([.55,0,1,.45]),backIn:Ry([.31,.01,.66,-.59]),backOut:Ry([.33,1.53,.69,.99])};function NX(e){return y5(e)||AM.easeOut}function y5(e){if(e)return m5(e)?Ry(e):Array.isArray(e)?e.map(NX):AM[e]}function LX(e,t,r,{delay:o=0,duration:u=300,repeat:m=0,repeatType:_="loop",ease:b,times:s}={}){const k={[t]:r};s&&(k.offset=s);const O=y5(b);return Array.isArray(O)&&(k.easing=O),e.animate(k,{delay:o,duration:u,easing:Array.isArray(O)?"linear":O,fill:"both",iterations:m+1,direction:_==="reverse"?"alternate":"normal"})}const OX=t5(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),O1=10,jX=2e4;function zX(e){return TM(e.type)||e.type==="spring"||!g5(e.ease)}function FX(e,t){const r=new MM({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let o={done:!1,value:e[0]};const u=[];let m=0;for(;!o.done&&m<jX;)o=r.sample(m),u.push(o.value),m+=O1;return{times:void 0,keyframes:u,duration:m-O1,ease:"linear"}}class fL extends n5{constructor(t){super(t);const{name:r,motionValue:o,element:u,keyframes:m}=this.options;this.resolver=new e5(m,(_,b)=>this.onKeyframesResolved(_,b),r,o,u),this.resolver.scheduleResolve()}initPlayback(t,r){var o;let{duration:u=300,times:m,ease:_,type:b,motionValue:s,name:k,startTime:O}=this.options;if(!(!((o=s.owner)===null||o===void 0)&&o.current))return!1;if(zX(this.options)){const{onComplete:q,onUpdate:H,motionValue:J,element:U,...te}=this.options,Q=FX(t,te);t=Q.keyframes,t.length===1&&(t[1]=t[0]),u=Q.duration,m=Q.times,_=Q.ease,b="keyframes"}const F=LX(s.owner.current,k,t,{...this.options,duration:u,times:m,ease:_});return F.startTime=O??this.calcStartTime(),this.pendingTimeline?(F.timeline=this.pendingTimeline,this.pendingTimeline=void 0):F.onfinish=()=>{const{onComplete:q}=this.options;s.set(Tb(t,this.options,r)),q&&q(),this.cancel(),this.resolveFinishedPromise()},{animation:F,duration:u,times:m,type:b,ease:_,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:r}=t;return tc(r)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:r}=t;return tc(r.currentTime||0)}set time(t){const{resolved:r}=this;if(!r)return;const{animation:o}=r;o.currentTime=ec(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:r}=t;return r.playbackRate}set speed(t){const{resolved:r}=this;if(!r)return;const{animation:o}=r;o.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:r}=t;return r.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:r}=t;return r.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:r}=this;if(!r)return vs;const{animation:o}=r;o.timeline=t,o.onfinish=null}return vs}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:r}=t;r.playState==="finished"&&this.updateFinishedPromise(),r.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:r}=t;r.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:r,keyframes:o,duration:u,type:m,ease:_,times:b}=t;if(r.playState==="idle"||r.playState==="finished")return;if(this.time){const{motionValue:k,onUpdate:O,onComplete:F,element:q,...H}=this.options,J=new MM({...H,keyframes:o,duration:u,type:m,ease:_,times:b,isGenerator:!0}),U=ec(this.time);k.setWithVelocity(J.sample(U-O1).value,J.sample(U).value,O1)}const{onStop:s}=this.options;s&&s(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:r,name:o,repeatDelay:u,repeatType:m,damping:_,type:b}=t;return OX()&&o&&p5.has(o)&&r&&r.owner&&r.owner.current instanceof HTMLElement&&!r.owner.getProps().onUpdate&&!u&&m!=="mirror"&&_!==0&&b!=="inertia"}}function BX(e,t){let r;const o=()=>{const{currentTime:u}=t,_=(u===null?0:u.value)/100;r!==_&&e(_),r=_};return Ir.update(o,!0),()=>cc(o)}const VX=t5(()=>window.ScrollTimeline!==void 0);class UX{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}then(t,r){return Promise.all(this.animations).then(t).catch(r)}getAll(t){return this.animations[0][t]}setAll(t,r){for(let o=0;o<this.animations.length;o++)this.animations[o][t]=r}attachTimeline(t){const r=this.animations.map(o=>{if(VX()&&o.attachTimeline)o.attachTimeline(t);else return o.pause(),BX(u=>{o.time=o.duration*u},t)});return()=>{r.forEach((o,u)=>{o&&o(),this.animations[u].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let r=0;r<this.animations.length;r++)t=Math.max(t,this.animations[r].duration);return t}runAll(t){this.animations.forEach(r=>r[t]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}const IM=(e,t,r,o={},u,m)=>_=>{const b=yM(o,e)||{},s=b.delay||o.delay||0;let{elapsed:k=0}=o;k=k-ec(s);let O={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:t.getVelocity(),...b,delay:-k,onUpdate:q=>{t.set(q),b.onUpdate&&b.onUpdate(q)},onComplete:()=>{_(),b.onComplete&&b.onComplete()},name:e,motionValue:t,element:m?void 0:u};uZ(b)||(O={...O,...cZ(e,O)}),O.duration&&(O.duration=ec(O.duration)),O.repeatDelay&&(O.repeatDelay=ec(O.repeatDelay)),O.from!==void 0&&(O.keyframes[0]=O.from);let F=!1;if((O.type===!1||O.duration===0&&!O.repeatDelay)&&(O.duration=0,O.delay===0&&(F=!0)),F&&!m&&t.get()!==void 0){const q=Tb(O.keyframes,b);if(q!==void 0)return Ir.update(()=>{O.onUpdate(q),O.onComplete()}),new UX([])}return!m&&fL.supports(O)?new fL(O):new MM(O)},$X=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),GX=e=>vC(e)?e[e.length-1]||0:e;function Y_(e,t){e.indexOf(t)===-1&&e.push(t)}function DM(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}class RM{constructor(){this.subscriptions=[]}add(t){return Y_(this.subscriptions,t),()=>DM(this.subscriptions,t)}notify(t,r,o){const u=this.subscriptions.length;if(u)if(u===1)this.subscriptions[0](t,r,o);else for(let m=0;m<u;m++){const _=this.subscriptions[m];_&&_(t,r,o)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const pL=30,WX=e=>!isNaN(parseFloat(e));class _5{constructor(t,r={}){this.version="11.7.0",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(o,u=!0)=>{const m=ml.now();this.updatedAt!==m&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(o),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),u&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=r.owner}setCurrent(t){this.current=t,this.updatedAt=ml.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=WX(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,r){this.events[t]||(this.events[t]=new RM);const o=this.events[t].add(r);return t==="change"?()=>{o(),Ir.read(()=>{this.events.change.getSize()||this.stop()})}:o}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,r){this.passiveEffect=t,this.stopPassiveEffect=r}set(t,r=!0){!r||!this.passiveEffect?this.updateAndNotify(t,r):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,r,o){this.set(r),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-o}jump(t,r=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=ml.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>pL)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,pL);return r5(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(t){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=t(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function I_(e,t){return new _5(e,t)}function HX(e,t,r){e.hasValue(t)?e.getValue(t).set(r):e.addValue(t,I_(r))}function qX(e,t){const r=Sb(e,t);let{transitionEnd:o={},transition:u={},...m}=r||{};m={...m,...o};for(const _ in m){const b=GX(m[_]);HX(e,_,b)}}const Eb=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),ZX="framerAppearId",x5="data-"+Eb(ZX);function v5(e){return e.props[x5]}function b5(e){if(ld.has(e))return"transform";if(p5.has(e))return Eb(e)}class XX extends _5{constructor(){super(...arguments),this.values=[]}add(t){const r=b5(t);r&&(Y_(this.values,r),this.update())}update(){this.set(this.values.length?this.values.join(", "):"auto")}}const xs=e=>!!(e&&e.getVelocity);function YX(e){return!!(xs(e)&&e.add)}function MC(e,t){var r;if(!e.applyWillChange)return;let o=e.getValue("willChange");if(!o&&!(!((r=e.props.style)===null||r===void 0)&&r.willChange)&&(o=new XX("auto"),e.addValue("willChange",o)),YX(o))return o.add(t)}function KX({protectedKeys:e,needsAnimating:t},r){const o=e.hasOwnProperty(r)&&t[r]!==!0;return t[r]=!1,o}function w5(e,t,{delay:r=0,transitionOverride:o,type:u}={}){var m;let{transition:_=e.getDefaultTransition(),transitionEnd:b,...s}=t;o&&(_=o);const k=[],O=u&&e.animationState&&e.animationState.getState()[u];for(const F in s){const q=e.getValue(F,(m=e.latestValues[F])!==null&&m!==void 0?m:null),H=s[F];if(H===void 0||O&&KX(O,F))continue;const J={delay:r,...yM(_||{},F)};let U=!1;if(window.MotionHandoffAnimation){const Q=v5(e);if(Q){const ee=window.MotionHandoffAnimation(Q,F,Ir);ee!==null&&(J.startTime=ee,U=!0)}}MC(e,F),q.start(IM(F,q,H,e.shouldReduceMotion&&ld.has(F)?{type:!1}:J,e,U));const te=q.animation;te&&k.push(te)}return b&&Promise.all(k).then(()=>{Ir.update(()=>{b&&qX(e,b)})}),k}function AC(e,t,r={}){var o;const u=Sb(e,t,r.type==="exit"?(o=e.presenceContext)===null||o===void 0?void 0:o.custom:void 0);let{transition:m=e.getDefaultTransition()||{}}=u||{};r.transitionOverride&&(m=r.transitionOverride);const _=u?()=>Promise.all(w5(e,u,r)):()=>Promise.resolve(),b=e.variantChildren&&e.variantChildren.size?(k=0)=>{const{delayChildren:O=0,staggerChildren:F,staggerDirection:q}=m;return JX(e,t,O+k,F,q,r)}:()=>Promise.resolve(),{when:s}=m;if(s){const[k,O]=s==="beforeChildren"?[_,b]:[b,_];return k().then(()=>O())}else return Promise.all([_(),b(r.delay)])}function JX(e,t,r=0,o=0,u=1,m){const _=[],b=(e.variantChildren.size-1)*o,s=u===1?(k=0)=>k*o:(k=0)=>b-k*o;return Array.from(e.variantChildren).sort(QX).forEach((k,O)=>{k.notify("AnimationStart",t),_.push(AC(k,t,{...m,delay:r+s(O)}).then(()=>k.notify("AnimationComplete",t)))}),Promise.all(_)}function QX(e,t){return e.sortNodePosition(t)}function eY(e,t,r={}){e.notify("AnimationStart",t);let o;if(Array.isArray(t)){const u=t.map(m=>AC(e,m,r));o=Promise.all(u)}else if(typeof t=="string")o=AC(e,t,r);else{const u=typeof t=="function"?Sb(e,t,r.custom):t;o=Promise.all(w5(e,u,r))}return o.then(()=>{e.notify("AnimationComplete",t)})}const tY=gM.length;function S5(e){if(!e)return;if(!e.isControllingVariants){const r=e.parent?S5(e.parent)||{}:{};return e.props.initial!==void 0&&(r.initial=e.props.initial),r}const t={};for(let r=0;r<tY;r++){const o=gM[r],u=e.props[o];(P_(u)||u===!1)&&(t[o]=u)}return t}const nY=[...mM].reverse(),rY=mM.length;function iY(e){return t=>Promise.all(t.map(({animation:r,options:o})=>eY(e,r,o)))}function sY(e){let t=iY(e),r=mL(),o=!0;const u=s=>(k,O)=>{var F;const q=Sb(e,O,s==="exit"?(F=e.presenceContext)===null||F===void 0?void 0:F.custom:void 0);if(q){const{transition:H,transitionEnd:J,...U}=q;k={...k,...U,...J}}return k};function m(s){t=s(e)}function _(s){const{props:k}=e,O=S5(e.parent)||{},F=[],q=new Set;let H={},J=1/0;for(let te=0;te<rY;te++){const Q=nY[te],ee=r[Q],re=k[Q]!==void 0?k[Q]:O[Q],xe=P_(re),Ee=Q===s?ee.isActive:null;Ee===!1&&(J=te);let He=re===O[Q]&&re!==k[Q]&&xe;if(He&&o&&e.manuallyAnimateOnMount&&(He=!1),ee.protectedKeys={...H},!ee.isActive&&Ee===null||!re&&!ee.prevProp||C_(re)||typeof re=="boolean")continue;const qe=oY(ee.prevProp,re);let Ne=qe||Q===s&&ee.isActive&&!He&&xe||te>J&&xe,ft=!1;const ut=Array.isArray(re)?re:[re];let mt=ut.reduce(u(Q),{});Ee===!1&&(mt={});const{prevResolvedValues:pt={}}=ee,en={...pt,...mt},Yt=Et=>{Ne=!0,q.has(Et)&&(ft=!0,q.delete(Et)),ee.needsAnimating[Et]=!0;const tt=e.getValue(Et);tt&&(tt.liveStyle=!1)};for(const Et in en){const tt=mt[Et],Ft=pt[Et];if(H.hasOwnProperty(Et))continue;let St=!1;vC(tt)&&vC(Ft)?St=!j2(tt,Ft):St=tt!==Ft,St?tt!=null?Yt(Et):q.add(Et):tt!==void 0&&q.has(Et)?Yt(Et):ee.protectedKeys[Et]=!0}ee.prevProp=re,ee.prevResolvedValues=mt,ee.isActive&&(H={...H,...mt}),o&&e.blockInitialAnimation&&(Ne=!1),Ne&&(!(He&&qe)||ft)&&F.push(...ut.map(Et=>({animation:Et,options:{type:Q}})))}if(q.size){const te={};q.forEach(Q=>{const ee=e.getBaseTarget(Q),re=e.getValue(Q);re&&(re.liveStyle=!0),te[Q]=ee??null}),F.push({animation:te})}let U=!!F.length;return o&&(k.initial===!1||k.initial===k.animate)&&!e.manuallyAnimateOnMount&&(U=!1),o=!1,U?t(F):Promise.resolve()}function b(s,k){var O;if(r[s].isActive===k)return Promise.resolve();(O=e.variantChildren)===null||O===void 0||O.forEach(q=>{var H;return(H=q.animationState)===null||H===void 0?void 0:H.setActive(s,k)}),r[s].isActive=k;const F=_(s);for(const q in r)r[q].protectedKeys={};return F}return{animateChanges:_,setActive:b,setAnimateFunction:m,getState:()=>r,reset:()=>{r=mL(),o=!0}}}function oY(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!j2(t,e):!1}function lh(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function mL(){return{animate:lh(!0),whileInView:lh(),whileHover:lh(),whileTap:lh(),whileDrag:lh(),whileFocus:lh(),exit:lh()}}class cd{constructor(t){this.isMounted=!1,this.node=t}update(){}}class aY extends cd{constructor(t){super(t),t.animationState||(t.animationState=sY(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();C_(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:r}=this.node.prevProps||{};t!==r&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let lY=0;class cY extends cd{constructor(){super(...arguments),this.id=lY++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:r}=this.node.presenceContext,{isPresent:o}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===o)return;const u=this.node.animationState.setActive("exit",!t);r&&!t&&u.then(()=>r(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const uY={animation:{Feature:aY},exit:{Feature:cY}},T5=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1;function Cb(e,t="page"){return{point:{x:e[`${t}X`],y:e[`${t}Y`]}}}const dY=e=>t=>T5(t)&&e(t,Cb(t));function Kl(e,t,r,o={passive:!0}){return e.addEventListener(t,r,o),()=>e.removeEventListener(t,r)}function rc(e,t,r,o){return Kl(e,t,dY(r),o)}const gL=(e,t)=>Math.abs(e-t);function hY(e,t){const r=gL(e.x,t.x),o=gL(e.y,t.y);return Math.sqrt(r**2+o**2)}class E5{constructor(t,r,{transformPagePoint:o,contextWindow:u,dragSnapToOrigin:m=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const F=IT(this.lastMoveEventInfo,this.history),q=this.startEvent!==null,H=hY(F.offset,{x:0,y:0})>=3;if(!q&&!H)return;const{point:J}=F,{timestamp:U}=is;this.history.push({...J,timestamp:U});const{onStart:te,onMove:Q}=this.handlers;q||(te&&te(this.lastMoveEvent,F),this.startEvent=this.lastMoveEvent),Q&&Q(this.lastMoveEvent,F)},this.handlePointerMove=(F,q)=>{this.lastMoveEvent=F,this.lastMoveEventInfo=AT(q,this.transformPagePoint),Ir.update(this.updatePoint,!0)},this.handlePointerUp=(F,q)=>{this.end();const{onEnd:H,onSessionEnd:J,resumeAnimation:U}=this.handlers;if(this.dragSnapToOrigin&&U&&U(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const te=IT(F.type==="pointercancel"?this.lastMoveEventInfo:AT(q,this.transformPagePoint),this.history);this.startEvent&&H&&H(F,te),J&&J(F,te)},!T5(t))return;this.dragSnapToOrigin=m,this.handlers=r,this.transformPagePoint=o,this.contextWindow=u||window;const _=Cb(t),b=AT(_,this.transformPagePoint),{point:s}=b,{timestamp:k}=is;this.history=[{...s,timestamp:k}];const{onSessionStart:O}=r;O&&O(t,IT(b,this.history)),this.removeListeners=nc(rc(this.contextWindow,"pointermove",this.handlePointerMove),rc(this.contextWindow,"pointerup",this.handlePointerUp),rc(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),cc(this.updatePoint)}}function AT(e,t){return t?{point:t(e.point)}:e}function yL(e,t){return{x:e.x-t.x,y:e.y-t.y}}function IT({point:e},t){return{point:e,delta:yL(e,C5(t)),offset:yL(e,fY(t)),velocity:pY(t,.1)}}function fY(e){return e[0]}function C5(e){return e[e.length-1]}function pY(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,o=null;const u=C5(e);for(;r>=0&&(o=e[r],!(u.timestamp-o.timestamp>ec(t)));)r--;if(!o)return{x:0,y:0};const m=tc(u.timestamp-o.timestamp);if(m===0)return{x:0,y:0};const _={x:(u.x-o.x)/m,y:(u.y-o.y)/m};return _.x===1/0&&(_.x=0),_.y===1/0&&(_.y=0),_}function P5(e){let t=null;return()=>{const r=()=>{t=null};return t===null?(t=e,r):!1}}const _L=P5("dragHorizontal"),xL=P5("dragVertical");function M5(e){let t=!1;if(e==="y")t=xL();else if(e==="x")t=_L();else{const r=_L(),o=xL();r&&o?t=()=>{r(),o()}:(r&&r(),o&&o())}return t}function A5(){const e=M5(!0);return e?(e(),!1):!0}function Np(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}const I5=1e-4,mY=1-I5,gY=1+I5,D5=.01,yY=0-D5,_Y=0+D5;function Ao(e){return e.max-e.min}function xY(e,t,r){return Math.abs(e-t)<=r}function vL(e,t,r,o=.5){e.origin=o,e.originPoint=di(t.min,t.max,e.origin),e.scale=Ao(r)/Ao(t),e.translate=di(r.min,r.max,e.origin)-e.originPoint,(e.scale>=mY&&e.scale<=gY||isNaN(e.scale))&&(e.scale=1),(e.translate>=yY&&e.translate<=_Y||isNaN(e.translate))&&(e.translate=0)}function Yy(e,t,r,o){vL(e.x,t.x,r.x,o?o.originX:void 0),vL(e.y,t.y,r.y,o?o.originY:void 0)}function bL(e,t,r){e.min=r.min+t.min,e.max=e.min+Ao(t)}function vY(e,t,r){bL(e.x,t.x,r.x),bL(e.y,t.y,r.y)}function wL(e,t,r){e.min=t.min-r.min,e.max=e.min+Ao(t)}function Ky(e,t,r){wL(e.x,t.x,r.x),wL(e.y,t.y,r.y)}function bY(e,{min:t,max:r},o){return t!==void 0&&e<t?e=o?di(t,e,o.min):Math.max(e,t):r!==void 0&&e>r&&(e=o?di(r,e,o.max):Math.min(e,r)),e}function SL(e,t,r){return{min:t!==void 0?e.min+t:void 0,max:r!==void 0?e.max+r-(e.max-e.min):void 0}}function wY(e,{top:t,left:r,bottom:o,right:u}){return{x:SL(e.x,r,u),y:SL(e.y,t,o)}}function TL(e,t){let r=t.min-e.min,o=t.max-e.max;return t.max-t.min<e.max-e.min&&([r,o]=[o,r]),{min:r,max:o}}function SY(e,t){return{x:TL(e.x,t.x),y:TL(e.y,t.y)}}function TY(e,t){let r=.5;const o=Ao(e),u=Ao(t);return u>o?r=A_(t.min,t.max-o,e.min):o>u&&(r=A_(e.min,e.max-u,t.min)),Gu(0,1,r)}function EY(e,t){const r={};return t.min!==void 0&&(r.min=t.min-e.min),t.max!==void 0&&(r.max=t.max-e.min),r}const IC=.35;function CY(e=IC){return e===!1?e=0:e===!0&&(e=IC),{x:EL(e,"left","right"),y:EL(e,"top","bottom")}}function EL(e,t,r){return{min:CL(e,t),max:CL(e,r)}}function CL(e,t){return typeof e=="number"?e:e[t]||0}const PL=()=>({translate:0,scale:1,origin:0,originPoint:0}),Lp=()=>({x:PL(),y:PL()}),ML=()=>({min:0,max:0}),Si=()=>({x:ML(),y:ML()});function Xo(e){return[e("x"),e("y")]}function R5({top:e,left:t,right:r,bottom:o}){return{x:{min:t,max:r},y:{min:e,max:o}}}function PY({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function MY(e,t){if(!t)return e;const r=t({x:e.left,y:e.top}),o=t({x:e.right,y:e.bottom});return{top:r.y,left:r.x,bottom:o.y,right:o.x}}function DT(e){return e===void 0||e===1}function DC({scale:e,scaleX:t,scaleY:r}){return!DT(e)||!DT(t)||!DT(r)}function hh(e){return DC(e)||k5(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function k5(e){return AL(e.x)||AL(e.y)}function AL(e){return e&&e!=="0%"}function j1(e,t,r){const o=e-r,u=t*o;return r+u}function IL(e,t,r,o,u){return u!==void 0&&(e=j1(e,u,o)),j1(e,r,o)+t}function RC(e,t=0,r=1,o,u){e.min=IL(e.min,t,r,o,u),e.max=IL(e.max,t,r,o,u)}function N5(e,{x:t,y:r}){RC(e.x,t.translate,t.scale,t.originPoint),RC(e.y,r.translate,r.scale,r.originPoint)}const DL=.999999999999,RL=1.0000000000001;function AY(e,t,r,o=!1){const u=r.length;if(!u)return;t.x=t.y=1;let m,_;for(let b=0;b<u;b++){m=r[b],_=m.projectionDelta;const{visualElement:s}=m.options;s&&s.props.style&&s.props.style.display==="contents"||(o&&m.options.layoutScroll&&m.scroll&&m!==m.root&&jp(e,{x:-m.scroll.offset.x,y:-m.scroll.offset.y}),_&&(t.x*=_.x.scale,t.y*=_.y.scale,N5(e,_)),o&&hh(m.latestValues)&&jp(e,m.latestValues))}t.x<RL&&t.x>DL&&(t.x=1),t.y<RL&&t.y>DL&&(t.y=1)}function Op(e,t){e.min=e.min+t,e.max=e.max+t}function kL(e,t,r,o,u=.5){const m=di(e.min,e.max,u);RC(e,t,r,m,o)}function jp(e,t){kL(e.x,t.x,t.scaleX,t.scale,t.originX),kL(e.y,t.y,t.scaleY,t.scale,t.originY)}function L5(e,t){return R5(MY(e.getBoundingClientRect(),t))}function IY(e,t,r){const o=L5(e,r),{scroll:u}=t;return u&&(Op(o.x,u.offset.x),Op(o.y,u.offset.y)),o}const O5=({current:e})=>e?e.ownerDocument.defaultView:null,DY=new WeakMap;class RY{constructor(t){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Si(),this.visualElement=t}start(t,{snapToCursor:r=!1}={}){const{presenceContext:o}=this.visualElement;if(o&&o.isPresent===!1)return;const u=O=>{const{dragSnapToOrigin:F}=this.getProps();F?this.pauseAnimation():this.stopAnimation(),r&&this.snapToCursor(Cb(O,"page").point)},m=(O,F)=>{const{drag:q,dragPropagation:H,onDragStart:J}=this.getProps();if(q&&!H&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=M5(q),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Xo(te=>{let Q=this.getAxisMotionValue(te).get()||0;if(pl.test(Q)){const{projection:ee}=this.visualElement;if(ee&&ee.layout){const re=ee.layout.layoutBox[te];re&&(Q=Ao(re)*(parseFloat(Q)/100))}}this.originPoint[te]=Q}),J&&Ir.postRender(()=>J(O,F)),MC(this.visualElement,"transform");const{animationState:U}=this.visualElement;U&&U.setActive("whileDrag",!0)},_=(O,F)=>{const{dragPropagation:q,dragDirectionLock:H,onDirectionLock:J,onDrag:U}=this.getProps();if(!q&&!this.openGlobalLock)return;const{offset:te}=F;if(H&&this.currentDirection===null){this.currentDirection=kY(te),this.currentDirection!==null&&J&&J(this.currentDirection);return}this.updateAxis("x",F.point,te),this.updateAxis("y",F.point,te),this.visualElement.render(),U&&U(O,F)},b=(O,F)=>this.stop(O,F),s=()=>Xo(O=>{var F;return this.getAnimationState(O)==="paused"&&((F=this.getAxisMotionValue(O).animation)===null||F===void 0?void 0:F.play())}),{dragSnapToOrigin:k}=this.getProps();this.panSession=new E5(t,{onSessionStart:u,onStart:m,onMove:_,onSessionEnd:b,resumeAnimation:s},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:k,contextWindow:O5(this.visualElement)})}stop(t,r){const o=this.isDragging;if(this.cancel(),!o)return;const{velocity:u}=r;this.startAnimation(u);const{onDragEnd:m}=this.getProps();m&&Ir.postRender(()=>m(t,r))}cancel(){this.isDragging=!1;const{projection:t,animationState:r}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:o}=this.getProps();!o&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(t,r,o){const{drag:u}=this.getProps();if(!o||!pv(t,u,this.currentDirection))return;const m=this.getAxisMotionValue(t);let _=this.originPoint[t]+o[t];this.constraints&&this.constraints[t]&&(_=bY(_,this.constraints[t],this.elastic[t])),m.set(_)}resolveConstraints(){var t;const{dragConstraints:r,dragElastic:o}=this.getProps(),u=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,m=this.constraints;r&&Np(r)?this.constraints||(this.constraints=this.resolveRefConstraints()):r&&u?this.constraints=wY(u.layoutBox,r):this.constraints=!1,this.elastic=CY(o),m!==this.constraints&&u&&this.constraints&&!this.hasMutatedConstraints&&Xo(_=>{this.constraints!==!1&&this.getAxisMotionValue(_)&&(this.constraints[_]=EY(u.layoutBox[_],this.constraints[_]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:r}=this.getProps();if(!t||!Np(t))return!1;const o=t.current,{projection:u}=this.visualElement;if(!u||!u.layout)return!1;const m=IY(o,u.root,this.visualElement.getTransformPagePoint());let _=SY(u.layout.layoutBox,m);if(r){const b=r(PY(_));this.hasMutatedConstraints=!!b,b&&(_=R5(b))}return _}startAnimation(t){const{drag:r,dragMomentum:o,dragElastic:u,dragTransition:m,dragSnapToOrigin:_,onDragTransitionEnd:b}=this.getProps(),s=this.constraints||{},k=Xo(O=>{if(!pv(O,r,this.currentDirection))return;let F=s&&s[O]||{};_&&(F={min:0,max:0});const q=u?200:1e6,H=u?40:1e7,J={type:"inertia",velocity:o?t[O]:0,bounceStiffness:q,bounceDamping:H,timeConstant:750,restDelta:1,restSpeed:10,...m,...F};return this.startAxisValueAnimation(O,J)});return Promise.all(k).then(b)}startAxisValueAnimation(t,r){const o=this.getAxisMotionValue(t);return MC(this.visualElement,t),o.start(IM(t,o,0,r,this.visualElement,!1))}stopAnimation(){Xo(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Xo(t=>{var r;return(r=this.getAxisMotionValue(t).animation)===null||r===void 0?void 0:r.pause()})}getAnimationState(t){var r;return(r=this.getAxisMotionValue(t).animation)===null||r===void 0?void 0:r.state}getAxisMotionValue(t){const r=`_drag${t.toUpperCase()}`,o=this.visualElement.getProps(),u=o[r];return u||this.visualElement.getValue(t,(o.initial?o.initial[t]:void 0)||0)}snapToCursor(t){Xo(r=>{const{drag:o}=this.getProps();if(!pv(r,o,this.currentDirection))return;const{projection:u}=this.visualElement,m=this.getAxisMotionValue(r);if(u&&u.layout){const{min:_,max:b}=u.layout.layoutBox[r];m.set(t[r]-di(_,b,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:r}=this.getProps(),{projection:o}=this.visualElement;if(!Np(r)||!o||!this.constraints)return;this.stopAnimation();const u={x:0,y:0};Xo(_=>{const b=this.getAxisMotionValue(_);if(b&&this.constraints!==!1){const s=b.get();u[_]=TY({min:s,max:s},this.constraints[_])}});const{transformTemplate:m}=this.visualElement.getProps();this.visualElement.current.style.transform=m?m({},""):"none",o.root&&o.root.updateScroll(),o.updateLayout(),this.resolveConstraints(),Xo(_=>{if(!pv(_,t,null))return;const b=this.getAxisMotionValue(_),{min:s,max:k}=this.constraints[_];b.set(di(s,k,u[_]))})}addListeners(){if(!this.visualElement.current)return;DY.set(this.visualElement,this);const t=this.visualElement.current,r=rc(t,"pointerdown",s=>{const{drag:k,dragListener:O=!0}=this.getProps();k&&O&&this.start(s)}),o=()=>{const{dragConstraints:s}=this.getProps();Np(s)&&s.current&&(this.constraints=this.resolveRefConstraints())},{projection:u}=this.visualElement,m=u.addEventListener("measure",o);u&&!u.layout&&(u.root&&u.root.updateScroll(),u.updateLayout()),Ir.read(o);const _=Kl(window,"resize",()=>this.scalePositionWithinConstraints()),b=u.addEventListener("didUpdate",({delta:s,hasLayoutChanged:k})=>{this.isDragging&&k&&(Xo(O=>{const F=this.getAxisMotionValue(O);F&&(this.originPoint[O]+=s[O].translate,F.set(F.get()+s[O].translate))}),this.visualElement.render())});return()=>{_(),r(),m(),b&&b()}}getProps(){const t=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:o=!1,dragPropagation:u=!1,dragConstraints:m=!1,dragElastic:_=IC,dragMomentum:b=!0}=t;return{...t,drag:r,dragDirectionLock:o,dragPropagation:u,dragConstraints:m,dragElastic:_,dragMomentum:b}}}function pv(e,t,r){return(t===!0||t===e)&&(r===null||r===e)}function kY(e,t=10){let r=null;return Math.abs(e.y)>t?r="y":Math.abs(e.x)>t&&(r="x"),r}class NY extends cd{constructor(t){super(t),this.removeGroupControls=vs,this.removeListeners=vs,this.controls=new RY(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||vs}unmount(){this.removeGroupControls(),this.removeListeners()}}const NL=e=>(t,r)=>{e&&Ir.postRender(()=>e(t,r))};class LY extends cd{constructor(){super(...arguments),this.removePointerDownListener=vs}onPointerDown(t){this.session=new E5(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:O5(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:r,onPan:o,onPanEnd:u}=this.node.getProps();return{onSessionStart:NL(t),onStart:NL(r),onMove:o,onEnd:(m,_)=>{delete this.session,u&&Ir.postRender(()=>u(m,_))}}}mount(){this.removePointerDownListener=rc(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const kM=W.createContext(null);function OY(){const e=W.useContext(kM);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:r,register:o}=e,u=W.useId();W.useEffect(()=>o(u),[]);const m=W.useCallback(()=>r&&r(u),[u,r]);return!t&&r?[!1,m]:[!0]}const j5=W.createContext({}),z5=W.createContext({}),Hv={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function LL(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const by={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(An.test(e))e=parseFloat(e);else return e;const r=LL(e,t.target.x),o=LL(e,t.target.y);return`${r}% ${o}%`}},jY={correct:(e,{treeScale:t,projectionDelta:r})=>{const o=e,u=Wu.parse(e);if(u.length>5)return o;const m=Wu.createTransformer(e),_=typeof u[0]!="number"?1:0,b=r.x.scale*t.x,s=r.y.scale*t.y;u[0+_]/=b,u[1+_]/=s;const k=di(b,s,.5);return typeof u[2+_]=="number"&&(u[2+_]/=k),typeof u[3+_]=="number"&&(u[3+_]/=k),m(u)}},z1={};function zY(e){Object.assign(z1,e)}const{schedule:NM,cancel:rde}=z2(queueMicrotask,!1);class FY extends W.Component{componentDidMount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:o,layoutId:u}=this.props,{projection:m}=t;zY(BY),m&&(r.group&&r.group.add(m),o&&o.register&&u&&o.register(m),m.root.didUpdate(),m.addEventListener("animationComplete",()=>{this.safeToRemove()}),m.setOptions({...m.options,onExitComplete:()=>this.safeToRemove()})),Hv.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:r,visualElement:o,drag:u,isPresent:m}=this.props,_=o.projection;return _&&(_.isPresent=m,u||t.layoutDependency!==r||r===void 0?_.willUpdate():this.safeToRemove(),t.isPresent!==m&&(m?_.promote():_.relegate()||Ir.postRender(()=>{const b=_.getStack();(!b||!b.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),NM.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:o}=this.props,{projection:u}=t;u&&(u.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(u),o&&o.deregister&&o.deregister(u))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function F5(e){const[t,r]=OY(),o=W.useContext(j5);return S.jsx(FY,{...e,layoutGroup:o,switchLayoutGroup:W.useContext(z5),isPresent:t,safeToRemove:r})}const BY={borderRadius:{...by,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:by,borderTopRightRadius:by,borderBottomLeftRadius:by,borderBottomRightRadius:by,boxShadow:jY},B5=["TopLeft","TopRight","BottomLeft","BottomRight"],VY=B5.length,OL=e=>typeof e=="string"?parseFloat(e):e,jL=e=>typeof e=="number"||An.test(e);function UY(e,t,r,o,u,m){u?(e.opacity=di(0,r.opacity!==void 0?r.opacity:1,$Y(o)),e.opacityExit=di(t.opacity!==void 0?t.opacity:1,0,GY(o))):m&&(e.opacity=di(t.opacity!==void 0?t.opacity:1,r.opacity!==void 0?r.opacity:1,o));for(let _=0;_<VY;_++){const b=`border${B5[_]}Radius`;let s=zL(t,b),k=zL(r,b);if(s===void 0&&k===void 0)continue;s||(s=0),k||(k=0),s===0||k===0||jL(s)===jL(k)?(e[b]=Math.max(di(OL(s),OL(k),o),0),(pl.test(k)||pl.test(s))&&(e[b]+="%")):e[b]=k}(t.rotate||r.rotate)&&(e.rotate=di(t.rotate||0,r.rotate||0,o))}function zL(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const $Y=V5(0,.5,u5),GY=V5(.5,.95,vs);function V5(e,t,r){return o=>o<e?0:o>t?1:r(A_(e,t,o))}function FL(e,t){e.min=t.min,e.max=t.max}function qo(e,t){FL(e.x,t.x),FL(e.y,t.y)}function BL(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function VL(e,t,r,o,u){return e-=t,e=j1(e,1/r,o),u!==void 0&&(e=j1(e,1/u,o)),e}function WY(e,t=0,r=1,o=.5,u,m=e,_=e){if(pl.test(t)&&(t=parseFloat(t),t=di(_.min,_.max,t/100)-_.min),typeof t!="number")return;let b=di(m.min,m.max,o);e===m&&(b-=t),e.min=VL(e.min,t,r,b,u),e.max=VL(e.max,t,r,b,u)}function UL(e,t,[r,o,u],m,_){WY(e,t[r],t[o],t[u],t.scale,m,_)}const HY=["x","scaleX","originX"],qY=["y","scaleY","originY"];function $L(e,t,r,o){UL(e.x,t,HY,r?r.x:void 0,o?o.x:void 0),UL(e.y,t,qY,r?r.y:void 0,o?o.y:void 0)}function GL(e){return e.translate===0&&e.scale===1}function U5(e){return GL(e.x)&&GL(e.y)}function WL(e,t){return e.min===t.min&&e.max===t.max}function ZY(e,t){return WL(e.x,t.x)&&WL(e.y,t.y)}function HL(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function $5(e,t){return HL(e.x,t.x)&&HL(e.y,t.y)}function qL(e){return Ao(e.x)/Ao(e.y)}function ZL(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class XY{constructor(){this.members=[]}add(t){Y_(this.members,t),t.scheduleRender()}remove(t){if(DM(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(t){const r=this.members.findIndex(u=>t===u);if(r===0)return!1;let o;for(let u=r;u>=0;u--){const m=this.members[u];if(m.isPresent!==!1){o=m;break}}return o?(this.promote(o),!0):!1}promote(t,r){const o=this.lead;if(t!==o&&(this.prevLead=o,this.lead=t,t.show(),o)){o.instance&&o.scheduleRender(),t.scheduleRender(),t.resumeFrom=o,r&&(t.resumeFrom.preserveOpacity=!0),o.snapshot&&(t.snapshot=o.snapshot,t.snapshot.latestValues=o.animationValues||o.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:u}=t.options;u===!1&&o.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:r,resumingFrom:o}=t;r.onExitComplete&&r.onExitComplete(),o&&o.options.onExitComplete&&o.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function YY(e,t,r){let o="";const u=e.x.translate/t.x,m=e.y.translate/t.y,_=(r==null?void 0:r.z)||0;if((u||m||_)&&(o=`translate3d(${u}px, ${m}px, ${_}px) `),(t.x!==1||t.y!==1)&&(o+=`scale(${1/t.x}, ${1/t.y}) `),r){const{transformPerspective:k,rotate:O,rotateX:F,rotateY:q,skewX:H,skewY:J}=r;k&&(o=`perspective(${k}px) ${o}`),O&&(o+=`rotate(${O}deg) `),F&&(o+=`rotateX(${F}deg) `),q&&(o+=`rotateY(${q}deg) `),H&&(o+=`skewX(${H}deg) `),J&&(o+=`skewY(${J}deg) `)}const b=e.x.scale*t.x,s=e.y.scale*t.y;return(b!==1||s!==1)&&(o+=`scale(${b}, ${s})`),o||"none"}const KY=(e,t)=>e.depth-t.depth;class JY{constructor(){this.children=[],this.isDirty=!1}add(t){Y_(this.children,t),this.isDirty=!0}remove(t){DM(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(KY),this.isDirty=!1,this.children.forEach(t)}}function qv(e){const t=xs(e)?e.get():e;return $X(t)?t.toValue():t}function QY(e,t){const r=ml.now(),o=({timestamp:u})=>{const m=u-r;m>=t&&(cc(o),e(m-t))};return Ir.read(o,!0),()=>cc(o)}function eK(e){return e instanceof SVGElement&&e.tagName!=="svg"}function tK(e,t,r){const o=xs(e)?e:I_(e);return o.start(IM("",o,t,r)),o.animation}const fh={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},ky=typeof window<"u"&&window.MotionDebug!==void 0,RT=["","X","Y","Z"],nK={visibility:"hidden"},XL=1e3;let rK=0;function kT(e,t,r,o){const{latestValues:u}=t;u[e]&&(r[e]=u[e],t.setStaticValue(e,0),o&&(o[e]=0))}function G5(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const r=v5(t);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:u,layoutId:m}=e.options;window.MotionCancelOptimisedAnimation(r,"transform",Ir,!(u||m))}const{parent:o}=e;o&&!o.hasCheckedOptimisedAppear&&G5(o)}function W5({attachResizeListener:e,defaultParent:t,measureScroll:r,checkIsScrollRoot:o,resetTransform:u}){return class{constructor(_={},b=t==null?void 0:t()){this.id=rK++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,ky&&(fh.totalNodes=fh.resolvedTargetDeltas=fh.recalculatedProjection=0),this.nodes.forEach(oK),this.nodes.forEach(dK),this.nodes.forEach(hK),this.nodes.forEach(aK),ky&&window.MotionDebug.record(fh)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=_,this.root=b?b.root||b:this,this.path=b?[...b.path,b]:[],this.parent=b,this.depth=b?b.depth+1:0;for(let s=0;s<this.path.length;s++)this.path[s].shouldResetTransform=!0;this.root===this&&(this.nodes=new JY)}addEventListener(_,b){return this.eventHandlers.has(_)||this.eventHandlers.set(_,new RM),this.eventHandlers.get(_).add(b)}notifyListeners(_,...b){const s=this.eventHandlers.get(_);s&&s.notify(...b)}hasListeners(_){return this.eventHandlers.has(_)}mount(_,b=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=eK(_),this.instance=_;const{layoutId:s,layout:k,visualElement:O}=this.options;if(O&&!O.current&&O.mount(_),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),b&&(k||s)&&(this.isLayoutDirty=!0),e){let F;const q=()=>this.root.updateBlockedByResize=!1;e(_,()=>{this.root.updateBlockedByResize=!0,F&&F(),F=QY(q,250),Hv.hasAnimatedSinceResize&&(Hv.hasAnimatedSinceResize=!1,this.nodes.forEach(KL))})}s&&this.root.registerSharedNode(s,this),this.options.animate!==!1&&O&&(s||k)&&this.addEventListener("didUpdate",({delta:F,hasLayoutChanged:q,hasRelativeTargetChanged:H,layout:J})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const U=this.options.transition||O.getDefaultTransition()||yK,{onLayoutAnimationStart:te,onLayoutAnimationComplete:Q}=O.getProps(),ee=!this.targetLayout||!$5(this.targetLayout,J)||H,re=!q&&H;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||re||q&&(ee||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(F,re);const xe={...yM(U,"layout"),onPlay:te,onComplete:Q};(O.shouldReduceMotion||this.options.layoutRoot)&&(xe.delay=0,xe.type=!1),this.startAnimation(xe)}else q||KL(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=J})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const _=this.getStack();_&&_.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,cc(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(fK),this.animationId++)}getTransformTemplate(){const{visualElement:_}=this.options;return _&&_.getProps().transformTemplate}willUpdate(_=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&G5(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let O=0;O<this.path.length;O++){const F=this.path[O];F.shouldResetTransform=!0,F.updateScroll("snapshot"),F.options.layoutRoot&&F.willUpdate(!1)}const{layoutId:b,layout:s}=this.options;if(b===void 0&&!s)return;const k=this.getTransformTemplate();this.prevTransformTemplateValue=k?k(this.latestValues,""):void 0,this.updateSnapshot(),_&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(YL);return}this.isUpdating||this.nodes.forEach(cK),this.isUpdating=!1,this.nodes.forEach(uK),this.nodes.forEach(iK),this.nodes.forEach(sK),this.clearAllSnapshots();const b=ml.now();is.delta=Gu(0,1e3/60,b-is.timestamp),is.timestamp=b,is.isProcessing=!0,TT.update.process(is),TT.preRender.process(is),TT.render.process(is),is.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,NM.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(lK),this.sharedNodes.forEach(pK)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Ir.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Ir.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let s=0;s<this.path.length;s++)this.path[s].updateScroll();const _=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Si(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:b}=this.options;b&&b.notify("LayoutMeasure",this.layout.layoutBox,_?_.layoutBox:void 0)}updateScroll(_="measure"){let b=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===_&&(b=!1),b){const s=o(this.instance);this.scroll={animationId:this.root.animationId,phase:_,isRoot:s,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:s}}}resetTransform(){if(!u)return;const _=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,b=this.projectionDelta&&!U5(this.projectionDelta),s=this.getTransformTemplate(),k=s?s(this.latestValues,""):void 0,O=k!==this.prevTransformTemplateValue;_&&(b||hh(this.latestValues)||O)&&(u(this.instance,k),this.shouldResetTransform=!1,this.scheduleRender())}measure(_=!0){const b=this.measurePageBox();let s=this.removeElementScroll(b);return _&&(s=this.removeTransform(s)),_K(s),{animationId:this.root.animationId,measuredBox:b,layoutBox:s,latestValues:{},source:this.id}}measurePageBox(){var _;const{visualElement:b}=this.options;if(!b)return Si();const s=b.measureViewportBox();if(!(((_=this.scroll)===null||_===void 0?void 0:_.wasRoot)||this.path.some(xK))){const{scroll:O}=this.root;O&&(Op(s.x,O.offset.x),Op(s.y,O.offset.y))}return s}removeElementScroll(_){var b;const s=Si();if(qo(s,_),!((b=this.scroll)===null||b===void 0)&&b.wasRoot)return s;for(let k=0;k<this.path.length;k++){const O=this.path[k],{scroll:F,options:q}=O;O!==this.root&&F&&q.layoutScroll&&(F.wasRoot&&qo(s,_),Op(s.x,F.offset.x),Op(s.y,F.offset.y))}return s}applyTransform(_,b=!1){const s=Si();qo(s,_);for(let k=0;k<this.path.length;k++){const O=this.path[k];!b&&O.options.layoutScroll&&O.scroll&&O!==O.root&&jp(s,{x:-O.scroll.offset.x,y:-O.scroll.offset.y}),hh(O.latestValues)&&jp(s,O.latestValues)}return hh(this.latestValues)&&jp(s,this.latestValues),s}removeTransform(_){const b=Si();qo(b,_);for(let s=0;s<this.path.length;s++){const k=this.path[s];if(!k.instance||!hh(k.latestValues))continue;DC(k.latestValues)&&k.updateSnapshot();const O=Si(),F=k.measurePageBox();qo(O,F),$L(b,k.latestValues,k.snapshot?k.snapshot.layoutBox:void 0,O)}return hh(this.latestValues)&&$L(b,this.latestValues),b}setTargetDelta(_){this.targetDelta=_,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(_){this.options={...this.options,..._,crossfade:_.crossfade!==void 0?_.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==is.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(_=!1){var b;const s=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=s.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=s.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=s.isSharedProjectionDirty);const k=!!this.resumingFrom||this!==s;if(!(_||k&&this.isSharedProjectionDirty||this.isProjectionDirty||!((b=this.parent)===null||b===void 0)&&b.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:F,layoutId:q}=this.options;if(!(!this.layout||!(F||q))){if(this.resolvedRelativeTargetAt=is.timestamp,!this.targetDelta&&!this.relativeTarget){const H=this.getClosestProjectingParent();H&&H.layout&&this.animationProgress!==1?(this.relativeParent=H,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Si(),this.relativeTargetOrigin=Si(),Ky(this.relativeTargetOrigin,this.layout.layoutBox,H.layout.layoutBox),qo(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Si(),this.targetWithTransforms=Si()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),vY(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):qo(this.target,this.layout.layoutBox),N5(this.target,this.targetDelta)):qo(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const H=this.getClosestProjectingParent();H&&!!H.resumingFrom==!!this.resumingFrom&&!H.options.layoutScroll&&H.target&&this.animationProgress!==1?(this.relativeParent=H,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Si(),this.relativeTargetOrigin=Si(),Ky(this.relativeTargetOrigin,this.target,H.target),qo(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}ky&&fh.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||DC(this.parent.latestValues)||k5(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var _;const b=this.getLead(),s=!!this.resumingFrom||this!==b;let k=!0;if((this.isProjectionDirty||!((_=this.parent)===null||_===void 0)&&_.isProjectionDirty)&&(k=!1),s&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(k=!1),this.resolvedRelativeTargetAt===is.timestamp&&(k=!1),k)return;const{layout:O,layoutId:F}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(O||F))return;qo(this.layoutCorrected,this.layout.layoutBox);const q=this.treeScale.x,H=this.treeScale.y;AY(this.layoutCorrected,this.treeScale,this.path,s),b.layout&&!b.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(b.target=b.layout.layoutBox,b.targetWithTransforms=Si());const{target:J}=b;if(!J){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(BL(this.prevProjectionDelta.x,this.projectionDelta.x),BL(this.prevProjectionDelta.y,this.projectionDelta.y)),Yy(this.projectionDelta,this.layoutCorrected,J,this.latestValues),(this.treeScale.x!==q||this.treeScale.y!==H||!ZL(this.projectionDelta.x,this.prevProjectionDelta.x)||!ZL(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",J)),ky&&fh.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(_=!0){var b;if((b=this.options.visualElement)===null||b===void 0||b.scheduleRender(),_){const s=this.getStack();s&&s.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Lp(),this.projectionDelta=Lp(),this.projectionDeltaWithTransform=Lp()}setAnimationOrigin(_,b=!1){const s=this.snapshot,k=s?s.latestValues:{},O={...this.latestValues},F=Lp();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!b;const q=Si(),H=s?s.source:void 0,J=this.layout?this.layout.source:void 0,U=H!==J,te=this.getStack(),Q=!te||te.members.length<=1,ee=!!(U&&!Q&&this.options.crossfade===!0&&!this.path.some(gK));this.animationProgress=0;let re;this.mixTargetDelta=xe=>{const Ee=xe/1e3;JL(F.x,_.x,Ee),JL(F.y,_.y,Ee),this.setTargetDelta(F),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Ky(q,this.layout.layoutBox,this.relativeParent.layout.layoutBox),mK(this.relativeTarget,this.relativeTargetOrigin,q,Ee),re&&ZY(this.relativeTarget,re)&&(this.isProjectionDirty=!1),re||(re=Si()),qo(re,this.relativeTarget)),U&&(this.animationValues=O,UY(O,k,this.latestValues,Ee,ee,Q)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Ee},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(_){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(cc(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Ir.update(()=>{Hv.hasAnimatedSinceResize=!0,this.currentAnimation=tK(0,XL,{..._,onUpdate:b=>{this.mixTargetDelta(b),_.onUpdate&&_.onUpdate(b)},onComplete:()=>{_.onComplete&&_.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const _=this.getStack();_&&_.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(XL),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const _=this.getLead();let{targetWithTransforms:b,target:s,layout:k,latestValues:O}=_;if(!(!b||!s||!k)){if(this!==_&&this.layout&&k&&H5(this.options.animationType,this.layout.layoutBox,k.layoutBox)){s=this.target||Si();const F=Ao(this.layout.layoutBox.x);s.x.min=_.target.x.min,s.x.max=s.x.min+F;const q=Ao(this.layout.layoutBox.y);s.y.min=_.target.y.min,s.y.max=s.y.min+q}qo(b,s),jp(b,O),Yy(this.projectionDeltaWithTransform,this.layoutCorrected,b,O)}}registerSharedNode(_,b){this.sharedNodes.has(_)||this.sharedNodes.set(_,new XY),this.sharedNodes.get(_).add(b);const k=b.options.initialPromotionConfig;b.promote({transition:k?k.transition:void 0,preserveFollowOpacity:k&&k.shouldPreserveFollowOpacity?k.shouldPreserveFollowOpacity(b):void 0})}isLead(){const _=this.getStack();return _?_.lead===this:!0}getLead(){var _;const{layoutId:b}=this.options;return b?((_=this.getStack())===null||_===void 0?void 0:_.lead)||this:this}getPrevLead(){var _;const{layoutId:b}=this.options;return b?(_=this.getStack())===null||_===void 0?void 0:_.prevLead:void 0}getStack(){const{layoutId:_}=this.options;if(_)return this.root.sharedNodes.get(_)}promote({needsReset:_,transition:b,preserveFollowOpacity:s}={}){const k=this.getStack();k&&k.promote(this,s),_&&(this.projectionDelta=void 0,this.needsReset=!0),b&&this.setOptions({transition:b})}relegate(){const _=this.getStack();return _?_.relegate(this):!1}resetSkewAndRotation(){const{visualElement:_}=this.options;if(!_)return;let b=!1;const{latestValues:s}=_;if((s.z||s.rotate||s.rotateX||s.rotateY||s.rotateZ||s.skewX||s.skewY)&&(b=!0),!b)return;const k={};s.z&&kT("z",_,k,this.animationValues);for(let O=0;O<RT.length;O++)kT(`rotate${RT[O]}`,_,k,this.animationValues),kT(`skew${RT[O]}`,_,k,this.animationValues);_.render();for(const O in k)_.setStaticValue(O,k[O]),this.animationValues&&(this.animationValues[O]=k[O]);_.scheduleRender()}getProjectionStyles(_){var b,s;if(!this.instance||this.isSVG)return;if(!this.isVisible)return nK;const k={visibility:""},O=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,k.opacity="",k.pointerEvents=qv(_==null?void 0:_.pointerEvents)||"",k.transform=O?O(this.latestValues,""):"none",k;const F=this.getLead();if(!this.projectionDelta||!this.layout||!F.target){const U={};return this.options.layoutId&&(U.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,U.pointerEvents=qv(_==null?void 0:_.pointerEvents)||""),this.hasProjected&&!hh(this.latestValues)&&(U.transform=O?O({},""):"none",this.hasProjected=!1),U}const q=F.animationValues||F.latestValues;this.applyTransformsToTarget(),k.transform=YY(this.projectionDeltaWithTransform,this.treeScale,q),O&&(k.transform=O(q,k.transform));const{x:H,y:J}=this.projectionDelta;k.transformOrigin=`${H.origin*100}% ${J.origin*100}% 0`,F.animationValues?k.opacity=F===this?(s=(b=q.opacity)!==null&&b!==void 0?b:this.latestValues.opacity)!==null&&s!==void 0?s:1:this.preserveOpacity?this.latestValues.opacity:q.opacityExit:k.opacity=F===this?q.opacity!==void 0?q.opacity:"":q.opacityExit!==void 0?q.opacityExit:0;for(const U in z1){if(q[U]===void 0)continue;const{correct:te,applyTo:Q}=z1[U],ee=k.transform==="none"?q[U]:te(q[U],F);if(Q){const re=Q.length;for(let xe=0;xe<re;xe++)k[Q[xe]]=ee}else k[U]=ee}return this.options.layoutId&&(k.pointerEvents=F===this?qv(_==null?void 0:_.pointerEvents)||"":"none"),k}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(_=>{var b;return(b=_.currentAnimation)===null||b===void 0?void 0:b.stop()}),this.root.nodes.forEach(YL),this.root.sharedNodes.clear()}}}function iK(e){e.updateLayout()}function sK(e){var t;const r=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&r&&e.hasListeners("didUpdate")){const{layoutBox:o,measuredBox:u}=e.layout,{animationType:m}=e.options,_=r.source!==e.layout.source;m==="size"?Xo(F=>{const q=_?r.measuredBox[F]:r.layoutBox[F],H=Ao(q);q.min=o[F].min,q.max=q.min+H}):H5(m,r.layoutBox,o)&&Xo(F=>{const q=_?r.measuredBox[F]:r.layoutBox[F],H=Ao(o[F]);q.max=q.min+H,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[F].max=e.relativeTarget[F].min+H)});const b=Lp();Yy(b,o,r.layoutBox);const s=Lp();_?Yy(s,e.applyTransform(u,!0),r.measuredBox):Yy(s,o,r.layoutBox);const k=!U5(b);let O=!1;if(!e.resumeFrom){const F=e.getClosestProjectingParent();if(F&&!F.resumeFrom){const{snapshot:q,layout:H}=F;if(q&&H){const J=Si();Ky(J,r.layoutBox,q.layoutBox);const U=Si();Ky(U,o,H.layoutBox),$5(J,U)||(O=!0),F.options.layoutRoot&&(e.relativeTarget=U,e.relativeTargetOrigin=J,e.relativeParent=F)}}}e.notifyListeners("didUpdate",{layout:o,snapshot:r,delta:s,layoutDelta:b,hasLayoutChanged:k,hasRelativeTargetChanged:O})}else if(e.isLead()){const{onExitComplete:o}=e.options;o&&o()}e.options.transition=void 0}function oK(e){ky&&fh.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function aK(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function lK(e){e.clearSnapshot()}function YL(e){e.clearMeasurements()}function cK(e){e.isLayoutDirty=!1}function uK(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function KL(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function dK(e){e.resolveTargetDelta()}function hK(e){e.calcProjection()}function fK(e){e.resetSkewAndRotation()}function pK(e){e.removeLeadSnapshot()}function JL(e,t,r){e.translate=di(t.translate,0,r),e.scale=di(t.scale,1,r),e.origin=t.origin,e.originPoint=t.originPoint}function QL(e,t,r,o){e.min=di(t.min,r.min,o),e.max=di(t.max,r.max,o)}function mK(e,t,r,o){QL(e.x,t.x,r.x,o),QL(e.y,t.y,r.y,o)}function gK(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const yK={duration:.45,ease:[.4,0,.1,1]},eO=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),tO=eO("applewebkit/")&&!eO("chrome/")?Math.round:vs;function nO(e){e.min=tO(e.min),e.max=tO(e.max)}function _K(e){nO(e.x),nO(e.y)}function H5(e,t,r){return e==="position"||e==="preserve-aspect"&&!xY(qL(t),qL(r),.2)}function xK(e){var t;return e!==e.root&&((t=e.scroll)===null||t===void 0?void 0:t.wasRoot)}const vK=W5({attachResizeListener:(e,t)=>Kl(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),NT={current:void 0},q5=W5({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!NT.current){const e=new vK({});e.mount(window),e.setOptions({layoutScroll:!0}),NT.current=e}return NT.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),bK={pan:{Feature:LY},drag:{Feature:NY,ProjectionNode:q5,MeasureLayout:F5}};function rO(e,t){const r=t?"pointerenter":"pointerleave",o=t?"onHoverStart":"onHoverEnd",u=(m,_)=>{if(m.pointerType==="touch"||A5())return;const b=e.getProps();e.animationState&&b.whileHover&&e.animationState.setActive("whileHover",t);const s=b[o];s&&Ir.postRender(()=>s(m,_))};return rc(e.current,r,u,{passive:!e.getProps()[o]})}class wK extends cd{mount(){this.unmount=nc(rO(this.node,!0),rO(this.node,!1))}unmount(){}}class SK extends cd{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=nc(Kl(this.node.current,"focus",()=>this.onFocus()),Kl(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const Z5=(e,t)=>t?e===t?!0:Z5(e,t.parentElement):!1;function LT(e,t){if(!t)return;const r=new PointerEvent("pointer"+e);t(r,Cb(r))}class TK extends cd{constructor(){super(...arguments),this.removeStartListeners=vs,this.removeEndListeners=vs,this.removeAccessibleListeners=vs,this.startPointerPress=(t,r)=>{if(this.isPressing)return;this.removeEndListeners();const o=this.node.getProps(),m=rc(window,"pointerup",(b,s)=>{if(!this.checkPressEnd())return;const{onTap:k,onTapCancel:O,globalTapTarget:F}=this.node.getProps(),q=!F&&!Z5(this.node.current,b.target)?O:k;q&&Ir.update(()=>q(b,s))},{passive:!(o.onTap||o.onPointerUp)}),_=rc(window,"pointercancel",(b,s)=>this.cancelPress(b,s),{passive:!(o.onTapCancel||o.onPointerCancel)});this.removeEndListeners=nc(m,_),this.startPress(t,r)},this.startAccessiblePress=()=>{const t=m=>{if(m.key!=="Enter"||this.isPressing)return;const _=b=>{b.key!=="Enter"||!this.checkPressEnd()||LT("up",(s,k)=>{const{onTap:O}=this.node.getProps();O&&Ir.postRender(()=>O(s,k))})};this.removeEndListeners(),this.removeEndListeners=Kl(this.node.current,"keyup",_),LT("down",(b,s)=>{this.startPress(b,s)})},r=Kl(this.node.current,"keydown",t),o=()=>{this.isPressing&&LT("cancel",(m,_)=>this.cancelPress(m,_))},u=Kl(this.node.current,"blur",o);this.removeAccessibleListeners=nc(r,u)}}startPress(t,r){this.isPressing=!0;const{onTapStart:o,whileTap:u}=this.node.getProps();u&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),o&&Ir.postRender(()=>o(t,r))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!A5()}cancelPress(t,r){if(!this.checkPressEnd())return;const{onTapCancel:o}=this.node.getProps();o&&Ir.postRender(()=>o(t,r))}mount(){const t=this.node.getProps(),r=rc(t.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(t.onTapStart||t.onPointerStart)}),o=Kl(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=nc(r,o)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const kC=new WeakMap,OT=new WeakMap,EK=e=>{const t=kC.get(e.target);t&&t(e)},CK=e=>{e.forEach(EK)};function PK({root:e,...t}){const r=e||document;OT.has(r)||OT.set(r,{});const o=OT.get(r),u=JSON.stringify(t);return o[u]||(o[u]=new IntersectionObserver(CK,{root:e,...t})),o[u]}function MK(e,t,r){const o=PK(t);return kC.set(e,r),o.observe(e),()=>{kC.delete(e),o.unobserve(e)}}const AK={some:0,all:1};class IK extends cd{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:r,margin:o,amount:u="some",once:m}=t,_={root:r?r.current:void 0,rootMargin:o,threshold:typeof u=="number"?u:AK[u]},b=s=>{const{isIntersecting:k}=s;if(this.isInView===k||(this.isInView=k,m&&!k&&this.hasEnteredView))return;k&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",k);const{onViewportEnter:O,onViewportLeave:F}=this.node.getProps(),q=k?O:F;q&&q(s)};return MK(this.node.current,_,b)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:r}=this.node;["amount","margin","root"].some(DK(t,r))&&this.startObserver()}unmount(){}}function DK({viewport:e={}},{viewport:t={}}={}){return r=>e[r]!==t[r]}const RK={inView:{Feature:IK},tap:{Feature:TK},focus:{Feature:SK},hover:{Feature:wK}},kK={layout:{ProjectionNode:q5,MeasureLayout:F5}},X5=W.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),Pb=W.createContext({}),LM=typeof window<"u",NK=LM?W.useLayoutEffect:W.useEffect,Y5=W.createContext({strict:!1});let iO=!1;function LK(e,t,r,o,u){var m;const{visualElement:_}=W.useContext(Pb),b=W.useContext(Y5),s=W.useContext(kM),k=W.useContext(X5).reducedMotion,O=W.useRef();o=o||b.renderer,!O.current&&o&&(O.current=o(e,{visualState:t,parent:_,props:r,presenceContext:s,blockInitialAnimation:s?s.initial===!1:!1,reducedMotionConfig:k}));const F=O.current,q=W.useContext(z5);F&&!F.projection&&u&&(F.type==="html"||F.type==="svg")&&jK(O.current,r,u,q),W.useInsertionEffect(()=>{F&&F.update(r,s)});const H=r[x5],J=W.useRef(!!H&&!window.MotionHandoffIsComplete&&((m=window.MotionHasOptimisedAnimation)===null||m===void 0?void 0:m.call(window,H)));return NK(()=>{F&&(F.updateFeatures(),NM.render(F.render),J.current&&F.animationState&&F.animationState.animateChanges())}),W.useEffect(()=>{F&&(!J.current&&F.animationState&&F.animationState.animateChanges(),J.current=!1,iO||(iO=!0,queueMicrotask(OK)))}),F}function OK(){window.MotionHandoffIsComplete=!0}function jK(e,t,r,o){const{layoutId:u,layout:m,drag:_,dragConstraints:b,layoutScroll:s,layoutRoot:k}=t;e.projection=new r(e.latestValues,t["data-framer-portal-id"]?void 0:K5(e.parent)),e.projection.setOptions({layoutId:u,layout:m,alwaysMeasureLayout:!!_||b&&Np(b),visualElement:e,animationType:typeof m=="string"?m:"both",initialPromotionConfig:o,layoutScroll:s,layoutRoot:k})}function K5(e){if(e)return e.options.allowProjection!==!1?e.projection:K5(e.parent)}function zK(e,t,r){return W.useCallback(o=>{o&&e.mount&&e.mount(o),t&&(o?t.mount(o):t.unmount()),r&&(typeof r=="function"?r(o):Np(r)&&(r.current=o))},[t])}function Mb(e){return C_(e.animate)||gM.some(t=>P_(e[t]))}function J5(e){return!!(Mb(e)||e.variants)}function FK(e,t){if(Mb(e)){const{initial:r,animate:o}=e;return{initial:r===!1||P_(r)?r:void 0,animate:P_(o)?o:void 0}}return e.inherit!==!1?t:{}}function BK(e){const{initial:t,animate:r}=FK(e,W.useContext(Pb));return W.useMemo(()=>({initial:t,animate:r}),[sO(t),sO(r)])}function sO(e){return Array.isArray(e)?e.join(" "):e}const oO={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},im={};for(const e in oO)im[e]={isEnabled:t=>oO[e].some(r=>!!t[r])};function VK(e){for(const t in e)im[t]={...im[t],...e[t]}}const UK=Symbol.for("motionComponentSymbol");function $K({preloadedFeatures:e,createVisualElement:t,useRender:r,useVisualState:o,Component:u}){e&&VK(e);function m(b,s){let k;const O={...W.useContext(X5),...b,layoutId:GK(b)},{isStatic:F}=O,q=BK(b),H=o(b,F);if(!F&&LM){WK();const J=HK(O);k=J.MeasureLayout,q.visualElement=LK(u,H,O,t,J.ProjectionNode)}return S.jsxs(Pb.Provider,{value:q,children:[k&&q.visualElement?S.jsx(k,{visualElement:q.visualElement,...O}):null,r(u,b,zK(H,q.visualElement,s),H,F,q.visualElement)]})}const _=W.forwardRef(m);return _[UK]=u,_}function GK({layoutId:e}){const t=W.useContext(j5).id;return t&&e!==void 0?t+"-"+e:e}function WK(e,t){W.useContext(Y5).strict}function HK(e){const{drag:t,layout:r}=im;if(!t&&!r)return{};const o={...t,...r};return{MeasureLayout:t!=null&&t.isEnabled(e)||r!=null&&r.isEnabled(e)?o.MeasureLayout:void 0,ProjectionNode:o.ProjectionNode}}const qK=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function OM(e){return typeof e!="string"||e.includes("-")?!1:!!(qK.indexOf(e)>-1||/[A-Z]/u.test(e))}function Q5(e,{style:t,vars:r},o,u){Object.assign(e.style,t,u&&u.getProjectionStyles(o));for(const m in r)e.style.setProperty(m,r[m])}const eF=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function tF(e,t,r,o){Q5(e,t,void 0,o);for(const u in t.attrs)e.setAttribute(eF.has(u)?u:Eb(u),t.attrs[u])}function nF(e,{layout:t,layoutId:r}){return ld.has(e)||e.startsWith("origin")||(t||r!==void 0)&&(!!z1[e]||e==="opacity")}function jM(e,t,r){var o;const{style:u}=e,m={};for(const _ in u)(xs(u[_])||t.style&&xs(t.style[_])||nF(_,e)||((o=r==null?void 0:r.getValue(_))===null||o===void 0?void 0:o.liveStyle)!==void 0)&&(m[_]=u[_]);return r&&u&&typeof u.willChange=="string"&&(r.applyWillChange=!1),m}function rF(e,t,r){const o=jM(e,t,r);for(const u in e)if(xs(e[u])||xs(t[u])){const m=H_.indexOf(u)!==-1?"attr"+u.charAt(0).toUpperCase()+u.substring(1):u;o[m]=e[u]}return o}function ZK(e){const t=W.useRef(null);return t.current===null&&(t.current=e()),t.current}function XK({applyWillChange:e=!1,scrapeMotionValuesFromProps:t,createRenderState:r,onMount:o},u,m,_,b){const s={latestValues:KK(u,m,_,b?!1:e,t),renderState:r()};return o&&(s.mount=k=>o(u,k,s)),s}const iF=e=>(t,r)=>{const o=W.useContext(Pb),u=W.useContext(kM),m=()=>XK(e,t,o,u,r);return r?m():ZK(m)};function YK(e,t){const r=b5(t);r&&Y_(e,r)}function aO(e,t,r){const o=Array.isArray(t)?t:[t];for(let u=0;u<o.length;u++){const m=pM(e,o[u]);if(m){const{transitionEnd:_,transition:b,...s}=m;r(s,_)}}}function KK(e,t,r,o,u){var m;const _={},b=[],s=o&&((m=e.style)===null||m===void 0?void 0:m.willChange)===void 0,k=u(e,{});for(const te in k)_[te]=qv(k[te]);let{initial:O,animate:F}=e;const q=Mb(e),H=J5(e);t&&H&&!q&&e.inherit!==!1&&(O===void 0&&(O=t.initial),F===void 0&&(F=t.animate));let J=r?r.initial===!1:!1;J=J||O===!1;const U=J?F:O;return U&&typeof U!="boolean"&&!C_(U)&&aO(e,U,(te,Q)=>{for(const ee in te){let re=te[ee];if(Array.isArray(re)){const xe=J?re.length-1:0;re=re[xe]}re!==null&&(_[ee]=re)}for(const ee in Q)_[ee]=Q[ee]}),s&&(F&&O!==!1&&!C_(F)&&aO(e,F,te=>{for(const Q in te)YK(b,Q)}),b.length&&(_.willChange=b.join(","))),_}const zM=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),sF=()=>({...zM(),attrs:{}}),oF=(e,t)=>t&&typeof e=="number"?t.transform(e):e,JK={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},QK=H_.length;function eJ(e,t,r){let o="",u=!0;for(let m=0;m<QK;m++){const _=H_[m],b=e[_];if(b===void 0)continue;let s=!0;if(typeof b=="number"?s=b===(_.startsWith("scale")?1:0):s=parseFloat(b)===0,!s||r){const k=oF(b,wM[_]);if(!s){u=!1;const O=JK[_]||_;o+=`${O}(${k}) `}r&&(t[_]=k)}}return o=o.trim(),r?o=r(t,u?"":o):u&&(o="none"),o}function FM(e,t,r){const{style:o,vars:u,transformOrigin:m}=e;let _=!1,b=!1;for(const s in t){const k=t[s];if(ld.has(s)){_=!0;continue}else if(U2(s)){u[s]=k;continue}else{const O=oF(k,wM[s]);s.startsWith("origin")?(b=!0,m[s]=O):o[s]=O}}if(t.transform||(_||r?o.transform=eJ(t,e.transform,r):o.transform&&(o.transform="none")),b){const{originX:s="50%",originY:k="50%",originZ:O=0}=m;o.transformOrigin=`${s} ${k} ${O}`}}function lO(e,t,r){return typeof e=="string"?e:An.transform(t+r*e)}function tJ(e,t,r){const o=lO(t,e.x,e.width),u=lO(r,e.y,e.height);return`${o} ${u}`}const nJ={offset:"stroke-dashoffset",array:"stroke-dasharray"},rJ={offset:"strokeDashoffset",array:"strokeDasharray"};function iJ(e,t,r=1,o=0,u=!0){e.pathLength=1;const m=u?nJ:rJ;e[m.offset]=An.transform(-o);const _=An.transform(t),b=An.transform(r);e[m.array]=`${_} ${b}`}function BM(e,{attrX:t,attrY:r,attrScale:o,originX:u,originY:m,pathLength:_,pathSpacing:b=1,pathOffset:s=0,...k},O,F){if(FM(e,k,F),O){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:q,style:H,dimensions:J}=e;q.transform&&(J&&(H.transform=q.transform),delete q.transform),J&&(u!==void 0||m!==void 0||H.transform)&&(H.transformOrigin=tJ(J,u!==void 0?u:.5,m!==void 0?m:.5)),t!==void 0&&(q.x=t),r!==void 0&&(q.y=r),o!==void 0&&(q.scale=o),_!==void 0&&iJ(q,_,b,s,!1)}const VM=e=>typeof e=="string"&&e.toLowerCase()==="svg",sJ={useVisualState:iF({scrapeMotionValuesFromProps:rF,createRenderState:sF,onMount:(e,t,{renderState:r,latestValues:o})=>{Ir.read(()=>{try{r.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{r.dimensions={x:0,y:0,width:0,height:0}}}),Ir.render(()=>{BM(r,o,VM(t.tagName),e.transformTemplate),tF(t,r)})}})},oJ={useVisualState:iF({applyWillChange:!0,scrapeMotionValuesFromProps:jM,createRenderState:zM})};function aF(e,t,r){for(const o in t)!xs(t[o])&&!nF(o,r)&&(e[o]=t[o])}function aJ({transformTemplate:e},t){return W.useMemo(()=>{const r=zM();return FM(r,t,e),Object.assign({},r.vars,r.style)},[t])}function lJ(e,t){const r=e.style||{},o={};return aF(o,r,e),Object.assign(o,aJ(e,t)),o}function cJ(e,t){const r={},o=lJ(e,t);return e.drag&&e.dragListener!==!1&&(r.draggable=!1,o.userSelect=o.WebkitUserSelect=o.WebkitTouchCallout="none",o.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(r.tabIndex=0),r.style=o,r}const uJ=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function F1(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||uJ.has(e)}let lF=e=>!F1(e);function dJ(e){e&&(lF=t=>t.startsWith("on")?!F1(t):e(t))}try{dJ(require("@emotion/is-prop-valid").default)}catch{}function hJ(e,t,r){const o={};for(const u in e)u==="values"&&typeof e.values=="object"||(lF(u)||r===!0&&F1(u)||!t&&!F1(u)||e.draggable&&u.startsWith("onDrag"))&&(o[u]=e[u]);return o}function fJ(e,t,r,o){const u=W.useMemo(()=>{const m=sF();return BM(m,t,VM(o),e.transformTemplate),{...m.attrs,style:{...m.style}}},[t]);if(e.style){const m={};aF(m,e.style,e),u.style={...m,...u.style}}return u}function pJ(e=!1){return(r,o,u,{latestValues:m},_)=>{const s=(OM(r)?fJ:cJ)(o,m,_,r),k=hJ(o,typeof r=="string",e),O=r!==W.Fragment?{...k,...s,ref:u}:{},{children:F}=o,q=W.useMemo(()=>xs(F)?F.get():F,[F]);return W.createElement(r,{...O,children:q})}}function mJ(e,t){return function(o,{forwardMotionProps:u}={forwardMotionProps:!1}){const _={...OM(o)?sJ:oJ,preloadedFeatures:e,useRender:pJ(u),createVisualElement:t,Component:o};return $K(_)}}const NC={current:null},cF={current:!1};function gJ(){if(cF.current=!0,!!LM)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>NC.current=e.matches;e.addListener(t),t()}else NC.current=!1}function yJ(e,t,r){for(const o in t){const u=t[o],m=r[o];if(xs(u))e.addValue(o,u);else if(xs(m))e.addValue(o,I_(u,{owner:e}));else if(m!==u)if(e.hasValue(o)){const _=e.getValue(o);_.liveStyle===!0?_.jump(u):_.hasAnimated||_.set(u)}else{const _=e.getStaticValue(o);e.addValue(o,I_(_!==void 0?_:u,{owner:e}))}}for(const o in r)t[o]===void 0&&e.removeValue(o);return t}const cO=new WeakMap,_J=[...W2,gs,Wu],xJ=e=>_J.find(G2(e)),uO=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class vJ{scrapeMotionValuesFromProps(t,r,o){return{}}constructor({parent:t,props:r,presenceContext:o,reducedMotionConfig:u,blockInitialAnimation:m,visualState:_},b={}){this.applyWillChange=!1,this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=vM,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const q=ml.now();this.renderScheduledAt<q&&(this.renderScheduledAt=q,Ir.render(this.render,!1,!0))};const{latestValues:s,renderState:k}=_;this.latestValues=s,this.baseTarget={...s},this.initialValues=r.initial?{...s}:{},this.renderState=k,this.parent=t,this.props=r,this.presenceContext=o,this.depth=t?t.depth+1:0,this.reducedMotionConfig=u,this.options=b,this.blockInitialAnimation=!!m,this.isControllingVariants=Mb(r),this.isVariantNode=J5(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:O,...F}=this.scrapeMotionValuesFromProps(r,{},this);for(const q in F){const H=F[q];s[q]!==void 0&&xs(H)&&H.set(s[q],!1)}}mount(t){this.current=t,cO.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,o)=>this.bindToMotionValue(o,r)),cF.current||gJ(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:NC.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){cO.delete(this.current),this.projection&&this.projection.unmount(),cc(this.notifyUpdate),cc(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const r=this.features[t];r&&(r.unmount(),r.isMounted=!1)}this.current=null}bindToMotionValue(t,r){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const o=ld.has(t),u=r.on("change",b=>{this.latestValues[t]=b,this.props.onUpdate&&Ir.preRender(this.notifyUpdate),o&&this.projection&&(this.projection.isTransformDirty=!0)}),m=r.on("renderRequest",this.scheduleRender);let _;window.MotionCheckAppearSync&&(_=window.MotionCheckAppearSync(this,t,r)),this.valueSubscriptions.set(t,()=>{u(),m(),_&&_(),r.owner&&r.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in im){const r=im[t];if(!r)continue;const{isEnabled:o,Feature:u}=r;if(!this.features[t]&&u&&o(this.props)&&(this.features[t]=new u(this)),this.features[t]){const m=this.features[t];m.isMounted?m.update():(m.mount(),m.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Si()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,r){this.latestValues[t]=r}update(t,r){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let o=0;o<uO.length;o++){const u=uO[o];this.propEventSubscriptions[u]&&(this.propEventSubscriptions[u](),delete this.propEventSubscriptions[u]);const m="on"+u,_=t[m];_&&(this.propEventSubscriptions[u]=this.on(u,_))}this.prevMotionValues=yJ(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(t),()=>r.variantChildren.delete(t)}addValue(t,r){const o=this.values.get(t);r!==o&&(o&&this.removeValue(t),this.bindToMotionValue(t,r),this.values.set(t,r),this.latestValues[t]=r.get())}removeValue(t){this.values.delete(t);const r=this.valueSubscriptions.get(t);r&&(r(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,r){if(this.props.values&&this.props.values[t])return this.props.values[t];let o=this.values.get(t);return o===void 0&&r!==void 0&&(o=I_(r===null?void 0:r,{owner:this}),this.addValue(t,o)),o}readValue(t,r){var o;let u=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(o=this.getBaseTargetFromProps(this.props,t))!==null&&o!==void 0?o:this.readValueFromInstance(this.current,t,this.options);return u!=null&&(typeof u=="string"&&(B2(u)||F2(u))?u=parseFloat(u):!xJ(u)&&Wu.test(r)&&(u=Q2(t,r)),this.setBaseTarget(t,xs(u)?u.get():u)),xs(u)?u.get():u}setBaseTarget(t,r){this.baseTarget[t]=r}getBaseTarget(t){var r;const{initial:o}=this.props;let u;if(typeof o=="string"||typeof o=="object"){const _=pM(this.props,o,(r=this.presenceContext)===null||r===void 0?void 0:r.custom);_&&(u=_[t])}if(o&&u!==void 0)return u;const m=this.getBaseTargetFromProps(this.props,t);return m!==void 0&&!xs(m)?m:this.initialValues[t]!==void 0&&u===void 0?void 0:this.baseTarget[t]}on(t,r){return this.events[t]||(this.events[t]=new RM),this.events[t].add(r)}notify(t,...r){this.events[t]&&this.events[t].notify(...r)}}class uF extends vJ{constructor(){super(...arguments),this.KeyframeResolver=e5}sortInstanceNodePosition(t,r){return t.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(t,r){return t.style?t.style[r]:void 0}removeValueFromRenderState(t,{vars:r,style:o}){delete r[t],delete o[t]}}function bJ(e){return window.getComputedStyle(e)}class wJ extends uF{constructor(){super(...arguments),this.type="html",this.applyWillChange=!0,this.renderInstance=Q5}readValueFromInstance(t,r){if(ld.has(r)){const o=SM(r);return o&&o.default||0}else{const o=bJ(t),u=(U2(r)?o.getPropertyValue(r):o[r])||0;return typeof u=="string"?u.trim():u}}measureInstanceViewportBox(t,{transformPagePoint:r}){return L5(t,r)}build(t,r,o){FM(t,r,o.transformTemplate)}scrapeMotionValuesFromProps(t,r,o){return jM(t,r,o)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;xs(t)&&(this.childSubscription=t.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}}class SJ extends uF{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Si}getBaseTargetFromProps(t,r){return t[r]}readValueFromInstance(t,r){if(ld.has(r)){const o=SM(r);return o&&o.default||0}return r=eF.has(r)?r:Eb(r),t.getAttribute(r)}scrapeMotionValuesFromProps(t,r,o){return rF(t,r,o)}build(t,r,o){BM(t,r,this.isSVGTag,o.transformTemplate)}renderInstance(t,r,o,u){tF(t,r,o,u)}mount(t){this.isSVGTag=VM(t.tagName),super.mount(t)}}const TJ=(e,t)=>OM(e)?new SJ(t):new wJ(t,{allowProjection:e!==W.Fragment}),EJ=mJ({...uY,...RK,...bK,...kK},TJ),dO=iZ(EJ),hO={initial:{opacity:0,transition:{duration:1}},animate:{opacity:1,transition:{duration:1}}},CJ=["/images/slide01.jpg","/images/slide02.jpeg","/images/slide03.jpg","/images/slide04.jpeg"],PJ=[{title:"Sigiriya",description:"Sigiriya is a fifth-century fortress in Sri Lanka which has been carved out of an inselberg, a hill of hard volcanic rock. It towers around 600 feet (182.8m) from the forest and gardens below, and has a flat top. This is where the palace of King Kasyapa once stood, reachable up a winding stone staircase."},{title:"Ruwanwelisaya",description:"Ruwanwelisaya, also known as the Maha Thupa or the Great Stupa, is a stupa in Anuradhapura, Sri Lanka that was built in 140 BC by King Dutugemunu. It is considered the oldest stupa in Sri Lanka and one of the largest structures in the ancient world."},{title:"St Clair's Waterfall",description:"St Clair's Waterfall, also called “St. Clair's Falls, is an incredible waterfall in the Thalawakele area of Sri Lanka. It is considered one of the widest waterfalls on the island. Some call this the “Little Niagara of Sri Lanka."},{title:"Nine Arches Bridge",description:"The Nine Arch Bridge also called the Bridge in the Sky, is a viaduct bridge in Sri Lanka and one of the best examples of colonial-era railway construction in the country."}],MJ=()=>{const[e,t]=W.useState(0);return W.useEffect(()=>{const r=setInterval(()=>{t(o=>o===3?0:o+1)},1e4);return()=>clearInterval(r)},[]),S.jsxs("div",{className:"relative h-screen min-h-[35rem]",children:[CJ.map((r,o)=>S.jsx(dO.img,{src:r,alt:"hero",className:"absolute left-0 top-0 z-0 h-full w-full object-cover",initial:"initial",animate:e===o?"animate":"initial",variants:hO},o)),S.jsx("div",{className:"absolute start-0 top-0 z-[1] h-full w-full bg-black/50"}),S.jsx("div",{className:"absolute start-0 top-0 z-[2] flex h-full w-full flex-col items-center justify-center text-center text-white",children:PJ.map((r,o)=>S.jsxs(dO.div,{initial:"initial",animate:e===o?"animate":"initial",variants:hO,className:"absolute max-w-2xl",children:[S.jsxs("h2",{className:"font-serif text-2xl font-medium uppercase tracking-widest md:text-3xl",children:["“",r.title,"”"]}),S.jsx("p",{className:"mb-8 mt-2 text-sm md:text-base",children:r.description}),S.jsx(ui,{to:"get-start",className:"rounded-md border-2 border-white bg-transparent px-4 py-2 text-white duration-300 hover:bg-white hover:text-black",children:"Plan Your Next Holiday"})]},o))})]})},AJ=()=>S.jsxs("div",{children:[S.jsx(ko,{}),S.jsx(MJ,{}),S.jsx(Ro,{})]}),IJ=()=>S.jsxs("section",{className:"flex h-full min-h-screen flex-col",children:[S.jsx(ko,{}),S.jsx("div",{className:"mt-24 flex flex-grow flex-col"}),S.jsxs("div",{className:"flex min-h-96 flex-col items-center justify-center",children:[S.jsx("h1",{className:"text-center text-4xl font-bold text-gray-800",children:"404 - Page Not Found"}),S.jsx(ui,{to:"/",className:"mt-4 rounded-md bg-sky-600 px-3 py-2 text-sky-100 hover:bg-sky-700",children:"Go back to home"})]}),S.jsx("div",{className:"flex flex-grow flex-col"}),S.jsx(Ro,{})]});function DJ(e){return Kr({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M400 145.49 366.51 112 256 222.51 145.49 112 112 145.49 222.51 256 112 366.51 145.49 400 256 289.49 366.51 400 400 366.51 289.49 256 400 145.49z"},child:[]}]})(e)}function uc(e){return Kr({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 32C167.67 32 96 96.51 96 176c0 128 160 304 160 304s160-176 160-304c0-79.49-71.67-144-160-144zm0 224a64 64 0 1 1 64-64 64.07 64.07 0 0 1-64 64z"},child:[]}]})(e)}function Ab(e){return Kr({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"circle",attr:{cx:"256",cy:"256",r:"48"},child:[]},{tag:"path",attr:{d:"m470.39 300-.47-.38-31.56-24.75a16.11 16.11 0 0 1-6.1-13.33v-11.56a16 16 0 0 1 6.11-13.22L469.92 212l.47-.38a26.68 26.68 0 0 0 5.9-34.06l-42.71-73.9a1.59 1.59 0 0 1-.13-.22A26.86 26.86 0 0 0 401 92.14l-.35.13-37.1 14.93a15.94 15.94 0 0 1-14.47-1.29q-4.92-3.1-10-5.86a15.94 15.94 0 0 1-8.19-11.82l-5.59-39.59-.12-.72A27.22 27.22 0 0 0 298.76 26h-85.52a26.92 26.92 0 0 0-26.45 22.39l-.09.56-5.57 39.67a16 16 0 0 1-8.13 11.82 175.21 175.21 0 0 0-10 5.82 15.92 15.92 0 0 1-14.43 1.27l-37.13-15-.35-.14a26.87 26.87 0 0 0-32.48 11.34l-.13.22-42.77 73.95a26.71 26.71 0 0 0 5.9 34.1l.47.38 31.56 24.75a16.11 16.11 0 0 1 6.1 13.33v11.56a16 16 0 0 1-6.11 13.22L42.08 300l-.47.38a26.68 26.68 0 0 0-5.9 34.06l42.71 73.9a1.59 1.59 0 0 1 .13.22 26.86 26.86 0 0 0 32.45 11.3l.35-.13 37.07-14.93a15.94 15.94 0 0 1 14.47 1.29q4.92 3.11 10 5.86a15.94 15.94 0 0 1 8.19 11.82l5.56 39.59.12.72A27.22 27.22 0 0 0 213.24 486h85.52a26.92 26.92 0 0 0 26.45-22.39l.09-.56 5.57-39.67a16 16 0 0 1 8.18-11.82c3.42-1.84 6.76-3.79 10-5.82a15.92 15.92 0 0 1 14.43-1.27l37.13 14.95.35.14a26.85 26.85 0 0 0 32.48-11.34 2.53 2.53 0 0 1 .13-.22l42.71-73.89a26.7 26.7 0 0 0-5.89-34.11zm-134.48-40.24a80 80 0 1 1-83.66-83.67 80.21 80.21 0 0 1 83.66 83.67z"},child:[]}]})(e)}function In(e,t,{checkForDefaultPrevented:r=!0}={}){return function(u){if(e==null||e(u),r===!1||!u.defaultPrevented)return t==null?void 0:t(u)}}function RJ(e,t=[]){let r=[];function o(m,_){const b=W.createContext(_),s=r.length;r=[...r,_];function k(F){const{scope:q,children:H,...J}=F,U=(q==null?void 0:q[e][s])||b,te=W.useMemo(()=>J,Object.values(J));return S.jsx(U.Provider,{value:te,children:H})}function O(F,q){const H=(q==null?void 0:q[e][s])||b,J=W.useContext(H);if(J)return J;if(_!==void 0)return _;throw new Error(`\`${F}\` must be used within \`${m}\``)}return k.displayName=m+"Provider",[k,O]}const u=()=>{const m=r.map(_=>W.createContext(_));return function(b){const s=(b==null?void 0:b[e])||m;return W.useMemo(()=>({[`__scope${e}`]:{...b,[e]:s}}),[b,s])}};return u.scopeName=e,[o,kJ(u,...t)]}function kJ(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const o=e.map(u=>({useScope:u(),scopeName:u.scopeName}));return function(m){const _=o.reduce((b,{useScope:s,scopeName:k})=>{const F=s(m)[`__scope${k}`];return{...b,...F}},{});return W.useMemo(()=>({[`__scope${t.scopeName}`]:_}),[_])}};return r.scopeName=t.scopeName,r}function NJ(e,t=[]){let r=[];function o(m,_){const b=W.createContext(_),s=r.length;r=[...r,_];function k(F){const{scope:q,children:H,...J}=F,U=(q==null?void 0:q[e][s])||b,te=W.useMemo(()=>J,Object.values(J));return S.jsx(U.Provider,{value:te,children:H})}function O(F,q){const H=(q==null?void 0:q[e][s])||b,J=W.useContext(H);if(J)return J;if(_!==void 0)return _;throw new Error(`\`${F}\` must be used within \`${m}\``)}return k.displayName=m+"Provider",[k,O]}const u=()=>{const m=r.map(_=>W.createContext(_));return function(b){const s=(b==null?void 0:b[e])||m;return W.useMemo(()=>({[`__scope${e}`]:{...b,[e]:s}}),[b,s])}};return u.scopeName=e,[o,LJ(u,...t)]}function LJ(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const o=e.map(u=>({useScope:u(),scopeName:u.scopeName}));return function(m){const _=o.reduce((b,{useScope:s,scopeName:k})=>{const F=s(m)[`__scope${k}`];return{...b,...F}},{});return W.useMemo(()=>({[`__scope${t.scopeName}`]:_}),[_])}};return r.scopeName=t.scopeName,r}function OJ(e,t){typeof e=="function"?e(t):e!=null&&(e.current=t)}function dF(...e){return t=>e.forEach(r=>OJ(r,t))}function gr(...e){return W.useCallback(dF(...e),e)}var dc=W.forwardRef((e,t)=>{const{children:r,...o}=e,u=W.Children.toArray(r),m=u.find(jJ);if(m){const _=m.props.children,b=u.map(s=>s===m?W.Children.count(_)>1?W.Children.only(null):W.isValidElement(_)?_.props.children:null:s);return S.jsx(LC,{...o,ref:t,children:W.isValidElement(_)?W.cloneElement(_,void 0,b):null})}return S.jsx(LC,{...o,ref:t,children:r})});dc.displayName="Slot";var LC=W.forwardRef((e,t)=>{const{children:r,...o}=e;if(W.isValidElement(r)){const u=FJ(r);return W.cloneElement(r,{...zJ(o,r.props),ref:t?dF(t,u):u})}return W.Children.count(r)>1?W.Children.only(null):null});LC.displayName="SlotClone";var hF=({children:e})=>S.jsx(S.Fragment,{children:e});function jJ(e){return W.isValidElement(e)&&e.type===hF}function zJ(e,t){const r={...t};for(const o in t){const u=e[o],m=t[o];/^on[A-Z]/.test(o)?u&&m?r[o]=(...b)=>{m(...b),u(...b)}:u&&(r[o]=u):o==="style"?r[o]={...u,...m}:o==="className"&&(r[o]=[u,m].filter(Boolean).join(" "))}return{...e,...r}}function FJ(e){var o,u;let t=(o=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:o.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(u=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:u.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}function fF(e){const t=e+"CollectionProvider",[r,o]=NJ(t),[u,m]=r(t,{collectionRef:{current:null},itemMap:new Map}),_=H=>{const{scope:J,children:U}=H,te=Gn.useRef(null),Q=Gn.useRef(new Map).current;return S.jsx(u,{scope:J,itemMap:Q,collectionRef:te,children:U})};_.displayName=t;const b=e+"CollectionSlot",s=Gn.forwardRef((H,J)=>{const{scope:U,children:te}=H,Q=m(b,U),ee=gr(J,Q.collectionRef);return S.jsx(dc,{ref:ee,children:te})});s.displayName=b;const k=e+"CollectionItemSlot",O="data-radix-collection-item",F=Gn.forwardRef((H,J)=>{const{scope:U,children:te,...Q}=H,ee=Gn.useRef(null),re=gr(J,ee),xe=m(k,U);return Gn.useEffect(()=>(xe.itemMap.set(ee,{ref:ee,...Q}),()=>void xe.itemMap.delete(ee))),S.jsx(dc,{[O]:"",ref:re,children:te})});F.displayName=k;function q(H){const J=m(e+"CollectionConsumer",H);return Gn.useCallback(()=>{const te=J.collectionRef.current;if(!te)return[];const Q=Array.from(te.querySelectorAll(`[${O}]`));return Array.from(J.itemMap.values()).sort((xe,Ee)=>Q.indexOf(xe.ref.current)-Q.indexOf(Ee.ref.current))},[J.collectionRef,J.itemMap])}return[{Provider:_,Slot:s,ItemSlot:F},q,o]}function BJ(e,t=[]){let r=[];function o(m,_){const b=W.createContext(_),s=r.length;r=[...r,_];function k(F){const{scope:q,children:H,...J}=F,U=(q==null?void 0:q[e][s])||b,te=W.useMemo(()=>J,Object.values(J));return S.jsx(U.Provider,{value:te,children:H})}function O(F,q){const H=(q==null?void 0:q[e][s])||b,J=W.useContext(H);if(J)return J;if(_!==void 0)return _;throw new Error(`\`${F}\` must be used within \`${m}\``)}return k.displayName=m+"Provider",[k,O]}const u=()=>{const m=r.map(_=>W.createContext(_));return function(b){const s=(b==null?void 0:b[e])||m;return W.useMemo(()=>({[`__scope${e}`]:{...b,[e]:s}}),[b,s])}};return u.scopeName=e,[o,VJ(u,...t)]}function VJ(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const o=e.map(u=>({useScope:u(),scopeName:u.scopeName}));return function(m){const _=o.reduce((b,{useScope:s,scopeName:k})=>{const F=s(m)[`__scope${k}`];return{...b,...F}},{});return W.useMemo(()=>({[`__scope${t.scopeName}`]:_}),[_])}};return r.scopeName=t.scopeName,r}var Ii=globalThis!=null&&globalThis.document?W.useLayoutEffect:()=>{},UJ=Jv.useId||(()=>{}),$J=0;function To(e){const[t,r]=W.useState(UJ());return Ii(()=>{e||r(o=>o??String($J++))},[e]),e||(t?`radix-${t}`:"")}var GJ=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],jn=GJ.reduce((e,t)=>{const r=W.forwardRef((o,u)=>{const{asChild:m,..._}=o,b=m?dc:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),S.jsx(b,{..._,ref:u})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});function pF(e,t){e&&Hh.flushSync(()=>e.dispatchEvent(t))}function ra(e){const t=W.useRef(e);return W.useEffect(()=>{t.current=e}),W.useMemo(()=>(...r)=>{var o;return(o=t.current)==null?void 0:o.call(t,...r)},[])}function hc({prop:e,defaultProp:t,onChange:r=()=>{}}){const[o,u]=WJ({defaultProp:t,onChange:r}),m=e!==void 0,_=m?e:o,b=ra(r),s=W.useCallback(k=>{if(m){const F=typeof k=="function"?k(e):k;F!==e&&b(F)}else u(k)},[m,e,u,b]);return[_,s]}function WJ({defaultProp:e,onChange:t}){const r=W.useState(e),[o]=r,u=W.useRef(o),m=ra(t);return W.useEffect(()=>{u.current!==o&&(m(o),u.current=o)},[o,u,m]),r}var HJ=W.createContext(void 0);function UM(e){const t=W.useContext(HJ);return e||t||"ltr"}var jT="rovingFocusGroup.onEntryFocus",qJ={bubbles:!1,cancelable:!0},Ib="RovingFocusGroup",[OC,mF,ZJ]=fF(Ib),[XJ,gF]=BJ(Ib,[ZJ]),[YJ,KJ]=XJ(Ib),yF=W.forwardRef((e,t)=>S.jsx(OC.Provider,{scope:e.__scopeRovingFocusGroup,children:S.jsx(OC.Slot,{scope:e.__scopeRovingFocusGroup,children:S.jsx(JJ,{...e,ref:t})})}));yF.displayName=Ib;var JJ=W.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,orientation:o,loop:u=!1,dir:m,currentTabStopId:_,defaultCurrentTabStopId:b,onCurrentTabStopIdChange:s,onEntryFocus:k,preventScrollOnEntryFocus:O=!1,...F}=e,q=W.useRef(null),H=gr(t,q),J=UM(m),[U=null,te]=hc({prop:_,defaultProp:b,onChange:s}),[Q,ee]=W.useState(!1),re=ra(k),xe=mF(r),Ee=W.useRef(!1),[He,qe]=W.useState(0);return W.useEffect(()=>{const Ne=q.current;if(Ne)return Ne.addEventListener(jT,re),()=>Ne.removeEventListener(jT,re)},[re]),S.jsx(YJ,{scope:r,orientation:o,dir:J,loop:u,currentTabStopId:U,onItemFocus:W.useCallback(Ne=>te(Ne),[te]),onItemShiftTab:W.useCallback(()=>ee(!0),[]),onFocusableItemAdd:W.useCallback(()=>qe(Ne=>Ne+1),[]),onFocusableItemRemove:W.useCallback(()=>qe(Ne=>Ne-1),[]),children:S.jsx(jn.div,{tabIndex:Q||He===0?-1:0,"data-orientation":o,...F,ref:H,style:{outline:"none",...e.style},onMouseDown:In(e.onMouseDown,()=>{Ee.current=!0}),onFocus:In(e.onFocus,Ne=>{const ft=!Ee.current;if(Ne.target===Ne.currentTarget&&ft&&!Q){const ut=new CustomEvent(jT,qJ);if(Ne.currentTarget.dispatchEvent(ut),!ut.defaultPrevented){const mt=xe().filter(It=>It.focusable),pt=mt.find(It=>It.active),en=mt.find(It=>It.id===U),dn=[pt,en,...mt].filter(Boolean).map(It=>It.ref.current);vF(dn,O)}}Ee.current=!1}),onBlur:In(e.onBlur,()=>ee(!1))})})}),_F="RovingFocusGroupItem",xF=W.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,focusable:o=!0,active:u=!1,tabStopId:m,..._}=e,b=To(),s=m||b,k=KJ(_F,r),O=k.currentTabStopId===s,F=mF(r),{onFocusableItemAdd:q,onFocusableItemRemove:H}=k;return W.useEffect(()=>{if(o)return q(),()=>H()},[o,q,H]),S.jsx(OC.ItemSlot,{scope:r,id:s,focusable:o,active:u,children:S.jsx(jn.span,{tabIndex:O?0:-1,"data-orientation":k.orientation,..._,ref:t,onMouseDown:In(e.onMouseDown,J=>{o?k.onItemFocus(s):J.preventDefault()}),onFocus:In(e.onFocus,()=>k.onItemFocus(s)),onKeyDown:In(e.onKeyDown,J=>{if(J.key==="Tab"&&J.shiftKey){k.onItemShiftTab();return}if(J.target!==J.currentTarget)return;const U=tQ(J,k.orientation,k.dir);if(U!==void 0){if(J.metaKey||J.ctrlKey||J.altKey||J.shiftKey)return;J.preventDefault();let Q=F().filter(ee=>ee.focusable).map(ee=>ee.ref.current);if(U==="last")Q.reverse();else if(U==="prev"||U==="next"){U==="prev"&&Q.reverse();const ee=Q.indexOf(J.currentTarget);Q=k.loop?nQ(Q,ee+1):Q.slice(ee+1)}setTimeout(()=>vF(Q))}})})})});xF.displayName=_F;var QJ={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function eQ(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function tQ(e,t,r){const o=eQ(e.key,r);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(o))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(o)))return QJ[o]}function vF(e,t=!1){const r=document.activeElement;for(const o of e)if(o===r||(o.focus({preventScroll:t}),document.activeElement!==r))return}function nQ(e,t){return e.map((r,o)=>e[(t+o)%e.length])}var rQ=yF,iQ=xF;function sQ(e,t){return W.useReducer((r,o)=>t[r][o]??r,e)}var ud=e=>{const{present:t,children:r}=e,o=oQ(t),u=typeof r=="function"?r({present:o.isPresent}):W.Children.only(r),m=gr(o.ref,aQ(u));return typeof r=="function"||o.isPresent?W.cloneElement(u,{ref:m}):null};ud.displayName="Presence";function oQ(e){const[t,r]=W.useState(),o=W.useRef({}),u=W.useRef(e),m=W.useRef("none"),_=e?"mounted":"unmounted",[b,s]=sQ(_,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return W.useEffect(()=>{const k=mv(o.current);m.current=b==="mounted"?k:"none"},[b]),Ii(()=>{const k=o.current,O=u.current;if(O!==e){const q=m.current,H=mv(k);e?s("MOUNT"):H==="none"||(k==null?void 0:k.display)==="none"?s("UNMOUNT"):s(O&&q!==H?"ANIMATION_OUT":"UNMOUNT"),u.current=e}},[e,s]),Ii(()=>{if(t){const k=F=>{const H=mv(o.current).includes(F.animationName);F.target===t&&H&&Hh.flushSync(()=>s("ANIMATION_END"))},O=F=>{F.target===t&&(m.current=mv(o.current))};return t.addEventListener("animationstart",O),t.addEventListener("animationcancel",k),t.addEventListener("animationend",k),()=>{t.removeEventListener("animationstart",O),t.removeEventListener("animationcancel",k),t.removeEventListener("animationend",k)}}else s("ANIMATION_END")},[t,s]),{isPresent:["mounted","unmountSuspended"].includes(b),ref:W.useCallback(k=>{k&&(o.current=getComputedStyle(k)),r(k)},[])}}function mv(e){return(e==null?void 0:e.animationName)||"none"}function aQ(e){var o,u;let t=(o=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:o.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(u=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:u.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var $M="Tabs",[lQ,sde]=RJ($M,[gF]),bF=gF(),[cQ,GM]=lQ($M),wF=W.forwardRef((e,t)=>{const{__scopeTabs:r,value:o,onValueChange:u,defaultValue:m,orientation:_="horizontal",dir:b,activationMode:s="automatic",...k}=e,O=UM(b),[F,q]=hc({prop:o,onChange:u,defaultProp:m});return S.jsx(cQ,{scope:r,baseId:To(),value:F,onValueChange:q,orientation:_,dir:O,activationMode:s,children:S.jsx(jn.div,{dir:O,"data-orientation":_,...k,ref:t})})});wF.displayName=$M;var SF="TabsList",TF=W.forwardRef((e,t)=>{const{__scopeTabs:r,loop:o=!0,...u}=e,m=GM(SF,r),_=bF(r);return S.jsx(rQ,{asChild:!0,..._,orientation:m.orientation,dir:m.dir,loop:o,children:S.jsx(jn.div,{role:"tablist","aria-orientation":m.orientation,...u,ref:t})})});TF.displayName=SF;var EF="TabsTrigger",CF=W.forwardRef((e,t)=>{const{__scopeTabs:r,value:o,disabled:u=!1,...m}=e,_=GM(EF,r),b=bF(r),s=AF(_.baseId,o),k=IF(_.baseId,o),O=o===_.value;return S.jsx(iQ,{asChild:!0,...b,focusable:!u,active:O,children:S.jsx(jn.button,{type:"button",role:"tab","aria-selected":O,"aria-controls":k,"data-state":O?"active":"inactive","data-disabled":u?"":void 0,disabled:u,id:s,...m,ref:t,onMouseDown:In(e.onMouseDown,F=>{!u&&F.button===0&&F.ctrlKey===!1?_.onValueChange(o):F.preventDefault()}),onKeyDown:In(e.onKeyDown,F=>{[" ","Enter"].includes(F.key)&&_.onValueChange(o)}),onFocus:In(e.onFocus,()=>{const F=_.activationMode!=="manual";!O&&!u&&F&&_.onValueChange(o)})})})});CF.displayName=EF;var PF="TabsContent",MF=W.forwardRef((e,t)=>{const{__scopeTabs:r,value:o,forceMount:u,children:m,..._}=e,b=GM(PF,r),s=AF(b.baseId,o),k=IF(b.baseId,o),O=o===b.value,F=W.useRef(O);return W.useEffect(()=>{const q=requestAnimationFrame(()=>F.current=!1);return()=>cancelAnimationFrame(q)},[]),S.jsx(ud,{present:u||O,children:({present:q})=>S.jsx(jn.div,{"data-state":O?"active":"inactive","data-orientation":b.orientation,role:"tabpanel","aria-labelledby":s,hidden:!q,id:k,tabIndex:0,..._,ref:t,style:{...e.style,animationDuration:F.current?"0s":void 0},children:q&&m})})});MF.displayName=PF;function AF(e,t){return`${e}-trigger-${t}`}function IF(e,t){return`${e}-content-${t}`}var uQ=wF,DF=TF,RF=CF,kF=MF;function NF(e){var t,r,o="";if(typeof e=="string"||typeof e=="number")o+=e;else if(typeof e=="object")if(Array.isArray(e)){var u=e.length;for(t=0;t<u;t++)e[t]&&(r=NF(e[t]))&&(o&&(o+=" "),o+=r)}else for(r in e)e[r]&&(o&&(o+=" "),o+=r);return o}function Jl(){for(var e,t,r=0,o="",u=arguments.length;r<u;r++)(e=arguments[r])&&(t=NF(e))&&(o&&(o+=" "),o+=t);return o}const WM="-",dQ=e=>{const t=fQ(e),{conflictingClassGroups:r,conflictingClassGroupModifiers:o}=e;return{getClassGroupId:_=>{const b=_.split(WM);return b[0]===""&&b.length!==1&&b.shift(),LF(b,t)||hQ(_)},getConflictingClassGroupIds:(_,b)=>{const s=r[_]||[];return b&&o[_]?[...s,...o[_]]:s}}},LF=(e,t)=>{var _;if(e.length===0)return t.classGroupId;const r=e[0],o=t.nextPart.get(r),u=o?LF(e.slice(1),o):void 0;if(u)return u;if(t.validators.length===0)return;const m=e.join(WM);return(_=t.validators.find(({validator:b})=>b(m)))==null?void 0:_.classGroupId},fO=/^\[(.+)\]$/,hQ=e=>{if(fO.test(e)){const t=fO.exec(e)[1],r=t==null?void 0:t.substring(0,t.indexOf(":"));if(r)return"arbitrary.."+r}},fQ=e=>{const{theme:t,prefix:r}=e,o={nextPart:new Map,validators:[]};return mQ(Object.entries(e.classGroups),r).forEach(([m,_])=>{jC(_,o,m,t)}),o},jC=(e,t,r,o)=>{e.forEach(u=>{if(typeof u=="string"){const m=u===""?t:pO(t,u);m.classGroupId=r;return}if(typeof u=="function"){if(pQ(u)){jC(u(o),t,r,o);return}t.validators.push({validator:u,classGroupId:r});return}Object.entries(u).forEach(([m,_])=>{jC(_,pO(t,m),r,o)})})},pO=(e,t)=>{let r=e;return t.split(WM).forEach(o=>{r.nextPart.has(o)||r.nextPart.set(o,{nextPart:new Map,validators:[]}),r=r.nextPart.get(o)}),r},pQ=e=>e.isThemeGetter,mQ=(e,t)=>t?e.map(([r,o])=>{const u=o.map(m=>typeof m=="string"?t+m:typeof m=="object"?Object.fromEntries(Object.entries(m).map(([_,b])=>[t+_,b])):m);return[r,u]}):e,gQ=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,r=new Map,o=new Map;const u=(m,_)=>{r.set(m,_),t++,t>e&&(t=0,o=r,r=new Map)};return{get(m){let _=r.get(m);if(_!==void 0)return _;if((_=o.get(m))!==void 0)return u(m,_),_},set(m,_){r.has(m)?r.set(m,_):u(m,_)}}},OF="!",yQ=e=>{const{separator:t,experimentalParseClassName:r}=e,o=t.length===1,u=t[0],m=t.length,_=b=>{const s=[];let k=0,O=0,F;for(let te=0;te<b.length;te++){let Q=b[te];if(k===0){if(Q===u&&(o||b.slice(te,te+m)===t)){s.push(b.slice(O,te)),O=te+m;continue}if(Q==="/"){F=te;continue}}Q==="["?k++:Q==="]"&&k--}const q=s.length===0?b:b.substring(O),H=q.startsWith(OF),J=H?q.substring(1):q,U=F&&F>O?F-O:void 0;return{modifiers:s,hasImportantModifier:H,baseClassName:J,maybePostfixModifierPosition:U}};return r?b=>r({className:b,parseClassName:_}):_},_Q=e=>{if(e.length<=1)return e;const t=[];let r=[];return e.forEach(o=>{o[0]==="["?(t.push(...r.sort(),o),r=[]):r.push(o)}),t.push(...r.sort()),t},xQ=e=>({cache:gQ(e.cacheSize),parseClassName:yQ(e),...dQ(e)}),vQ=/\s+/,bQ=(e,t)=>{const{parseClassName:r,getClassGroupId:o,getConflictingClassGroupIds:u}=t,m=[],_=e.trim().split(vQ);let b="";for(let s=_.length-1;s>=0;s-=1){const k=_[s],{modifiers:O,hasImportantModifier:F,baseClassName:q,maybePostfixModifierPosition:H}=r(k);let J=!!H,U=o(J?q.substring(0,H):q);if(!U){if(!J){b=k+(b.length>0?" "+b:b);continue}if(U=o(q),!U){b=k+(b.length>0?" "+b:b);continue}J=!1}const te=_Q(O).join(":"),Q=F?te+OF:te,ee=Q+U;if(m.includes(ee))continue;m.push(ee);const re=u(U,J);for(let xe=0;xe<re.length;++xe){const Ee=re[xe];m.push(Q+Ee)}b=k+(b.length>0?" "+b:b)}return b};function wQ(){let e=0,t,r,o="";for(;e<arguments.length;)(t=arguments[e++])&&(r=jF(t))&&(o&&(o+=" "),o+=r);return o}const jF=e=>{if(typeof e=="string")return e;let t,r="";for(let o=0;o<e.length;o++)e[o]&&(t=jF(e[o]))&&(r&&(r+=" "),r+=t);return r};function SQ(e,...t){let r,o,u,m=_;function _(s){const k=t.reduce((O,F)=>F(O),e());return r=xQ(k),o=r.cache.get,u=r.cache.set,m=b,b(s)}function b(s){const k=o(s);if(k)return k;const O=bQ(s,r);return u(s,O),O}return function(){return m(wQ.apply(null,arguments))}}const Zr=e=>{const t=r=>r[e]||[];return t.isThemeGetter=!0,t},zF=/^\[(?:([a-z-]+):)?(.+)\]$/i,TQ=/^\d+\/\d+$/,EQ=new Set(["px","full","screen"]),CQ=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,PQ=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,MQ=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,AQ=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,IQ=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Gl=e=>Gp(e)||EQ.has(e)||TQ.test(e),vu=e=>xm(e,"length",zQ),Gp=e=>!!e&&!Number.isNaN(Number(e)),zT=e=>xm(e,"number",Gp),wy=e=>!!e&&Number.isInteger(Number(e)),DQ=e=>e.endsWith("%")&&Gp(e.slice(0,-1)),Qn=e=>zF.test(e),bu=e=>CQ.test(e),RQ=new Set(["length","size","percentage"]),kQ=e=>xm(e,RQ,FF),NQ=e=>xm(e,"position",FF),LQ=new Set(["image","url"]),OQ=e=>xm(e,LQ,BQ),jQ=e=>xm(e,"",FQ),Sy=()=>!0,xm=(e,t,r)=>{const o=zF.exec(e);return o?o[1]?typeof t=="string"?o[1]===t:t.has(o[1]):r(o[2]):!1},zQ=e=>PQ.test(e)&&!MQ.test(e),FF=()=>!1,FQ=e=>AQ.test(e),BQ=e=>IQ.test(e),VQ=()=>{const e=Zr("colors"),t=Zr("spacing"),r=Zr("blur"),o=Zr("brightness"),u=Zr("borderColor"),m=Zr("borderRadius"),_=Zr("borderSpacing"),b=Zr("borderWidth"),s=Zr("contrast"),k=Zr("grayscale"),O=Zr("hueRotate"),F=Zr("invert"),q=Zr("gap"),H=Zr("gradientColorStops"),J=Zr("gradientColorStopPositions"),U=Zr("inset"),te=Zr("margin"),Q=Zr("opacity"),ee=Zr("padding"),re=Zr("saturate"),xe=Zr("scale"),Ee=Zr("sepia"),He=Zr("skew"),qe=Zr("space"),Ne=Zr("translate"),ft=()=>["auto","contain","none"],ut=()=>["auto","hidden","clip","visible","scroll"],mt=()=>["auto",Qn,t],pt=()=>[Qn,t],en=()=>["",Gl,vu],Yt=()=>["auto",Gp,Qn],dn=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],It=()=>["solid","dashed","dotted","double","none"],Et=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],tt=()=>["start","end","center","between","around","evenly","stretch"],Ft=()=>["","0",Qn],St=()=>["auto","avoid","all","avoid-page","page","left","right","column"],hn=()=>[Gp,Qn];return{cacheSize:500,separator:":",theme:{colors:[Sy],spacing:[Gl,vu],blur:["none","",bu,Qn],brightness:hn(),borderColor:[e],borderRadius:["none","","full",bu,Qn],borderSpacing:pt(),borderWidth:en(),contrast:hn(),grayscale:Ft(),hueRotate:hn(),invert:Ft(),gap:pt(),gradientColorStops:[e],gradientColorStopPositions:[DQ,vu],inset:mt(),margin:mt(),opacity:hn(),padding:pt(),saturate:hn(),scale:hn(),sepia:Ft(),skew:hn(),space:pt(),translate:pt()},classGroups:{aspect:[{aspect:["auto","square","video",Qn]}],container:["container"],columns:[{columns:[bu]}],"break-after":[{"break-after":St()}],"break-before":[{"break-before":St()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...dn(),Qn]}],overflow:[{overflow:ut()}],"overflow-x":[{"overflow-x":ut()}],"overflow-y":[{"overflow-y":ut()}],overscroll:[{overscroll:ft()}],"overscroll-x":[{"overscroll-x":ft()}],"overscroll-y":[{"overscroll-y":ft()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[U]}],"inset-x":[{"inset-x":[U]}],"inset-y":[{"inset-y":[U]}],start:[{start:[U]}],end:[{end:[U]}],top:[{top:[U]}],right:[{right:[U]}],bottom:[{bottom:[U]}],left:[{left:[U]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",wy,Qn]}],basis:[{basis:mt()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Qn]}],grow:[{grow:Ft()}],shrink:[{shrink:Ft()}],order:[{order:["first","last","none",wy,Qn]}],"grid-cols":[{"grid-cols":[Sy]}],"col-start-end":[{col:["auto",{span:["full",wy,Qn]},Qn]}],"col-start":[{"col-start":Yt()}],"col-end":[{"col-end":Yt()}],"grid-rows":[{"grid-rows":[Sy]}],"row-start-end":[{row:["auto",{span:[wy,Qn]},Qn]}],"row-start":[{"row-start":Yt()}],"row-end":[{"row-end":Yt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Qn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Qn]}],gap:[{gap:[q]}],"gap-x":[{"gap-x":[q]}],"gap-y":[{"gap-y":[q]}],"justify-content":[{justify:["normal",...tt()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...tt(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...tt(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[ee]}],px:[{px:[ee]}],py:[{py:[ee]}],ps:[{ps:[ee]}],pe:[{pe:[ee]}],pt:[{pt:[ee]}],pr:[{pr:[ee]}],pb:[{pb:[ee]}],pl:[{pl:[ee]}],m:[{m:[te]}],mx:[{mx:[te]}],my:[{my:[te]}],ms:[{ms:[te]}],me:[{me:[te]}],mt:[{mt:[te]}],mr:[{mr:[te]}],mb:[{mb:[te]}],ml:[{ml:[te]}],"space-x":[{"space-x":[qe]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[qe]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Qn,t]}],"min-w":[{"min-w":[Qn,t,"min","max","fit"]}],"max-w":[{"max-w":[Qn,t,"none","full","min","max","fit","prose",{screen:[bu]},bu]}],h:[{h:[Qn,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Qn,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Qn,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Qn,t,"auto","min","max","fit"]}],"font-size":[{text:["base",bu,vu]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",zT]}],"font-family":[{font:[Sy]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Qn]}],"line-clamp":[{"line-clamp":["none",Gp,zT]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Gl,Qn]}],"list-image":[{"list-image":["none",Qn]}],"list-style-type":[{list:["none","disc","decimal",Qn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[Q]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[Q]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...It(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Gl,vu]}],"underline-offset":[{"underline-offset":["auto",Gl,Qn]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:pt()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Qn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Qn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[Q]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...dn(),NQ]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",kQ]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},OQ]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[J]}],"gradient-via-pos":[{via:[J]}],"gradient-to-pos":[{to:[J]}],"gradient-from":[{from:[H]}],"gradient-via":[{via:[H]}],"gradient-to":[{to:[H]}],rounded:[{rounded:[m]}],"rounded-s":[{"rounded-s":[m]}],"rounded-e":[{"rounded-e":[m]}],"rounded-t":[{"rounded-t":[m]}],"rounded-r":[{"rounded-r":[m]}],"rounded-b":[{"rounded-b":[m]}],"rounded-l":[{"rounded-l":[m]}],"rounded-ss":[{"rounded-ss":[m]}],"rounded-se":[{"rounded-se":[m]}],"rounded-ee":[{"rounded-ee":[m]}],"rounded-es":[{"rounded-es":[m]}],"rounded-tl":[{"rounded-tl":[m]}],"rounded-tr":[{"rounded-tr":[m]}],"rounded-br":[{"rounded-br":[m]}],"rounded-bl":[{"rounded-bl":[m]}],"border-w":[{border:[b]}],"border-w-x":[{"border-x":[b]}],"border-w-y":[{"border-y":[b]}],"border-w-s":[{"border-s":[b]}],"border-w-e":[{"border-e":[b]}],"border-w-t":[{"border-t":[b]}],"border-w-r":[{"border-r":[b]}],"border-w-b":[{"border-b":[b]}],"border-w-l":[{"border-l":[b]}],"border-opacity":[{"border-opacity":[Q]}],"border-style":[{border:[...It(),"hidden"]}],"divide-x":[{"divide-x":[b]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[b]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[Q]}],"divide-style":[{divide:It()}],"border-color":[{border:[u]}],"border-color-x":[{"border-x":[u]}],"border-color-y":[{"border-y":[u]}],"border-color-t":[{"border-t":[u]}],"border-color-r":[{"border-r":[u]}],"border-color-b":[{"border-b":[u]}],"border-color-l":[{"border-l":[u]}],"divide-color":[{divide:[u]}],"outline-style":[{outline:["",...It()]}],"outline-offset":[{"outline-offset":[Gl,Qn]}],"outline-w":[{outline:[Gl,vu]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:en()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[Q]}],"ring-offset-w":[{"ring-offset":[Gl,vu]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",bu,jQ]}],"shadow-color":[{shadow:[Sy]}],opacity:[{opacity:[Q]}],"mix-blend":[{"mix-blend":[...Et(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Et()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[o]}],contrast:[{contrast:[s]}],"drop-shadow":[{"drop-shadow":["","none",bu,Qn]}],grayscale:[{grayscale:[k]}],"hue-rotate":[{"hue-rotate":[O]}],invert:[{invert:[F]}],saturate:[{saturate:[re]}],sepia:[{sepia:[Ee]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[o]}],"backdrop-contrast":[{"backdrop-contrast":[s]}],"backdrop-grayscale":[{"backdrop-grayscale":[k]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[O]}],"backdrop-invert":[{"backdrop-invert":[F]}],"backdrop-opacity":[{"backdrop-opacity":[Q]}],"backdrop-saturate":[{"backdrop-saturate":[re]}],"backdrop-sepia":[{"backdrop-sepia":[Ee]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[_]}],"border-spacing-x":[{"border-spacing-x":[_]}],"border-spacing-y":[{"border-spacing-y":[_]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Qn]}],duration:[{duration:hn()}],ease:[{ease:["linear","in","out","in-out",Qn]}],delay:[{delay:hn()}],animate:[{animate:["none","spin","ping","pulse","bounce",Qn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[xe]}],"scale-x":[{"scale-x":[xe]}],"scale-y":[{"scale-y":[xe]}],rotate:[{rotate:[wy,Qn]}],"translate-x":[{"translate-x":[Ne]}],"translate-y":[{"translate-y":[Ne]}],"skew-x":[{"skew-x":[He]}],"skew-y":[{"skew-y":[He]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Qn]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Qn]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":pt()}],"scroll-mx":[{"scroll-mx":pt()}],"scroll-my":[{"scroll-my":pt()}],"scroll-ms":[{"scroll-ms":pt()}],"scroll-me":[{"scroll-me":pt()}],"scroll-mt":[{"scroll-mt":pt()}],"scroll-mr":[{"scroll-mr":pt()}],"scroll-mb":[{"scroll-mb":pt()}],"scroll-ml":[{"scroll-ml":pt()}],"scroll-p":[{"scroll-p":pt()}],"scroll-px":[{"scroll-px":pt()}],"scroll-py":[{"scroll-py":pt()}],"scroll-ps":[{"scroll-ps":pt()}],"scroll-pe":[{"scroll-pe":pt()}],"scroll-pt":[{"scroll-pt":pt()}],"scroll-pr":[{"scroll-pr":pt()}],"scroll-pb":[{"scroll-pb":pt()}],"scroll-pl":[{"scroll-pl":pt()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Qn]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Gl,vu,zT]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},UQ=SQ(VQ);function Zn(...e){return UQ(Jl(e))}const $Q=uQ,BF=W.forwardRef(({className:e,...t},r)=>S.jsx(DF,{ref:r,className:Zn("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));BF.displayName=DF.displayName;const Ny=W.forwardRef(({className:e,...t},r)=>S.jsx(RF,{ref:r,className:Zn("mx-1 inline-flex min-w-24 items-center justify-center whitespace-nowrap rounded-sm bg-white px-3 py-1.5 text-sm font-medium ring-1 ring-sky-700 ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-sky-700 data-[state=active]:text-white data-[state=active]:shadow-sm",e),...t}));Ny.displayName=RF.displayName;const Ly=W.forwardRef(({className:e,...t},r)=>S.jsx(kF,{ref:r,className:Zn("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));Ly.displayName=kF.displayName;const hp={cultural:[{id:6,title:"Ruwanwelisaya Stupa - Anuradhapura's Sacred Jewel",location:"Anuradhapura , North Central Province",description:"Visit the majestic Ruwanwelisaya Stupa in the sacred city of Anuradhapura. Built by King Dutugemunu in 140 BC, this iconic stupa is one of the largest in the world and a treasured symbol of Sri Lanka’s Buddhist heritage. Its serene atmosphere makes it a peaceful stop for any traveler.",image:"/images/slide02.jpeg"},{id:7,title:"Sigiriya - The Lion Rock Fortress",location:"Sigiriya , Central Province",description:"Marvel at Sigiriya, an ancient rock fortress rising from the central plains of Sri Lanka. Once the royal citadel of King Kashyapa, this UNESCO World Heritage Site is famous for its stunning frescoes, symmetrical gardens, and panoramic views from the top of the massive rock column.",image:"/images/slide01.jpg"},{id:9,title:"Esala Perahera - Kandy's Grand Festival of Lights",location:"Kandy , Central Province",description:"Experience the vibrant spectacle of the Esala Perahera, one of Sri Lanka’s most iconic cultural festivals, held annually in Kandy. This grand procession, which honors the Sacred Tooth Relic of the Buddha, features elaborately decorated elephants, traditional dancers, fire performers, and drummers parading through the streets. Held during the month of Esala (July/August), the festival is a dazzling display of Sri Lanka’s rich heritage and a must-see event for travelers seeking a unique cultural experience.",image:"/images/item01.jpg"}],nature:[{id:1,title:"Adam's Peak - The Sacred Mountain of Pilgrimage",location:"Sri Palabaddala , Sabaragamuwa Province",description:"Embark on a spiritual journey to Adam's Peak, a sacred mountain revered by multiple religions. Famous for its unique footprint at the summit, this iconic hike offers a rewarding sunrise view after a night of trekking, making it a must for both pilgrims and adventurers.",image:"/images/item02.jpg"},{id:2,title:"Hatton Waterfalls - Nature's Hidden Gem in the Highlands",location:"Hatton , Central Province",description:"Nestled in the scenic town of Hatton, this lesser-known waterfall offers a tranquil escape into nature. Surrounded by lush greenery and tea plantations, Hatton Waterfalls provides a peaceful retreat for hikers and nature lovers. Whether you're seeking solitude or an off-the-beaten-path adventure, this stunning waterfall is a must-visit in Sri Lanka's central highlands.",image:"/images/slide03.jpg"},{id:4,title:"Nuwara Eliya - The Tea Capital of Sri Lanka",location:"Nuwareliya , Central Province",description:`Journey to Nuwara Eliya, the heart of Sri Lanka's tea country. Known as "Little England" for its cool climate and colonial charm, Nuwara Eliya offers picturesque landscapes dotted with tea plantations. Visit a local tea factory to learn about the tea-making process and enjoy fresh, world-renowned Ceylon tea.`,image:"/images/item03.jpeg"},{id:5,title:"Nilaveli Beach - A Serene Escape on the East Coast",location:"Trincomalee , Eastern Province",description:"Discover the unspoiled beauty of Nilaveli Beach, a tranquil paradise on Sri Lanka’s east coast. Known for its soft golden sands and crystal-clear waters, this beach is perfect for swimming, sunbathing, and snorkeling. With its calm and peaceful atmosphere, Nilaveli offers an idyllic retreat away from the crowds, making it a favorite spot for those looking to relax and unwind by the sea.",image:"/images/item04.jpg"},{id:8,title:"Ella Mountain - The Heart of Hill Country",location:"Ella , Uva Province",description:"For breathtaking views of Sri Lanka’s central highlands, a trip to Ella Mountain is a must. Hike to the top for panoramic views of lush valleys, waterfalls, and tea plantations, or explore the famous Ella Rock for an unforgettable trekking experience.",image:"/images/item05.jpg"},{id:12,title:"Kitulgala - Adventure in the Heart of Nature",location:"Kitulgala , Sabaragamuwa Province",description:"Looking for a thrill? Head to Kitulgala, Sri Lanka’s adventure capital, where you can enjoy white-water rafting, jungle trekking, and more. Set amidst lush rainforests and the Kelani River, Kitulgala is the perfect destination for adrenaline seekers and nature lovers.",image:"/images/item06.jpg"}],other:[{id:3,title:"Nine Arches Bridge - A Marvel of Colonial Architecture",location:"Ella , Uva Province",description:"Hidden amidst the lush hills of Ella, the Nine Arches Bridge is a masterpiece of British engineering from the colonial era. Surrounded by misty green landscapes, this photogenic bridge is a must-visit spot for nature lovers and photographers, especially when a train passes over it.",image:"/images/slide04.jpeg"},{id:10,title:"Galle Fort - A Colonial Marvel by the Sea",location:"Galle , Southern Province",description:"Step back in time at Galle Fort, a UNESCO World Heritage site on Sri Lanka's southern coast. This 16th-century fort, built by the Portuguese and later fortified by the Dutch, boasts cobbled streets, colonial architecture, and stunning ocean views. Perfect for history lovers and wanderers alike.",image:"/images/item07.jpg"},{id:11,title:"Colombo Lotus Tower - The Pride of Colombo's Skyline",location:"Colombo , Western Province",description:"Soaring high above the capital, the Colombo Lotus Tower is South Asia's tallest tower. This architectural wonder offers panoramic views of the city from its observation decks. It's a must-visit for anyone looking to capture breathtaking views of Colombo and its surroundings.",image:"/images/item08.jpg"}]},GQ=()=>S.jsxs("div",{className:"flex min-h-screen flex-col",children:[S.jsx(ko,{}),S.jsxs("section",{className:"container mx-auto mt-20 px-4 py-8",children:[S.jsx("h1",{className:"mb-8 text-center text-2xl font-medium md:text-3xl",children:"Gallery"}),S.jsxs($Q,{defaultValue:"all",className:"",children:[S.jsx("div",{className:"flex w-full justify-center",children:S.jsxs(BF,{children:[S.jsx(Ny,{value:"all",children:"All"}),S.jsx(Ny,{value:"cultural",children:"Cultural"}),S.jsx(Ny,{value:"nature",children:"Nature"}),S.jsx(Ny,{value:"other",children:"Other"})]})}),S.jsx(Ly,{value:"all",children:S.jsx(gv,{items:[...hp.cultural,...hp.nature,...hp.other]})}),S.jsx(Ly,{value:"cultural",children:S.jsx(gv,{items:hp.cultural})}),S.jsx(Ly,{value:"nature",children:S.jsx(gv,{items:hp.nature})}),S.jsx(Ly,{value:"other",children:S.jsx(gv,{items:hp.other})})]})]}),S.jsx("div",{className:"flex-grow"}),S.jsx(Ro,{})]}),gv=({items:e})=>e!=null&&e.length?S.jsx("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:e==null?void 0:e.map(t=>S.jsxs("div",{className:"w-full max-w-md rounded-lg bg-white shadow-md drop-shadow-xl",children:[S.jsx("img",{src:t.image,alt:"gallery",className:"h-48 w-full rounded-lg object-cover"}),S.jsxs("div",{className:"p-4",children:[S.jsx("h2",{className:"line-clamp-2 font-medium",children:t.title}),S.jsxs("p",{className:"flex items-end gap-x-1 text-xs text-gray-600",children:[S.jsx(uc,{className:"-ms-1 size-5 text-red-600"}),t.location]}),S.jsx("p",{className:"mt-2 line-clamp-4 text-sm text-gray-700",children:t.description})]})]},t.id))}):S.jsx("div",{className:"flex w-full items-center justify-center pt-5",children:S.jsx("h1",{className:"text-gray-600",children:"No gallery items found"})});/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WQ=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),VF=(...e)=>e.filter((t,r,o)=>!!t&&o.indexOf(t)===r).join(" ");/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var HQ={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qQ=W.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:o,className:u="",children:m,iconNode:_,...b},s)=>W.createElement("svg",{ref:s,...HQ,width:t,height:t,stroke:e,strokeWidth:o?Number(r)*24/Number(t):r,className:VF("lucide",u),...b},[..._.map(([k,O])=>W.createElement(k,O)),...Array.isArray(m)?m:[m]]));/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=(e,t)=>{const r=W.forwardRef(({className:o,...u},m)=>W.createElement(qQ,{ref:m,iconNode:t,className:VF(`lucide-${WQ(e)}`,o),...u}));return r.displayName=`${e}`,r};/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZQ=ia("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XQ=ia("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gl=ia("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UF=ia("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $F=ia("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YQ=ia("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KQ=ia("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JQ=ia("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GF=ia("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QQ=ia("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=ia("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eee=ia("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),HM=6048e5,tee=864e5,mO=Symbol.for("constructDateFrom");function Zi(e,t){return typeof e=="function"?e(t):e&&typeof e=="object"&&mO in e?e[mO](t):e instanceof Date?new e.constructor(t):new Date(t)}function Rr(e,t){return Zi(t||e,e)}function Ns(e,t,r){const o=Rr(e,r==null?void 0:r.in);return isNaN(t)?Zi((r==null?void 0:r.in)||e,NaN):(t&&o.setDate(o.getDate()+t),o)}function Oa(e,t,r){const o=Rr(e,r==null?void 0:r.in);if(isNaN(t))return Zi((r==null?void 0:r.in)||e,NaN);if(!t)return o;const u=o.getDate(),m=Zi((r==null?void 0:r.in)||e,o.getTime());m.setMonth(o.getMonth()+t+1,0);const _=m.getDate();return u>=_?m:(o.setFullYear(m.getFullYear(),m.getMonth(),u),o)}let nee={};function K_(){return nee}function yl(e,t){var b,s,k,O;const r=K_(),o=(t==null?void 0:t.weekStartsOn)??((s=(b=t==null?void 0:t.locale)==null?void 0:b.options)==null?void 0:s.weekStartsOn)??r.weekStartsOn??((O=(k=r.locale)==null?void 0:k.options)==null?void 0:O.weekStartsOn)??0,u=Rr(e,t==null?void 0:t.in),m=u.getDay(),_=(m<o?7:0)+m-o;return u.setDate(u.getDate()-_),u.setHours(0,0,0,0),u}function Nh(e,t){return yl(e,{...t,weekStartsOn:1})}function WF(e,t){const r=Rr(e,t==null?void 0:t.in),o=r.getFullYear(),u=Zi(r,0);u.setFullYear(o+1,0,4),u.setHours(0,0,0,0);const m=Nh(u),_=Zi(r,0);_.setFullYear(o,0,4),_.setHours(0,0,0,0);const b=Nh(_);return r.getTime()>=m.getTime()?o+1:r.getTime()>=b.getTime()?o:o-1}function B1(e){const t=Rr(e),r=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return r.setUTCFullYear(t.getFullYear()),+e-+r}function vm(e,...t){const r=Zi.bind(null,e||t.find(o=>typeof o=="object"));return t.map(r)}function sm(e,t){const r=Rr(e,t==null?void 0:t.in);return r.setHours(0,0,0,0),r}function dl(e,t,r){const[o,u]=vm(r==null?void 0:r.in,e,t),m=sm(o),_=sm(u),b=+m-B1(m),s=+_-B1(_);return Math.round((b-s)/tee)}function ree(e,t){const r=WF(e,t),o=Zi(e,0);return o.setFullYear(r,0,4),o.setHours(0,0,0,0),Nh(o)}function zC(e,t,r){return Ns(e,t*7,r)}function iee(e,t,r){return Oa(e,t*12,r)}function see(e,t){let r,o=t==null?void 0:t.in;return e.forEach(u=>{!o&&typeof u=="object"&&(o=Zi.bind(null,u));const m=Rr(u,o);(!r||r<m||isNaN(+m))&&(r=m)}),Zi(o,r||NaN)}function oee(e,t){let r,o=t==null?void 0:t.in;return e.forEach(u=>{!o&&typeof u=="object"&&(o=Zi.bind(null,u));const m=Rr(u,o);(!r||r>m||isNaN(+m))&&(r=m)}),Zi(o,r||NaN)}function Xs(e,t,r){const[o,u]=vm(r==null?void 0:r.in,e,t);return+sm(o)==+sm(u)}function qM(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function aee(e){return!(!qM(e)&&typeof e!="number"||isNaN(+Rr(e)))}function D_(e,t,r){const[o,u]=vm(r==null?void 0:r.in,e,t),m=o.getFullYear()-u.getFullYear(),_=o.getMonth()-u.getMonth();return m*12+_}function lee(e,t,r){const[o,u]=vm(r==null?void 0:r.in,e,t),m=yl(o,r),_=yl(u,r),b=+m-B1(m),s=+_-B1(_);return Math.round((b-s)/HM)}function ZM(e,t){const r=Rr(e,t==null?void 0:t.in),o=r.getMonth();return r.setFullYear(r.getFullYear(),o+1,0),r.setHours(23,59,59,999),r}function to(e,t){const r=Rr(e,t==null?void 0:t.in);return r.setDate(1),r.setHours(0,0,0,0),r}function HF(e,t){const r=Rr(e,t==null?void 0:t.in);return r.setFullYear(r.getFullYear(),0,1),r.setHours(0,0,0,0),r}function XM(e,t){var b,s,k,O;const r=K_(),o=(t==null?void 0:t.weekStartsOn)??((s=(b=t==null?void 0:t.locale)==null?void 0:b.options)==null?void 0:s.weekStartsOn)??r.weekStartsOn??((O=(k=r.locale)==null?void 0:k.options)==null?void 0:O.weekStartsOn)??0,u=Rr(e,t==null?void 0:t.in),m=u.getDay(),_=(m<o?-7:0)+6-(m-o);return u.setDate(u.getDate()+_),u.setHours(23,59,59,999),u}function qF(e,t){return XM(e,{...t,weekStartsOn:1})}const cee={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},uee=(e,t,r)=>{let o;const u=cee[e];return typeof u=="string"?o=u:t===1?o=u.one:o=u.other.replace("{{count}}",t.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+o:o+" ago":o};function FT(e){return(t={})=>{const r=t.width?String(t.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}const dee={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},hee={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},fee={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},pee={date:FT({formats:dee,defaultWidth:"full"}),time:FT({formats:hee,defaultWidth:"full"}),dateTime:FT({formats:fee,defaultWidth:"full"})},mee={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},gee=(e,t,r,o)=>mee[e];function Ty(e){return(t,r)=>{const o=r!=null&&r.context?String(r.context):"standalone";let u;if(o==="formatting"&&e.formattingValues){const _=e.defaultFormattingWidth||e.defaultWidth,b=r!=null&&r.width?String(r.width):_;u=e.formattingValues[b]||e.formattingValues[_]}else{const _=e.defaultWidth,b=r!=null&&r.width?String(r.width):e.defaultWidth;u=e.values[b]||e.values[_]}const m=e.argumentCallback?e.argumentCallback(t):t;return u[m]}}const yee={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},_ee={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},xee={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},vee={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},bee={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},wee={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},See=(e,t)=>{const r=Number(e),o=r%100;if(o>20||o<10)switch(o%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},Tee={ordinalNumber:See,era:Ty({values:yee,defaultWidth:"wide"}),quarter:Ty({values:_ee,defaultWidth:"wide",argumentCallback:e=>e-1}),month:Ty({values:xee,defaultWidth:"wide"}),day:Ty({values:vee,defaultWidth:"wide"}),dayPeriod:Ty({values:bee,defaultWidth:"wide",formattingValues:wee,defaultFormattingWidth:"wide"})};function Ey(e){return(t,r={})=>{const o=r.width,u=o&&e.matchPatterns[o]||e.matchPatterns[e.defaultMatchWidth],m=t.match(u);if(!m)return null;const _=m[0],b=o&&e.parsePatterns[o]||e.parsePatterns[e.defaultParseWidth],s=Array.isArray(b)?Cee(b,F=>F.test(_)):Eee(b,F=>F.test(_));let k;k=e.valueCallback?e.valueCallback(s):s,k=r.valueCallback?r.valueCallback(k):k;const O=t.slice(_.length);return{value:k,rest:O}}}function Eee(e,t){for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t(e[r]))return r}function Cee(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return r}function Pee(e){return(t,r={})=>{const o=t.match(e.matchPattern);if(!o)return null;const u=o[0],m=t.match(e.parsePattern);if(!m)return null;let _=e.valueCallback?e.valueCallback(m[0]):m[0];_=r.valueCallback?r.valueCallback(_):_;const b=t.slice(u.length);return{value:_,rest:b}}}const Mee=/^(\d+)(th|st|nd|rd)?/i,Aee=/\d+/i,Iee={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Dee={any:[/^b/i,/^(a|c)/i]},Ree={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},kee={any:[/1/i,/2/i,/3/i,/4/i]},Nee={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Lee={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Oee={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},jee={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},zee={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Fee={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Bee={ordinalNumber:Pee({matchPattern:Mee,parsePattern:Aee,valueCallback:e=>parseInt(e,10)}),era:Ey({matchPatterns:Iee,defaultMatchWidth:"wide",parsePatterns:Dee,defaultParseWidth:"any"}),quarter:Ey({matchPatterns:Ree,defaultMatchWidth:"wide",parsePatterns:kee,defaultParseWidth:"any",valueCallback:e=>e+1}),month:Ey({matchPatterns:Nee,defaultMatchWidth:"wide",parsePatterns:Lee,defaultParseWidth:"any"}),day:Ey({matchPatterns:Oee,defaultMatchWidth:"wide",parsePatterns:jee,defaultParseWidth:"any"}),dayPeriod:Ey({matchPatterns:zee,defaultMatchWidth:"any",parsePatterns:Fee,defaultParseWidth:"any"})},ZF={code:"en-US",formatDistance:uee,formatLong:pee,formatRelative:gee,localize:Tee,match:Bee,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Vee(e,t){const r=Rr(e,t==null?void 0:t.in);return dl(r,HF(r))+1}function XF(e,t){const r=Rr(e,t==null?void 0:t.in),o=+Nh(r)-+ree(r);return Math.round(o/HM)+1}function YF(e,t){var O,F,q,H;const r=Rr(e,t==null?void 0:t.in),o=r.getFullYear(),u=K_(),m=(t==null?void 0:t.firstWeekContainsDate)??((F=(O=t==null?void 0:t.locale)==null?void 0:O.options)==null?void 0:F.firstWeekContainsDate)??u.firstWeekContainsDate??((H=(q=u.locale)==null?void 0:q.options)==null?void 0:H.firstWeekContainsDate)??1,_=Zi((t==null?void 0:t.in)||e,0);_.setFullYear(o+1,0,m),_.setHours(0,0,0,0);const b=yl(_,t),s=Zi((t==null?void 0:t.in)||e,0);s.setFullYear(o,0,m),s.setHours(0,0,0,0);const k=yl(s,t);return+r>=+b?o+1:+r>=+k?o:o-1}function Uee(e,t){var b,s,k,O;const r=K_(),o=(t==null?void 0:t.firstWeekContainsDate)??((s=(b=t==null?void 0:t.locale)==null?void 0:b.options)==null?void 0:s.firstWeekContainsDate)??r.firstWeekContainsDate??((O=(k=r.locale)==null?void 0:k.options)==null?void 0:O.firstWeekContainsDate)??1,u=YF(e,t),m=Zi((t==null?void 0:t.in)||e,0);return m.setFullYear(u,0,o),m.setHours(0,0,0,0),yl(m,t)}function KF(e,t){const r=Rr(e,t==null?void 0:t.in),o=+yl(r,t)-+Uee(r,t);return Math.round(o/HM)+1}function Ar(e,t){const r=e<0?"-":"",o=Math.abs(e).toString().padStart(t,"0");return r+o}const wu={y(e,t){const r=e.getFullYear(),o=r>0?r:1-r;return Ar(t==="yy"?o%100:o,t.length)},M(e,t){const r=e.getMonth();return t==="M"?String(r+1):Ar(r+1,2)},d(e,t){return Ar(e.getDate(),t.length)},a(e,t){const r=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(e,t){return Ar(e.getHours()%12||12,t.length)},H(e,t){return Ar(e.getHours(),t.length)},m(e,t){return Ar(e.getMinutes(),t.length)},s(e,t){return Ar(e.getSeconds(),t.length)},S(e,t){const r=t.length,o=e.getMilliseconds(),u=Math.trunc(o*Math.pow(10,r-3));return Ar(u,t.length)}},fp={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},gO={G:function(e,t,r){const o=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return r.era(o,{width:"abbreviated"});case"GGGGG":return r.era(o,{width:"narrow"});case"GGGG":default:return r.era(o,{width:"wide"})}},y:function(e,t,r){if(t==="yo"){const o=e.getFullYear(),u=o>0?o:1-o;return r.ordinalNumber(u,{unit:"year"})}return wu.y(e,t)},Y:function(e,t,r,o){const u=YF(e,o),m=u>0?u:1-u;if(t==="YY"){const _=m%100;return Ar(_,2)}return t==="Yo"?r.ordinalNumber(m,{unit:"year"}):Ar(m,t.length)},R:function(e,t){const r=WF(e);return Ar(r,t.length)},u:function(e,t){const r=e.getFullYear();return Ar(r,t.length)},Q:function(e,t,r){const o=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(o);case"QQ":return Ar(o,2);case"Qo":return r.ordinalNumber(o,{unit:"quarter"});case"QQQ":return r.quarter(o,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(o,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(o,{width:"wide",context:"formatting"})}},q:function(e,t,r){const o=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(o);case"qq":return Ar(o,2);case"qo":return r.ordinalNumber(o,{unit:"quarter"});case"qqq":return r.quarter(o,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(o,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(o,{width:"wide",context:"standalone"})}},M:function(e,t,r){const o=e.getMonth();switch(t){case"M":case"MM":return wu.M(e,t);case"Mo":return r.ordinalNumber(o+1,{unit:"month"});case"MMM":return r.month(o,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(o,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(o,{width:"wide",context:"formatting"})}},L:function(e,t,r){const o=e.getMonth();switch(t){case"L":return String(o+1);case"LL":return Ar(o+1,2);case"Lo":return r.ordinalNumber(o+1,{unit:"month"});case"LLL":return r.month(o,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(o,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(o,{width:"wide",context:"standalone"})}},w:function(e,t,r,o){const u=KF(e,o);return t==="wo"?r.ordinalNumber(u,{unit:"week"}):Ar(u,t.length)},I:function(e,t,r){const o=XF(e);return t==="Io"?r.ordinalNumber(o,{unit:"week"}):Ar(o,t.length)},d:function(e,t,r){return t==="do"?r.ordinalNumber(e.getDate(),{unit:"date"}):wu.d(e,t)},D:function(e,t,r){const o=Vee(e);return t==="Do"?r.ordinalNumber(o,{unit:"dayOfYear"}):Ar(o,t.length)},E:function(e,t,r){const o=e.getDay();switch(t){case"E":case"EE":case"EEE":return r.day(o,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(o,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(o,{width:"short",context:"formatting"});case"EEEE":default:return r.day(o,{width:"wide",context:"formatting"})}},e:function(e,t,r,o){const u=e.getDay(),m=(u-o.weekStartsOn+8)%7||7;switch(t){case"e":return String(m);case"ee":return Ar(m,2);case"eo":return r.ordinalNumber(m,{unit:"day"});case"eee":return r.day(u,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(u,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(u,{width:"short",context:"formatting"});case"eeee":default:return r.day(u,{width:"wide",context:"formatting"})}},c:function(e,t,r,o){const u=e.getDay(),m=(u-o.weekStartsOn+8)%7||7;switch(t){case"c":return String(m);case"cc":return Ar(m,t.length);case"co":return r.ordinalNumber(m,{unit:"day"});case"ccc":return r.day(u,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(u,{width:"narrow",context:"standalone"});case"cccccc":return r.day(u,{width:"short",context:"standalone"});case"cccc":default:return r.day(u,{width:"wide",context:"standalone"})}},i:function(e,t,r){const o=e.getDay(),u=o===0?7:o;switch(t){case"i":return String(u);case"ii":return Ar(u,t.length);case"io":return r.ordinalNumber(u,{unit:"day"});case"iii":return r.day(o,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(o,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(o,{width:"short",context:"formatting"});case"iiii":default:return r.day(o,{width:"wide",context:"formatting"})}},a:function(e,t,r){const u=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.dayPeriod(u,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(u,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(u,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(u,{width:"wide",context:"formatting"})}},b:function(e,t,r){const o=e.getHours();let u;switch(o===12?u=fp.noon:o===0?u=fp.midnight:u=o/12>=1?"pm":"am",t){case"b":case"bb":return r.dayPeriod(u,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(u,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(u,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(u,{width:"wide",context:"formatting"})}},B:function(e,t,r){const o=e.getHours();let u;switch(o>=17?u=fp.evening:o>=12?u=fp.afternoon:o>=4?u=fp.morning:u=fp.night,t){case"B":case"BB":case"BBB":return r.dayPeriod(u,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(u,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(u,{width:"wide",context:"formatting"})}},h:function(e,t,r){if(t==="ho"){let o=e.getHours()%12;return o===0&&(o=12),r.ordinalNumber(o,{unit:"hour"})}return wu.h(e,t)},H:function(e,t,r){return t==="Ho"?r.ordinalNumber(e.getHours(),{unit:"hour"}):wu.H(e,t)},K:function(e,t,r){const o=e.getHours()%12;return t==="Ko"?r.ordinalNumber(o,{unit:"hour"}):Ar(o,t.length)},k:function(e,t,r){let o=e.getHours();return o===0&&(o=24),t==="ko"?r.ordinalNumber(o,{unit:"hour"}):Ar(o,t.length)},m:function(e,t,r){return t==="mo"?r.ordinalNumber(e.getMinutes(),{unit:"minute"}):wu.m(e,t)},s:function(e,t,r){return t==="so"?r.ordinalNumber(e.getSeconds(),{unit:"second"}):wu.s(e,t)},S:function(e,t){return wu.S(e,t)},X:function(e,t,r){const o=e.getTimezoneOffset();if(o===0)return"Z";switch(t){case"X":return _O(o);case"XXXX":case"XX":return ph(o);case"XXXXX":case"XXX":default:return ph(o,":")}},x:function(e,t,r){const o=e.getTimezoneOffset();switch(t){case"x":return _O(o);case"xxxx":case"xx":return ph(o);case"xxxxx":case"xxx":default:return ph(o,":")}},O:function(e,t,r){const o=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+yO(o,":");case"OOOO":default:return"GMT"+ph(o,":")}},z:function(e,t,r){const o=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+yO(o,":");case"zzzz":default:return"GMT"+ph(o,":")}},t:function(e,t,r){const o=Math.trunc(+e/1e3);return Ar(o,t.length)},T:function(e,t,r){return Ar(+e,t.length)}};function yO(e,t=""){const r=e>0?"-":"+",o=Math.abs(e),u=Math.trunc(o/60),m=o%60;return m===0?r+String(u):r+String(u)+t+Ar(m,2)}function _O(e,t){return e%60===0?(e>0?"-":"+")+Ar(Math.abs(e)/60,2):ph(e,t)}function ph(e,t=""){const r=e>0?"-":"+",o=Math.abs(e),u=Ar(Math.trunc(o/60),2),m=Ar(o%60,2);return r+u+t+m}const xO=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},JF=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},$ee=(e,t)=>{const r=e.match(/(P+)(p+)?/)||[],o=r[1],u=r[2];if(!u)return xO(e,t);let m;switch(o){case"P":m=t.dateTime({width:"short"});break;case"PP":m=t.dateTime({width:"medium"});break;case"PPP":m=t.dateTime({width:"long"});break;case"PPPP":default:m=t.dateTime({width:"full"});break}return m.replace("{{date}}",xO(o,t)).replace("{{time}}",JF(u,t))},Gee={p:JF,P:$ee},Wee=/^D+$/,Hee=/^Y+$/,qee=["D","DD","YY","YYYY"];function Zee(e){return Wee.test(e)}function Xee(e){return Hee.test(e)}function Yee(e,t,r){const o=Kee(e,t,r);if(console.warn(o),qee.includes(e))throw new RangeError(o)}function Kee(e,t,r){const o=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${o} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Jee=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Qee=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,ete=/^'([^]*?)'?$/,tte=/''/g,nte=/[a-zA-Z]/;function Ei(e,t,r){var O,F,q,H,J,U,te,Q;const o=K_(),u=(r==null?void 0:r.locale)??o.locale??ZF,m=(r==null?void 0:r.firstWeekContainsDate)??((F=(O=r==null?void 0:r.locale)==null?void 0:O.options)==null?void 0:F.firstWeekContainsDate)??o.firstWeekContainsDate??((H=(q=o.locale)==null?void 0:q.options)==null?void 0:H.firstWeekContainsDate)??1,_=(r==null?void 0:r.weekStartsOn)??((U=(J=r==null?void 0:r.locale)==null?void 0:J.options)==null?void 0:U.weekStartsOn)??o.weekStartsOn??((Q=(te=o.locale)==null?void 0:te.options)==null?void 0:Q.weekStartsOn)??0,b=Rr(e,r==null?void 0:r.in);if(!aee(b))throw new RangeError("Invalid time value");let s=t.match(Qee).map(ee=>{const re=ee[0];if(re==="p"||re==="P"){const xe=Gee[re];return xe(ee,u.formatLong)}return ee}).join("").match(Jee).map(ee=>{if(ee==="''")return{isToken:!1,value:"'"};const re=ee[0];if(re==="'")return{isToken:!1,value:rte(ee)};if(gO[re])return{isToken:!0,value:ee};if(re.match(nte))throw new RangeError("Format string contains an unescaped latin alphabet character `"+re+"`");return{isToken:!1,value:ee}});u.localize.preprocessor&&(s=u.localize.preprocessor(b,s));const k={firstWeekContainsDate:m,weekStartsOn:_,locale:u};return s.map(ee=>{if(!ee.isToken)return ee.value;const re=ee.value;(!(r!=null&&r.useAdditionalWeekYearTokens)&&Xee(re)||!(r!=null&&r.useAdditionalDayOfYearTokens)&&Zee(re))&&Yee(re,t,String(e));const xe=gO[re[0]];return xe(b,re,u.localize,k)}).join("")}function rte(e){const t=e.match(ete);return t?t[1].replace(tte,"'"):e}function ite(e,t){const r=Rr(e,t==null?void 0:t.in),o=r.getFullYear(),u=r.getMonth(),m=Zi(r,0);return m.setFullYear(o,u+1,0),m.setHours(0,0,0,0),m.getDate()}function ste(e){return Math.trunc(+Rr(e)/1e3)}function ote(e,t){const r=Rr(e,t==null?void 0:t.in),o=r.getMonth();return r.setFullYear(r.getFullYear(),o+1,0),r.setHours(0,0,0,0),Rr(r,t==null?void 0:t.in)}function ate(e,t){const r=Rr(e,t==null?void 0:t.in);return lee(ote(r,t),to(r,t),t)+1}function FC(e,t){return+Rr(e)>+Rr(t)}function QF(e,t){return+Rr(e)<+Rr(t)}function YM(e,t,r){const[o,u]=vm(r==null?void 0:r.in,e,t);return o.getFullYear()===u.getFullYear()&&o.getMonth()===u.getMonth()}function lte(e,t,r){const[o,u]=vm(r==null?void 0:r.in,e,t);return o.getFullYear()===u.getFullYear()}function BT(e,t,r){return Ns(e,-t,r)}function VT(e,t,r){const o=Rr(e,r==null?void 0:r.in),u=o.getFullYear(),m=o.getDate(),_=Zi(e,0);_.setFullYear(u,t,15),_.setHours(0,0,0,0);const b=ite(_);return o.setMonth(t,Math.min(m,b)),o}function vO(e,t,r){const o=Rr(e,r==null?void 0:r.in);return isNaN(+o)?Zi(e,NaN):(o.setFullYear(t),o)}var Ln=function(){return Ln=Object.assign||function(t){for(var r,o=1,u=arguments.length;o<u;o++){r=arguments[o];for(var m in r)Object.prototype.hasOwnProperty.call(r,m)&&(t[m]=r[m])}return t},Ln.apply(this,arguments)};function cte(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,o=Object.getOwnPropertySymbols(e);u<o.length;u++)t.indexOf(o[u])<0&&Object.prototype.propertyIsEnumerable.call(e,o[u])&&(r[o[u]]=e[o[u]]);return r}function eB(e,t,r){for(var o=0,u=t.length,m;o<u;o++)(m||!(o in t))&&(m||(m=Array.prototype.slice.call(t,0,o)),m[o]=t[o]);return e.concat(m||Array.prototype.slice.call(t))}function J_(e){return e.mode==="multiple"}function Q_(e){return e.mode==="range"}function Db(e){return e.mode==="single"}var ute={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function dte(e,t){return Ei(e,"LLLL y",t)}function hte(e,t){return Ei(e,"d",t)}function fte(e,t){return Ei(e,"LLLL",t)}function pte(e){return"".concat(e)}function mte(e,t){return Ei(e,"cccccc",t)}function gte(e,t){return Ei(e,"yyyy",t)}var yte=Object.freeze({__proto__:null,formatCaption:dte,formatDay:hte,formatMonthCaption:fte,formatWeekNumber:pte,formatWeekdayName:mte,formatYearCaption:gte}),_te=function(e,t,r){return Ei(e,"do MMMM (EEEE)",r)},xte=function(){return"Month: "},vte=function(){return"Go to next month"},bte=function(){return"Go to previous month"},wte=function(e,t){return Ei(e,"cccc",t)},Ste=function(e){return"Week n. ".concat(e)},Tte=function(){return"Year: "},Ete=Object.freeze({__proto__:null,labelDay:_te,labelMonthDropdown:xte,labelNext:vte,labelPrevious:bte,labelWeekNumber:Ste,labelWeekday:wte,labelYearDropdown:Tte});function Cte(){var e="buttons",t=ute,r=ZF,o={},u={},m=1,_={},b=new Date;return{captionLayout:e,classNames:t,formatters:yte,labels:Ete,locale:r,modifiersClassNames:o,modifiers:u,numberOfMonths:m,styles:_,today:b,mode:"default"}}function Pte(e){var t=e.fromYear,r=e.toYear,o=e.fromMonth,u=e.toMonth,m=e.fromDate,_=e.toDate;return o?m=to(o):t&&(m=new Date(t,0,1)),u?_=ZM(u):r&&(_=new Date(r,11,31)),{fromDate:m?sm(m):void 0,toDate:_?sm(_):void 0}}var tB=W.createContext(void 0);function Mte(e){var t,r=e.initialProps,o=Cte(),u=Pte(r),m=u.fromDate,_=u.toDate,b=(t=r.captionLayout)!==null&&t!==void 0?t:o.captionLayout;b!=="buttons"&&(!m||!_)&&(b="buttons");var s;(Db(r)||J_(r)||Q_(r))&&(s=r.onSelect);var k=Ln(Ln(Ln({},o),r),{captionLayout:b,classNames:Ln(Ln({},o.classNames),r.classNames),components:Ln({},r.components),formatters:Ln(Ln({},o.formatters),r.formatters),fromDate:m,labels:Ln(Ln({},o.labels),r.labels),mode:r.mode||o.mode,modifiers:Ln(Ln({},o.modifiers),r.modifiers),modifiersClassNames:Ln(Ln({},o.modifiersClassNames),r.modifiersClassNames),onSelect:s,styles:Ln(Ln({},o.styles),r.styles),toDate:_});return S.jsx(tB.Provider,{value:k,children:e.children})}function Gr(){var e=W.useContext(tB);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function nB(e){var t=Gr(),r=t.locale,o=t.classNames,u=t.styles,m=t.formatters.formatCaption;return S.jsx("div",{className:o.caption_label,style:u.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:m(e.displayMonth,{locale:r})})}function Ate(e){return S.jsx("svg",Ln({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:S.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function rB(e){var t,r,o=e.onChange,u=e.value,m=e.children,_=e.caption,b=e.className,s=e.style,k=Gr(),O=(r=(t=k.components)===null||t===void 0?void 0:t.IconDropdown)!==null&&r!==void 0?r:Ate;return S.jsxs("div",{className:b,style:s,children:[S.jsx("span",{className:k.classNames.vhidden,children:e["aria-label"]}),S.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:k.classNames.dropdown,style:k.styles.dropdown,value:u,onChange:o,children:m}),S.jsxs("div",{className:k.classNames.caption_label,style:k.styles.caption_label,"aria-hidden":"true",children:[_,S.jsx(O,{className:k.classNames.dropdown_icon,style:k.styles.dropdown_icon})]})]})}function Ite(e){var t,r=Gr(),o=r.fromDate,u=r.toDate,m=r.styles,_=r.locale,b=r.formatters.formatMonthCaption,s=r.classNames,k=r.components,O=r.labels.labelMonthDropdown;if(!o)return S.jsx(S.Fragment,{});if(!u)return S.jsx(S.Fragment,{});var F=[];if(lte(o,u))for(var q=to(o),H=o.getMonth();H<=u.getMonth();H++)F.push(VT(q,H));else for(var q=to(new Date),H=0;H<=11;H++)F.push(VT(q,H));var J=function(te){var Q=Number(te.target.value),ee=VT(to(e.displayMonth),Q);e.onChange(ee)},U=(t=k==null?void 0:k.Dropdown)!==null&&t!==void 0?t:rB;return S.jsx(U,{name:"months","aria-label":O(),className:s.dropdown_month,style:m.dropdown_month,onChange:J,value:e.displayMonth.getMonth(),caption:b(e.displayMonth,{locale:_}),children:F.map(function(te){return S.jsx("option",{value:te.getMonth(),children:b(te,{locale:_})},te.getMonth())})})}function Dte(e){var t,r=e.displayMonth,o=Gr(),u=o.fromDate,m=o.toDate,_=o.locale,b=o.styles,s=o.classNames,k=o.components,O=o.formatters.formatYearCaption,F=o.labels.labelYearDropdown,q=[];if(!u)return S.jsx(S.Fragment,{});if(!m)return S.jsx(S.Fragment,{});for(var H=u.getFullYear(),J=m.getFullYear(),U=H;U<=J;U++)q.push(vO(HF(new Date),U));var te=function(ee){var re=vO(to(r),Number(ee.target.value));e.onChange(re)},Q=(t=k==null?void 0:k.Dropdown)!==null&&t!==void 0?t:rB;return S.jsx(Q,{name:"years","aria-label":F(),className:s.dropdown_year,style:b.dropdown_year,onChange:te,value:r.getFullYear(),caption:O(r,{locale:_}),children:q.map(function(ee){return S.jsx("option",{value:ee.getFullYear(),children:O(ee,{locale:_})},ee.getFullYear())})})}function Rte(e,t){var r=W.useState(e),o=r[0],u=r[1],m=t===void 0?o:t;return[m,u]}function kte(e){var t=e.month,r=e.defaultMonth,o=e.today,u=t||r||o||new Date,m=e.toDate,_=e.fromDate,b=e.numberOfMonths,s=b===void 0?1:b;if(m&&D_(m,u)<0){var k=-1*(s-1);u=Oa(m,k)}return _&&D_(u,_)<0&&(u=_),to(u)}function Nte(){var e=Gr(),t=kte(e),r=Rte(t,e.month),o=r[0],u=r[1],m=function(_){var b;if(!e.disableNavigation){var s=to(_);u(s),(b=e.onMonthChange)===null||b===void 0||b.call(e,s)}};return[o,m]}function Lte(e,t){for(var r=t.reverseMonths,o=t.numberOfMonths,u=to(e),m=to(Oa(u,o)),_=D_(m,u),b=[],s=0;s<_;s++){var k=Oa(u,s);b.push(k)}return r&&(b=b.reverse()),b}function Ote(e,t){if(!t.disableNavigation){var r=t.toDate,o=t.pagedNavigation,u=t.numberOfMonths,m=u===void 0?1:u,_=o?m:1,b=to(e);if(!r)return Oa(b,_);var s=D_(r,e);if(!(s<m))return Oa(b,_)}}function jte(e,t){if(!t.disableNavigation){var r=t.fromDate,o=t.pagedNavigation,u=t.numberOfMonths,m=u===void 0?1:u,_=o?m:1,b=to(e);if(!r)return Oa(b,-_);var s=D_(b,r);if(!(s<=0))return Oa(b,-_)}}var iB=W.createContext(void 0);function zte(e){var t=Gr(),r=Nte(),o=r[0],u=r[1],m=Lte(o,t),_=Ote(o,t),b=jte(o,t),s=function(F){return m.some(function(q){return YM(F,q)})},k=function(F,q){s(F)||(q&&QF(F,q)?u(Oa(F,1+t.numberOfMonths*-1)):u(F))},O={currentMonth:o,displayMonths:m,goToMonth:u,goToDate:k,previousMonth:b,nextMonth:_,isDateDisplayed:s};return S.jsx(iB.Provider,{value:O,children:e.children})}function ex(){var e=W.useContext(iB);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function bO(e){var t,r=Gr(),o=r.classNames,u=r.styles,m=r.components,_=ex().goToMonth,b=function(O){_(Oa(O,e.displayIndex?-e.displayIndex:0))},s=(t=m==null?void 0:m.CaptionLabel)!==null&&t!==void 0?t:nB,k=S.jsx(s,{id:e.id,displayMonth:e.displayMonth});return S.jsxs("div",{className:o.caption_dropdowns,style:u.caption_dropdowns,children:[S.jsx("div",{className:o.vhidden,children:k}),S.jsx(Ite,{onChange:b,displayMonth:e.displayMonth}),S.jsx(Dte,{onChange:b,displayMonth:e.displayMonth})]})}function Fte(e){return S.jsx("svg",Ln({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:S.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function Bte(e){return S.jsx("svg",Ln({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:S.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var V1=W.forwardRef(function(e,t){var r=Gr(),o=r.classNames,u=r.styles,m=[o.button_reset,o.button];e.className&&m.push(e.className);var _=m.join(" "),b=Ln(Ln({},u.button_reset),u.button);return e.style&&Object.assign(b,e.style),S.jsx("button",Ln({},e,{ref:t,type:"button",className:_,style:b}))});function Vte(e){var t,r,o=Gr(),u=o.dir,m=o.locale,_=o.classNames,b=o.styles,s=o.labels,k=s.labelPrevious,O=s.labelNext,F=o.components;if(!e.nextMonth&&!e.previousMonth)return S.jsx(S.Fragment,{});var q=k(e.previousMonth,{locale:m}),H=[_.nav_button,_.nav_button_previous].join(" "),J=O(e.nextMonth,{locale:m}),U=[_.nav_button,_.nav_button_next].join(" "),te=(t=F==null?void 0:F.IconRight)!==null&&t!==void 0?t:Bte,Q=(r=F==null?void 0:F.IconLeft)!==null&&r!==void 0?r:Fte;return S.jsxs("div",{className:_.nav,style:b.nav,children:[!e.hidePrevious&&S.jsx(V1,{name:"previous-month","aria-label":q,className:H,style:b.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:u==="rtl"?S.jsx(te,{className:_.nav_icon,style:b.nav_icon}):S.jsx(Q,{className:_.nav_icon,style:b.nav_icon})}),!e.hideNext&&S.jsx(V1,{name:"next-month","aria-label":J,className:U,style:b.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:u==="rtl"?S.jsx(Q,{className:_.nav_icon,style:b.nav_icon}):S.jsx(te,{className:_.nav_icon,style:b.nav_icon})})]})}function wO(e){var t=Gr().numberOfMonths,r=ex(),o=r.previousMonth,u=r.nextMonth,m=r.goToMonth,_=r.displayMonths,b=_.findIndex(function(J){return YM(e.displayMonth,J)}),s=b===0,k=b===_.length-1,O=t>1&&(s||!k),F=t>1&&(k||!s),q=function(){o&&m(o)},H=function(){u&&m(u)};return S.jsx(Vte,{displayMonth:e.displayMonth,hideNext:O,hidePrevious:F,nextMonth:u,previousMonth:o,onPreviousClick:q,onNextClick:H})}function Ute(e){var t,r=Gr(),o=r.classNames,u=r.disableNavigation,m=r.styles,_=r.captionLayout,b=r.components,s=(t=b==null?void 0:b.CaptionLabel)!==null&&t!==void 0?t:nB,k;return u?k=S.jsx(s,{id:e.id,displayMonth:e.displayMonth}):_==="dropdown"?k=S.jsx(bO,{displayMonth:e.displayMonth,id:e.id}):_==="dropdown-buttons"?k=S.jsxs(S.Fragment,{children:[S.jsx(bO,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),S.jsx(wO,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):k=S.jsxs(S.Fragment,{children:[S.jsx(s,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),S.jsx(wO,{displayMonth:e.displayMonth,id:e.id})]}),S.jsx("div",{className:o.caption,style:m.caption,children:k})}function $te(e){var t=Gr(),r=t.footer,o=t.styles,u=t.classNames.tfoot;return r?S.jsx("tfoot",{className:u,style:o.tfoot,children:S.jsx("tr",{children:S.jsx("td",{colSpan:8,children:r})})}):S.jsx(S.Fragment,{})}function Gte(e,t,r){for(var o=r?Nh(new Date):yl(new Date,{locale:e,weekStartsOn:t}),u=[],m=0;m<7;m++){var _=Ns(o,m);u.push(_)}return u}function Wte(){var e=Gr(),t=e.classNames,r=e.styles,o=e.showWeekNumber,u=e.locale,m=e.weekStartsOn,_=e.ISOWeek,b=e.formatters.formatWeekdayName,s=e.labels.labelWeekday,k=Gte(u,m,_);return S.jsxs("tr",{style:r.head_row,className:t.head_row,children:[o&&S.jsx("td",{style:r.head_cell,className:t.head_cell}),k.map(function(O,F){return S.jsx("th",{scope:"col",className:t.head_cell,style:r.head_cell,"aria-label":s(O,{locale:u}),children:b(O,{locale:u})},F)})]})}function Hte(){var e,t=Gr(),r=t.classNames,o=t.styles,u=t.components,m=(e=u==null?void 0:u.HeadRow)!==null&&e!==void 0?e:Wte;return S.jsx("thead",{style:o.head,className:r.head,children:S.jsx(m,{})})}function qte(e){var t=Gr(),r=t.locale,o=t.formatters.formatDay;return S.jsx(S.Fragment,{children:o(e.date,{locale:r})})}var KM=W.createContext(void 0);function Zte(e){if(!J_(e.initialProps)){var t={selected:void 0,modifiers:{disabled:[]}};return S.jsx(KM.Provider,{value:t,children:e.children})}return S.jsx(Xte,{initialProps:e.initialProps,children:e.children})}function Xte(e){var t=e.initialProps,r=e.children,o=t.selected,u=t.min,m=t.max,_=function(k,O,F){var q,H;(q=t.onDayClick)===null||q===void 0||q.call(t,k,O,F);var J=!!(O.selected&&u&&(o==null?void 0:o.length)===u);if(!J){var U=!!(!O.selected&&m&&(o==null?void 0:o.length)===m);if(!U){var te=o?eB([],o):[];if(O.selected){var Q=te.findIndex(function(ee){return Xs(k,ee)});te.splice(Q,1)}else te.push(k);(H=t.onSelect)===null||H===void 0||H.call(t,te,k,O,F)}}},b={disabled:[]};o&&b.disabled.push(function(k){var O=m&&o.length>m-1,F=o.some(function(q){return Xs(q,k)});return!!(O&&!F)});var s={selected:o,onDayClick:_,modifiers:b};return S.jsx(KM.Provider,{value:s,children:r})}function JM(){var e=W.useContext(KM);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}function Yte(e,t){var r=t||{},o=r.from,u=r.to;return o&&u?Xs(u,e)&&Xs(o,e)?void 0:Xs(u,e)?{from:u,to:void 0}:Xs(o,e)?void 0:FC(o,e)?{from:e,to:u}:{from:o,to:e}:u?FC(e,u)?{from:u,to:e}:{from:e,to:u}:o?QF(e,o)?{from:e,to:o}:{from:o,to:e}:{from:e,to:void 0}}var QM=W.createContext(void 0);function Kte(e){if(!Q_(e.initialProps)){var t={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return S.jsx(QM.Provider,{value:t,children:e.children})}return S.jsx(Jte,{initialProps:e.initialProps,children:e.children})}function Jte(e){var t=e.initialProps,r=e.children,o=t.selected,u=o||{},m=u.from,_=u.to,b=t.min,s=t.max,k=function(H,J,U){var te,Q;(te=t.onDayClick)===null||te===void 0||te.call(t,H,J,U);var ee=Yte(H,o);(Q=t.onSelect)===null||Q===void 0||Q.call(t,ee,H,J,U)},O={range_start:[],range_end:[],range_middle:[],disabled:[]};if(m?(O.range_start=[m],_?(O.range_end=[_],Xs(m,_)||(O.range_middle=[{after:m,before:_}])):O.range_end=[m]):_&&(O.range_start=[_],O.range_end=[_]),b&&(m&&!_&&O.disabled.push({after:BT(m,b-1),before:Ns(m,b-1)}),m&&_&&O.disabled.push({after:m,before:Ns(m,b-1)}),!m&&_&&O.disabled.push({after:BT(_,b-1),before:Ns(_,b-1)})),s){if(m&&!_&&(O.disabled.push({before:Ns(m,-s+1)}),O.disabled.push({after:Ns(m,s-1)})),m&&_){var F=dl(_,m)+1,q=s-F;O.disabled.push({before:BT(m,q)}),O.disabled.push({after:Ns(_,q)})}!m&&_&&(O.disabled.push({before:Ns(_,-s+1)}),O.disabled.push({after:Ns(_,s-1)}))}return S.jsx(QM.Provider,{value:{selected:o,onDayClick:k,modifiers:O},children:r})}function eA(){var e=W.useContext(QM);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function Zv(e){return Array.isArray(e)?eB([],e):e!==void 0?[e]:[]}function Qte(e){var t={};return Object.entries(e).forEach(function(r){var o=r[0],u=r[1];t[o]=Zv(u)}),t}var ja;(function(e){e.Outside="outside",e.Disabled="disabled",e.Selected="selected",e.Hidden="hidden",e.Today="today",e.RangeStart="range_start",e.RangeEnd="range_end",e.RangeMiddle="range_middle"})(ja||(ja={}));var ene=ja.Selected,Wl=ja.Disabled,tne=ja.Hidden,nne=ja.Today,UT=ja.RangeEnd,$T=ja.RangeMiddle,GT=ja.RangeStart,rne=ja.Outside;function ine(e,t,r){var o,u=(o={},o[ene]=Zv(e.selected),o[Wl]=Zv(e.disabled),o[tne]=Zv(e.hidden),o[nne]=[e.today],o[UT]=[],o[$T]=[],o[GT]=[],o[rne]=[],o);return e.fromDate&&u[Wl].push({before:e.fromDate}),e.toDate&&u[Wl].push({after:e.toDate}),J_(e)?u[Wl]=u[Wl].concat(t.modifiers[Wl]):Q_(e)&&(u[Wl]=u[Wl].concat(r.modifiers[Wl]),u[GT]=r.modifiers[GT],u[$T]=r.modifiers[$T],u[UT]=r.modifiers[UT]),u}var sB=W.createContext(void 0);function sne(e){var t=Gr(),r=JM(),o=eA(),u=ine(t,r,o),m=Qte(t.modifiers),_=Ln(Ln({},u),m);return S.jsx(sB.Provider,{value:_,children:e.children})}function oB(){var e=W.useContext(sB);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function one(e){return!!(e&&typeof e=="object"&&"before"in e&&"after"in e)}function ane(e){return!!(e&&typeof e=="object"&&"from"in e)}function lne(e){return!!(e&&typeof e=="object"&&"after"in e)}function cne(e){return!!(e&&typeof e=="object"&&"before"in e)}function une(e){return!!(e&&typeof e=="object"&&"dayOfWeek"in e)}function dne(e,t){var r,o=t.from,u=t.to;if(o&&u){var m=dl(u,o)<0;m&&(r=[u,o],o=r[0],u=r[1]);var _=dl(e,o)>=0&&dl(u,e)>=0;return _}return u?Xs(u,e):o?Xs(o,e):!1}function hne(e){return qM(e)}function fne(e){return Array.isArray(e)&&e.every(qM)}function pne(e,t){return t.some(function(r){if(typeof r=="boolean")return r;if(hne(r))return Xs(e,r);if(fne(r))return r.includes(e);if(ane(r))return dne(e,r);if(une(r))return r.dayOfWeek.includes(e.getDay());if(one(r)){var o=dl(r.before,e),u=dl(r.after,e),m=o>0,_=u<0,b=FC(r.before,r.after);return b?_&&m:m||_}return lne(r)?dl(e,r.after)>0:cne(r)?dl(r.before,e)>0:typeof r=="function"?r(e):!1})}function tA(e,t,r){var o=Object.keys(t).reduce(function(m,_){var b=t[_];return pne(e,b)&&m.push(_),m},[]),u={};return o.forEach(function(m){return u[m]=!0}),r&&!YM(e,r)&&(u.outside=!0),u}function mne(e,t){for(var r=to(e[0]),o=ZM(e[e.length-1]),u,m,_=r;_<=o;){var b=tA(_,t),s=!b.disabled&&!b.hidden;if(!s){_=Ns(_,1);continue}if(b.selected)return _;b.today&&!m&&(m=_),u||(u=_),_=Ns(_,1)}return m||u}var gne=365;function aB(e,t){var r=t.moveBy,o=t.direction,u=t.context,m=t.modifiers,_=t.retry,b=_===void 0?{count:0,lastFocused:e}:_,s=u.weekStartsOn,k=u.fromDate,O=u.toDate,F=u.locale,q={day:Ns,week:zC,month:Oa,year:iee,startOfWeek:function(te){return u.ISOWeek?Nh(te):yl(te,{locale:F,weekStartsOn:s})},endOfWeek:function(te){return u.ISOWeek?qF(te):XM(te,{locale:F,weekStartsOn:s})}},H=q[r](e,o==="after"?1:-1);o==="before"&&k?H=see([k,H]):o==="after"&&O&&(H=oee([O,H]));var J=!0;if(m){var U=tA(H,m);J=!U.disabled&&!U.hidden}return J?H:b.count>gne?b.lastFocused:aB(H,{moveBy:r,direction:o,context:u,modifiers:m,retry:Ln(Ln({},b),{count:b.count+1})})}var lB=W.createContext(void 0);function yne(e){var t=ex(),r=oB(),o=W.useState(),u=o[0],m=o[1],_=W.useState(),b=_[0],s=_[1],k=mne(t.displayMonths,r),O=u??(b&&t.isDateDisplayed(b))?b:k,F=function(){s(u),m(void 0)},q=function(te){m(te)},H=Gr(),J=function(te,Q){if(u){var ee=aB(u,{moveBy:te,direction:Q,context:H,modifiers:r});Xs(u,ee)||(t.goToDate(ee,u),q(ee))}},U={focusedDay:u,focusTarget:O,blur:F,focus:q,focusDayAfter:function(){return J("day","after")},focusDayBefore:function(){return J("day","before")},focusWeekAfter:function(){return J("week","after")},focusWeekBefore:function(){return J("week","before")},focusMonthBefore:function(){return J("month","before")},focusMonthAfter:function(){return J("month","after")},focusYearBefore:function(){return J("year","before")},focusYearAfter:function(){return J("year","after")},focusStartOfWeek:function(){return J("startOfWeek","before")},focusEndOfWeek:function(){return J("endOfWeek","after")}};return S.jsx(lB.Provider,{value:U,children:e.children})}function nA(){var e=W.useContext(lB);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}function _ne(e,t){var r=oB(),o=tA(e,r,t);return o}var rA=W.createContext(void 0);function xne(e){if(!Db(e.initialProps)){var t={selected:void 0};return S.jsx(rA.Provider,{value:t,children:e.children})}return S.jsx(vne,{initialProps:e.initialProps,children:e.children})}function vne(e){var t=e.initialProps,r=e.children,o=function(m,_,b){var s,k,O;if((s=t.onDayClick)===null||s===void 0||s.call(t,m,_,b),_.selected&&!t.required){(k=t.onSelect)===null||k===void 0||k.call(t,void 0,m,_,b);return}(O=t.onSelect)===null||O===void 0||O.call(t,m,m,_,b)},u={selected:t.selected,onDayClick:o};return S.jsx(rA.Provider,{value:u,children:r})}function cB(){var e=W.useContext(rA);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function bne(e,t){var r=Gr(),o=cB(),u=JM(),m=eA(),_=nA(),b=_.focusDayAfter,s=_.focusDayBefore,k=_.focusWeekAfter,O=_.focusWeekBefore,F=_.blur,q=_.focus,H=_.focusMonthBefore,J=_.focusMonthAfter,U=_.focusYearBefore,te=_.focusYearAfter,Q=_.focusStartOfWeek,ee=_.focusEndOfWeek,re=function(Et){var tt,Ft,St,hn;Db(r)?(tt=o.onDayClick)===null||tt===void 0||tt.call(o,e,t,Et):J_(r)?(Ft=u.onDayClick)===null||Ft===void 0||Ft.call(u,e,t,Et):Q_(r)?(St=m.onDayClick)===null||St===void 0||St.call(m,e,t,Et):(hn=r.onDayClick)===null||hn===void 0||hn.call(r,e,t,Et)},xe=function(Et){var tt;q(e),(tt=r.onDayFocus)===null||tt===void 0||tt.call(r,e,t,Et)},Ee=function(Et){var tt;F(),(tt=r.onDayBlur)===null||tt===void 0||tt.call(r,e,t,Et)},He=function(Et){var tt;(tt=r.onDayMouseEnter)===null||tt===void 0||tt.call(r,e,t,Et)},qe=function(Et){var tt;(tt=r.onDayMouseLeave)===null||tt===void 0||tt.call(r,e,t,Et)},Ne=function(Et){var tt;(tt=r.onDayPointerEnter)===null||tt===void 0||tt.call(r,e,t,Et)},ft=function(Et){var tt;(tt=r.onDayPointerLeave)===null||tt===void 0||tt.call(r,e,t,Et)},ut=function(Et){var tt;(tt=r.onDayTouchCancel)===null||tt===void 0||tt.call(r,e,t,Et)},mt=function(Et){var tt;(tt=r.onDayTouchEnd)===null||tt===void 0||tt.call(r,e,t,Et)},pt=function(Et){var tt;(tt=r.onDayTouchMove)===null||tt===void 0||tt.call(r,e,t,Et)},en=function(Et){var tt;(tt=r.onDayTouchStart)===null||tt===void 0||tt.call(r,e,t,Et)},Yt=function(Et){var tt;(tt=r.onDayKeyUp)===null||tt===void 0||tt.call(r,e,t,Et)},dn=function(Et){var tt;switch(Et.key){case"ArrowLeft":Et.preventDefault(),Et.stopPropagation(),r.dir==="rtl"?b():s();break;case"ArrowRight":Et.preventDefault(),Et.stopPropagation(),r.dir==="rtl"?s():b();break;case"ArrowDown":Et.preventDefault(),Et.stopPropagation(),k();break;case"ArrowUp":Et.preventDefault(),Et.stopPropagation(),O();break;case"PageUp":Et.preventDefault(),Et.stopPropagation(),Et.shiftKey?U():H();break;case"PageDown":Et.preventDefault(),Et.stopPropagation(),Et.shiftKey?te():J();break;case"Home":Et.preventDefault(),Et.stopPropagation(),Q();break;case"End":Et.preventDefault(),Et.stopPropagation(),ee();break}(tt=r.onDayKeyDown)===null||tt===void 0||tt.call(r,e,t,Et)},It={onClick:re,onFocus:xe,onBlur:Ee,onKeyDown:dn,onKeyUp:Yt,onMouseEnter:He,onMouseLeave:qe,onPointerEnter:Ne,onPointerLeave:ft,onTouchCancel:ut,onTouchEnd:mt,onTouchMove:pt,onTouchStart:en};return It}function wne(){var e=Gr(),t=cB(),r=JM(),o=eA(),u=Db(e)?t.selected:J_(e)?r.selected:Q_(e)?o.selected:void 0;return u}function Sne(e){return Object.values(ja).includes(e)}function Tne(e,t){var r=[e.classNames.day];return Object.keys(t).forEach(function(o){var u=e.modifiersClassNames[o];if(u)r.push(u);else if(Sne(o)){var m=e.classNames["day_".concat(o)];m&&r.push(m)}}),r}function Ene(e,t){var r=Ln({},e.styles.day);return Object.keys(t).forEach(function(o){var u;r=Ln(Ln({},r),(u=e.modifiersStyles)===null||u===void 0?void 0:u[o])}),r}function Cne(e,t,r){var o,u,m,_=Gr(),b=nA(),s=_ne(e,t),k=bne(e,s),O=wne(),F=!!(_.onDayClick||_.mode!=="default");W.useEffect(function(){var He;s.outside||b.focusedDay&&F&&Xs(b.focusedDay,e)&&((He=r.current)===null||He===void 0||He.focus())},[b.focusedDay,e,r,F,s.outside]);var q=Tne(_,s).join(" "),H=Ene(_,s),J=!!(s.outside&&!_.showOutsideDays||s.hidden),U=(m=(u=_.components)===null||u===void 0?void 0:u.DayContent)!==null&&m!==void 0?m:qte,te=S.jsx(U,{date:e,displayMonth:t,activeModifiers:s}),Q={style:H,className:q,children:te,role:"gridcell"},ee=b.focusTarget&&Xs(b.focusTarget,e)&&!s.outside,re=b.focusedDay&&Xs(b.focusedDay,e),xe=Ln(Ln(Ln({},Q),(o={disabled:s.disabled,role:"gridcell"},o["aria-selected"]=s.selected,o.tabIndex=re||ee?0:-1,o)),k),Ee={isButton:F,isHidden:J,activeModifiers:s,selectedDays:O,buttonProps:xe,divProps:Q};return Ee}function Pne(e){var t=W.useRef(null),r=Cne(e.date,e.displayMonth,t);return r.isHidden?S.jsx("div",{role:"gridcell"}):r.isButton?S.jsx(V1,Ln({name:"day",ref:t},r.buttonProps)):S.jsx("div",Ln({},r.divProps))}function Mne(e){var t=e.number,r=e.dates,o=Gr(),u=o.onWeekNumberClick,m=o.styles,_=o.classNames,b=o.locale,s=o.labels.labelWeekNumber,k=o.formatters.formatWeekNumber,O=k(Number(t),{locale:b});if(!u)return S.jsx("span",{className:_.weeknumber,style:m.weeknumber,children:O});var F=s(Number(t),{locale:b}),q=function(H){u(t,r,H)};return S.jsx(V1,{name:"week-number","aria-label":F,className:_.weeknumber,style:m.weeknumber,onClick:q,children:O})}function Ane(e){var t,r,o=Gr(),u=o.styles,m=o.classNames,_=o.showWeekNumber,b=o.components,s=(t=b==null?void 0:b.Day)!==null&&t!==void 0?t:Pne,k=(r=b==null?void 0:b.WeekNumber)!==null&&r!==void 0?r:Mne,O;return _&&(O=S.jsx("td",{className:m.cell,style:u.cell,children:S.jsx(k,{number:e.weekNumber,dates:e.dates})})),S.jsxs("tr",{className:m.row,style:u.row,children:[O,e.dates.map(function(F){return S.jsx("td",{className:m.cell,style:u.cell,role:"presentation",children:S.jsx(s,{displayMonth:e.displayMonth,date:F})},ste(F))})]})}function SO(e,t,r){for(var o=r!=null&&r.ISOWeek?qF(t):XM(t,r),u=r!=null&&r.ISOWeek?Nh(e):yl(e,r),m=dl(o,u),_=[],b=0;b<=m;b++)_.push(Ns(u,b));var s=_.reduce(function(k,O){var F=r!=null&&r.ISOWeek?XF(O):KF(O,r),q=k.find(function(H){return H.weekNumber===F});return q?(q.dates.push(O),k):(k.push({weekNumber:F,dates:[O]}),k)},[]);return s}function Ine(e,t){var r=SO(to(e),ZM(e),t);if(t!=null&&t.useFixedWeeks){var o=ate(e,t);if(o<6){var u=r[r.length-1],m=u.dates[u.dates.length-1],_=zC(m,6-o),b=SO(zC(m,1),_,t);r.push.apply(r,b)}}return r}function Dne(e){var t,r,o,u=Gr(),m=u.locale,_=u.classNames,b=u.styles,s=u.hideHead,k=u.fixedWeeks,O=u.components,F=u.weekStartsOn,q=u.firstWeekContainsDate,H=u.ISOWeek,J=Ine(e.displayMonth,{useFixedWeeks:!!k,ISOWeek:H,locale:m,weekStartsOn:F,firstWeekContainsDate:q}),U=(t=O==null?void 0:O.Head)!==null&&t!==void 0?t:Hte,te=(r=O==null?void 0:O.Row)!==null&&r!==void 0?r:Ane,Q=(o=O==null?void 0:O.Footer)!==null&&o!==void 0?o:$te;return S.jsxs("table",{id:e.id,className:_.table,style:b.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!s&&S.jsx(U,{}),S.jsx("tbody",{className:_.tbody,style:b.tbody,children:J.map(function(ee){return S.jsx(te,{displayMonth:e.displayMonth,dates:ee.dates,weekNumber:ee.weekNumber},ee.weekNumber)})}),S.jsx(Q,{displayMonth:e.displayMonth})]})}function Rne(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var kne=Rne()?W.useLayoutEffect:W.useEffect,WT=!1,Nne=0;function TO(){return"react-day-picker-".concat(++Nne)}function Lne(e){var t,r=e??(WT?TO():null),o=W.useState(r),u=o[0],m=o[1];return kne(function(){u===null&&m(TO())},[]),W.useEffect(function(){WT===!1&&(WT=!0)},[]),(t=e??u)!==null&&t!==void 0?t:void 0}function One(e){var t,r,o=Gr(),u=o.dir,m=o.classNames,_=o.styles,b=o.components,s=ex().displayMonths,k=Lne(o.id?"".concat(o.id,"-").concat(e.displayIndex):void 0),O=o.id?"".concat(o.id,"-grid-").concat(e.displayIndex):void 0,F=[m.month],q=_.month,H=e.displayIndex===0,J=e.displayIndex===s.length-1,U=!H&&!J;u==="rtl"&&(t=[H,J],J=t[0],H=t[1]),H&&(F.push(m.caption_start),q=Ln(Ln({},q),_.caption_start)),J&&(F.push(m.caption_end),q=Ln(Ln({},q),_.caption_end)),U&&(F.push(m.caption_between),q=Ln(Ln({},q),_.caption_between));var te=(r=b==null?void 0:b.Caption)!==null&&r!==void 0?r:Ute;return S.jsxs("div",{className:F.join(" "),style:q,children:[S.jsx(te,{id:k,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),S.jsx(Dne,{id:O,"aria-labelledby":k,displayMonth:e.displayMonth})]},e.displayIndex)}function jne(e){var t=Gr(),r=t.classNames,o=t.styles;return S.jsx("div",{className:r.months,style:o.months,children:e.children})}function zne(e){var t,r,o=e.initialProps,u=Gr(),m=nA(),_=ex(),b=W.useState(!1),s=b[0],k=b[1];W.useEffect(function(){u.initialFocus&&m.focusTarget&&(s||(m.focus(m.focusTarget),k(!0)))},[u.initialFocus,s,m.focus,m.focusTarget,m]);var O=[u.classNames.root,u.className];u.numberOfMonths>1&&O.push(u.classNames.multiple_months),u.showWeekNumber&&O.push(u.classNames.with_weeknumber);var F=Ln(Ln({},u.styles.root),u.style),q=Object.keys(o).filter(function(J){return J.startsWith("data-")}).reduce(function(J,U){var te;return Ln(Ln({},J),(te={},te[U]=o[U],te))},{}),H=(r=(t=o.components)===null||t===void 0?void 0:t.Months)!==null&&r!==void 0?r:jne;return S.jsx("div",Ln({className:O.join(" "),style:F,dir:u.dir,id:u.id,nonce:o.nonce,title:o.title,lang:o.lang},q,{children:S.jsx(H,{children:_.displayMonths.map(function(J,U){return S.jsx(One,{displayIndex:U,displayMonth:J},U)})})}))}function Fne(e){var t=e.children,r=cte(e,["children"]);return S.jsx(Mte,{initialProps:r,children:S.jsx(zte,{children:S.jsx(xne,{initialProps:r,children:S.jsx(Zte,{initialProps:r,children:S.jsx(Kte,{initialProps:r,children:S.jsx(sne,{children:S.jsx(yne,{children:t})})})})})})})}function Bne(e){return S.jsx(Fne,Ln({},e,{children:S.jsx(zne,{initialProps:e})}))}function uB(e){var t,r,o="";if(typeof e=="string"||typeof e=="number")o+=e;else if(typeof e=="object")if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(r=uB(e[t]))&&(o&&(o+=" "),o+=r);else for(t in e)e[t]&&(o&&(o+=" "),o+=t);return o}function Vne(){for(var e,t,r=0,o="";r<arguments.length;)(e=arguments[r++])&&(t=uB(e))&&(o&&(o+=" "),o+=t);return o}const EO=e=>typeof e=="boolean"?"".concat(e):e===0?"0":e,CO=Vne,dB=(e,t)=>r=>{var o;if((t==null?void 0:t.variants)==null)return CO(e,r==null?void 0:r.class,r==null?void 0:r.className);const{variants:u,defaultVariants:m}=t,_=Object.keys(u).map(k=>{const O=r==null?void 0:r[k],F=m==null?void 0:m[k];if(O===null)return null;const q=EO(O)||EO(F);return u[k][q]}),b=r&&Object.entries(r).reduce((k,O)=>{let[F,q]=O;return q===void 0||(k[F]=q),k},{}),s=t==null||(o=t.compoundVariants)===null||o===void 0?void 0:o.reduce((k,O)=>{let{class:F,className:q,...H}=O;return Object.entries(H).every(J=>{let[U,te]=J;return Array.isArray(te)?te.includes({...m,...b}[U]):{...m,...b}[U]===te})?[...k,F,q]:k},[]);return CO(e,_,s,r==null?void 0:r.class,r==null?void 0:r.className)},R_=dB("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Pn=W.forwardRef(({className:e,variant:t,size:r,asChild:o=!1,...u},m)=>{const _=o?dc:"button";return S.jsx(_,{className:Zn(R_({variant:t,size:r,className:e})),ref:m,...u})});Pn.displayName="Button";function Lh({className:e,classNames:t,showOutsideDays:r=!0,...o}){return S.jsx(Bne,{showOutsideDays:r,className:Zn("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:Zn(R_({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:Zn(R_({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:()=>S.jsx(YQ,{className:"h-4 w-4"}),IconRight:()=>S.jsx(KQ,{className:"h-4 w-4"})},...o})}Lh.displayName="Calendar";function Une(e,t=[]){let r=[];function o(m,_){const b=W.createContext(_),s=r.length;r=[...r,_];function k(F){const{scope:q,children:H,...J}=F,U=(q==null?void 0:q[e][s])||b,te=W.useMemo(()=>J,Object.values(J));return S.jsx(U.Provider,{value:te,children:H})}function O(F,q){const H=(q==null?void 0:q[e][s])||b,J=W.useContext(H);if(J)return J;if(_!==void 0)return _;throw new Error(`\`${F}\` must be used within \`${m}\``)}return k.displayName=m+"Provider",[k,O]}const u=()=>{const m=r.map(_=>W.createContext(_));return function(b){const s=(b==null?void 0:b[e])||m;return W.useMemo(()=>({[`__scope${e}`]:{...b,[e]:s}}),[b,s])}};return u.scopeName=e,[o,$ne(u,...t)]}function $ne(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const o=e.map(u=>({useScope:u(),scopeName:u.scopeName}));return function(m){const _=o.reduce((b,{useScope:s,scopeName:k})=>{const F=s(m)[`__scope${k}`];return{...b,...F}},{});return W.useMemo(()=>({[`__scope${t.scopeName}`]:_}),[_])}};return r.scopeName=t.scopeName,r}function hB(e,t=globalThis==null?void 0:globalThis.document){const r=ra(e);W.useEffect(()=>{const o=u=>{u.key==="Escape"&&r(u)};return t.addEventListener("keydown",o,{capture:!0}),()=>t.removeEventListener("keydown",o,{capture:!0})},[r,t])}var Gne="DismissableLayer",BC="dismissableLayer.update",Wne="dismissableLayer.pointerDownOutside",Hne="dismissableLayer.focusOutside",PO,fB=W.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Rb=W.forwardRef((e,t)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:o,onPointerDownOutside:u,onFocusOutside:m,onInteractOutside:_,onDismiss:b,...s}=e,k=W.useContext(fB),[O,F]=W.useState(null),q=(O==null?void 0:O.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,H]=W.useState({}),J=gr(t,qe=>F(qe)),U=Array.from(k.layers),[te]=[...k.layersWithOutsidePointerEventsDisabled].slice(-1),Q=U.indexOf(te),ee=O?U.indexOf(O):-1,re=k.layersWithOutsidePointerEventsDisabled.size>0,xe=ee>=Q,Ee=Xne(qe=>{const Ne=qe.target,ft=[...k.branches].some(ut=>ut.contains(Ne));!xe||ft||(u==null||u(qe),_==null||_(qe),qe.defaultPrevented||b==null||b())},q),He=Yne(qe=>{const Ne=qe.target;[...k.branches].some(ut=>ut.contains(Ne))||(m==null||m(qe),_==null||_(qe),qe.defaultPrevented||b==null||b())},q);return hB(qe=>{ee===k.layers.size-1&&(o==null||o(qe),!qe.defaultPrevented&&b&&(qe.preventDefault(),b()))},q),W.useEffect(()=>{if(O)return r&&(k.layersWithOutsidePointerEventsDisabled.size===0&&(PO=q.body.style.pointerEvents,q.body.style.pointerEvents="none"),k.layersWithOutsidePointerEventsDisabled.add(O)),k.layers.add(O),MO(),()=>{r&&k.layersWithOutsidePointerEventsDisabled.size===1&&(q.body.style.pointerEvents=PO)}},[O,q,r,k]),W.useEffect(()=>()=>{O&&(k.layers.delete(O),k.layersWithOutsidePointerEventsDisabled.delete(O),MO())},[O,k]),W.useEffect(()=>{const qe=()=>H({});return document.addEventListener(BC,qe),()=>document.removeEventListener(BC,qe)},[]),S.jsx(jn.div,{...s,ref:J,style:{pointerEvents:re?xe?"auto":"none":void 0,...e.style},onFocusCapture:In(e.onFocusCapture,He.onFocusCapture),onBlurCapture:In(e.onBlurCapture,He.onBlurCapture),onPointerDownCapture:In(e.onPointerDownCapture,Ee.onPointerDownCapture)})});Rb.displayName=Gne;var qne="DismissableLayerBranch",Zne=W.forwardRef((e,t)=>{const r=W.useContext(fB),o=W.useRef(null),u=gr(t,o);return W.useEffect(()=>{const m=o.current;if(m)return r.branches.add(m),()=>{r.branches.delete(m)}},[r.branches]),S.jsx(jn.div,{...e,ref:u})});Zne.displayName=qne;function Xne(e,t=globalThis==null?void 0:globalThis.document){const r=ra(e),o=W.useRef(!1),u=W.useRef(()=>{});return W.useEffect(()=>{const m=b=>{if(b.target&&!o.current){let s=function(){pB(Wne,r,k,{discrete:!0})};const k={originalEvent:b};b.pointerType==="touch"?(t.removeEventListener("click",u.current),u.current=s,t.addEventListener("click",u.current,{once:!0})):s()}else t.removeEventListener("click",u.current);o.current=!1},_=window.setTimeout(()=>{t.addEventListener("pointerdown",m)},0);return()=>{window.clearTimeout(_),t.removeEventListener("pointerdown",m),t.removeEventListener("click",u.current)}},[t,r]),{onPointerDownCapture:()=>o.current=!0}}function Yne(e,t=globalThis==null?void 0:globalThis.document){const r=ra(e),o=W.useRef(!1);return W.useEffect(()=>{const u=m=>{m.target&&!o.current&&pB(Hne,r,{originalEvent:m},{discrete:!1})};return t.addEventListener("focusin",u),()=>t.removeEventListener("focusin",u)},[t,r]),{onFocusCapture:()=>o.current=!0,onBlurCapture:()=>o.current=!1}}function MO(){const e=new CustomEvent(BC);document.dispatchEvent(e)}function pB(e,t,r,{discrete:o}){const u=r.originalEvent.target,m=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&u.addEventListener(e,t,{once:!0}),o?pF(u,m):u.dispatchEvent(m)}var HT=0;function iA(){W.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??AO()),document.body.insertAdjacentElement("beforeend",e[1]??AO()),HT++,()=>{HT===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),HT--}},[])}function AO(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",e}var qT="focusScope.autoFocusOnMount",ZT="focusScope.autoFocusOnUnmount",IO={bubbles:!1,cancelable:!0},Kne="FocusScope",tx=W.forwardRef((e,t)=>{const{loop:r=!1,trapped:o=!1,onMountAutoFocus:u,onUnmountAutoFocus:m,..._}=e,[b,s]=W.useState(null),k=ra(u),O=ra(m),F=W.useRef(null),q=gr(t,U=>s(U)),H=W.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;W.useEffect(()=>{if(o){let U=function(re){if(H.paused||!b)return;const xe=re.target;b.contains(xe)?F.current=xe:Tu(F.current,{select:!0})},te=function(re){if(H.paused||!b)return;const xe=re.relatedTarget;xe!==null&&(b.contains(xe)||Tu(F.current,{select:!0}))},Q=function(re){if(document.activeElement===document.body)for(const Ee of re)Ee.removedNodes.length>0&&Tu(b)};document.addEventListener("focusin",U),document.addEventListener("focusout",te);const ee=new MutationObserver(Q);return b&&ee.observe(b,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",U),document.removeEventListener("focusout",te),ee.disconnect()}}},[o,b,H.paused]),W.useEffect(()=>{if(b){RO.add(H);const U=document.activeElement;if(!b.contains(U)){const Q=new CustomEvent(qT,IO);b.addEventListener(qT,k),b.dispatchEvent(Q),Q.defaultPrevented||(Jne(rre(mB(b)),{select:!0}),document.activeElement===U&&Tu(b))}return()=>{b.removeEventListener(qT,k),setTimeout(()=>{const Q=new CustomEvent(ZT,IO);b.addEventListener(ZT,O),b.dispatchEvent(Q),Q.defaultPrevented||Tu(U??document.body,{select:!0}),b.removeEventListener(ZT,O),RO.remove(H)},0)}}},[b,k,O,H]);const J=W.useCallback(U=>{if(!r&&!o||H.paused)return;const te=U.key==="Tab"&&!U.altKey&&!U.ctrlKey&&!U.metaKey,Q=document.activeElement;if(te&&Q){const ee=U.currentTarget,[re,xe]=Qne(ee);re&&xe?!U.shiftKey&&Q===xe?(U.preventDefault(),r&&Tu(re,{select:!0})):U.shiftKey&&Q===re&&(U.preventDefault(),r&&Tu(xe,{select:!0})):Q===ee&&U.preventDefault()}},[r,o,H.paused]);return S.jsx(jn.div,{tabIndex:-1,..._,ref:q,onKeyDown:J})});tx.displayName=Kne;function Jne(e,{select:t=!1}={}){const r=document.activeElement;for(const o of e)if(Tu(o,{select:t}),document.activeElement!==r)return}function Qne(e){const t=mB(e),r=DO(t,e),o=DO(t.reverse(),e);return[r,o]}function mB(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:o=>{const u=o.tagName==="INPUT"&&o.type==="hidden";return o.disabled||o.hidden||u?NodeFilter.FILTER_SKIP:o.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function DO(e,t){for(const r of e)if(!ere(r,{upTo:t}))return r}function ere(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function tre(e){return e instanceof HTMLInputElement&&"select"in e}function Tu(e,{select:t=!1}={}){if(e&&e.focus){const r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&tre(e)&&t&&e.select()}}var RO=nre();function nre(){let e=[];return{add(t){const r=e[0];t!==r&&(r==null||r.pause()),e=kO(e,t),e.unshift(t)},remove(t){var r;e=kO(e,t),(r=e[0])==null||r.resume()}}}function kO(e,t){const r=[...e],o=r.indexOf(t);return o!==-1&&r.splice(o,1),r}function rre(e){return e.filter(t=>t.tagName!=="A")}const ire=["top","right","bottom","left"],Hu=Math.min,_o=Math.max,U1=Math.round,yv=Math.floor,qu=e=>({x:e,y:e}),sre={left:"right",right:"left",bottom:"top",top:"bottom"},ore={start:"end",end:"start"};function VC(e,t,r){return _o(e,Hu(t,r))}function fc(e,t){return typeof e=="function"?e(t):e}function pc(e){return e.split("-")[0]}function bm(e){return e.split("-")[1]}function sA(e){return e==="x"?"y":"x"}function oA(e){return e==="y"?"height":"width"}function Zu(e){return["top","bottom"].includes(pc(e))?"y":"x"}function aA(e){return sA(Zu(e))}function are(e,t,r){r===void 0&&(r=!1);const o=bm(e),u=aA(e),m=oA(u);let _=u==="x"?o===(r?"end":"start")?"right":"left":o==="start"?"bottom":"top";return t.reference[m]>t.floating[m]&&(_=$1(_)),[_,$1(_)]}function lre(e){const t=$1(e);return[UC(e),t,UC(t)]}function UC(e){return e.replace(/start|end/g,t=>ore[t])}function cre(e,t,r){const o=["left","right"],u=["right","left"],m=["top","bottom"],_=["bottom","top"];switch(e){case"top":case"bottom":return r?t?u:o:t?o:u;case"left":case"right":return t?m:_;default:return[]}}function ure(e,t,r,o){const u=bm(e);let m=cre(pc(e),r==="start",o);return u&&(m=m.map(_=>_+"-"+u),t&&(m=m.concat(m.map(UC)))),m}function $1(e){return e.replace(/left|right|bottom|top/g,t=>sre[t])}function dre(e){return{top:0,right:0,bottom:0,left:0,...e}}function gB(e){return typeof e!="number"?dre(e):{top:e,right:e,bottom:e,left:e}}function G1(e){const{x:t,y:r,width:o,height:u}=e;return{width:o,height:u,top:r,left:t,right:t+o,bottom:r+u,x:t,y:r}}function NO(e,t,r){let{reference:o,floating:u}=e;const m=Zu(t),_=aA(t),b=oA(_),s=pc(t),k=m==="y",O=o.x+o.width/2-u.width/2,F=o.y+o.height/2-u.height/2,q=o[b]/2-u[b]/2;let H;switch(s){case"top":H={x:O,y:o.y-u.height};break;case"bottom":H={x:O,y:o.y+o.height};break;case"right":H={x:o.x+o.width,y:F};break;case"left":H={x:o.x-u.width,y:F};break;default:H={x:o.x,y:o.y}}switch(bm(t)){case"start":H[_]-=q*(r&&k?-1:1);break;case"end":H[_]+=q*(r&&k?-1:1);break}return H}const hre=async(e,t,r)=>{const{placement:o="bottom",strategy:u="absolute",middleware:m=[],platform:_}=r,b=m.filter(Boolean),s=await(_.isRTL==null?void 0:_.isRTL(t));let k=await _.getElementRects({reference:e,floating:t,strategy:u}),{x:O,y:F}=NO(k,o,s),q=o,H={},J=0;for(let U=0;U<b.length;U++){const{name:te,fn:Q}=b[U],{x:ee,y:re,data:xe,reset:Ee}=await Q({x:O,y:F,initialPlacement:o,placement:q,strategy:u,middlewareData:H,rects:k,platform:_,elements:{reference:e,floating:t}});O=ee??O,F=re??F,H={...H,[te]:{...H[te],...xe}},Ee&&J<=50&&(J++,typeof Ee=="object"&&(Ee.placement&&(q=Ee.placement),Ee.rects&&(k=Ee.rects===!0?await _.getElementRects({reference:e,floating:t,strategy:u}):Ee.rects),{x:O,y:F}=NO(k,q,s)),U=-1)}return{x:O,y:F,placement:q,strategy:u,middlewareData:H}};async function k_(e,t){var r;t===void 0&&(t={});const{x:o,y:u,platform:m,rects:_,elements:b,strategy:s}=e,{boundary:k="clippingAncestors",rootBoundary:O="viewport",elementContext:F="floating",altBoundary:q=!1,padding:H=0}=fc(t,e),J=gB(H),te=b[q?F==="floating"?"reference":"floating":F],Q=G1(await m.getClippingRect({element:(r=await(m.isElement==null?void 0:m.isElement(te)))==null||r?te:te.contextElement||await(m.getDocumentElement==null?void 0:m.getDocumentElement(b.floating)),boundary:k,rootBoundary:O,strategy:s})),ee=F==="floating"?{x:o,y:u,width:_.floating.width,height:_.floating.height}:_.reference,re=await(m.getOffsetParent==null?void 0:m.getOffsetParent(b.floating)),xe=await(m.isElement==null?void 0:m.isElement(re))?await(m.getScale==null?void 0:m.getScale(re))||{x:1,y:1}:{x:1,y:1},Ee=G1(m.convertOffsetParentRelativeRectToViewportRelativeRect?await m.convertOffsetParentRelativeRectToViewportRelativeRect({elements:b,rect:ee,offsetParent:re,strategy:s}):ee);return{top:(Q.top-Ee.top+J.top)/xe.y,bottom:(Ee.bottom-Q.bottom+J.bottom)/xe.y,left:(Q.left-Ee.left+J.left)/xe.x,right:(Ee.right-Q.right+J.right)/xe.x}}const fre=e=>({name:"arrow",options:e,async fn(t){const{x:r,y:o,placement:u,rects:m,platform:_,elements:b,middlewareData:s}=t,{element:k,padding:O=0}=fc(e,t)||{};if(k==null)return{};const F=gB(O),q={x:r,y:o},H=aA(u),J=oA(H),U=await _.getDimensions(k),te=H==="y",Q=te?"top":"left",ee=te?"bottom":"right",re=te?"clientHeight":"clientWidth",xe=m.reference[J]+m.reference[H]-q[H]-m.floating[J],Ee=q[H]-m.reference[H],He=await(_.getOffsetParent==null?void 0:_.getOffsetParent(k));let qe=He?He[re]:0;(!qe||!await(_.isElement==null?void 0:_.isElement(He)))&&(qe=b.floating[re]||m.floating[J]);const Ne=xe/2-Ee/2,ft=qe/2-U[J]/2-1,ut=Hu(F[Q],ft),mt=Hu(F[ee],ft),pt=ut,en=qe-U[J]-mt,Yt=qe/2-U[J]/2+Ne,dn=VC(pt,Yt,en),It=!s.arrow&&bm(u)!=null&&Yt!==dn&&m.reference[J]/2-(Yt<pt?ut:mt)-U[J]/2<0,Et=It?Yt<pt?Yt-pt:Yt-en:0;return{[H]:q[H]+Et,data:{[H]:dn,centerOffset:Yt-dn-Et,...It&&{alignmentOffset:Et}},reset:It}}}),pre=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var r,o;const{placement:u,middlewareData:m,rects:_,initialPlacement:b,platform:s,elements:k}=t,{mainAxis:O=!0,crossAxis:F=!0,fallbackPlacements:q,fallbackStrategy:H="bestFit",fallbackAxisSideDirection:J="none",flipAlignment:U=!0,...te}=fc(e,t);if((r=m.arrow)!=null&&r.alignmentOffset)return{};const Q=pc(u),ee=Zu(b),re=pc(b)===b,xe=await(s.isRTL==null?void 0:s.isRTL(k.floating)),Ee=q||(re||!U?[$1(b)]:lre(b)),He=J!=="none";!q&&He&&Ee.push(...ure(b,U,J,xe));const qe=[b,...Ee],Ne=await k_(t,te),ft=[];let ut=((o=m.flip)==null?void 0:o.overflows)||[];if(O&&ft.push(Ne[Q]),F){const Yt=are(u,_,xe);ft.push(Ne[Yt[0]],Ne[Yt[1]])}if(ut=[...ut,{placement:u,overflows:ft}],!ft.every(Yt=>Yt<=0)){var mt,pt;const Yt=(((mt=m.flip)==null?void 0:mt.index)||0)+1,dn=qe[Yt];if(dn)return{data:{index:Yt,overflows:ut},reset:{placement:dn}};let It=(pt=ut.filter(Et=>Et.overflows[0]<=0).sort((Et,tt)=>Et.overflows[1]-tt.overflows[1])[0])==null?void 0:pt.placement;if(!It)switch(H){case"bestFit":{var en;const Et=(en=ut.filter(tt=>{if(He){const Ft=Zu(tt.placement);return Ft===ee||Ft==="y"}return!0}).map(tt=>[tt.placement,tt.overflows.filter(Ft=>Ft>0).reduce((Ft,St)=>Ft+St,0)]).sort((tt,Ft)=>tt[1]-Ft[1])[0])==null?void 0:en[0];Et&&(It=Et);break}case"initialPlacement":It=b;break}if(u!==It)return{reset:{placement:It}}}return{}}}};function LO(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function OO(e){return ire.some(t=>e[t]>=0)}const mre=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:r}=t,{strategy:o="referenceHidden",...u}=fc(e,t);switch(o){case"referenceHidden":{const m=await k_(t,{...u,elementContext:"reference"}),_=LO(m,r.reference);return{data:{referenceHiddenOffsets:_,referenceHidden:OO(_)}}}case"escaped":{const m=await k_(t,{...u,altBoundary:!0}),_=LO(m,r.floating);return{data:{escapedOffsets:_,escaped:OO(_)}}}default:return{}}}}};async function gre(e,t){const{placement:r,platform:o,elements:u}=e,m=await(o.isRTL==null?void 0:o.isRTL(u.floating)),_=pc(r),b=bm(r),s=Zu(r)==="y",k=["left","top"].includes(_)?-1:1,O=m&&s?-1:1,F=fc(t,e);let{mainAxis:q,crossAxis:H,alignmentAxis:J}=typeof F=="number"?{mainAxis:F,crossAxis:0,alignmentAxis:null}:{mainAxis:F.mainAxis||0,crossAxis:F.crossAxis||0,alignmentAxis:F.alignmentAxis};return b&&typeof J=="number"&&(H=b==="end"?J*-1:J),s?{x:H*O,y:q*k}:{x:q*k,y:H*O}}const yre=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var r,o;const{x:u,y:m,placement:_,middlewareData:b}=t,s=await gre(t,e);return _===((r=b.offset)==null?void 0:r.placement)&&(o=b.arrow)!=null&&o.alignmentOffset?{}:{x:u+s.x,y:m+s.y,data:{...s,placement:_}}}}},_re=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:o,placement:u}=t,{mainAxis:m=!0,crossAxis:_=!1,limiter:b={fn:te=>{let{x:Q,y:ee}=te;return{x:Q,y:ee}}},...s}=fc(e,t),k={x:r,y:o},O=await k_(t,s),F=Zu(pc(u)),q=sA(F);let H=k[q],J=k[F];if(m){const te=q==="y"?"top":"left",Q=q==="y"?"bottom":"right",ee=H+O[te],re=H-O[Q];H=VC(ee,H,re)}if(_){const te=F==="y"?"top":"left",Q=F==="y"?"bottom":"right",ee=J+O[te],re=J-O[Q];J=VC(ee,J,re)}const U=b.fn({...t,[q]:H,[F]:J});return{...U,data:{x:U.x-r,y:U.y-o,enabled:{[q]:m,[F]:_}}}}}},xre=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:r,y:o,placement:u,rects:m,middlewareData:_}=t,{offset:b=0,mainAxis:s=!0,crossAxis:k=!0}=fc(e,t),O={x:r,y:o},F=Zu(u),q=sA(F);let H=O[q],J=O[F];const U=fc(b,t),te=typeof U=="number"?{mainAxis:U,crossAxis:0}:{mainAxis:0,crossAxis:0,...U};if(s){const re=q==="y"?"height":"width",xe=m.reference[q]-m.floating[re]+te.mainAxis,Ee=m.reference[q]+m.reference[re]-te.mainAxis;H<xe?H=xe:H>Ee&&(H=Ee)}if(k){var Q,ee;const re=q==="y"?"width":"height",xe=["top","left"].includes(pc(u)),Ee=m.reference[F]-m.floating[re]+(xe&&((Q=_.offset)==null?void 0:Q[F])||0)+(xe?0:te.crossAxis),He=m.reference[F]+m.reference[re]+(xe?0:((ee=_.offset)==null?void 0:ee[F])||0)-(xe?te.crossAxis:0);J<Ee?J=Ee:J>He&&(J=He)}return{[q]:H,[F]:J}}}},vre=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var r,o;const{placement:u,rects:m,platform:_,elements:b}=t,{apply:s=()=>{},...k}=fc(e,t),O=await k_(t,k),F=pc(u),q=bm(u),H=Zu(u)==="y",{width:J,height:U}=m.floating;let te,Q;F==="top"||F==="bottom"?(te=F,Q=q===(await(_.isRTL==null?void 0:_.isRTL(b.floating))?"start":"end")?"left":"right"):(Q=F,te=q==="end"?"top":"bottom");const ee=U-O.top-O.bottom,re=J-O.left-O.right,xe=Hu(U-O[te],ee),Ee=Hu(J-O[Q],re),He=!t.middlewareData.shift;let qe=xe,Ne=Ee;if((r=t.middlewareData.shift)!=null&&r.enabled.x&&(Ne=re),(o=t.middlewareData.shift)!=null&&o.enabled.y&&(qe=ee),He&&!q){const ut=_o(O.left,0),mt=_o(O.right,0),pt=_o(O.top,0),en=_o(O.bottom,0);H?Ne=J-2*(ut!==0||mt!==0?ut+mt:_o(O.left,O.right)):qe=U-2*(pt!==0||en!==0?pt+en:_o(O.top,O.bottom))}await s({...t,availableWidth:Ne,availableHeight:qe});const ft=await _.getDimensions(b.floating);return J!==ft.width||U!==ft.height?{reset:{rects:!0}}:{}}}};function kb(){return typeof window<"u"}function wm(e){return yB(e)?(e.nodeName||"").toLowerCase():"#document"}function Eo(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function vl(e){var t;return(t=(yB(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function yB(e){return kb()?e instanceof Node||e instanceof Eo(e).Node:!1}function za(e){return kb()?e instanceof Element||e instanceof Eo(e).Element:!1}function _l(e){return kb()?e instanceof HTMLElement||e instanceof Eo(e).HTMLElement:!1}function jO(e){return!kb()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Eo(e).ShadowRoot}function nx(e){const{overflow:t,overflowX:r,overflowY:o,display:u}=Fa(e);return/auto|scroll|overlay|hidden|clip/.test(t+o+r)&&!["inline","contents"].includes(u)}function bre(e){return["table","td","th"].includes(wm(e))}function Nb(e){return[":popover-open",":modal"].some(t=>{try{return e.matches(t)}catch{return!1}})}function lA(e){const t=cA(),r=za(e)?Fa(e):e;return r.transform!=="none"||r.perspective!=="none"||(r.containerType?r.containerType!=="normal":!1)||!t&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!t&&(r.filter?r.filter!=="none":!1)||["transform","perspective","filter"].some(o=>(r.willChange||"").includes(o))||["paint","layout","strict","content"].some(o=>(r.contain||"").includes(o))}function wre(e){let t=Xu(e);for(;_l(t)&&!om(t);){if(lA(t))return t;if(Nb(t))return null;t=Xu(t)}return null}function cA(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function om(e){return["html","body","#document"].includes(wm(e))}function Fa(e){return Eo(e).getComputedStyle(e)}function Lb(e){return za(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Xu(e){if(wm(e)==="html")return e;const t=e.assignedSlot||e.parentNode||jO(e)&&e.host||vl(e);return jO(t)?t.host:t}function _B(e){const t=Xu(e);return om(t)?e.ownerDocument?e.ownerDocument.body:e.body:_l(t)&&nx(t)?t:_B(t)}function N_(e,t,r){var o;t===void 0&&(t=[]),r===void 0&&(r=!0);const u=_B(e),m=u===((o=e.ownerDocument)==null?void 0:o.body),_=Eo(u);if(m){const b=$C(_);return t.concat(_,_.visualViewport||[],nx(u)?u:[],b&&r?N_(b):[])}return t.concat(u,N_(u,[],r))}function $C(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function xB(e){const t=Fa(e);let r=parseFloat(t.width)||0,o=parseFloat(t.height)||0;const u=_l(e),m=u?e.offsetWidth:r,_=u?e.offsetHeight:o,b=U1(r)!==m||U1(o)!==_;return b&&(r=m,o=_),{width:r,height:o,$:b}}function uA(e){return za(e)?e:e.contextElement}function Wp(e){const t=uA(e);if(!_l(t))return qu(1);const r=t.getBoundingClientRect(),{width:o,height:u,$:m}=xB(t);let _=(m?U1(r.width):r.width)/o,b=(m?U1(r.height):r.height)/u;return(!_||!Number.isFinite(_))&&(_=1),(!b||!Number.isFinite(b))&&(b=1),{x:_,y:b}}const Sre=qu(0);function vB(e){const t=Eo(e);return!cA()||!t.visualViewport?Sre:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function Tre(e,t,r){return t===void 0&&(t=!1),!r||t&&r!==Eo(e)?!1:t}function Oh(e,t,r,o){t===void 0&&(t=!1),r===void 0&&(r=!1);const u=e.getBoundingClientRect(),m=uA(e);let _=qu(1);t&&(o?za(o)&&(_=Wp(o)):_=Wp(e));const b=Tre(m,r,o)?vB(m):qu(0);let s=(u.left+b.x)/_.x,k=(u.top+b.y)/_.y,O=u.width/_.x,F=u.height/_.y;if(m){const q=Eo(m),H=o&&za(o)?Eo(o):o;let J=q,U=$C(J);for(;U&&o&&H!==J;){const te=Wp(U),Q=U.getBoundingClientRect(),ee=Fa(U),re=Q.left+(U.clientLeft+parseFloat(ee.paddingLeft))*te.x,xe=Q.top+(U.clientTop+parseFloat(ee.paddingTop))*te.y;s*=te.x,k*=te.y,O*=te.x,F*=te.y,s+=re,k+=xe,J=Eo(U),U=$C(J)}}return G1({width:O,height:F,x:s,y:k})}function Ere(e){let{elements:t,rect:r,offsetParent:o,strategy:u}=e;const m=u==="fixed",_=vl(o),b=t?Nb(t.floating):!1;if(o===_||b&&m)return r;let s={scrollLeft:0,scrollTop:0},k=qu(1);const O=qu(0),F=_l(o);if((F||!F&&!m)&&((wm(o)!=="body"||nx(_))&&(s=Lb(o)),_l(o))){const q=Oh(o);k=Wp(o),O.x=q.x+o.clientLeft,O.y=q.y+o.clientTop}return{width:r.width*k.x,height:r.height*k.y,x:r.x*k.x-s.scrollLeft*k.x+O.x,y:r.y*k.y-s.scrollTop*k.y+O.y}}function Cre(e){return Array.from(e.getClientRects())}function GC(e,t){const r=Lb(e).scrollLeft;return t?t.left+r:Oh(vl(e)).left+r}function Pre(e){const t=vl(e),r=Lb(e),o=e.ownerDocument.body,u=_o(t.scrollWidth,t.clientWidth,o.scrollWidth,o.clientWidth),m=_o(t.scrollHeight,t.clientHeight,o.scrollHeight,o.clientHeight);let _=-r.scrollLeft+GC(e);const b=-r.scrollTop;return Fa(o).direction==="rtl"&&(_+=_o(t.clientWidth,o.clientWidth)-u),{width:u,height:m,x:_,y:b}}function Mre(e,t){const r=Eo(e),o=vl(e),u=r.visualViewport;let m=o.clientWidth,_=o.clientHeight,b=0,s=0;if(u){m=u.width,_=u.height;const k=cA();(!k||k&&t==="fixed")&&(b=u.offsetLeft,s=u.offsetTop)}return{width:m,height:_,x:b,y:s}}function Are(e,t){const r=Oh(e,!0,t==="fixed"),o=r.top+e.clientTop,u=r.left+e.clientLeft,m=_l(e)?Wp(e):qu(1),_=e.clientWidth*m.x,b=e.clientHeight*m.y,s=u*m.x,k=o*m.y;return{width:_,height:b,x:s,y:k}}function zO(e,t,r){let o;if(t==="viewport")o=Mre(e,r);else if(t==="document")o=Pre(vl(e));else if(za(t))o=Are(t,r);else{const u=vB(e);o={...t,x:t.x-u.x,y:t.y-u.y}}return G1(o)}function bB(e,t){const r=Xu(e);return r===t||!za(r)||om(r)?!1:Fa(r).position==="fixed"||bB(r,t)}function Ire(e,t){const r=t.get(e);if(r)return r;let o=N_(e,[],!1).filter(b=>za(b)&&wm(b)!=="body"),u=null;const m=Fa(e).position==="fixed";let _=m?Xu(e):e;for(;za(_)&&!om(_);){const b=Fa(_),s=lA(_);!s&&b.position==="fixed"&&(u=null),(m?!s&&!u:!s&&b.position==="static"&&!!u&&["absolute","fixed"].includes(u.position)||nx(_)&&!s&&bB(e,_))?o=o.filter(O=>O!==_):u=b,_=Xu(_)}return t.set(e,o),o}function Dre(e){let{element:t,boundary:r,rootBoundary:o,strategy:u}=e;const _=[...r==="clippingAncestors"?Nb(t)?[]:Ire(t,this._c):[].concat(r),o],b=_[0],s=_.reduce((k,O)=>{const F=zO(t,O,u);return k.top=_o(F.top,k.top),k.right=Hu(F.right,k.right),k.bottom=Hu(F.bottom,k.bottom),k.left=_o(F.left,k.left),k},zO(t,b,u));return{width:s.right-s.left,height:s.bottom-s.top,x:s.left,y:s.top}}function Rre(e){const{width:t,height:r}=xB(e);return{width:t,height:r}}function kre(e,t,r){const o=_l(t),u=vl(t),m=r==="fixed",_=Oh(e,!0,m,t);let b={scrollLeft:0,scrollTop:0};const s=qu(0);if(o||!o&&!m)if((wm(t)!=="body"||nx(u))&&(b=Lb(t)),o){const H=Oh(t,!0,m,t);s.x=H.x+t.clientLeft,s.y=H.y+t.clientTop}else u&&(s.x=GC(u));let k=0,O=0;if(u&&!o&&!m){const H=u.getBoundingClientRect();O=H.top+b.scrollTop,k=H.left+b.scrollLeft-GC(u,H)}const F=_.left+b.scrollLeft-s.x-k,q=_.top+b.scrollTop-s.y-O;return{x:F,y:q,width:_.width,height:_.height}}function XT(e){return Fa(e).position==="static"}function FO(e,t){if(!_l(e)||Fa(e).position==="fixed")return null;if(t)return t(e);let r=e.offsetParent;return vl(e)===r&&(r=r.ownerDocument.body),r}function wB(e,t){const r=Eo(e);if(Nb(e))return r;if(!_l(e)){let u=Xu(e);for(;u&&!om(u);){if(za(u)&&!XT(u))return u;u=Xu(u)}return r}let o=FO(e,t);for(;o&&bre(o)&&XT(o);)o=FO(o,t);return o&&om(o)&&XT(o)&&!lA(o)?r:o||wre(e)||r}const Nre=async function(e){const t=this.getOffsetParent||wB,r=this.getDimensions,o=await r(e.floating);return{reference:kre(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:o.width,height:o.height}}};function Lre(e){return Fa(e).direction==="rtl"}const Ore={convertOffsetParentRelativeRectToViewportRelativeRect:Ere,getDocumentElement:vl,getClippingRect:Dre,getOffsetParent:wB,getElementRects:Nre,getClientRects:Cre,getDimensions:Rre,getScale:Wp,isElement:za,isRTL:Lre};function jre(e,t){let r=null,o;const u=vl(e);function m(){var b;clearTimeout(o),(b=r)==null||b.disconnect(),r=null}function _(b,s){b===void 0&&(b=!1),s===void 0&&(s=1),m();const{left:k,top:O,width:F,height:q}=e.getBoundingClientRect();if(b||t(),!F||!q)return;const H=yv(O),J=yv(u.clientWidth-(k+F)),U=yv(u.clientHeight-(O+q)),te=yv(k),ee={rootMargin:-H+"px "+-J+"px "+-U+"px "+-te+"px",threshold:_o(0,Hu(1,s))||1};let re=!0;function xe(Ee){const He=Ee[0].intersectionRatio;if(He!==s){if(!re)return _();He?_(!1,He):o=setTimeout(()=>{_(!1,1e-7)},1e3)}re=!1}try{r=new IntersectionObserver(xe,{...ee,root:u.ownerDocument})}catch{r=new IntersectionObserver(xe,ee)}r.observe(e)}return _(!0),m}function zre(e,t,r,o){o===void 0&&(o={});const{ancestorScroll:u=!0,ancestorResize:m=!0,elementResize:_=typeof ResizeObserver=="function",layoutShift:b=typeof IntersectionObserver=="function",animationFrame:s=!1}=o,k=uA(e),O=u||m?[...k?N_(k):[],...N_(t)]:[];O.forEach(Q=>{u&&Q.addEventListener("scroll",r,{passive:!0}),m&&Q.addEventListener("resize",r)});const F=k&&b?jre(k,r):null;let q=-1,H=null;_&&(H=new ResizeObserver(Q=>{let[ee]=Q;ee&&ee.target===k&&H&&(H.unobserve(t),cancelAnimationFrame(q),q=requestAnimationFrame(()=>{var re;(re=H)==null||re.observe(t)})),r()}),k&&!s&&H.observe(k),H.observe(t));let J,U=s?Oh(e):null;s&&te();function te(){const Q=Oh(e);U&&(Q.x!==U.x||Q.y!==U.y||Q.width!==U.width||Q.height!==U.height)&&r(),U=Q,J=requestAnimationFrame(te)}return r(),()=>{var Q;O.forEach(ee=>{u&&ee.removeEventListener("scroll",r),m&&ee.removeEventListener("resize",r)}),F==null||F(),(Q=H)==null||Q.disconnect(),H=null,s&&cancelAnimationFrame(J)}}const Fre=yre,Bre=_re,Vre=pre,Ure=vre,$re=mre,BO=fre,Gre=xre,Wre=(e,t,r)=>{const o=new Map,u={platform:Ore,...r},m={...u.platform,_c:o};return hre(e,t,{...u,platform:m})};var Xv=typeof document<"u"?W.useLayoutEffect:W.useEffect;function W1(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let r,o,u;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(o=r;o--!==0;)if(!W1(e[o],t[o]))return!1;return!0}if(u=Object.keys(e),r=u.length,r!==Object.keys(t).length)return!1;for(o=r;o--!==0;)if(!{}.hasOwnProperty.call(t,u[o]))return!1;for(o=r;o--!==0;){const m=u[o];if(!(m==="_owner"&&e.$$typeof)&&!W1(e[m],t[m]))return!1}return!0}return e!==e&&t!==t}function SB(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function VO(e,t){const r=SB(e);return Math.round(t*r)/r}function YT(e){const t=W.useRef(e);return Xv(()=>{t.current=e}),t}function Hre(e){e===void 0&&(e={});const{placement:t="bottom",strategy:r="absolute",middleware:o=[],platform:u,elements:{reference:m,floating:_}={},transform:b=!0,whileElementsMounted:s,open:k}=e,[O,F]=W.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[q,H]=W.useState(o);W1(q,o)||H(o);const[J,U]=W.useState(null),[te,Q]=W.useState(null),ee=W.useCallback(tt=>{tt!==He.current&&(He.current=tt,U(tt))},[]),re=W.useCallback(tt=>{tt!==qe.current&&(qe.current=tt,Q(tt))},[]),xe=m||J,Ee=_||te,He=W.useRef(null),qe=W.useRef(null),Ne=W.useRef(O),ft=s!=null,ut=YT(s),mt=YT(u),pt=YT(k),en=W.useCallback(()=>{if(!He.current||!qe.current)return;const tt={placement:t,strategy:r,middleware:q};mt.current&&(tt.platform=mt.current),Wre(He.current,qe.current,tt).then(Ft=>{const St={...Ft,isPositioned:pt.current!==!1};Yt.current&&!W1(Ne.current,St)&&(Ne.current=St,Hh.flushSync(()=>{F(St)}))})},[q,t,r,mt,pt]);Xv(()=>{k===!1&&Ne.current.isPositioned&&(Ne.current.isPositioned=!1,F(tt=>({...tt,isPositioned:!1})))},[k]);const Yt=W.useRef(!1);Xv(()=>(Yt.current=!0,()=>{Yt.current=!1}),[]),Xv(()=>{if(xe&&(He.current=xe),Ee&&(qe.current=Ee),xe&&Ee){if(ut.current)return ut.current(xe,Ee,en);en()}},[xe,Ee,en,ut,ft]);const dn=W.useMemo(()=>({reference:He,floating:qe,setReference:ee,setFloating:re}),[ee,re]),It=W.useMemo(()=>({reference:xe,floating:Ee}),[xe,Ee]),Et=W.useMemo(()=>{const tt={position:r,left:0,top:0};if(!It.floating)return tt;const Ft=VO(It.floating,O.x),St=VO(It.floating,O.y);return b?{...tt,transform:"translate("+Ft+"px, "+St+"px)",...SB(It.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:Ft,top:St}},[r,b,It.floating,O.x,O.y]);return W.useMemo(()=>({...O,update:en,refs:dn,elements:It,floatingStyles:Et}),[O,en,dn,It,Et])}const qre=e=>{function t(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:e,fn(r){const{element:o,padding:u}=typeof e=="function"?e(r):e;return o&&t(o)?o.current!=null?BO({element:o.current,padding:u}).fn(r):{}:o?BO({element:o,padding:u}).fn(r):{}}}},Zre=(e,t)=>({...Fre(e),options:[e,t]}),Xre=(e,t)=>({...Bre(e),options:[e,t]}),Yre=(e,t)=>({...Gre(e),options:[e,t]}),Kre=(e,t)=>({...Vre(e),options:[e,t]}),Jre=(e,t)=>({...Ure(e),options:[e,t]}),Qre=(e,t)=>({...$re(e),options:[e,t]}),eie=(e,t)=>({...qre(e),options:[e,t]});var tie="Arrow",TB=W.forwardRef((e,t)=>{const{children:r,width:o=10,height:u=5,...m}=e;return S.jsx(jn.svg,{...m,ref:t,width:o,height:u,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:S.jsx("polygon",{points:"0,0 30,0 15,10"})})});TB.displayName=tie;var nie=TB;function rie(e,t=[]){let r=[];function o(m,_){const b=W.createContext(_),s=r.length;r=[...r,_];function k(F){const{scope:q,children:H,...J}=F,U=(q==null?void 0:q[e][s])||b,te=W.useMemo(()=>J,Object.values(J));return S.jsx(U.Provider,{value:te,children:H})}function O(F,q){const H=(q==null?void 0:q[e][s])||b,J=W.useContext(H);if(J)return J;if(_!==void 0)return _;throw new Error(`\`${F}\` must be used within \`${m}\``)}return k.displayName=m+"Provider",[k,O]}const u=()=>{const m=r.map(_=>W.createContext(_));return function(b){const s=(b==null?void 0:b[e])||m;return W.useMemo(()=>({[`__scope${e}`]:{...b,[e]:s}}),[b,s])}};return u.scopeName=e,[o,iie(u,...t)]}function iie(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const o=e.map(u=>({useScope:u(),scopeName:u.scopeName}));return function(m){const _=o.reduce((b,{useScope:s,scopeName:k})=>{const F=s(m)[`__scope${k}`];return{...b,...F}},{});return W.useMemo(()=>({[`__scope${t.scopeName}`]:_}),[_])}};return r.scopeName=t.scopeName,r}function EB(e){const[t,r]=W.useState(void 0);return Ii(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});const o=new ResizeObserver(u=>{if(!Array.isArray(u)||!u.length)return;const m=u[0];let _,b;if("borderBoxSize"in m){const s=m.borderBoxSize,k=Array.isArray(s)?s[0]:s;_=k.inlineSize,b=k.blockSize}else _=e.offsetWidth,b=e.offsetHeight;r({width:_,height:b})});return o.observe(e,{box:"border-box"}),()=>o.unobserve(e)}else r(void 0)},[e]),t}var dA="Popper",[CB,Ob]=rie(dA),[sie,PB]=CB(dA),MB=e=>{const{__scopePopper:t,children:r}=e,[o,u]=W.useState(null);return S.jsx(sie,{scope:t,anchor:o,onAnchorChange:u,children:r})};MB.displayName=dA;var AB="PopperAnchor",IB=W.forwardRef((e,t)=>{const{__scopePopper:r,virtualRef:o,...u}=e,m=PB(AB,r),_=W.useRef(null),b=gr(t,_);return W.useEffect(()=>{m.onAnchorChange((o==null?void 0:o.current)||_.current)}),o?null:S.jsx(jn.div,{...u,ref:b})});IB.displayName=AB;var hA="PopperContent",[oie,aie]=CB(hA),DB=W.forwardRef((e,t)=>{var Qt,dr,Jr,hr,Ie,er;const{__scopePopper:r,side:o="bottom",sideOffset:u=0,align:m="center",alignOffset:_=0,arrowPadding:b=0,avoidCollisions:s=!0,collisionBoundary:k=[],collisionPadding:O=0,sticky:F="partial",hideWhenDetached:q=!1,updatePositionStrategy:H="optimized",onPlaced:J,...U}=e,te=PB(hA,r),[Q,ee]=W.useState(null),re=gr(t,Qr=>ee(Qr)),[xe,Ee]=W.useState(null),He=EB(xe),qe=(He==null?void 0:He.width)??0,Ne=(He==null?void 0:He.height)??0,ft=o+(m!=="center"?"-"+m:""),ut=typeof O=="number"?O:{top:0,right:0,bottom:0,left:0,...O},mt=Array.isArray(k)?k:[k],pt=mt.length>0,en={padding:ut,boundary:mt.filter(cie),altBoundary:pt},{refs:Yt,floatingStyles:dn,placement:It,isPositioned:Et,middlewareData:tt}=Hre({strategy:"fixed",placement:ft,whileElementsMounted:(...Qr)=>zre(...Qr,{animationFrame:H==="always"}),elements:{reference:te.anchor},middleware:[Zre({mainAxis:u+Ne,alignmentAxis:_}),s&&Xre({mainAxis:!0,crossAxis:!1,limiter:F==="partial"?Yre():void 0,...en}),s&&Kre({...en}),Jre({...en,apply:({elements:Qr,rects:Fi,availableWidth:Tt,availableHeight:ws})=>{const{width:Br,height:ro}=Fi.reference,wn=Qr.floating.style;wn.setProperty("--radix-popper-available-width",`${Tt}px`),wn.setProperty("--radix-popper-available-height",`${ws}px`),wn.setProperty("--radix-popper-anchor-width",`${Br}px`),wn.setProperty("--radix-popper-anchor-height",`${ro}px`)}}),xe&&eie({element:xe,padding:b}),uie({arrowWidth:qe,arrowHeight:Ne}),q&&Qre({strategy:"referenceHidden",...en})]}),[Ft,St]=NB(It),hn=ra(J);Ii(()=>{Et&&(hn==null||hn())},[Et,hn]);const Un=(Qt=tt.arrow)==null?void 0:Qt.x,wr=(dr=tt.arrow)==null?void 0:dr.y,Ut=((Jr=tt.arrow)==null?void 0:Jr.centerOffset)!==0,[Cr,or]=W.useState();return Ii(()=>{Q&&or(window.getComputedStyle(Q).zIndex)},[Q]),S.jsx("div",{ref:Yt.setFloating,"data-radix-popper-content-wrapper":"",style:{...dn,transform:Et?dn.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Cr,"--radix-popper-transform-origin":[(hr=tt.transformOrigin)==null?void 0:hr.x,(Ie=tt.transformOrigin)==null?void 0:Ie.y].join(" "),...((er=tt.hide)==null?void 0:er.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:S.jsx(oie,{scope:r,placedSide:Ft,onArrowChange:Ee,arrowX:Un,arrowY:wr,shouldHideArrow:Ut,children:S.jsx(jn.div,{"data-side":Ft,"data-align":St,...U,ref:re,style:{...U.style,animation:Et?void 0:"none"}})})})});DB.displayName=hA;var RB="PopperArrow",lie={top:"bottom",right:"left",bottom:"top",left:"right"},kB=W.forwardRef(function(t,r){const{__scopePopper:o,...u}=t,m=aie(RB,o),_=lie[m.placedSide];return S.jsx("span",{ref:m.onArrowChange,style:{position:"absolute",left:m.arrowX,top:m.arrowY,[_]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[m.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[m.placedSide],visibility:m.shouldHideArrow?"hidden":void 0},children:S.jsx(nie,{...u,ref:r,style:{...u.style,display:"block"}})})});kB.displayName=RB;function cie(e){return e!==null}var uie=e=>({name:"transformOrigin",options:e,fn(t){var te,Q,ee;const{placement:r,rects:o,middlewareData:u}=t,_=((te=u.arrow)==null?void 0:te.centerOffset)!==0,b=_?0:e.arrowWidth,s=_?0:e.arrowHeight,[k,O]=NB(r),F={start:"0%",center:"50%",end:"100%"}[O],q=(((Q=u.arrow)==null?void 0:Q.x)??0)+b/2,H=(((ee=u.arrow)==null?void 0:ee.y)??0)+s/2;let J="",U="";return k==="bottom"?(J=_?F:`${q}px`,U=`${-s}px`):k==="top"?(J=_?F:`${q}px`,U=`${o.floating.height+s}px`):k==="right"?(J=`${-s}px`,U=_?F:`${H}px`):k==="left"&&(J=`${o.floating.width+s}px`,U=_?F:`${H}px`),{data:{x:J,y:U}}}});function NB(e){const[t,r="center"]=e.split("-");return[t,r]}var LB=MB,fA=IB,OB=DB,jB=kB,die="Portal",jb=W.forwardRef((e,t)=>{var b;const{container:r,...o}=e,[u,m]=W.useState(!1);Ii(()=>m(!0),[]);const _=r||u&&((b=globalThis==null?void 0:globalThis.document)==null?void 0:b.body);return _?Dz.createPortal(S.jsx(jn.div,{...o,ref:t}),_):null});jb.displayName=die;var hie=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},pp=new WeakMap,_v=new WeakMap,xv={},KT=0,zB=function(e){return e&&(e.host||zB(e.parentNode))},fie=function(e,t){return t.map(function(r){if(e.contains(r))return r;var o=zB(r);return o&&e.contains(o)?o:(console.error("aria-hidden",r,"in not contained inside",e,". Doing nothing"),null)}).filter(function(r){return!!r})},pie=function(e,t,r,o){var u=fie(t,Array.isArray(e)?e:[e]);xv[r]||(xv[r]=new WeakMap);var m=xv[r],_=[],b=new Set,s=new Set(u),k=function(F){!F||b.has(F)||(b.add(F),k(F.parentNode))};u.forEach(k);var O=function(F){!F||s.has(F)||Array.prototype.forEach.call(F.children,function(q){if(b.has(q))O(q);else try{var H=q.getAttribute(o),J=H!==null&&H!=="false",U=(pp.get(q)||0)+1,te=(m.get(q)||0)+1;pp.set(q,U),m.set(q,te),_.push(q),U===1&&J&&_v.set(q,!0),te===1&&q.setAttribute(r,"true"),J||q.setAttribute(o,"true")}catch(Q){console.error("aria-hidden: cannot operate on ",q,Q)}})};return O(t),b.clear(),KT++,function(){_.forEach(function(F){var q=pp.get(F)-1,H=m.get(F)-1;pp.set(F,q),m.set(F,H),q||(_v.has(F)||F.removeAttribute(o),_v.delete(F)),H||F.removeAttribute(r)}),KT--,KT||(pp=new WeakMap,pp=new WeakMap,_v=new WeakMap,xv={})}},zb=function(e,t,r){r===void 0&&(r="data-aria-hidden");var o=Array.from(Array.isArray(e)?e:[e]),u=hie(e);return u?(o.push.apply(o,Array.from(u.querySelectorAll("[aria-live]"))),pie(o,u,r,"aria-hidden")):function(){return null}},_s=function(){return _s=Object.assign||function(t){for(var r,o=1,u=arguments.length;o<u;o++){r=arguments[o];for(var m in r)Object.prototype.hasOwnProperty.call(r,m)&&(t[m]=r[m])}return t},_s.apply(this,arguments)};function pA(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,o=Object.getOwnPropertySymbols(e);u<o.length;u++)t.indexOf(o[u])<0&&Object.prototype.propertyIsEnumerable.call(e,o[u])&&(r[o[u]]=e[o[u]]);return r}function FB(e,t,r){if(r||arguments.length===2)for(var o=0,u=t.length,m;o<u;o++)(m||!(o in t))&&(m||(m=Array.prototype.slice.call(t,0,o)),m[o]=t[o]);return e.concat(m||Array.prototype.slice.call(t))}var Jy="right-scroll-bar-position",Qy="width-before-scroll-bar",mie="with-scroll-bars-hidden",gie="--removed-body-scroll-bar-size";function JT(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function yie(e,t){var r=W.useState(function(){return{value:e,callback:t,facade:{get current(){return r.value},set current(o){var u=r.value;u!==o&&(r.value=o,r.callback(o,u))}}}})[0];return r.callback=t,r.facade}var _ie=typeof window<"u"?W.useLayoutEffect:W.useEffect,UO=new WeakMap;function BB(e,t){var r=yie(null,function(o){return e.forEach(function(u){return JT(u,o)})});return _ie(function(){var o=UO.get(r);if(o){var u=new Set(o),m=new Set(e),_=r.current;u.forEach(function(b){m.has(b)||JT(b,null)}),m.forEach(function(b){u.has(b)||JT(b,_)})}UO.set(r,e)},[e]),r}function xie(e){return e}function vie(e,t){t===void 0&&(t=xie);var r=[],o=!1,u={read:function(){if(o)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(m){var _=t(m,o);return r.push(_),function(){r=r.filter(function(b){return b!==_})}},assignSyncMedium:function(m){for(o=!0;r.length;){var _=r;r=[],_.forEach(m)}r={push:function(b){return m(b)},filter:function(){return r}}},assignMedium:function(m){o=!0;var _=[];if(r.length){var b=r;r=[],b.forEach(m),_=r}var s=function(){var O=_;_=[],O.forEach(m)},k=function(){return Promise.resolve().then(s)};k(),r={push:function(O){_.push(O),k()},filter:function(O){return _=_.filter(O),r}}}};return u}function VB(e){e===void 0&&(e={});var t=vie(null);return t.options=_s({async:!0,ssr:!1},e),t}var UB=function(e){var t=e.sideCar,r=pA(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var o=t.read();if(!o)throw new Error("Sidecar medium not found");return W.createElement(o,_s({},r))};UB.isSideCarExport=!0;function $B(e,t){return e.useMedium(t),UB}var GB=VB(),QT=function(){},Fb=W.forwardRef(function(e,t){var r=W.useRef(null),o=W.useState({onScrollCapture:QT,onWheelCapture:QT,onTouchMoveCapture:QT}),u=o[0],m=o[1],_=e.forwardProps,b=e.children,s=e.className,k=e.removeScrollBar,O=e.enabled,F=e.shards,q=e.sideCar,H=e.noIsolation,J=e.inert,U=e.allowPinchZoom,te=e.as,Q=te===void 0?"div":te,ee=e.gapMode,re=pA(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),xe=q,Ee=BB([r,t]),He=_s(_s({},re),u);return W.createElement(W.Fragment,null,O&&W.createElement(xe,{sideCar:GB,removeScrollBar:k,shards:F,noIsolation:H,inert:J,setCallbacks:m,allowPinchZoom:!!U,lockRef:r,gapMode:ee}),_?W.cloneElement(W.Children.only(b),_s(_s({},He),{ref:Ee})):W.createElement(Q,_s({},He,{className:s,ref:Ee}),b))});Fb.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Fb.classNames={fullWidth:Qy,zeroRight:Jy};var bie=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function wie(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=bie();return t&&e.setAttribute("nonce",t),e}function Sie(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function Tie(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var Eie=function(){var e=0,t=null;return{add:function(r){e==0&&(t=wie())&&(Sie(t,r),Tie(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},Cie=function(){var e=Eie();return function(t,r){W.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},mA=function(){var e=Cie(),t=function(r){var o=r.styles,u=r.dynamic;return e(o,u),null};return t},Pie={left:0,top:0,right:0,gap:0},eE=function(e){return parseInt(e||"",10)||0},Mie=function(e){var t=window.getComputedStyle(document.body),r=t[e==="padding"?"paddingLeft":"marginLeft"],o=t[e==="padding"?"paddingTop":"marginTop"],u=t[e==="padding"?"paddingRight":"marginRight"];return[eE(r),eE(o),eE(u)]},Aie=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return Pie;var t=Mie(e),r=document.documentElement.clientWidth,o=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,o-r+t[2]-t[0])}},Iie=mA(),Hp="data-scroll-locked",Die=function(e,t,r,o){var u=e.left,m=e.top,_=e.right,b=e.gap;return r===void 0&&(r="margin"),`
  .`.concat(mie,` {
   overflow: hidden `).concat(o,`;
   padding-right: `).concat(b,"px ").concat(o,`;
  }
  body[`).concat(Hp,`] {
    overflow: hidden `).concat(o,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(o,";"),r==="margin"&&`
    padding-left: `.concat(u,`px;
    padding-top: `).concat(m,`px;
    padding-right: `).concat(_,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(b,"px ").concat(o,`;
    `),r==="padding"&&"padding-right: ".concat(b,"px ").concat(o,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Jy,` {
    right: `).concat(b,"px ").concat(o,`;
  }
  
  .`).concat(Qy,` {
    margin-right: `).concat(b,"px ").concat(o,`;
  }
  
  .`).concat(Jy," .").concat(Jy,` {
    right: 0 `).concat(o,`;
  }
  
  .`).concat(Qy," .").concat(Qy,` {
    margin-right: 0 `).concat(o,`;
  }
  
  body[`).concat(Hp,`] {
    `).concat(gie,": ").concat(b,`px;
  }
`)},$O=function(){var e=parseInt(document.body.getAttribute(Hp)||"0",10);return isFinite(e)?e:0},Rie=function(){W.useEffect(function(){return document.body.setAttribute(Hp,($O()+1).toString()),function(){var e=$O()-1;e<=0?document.body.removeAttribute(Hp):document.body.setAttribute(Hp,e.toString())}},[])},WB=function(e){var t=e.noRelative,r=e.noImportant,o=e.gapMode,u=o===void 0?"margin":o;Rie();var m=W.useMemo(function(){return Aie(u)},[u]);return W.createElement(Iie,{styles:Die(m,!t,u,r?"":"!important")})},WC=!1;if(typeof window<"u")try{var vv=Object.defineProperty({},"passive",{get:function(){return WC=!0,!0}});window.addEventListener("test",vv,vv),window.removeEventListener("test",vv,vv)}catch{WC=!1}var mp=WC?{passive:!1}:!1,kie=function(e){return e.tagName==="TEXTAREA"},HB=function(e,t){var r=window.getComputedStyle(e);return r[t]!=="hidden"&&!(r.overflowY===r.overflowX&&!kie(e)&&r[t]==="visible")},Nie=function(e){return HB(e,"overflowY")},Lie=function(e){return HB(e,"overflowX")},GO=function(e,t){var r=t.ownerDocument,o=t;do{typeof ShadowRoot<"u"&&o instanceof ShadowRoot&&(o=o.host);var u=qB(e,o);if(u){var m=ZB(e,o),_=m[1],b=m[2];if(_>b)return!0}o=o.parentNode}while(o&&o!==r.body);return!1},Oie=function(e){var t=e.scrollTop,r=e.scrollHeight,o=e.clientHeight;return[t,r,o]},jie=function(e){var t=e.scrollLeft,r=e.scrollWidth,o=e.clientWidth;return[t,r,o]},qB=function(e,t){return e==="v"?Nie(t):Lie(t)},ZB=function(e,t){return e==="v"?Oie(t):jie(t)},zie=function(e,t){return e==="h"&&t==="rtl"?-1:1},Fie=function(e,t,r,o,u){var m=zie(e,window.getComputedStyle(t).direction),_=m*o,b=r.target,s=t.contains(b),k=!1,O=_>0,F=0,q=0;do{var H=ZB(e,b),J=H[0],U=H[1],te=H[2],Q=U-te-m*J;(J||Q)&&qB(e,b)&&(F+=Q,q+=J),b instanceof ShadowRoot?b=b.host:b=b.parentNode}while(!s&&b!==document.body||s&&(t.contains(b)||t===b));return(O&&(Math.abs(F)<1||!u)||!O&&(Math.abs(q)<1||!u))&&(k=!0),k},bv=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},WO=function(e){return[e.deltaX,e.deltaY]},HO=function(e){return e&&"current"in e?e.current:e},Bie=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Vie=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},Uie=0,gp=[];function $ie(e){var t=W.useRef([]),r=W.useRef([0,0]),o=W.useRef(),u=W.useState(Uie++)[0],m=W.useState(mA)[0],_=W.useRef(e);W.useEffect(function(){_.current=e},[e]),W.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(u));var U=FB([e.lockRef.current],(e.shards||[]).map(HO),!0).filter(Boolean);return U.forEach(function(te){return te.classList.add("allow-interactivity-".concat(u))}),function(){document.body.classList.remove("block-interactivity-".concat(u)),U.forEach(function(te){return te.classList.remove("allow-interactivity-".concat(u))})}}},[e.inert,e.lockRef.current,e.shards]);var b=W.useCallback(function(U,te){if("touches"in U&&U.touches.length===2)return!_.current.allowPinchZoom;var Q=bv(U),ee=r.current,re="deltaX"in U?U.deltaX:ee[0]-Q[0],xe="deltaY"in U?U.deltaY:ee[1]-Q[1],Ee,He=U.target,qe=Math.abs(re)>Math.abs(xe)?"h":"v";if("touches"in U&&qe==="h"&&He.type==="range")return!1;var Ne=GO(qe,He);if(!Ne)return!0;if(Ne?Ee=qe:(Ee=qe==="v"?"h":"v",Ne=GO(qe,He)),!Ne)return!1;if(!o.current&&"changedTouches"in U&&(re||xe)&&(o.current=Ee),!Ee)return!0;var ft=o.current||Ee;return Fie(ft,te,U,ft==="h"?re:xe,!0)},[]),s=W.useCallback(function(U){var te=U;if(!(!gp.length||gp[gp.length-1]!==m)){var Q="deltaY"in te?WO(te):bv(te),ee=t.current.filter(function(Ee){return Ee.name===te.type&&(Ee.target===te.target||te.target===Ee.shadowParent)&&Bie(Ee.delta,Q)})[0];if(ee&&ee.should){te.cancelable&&te.preventDefault();return}if(!ee){var re=(_.current.shards||[]).map(HO).filter(Boolean).filter(function(Ee){return Ee.contains(te.target)}),xe=re.length>0?b(te,re[0]):!_.current.noIsolation;xe&&te.cancelable&&te.preventDefault()}}},[]),k=W.useCallback(function(U,te,Q,ee){var re={name:U,delta:te,target:Q,should:ee,shadowParent:Gie(Q)};t.current.push(re),setTimeout(function(){t.current=t.current.filter(function(xe){return xe!==re})},1)},[]),O=W.useCallback(function(U){r.current=bv(U),o.current=void 0},[]),F=W.useCallback(function(U){k(U.type,WO(U),U.target,b(U,e.lockRef.current))},[]),q=W.useCallback(function(U){k(U.type,bv(U),U.target,b(U,e.lockRef.current))},[]);W.useEffect(function(){return gp.push(m),e.setCallbacks({onScrollCapture:F,onWheelCapture:F,onTouchMoveCapture:q}),document.addEventListener("wheel",s,mp),document.addEventListener("touchmove",s,mp),document.addEventListener("touchstart",O,mp),function(){gp=gp.filter(function(U){return U!==m}),document.removeEventListener("wheel",s,mp),document.removeEventListener("touchmove",s,mp),document.removeEventListener("touchstart",O,mp)}},[]);var H=e.removeScrollBar,J=e.inert;return W.createElement(W.Fragment,null,J?W.createElement(m,{styles:Vie(u)}):null,H?W.createElement(WB,{gapMode:e.gapMode}):null)}function Gie(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const Wie=$B(GB,$ie);var Bb=W.forwardRef(function(e,t){return W.createElement(Fb,_s({},e,{ref:t,sideCar:Wie}))});Bb.classNames=Fb.classNames;var gA="Popover",[XB,ode]=Une(gA,[Ob]),rx=Ob(),[Hie,dd]=XB(gA),YB=e=>{const{__scopePopover:t,children:r,open:o,defaultOpen:u,onOpenChange:m,modal:_=!1}=e,b=rx(t),s=W.useRef(null),[k,O]=W.useState(!1),[F=!1,q]=hc({prop:o,defaultProp:u,onChange:m});return S.jsx(LB,{...b,children:S.jsx(Hie,{scope:t,contentId:To(),triggerRef:s,open:F,onOpenChange:q,onOpenToggle:W.useCallback(()=>q(H=>!H),[q]),hasCustomAnchor:k,onCustomAnchorAdd:W.useCallback(()=>O(!0),[]),onCustomAnchorRemove:W.useCallback(()=>O(!1),[]),modal:_,children:r})})};YB.displayName=gA;var KB="PopoverAnchor",qie=W.forwardRef((e,t)=>{const{__scopePopover:r,...o}=e,u=dd(KB,r),m=rx(r),{onCustomAnchorAdd:_,onCustomAnchorRemove:b}=u;return W.useEffect(()=>(_(),()=>b()),[_,b]),S.jsx(fA,{...m,...o,ref:t})});qie.displayName=KB;var JB="PopoverTrigger",QB=W.forwardRef((e,t)=>{const{__scopePopover:r,...o}=e,u=dd(JB,r),m=rx(r),_=gr(t,u.triggerRef),b=S.jsx(jn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":u.open,"aria-controls":u.contentId,"data-state":i6(u.open),...o,ref:_,onClick:In(e.onClick,u.onOpenToggle)});return u.hasCustomAnchor?b:S.jsx(fA,{asChild:!0,...m,children:b})});QB.displayName=JB;var yA="PopoverPortal",[Zie,Xie]=XB(yA,{forceMount:void 0}),e6=e=>{const{__scopePopover:t,forceMount:r,children:o,container:u}=e,m=dd(yA,t);return S.jsx(Zie,{scope:t,forceMount:r,children:S.jsx(ud,{present:r||m.open,children:S.jsx(jb,{asChild:!0,container:u,children:o})})})};e6.displayName=yA;var am="PopoverContent",t6=W.forwardRef((e,t)=>{const r=Xie(am,e.__scopePopover),{forceMount:o=r.forceMount,...u}=e,m=dd(am,e.__scopePopover);return S.jsx(ud,{present:o||m.open,children:m.modal?S.jsx(Yie,{...u,ref:t}):S.jsx(Kie,{...u,ref:t})})});t6.displayName=am;var Yie=W.forwardRef((e,t)=>{const r=dd(am,e.__scopePopover),o=W.useRef(null),u=gr(t,o),m=W.useRef(!1);return W.useEffect(()=>{const _=o.current;if(_)return zb(_)},[]),S.jsx(Bb,{as:dc,allowPinchZoom:!0,children:S.jsx(n6,{...e,ref:u,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:In(e.onCloseAutoFocus,_=>{var b;_.preventDefault(),m.current||(b=r.triggerRef.current)==null||b.focus()}),onPointerDownOutside:In(e.onPointerDownOutside,_=>{const b=_.detail.originalEvent,s=b.button===0&&b.ctrlKey===!0,k=b.button===2||s;m.current=k},{checkForDefaultPrevented:!1}),onFocusOutside:In(e.onFocusOutside,_=>_.preventDefault(),{checkForDefaultPrevented:!1})})})}),Kie=W.forwardRef((e,t)=>{const r=dd(am,e.__scopePopover),o=W.useRef(!1),u=W.useRef(!1);return S.jsx(n6,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:m=>{var _,b;(_=e.onCloseAutoFocus)==null||_.call(e,m),m.defaultPrevented||(o.current||(b=r.triggerRef.current)==null||b.focus(),m.preventDefault()),o.current=!1,u.current=!1},onInteractOutside:m=>{var s,k;(s=e.onInteractOutside)==null||s.call(e,m),m.defaultPrevented||(o.current=!0,m.detail.originalEvent.type==="pointerdown"&&(u.current=!0));const _=m.target;((k=r.triggerRef.current)==null?void 0:k.contains(_))&&m.preventDefault(),m.detail.originalEvent.type==="focusin"&&u.current&&m.preventDefault()}})}),n6=W.forwardRef((e,t)=>{const{__scopePopover:r,trapFocus:o,onOpenAutoFocus:u,onCloseAutoFocus:m,disableOutsidePointerEvents:_,onEscapeKeyDown:b,onPointerDownOutside:s,onFocusOutside:k,onInteractOutside:O,...F}=e,q=dd(am,r),H=rx(r);return iA(),S.jsx(tx,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:u,onUnmountAutoFocus:m,children:S.jsx(Rb,{asChild:!0,disableOutsidePointerEvents:_,onInteractOutside:O,onEscapeKeyDown:b,onPointerDownOutside:s,onFocusOutside:k,onDismiss:()=>q.onOpenChange(!1),children:S.jsx(OB,{"data-state":i6(q.open),role:"dialog",id:q.contentId,...H,...F,ref:t,style:{...F.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),r6="PopoverClose",Jie=W.forwardRef((e,t)=>{const{__scopePopover:r,...o}=e,u=dd(r6,r);return S.jsx(jn.button,{type:"button",...o,ref:t,onClick:In(e.onClick,()=>u.onOpenChange(!1))})});Jie.displayName=r6;var Qie="PopoverArrow",ese=W.forwardRef((e,t)=>{const{__scopePopover:r,...o}=e,u=rx(r);return S.jsx(jB,{...u,...o,ref:t})});ese.displayName=Qie;function i6(e){return e?"open":"closed"}var tse=YB,nse=QB,rse=e6,s6=t6;const lm=tse,cm=nse,jh=W.forwardRef(({className:e,align:t="center",sideOffset:r=4,...o},u)=>S.jsx(rse,{children:S.jsx(s6,{ref:u,align:t,sideOffset:r,className:Zn("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...o})}));jh.displayName=s6.displayName;function qO(e,[t,r]){return Math.min(r,Math.max(t,e))}function ise(e,t=[]){let r=[];function o(m,_){const b=W.createContext(_),s=r.length;r=[...r,_];function k(F){const{scope:q,children:H,...J}=F,U=(q==null?void 0:q[e][s])||b,te=W.useMemo(()=>J,Object.values(J));return S.jsx(U.Provider,{value:te,children:H})}function O(F,q){const H=(q==null?void 0:q[e][s])||b,J=W.useContext(H);if(J)return J;if(_!==void 0)return _;throw new Error(`\`${F}\` must be used within \`${m}\``)}return k.displayName=m+"Provider",[k,O]}const u=()=>{const m=r.map(_=>W.createContext(_));return function(b){const s=(b==null?void 0:b[e])||m;return W.useMemo(()=>({[`__scope${e}`]:{...b,[e]:s}}),[b,s])}};return u.scopeName=e,[o,sse(u,...t)]}function sse(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const o=e.map(u=>({useScope:u(),scopeName:u.scopeName}));return function(m){const _=o.reduce((b,{useScope:s,scopeName:k})=>{const F=s(m)[`__scope${k}`];return{...b,...F}},{});return W.useMemo(()=>({[`__scope${t.scopeName}`]:_}),[_])}};return r.scopeName=t.scopeName,r}function o6(e){const t=W.useRef({value:e,previous:e});return W.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var ose="VisuallyHidden",a6=W.forwardRef((e,t)=>S.jsx(jn.span,{...e,ref:t,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...e.style}}));a6.displayName=ose;var ase=[" ","Enter","ArrowUp","ArrowDown"],lse=[" ","Enter"],ix="Select",[Vb,Ub,cse]=fF(ix),[Sm,ade]=ise(ix,[cse,Ob]),$b=Ob(),[use,hd]=Sm(ix),[dse,hse]=Sm(ix),l6=e=>{const{__scopeSelect:t,children:r,open:o,defaultOpen:u,onOpenChange:m,value:_,defaultValue:b,onValueChange:s,dir:k,name:O,autoComplete:F,disabled:q,required:H}=e,J=$b(t),[U,te]=W.useState(null),[Q,ee]=W.useState(null),[re,xe]=W.useState(!1),Ee=UM(k),[He=!1,qe]=hc({prop:o,defaultProp:u,onChange:m}),[Ne,ft]=hc({prop:_,defaultProp:b,onChange:s}),ut=W.useRef(null),mt=U?!!U.closest("form"):!0,[pt,en]=W.useState(new Set),Yt=Array.from(pt).map(dn=>dn.props.value).join(";");return S.jsx(LB,{...J,children:S.jsxs(use,{required:H,scope:t,trigger:U,onTriggerChange:te,valueNode:Q,onValueNodeChange:ee,valueNodeHasChildren:re,onValueNodeHasChildrenChange:xe,contentId:To(),value:Ne,onValueChange:ft,open:He,onOpenChange:qe,dir:Ee,triggerPointerDownPosRef:ut,disabled:q,children:[S.jsx(Vb.Provider,{scope:t,children:S.jsx(dse,{scope:e.__scopeSelect,onNativeOptionAdd:W.useCallback(dn=>{en(It=>new Set(It).add(dn))},[]),onNativeOptionRemove:W.useCallback(dn=>{en(It=>{const Et=new Set(It);return Et.delete(dn),Et})},[]),children:r})}),mt?S.jsxs(N6,{"aria-hidden":!0,required:H,tabIndex:-1,name:O,autoComplete:F,value:Ne,onChange:dn=>ft(dn.target.value),disabled:q,children:[Ne===void 0?S.jsx("option",{value:""}):null,Array.from(pt)]},Yt):null]})})};l6.displayName=ix;var c6="SelectTrigger",u6=W.forwardRef((e,t)=>{const{__scopeSelect:r,disabled:o=!1,...u}=e,m=$b(r),_=hd(c6,r),b=_.disabled||o,s=gr(t,_.onTriggerChange),k=Ub(r),[O,F,q]=L6(J=>{const U=k().filter(ee=>!ee.disabled),te=U.find(ee=>ee.value===_.value),Q=O6(U,J,te);Q!==void 0&&_.onValueChange(Q.value)}),H=()=>{b||(_.onOpenChange(!0),q())};return S.jsx(fA,{asChild:!0,...m,children:S.jsx(jn.button,{type:"button",role:"combobox","aria-controls":_.contentId,"aria-expanded":_.open,"aria-required":_.required,"aria-autocomplete":"none",dir:_.dir,"data-state":_.open?"open":"closed",disabled:b,"data-disabled":b?"":void 0,"data-placeholder":k6(_.value)?"":void 0,...u,ref:s,onClick:In(u.onClick,J=>{J.currentTarget.focus()}),onPointerDown:In(u.onPointerDown,J=>{const U=J.target;U.hasPointerCapture(J.pointerId)&&U.releasePointerCapture(J.pointerId),J.button===0&&J.ctrlKey===!1&&(H(),_.triggerPointerDownPosRef.current={x:Math.round(J.pageX),y:Math.round(J.pageY)},J.preventDefault())}),onKeyDown:In(u.onKeyDown,J=>{const U=O.current!=="";!(J.ctrlKey||J.altKey||J.metaKey)&&J.key.length===1&&F(J.key),!(U&&J.key===" ")&&ase.includes(J.key)&&(H(),J.preventDefault())})})})});u6.displayName=c6;var d6="SelectValue",h6=W.forwardRef((e,t)=>{const{__scopeSelect:r,className:o,style:u,children:m,placeholder:_="",...b}=e,s=hd(d6,r),{onValueNodeHasChildrenChange:k}=s,O=m!==void 0,F=gr(t,s.onValueNodeChange);return Ii(()=>{k(O)},[k,O]),S.jsx(jn.span,{...b,ref:F,style:{pointerEvents:"none"},children:k6(s.value)?S.jsx(S.Fragment,{children:_}):m})});h6.displayName=d6;var fse="SelectIcon",f6=W.forwardRef((e,t)=>{const{__scopeSelect:r,children:o,...u}=e;return S.jsx(jn.span,{"aria-hidden":!0,...u,ref:t,children:o||"▼"})});f6.displayName=fse;var pse="SelectPortal",p6=e=>S.jsx(jb,{asChild:!0,...e});p6.displayName=pse;var zh="SelectContent",m6=W.forwardRef((e,t)=>{const r=hd(zh,e.__scopeSelect),[o,u]=W.useState();if(Ii(()=>{u(new DocumentFragment)},[]),!r.open){const m=o;return m?Hh.createPortal(S.jsx(g6,{scope:e.__scopeSelect,children:S.jsx(Vb.Slot,{scope:e.__scopeSelect,children:S.jsx("div",{children:e.children})})}),m):null}return S.jsx(y6,{...e,ref:t})});m6.displayName=zh;var ql=10,[g6,fd]=Sm(zh),mse="SelectContentImpl",y6=W.forwardRef((e,t)=>{const{__scopeSelect:r,position:o="item-aligned",onCloseAutoFocus:u,onEscapeKeyDown:m,onPointerDownOutside:_,side:b,sideOffset:s,align:k,alignOffset:O,arrowPadding:F,collisionBoundary:q,collisionPadding:H,sticky:J,hideWhenDetached:U,avoidCollisions:te,...Q}=e,ee=hd(zh,r),[re,xe]=W.useState(null),[Ee,He]=W.useState(null),qe=gr(t,Qt=>xe(Qt)),[Ne,ft]=W.useState(null),[ut,mt]=W.useState(null),pt=Ub(r),[en,Yt]=W.useState(!1),dn=W.useRef(!1);W.useEffect(()=>{if(re)return zb(re)},[re]),iA();const It=W.useCallback(Qt=>{const[dr,...Jr]=pt().map(er=>er.ref.current),[hr]=Jr.slice(-1),Ie=document.activeElement;for(const er of Qt)if(er===Ie||(er==null||er.scrollIntoView({block:"nearest"}),er===dr&&Ee&&(Ee.scrollTop=0),er===hr&&Ee&&(Ee.scrollTop=Ee.scrollHeight),er==null||er.focus(),document.activeElement!==Ie))return},[pt,Ee]),Et=W.useCallback(()=>It([Ne,re]),[It,Ne,re]);W.useEffect(()=>{en&&Et()},[en,Et]);const{onOpenChange:tt,triggerPointerDownPosRef:Ft}=ee;W.useEffect(()=>{if(re){let Qt={x:0,y:0};const dr=hr=>{var Ie,er;Qt={x:Math.abs(Math.round(hr.pageX)-(((Ie=Ft.current)==null?void 0:Ie.x)??0)),y:Math.abs(Math.round(hr.pageY)-(((er=Ft.current)==null?void 0:er.y)??0))}},Jr=hr=>{Qt.x<=10&&Qt.y<=10?hr.preventDefault():re.contains(hr.target)||tt(!1),document.removeEventListener("pointermove",dr),Ft.current=null};return Ft.current!==null&&(document.addEventListener("pointermove",dr),document.addEventListener("pointerup",Jr,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",dr),document.removeEventListener("pointerup",Jr,{capture:!0})}}},[re,tt,Ft]),W.useEffect(()=>{const Qt=()=>tt(!1);return window.addEventListener("blur",Qt),window.addEventListener("resize",Qt),()=>{window.removeEventListener("blur",Qt),window.removeEventListener("resize",Qt)}},[tt]);const[St,hn]=L6(Qt=>{const dr=pt().filter(Ie=>!Ie.disabled),Jr=dr.find(Ie=>Ie.ref.current===document.activeElement),hr=O6(dr,Qt,Jr);hr&&setTimeout(()=>hr.ref.current.focus())}),Un=W.useCallback((Qt,dr,Jr)=>{const hr=!dn.current&&!Jr;(ee.value!==void 0&&ee.value===dr||hr)&&(ft(Qt),hr&&(dn.current=!0))},[ee.value]),wr=W.useCallback(()=>re==null?void 0:re.focus(),[re]),Ut=W.useCallback((Qt,dr,Jr)=>{const hr=!dn.current&&!Jr;(ee.value!==void 0&&ee.value===dr||hr)&&mt(Qt)},[ee.value]),Cr=o==="popper"?HC:_6,or=Cr===HC?{side:b,sideOffset:s,align:k,alignOffset:O,arrowPadding:F,collisionBoundary:q,collisionPadding:H,sticky:J,hideWhenDetached:U,avoidCollisions:te}:{};return S.jsx(g6,{scope:r,content:re,viewport:Ee,onViewportChange:He,itemRefCallback:Un,selectedItem:Ne,onItemLeave:wr,itemTextRefCallback:Ut,focusSelectedItem:Et,selectedItemText:ut,position:o,isPositioned:en,searchRef:St,children:S.jsx(Bb,{as:dc,allowPinchZoom:!0,children:S.jsx(tx,{asChild:!0,trapped:ee.open,onMountAutoFocus:Qt=>{Qt.preventDefault()},onUnmountAutoFocus:In(u,Qt=>{var dr;(dr=ee.trigger)==null||dr.focus({preventScroll:!0}),Qt.preventDefault()}),children:S.jsx(Rb,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:m,onPointerDownOutside:_,onFocusOutside:Qt=>Qt.preventDefault(),onDismiss:()=>ee.onOpenChange(!1),children:S.jsx(Cr,{role:"listbox",id:ee.contentId,"data-state":ee.open?"open":"closed",dir:ee.dir,onContextMenu:Qt=>Qt.preventDefault(),...Q,...or,onPlaced:()=>Yt(!0),ref:qe,style:{display:"flex",flexDirection:"column",outline:"none",...Q.style},onKeyDown:In(Q.onKeyDown,Qt=>{const dr=Qt.ctrlKey||Qt.altKey||Qt.metaKey;if(Qt.key==="Tab"&&Qt.preventDefault(),!dr&&Qt.key.length===1&&hn(Qt.key),["ArrowUp","ArrowDown","Home","End"].includes(Qt.key)){let hr=pt().filter(Ie=>!Ie.disabled).map(Ie=>Ie.ref.current);if(["ArrowUp","End"].includes(Qt.key)&&(hr=hr.slice().reverse()),["ArrowUp","ArrowDown"].includes(Qt.key)){const Ie=Qt.target,er=hr.indexOf(Ie);hr=hr.slice(er+1)}setTimeout(()=>It(hr)),Qt.preventDefault()}})})})})})})});y6.displayName=mse;var gse="SelectItemAlignedPosition",_6=W.forwardRef((e,t)=>{const{__scopeSelect:r,onPlaced:o,...u}=e,m=hd(zh,r),_=fd(zh,r),[b,s]=W.useState(null),[k,O]=W.useState(null),F=gr(t,qe=>O(qe)),q=Ub(r),H=W.useRef(!1),J=W.useRef(!0),{viewport:U,selectedItem:te,selectedItemText:Q,focusSelectedItem:ee}=_,re=W.useCallback(()=>{if(m.trigger&&m.valueNode&&b&&k&&U&&te&&Q){const qe=m.trigger.getBoundingClientRect(),Ne=k.getBoundingClientRect(),ft=m.valueNode.getBoundingClientRect(),ut=Q.getBoundingClientRect();if(m.dir!=="rtl"){const Ie=ut.left-Ne.left,er=ft.left-Ie,Qr=qe.left-er,Fi=qe.width+Qr,Tt=Math.max(Fi,Ne.width),ws=window.innerWidth-ql,Br=qO(er,[ql,ws-Tt]);b.style.minWidth=Fi+"px",b.style.left=Br+"px"}else{const Ie=Ne.right-ut.right,er=window.innerWidth-ft.right-Ie,Qr=window.innerWidth-qe.right-er,Fi=qe.width+Qr,Tt=Math.max(Fi,Ne.width),ws=window.innerWidth-ql,Br=qO(er,[ql,ws-Tt]);b.style.minWidth=Fi+"px",b.style.right=Br+"px"}const mt=q(),pt=window.innerHeight-ql*2,en=U.scrollHeight,Yt=window.getComputedStyle(k),dn=parseInt(Yt.borderTopWidth,10),It=parseInt(Yt.paddingTop,10),Et=parseInt(Yt.borderBottomWidth,10),tt=parseInt(Yt.paddingBottom,10),Ft=dn+It+en+tt+Et,St=Math.min(te.offsetHeight*5,Ft),hn=window.getComputedStyle(U),Un=parseInt(hn.paddingTop,10),wr=parseInt(hn.paddingBottom,10),Ut=qe.top+qe.height/2-ql,Cr=pt-Ut,or=te.offsetHeight/2,Qt=te.offsetTop+or,dr=dn+It+Qt,Jr=Ft-dr;if(dr<=Ut){const Ie=te===mt[mt.length-1].ref.current;b.style.bottom="0px";const er=k.clientHeight-U.offsetTop-U.offsetHeight,Qr=Math.max(Cr,or+(Ie?wr:0)+er+Et),Fi=dr+Qr;b.style.height=Fi+"px"}else{const Ie=te===mt[0].ref.current;b.style.top="0px";const Qr=Math.max(Ut,dn+U.offsetTop+(Ie?Un:0)+or)+Jr;b.style.height=Qr+"px",U.scrollTop=dr-Ut+U.offsetTop}b.style.margin=`${ql}px 0`,b.style.minHeight=St+"px",b.style.maxHeight=pt+"px",o==null||o(),requestAnimationFrame(()=>H.current=!0)}},[q,m.trigger,m.valueNode,b,k,U,te,Q,m.dir,o]);Ii(()=>re(),[re]);const[xe,Ee]=W.useState();Ii(()=>{k&&Ee(window.getComputedStyle(k).zIndex)},[k]);const He=W.useCallback(qe=>{qe&&J.current===!0&&(re(),ee==null||ee(),J.current=!1)},[re,ee]);return S.jsx(_se,{scope:r,contentWrapper:b,shouldExpandOnScrollRef:H,onScrollButtonChange:He,children:S.jsx("div",{ref:s,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:xe},children:S.jsx(jn.div,{...u,ref:F,style:{boxSizing:"border-box",maxHeight:"100%",...u.style}})})})});_6.displayName=gse;var yse="SelectPopperPosition",HC=W.forwardRef((e,t)=>{const{__scopeSelect:r,align:o="start",collisionPadding:u=ql,...m}=e,_=$b(r);return S.jsx(OB,{..._,...m,ref:t,align:o,collisionPadding:u,style:{boxSizing:"border-box",...m.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});HC.displayName=yse;var[_se,_A]=Sm(zh,{}),qC="SelectViewport",x6=W.forwardRef((e,t)=>{const{__scopeSelect:r,nonce:o,...u}=e,m=fd(qC,r),_=_A(qC,r),b=gr(t,m.onViewportChange),s=W.useRef(0);return S.jsxs(S.Fragment,{children:[S.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:o}),S.jsx(Vb.Slot,{scope:r,children:S.jsx(jn.div,{"data-radix-select-viewport":"",role:"presentation",...u,ref:b,style:{position:"relative",flex:1,overflow:"auto",...u.style},onScroll:In(u.onScroll,k=>{const O=k.currentTarget,{contentWrapper:F,shouldExpandOnScrollRef:q}=_;if(q!=null&&q.current&&F){const H=Math.abs(s.current-O.scrollTop);if(H>0){const J=window.innerHeight-ql*2,U=parseFloat(F.style.minHeight),te=parseFloat(F.style.height),Q=Math.max(U,te);if(Q<J){const ee=Q+H,re=Math.min(J,ee),xe=ee-re;F.style.height=re+"px",F.style.bottom==="0px"&&(O.scrollTop=xe>0?xe:0,F.style.justifyContent="flex-end")}}}s.current=O.scrollTop})})})]})});x6.displayName=qC;var v6="SelectGroup",[xse,vse]=Sm(v6),b6=W.forwardRef((e,t)=>{const{__scopeSelect:r,...o}=e,u=To();return S.jsx(xse,{scope:r,id:u,children:S.jsx(jn.div,{role:"group","aria-labelledby":u,...o,ref:t})})});b6.displayName=v6;var w6="SelectLabel",S6=W.forwardRef((e,t)=>{const{__scopeSelect:r,...o}=e,u=vse(w6,r);return S.jsx(jn.div,{id:u.id,...o,ref:t})});S6.displayName=w6;var H1="SelectItem",[bse,T6]=Sm(H1),E6=W.forwardRef((e,t)=>{const{__scopeSelect:r,value:o,disabled:u=!1,textValue:m,..._}=e,b=hd(H1,r),s=fd(H1,r),k=b.value===o,[O,F]=W.useState(m??""),[q,H]=W.useState(!1),J=gr(t,Q=>{var ee;return(ee=s.itemRefCallback)==null?void 0:ee.call(s,Q,o,u)}),U=To(),te=()=>{u||(b.onValueChange(o),b.onOpenChange(!1))};if(o==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return S.jsx(bse,{scope:r,value:o,disabled:u,textId:U,isSelected:k,onItemTextChange:W.useCallback(Q=>{F(ee=>ee||((Q==null?void 0:Q.textContent)??"").trim())},[]),children:S.jsx(Vb.ItemSlot,{scope:r,value:o,disabled:u,textValue:O,children:S.jsx(jn.div,{role:"option","aria-labelledby":U,"data-highlighted":q?"":void 0,"aria-selected":k&&q,"data-state":k?"checked":"unchecked","aria-disabled":u||void 0,"data-disabled":u?"":void 0,tabIndex:u?void 0:-1,..._,ref:J,onFocus:In(_.onFocus,()=>H(!0)),onBlur:In(_.onBlur,()=>H(!1)),onPointerUp:In(_.onPointerUp,te),onPointerMove:In(_.onPointerMove,Q=>{var ee;u?(ee=s.onItemLeave)==null||ee.call(s):Q.currentTarget.focus({preventScroll:!0})}),onPointerLeave:In(_.onPointerLeave,Q=>{var ee;Q.currentTarget===document.activeElement&&((ee=s.onItemLeave)==null||ee.call(s))}),onKeyDown:In(_.onKeyDown,Q=>{var re;((re=s.searchRef)==null?void 0:re.current)!==""&&Q.key===" "||(lse.includes(Q.key)&&te(),Q.key===" "&&Q.preventDefault())})})})})});E6.displayName=H1;var Oy="SelectItemText",C6=W.forwardRef((e,t)=>{const{__scopeSelect:r,className:o,style:u,...m}=e,_=hd(Oy,r),b=fd(Oy,r),s=T6(Oy,r),k=hse(Oy,r),[O,F]=W.useState(null),q=gr(t,Q=>F(Q),s.onItemTextChange,Q=>{var ee;return(ee=b.itemTextRefCallback)==null?void 0:ee.call(b,Q,s.value,s.disabled)}),H=O==null?void 0:O.textContent,J=W.useMemo(()=>S.jsx("option",{value:s.value,disabled:s.disabled,children:H},s.value),[s.disabled,s.value,H]),{onNativeOptionAdd:U,onNativeOptionRemove:te}=k;return Ii(()=>(U(J),()=>te(J)),[U,te,J]),S.jsxs(S.Fragment,{children:[S.jsx(jn.span,{id:s.textId,...m,ref:q}),s.isSelected&&_.valueNode&&!_.valueNodeHasChildren?Hh.createPortal(m.children,_.valueNode):null]})});C6.displayName=Oy;var P6="SelectItemIndicator",M6=W.forwardRef((e,t)=>{const{__scopeSelect:r,...o}=e;return T6(P6,r).isSelected?S.jsx(jn.span,{"aria-hidden":!0,...o,ref:t}):null});M6.displayName=P6;var ZC="SelectScrollUpButton",A6=W.forwardRef((e,t)=>{const r=fd(ZC,e.__scopeSelect),o=_A(ZC,e.__scopeSelect),[u,m]=W.useState(!1),_=gr(t,o.onScrollButtonChange);return Ii(()=>{if(r.viewport&&r.isPositioned){let b=function(){const k=s.scrollTop>0;m(k)};const s=r.viewport;return b(),s.addEventListener("scroll",b),()=>s.removeEventListener("scroll",b)}},[r.viewport,r.isPositioned]),u?S.jsx(D6,{...e,ref:_,onAutoScroll:()=>{const{viewport:b,selectedItem:s}=r;b&&s&&(b.scrollTop=b.scrollTop-s.offsetHeight)}}):null});A6.displayName=ZC;var XC="SelectScrollDownButton",I6=W.forwardRef((e,t)=>{const r=fd(XC,e.__scopeSelect),o=_A(XC,e.__scopeSelect),[u,m]=W.useState(!1),_=gr(t,o.onScrollButtonChange);return Ii(()=>{if(r.viewport&&r.isPositioned){let b=function(){const k=s.scrollHeight-s.clientHeight,O=Math.ceil(s.scrollTop)<k;m(O)};const s=r.viewport;return b(),s.addEventListener("scroll",b),()=>s.removeEventListener("scroll",b)}},[r.viewport,r.isPositioned]),u?S.jsx(D6,{...e,ref:_,onAutoScroll:()=>{const{viewport:b,selectedItem:s}=r;b&&s&&(b.scrollTop=b.scrollTop+s.offsetHeight)}}):null});I6.displayName=XC;var D6=W.forwardRef((e,t)=>{const{__scopeSelect:r,onAutoScroll:o,...u}=e,m=fd("SelectScrollButton",r),_=W.useRef(null),b=Ub(r),s=W.useCallback(()=>{_.current!==null&&(window.clearInterval(_.current),_.current=null)},[]);return W.useEffect(()=>()=>s(),[s]),Ii(()=>{var O;const k=b().find(F=>F.ref.current===document.activeElement);(O=k==null?void 0:k.ref.current)==null||O.scrollIntoView({block:"nearest"})},[b]),S.jsx(jn.div,{"aria-hidden":!0,...u,ref:t,style:{flexShrink:0,...u.style},onPointerDown:In(u.onPointerDown,()=>{_.current===null&&(_.current=window.setInterval(o,50))}),onPointerMove:In(u.onPointerMove,()=>{var k;(k=m.onItemLeave)==null||k.call(m),_.current===null&&(_.current=window.setInterval(o,50))}),onPointerLeave:In(u.onPointerLeave,()=>{s()})})}),wse="SelectSeparator",R6=W.forwardRef((e,t)=>{const{__scopeSelect:r,...o}=e;return S.jsx(jn.div,{"aria-hidden":!0,...o,ref:t})});R6.displayName=wse;var YC="SelectArrow",Sse=W.forwardRef((e,t)=>{const{__scopeSelect:r,...o}=e,u=$b(r),m=hd(YC,r),_=fd(YC,r);return m.open&&_.position==="popper"?S.jsx(jB,{...u,...o,ref:t}):null});Sse.displayName=YC;function k6(e){return e===""||e===void 0}var N6=W.forwardRef((e,t)=>{const{value:r,...o}=e,u=W.useRef(null),m=gr(t,u),_=o6(r);return W.useEffect(()=>{const b=u.current,s=window.HTMLSelectElement.prototype,O=Object.getOwnPropertyDescriptor(s,"value").set;if(_!==r&&O){const F=new Event("change",{bubbles:!0});O.call(b,r),b.dispatchEvent(F)}},[_,r]),S.jsx(a6,{asChild:!0,children:S.jsx("select",{...o,ref:m,defaultValue:r})})});N6.displayName="BubbleSelect";function L6(e){const t=ra(e),r=W.useRef(""),o=W.useRef(0),u=W.useCallback(_=>{const b=r.current+_;t(b),function s(k){r.current=k,window.clearTimeout(o.current),k!==""&&(o.current=window.setTimeout(()=>s(""),1e3))}(b)},[t]),m=W.useCallback(()=>{r.current="",window.clearTimeout(o.current)},[]);return W.useEffect(()=>()=>window.clearTimeout(o.current),[]),[r,u,m]}function O6(e,t,r){const u=t.length>1&&Array.from(t).every(k=>k===t[0])?t[0]:t,m=r?e.indexOf(r):-1;let _=Tse(e,Math.max(m,0));u.length===1&&(_=_.filter(k=>k!==r));const s=_.find(k=>k.textValue.toLowerCase().startsWith(u.toLowerCase()));return s!==r?s:void 0}function Tse(e,t){return e.map((r,o)=>e[(t+o)%e.length])}var Ese=l6,j6=u6,Cse=h6,Pse=f6,Mse=p6,z6=m6,Ase=x6,Ise=b6,F6=S6,B6=E6,Dse=C6,Rse=M6,V6=A6,U6=I6,$6=R6;const Ci=Ese,Pi=Ise,Mi=Cse,_i=W.forwardRef(({className:e,children:t,...r},o)=>S.jsxs(j6,{ref:o,className:Zn("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...r,children:[t,S.jsx(Pse,{asChild:!0,children:S.jsx($F,{className:"h-4 w-4 opacity-50"})})]}));_i.displayName=j6.displayName;const G6=W.forwardRef(({className:e,...t},r)=>S.jsx(V6,{ref:r,className:Zn("flex cursor-default items-center justify-center py-1",e),...t,children:S.jsx(JQ,{className:"h-4 w-4"})}));G6.displayName=V6.displayName;const W6=W.forwardRef(({className:e,...t},r)=>S.jsx(U6,{ref:r,className:Zn("flex cursor-default items-center justify-center py-1",e),...t,children:S.jsx($F,{className:"h-4 w-4"})}));W6.displayName=U6.displayName;const xi=W.forwardRef(({className:e,children:t,position:r="popper",...o},u)=>S.jsx(Mse,{children:S.jsxs(z6,{ref:u,className:Zn("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...o,children:[S.jsx(G6,{}),S.jsx(Ase,{className:Zn("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),S.jsx(W6,{})]})}));xi.displayName=z6.displayName;const kse=W.forwardRef(({className:e,...t},r)=>S.jsx(F6,{ref:r,className:Zn("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));kse.displayName=F6.displayName;const ii=W.forwardRef(({className:e,children:t,...r},o)=>S.jsxs(B6,{ref:o,className:Zn("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[S.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:S.jsx(Rse,{children:S.jsx(UF,{className:"h-4 w-4"})})}),S.jsx(Dse,{children:t})]}));ii.displayName=B6.displayName;const Nse=W.forwardRef(({className:e,...t},r)=>S.jsx($6,{ref:r,className:Zn("-mx-1 my-1 h-px bg-muted",e),...t}));Nse.displayName=$6.displayName;const e_=[{value:"cultural festival",label:"Cultural Festival"},{value:"nature festival",label:"Literary Festival"},{value:"food festival",label:"Food Festival"},{value:"beach festival",label:"Beach Festival"},{value:"adventure festival",label:"Adventure Festival"},{value:"flower festival",label:"Flower Festival"},{value:"kite festival",label:"Kite Festival"},{value:"religious festival",label:"Religious Festival"},{value:"music festival",label:"Music Festival"},{value:"fashion show",label:"Fashion Show"}],bn=W.forwardRef(({className:e,type:t,...r},o)=>S.jsx("input",{type:t,className:Zn("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",e),ref:o,...r}));bn.displayName="Input";function Lse(e,t){const r=W.createContext(t);function o(m){const{children:_,...b}=m,s=W.useMemo(()=>b,Object.values(b));return S.jsx(r.Provider,{value:s,children:_})}function u(m){const _=W.useContext(r);if(_)return _;if(t!==void 0)return t;throw new Error(`\`${m}\` must be used within \`${e}\``)}return o.displayName=e+"Provider",[o,u]}function Ose(e,t=[]){let r=[];function o(m,_){const b=W.createContext(_),s=r.length;r=[...r,_];function k(F){const{scope:q,children:H,...J}=F,U=(q==null?void 0:q[e][s])||b,te=W.useMemo(()=>J,Object.values(J));return S.jsx(U.Provider,{value:te,children:H})}function O(F,q){const H=(q==null?void 0:q[e][s])||b,J=W.useContext(H);if(J)return J;if(_!==void 0)return _;throw new Error(`\`${F}\` must be used within \`${m}\``)}return k.displayName=m+"Provider",[k,O]}const u=()=>{const m=r.map(_=>W.createContext(_));return function(b){const s=(b==null?void 0:b[e])||m;return W.useMemo(()=>({[`__scope${e}`]:{...b,[e]:s}}),[b,s])}};return u.scopeName=e,[o,jse(u,...t)]}function jse(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const o=e.map(u=>({useScope:u(),scopeName:u.scopeName}));return function(m){const _=o.reduce((b,{useScope:s,scopeName:k})=>{const F=s(m)[`__scope${k}`];return{...b,...F}},{});return W.useMemo(()=>({[`__scope${t.scopeName}`]:_}),[_])}};return r.scopeName=t.scopeName,r}var xA="Dialog",[H6,lde]=Ose(xA),[zse,Ua]=H6(xA),q6=e=>{const{__scopeDialog:t,children:r,open:o,defaultOpen:u,onOpenChange:m,modal:_=!0}=e,b=W.useRef(null),s=W.useRef(null),[k=!1,O]=hc({prop:o,defaultProp:u,onChange:m});return S.jsx(zse,{scope:t,triggerRef:b,contentRef:s,contentId:To(),titleId:To(),descriptionId:To(),open:k,onOpenChange:O,onOpenToggle:W.useCallback(()=>O(F=>!F),[O]),modal:_,children:r})};q6.displayName=xA;var Z6="DialogTrigger",X6=W.forwardRef((e,t)=>{const{__scopeDialog:r,...o}=e,u=Ua(Z6,r),m=gr(t,u.triggerRef);return S.jsx(jn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":u.open,"aria-controls":u.contentId,"data-state":wA(u.open),...o,ref:m,onClick:In(e.onClick,u.onOpenToggle)})});X6.displayName=Z6;var vA="DialogPortal",[Fse,Y6]=H6(vA,{forceMount:void 0}),K6=e=>{const{__scopeDialog:t,forceMount:r,children:o,container:u}=e,m=Ua(vA,t);return S.jsx(Fse,{scope:t,forceMount:r,children:W.Children.map(o,_=>S.jsx(ud,{present:r||m.open,children:S.jsx(jb,{asChild:!0,container:u,children:_})}))})};K6.displayName=vA;var q1="DialogOverlay",J6=W.forwardRef((e,t)=>{const r=Y6(q1,e.__scopeDialog),{forceMount:o=r.forceMount,...u}=e,m=Ua(q1,e.__scopeDialog);return m.modal?S.jsx(ud,{present:o||m.open,children:S.jsx(Bse,{...u,ref:t})}):null});J6.displayName=q1;var Bse=W.forwardRef((e,t)=>{const{__scopeDialog:r,...o}=e,u=Ua(q1,r);return S.jsx(Bb,{as:dc,allowPinchZoom:!0,shards:[u.contentRef],children:S.jsx(jn.div,{"data-state":wA(u.open),...o,ref:t,style:{pointerEvents:"auto",...o.style}})})}),Fh="DialogContent",Q6=W.forwardRef((e,t)=>{const r=Y6(Fh,e.__scopeDialog),{forceMount:o=r.forceMount,...u}=e,m=Ua(Fh,e.__scopeDialog);return S.jsx(ud,{present:o||m.open,children:m.modal?S.jsx(Vse,{...u,ref:t}):S.jsx(Use,{...u,ref:t})})});Q6.displayName=Fh;var Vse=W.forwardRef((e,t)=>{const r=Ua(Fh,e.__scopeDialog),o=W.useRef(null),u=gr(t,r.contentRef,o);return W.useEffect(()=>{const m=o.current;if(m)return zb(m)},[]),S.jsx(eV,{...e,ref:u,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:In(e.onCloseAutoFocus,m=>{var _;m.preventDefault(),(_=r.triggerRef.current)==null||_.focus()}),onPointerDownOutside:In(e.onPointerDownOutside,m=>{const _=m.detail.originalEvent,b=_.button===0&&_.ctrlKey===!0;(_.button===2||b)&&m.preventDefault()}),onFocusOutside:In(e.onFocusOutside,m=>m.preventDefault())})}),Use=W.forwardRef((e,t)=>{const r=Ua(Fh,e.__scopeDialog),o=W.useRef(!1),u=W.useRef(!1);return S.jsx(eV,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:m=>{var _,b;(_=e.onCloseAutoFocus)==null||_.call(e,m),m.defaultPrevented||(o.current||(b=r.triggerRef.current)==null||b.focus(),m.preventDefault()),o.current=!1,u.current=!1},onInteractOutside:m=>{var s,k;(s=e.onInteractOutside)==null||s.call(e,m),m.defaultPrevented||(o.current=!0,m.detail.originalEvent.type==="pointerdown"&&(u.current=!0));const _=m.target;((k=r.triggerRef.current)==null?void 0:k.contains(_))&&m.preventDefault(),m.detail.originalEvent.type==="focusin"&&u.current&&m.preventDefault()}})}),eV=W.forwardRef((e,t)=>{const{__scopeDialog:r,trapFocus:o,onOpenAutoFocus:u,onCloseAutoFocus:m,..._}=e,b=Ua(Fh,r),s=W.useRef(null),k=gr(t,s);return iA(),S.jsxs(S.Fragment,{children:[S.jsx(tx,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:u,onUnmountAutoFocus:m,children:S.jsx(Rb,{role:"dialog",id:b.contentId,"aria-describedby":b.descriptionId,"aria-labelledby":b.titleId,"data-state":wA(b.open),..._,ref:k,onDismiss:()=>b.onOpenChange(!1)})}),S.jsxs(S.Fragment,{children:[S.jsx($se,{titleId:b.titleId}),S.jsx(Wse,{contentRef:s,descriptionId:b.descriptionId})]})]})}),bA="DialogTitle",tV=W.forwardRef((e,t)=>{const{__scopeDialog:r,...o}=e,u=Ua(bA,r);return S.jsx(jn.h2,{id:u.titleId,...o,ref:t})});tV.displayName=bA;var nV="DialogDescription",rV=W.forwardRef((e,t)=>{const{__scopeDialog:r,...o}=e,u=Ua(nV,r);return S.jsx(jn.p,{id:u.descriptionId,...o,ref:t})});rV.displayName=nV;var iV="DialogClose",sV=W.forwardRef((e,t)=>{const{__scopeDialog:r,...o}=e,u=Ua(iV,r);return S.jsx(jn.button,{type:"button",...o,ref:t,onClick:In(e.onClick,()=>u.onOpenChange(!1))})});sV.displayName=iV;function wA(e){return e?"open":"closed"}var oV="DialogTitleWarning",[cde,aV]=Lse(oV,{contentName:Fh,titleName:bA,docsSlug:"dialog"}),$se=({titleId:e})=>{const t=aV(oV),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return W.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},Gse="DialogDescriptionWarning",Wse=({contentRef:e,descriptionId:t})=>{const o=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${aV(Gse).contentName}}.`;return W.useEffect(()=>{var m;const u=(m=e.current)==null?void 0:m.getAttribute("aria-describedby");t&&u&&(document.getElementById(t)||console.warn(o))},[o,e,t]),null},Hse=q6,qse=X6,Zse=K6,lV=J6,cV=Q6,uV=tV,dV=rV,Xse=sV;const $a=Hse,hV=qse,Yse=Zse,fV=W.forwardRef(({className:e,...t},r)=>S.jsx(lV,{ref:r,className:Zn("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));fV.displayName=lV.displayName;const sa=W.forwardRef(({className:e,children:t,...r},o)=>S.jsxs(Yse,{children:[S.jsx(fV,{}),S.jsxs(cV,{ref:o,className:Zn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[t,S.jsxs(Xse,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[S.jsx(eee,{className:"h-4 w-4"}),S.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));sa.displayName=cV.displayName;const oa=({className:e,...t})=>S.jsx("div",{className:Zn("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});oa.displayName="DialogHeader";const bl=({className:e,...t})=>S.jsx("div",{className:Zn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});bl.displayName="DialogFooter";const aa=W.forwardRef(({className:e,...t},r)=>S.jsx(uV,{ref:r,className:Zn("text-lg font-semibold leading-none tracking-tight",e),...t}));aa.displayName=uV.displayName;const la=W.forwardRef(({className:e,...t},r)=>S.jsx(dV,{ref:r,className:Zn("text-sm text-muted-foreground",e),...t}));la.displayName=dV.displayName;const no=[{value:"central",label:"Central Province"},{value:"eastern",label:"Eastern Province"},{value:"north-central",label:"North Central Province"},{value:"northern",label:"Northern Province"},{value:"north-western",label:"North Western Province"},{value:"sabaragamuwa",label:"Sabaragamuwa Province"},{value:"southern",label:"Southern Province"},{value:"uva",label:"Uva Province"},{value:"western",label:"Western Province"}],L_=e=>typeof e=="number"&&!isNaN(e),Th=e=>typeof e=="string",bo=e=>typeof e=="function",Yv=e=>Th(e)||bo(e)?e:null,KC=e=>W.isValidElement(e)||Th(e)||bo(e)||L_(e);function Kse(e,t,r){r===void 0&&(r=300);const{scrollHeight:o,style:u}=e;requestAnimationFrame(()=>{u.minHeight="initial",u.height=o+"px",u.transition=`all ${r}ms`,requestAnimationFrame(()=>{u.height="0",u.padding="0",u.margin="0",setTimeout(t,r)})})}function Gb(e){let{enter:t,exit:r,appendPosition:o=!1,collapse:u=!0,collapseDuration:m=300}=e;return function(_){let{children:b,position:s,preventExitTransition:k,done:O,nodeRef:F,isIn:q,playToast:H}=_;const J=o?`${t}--${s}`:t,U=o?`${r}--${s}`:r,te=W.useRef(0);return W.useLayoutEffect(()=>{const Q=F.current,ee=J.split(" "),re=xe=>{xe.target===F.current&&(H(),Q.removeEventListener("animationend",re),Q.removeEventListener("animationcancel",re),te.current===0&&xe.type!=="animationcancel"&&Q.classList.remove(...ee))};Q.classList.add(...ee),Q.addEventListener("animationend",re),Q.addEventListener("animationcancel",re)},[]),W.useEffect(()=>{const Q=F.current,ee=()=>{Q.removeEventListener("animationend",ee),u?Kse(Q,O,m):O()};q||(k?ee():(te.current=1,Q.className+=` ${U}`,Q.addEventListener("animationend",ee)))},[q]),Gn.createElement(Gn.Fragment,null,b)}}function ZO(e,t){return e!=null?{content:e.content,containerId:e.props.containerId,id:e.props.toastId,theme:e.props.theme,type:e.props.type,data:e.props.data||{},isLoading:e.props.isLoading,icon:e.props.icon,status:t}:{}}const Ls=new Map;let O_=[];const JC=new Set,Jse=e=>JC.forEach(t=>t(e)),pV=()=>Ls.size>0;function mV(e,t){var r;if(t)return!((r=Ls.get(t))==null||!r.isToastActive(e));let o=!1;return Ls.forEach(u=>{u.isToastActive(e)&&(o=!0)}),o}function gV(e,t){KC(e)&&(pV()||O_.push({content:e,options:t}),Ls.forEach(r=>{r.buildToast(e,t)}))}function XO(e,t){Ls.forEach(r=>{t!=null&&t!=null&&t.containerId?(t==null?void 0:t.containerId)===r.id&&r.toggle(e,t==null?void 0:t.id):r.toggle(e,t==null?void 0:t.id)})}function Qse(e){const{subscribe:t,getSnapshot:r,setProps:o}=W.useRef(function(m){const _=m.containerId||1;return{subscribe(b){const s=function(O,F,q){let H=1,J=0,U=[],te=[],Q=[],ee=F;const re=new Map,xe=new Set,Ee=()=>{Q=Array.from(re.values()),xe.forEach(Ne=>Ne())},He=Ne=>{te=Ne==null?[]:te.filter(ft=>ft!==Ne),Ee()},qe=Ne=>{const{toastId:ft,onOpen:ut,updateId:mt,children:pt}=Ne.props,en=mt==null;Ne.staleId&&re.delete(Ne.staleId),re.set(ft,Ne),te=[...te,Ne.props.toastId].filter(Yt=>Yt!==Ne.staleId),Ee(),q(ZO(Ne,en?"added":"updated")),en&&bo(ut)&&ut(W.isValidElement(pt)&&pt.props)};return{id:O,props:ee,observe:Ne=>(xe.add(Ne),()=>xe.delete(Ne)),toggle:(Ne,ft)=>{re.forEach(ut=>{ft!=null&&ft!==ut.props.toastId||bo(ut.toggle)&&ut.toggle(Ne)})},removeToast:He,toasts:re,clearQueue:()=>{J-=U.length,U=[]},buildToast:(Ne,ft)=>{if((Un=>{let{containerId:wr,toastId:Ut,updateId:Cr}=Un;const or=wr?wr!==O:O!==1,Qt=re.has(Ut)&&Cr==null;return or||Qt})(ft))return;const{toastId:ut,updateId:mt,data:pt,staleId:en,delay:Yt}=ft,dn=()=>{He(ut)},It=mt==null;It&&J++;const Et={...ee,style:ee.toastStyle,key:H++,...Object.fromEntries(Object.entries(ft).filter(Un=>{let[wr,Ut]=Un;return Ut!=null})),toastId:ut,updateId:mt,data:pt,closeToast:dn,isIn:!1,className:Yv(ft.className||ee.toastClassName),bodyClassName:Yv(ft.bodyClassName||ee.bodyClassName),progressClassName:Yv(ft.progressClassName||ee.progressClassName),autoClose:!ft.isLoading&&(tt=ft.autoClose,Ft=ee.autoClose,tt===!1||L_(tt)&&tt>0?tt:Ft),deleteToast(){const Un=re.get(ut),{onClose:wr,children:Ut}=Un.props;bo(wr)&&wr(W.isValidElement(Ut)&&Ut.props),q(ZO(Un,"removed")),re.delete(ut),J--,J<0&&(J=0),U.length>0?qe(U.shift()):Ee()}};var tt,Ft;Et.closeButton=ee.closeButton,ft.closeButton===!1||KC(ft.closeButton)?Et.closeButton=ft.closeButton:ft.closeButton===!0&&(Et.closeButton=!KC(ee.closeButton)||ee.closeButton);let St=Ne;W.isValidElement(Ne)&&!Th(Ne.type)?St=W.cloneElement(Ne,{closeToast:dn,toastProps:Et,data:pt}):bo(Ne)&&(St=Ne({closeToast:dn,toastProps:Et,data:pt}));const hn={content:St,props:Et,staleId:en};ee.limit&&ee.limit>0&&J>ee.limit&&It?U.push(hn):L_(Yt)?setTimeout(()=>{qe(hn)},Yt):qe(hn)},setProps(Ne){ee=Ne},setToggle:(Ne,ft)=>{re.get(Ne).toggle=ft},isToastActive:Ne=>te.some(ft=>ft===Ne),getSnapshot:()=>ee.newestOnTop?Q.reverse():Q}}(_,m,Jse);Ls.set(_,s);const k=s.observe(b);return O_.forEach(O=>gV(O.content,O.options)),O_=[],()=>{k(),Ls.delete(_)}},setProps(b){var s;(s=Ls.get(_))==null||s.setProps(b)},getSnapshot(){var b;return(b=Ls.get(_))==null?void 0:b.getSnapshot()}}}(e)).current;o(e);const u=W.useSyncExternalStore(t,r,r);return{getToastToRender:function(m){if(!u)return[];const _=new Map;return u.forEach(b=>{const{position:s}=b.props;_.has(s)||_.set(s,[]),_.get(s).push(b)}),Array.from(_,b=>m(b[0],b[1]))},isToastActive:mV,count:u==null?void 0:u.length}}function eoe(e){const[t,r]=W.useState(!1),[o,u]=W.useState(!1),m=W.useRef(null),_=W.useRef({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:b,pauseOnHover:s,closeToast:k,onClick:O,closeOnClick:F}=e;var q,H;function J(){r(!0)}function U(){r(!1)}function te(re){const xe=m.current;_.canDrag&&xe&&(_.didMove=!0,t&&U(),_.delta=e.draggableDirection==="x"?re.clientX-_.start:re.clientY-_.start,_.start!==re.clientX&&(_.canCloseOnClick=!1),xe.style.transform=`translate3d(${e.draggableDirection==="x"?`${_.delta}px, var(--y)`:`0, calc(${_.delta}px + var(--y))`},0)`,xe.style.opacity=""+(1-Math.abs(_.delta/_.removalDistance)))}function Q(){document.removeEventListener("pointermove",te),document.removeEventListener("pointerup",Q);const re=m.current;if(_.canDrag&&_.didMove&&re){if(_.canDrag=!1,Math.abs(_.delta)>_.removalDistance)return u(!0),e.closeToast(),void e.collapseAll();re.style.transition="transform 0.2s, opacity 0.2s",re.style.removeProperty("transform"),re.style.removeProperty("opacity")}}(H=Ls.get((q={id:e.toastId,containerId:e.containerId,fn:r}).containerId||1))==null||H.setToggle(q.id,q.fn),W.useEffect(()=>{if(e.pauseOnFocusLoss)return document.hasFocus()||U(),window.addEventListener("focus",J),window.addEventListener("blur",U),()=>{window.removeEventListener("focus",J),window.removeEventListener("blur",U)}},[e.pauseOnFocusLoss]);const ee={onPointerDown:function(re){if(e.draggable===!0||e.draggable===re.pointerType){_.didMove=!1,document.addEventListener("pointermove",te),document.addEventListener("pointerup",Q);const xe=m.current;_.canCloseOnClick=!0,_.canDrag=!0,xe.style.transition="none",e.draggableDirection==="x"?(_.start=re.clientX,_.removalDistance=xe.offsetWidth*(e.draggablePercent/100)):(_.start=re.clientY,_.removalDistance=xe.offsetHeight*(e.draggablePercent===80?1.5*e.draggablePercent:e.draggablePercent)/100)}},onPointerUp:function(re){const{top:xe,bottom:Ee,left:He,right:qe}=m.current.getBoundingClientRect();re.nativeEvent.type!=="touchend"&&e.pauseOnHover&&re.clientX>=He&&re.clientX<=qe&&re.clientY>=xe&&re.clientY<=Ee?U():J()}};return b&&s&&(ee.onMouseEnter=U,e.stacked||(ee.onMouseLeave=J)),F&&(ee.onClick=re=>{O&&O(re),_.canCloseOnClick&&k()}),{playToast:J,pauseToast:U,isRunning:t,preventExitTransition:o,toastRef:m,eventHandlers:ee}}function toe(e){let{delay:t,isRunning:r,closeToast:o,type:u="default",hide:m,className:_,style:b,controlledProgress:s,progress:k,rtl:O,isIn:F,theme:q}=e;const H=m||s&&k===0,J={...b,animationDuration:`${t}ms`,animationPlayState:r?"running":"paused"};s&&(J.transform=`scaleX(${k})`);const U=Jl("Toastify__progress-bar",s?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${q}`,`Toastify__progress-bar--${u}`,{"Toastify__progress-bar--rtl":O}),te=bo(_)?_({rtl:O,type:u,defaultClassName:U}):Jl(U,_),Q={[s&&k>=1?"onTransitionEnd":"onAnimationEnd"]:s&&k<1?null:()=>{F&&o()}};return Gn.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":H},Gn.createElement("div",{className:`Toastify__progress-bar--bg Toastify__progress-bar-theme--${q} Toastify__progress-bar--${u}`}),Gn.createElement("div",{role:"progressbar","aria-hidden":H?"true":"false","aria-label":"notification timer",className:te,style:J,...Q}))}let noe=1;const yV=()=>""+noe++;function roe(e){return e&&(Th(e.toastId)||L_(e.toastId))?e.toastId:yV()}function t_(e,t){return gV(e,t),t.toastId}function Z1(e,t){return{...t,type:t&&t.type||e,toastId:roe(t)}}function wv(e){return(t,r)=>t_(t,Z1(e,r))}function Fr(e,t){return t_(e,Z1("default",t))}Fr.loading=(e,t)=>t_(e,Z1("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...t})),Fr.promise=function(e,t,r){let o,{pending:u,error:m,success:_}=t;u&&(o=Th(u)?Fr.loading(u,r):Fr.loading(u.render,{...r,...u}));const b={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},s=(O,F,q)=>{if(F==null)return void Fr.dismiss(o);const H={type:O,...b,...r,data:q},J=Th(F)?{render:F}:F;return o?Fr.update(o,{...H,...J}):Fr(J.render,{...H,...J}),q},k=bo(e)?e():e;return k.then(O=>s("success",_,O)).catch(O=>s("error",m,O)),k},Fr.success=wv("success"),Fr.info=wv("info"),Fr.error=wv("error"),Fr.warning=wv("warning"),Fr.warn=Fr.warning,Fr.dark=(e,t)=>t_(e,Z1("default",{theme:"dark",...t})),Fr.dismiss=function(e){(function(t){var r;if(pV()){if(t==null||Th(r=t)||L_(r))Ls.forEach(o=>{o.removeToast(t)});else if(t&&("containerId"in t||"id"in t)){const o=Ls.get(t.containerId);o?o.removeToast(t.id):Ls.forEach(u=>{u.removeToast(t.id)})}}else O_=O_.filter(o=>t!=null&&o.options.toastId!==t)})(e)},Fr.clearWaitingQueue=function(e){e===void 0&&(e={}),Ls.forEach(t=>{!t.props.limit||e.containerId&&t.id!==e.containerId||t.clearQueue()})},Fr.isActive=mV,Fr.update=function(e,t){t===void 0&&(t={});const r=((o,u)=>{var m;let{containerId:_}=u;return(m=Ls.get(_||1))==null?void 0:m.toasts.get(o)})(e,t);if(r){const{props:o,content:u}=r,m={delay:100,...o,...t,toastId:t.toastId||e,updateId:yV()};m.toastId!==e&&(m.staleId=e);const _=m.render||u;delete m.render,t_(_,m)}},Fr.done=e=>{Fr.update(e,{progress:1})},Fr.onChange=function(e){return JC.add(e),()=>{JC.delete(e)}},Fr.play=e=>XO(!0,e),Fr.pause=e=>XO(!1,e);const ioe=typeof window<"u"?W.useLayoutEffect:W.useEffect,Sv=e=>{let{theme:t,type:r,isLoading:o,...u}=e;return Gn.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:t==="colored"?"currentColor":`var(--toastify-icon-color-${r})`,...u})},tE={info:function(e){return Gn.createElement(Sv,{...e},Gn.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(e){return Gn.createElement(Sv,{...e},Gn.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(e){return Gn.createElement(Sv,{...e},Gn.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(e){return Gn.createElement(Sv,{...e},Gn.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return Gn.createElement("div",{className:"Toastify__spinner"})}},soe=e=>{const{isRunning:t,preventExitTransition:r,toastRef:o,eventHandlers:u,playToast:m}=eoe(e),{closeButton:_,children:b,autoClose:s,onClick:k,type:O,hideProgressBar:F,closeToast:q,transition:H,position:J,className:U,style:te,bodyClassName:Q,bodyStyle:ee,progressClassName:re,progressStyle:xe,updateId:Ee,role:He,progress:qe,rtl:Ne,toastId:ft,deleteToast:ut,isIn:mt,isLoading:pt,closeOnClick:en,theme:Yt}=e,dn=Jl("Toastify__toast",`Toastify__toast-theme--${Yt}`,`Toastify__toast--${O}`,{"Toastify__toast--rtl":Ne},{"Toastify__toast--close-on-click":en}),It=bo(U)?U({rtl:Ne,position:J,type:O,defaultClassName:dn}):Jl(dn,U),Et=function(hn){let{theme:Un,type:wr,isLoading:Ut,icon:Cr}=hn,or=null;const Qt={theme:Un,type:wr};return Cr===!1||(bo(Cr)?or=Cr({...Qt,isLoading:Ut}):W.isValidElement(Cr)?or=W.cloneElement(Cr,Qt):Ut?or=tE.spinner():(dr=>dr in tE)(wr)&&(or=tE[wr](Qt))),or}(e),tt=!!qe||!s,Ft={closeToast:q,type:O,theme:Yt};let St=null;return _===!1||(St=bo(_)?_(Ft):W.isValidElement(_)?W.cloneElement(_,Ft):function(hn){let{closeToast:Un,theme:wr,ariaLabel:Ut="close"}=hn;return Gn.createElement("button",{className:`Toastify__close-button Toastify__close-button--${wr}`,type:"button",onClick:Cr=>{Cr.stopPropagation(),Un(Cr)},"aria-label":Ut},Gn.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},Gn.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}(Ft)),Gn.createElement(H,{isIn:mt,done:ut,position:J,preventExitTransition:r,nodeRef:o,playToast:m},Gn.createElement("div",{id:ft,onClick:k,"data-in":mt,className:It,...u,style:te,ref:o},Gn.createElement("div",{...mt&&{role:He},className:bo(Q)?Q({type:O}):Jl("Toastify__toast-body",Q),style:ee},Et!=null&&Gn.createElement("div",{className:Jl("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!pt})},Et),Gn.createElement("div",null,b)),St,Gn.createElement(toe,{...Ee&&!tt?{key:`pb-${Ee}`}:{},rtl:Ne,theme:Yt,delay:s,isRunning:t,isIn:mt,closeToast:q,hide:F,type:O,style:xe,className:re,controlledProgress:tt,progress:qe||0})))},Wb=function(e,t){return t===void 0&&(t=!1),{enter:`Toastify--animate Toastify__${e}-enter`,exit:`Toastify--animate Toastify__${e}-exit`,appendPosition:t}},SA=Gb(Wb("bounce",!0));Gb(Wb("slide",!0));Gb(Wb("zoom"));Gb(Wb("flip"));const ooe={position:"top-right",transition:SA,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light"};function aoe(e){let t={...ooe,...e};const r=e.stacked,[o,u]=W.useState(!0),m=W.useRef(null),{getToastToRender:_,isToastActive:b,count:s}=Qse(t),{className:k,style:O,rtl:F,containerId:q}=t;function H(U){const te=Jl("Toastify__toast-container",`Toastify__toast-container--${U}`,{"Toastify__toast-container--rtl":F});return bo(k)?k({position:U,rtl:F,defaultClassName:te}):Jl(te,Yv(k))}function J(){r&&(u(!0),Fr.play())}return ioe(()=>{if(r){var U;const te=m.current.querySelectorAll('[data-in="true"]'),Q=12,ee=(U=t.position)==null?void 0:U.includes("top");let re=0,xe=0;Array.from(te).reverse().forEach((Ee,He)=>{const qe=Ee;qe.classList.add("Toastify__toast--stacked"),He>0&&(qe.dataset.collapsed=`${o}`),qe.dataset.pos||(qe.dataset.pos=ee?"top":"bot");const Ne=re*(o?.2:1)+(o?0:Q*He);qe.style.setProperty("--y",`${ee?Ne:-1*Ne}px`),qe.style.setProperty("--g",`${Q}`),qe.style.setProperty("--s",""+(1-(o?xe:0))),re+=qe.offsetHeight,xe+=.025})}},[o,s,r]),Gn.createElement("div",{ref:m,className:"Toastify",id:q,onMouseEnter:()=>{r&&(u(!1),Fr.pause())},onMouseLeave:J},_((U,te)=>{const Q=te.length?{...O}:{...O,pointerEvents:"none"};return Gn.createElement("div",{className:H(U),style:Q,key:`container-${U}`},te.map(ee=>{let{content:re,props:xe}=ee;return Gn.createElement(soe,{...xe,stacked:r,collapseAll:J,isIn:b(xe.toastId,xe.containerId),style:xe.style,key:`toast-${xe.key}`},re)}))}))}const fi=e=>{Fr.success(e,{position:"top-right",autoClose:5e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored",transition:SA})},Mn=e=>{Fr.error(e,{position:"top-right",autoClose:5e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored",transition:SA})},loe=()=>{const[e,t]=W.useState(),[r,o]=W.useState("all"),[u,m]=W.useState("all"),[_,b]=W.useState(""),[s,k]=W.useState([]),[O,F]=W.useState([]),q=async()=>{await Jt.get("/event").then(({data:H})=>{F(H==null?void 0:H.events),k(H==null?void 0:H.events)}).catch(()=>{Mn("Failed to load data")})};return W.useEffect(()=>{q()},[]),W.useEffect(()=>{const H=O.filter(J=>!(e&&(e<new Date(J.start).setHours(0,0,0,0)||e>new Date(J.end))||r!=="all"&&J.province.toLowerCase()!==r||u!=="all"&&J.category.toLowerCase()!==u||_&&!J.title.toLowerCase().includes(_.toLowerCase())));k(H)},[e,r,u,_,O]),S.jsxs("div",{className:"flex min-h-screen flex-col",children:[S.jsx(ko,{}),S.jsxs("section",{className:"container mx-auto mt-20 px-4 py-8",children:[S.jsx("h1",{className:"mb-8 text-center text-2xl font-medium md:text-3xl",children:"Upcoming Events"}),S.jsx("div",{className:"mb-5 flex justify-center",children:S.jsx(bn,{placeholder:"Search events...",className:"max-w-lg border-sky-600/80 !outline-0 !ring-0",value:_,onChange:H=>b(H.target.value)})}),S.jsx("div",{className:"mb-10 flex justify-center",children:S.jsxs("div",{className:"grid w-full max-w-5xl grid-cols-1 gap-2 sm:grid-cols-2 lg:grid-cols-3",children:[S.jsxs(lm,{children:[S.jsx(cm,{asChild:!0,children:S.jsxs(Pn,{variant:"outline",className:Zn("w-full justify-start border-gray-400/80 text-left font-normal hover:bg-white sm:col-span-2 lg:col-span-1",!e&&"text-muted-foreground"),children:[S.jsx(gl,{className:"mr-2 h-4 w-4"}),e?Ei(e,"PPP"):S.jsx("span",{children:"Pick a date"})]})}),S.jsx(jh,{className:"w-auto p-0",align:"start",children:S.jsx(Lh,{mode:"single",selected:e,onSelect:t,initialFocus:!0,disabled:H=>H<new Date(new Date().setHours(0,0,0,0))})})]}),S.jsxs(Ci,{defaultValue:"all",onValueChange:H=>o(H),children:[S.jsx(_i,{className:"w-full border-gray-400/80",children:S.jsx(Mi,{placeholder:"Select a location"})}),S.jsx(xi,{children:S.jsxs(Pi,{children:[S.jsx(ii,{value:"all",children:"All Locations"}),no.map(H=>S.jsx(ii,{value:H.value,children:H.label},H.value))]})})]}),S.jsxs(Ci,{defaultValue:"all",onValueChange:H=>m(H),children:[S.jsx(_i,{className:"w-full border-gray-400/80",children:S.jsx(Mi,{placeholder:"Select a type"})}),S.jsx(xi,{children:S.jsxs(Pi,{children:[S.jsx(ii,{value:"all",children:"All Types"}),e_.map(H=>S.jsx(ii,{value:H.value,children:H.label},H.value))]})})]})]})}),S.jsx(coe,{items:s})]}),S.jsx("div",{className:"flex-grow"}),S.jsx(Ro,{})]})},coe=({items:e})=>e!=null&&e.length?S.jsx("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:e==null?void 0:e.map(t=>S.jsxs("div",{className:"w-full max-w-md rounded-lg bg-white shadow-md drop-shadow-xl",children:[S.jsx("img",{src:"http://localhost:8000/"+(t==null?void 0:t.image)+`?${new Date().getSeconds()}`,alt:"gallery",className:"h-48 w-full rounded-lg object-cover"}),S.jsxs("div",{className:"p-4",children:[S.jsxs("h2",{className:"mb-2 line-clamp-2 font-medium",children:[t.title,S.jsx("span",{className:"flex w-fit rounded bg-fuchsia-700 px-2 py-0.5 text-xs text-white",children:t.category})]}),S.jsxs("p",{className:"flex items-end gap-x-1 text-xs text-gray-600",children:[S.jsx(uc,{className:"-ms-1 size-5 text-red-600"}),t.city," , ",t.province," Province"]}),S.jsxs("p",{className:"mt-1 flex items-end gap-x-1 text-xs text-gray-600",children:[S.jsx(gl,{className:"size-4 text-red-600"}),Ei(new Date(t.start),"PPP")," -"," ",Ei(new Date(t.end),"PPP")]}),S.jsx("div",{className:"flex justify-center",children:S.jsxs($a,{children:[S.jsx(hV,{children:S.jsx(Pn,{className:"mt-5 border-sky-800 duration-300 hover:bg-sky-800 hover:text-white",variant:"outline",size:"sm",children:"More Details"})}),S.jsxs(sa,{children:[S.jsxs(oa,{children:[S.jsxs(aa,{children:[t.title,S.jsx("span",{className:"ms-2 rounded bg-fuchsia-700 px-2 py-0.5 text-xs text-white",children:t.category})]}),S.jsx(la,{children:"More details about the event and the location."})]}),S.jsxs("div",{className:"",children:[S.jsx("img",{src:"http://localhost:8000/"+(t==null?void 0:t.image)+`?${new Date().getSeconds()}`,alt:"gallery",className:"my-3 h-48 w-full rounded-lg object-cover"}),S.jsxs("p",{className:"flex items-end gap-x-1 text-xs text-gray-600",children:[S.jsx(uc,{className:"-ms-1 size-5 text-red-600"}),t.city," , ",t.province," Province"]}),S.jsxs("p",{className:"mt-1 flex items-end gap-x-1 text-xs text-gray-600",children:[S.jsx(gl,{className:"size-4 text-red-600"}),Ei(new Date(t.start),"PPP")," -"," ",Ei(new Date(t.end),"PPP")]}),S.jsx("p",{className:"mt-2 line-clamp-4 text-sm text-gray-700",children:t.description})]})]})]})})]})]},t.id))}):S.jsx("div",{className:"flex w-full items-center justify-center pt-5",children:S.jsx("h1",{className:"text-gray-600",children:"No events found"})}),uoe=()=>S.jsxs("div",{className:"flex min-h-screen flex-col",children:[S.jsx(ko,{}),S.jsx("div",{className:"flex-grow"}),S.jsxs("section",{className:"container mx-auto mt-20 px-4 py-8",children:[S.jsx("h1",{className:"mb-8 text-center text-2xl font-medium md:text-3xl",children:"About Us"}),S.jsx("p",{className:"text-gray-800",children:"Your ultimate travel companion for exploring the wonders of Sri Lanka. Our mission is to enhance your travel experience by offering personalized travel packages and tailored recommendations that align with your interests, budget, and travel goals. At CeyVoy, we understand that every traveler is unique, which is why we provide custom itineraries designed just for you. Our user-friendly platform allows you to easily plan your trips, discover new destinations, and access valuable insights and updates to make your journey memorable. Whether you're a traveler, tour guide, or accommodation provider, CeyVoy is here to ensure that your travel plans are seamless, enjoyable, and unforgettable. Join us on this journey and discover the beauty of Sri Lanka with personalized precision and care."}),S.jsxs("div",{className:"mt-5 flex flex-col items-center justify-center",children:[S.jsx(fM,{}),S.jsx("p",{className:"text-xs text-gray-700",children:"CeyVoy is a registered trademark of CeyVoy (Pvt) Ltd."})]})]}),S.jsx("div",{className:"flex-grow"}),S.jsx(Ro,{})]}),ca=W.forwardRef(({className:e,...t},r)=>S.jsx("textarea",{className:Zn("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...t}));ca.displayName="Textarea";var doe="Label",_V=W.forwardRef((e,t)=>S.jsx(jn.label,{...e,ref:t,onMouseDown:r=>{var u;r.target.closest("button, input, select, textarea")||((u=e.onMouseDown)==null||u.call(e,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));_V.displayName=doe;var xV=_V;const hoe=dB("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),jt=W.forwardRef(({className:e,...t},r)=>S.jsx(xV,{ref:r,className:Zn(hoe(),e),...t}));jt.displayName=xV.displayName;const foe=()=>{const[e,t]=W.useState({name:"",email:"",subject:"",message:""}),[r,o]=W.useState({name:"",email:"",subject:"",message:""}),[u,m]=W.useState(!1),_=k=>k.name?k.email?k.subject?k.message?!0:(o(O=>({...O,message:"Message is required"})),!1):(o(O=>({...O,subject:"Subject is required"})),!1):(o(O=>({...O,email:"Email is required"})),!1):(o(O=>({...O,name:"Name is required"})),!1),b=k=>{t(O=>({...O,[k.target.name]:k.target.value})),o(O=>({...O,[k.target.name]:""})),_(Object.assign({},e,{[k.target.name]:k.target.value}))},s=k=>{if(k.preventDefault(),!_(e))return;const O=new FormData;m(!0),O.append("name",e.name),O.append("email",e.email),O.append("subject",e.subject),O.append("message",e.message),Jt.post("/contact",O).then(()=>{fi("Message sent successfully")}).catch(()=>{Mn("Failed to send message")}).finally(()=>{m(!1)})};return S.jsxs("div",{className:"flex min-h-screen flex-col",children:[S.jsx(ko,{}),S.jsxs("section",{className:"container mx-auto mt-20 px-4 py-8",children:[S.jsx("h1",{className:"mb-8 text-center text-2xl font-medium md:text-3xl",children:"Contact Us"}),S.jsxs("div",{className:"flex w-full flex-col gap-5 lg:flex-row",children:[S.jsxs("form",{onSubmit:s,onChange:b,className:"flex w-full flex-col items-center justify-center lg:w-1/2",children:[S.jsxs("div",{className:"w-full",children:[S.jsx(jt,{htmlFor:"name",children:"Your Name"}),S.jsx(bn,{id:"name",name:"name",type:"text",placeholder:"John Doe",maxLength:"50",className:"w-full rounded-md border border-gray-400/80 p-2"}),r.name&&S.jsx("p",{className:"text-sm text-red-500",children:r.name})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"email",children:"Your Email"}),S.jsx(bn,{id:"email",name:"email",type:"email",maxLength:"50",placeholder:"john@example.com",className:"w-full border-gray-400/80 p-2"}),r.email&&S.jsx("p",{className:"text-sm text-red-500",children:r.email})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"subject",children:"Subject"}),S.jsx(bn,{id:"subject",name:"subject",type:"text",maxLength:"100",placeholder:"Subject of your message",className:"w-full border-gray-400/80 p-2"}),r.subject&&S.jsx("p",{className:"text-sm text-red-500",children:r.subject})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"message",children:"Message"}),S.jsx(ca,{id:"message",name:"message",rows:"10",maxLength:"500",placeholder:"Enter your message here",className:"w-full border-gray-400/80 p-2"}),r.message&&S.jsx("p",{className:"text-sm text-red-500",children:r.message})]}),S.jsx(Pn,{className:"mt-4 w-full max-w-lg rounded-md bg-sky-700 px-4 py-2 text-white",children:u?"Sending...":"Send Message"})]}),S.jsx("div",{className:"hidden w-full items-center justify-center lg:flex lg:w-1/2",children:S.jsx("img",{src:"/images/slide01.jpg",alt:"contact us",className:"h-full w-full rounded-md object-cover"})})]})]}),S.jsx("div",{className:"flex-grow"}),S.jsx(Ro,{})]})},poe=()=>{const[e,t]=W.useState({email:"",password:""}),[r,o]=W.useState({email:"",password:""}),[u,m]=W.useState(!1),[_,b]=W.useState(!1),s=yc(),k=xl(),O=J=>J.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(J.email)?J.password?J.password.length<8?(o(U=>({...U,password:"Password must be at least 8 characters"})),!1):!0:(o(U=>({...U,password:"Password is required"})),!1):(o(U=>({...U,email:"Invalid email"})),!1):(o(U=>({...U,email:"Email is required"})),!1),F=J=>{t(U=>({...U,[J.target.name]:J.target.value})),o(U=>({...U,[J.target.name]:""}))},q=async J=>{if(J.preventDefault(),!O(e))return;m(!0),o({email:"",password:""});const U=new FormData;Object.keys(e).forEach(te=>U.append(te,e[te])),await Jt.post("/login",U).then(({data:te})=>{fi(te.message),te!=null&&te.user&&k(fm(te==null?void 0:te.user)),s((te==null?void 0:te.redirect)||"/")}).catch(te=>{const Q=te.response.data;if(te.response.status===500)return Mn(Q.message);Q.property==="not_verified"&&b(!0),o(ee=>({...ee,[Q==null?void 0:Q.property]:Q.message}))}).finally(()=>{m(!1)})},H=async()=>{m(!0);const J=new FormData;J.append("email",e.email),await Jt.post("/resend_verification",J).then(({data:U})=>{fi(U.message),b(!1)}).catch(U=>{const te=U.response.data;Mn(te.message)}).finally(()=>{m(!1)})};return S.jsxs("div",{className:"flex min-h-screen flex-col",children:[S.jsx(ko,{}),S.jsx("div",{className:"flex-grow"}),S.jsx("section",{className:"container mx-auto mt-20 px-4 py-8",children:S.jsxs("div",{className:"flex w-full flex-col gap-5 rounded-md border border-gray-300/60 bg-white shadow-sm drop-shadow-xl lg:flex-row",children:[!_&&S.jsxs("form",{onSubmit:q,onChange:F,className:"flex w-full flex-col items-center justify-center p-6 lg:w-1/2",children:[S.jsx("h1",{className:"mb-1 w-full text-2xl font-medium text-gray-800",children:"Sign in"}),S.jsx("p",{className:"mb-3 w-full text-xs text-gray-600",children:"Login to unlock the full experience and plan your next adventure with ease"}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"email",children:"Email"}),S.jsx(bn,{id:"email",name:"email",type:"email",maxLength:"50",placeholder:"john@example.com",className:"w-full border-gray-400/80 p-2"}),r.email&&S.jsx("p",{className:"text-sm text-red-500",children:r.email})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsxs(jt,{htmlFor:"password",className:"flex w-full justify-between",children:[S.jsx("span",{children:"Password"}),S.jsx(ui,{to:"/forgot-password",className:"mb-1 text-xs font-medium text-gray-700 hover:text-sky-700",children:"Forgot password?"})]}),S.jsx(bn,{id:"password",name:"password",type:"password",maxLength:"100",placeholder:"********",className:"w-full border-gray-400/80 p-2"}),r.password&&S.jsx("p",{className:"text-sm text-red-500",children:r.password})]}),S.jsx(Pn,{disabled:u,className:"mt-4 w-full max-w-lg rounded-md bg-sky-700 px-4 py-2 text-white",children:u?"Loading...":"Sign In"}),S.jsxs("p",{className:"mt-4 text-sm text-gray-600",children:["Don't have an account?"," ",S.jsx(ui,{to:"/sign-up",className:"ms-1 text-sky-700 hover:underline",children:"Sign Up"})]})]}),_&&S.jsxs("div",{className:"flex w-full flex-col flex-wrap items-center justify-center p-6 lg:w-1/2",children:[S.jsxs("div",{className:"text-sm text-red-500",children:["Your account is not verified. Please verify your account by clicking link sent to your email",S.jsx(Pn,{type:"button",disabled:u,variant:"ghost",className:"ms-2 p-0 text-emerald-700 hover:bg-transparent hover:underline",onClick:H,children:u?"Waiting...":"Resend verification email"})]}),S.jsx(Pn,{className:"mt-4 w-full max-w-md rounded-md bg-sky-700 px-4 py-2 text-white",onClick:()=>b(!1),children:"Login with another account"})]}),S.jsx("div",{className:"hidden min-h-[30rem] w-full items-center justify-center lg:flex lg:w-1/2",children:S.jsx("img",{src:"/images/slide01.jpg",alt:"contact us",className:"h-full w-full rounded-r-md object-cover"})})]})}),S.jsx("div",{className:"flex-grow"}),S.jsx(Ro,{})]})},YO={role:"",name:"",email:"",password:"",confirmPassword:""},KO={role:"TRAVELER",email:"",password:"",confirmPassword:""},moe=()=>{const[e,t]=W.useState(KO),[r,o]=W.useState(YO),[u,m]=W.useState(!1),_=yc(),b=O=>O.role?O.name?O.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(O.email)?O.password?O.password.length<8?(o(F=>({...F,password:"Password must be at least 8 characters"})),!1):O.password!==O.confirmPassword?(o(F=>({...F,confirmPassword:"Passwords do not match"})),!1):!0:(o(F=>({...F,password:"Password is required"})),!1):(o(F=>({...F,email:"Invalid email"})),!1):(o(F=>({...F,email:"Email is required"})),!1):(o(F=>({...F,name:"Name is required"})),!1):(o(F=>({...F,role:"Role is required"})),!1),s=O=>{t(F=>({...F,[O.target.name]:O.target.value})),o(F=>({...F,[O.target.name]:""}))},k=async O=>{if(O.preventDefault(),!b(e))return;m(!0),o(YO);const F=new FormData;Object.keys(e).forEach(q=>F.append(q,e[q])),await Jt.post("/sign_up",F).then(({data:q})=>{fi(q.message),t(KO),_("/login")}).catch(q=>{const H=q.response.data;if(q.response.status===500)return Mn(H.message);o(J=>({...J,[H==null?void 0:H.property]:H.message}))}).finally(()=>{m(!1)})};return S.jsxs("div",{className:"flex min-h-screen flex-col",children:[S.jsx(ko,{}),S.jsx("div",{className:"flex-grow"}),S.jsx("section",{className:"container mx-auto mt-20 px-4 py-8",children:S.jsxs("div",{className:"flex w-full flex-col gap-5 rounded-md border border-gray-300/60 bg-white shadow-sm drop-shadow-xl lg:flex-row",children:[S.jsxs("form",{onSubmit:k,onChange:s,className:"flex w-full flex-col items-center justify-center p-6 lg:w-4/5 xl:w-1/2",children:[S.jsx("h1",{className:"mb-1 w-full text-2xl font-medium text-gray-800",children:"Sign Up"}),S.jsx("p",{className:"mb-3 w-full text-xs text-gray-600",children:"Create an account to plan a new trip"}),S.jsxs("div",{className:"w-full",children:[S.jsx(jt,{children:"Register as"}),S.jsx("div",{className:"flex w-full flex-col gap-1 sm:flex-row",children:["TRAVELER","GUIDE","ACCOMMODATIONS"].map(O=>S.jsxs("label",{htmlFor:O,className:"w-full",children:[S.jsx("input",{checked:e.role===O,onChange:s,type:"radio",id:O,name:"role",value:O,className:"peer sr-only"}),S.jsxs("div",{className:"flex h-10 w-full cursor-pointer items-center justify-center rounded-md bg-gray-700 p-2 text-center text-sm font-medium capitalize text-white peer-checked:bg-sky-700",children:[O.toLowerCase(),e.role===O&&S.jsx(GF,{className:"ms-2 inline-block h-5 w-5"})]})]},O))}),r.role&&S.jsx("p",{className:"text-sm text-red-500",children:r.role})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"name",children:"Name"}),S.jsx(bn,{id:"name",name:"name",type:"text",maxLength:"50",placeholder:"John Doe",className:"w-full border-gray-400/80 p-2"}),r.name&&S.jsx("p",{className:"text-sm text-red-500",children:r.name})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"email",children:"Email"}),S.jsx(bn,{id:"email",name:"email",type:"email",maxLength:"50",placeholder:"john@example.com",className:"w-full border-gray-400/80 p-2"}),r.email&&S.jsx("p",{className:"text-sm text-red-500",children:r.email})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"password",children:"Password"}),S.jsx(bn,{id:"password",name:"password",type:"password",maxLength:"100",placeholder:"********",className:"w-full border-gray-400/80 p-2"}),r.password&&S.jsx("p",{className:"text-sm text-red-500",children:r.password})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"confirmPassword",children:"Confirm Password"}),S.jsx(bn,{id:"confirmPassword",name:"confirmPassword",type:"password",maxLength:"100",placeholder:"********",className:"w-full border-gray-400/80 p-2"}),r.confirmPassword&&S.jsx("p",{className:"text-sm text-red-500",children:r.confirmPassword})]}),S.jsx(Pn,{disabled:u,className:"mt-4 w-full max-w-lg rounded-md bg-sky-700 px-4 py-2 text-white",children:u?"Waiting...":"Sign Up"}),S.jsxs("p",{className:"mt-4 text-sm text-gray-600",children:["Already have an account?"," ",S.jsx(ui,{to:"/login",className:"ms-1 text-sky-700 hover:underline",children:"Sign in"})]})]}),S.jsx("div",{className:"hidden min-h-[35rem] w-full items-center justify-center lg:flex lg:w-1/2",children:S.jsx("img",{src:"/images/slide04.jpeg",alt:"contact us",className:"h-full w-full rounded-r-md object-cover"})})]})}),S.jsx("div",{className:"flex-grow"}),S.jsx(Ro,{})]})},yp={AED:"United Arab Emirates Dirham",AFN:"Afghan Afghani",ALL:"Albanian Lek",AMD:"Armenian Dram",ANG:"Netherlands Antillean Guilder",AOA:"Angolan Kwanza",ARS:"Argentine Peso",AUD:"Australian Dollar",AWG:"Aruban Florin",AZN:"Azerbaijani Manat",BAM:"Bosnia-Herzegovina Convertible Mark",BBD:"Barbadian Dollar",BDT:"Bangladeshi Taka",BGN:"Bulgarian Lev",BHD:"Bahraini Dinar",BIF:"Burundian Franc",BMD:"Bermudan Dollar",BND:"Brunei Dollar",BOB:"Bolivian Boliviano",BRL:"Brazilian Real",BSD:"Bahamian Dollar",BTC:"Bitcoin",BTN:"Bhutanese Ngultrum",BWP:"Botswanan Pula",BYN:"Belarusian Ruble",BZD:"Belize Dollar",CAD:"Canadian Dollar",CDF:"Congolese Franc",CHF:"Swiss Franc",CLF:"Chilean Unit of Account (UF)",CLP:"Chilean Peso",CNH:"Chinese Yuan (Offshore)",CNY:"Chinese Yuan",COP:"Colombian Peso",CRC:"Costa Rican Colón",CUC:"Cuban Convertible Peso",CUP:"Cuban Peso",CVE:"Cape Verdean Escudo",CZK:"Czech Republic Koruna",DJF:"Djiboutian Franc",DKK:"Danish Krone",DOP:"Dominican Peso",DZD:"Algerian Dinar",EGP:"Egyptian Pound",ERN:"Eritrean Nakfa",ETB:"Ethiopian Birr",EUR:"Euro",FJD:"Fijian Dollar",FKP:"Falkland Islands Pound",GBP:"British Pound Sterling",GEL:"Georgian Lari",GGP:"Guernsey Pound",GHS:"Ghanaian Cedi",GIP:"Gibraltar Pound",GMD:"Gambian Dalasi",GNF:"Guinean Franc",GTQ:"Guatemalan Quetzal",GYD:"Guyanaese Dollar",HKD:"Hong Kong Dollar",HNL:"Honduran Lempira",HRK:"Croatian Kuna",HTG:"Haitian Gourde",HUF:"Hungarian Forint",IDR:"Indonesian Rupiah",ILS:"Israeli New Sheqel",IMP:"Manx pound",INR:"Indian Rupee",IQD:"Iraqi Dinar",IRR:"Iranian Rial",ISK:"Icelandic Króna",JEP:"Jersey Pound",JMD:"Jamaican Dollar",JOD:"Jordanian Dinar",JPY:"Japanese Yen",KES:"Kenyan Shilling",KGS:"Kyrgystani Som",KHR:"Cambodian Riel",KMF:"Comorian Franc",KPW:"North Korean Won",KRW:"South Korean Won",KWD:"Kuwaiti Dinar",KYD:"Cayman Islands Dollar",KZT:"Kazakhstani Tenge",LAK:"Laotian Kip",LBP:"Lebanese Pound",LKR:"Sri Lankan Rupee",LRD:"Liberian Dollar",LSL:"Lesotho Loti",LYD:"Libyan Dinar",MAD:"Moroccan Dirham",MDL:"Moldovan Leu",MGA:"Malagasy Ariary",MKD:"Macedonian Denar",MMK:"Myanma Kyat",MNT:"Mongolian Tugrik",MOP:"Macanese Pataca",MRU:"Mauritanian Ouguiya",MUR:"Mauritian Rupee",MVR:"Maldivian Rufiyaa",MWK:"Malawian Kwacha",MXN:"Mexican Peso",MYR:"Malaysian Ringgit",MZN:"Mozambican Metical",NAD:"Namibian Dollar",NGN:"Nigerian Naira",NIO:"Nicaraguan Córdoba",NOK:"Norwegian Krone",NPR:"Nepalese Rupee",NZD:"New Zealand Dollar",OMR:"Omani Rial",PAB:"Panamanian Balboa",PEN:"Peruvian Nuevo Sol",PGK:"Papua New Guinean Kina",PHP:"Philippine Peso",PKR:"Pakistani Rupee",PLN:"Polish Zloty",PYG:"Paraguayan Guarani",QAR:"Qatari Rial",RON:"Romanian Leu",RSD:"Serbian Dinar",RUB:"Russian Ruble",RWF:"Rwandan Franc",SAR:"Saudi Riyal",SBD:"Solomon Islands Dollar",SCR:"Seychellois Rupee",SDG:"Sudanese Pound",SEK:"Swedish Krona",SGD:"Singapore Dollar",SHP:"Saint Helena Pound",SLL:"Sierra Leonean Leone",SOS:"Somali Shilling",SRD:"Surinamese Dollar",SSP:"South Sudanese Pound",STD:"São Tomé and Príncipe Dobra (pre-2018)",STN:"São Tomé and Príncipe Dobra",SVC:"Salvadoran Colón",SYP:"Syrian Pound",SZL:"Swazi Lilangeni",THB:"Thai Baht",TJS:"Tajikistani Somoni",TMT:"Turkmenistani Manat",TND:"Tunisian Dinar",TOP:"Tongan Pa'anga",TRY:"Turkish Lira",TTD:"Trinidad and Tobago Dollar",TWD:"New Taiwan Dollar",TZS:"Tanzanian Shilling",UAH:"Ukrainian Hryvnia",UGX:"Ugandan Shilling",USD:"United States Dollar",UYU:"Uruguayan Peso",UZS:"Uzbekistan Som",VEF:"Venezuelan Bolívar Fuerte (Old)",VES:"Venezuelan Bolívar Soberano",VND:"Vietnamese Dong",VUV:"Vanuatu Vatu",WST:"Samoan Tala",XAF:"CFA Franc BEAC",XAG:"Silver Ounce",XAU:"Gold Ounce",XCD:"East Caribbean Dollar",XDR:"Special Drawing Rights",XOF:"CFA Franc BCEAO",XPD:"Palladium Ounce",XPF:"CFP Franc",XPT:"Platinum Ounce",YER:"Yemeni Rial",ZAR:"South African Rand",ZMW:"Zambian Kwacha",ZWL:"Zimbabwean Dollar"},goe=()=>{const[e,t]=W.useState({type:"USD",amount:1}),[r,o]=W.useState({type:"LKR",amount:0}),[u,m]=W.useState({}),[_,b]=W.useState(!1),[s,k]=W.useState(0),O=W.useCallback((F,q,H,J=!0)=>{const U=u[F]||1,Q=(u[q]||1)/U;k(Q.toFixed(2)),J?o({...r,amount:(H*Q).toFixed(2)}):t({...e,amount:(H/Q).toFixed(2)})},[u,e,r]);return W.useEffect(()=>{b(!0),fetch("https://openexchangerates.org/api/latest.json?app_id=493df1fd7e574693b94326174caa6f10").then(q=>q.json()).then(q=>{m(q.rates||{})}).finally(()=>{b(!1)})},[]),W.useEffect(()=>{_||O("USD","LKR",1)},[_]),S.jsxs("div",{className:"flex min-h-screen flex-col",children:[S.jsx(ko,{}),S.jsx("div",{className:"flex-grow"}),S.jsxs("section",{className:"container mx-auto mt-20 max-w-4xl px-4 py-8",children:[S.jsx("h1",{className:"mb-8 text-center text-2xl font-medium md:text-3xl",children:"Currency Convertor"}),S.jsxs("p",{className:"text-sm text-gray-700",children:["1 ",yp[e.type]," equals"]}),!_&&S.jsxs("p",{className:"mb-5 text-xl md:text-2xl",children:[s," ",yp[r==null?void 0:r.type]]}),S.jsx("div",{className:"",children:S.jsxs("div",{className:"mt-2 flex w-full",children:[S.jsx(bn,{id:"name",name:"name",type:"number",min:"1",value:e.amount,onInput:({target:F})=>{O(e.type,r.type,F.value)},onChange:({target:F})=>{t({...e,amount:F.value})},placeholder:"1",className:"w-full rounded-none rounded-l-md border-gray-400/80 p-2"}),S.jsxs(Ci,{defaultValue:"USD",onValueChange:F=>{t({...e,type:F}),O(F,r.type,e.amount)},children:[S.jsx(_i,{className:"w-full rounded-none rounded-r-md border-gray-400/80",children:S.jsx(Mi,{placeholder:"Select a location"})}),S.jsx(xi,{children:S.jsx(Pi,{children:Object.keys(yp).map(F=>S.jsxs(ii,{value:F,children:[yp[F]," (",F,")"]},F))})})]})]})}),S.jsx("div",{className:"",children:S.jsxs("div",{className:"mt-2 flex w-full",children:[S.jsx(bn,{id:"name",name:"name",type:"number",min:"1",value:r.amount,onInput:({target:F})=>{O(e.type,r.type,F.value,!1)},onChange:({target:F})=>{o({...r,amount:F.value})},placeholder:"1",className:"w-full rounded-none rounded-l-md border-gray-400/80 p-2"}),S.jsxs(Ci,{defaultValue:"LKR",onValueChange:F=>{o({...r,type:F}),O(e.type,F,r.amount,!1)},children:[S.jsx(_i,{className:"w-full rounded-none rounded-r-md border-gray-400/80",children:S.jsx(Mi,{placeholder:"Select a location"})}),S.jsx(xi,{children:S.jsx(Pi,{children:Object.keys(yp).map(F=>S.jsxs(ii,{value:F,children:[yp[F]," (",F,")"]},F))})})]})]})})]}),S.jsx("div",{className:"flex-grow"}),S.jsx(Ro,{})]})};function yoe(e,t=[]){let r=[];function o(m,_){const b=W.createContext(_),s=r.length;r=[...r,_];function k(F){const{scope:q,children:H,...J}=F,U=(q==null?void 0:q[e][s])||b,te=W.useMemo(()=>J,Object.values(J));return S.jsx(U.Provider,{value:te,children:H})}function O(F,q){const H=(q==null?void 0:q[e][s])||b,J=W.useContext(H);if(J)return J;if(_!==void 0)return _;throw new Error(`\`${F}\` must be used within \`${m}\``)}return k.displayName=m+"Provider",[k,O]}const u=()=>{const m=r.map(_=>W.createContext(_));return function(b){const s=(b==null?void 0:b[e])||m;return W.useMemo(()=>({[`__scope${e}`]:{...b,[e]:s}}),[b,s])}};return u.scopeName=e,[o,_oe(u,...t)]}function _oe(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const o=e.map(u=>({useScope:u(),scopeName:u.scopeName}));return function(m){const _=o.reduce((b,{useScope:s,scopeName:k})=>{const F=s(m)[`__scope${k}`];return{...b,...F}},{});return W.useMemo(()=>({[`__scope${t.scopeName}`]:_}),[_])}};return r.scopeName=t.scopeName,r}var TA="Checkbox",[xoe,ude]=yoe(TA),[voe,boe]=xoe(TA),vV=W.forwardRef((e,t)=>{const{__scopeCheckbox:r,name:o,checked:u,defaultChecked:m,required:_,disabled:b,value:s="on",onCheckedChange:k,...O}=e,[F,q]=W.useState(null),H=gr(t,re=>q(re)),J=W.useRef(!1),U=F?!!F.closest("form"):!0,[te=!1,Q]=hc({prop:u,defaultProp:m,onChange:k}),ee=W.useRef(te);return W.useEffect(()=>{const re=F==null?void 0:F.form;if(re){const xe=()=>Q(ee.current);return re.addEventListener("reset",xe),()=>re.removeEventListener("reset",xe)}},[F,Q]),S.jsxs(voe,{scope:r,state:te,disabled:b,children:[S.jsx(jn.button,{type:"button",role:"checkbox","aria-checked":Eh(te)?"mixed":te,"aria-required":_,"data-state":SV(te),"data-disabled":b?"":void 0,disabled:b,value:s,...O,ref:H,onKeyDown:In(e.onKeyDown,re=>{re.key==="Enter"&&re.preventDefault()}),onClick:In(e.onClick,re=>{Q(xe=>Eh(xe)?!0:!xe),U&&(J.current=re.isPropagationStopped(),J.current||re.stopPropagation())})}),U&&S.jsx(woe,{control:F,bubbles:!J.current,name:o,value:s,checked:te,required:_,disabled:b,style:{transform:"translateX(-100%)"}})]})});vV.displayName=TA;var bV="CheckboxIndicator",wV=W.forwardRef((e,t)=>{const{__scopeCheckbox:r,forceMount:o,...u}=e,m=boe(bV,r);return S.jsx(ud,{present:o||Eh(m.state)||m.state===!0,children:S.jsx(jn.span,{"data-state":SV(m.state),"data-disabled":m.disabled?"":void 0,...u,ref:t,style:{pointerEvents:"none",...e.style}})})});wV.displayName=bV;var woe=e=>{const{control:t,checked:r,bubbles:o=!0,...u}=e,m=W.useRef(null),_=o6(r),b=EB(t);return W.useEffect(()=>{const s=m.current,k=window.HTMLInputElement.prototype,F=Object.getOwnPropertyDescriptor(k,"checked").set;if(_!==r&&F){const q=new Event("click",{bubbles:o});s.indeterminate=Eh(r),F.call(s,Eh(r)?!1:r),s.dispatchEvent(q)}},[_,r,o]),S.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:Eh(r)?!1:r,...u,tabIndex:-1,ref:m,style:{...e.style,...b,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Eh(e){return e==="indeterminate"}function SV(e){return Eh(e)?"indeterminate":e?"checked":"unchecked"}var TV=vV,Soe=wV;const qh=W.forwardRef(({className:e,...t},r)=>S.jsx(TV,{ref:r,className:Zn("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:S.jsx(Soe,{className:Zn("flex items-center justify-center text-current"),children:S.jsx(UF,{className:"h-4 w-4"})})}));qh.displayName=TV.displayName;const EV=W.createContext({dragDropManager:void 0});function Zo(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var JO=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),nE=function(){return Math.random().toString(36).substring(7).split("").join(".")},QO={INIT:"@@redux/INIT"+nE(),REPLACE:"@@redux/REPLACE"+nE(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+nE()}};function Toe(e){if(typeof e!="object"||e===null)return!1;for(var t=e;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function CV(e,t,r){var o;if(typeof t=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(Zo(0));if(typeof t=="function"&&typeof r>"u"&&(r=t,t=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(Zo(1));return r(CV)(e,t)}if(typeof e!="function")throw new Error(Zo(2));var u=e,m=t,_=[],b=_,s=!1;function k(){b===_&&(b=_.slice())}function O(){if(s)throw new Error(Zo(3));return m}function F(U){if(typeof U!="function")throw new Error(Zo(4));if(s)throw new Error(Zo(5));var te=!0;return k(),b.push(U),function(){if(te){if(s)throw new Error(Zo(6));te=!1,k();var ee=b.indexOf(U);b.splice(ee,1),_=null}}}function q(U){if(!Toe(U))throw new Error(Zo(7));if(typeof U.type>"u")throw new Error(Zo(8));if(s)throw new Error(Zo(9));try{s=!0,m=u(m,U)}finally{s=!1}for(var te=_=b,Q=0;Q<te.length;Q++){var ee=te[Q];ee()}return U}function H(U){if(typeof U!="function")throw new Error(Zo(10));u=U,q({type:QO.REPLACE})}function J(){var U,te=F;return U={subscribe:function(ee){if(typeof ee!="object"||ee===null)throw new Error(Zo(11));function re(){ee.next&&ee.next(O())}re();var xe=te(re);return{unsubscribe:xe}}},U[JO]=function(){return this},U}return q({type:QO.INIT}),o={dispatch:q,subscribe:F,getState:O,replaceReducer:H},o[JO]=J,o}function qn(e,t,...r){if(Eoe()&&t===void 0)throw new Error("invariant requires an error message argument");if(!e){let o;if(t===void 0)o=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{let u=0;o=new Error(t.replace(/%s/g,function(){return r[u++]})),o.name="Invariant Violation"}throw o.framesToPop=1,o}}function Eoe(){return typeof process<"u"&&!0}function Coe(e,t,r){return t.split(".").reduce((o,u)=>o&&o[u]?o[u]:r||null,e)}function Poe(e,t){return e.filter(r=>r!==t)}function PV(e){return typeof e=="object"}function Moe(e,t){const r=new Map,o=m=>{r.set(m,r.has(m)?r.get(m)+1:1)};e.forEach(o),t.forEach(o);const u=[];return r.forEach((m,_)=>{m===1&&u.push(_)}),u}function Aoe(e,t){return e.filter(r=>t.indexOf(r)>-1)}const EA="dnd-core/INIT_COORDS",Hb="dnd-core/BEGIN_DRAG",CA="dnd-core/PUBLISH_DRAG_SOURCE",qb="dnd-core/HOVER",Zb="dnd-core/DROP",Xb="dnd-core/END_DRAG";function e4(e,t){return{type:EA,payload:{sourceClientOffset:t||null,clientOffset:e||null}}}const Ioe={type:EA,payload:{clientOffset:null,sourceClientOffset:null}};function Doe(e){return function(r=[],o={publishSource:!0}){const{publishSource:u=!0,clientOffset:m,getSourceClientOffset:_}=o,b=e.getMonitor(),s=e.getRegistry();e.dispatch(e4(m)),Roe(r,b,s);const k=Loe(r,b);if(k==null){e.dispatch(Ioe);return}let O=null;if(m){if(!_)throw new Error("getSourceClientOffset must be defined");koe(_),O=_(k)}e.dispatch(e4(m,O));const q=s.getSource(k).beginDrag(b,k);if(q==null)return;Noe(q),s.pinSource(k);const H=s.getSourceType(k);return{type:Hb,payload:{itemType:H,item:q,sourceId:k,clientOffset:m||null,sourceClientOffset:O||null,isSourcePublic:!!u}}}}function Roe(e,t,r){qn(!t.isDragging(),"Cannot call beginDrag while dragging."),e.forEach(function(o){qn(r.getSource(o),"Expected sourceIds to be registered.")})}function koe(e){qn(typeof e=="function","When clientOffset is provided, getSourceClientOffset must be a function.")}function Noe(e){qn(PV(e),"Item must be an object.")}function Loe(e,t){let r=null;for(let o=e.length-1;o>=0;o--)if(t.canDragSource(e[o])){r=e[o];break}return r}function Ooe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function joe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{},o=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable}))),o.forEach(function(u){Ooe(e,u,r[u])})}return e}function zoe(e){return function(r={}){const o=e.getMonitor(),u=e.getRegistry();Foe(o),Uoe(o).forEach((_,b)=>{const s=Boe(_,b,u,o),k={type:Zb,payload:{dropResult:joe({},r,s)}};e.dispatch(k)})}}function Foe(e){qn(e.isDragging(),"Cannot call drop while not dragging."),qn(!e.didDrop(),"Cannot call drop twice during one drag operation.")}function Boe(e,t,r,o){const u=r.getTarget(e);let m=u?u.drop(o,e):void 0;return Voe(m),typeof m>"u"&&(m=t===0?{}:o.getDropResult()),m}function Voe(e){qn(typeof e>"u"||PV(e),"Drop result must either be an object or undefined.")}function Uoe(e){const t=e.getTargetIds().filter(e.canDropOnTarget,e);return t.reverse(),t}function $oe(e){return function(){const r=e.getMonitor(),o=e.getRegistry();Goe(r);const u=r.getSourceId();return u!=null&&(o.getSource(u,!0).endDrag(r,u),o.unpinSource()),{type:Xb}}}function Goe(e){qn(e.isDragging(),"Cannot call endDrag while not dragging.")}function QC(e,t){return t===null?e===null:Array.isArray(e)?e.some(r=>r===t):e===t}function Woe(e){return function(r,{clientOffset:o}={}){Hoe(r);const u=r.slice(0),m=e.getMonitor(),_=e.getRegistry(),b=m.getItemType();return Zoe(u,_,b),qoe(u,m,_),Xoe(u,m,_),{type:qb,payload:{targetIds:u,clientOffset:o||null}}}}function Hoe(e){qn(Array.isArray(e),"Expected targetIds to be an array.")}function qoe(e,t,r){qn(t.isDragging(),"Cannot call hover while not dragging."),qn(!t.didDrop(),"Cannot call hover after drop.");for(let o=0;o<e.length;o++){const u=e[o];qn(e.lastIndexOf(u)===o,"Expected targetIds to be unique in the passed array.");const m=r.getTarget(u);qn(m,"Expected targetIds to be registered.")}}function Zoe(e,t,r){for(let o=e.length-1;o>=0;o--){const u=e[o],m=t.getTargetType(u);QC(m,r)||e.splice(o,1)}}function Xoe(e,t,r){e.forEach(function(o){r.getTarget(o).hover(t,o)})}function Yoe(e){return function(){if(e.getMonitor().isDragging())return{type:CA}}}function Koe(e){return{beginDrag:Doe(e),publishDragSource:Yoe(e),hover:Woe(e),drop:zoe(e),endDrag:$oe(e)}}class Joe{receiveBackend(t){this.backend=t}getMonitor(){return this.monitor}getBackend(){return this.backend}getRegistry(){return this.monitor.registry}getActions(){const t=this,{dispatch:r}=this.store;function o(m){return(..._)=>{const b=m.apply(t,_);typeof b<"u"&&r(b)}}const u=Koe(this);return Object.keys(u).reduce((m,_)=>{const b=u[_];return m[_]=o(b),m},{})}dispatch(t){this.store.dispatch(t)}constructor(t,r){this.isSetUp=!1,this.handleRefCountChange=()=>{const o=this.store.getState().refCount>0;this.backend&&(o&&!this.isSetUp?(this.backend.setup(),this.isSetUp=!0):!o&&this.isSetUp&&(this.backend.teardown(),this.isSetUp=!1))},this.store=t,this.monitor=r,t.subscribe(this.handleRefCountChange)}}function Qoe(e,t){return{x:e.x+t.x,y:e.y+t.y}}function MV(e,t){return{x:e.x-t.x,y:e.y-t.y}}function eae(e){const{clientOffset:t,initialClientOffset:r,initialSourceClientOffset:o}=e;return!t||!r||!o?null:MV(Qoe(t,o),r)}function tae(e){const{clientOffset:t,initialClientOffset:r}=e;return!t||!r?null:MV(t,r)}const n_=[],PA=[];n_.__IS_NONE__=!0;PA.__IS_ALL__=!0;function nae(e,t){return e===n_?!1:e===PA||typeof t>"u"?!0:Aoe(t,e).length>0}class rae{subscribeToStateChange(t,r={}){const{handlerIds:o}=r;qn(typeof t=="function","listener must be a function."),qn(typeof o>"u"||Array.isArray(o),"handlerIds, when specified, must be an array of strings.");let u=this.store.getState().stateId;const m=()=>{const _=this.store.getState(),b=_.stateId;try{b===u||b===u+1&&!nae(_.dirtyHandlerIds,o)||t()}finally{u=b}};return this.store.subscribe(m)}subscribeToOffsetChange(t){qn(typeof t=="function","listener must be a function.");let r=this.store.getState().dragOffset;const o=()=>{const u=this.store.getState().dragOffset;u!==r&&(r=u,t())};return this.store.subscribe(o)}canDragSource(t){if(!t)return!1;const r=this.registry.getSource(t);return qn(r,`Expected to find a valid source. sourceId=${t}`),this.isDragging()?!1:r.canDrag(this,t)}canDropOnTarget(t){if(!t)return!1;const r=this.registry.getTarget(t);if(qn(r,`Expected to find a valid target. targetId=${t}`),!this.isDragging()||this.didDrop())return!1;const o=this.registry.getTargetType(t),u=this.getItemType();return QC(o,u)&&r.canDrop(this,t)}isDragging(){return!!this.getItemType()}isDraggingSource(t){if(!t)return!1;const r=this.registry.getSource(t,!0);if(qn(r,`Expected to find a valid source. sourceId=${t}`),!this.isDragging()||!this.isSourcePublic())return!1;const o=this.registry.getSourceType(t),u=this.getItemType();return o!==u?!1:r.isDragging(this,t)}isOverTarget(t,r={shallow:!1}){if(!t)return!1;const{shallow:o}=r;if(!this.isDragging())return!1;const u=this.registry.getTargetType(t),m=this.getItemType();if(m&&!QC(u,m))return!1;const _=this.getTargetIds();if(!_.length)return!1;const b=_.indexOf(t);return o?b===_.length-1:b>-1}getItemType(){return this.store.getState().dragOperation.itemType}getItem(){return this.store.getState().dragOperation.item}getSourceId(){return this.store.getState().dragOperation.sourceId}getTargetIds(){return this.store.getState().dragOperation.targetIds}getDropResult(){return this.store.getState().dragOperation.dropResult}didDrop(){return this.store.getState().dragOperation.didDrop}isSourcePublic(){return!!this.store.getState().dragOperation.isSourcePublic}getInitialClientOffset(){return this.store.getState().dragOffset.initialClientOffset}getInitialSourceClientOffset(){return this.store.getState().dragOffset.initialSourceClientOffset}getClientOffset(){return this.store.getState().dragOffset.clientOffset}getSourceClientOffset(){return eae(this.store.getState().dragOffset)}getDifferenceFromInitialOffset(){return tae(this.store.getState().dragOffset)}constructor(t,r){this.store=t,this.registry=r}}const t4=typeof global<"u"?global:self,AV=t4.MutationObserver||t4.WebKitMutationObserver;function IV(e){return function(){const r=setTimeout(u,0),o=setInterval(u,50);function u(){clearTimeout(r),clearInterval(o),e()}}}function iae(e){let t=1;const r=new AV(e),o=document.createTextNode("");return r.observe(o,{characterData:!0}),function(){t=-t,o.data=t}}const sae=typeof AV=="function"?iae:IV;class oae{enqueueTask(t){const{queue:r,requestFlush:o}=this;r.length||(o(),this.flushing=!0),r[r.length]=t}constructor(){this.queue=[],this.pendingErrors=[],this.flushing=!1,this.index=0,this.capacity=1024,this.flush=()=>{const{queue:t}=this;for(;this.index<t.length;){const r=this.index;if(this.index++,t[r].call(),this.index>this.capacity){for(let o=0,u=t.length-this.index;o<u;o++)t[o]=t[o+this.index];t.length-=this.index,this.index=0}}t.length=0,this.index=0,this.flushing=!1},this.registerPendingError=t=>{this.pendingErrors.push(t),this.requestErrorThrow()},this.requestFlush=sae(this.flush),this.requestErrorThrow=IV(()=>{if(this.pendingErrors.length)throw this.pendingErrors.shift()})}}class aae{call(){try{this.task&&this.task()}catch(t){this.onError(t)}finally{this.task=null,this.release(this)}}constructor(t,r){this.onError=t,this.release=r,this.task=null}}class lae{create(t){const r=this.freeTasks,o=r.length?r.pop():new aae(this.onError,u=>r[r.length]=u);return o.task=t,o}constructor(t){this.onError=t,this.freeTasks=[]}}const DV=new oae,cae=new lae(DV.registerPendingError);function uae(e){DV.enqueueTask(cae.create(e))}const MA="dnd-core/ADD_SOURCE",AA="dnd-core/ADD_TARGET",IA="dnd-core/REMOVE_SOURCE",Yb="dnd-core/REMOVE_TARGET";function dae(e){return{type:MA,payload:{sourceId:e}}}function hae(e){return{type:AA,payload:{targetId:e}}}function fae(e){return{type:IA,payload:{sourceId:e}}}function pae(e){return{type:Yb,payload:{targetId:e}}}function mae(e){qn(typeof e.canDrag=="function","Expected canDrag to be a function."),qn(typeof e.beginDrag=="function","Expected beginDrag to be a function."),qn(typeof e.endDrag=="function","Expected endDrag to be a function.")}function gae(e){qn(typeof e.canDrop=="function","Expected canDrop to be a function."),qn(typeof e.hover=="function","Expected hover to be a function."),qn(typeof e.drop=="function","Expected beginDrag to be a function.")}function eP(e,t){if(t&&Array.isArray(e)){e.forEach(r=>eP(r,!1));return}qn(typeof e=="string"||typeof e=="symbol",t?"Type can only be a string, a symbol, or an array of either.":"Type can only be a string or a symbol.")}var Jo;(function(e){e.SOURCE="SOURCE",e.TARGET="TARGET"})(Jo||(Jo={}));let yae=0;function _ae(){return yae++}function xae(e){const t=_ae().toString();switch(e){case Jo.SOURCE:return`S${t}`;case Jo.TARGET:return`T${t}`;default:throw new Error(`Unknown Handler Role: ${e}`)}}function n4(e){switch(e[0]){case"S":return Jo.SOURCE;case"T":return Jo.TARGET;default:throw new Error(`Cannot parse handler ID: ${e}`)}}function r4(e,t){const r=e.entries();let o=!1;do{const{done:u,value:[,m]}=r.next();if(m===t)return!0;o=!!u}while(!o);return!1}class vae{addSource(t,r){eP(t),mae(r);const o=this.addHandler(Jo.SOURCE,t,r);return this.store.dispatch(dae(o)),o}addTarget(t,r){eP(t,!0),gae(r);const o=this.addHandler(Jo.TARGET,t,r);return this.store.dispatch(hae(o)),o}containsHandler(t){return r4(this.dragSources,t)||r4(this.dropTargets,t)}getSource(t,r=!1){return qn(this.isSourceId(t),"Expected a valid source ID."),r&&t===this.pinnedSourceId?this.pinnedSource:this.dragSources.get(t)}getTarget(t){return qn(this.isTargetId(t),"Expected a valid target ID."),this.dropTargets.get(t)}getSourceType(t){return qn(this.isSourceId(t),"Expected a valid source ID."),this.types.get(t)}getTargetType(t){return qn(this.isTargetId(t),"Expected a valid target ID."),this.types.get(t)}isSourceId(t){return n4(t)===Jo.SOURCE}isTargetId(t){return n4(t)===Jo.TARGET}removeSource(t){qn(this.getSource(t),"Expected an existing source."),this.store.dispatch(fae(t)),uae(()=>{this.dragSources.delete(t),this.types.delete(t)})}removeTarget(t){qn(this.getTarget(t),"Expected an existing target."),this.store.dispatch(pae(t)),this.dropTargets.delete(t),this.types.delete(t)}pinSource(t){const r=this.getSource(t);qn(r,"Expected an existing source."),this.pinnedSourceId=t,this.pinnedSource=r}unpinSource(){qn(this.pinnedSource,"No source is pinned at the time."),this.pinnedSourceId=null,this.pinnedSource=null}addHandler(t,r,o){const u=xae(t);return this.types.set(u,r),t===Jo.SOURCE?this.dragSources.set(u,o):t===Jo.TARGET&&this.dropTargets.set(u,o),u}constructor(t){this.types=new Map,this.dragSources=new Map,this.dropTargets=new Map,this.pinnedSourceId=null,this.pinnedSource=null,this.store=t}}const bae=(e,t)=>e===t;function wae(e,t){return!e&&!t?!0:!e||!t?!1:e.x===t.x&&e.y===t.y}function Sae(e,t,r=bae){if(e.length!==t.length)return!1;for(let o=0;o<e.length;++o)if(!r(e[o],t[o]))return!1;return!0}function Tae(e=n_,t){switch(t.type){case qb:break;case MA:case AA:case Yb:case IA:return n_;case Hb:case CA:case Xb:case Zb:default:return PA}const{targetIds:r=[],prevTargetIds:o=[]}=t.payload,u=Moe(r,o);if(!(u.length>0||!Sae(r,o)))return n_;const _=o[o.length-1],b=r[r.length-1];return _!==b&&(_&&u.push(_),b&&u.push(b)),u}function Eae(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Cae(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{},o=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable}))),o.forEach(function(u){Eae(e,u,r[u])})}return e}const i4={initialSourceClientOffset:null,initialClientOffset:null,clientOffset:null};function Pae(e=i4,t){const{payload:r}=t;switch(t.type){case EA:case Hb:return{initialSourceClientOffset:r.sourceClientOffset,initialClientOffset:r.clientOffset,clientOffset:r.clientOffset};case qb:return wae(e.clientOffset,r.clientOffset)?e:Cae({},e,{clientOffset:r.clientOffset});case Xb:case Zb:return i4;default:return e}}function Mae(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _p(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{},o=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable}))),o.forEach(function(u){Mae(e,u,r[u])})}return e}const Aae={itemType:null,item:null,sourceId:null,targetIds:[],dropResult:null,didDrop:!1,isSourcePublic:null};function Iae(e=Aae,t){const{payload:r}=t;switch(t.type){case Hb:return _p({},e,{itemType:r.itemType,item:r.item,sourceId:r.sourceId,isSourcePublic:r.isSourcePublic,dropResult:null,didDrop:!1});case CA:return _p({},e,{isSourcePublic:!0});case qb:return _p({},e,{targetIds:r.targetIds});case Yb:return e.targetIds.indexOf(r.targetId)===-1?e:_p({},e,{targetIds:Poe(e.targetIds,r.targetId)});case Zb:return _p({},e,{dropResult:r.dropResult,didDrop:!0,targetIds:[]});case Xb:return _p({},e,{itemType:null,item:null,sourceId:null,dropResult:null,didDrop:!1,isSourcePublic:null,targetIds:[]});default:return e}}function Dae(e=0,t){switch(t.type){case MA:case AA:return e+1;case IA:case Yb:return e-1;default:return e}}function Rae(e=0){return e+1}function kae(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Nae(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{},o=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable}))),o.forEach(function(u){kae(e,u,r[u])})}return e}function Lae(e={},t){return{dirtyHandlerIds:Tae(e.dirtyHandlerIds,{type:t.type,payload:Nae({},t.payload,{prevTargetIds:Coe(e,"dragOperation.targetIds",[])})}),dragOffset:Pae(e.dragOffset,t),refCount:Dae(e.refCount,t),dragOperation:Iae(e.dragOperation,t),stateId:Rae(e.stateId)}}function Oae(e,t=void 0,r={},o=!1){const u=jae(o),m=new rae(u,new vae(u)),_=new Joe(u,m),b=e(_,t,r);return _.receiveBackend(b),_}function jae(e){const t=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION__;return CV(Lae,e&&t&&t({name:"dnd-core",instanceId:"dnd-core"}))}function zae(e,t){if(e==null)return{};var r=Fae(e,t),o,u;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(u=0;u<m.length;u++)o=m[u],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}function Fae(e,t){if(e==null)return{};var r={},o=Object.keys(e),u,m;for(m=0;m<o.length;m++)u=o[m],!(t.indexOf(u)>=0)&&(r[u]=e[u]);return r}let s4=0;const Kv=Symbol.for("__REACT_DND_CONTEXT_INSTANCE__");var Bae=W.memo(function(t){var{children:r}=t,o=zae(t,["children"]);const[u,m]=Vae(o);return W.useEffect(()=>{if(m){const _=RV();return++s4,()=>{--s4===0&&(_[Kv]=null)}}},[]),S.jsx(EV.Provider,{value:u,children:r})});function Vae(e){if("manager"in e)return[{dragDropManager:e.manager},!1];const t=Uae(e.backend,e.context,e.options,e.debugMode),r=!e.context;return[t,r]}function Uae(e,t=RV(),r,o){const u=t;return u[Kv]||(u[Kv]={dragDropManager:Oae(e,t,r,o)}),u[Kv]}function RV(){return typeof global<"u"?global:window}var $ae=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var o,u,m;if(Array.isArray(t)){if(o=t.length,o!=r.length)return!1;for(u=o;u--!==0;)if(!e(t[u],r[u]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(m=Object.keys(t),o=m.length,o!==Object.keys(r).length)return!1;for(u=o;u--!==0;)if(!Object.prototype.hasOwnProperty.call(r,m[u]))return!1;for(u=o;u--!==0;){var _=m[u];if(!e(t[_],r[_]))return!1}return!0}return t!==t&&r!==r};const Gae=Y1($ae),Bh=typeof window<"u"?W.useLayoutEffect:W.useEffect;function Wae(e,t,r){const[o,u]=W.useState(()=>t(e)),m=W.useCallback(()=>{const _=t(e);Gae(o,_)||(u(_),r&&r())},[o,e,r]);return Bh(m),[o,m]}function Hae(e,t,r){const[o,u]=Wae(e,t,r);return Bh(function(){const _=e.getHandlerId();if(_!=null)return e.subscribeToStateChange(u,{handlerIds:[_]})},[e,u]),o}function kV(e,t,r){return Hae(t,e||(()=>({})),()=>r.reconnect())}function NV(e,t){const r=[];return typeof e!="function"&&r.push(e),W.useMemo(()=>typeof e=="function"?e():e,r)}function qae(e){return W.useMemo(()=>e.hooks.dragSource(),[e])}function Zae(e){return W.useMemo(()=>e.hooks.dragPreview(),[e])}let rE=!1,iE=!1;class Xae{receiveHandlerId(t){this.sourceId=t}getHandlerId(){return this.sourceId}canDrag(){qn(!rE,"You may not call monitor.canDrag() inside your canDrag() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return rE=!0,this.internalMonitor.canDragSource(this.sourceId)}finally{rE=!1}}isDragging(){if(!this.sourceId)return!1;qn(!iE,"You may not call monitor.isDragging() inside your isDragging() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return iE=!0,this.internalMonitor.isDraggingSource(this.sourceId)}finally{iE=!1}}subscribeToStateChange(t,r){return this.internalMonitor.subscribeToStateChange(t,r)}isDraggingSource(t){return this.internalMonitor.isDraggingSource(t)}isOverTarget(t,r){return this.internalMonitor.isOverTarget(t,r)}getTargetIds(){return this.internalMonitor.getTargetIds()}isSourcePublic(){return this.internalMonitor.isSourcePublic()}getSourceId(){return this.internalMonitor.getSourceId()}subscribeToOffsetChange(t){return this.internalMonitor.subscribeToOffsetChange(t)}canDragSource(t){return this.internalMonitor.canDragSource(t)}canDropOnTarget(t){return this.internalMonitor.canDropOnTarget(t)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(t){this.sourceId=null,this.internalMonitor=t.getMonitor()}}let sE=!1;class Yae{receiveHandlerId(t){this.targetId=t}getHandlerId(){return this.targetId}subscribeToStateChange(t,r){return this.internalMonitor.subscribeToStateChange(t,r)}canDrop(){if(!this.targetId)return!1;qn(!sE,"You may not call monitor.canDrop() inside your canDrop() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target-monitor");try{return sE=!0,this.internalMonitor.canDropOnTarget(this.targetId)}finally{sE=!1}}isOver(t){return this.targetId?this.internalMonitor.isOverTarget(this.targetId,t):!1}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(t){this.targetId=null,this.internalMonitor=t.getMonitor()}}function Kae(e,t,r){const o=r.getRegistry(),u=o.addTarget(e,t);return[u,()=>o.removeTarget(u)]}function Jae(e,t,r){const o=r.getRegistry(),u=o.addSource(e,t);return[u,()=>o.removeSource(u)]}function tP(e,t,r,o){let u;if(u!==void 0)return!!u;if(e===t)return!0;if(typeof e!="object"||!e||typeof t!="object"||!t)return!1;const m=Object.keys(e),_=Object.keys(t);if(m.length!==_.length)return!1;const b=Object.prototype.hasOwnProperty.bind(t);for(let s=0;s<m.length;s++){const k=m[s];if(!b(k))return!1;const O=e[k],F=t[k];if(u=void 0,u===!1||u===void 0&&O!==F)return!1}return!0}function nP(e){return e!==null&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function Qae(e){if(typeof e.type=="string")return;const t=e.type.displayName||e.type.name||"the component";throw new Error(`Only native element nodes can now be passed to React DnD connectors.You can either wrap ${t} into a <div>, or turn it into a drag source or a drop target itself.`)}function ele(e){return(t=null,r=null)=>{if(!W.isValidElement(t)){const m=t;return e(m,r),m}const o=t;return Qae(o),tle(o,r?m=>e(m,r):e)}}function LV(e){const t={};return Object.keys(e).forEach(r=>{const o=e[r];if(r.endsWith("Ref"))t[r]=e[r];else{const u=ele(o);t[r]=()=>u}}),t}function o4(e,t){typeof e=="function"?e(t):e.current=t}function tle(e,t){const r=e.ref;return qn(typeof r!="string","Cannot connect React DnD to an element with an existing string ref. Please convert it to use a callback ref instead, or wrap it into a <span> or <div>. Read more: https://reactjs.org/docs/refs-and-the-dom.html#callback-refs"),r?W.cloneElement(e,{ref:o=>{o4(r,o),o4(t,o)}}):W.cloneElement(e,{ref:t})}class nle{receiveHandlerId(t){this.handlerId!==t&&(this.handlerId=t,this.reconnect())}get connectTarget(){return this.dragSource}get dragSourceOptions(){return this.dragSourceOptionsInternal}set dragSourceOptions(t){this.dragSourceOptionsInternal=t}get dragPreviewOptions(){return this.dragPreviewOptionsInternal}set dragPreviewOptions(t){this.dragPreviewOptionsInternal=t}reconnect(){const t=this.reconnectDragSource();this.reconnectDragPreview(t)}reconnectDragSource(){const t=this.dragSource,r=this.didHandlerIdChange()||this.didConnectedDragSourceChange()||this.didDragSourceOptionsChange();return r&&this.disconnectDragSource(),this.handlerId?t?(r&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragSource=t,this.lastConnectedDragSourceOptions=this.dragSourceOptions,this.dragSourceUnsubscribe=this.backend.connectDragSource(this.handlerId,t,this.dragSourceOptions)),r):(this.lastConnectedDragSource=t,r):r}reconnectDragPreview(t=!1){const r=this.dragPreview,o=t||this.didHandlerIdChange()||this.didConnectedDragPreviewChange()||this.didDragPreviewOptionsChange();if(o&&this.disconnectDragPreview(),!!this.handlerId){if(!r){this.lastConnectedDragPreview=r;return}o&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragPreview=r,this.lastConnectedDragPreviewOptions=this.dragPreviewOptions,this.dragPreviewUnsubscribe=this.backend.connectDragPreview(this.handlerId,r,this.dragPreviewOptions))}}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didConnectedDragSourceChange(){return this.lastConnectedDragSource!==this.dragSource}didConnectedDragPreviewChange(){return this.lastConnectedDragPreview!==this.dragPreview}didDragSourceOptionsChange(){return!tP(this.lastConnectedDragSourceOptions,this.dragSourceOptions)}didDragPreviewOptionsChange(){return!tP(this.lastConnectedDragPreviewOptions,this.dragPreviewOptions)}disconnectDragSource(){this.dragSourceUnsubscribe&&(this.dragSourceUnsubscribe(),this.dragSourceUnsubscribe=void 0)}disconnectDragPreview(){this.dragPreviewUnsubscribe&&(this.dragPreviewUnsubscribe(),this.dragPreviewUnsubscribe=void 0,this.dragPreviewNode=null,this.dragPreviewRef=null)}get dragSource(){return this.dragSourceNode||this.dragSourceRef&&this.dragSourceRef.current}get dragPreview(){return this.dragPreviewNode||this.dragPreviewRef&&this.dragPreviewRef.current}clearDragSource(){this.dragSourceNode=null,this.dragSourceRef=null}clearDragPreview(){this.dragPreviewNode=null,this.dragPreviewRef=null}constructor(t){this.hooks=LV({dragSource:(r,o)=>{this.clearDragSource(),this.dragSourceOptions=o||null,nP(r)?this.dragSourceRef=r:this.dragSourceNode=r,this.reconnectDragSource()},dragPreview:(r,o)=>{this.clearDragPreview(),this.dragPreviewOptions=o||null,nP(r)?this.dragPreviewRef=r:this.dragPreviewNode=r,this.reconnectDragPreview()}}),this.handlerId=null,this.dragSourceRef=null,this.dragSourceOptionsInternal=null,this.dragPreviewRef=null,this.dragPreviewOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDragSource=null,this.lastConnectedDragSourceOptions=null,this.lastConnectedDragPreview=null,this.lastConnectedDragPreviewOptions=null,this.backend=t}}class rle{get connectTarget(){return this.dropTarget}reconnect(){const t=this.didHandlerIdChange()||this.didDropTargetChange()||this.didOptionsChange();t&&this.disconnectDropTarget();const r=this.dropTarget;if(this.handlerId){if(!r){this.lastConnectedDropTarget=r;return}t&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDropTarget=r,this.lastConnectedDropTargetOptions=this.dropTargetOptions,this.unsubscribeDropTarget=this.backend.connectDropTarget(this.handlerId,r,this.dropTargetOptions))}}receiveHandlerId(t){t!==this.handlerId&&(this.handlerId=t,this.reconnect())}get dropTargetOptions(){return this.dropTargetOptionsInternal}set dropTargetOptions(t){this.dropTargetOptionsInternal=t}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didDropTargetChange(){return this.lastConnectedDropTarget!==this.dropTarget}didOptionsChange(){return!tP(this.lastConnectedDropTargetOptions,this.dropTargetOptions)}disconnectDropTarget(){this.unsubscribeDropTarget&&(this.unsubscribeDropTarget(),this.unsubscribeDropTarget=void 0)}get dropTarget(){return this.dropTargetNode||this.dropTargetRef&&this.dropTargetRef.current}clearDropTarget(){this.dropTargetRef=null,this.dropTargetNode=null}constructor(t){this.hooks=LV({dropTarget:(r,o)=>{this.clearDropTarget(),this.dropTargetOptions=o,nP(r)?this.dropTargetRef=r:this.dropTargetNode=r,this.reconnect()}}),this.handlerId=null,this.dropTargetRef=null,this.dropTargetOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDropTarget=null,this.lastConnectedDropTargetOptions=null,this.backend=t}}function Tm(){const{dragDropManager:e}=W.useContext(EV);return qn(e!=null,"Expected drag drop context"),e}function ile(e,t){const r=Tm(),o=W.useMemo(()=>new nle(r.getBackend()),[r]);return Bh(()=>(o.dragSourceOptions=e||null,o.reconnect(),()=>o.disconnectDragSource()),[o,e]),Bh(()=>(o.dragPreviewOptions=t||null,o.reconnect(),()=>o.disconnectDragPreview()),[o,t]),o}function sle(){const e=Tm();return W.useMemo(()=>new Xae(e),[e])}class ole{beginDrag(){const t=this.spec,r=this.monitor;let o=null;return typeof t.item=="object"?o=t.item:typeof t.item=="function"?o=t.item(r):o={},o??null}canDrag(){const t=this.spec,r=this.monitor;return typeof t.canDrag=="boolean"?t.canDrag:typeof t.canDrag=="function"?t.canDrag(r):!0}isDragging(t,r){const o=this.spec,u=this.monitor,{isDragging:m}=o;return m?m(u):r===t.getSourceId()}endDrag(){const t=this.spec,r=this.monitor,o=this.connector,{end:u}=t;u&&u(r.getItem(),r),o.reconnect()}constructor(t,r,o){this.spec=t,this.monitor=r,this.connector=o}}function ale(e,t,r){const o=W.useMemo(()=>new ole(e,t,r),[t,r]);return W.useEffect(()=>{o.spec=e},[e]),o}function lle(e){return W.useMemo(()=>{const t=e.type;return qn(t!=null,"spec.type must be defined"),t},[e])}function cle(e,t,r){const o=Tm(),u=ale(e,t,r),m=lle(e);Bh(function(){if(m!=null){const[b,s]=Jae(m,u,o);return t.receiveHandlerId(b),r.receiveHandlerId(b),s}},[o,t,r,u,m])}function ule(e,t){const r=NV(e);qn(!r.begin,"useDrag::spec.begin was deprecated in v14. Replace spec.begin() with spec.item(). (see more here - https://react-dnd.github.io/react-dnd/docs/api/use-drag)");const o=sle(),u=ile(r.options,r.previewOptions);return cle(r,o,u),[kV(r.collect,o,u),qae(u),Zae(u)]}function dle(e){return W.useMemo(()=>e.hooks.dropTarget(),[e])}function hle(e){const t=Tm(),r=W.useMemo(()=>new rle(t.getBackend()),[t]);return Bh(()=>(r.dropTargetOptions=e||null,r.reconnect(),()=>r.disconnectDropTarget()),[e]),r}function fle(){const e=Tm();return W.useMemo(()=>new Yae(e),[e])}function ple(e){const{accept:t}=e;return W.useMemo(()=>(qn(e.accept!=null,"accept must be defined"),Array.isArray(t)?t:[t]),[t])}class mle{canDrop(){const t=this.spec,r=this.monitor;return t.canDrop?t.canDrop(r.getItem(),r):!0}hover(){const t=this.spec,r=this.monitor;t.hover&&t.hover(r.getItem(),r)}drop(){const t=this.spec,r=this.monitor;if(t.drop)return t.drop(r.getItem(),r)}constructor(t,r){this.spec=t,this.monitor=r}}function gle(e,t){const r=W.useMemo(()=>new mle(e,t),[t]);return W.useEffect(()=>{r.spec=e},[e]),r}function yle(e,t,r){const o=Tm(),u=gle(e,t),m=ple(e);Bh(function(){const[b,s]=Kae(m,u,o);return t.receiveHandlerId(b),r.receiveHandlerId(b),s},[o,t,u,r,m.map(_=>_.toString()).join("|")])}function _le(e,t){const r=NV(e),o=fle(),u=hle(r.options);return yle(r,o,u),[kV(r.collect,o,u),dle(u)]}function OV(e){let t=null;return()=>(t==null&&(t=e()),t)}function xle(e,t){return e.filter(r=>r!==t)}function vle(e,t){const r=new Set,o=m=>r.add(m);e.forEach(o),t.forEach(o);const u=[];return r.forEach(m=>u.push(m)),u}class ble{enter(t){const r=this.entered.length,o=u=>this.isNodeInDocument(u)&&(!u.contains||u.contains(t));return this.entered=vle(this.entered.filter(o),[t]),r===0&&this.entered.length>0}leave(t){const r=this.entered.length;return this.entered=xle(this.entered.filter(this.isNodeInDocument),t),r>0&&this.entered.length===0}reset(){this.entered=[]}constructor(t){this.entered=[],this.isNodeInDocument=t}}class wle{initializeExposedProperties(){Object.keys(this.config.exposeProperties).forEach(t=>{Object.defineProperty(this.item,t,{configurable:!0,enumerable:!0,get(){return console.warn(`Browser doesn't allow reading "${t}" until the drop event.`),null}})})}loadDataTransfer(t){if(t){const r={};Object.keys(this.config.exposeProperties).forEach(o=>{const u=this.config.exposeProperties[o];u!=null&&(r[o]={value:u(t,this.config.matchesTypes),configurable:!0,enumerable:!0})}),Object.defineProperties(this.item,r)}}canDrag(){return!0}beginDrag(){return this.item}isDragging(t,r){return r===t.getSourceId()}endDrag(){}constructor(t){this.config=t,this.item={},this.initializeExposedProperties()}}const jV="__NATIVE_FILE__",zV="__NATIVE_URL__",FV="__NATIVE_TEXT__",BV="__NATIVE_HTML__",a4=Object.freeze(Object.defineProperty({__proto__:null,FILE:jV,HTML:BV,TEXT:FV,URL:zV},Symbol.toStringTag,{value:"Module"}));function oE(e,t,r){const o=t.reduce((u,m)=>u||e.getData(m),"");return o??r}const rP={[jV]:{exposeProperties:{files:e=>Array.prototype.slice.call(e.files),items:e=>e.items,dataTransfer:e=>e},matchesTypes:["Files"]},[BV]:{exposeProperties:{html:(e,t)=>oE(e,t,""),dataTransfer:e=>e},matchesTypes:["Html","text/html"]},[zV]:{exposeProperties:{urls:(e,t)=>oE(e,t,"").split(`
`),dataTransfer:e=>e},matchesTypes:["Url","text/uri-list"]},[FV]:{exposeProperties:{text:(e,t)=>oE(e,t,""),dataTransfer:e=>e},matchesTypes:["Text","text/plain"]}};function Sle(e,t){const r=rP[e];if(!r)throw new Error(`native type ${e} has no configuration`);const o=new wle(r);return o.loadDataTransfer(t),o}function aE(e){if(!e)return null;const t=Array.prototype.slice.call(e.types||[]);return Object.keys(rP).filter(r=>{const o=rP[r];return o!=null&&o.matchesTypes?o.matchesTypes.some(u=>t.indexOf(u)>-1):!1})[0]||null}const Tle=OV(()=>/firefox/i.test(navigator.userAgent)),VV=OV(()=>!!window.safari);class l4{interpolate(t){const{xs:r,ys:o,c1s:u,c2s:m,c3s:_}=this;let b=r.length-1;if(t===r[b])return o[b];let s=0,k=_.length-1,O;for(;s<=k;){O=Math.floor(.5*(s+k));const H=r[O];if(H<t)s=O+1;else if(H>t)k=O-1;else return o[O]}b=Math.max(0,k);const F=t-r[b],q=F*F;return o[b]+u[b]*F+m[b]*q+_[b]*F*q}constructor(t,r){const{length:o}=t,u=[];for(let H=0;H<o;H++)u.push(H);u.sort((H,J)=>t[H]<t[J]?-1:1);const m=[],_=[];let b,s;for(let H=0;H<o-1;H++)b=t[H+1]-t[H],s=r[H+1]-r[H],m.push(b),_.push(s/b);const k=[_[0]];for(let H=0;H<m.length-1;H++){const J=_[H],U=_[H+1];if(J*U<=0)k.push(0);else{b=m[H];const te=m[H+1],Q=b+te;k.push(3*Q/((Q+te)/J+(Q+b)/U))}}k.push(_[_.length-1]);const O=[],F=[];let q;for(let H=0;H<k.length-1;H++){q=_[H];const J=k[H],U=1/m[H],te=J+k[H+1]-q-q;O.push((q-J-te)*U),F.push(te*U*U)}this.xs=t,this.ys=r,this.c1s=k,this.c2s=O,this.c3s=F}}const Ele=1;function UV(e){const t=e.nodeType===Ele?e:e.parentElement;if(!t)return null;const{top:r,left:o}=t.getBoundingClientRect();return{x:o,y:r}}function Tv(e){return{x:e.clientX,y:e.clientY}}function Cle(e){var t;return e.nodeName==="IMG"&&(Tle()||!(!((t=document.documentElement)===null||t===void 0)&&t.contains(e)))}function Ple(e,t,r,o){let u=e?t.width:r,m=e?t.height:o;return VV()&&e&&(m/=window.devicePixelRatio,u/=window.devicePixelRatio),{dragPreviewWidth:u,dragPreviewHeight:m}}function Mle(e,t,r,o,u){const m=Cle(t),b=UV(m?e:t),s={x:r.x-b.x,y:r.y-b.y},{offsetWidth:k,offsetHeight:O}=e,{anchorX:F,anchorY:q}=o,{dragPreviewWidth:H,dragPreviewHeight:J}=Ple(m,t,k,O),U=()=>{let He=new l4([0,.5,1],[s.y,s.y/O*J,s.y+J-O]).interpolate(q);return VV()&&m&&(He+=(window.devicePixelRatio-1)*J),He},te=()=>new l4([0,.5,1],[s.x,s.x/k*H,s.x+H-k]).interpolate(F),{offsetX:Q,offsetY:ee}=u,re=Q===0||Q,xe=ee===0||ee;return{x:re?Q:te(),y:xe?ee:U()}}class Ale{get window(){if(this.globalContext)return this.globalContext;if(typeof window<"u")return window}get document(){var t;return!((t=this.globalContext)===null||t===void 0)&&t.document?this.globalContext.document:this.window?this.window.document:void 0}get rootElement(){var t;return((t=this.optionsArgs)===null||t===void 0?void 0:t.rootElement)||this.window}constructor(t,r){this.ownerDocument=null,this.globalContext=t,this.optionsArgs=r}}function Ile(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c4(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{},o=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable}))),o.forEach(function(u){Ile(e,u,r[u])})}return e}class Dle{profile(){var t,r;return{sourcePreviewNodes:this.sourcePreviewNodes.size,sourcePreviewNodeOptions:this.sourcePreviewNodeOptions.size,sourceNodeOptions:this.sourceNodeOptions.size,sourceNodes:this.sourceNodes.size,dragStartSourceIds:((t=this.dragStartSourceIds)===null||t===void 0?void 0:t.length)||0,dropTargetIds:this.dropTargetIds.length,dragEnterTargetIds:this.dragEnterTargetIds.length,dragOverTargetIds:((r=this.dragOverTargetIds)===null||r===void 0?void 0:r.length)||0}}get window(){return this.options.window}get document(){return this.options.document}get rootElement(){return this.options.rootElement}setup(){const t=this.rootElement;if(t!==void 0){if(t.__isReactDndBackendSetUp)throw new Error("Cannot have two HTML5 backends at the same time.");t.__isReactDndBackendSetUp=!0,this.addEventListeners(t)}}teardown(){const t=this.rootElement;if(t!==void 0&&(t.__isReactDndBackendSetUp=!1,this.removeEventListeners(this.rootElement),this.clearCurrentDragSourceNode(),this.asyncEndDragFrameId)){var r;(r=this.window)===null||r===void 0||r.cancelAnimationFrame(this.asyncEndDragFrameId)}}connectDragPreview(t,r,o){return this.sourcePreviewNodeOptions.set(t,o),this.sourcePreviewNodes.set(t,r),()=>{this.sourcePreviewNodes.delete(t),this.sourcePreviewNodeOptions.delete(t)}}connectDragSource(t,r,o){this.sourceNodes.set(t,r),this.sourceNodeOptions.set(t,o);const u=_=>this.handleDragStart(_,t),m=_=>this.handleSelectStart(_);return r.setAttribute("draggable","true"),r.addEventListener("dragstart",u),r.addEventListener("selectstart",m),()=>{this.sourceNodes.delete(t),this.sourceNodeOptions.delete(t),r.removeEventListener("dragstart",u),r.removeEventListener("selectstart",m),r.setAttribute("draggable","false")}}connectDropTarget(t,r){const o=_=>this.handleDragEnter(_,t),u=_=>this.handleDragOver(_,t),m=_=>this.handleDrop(_,t);return r.addEventListener("dragenter",o),r.addEventListener("dragover",u),r.addEventListener("drop",m),()=>{r.removeEventListener("dragenter",o),r.removeEventListener("dragover",u),r.removeEventListener("drop",m)}}addEventListeners(t){t.addEventListener&&(t.addEventListener("dragstart",this.handleTopDragStart),t.addEventListener("dragstart",this.handleTopDragStartCapture,!0),t.addEventListener("dragend",this.handleTopDragEndCapture,!0),t.addEventListener("dragenter",this.handleTopDragEnter),t.addEventListener("dragenter",this.handleTopDragEnterCapture,!0),t.addEventListener("dragleave",this.handleTopDragLeaveCapture,!0),t.addEventListener("dragover",this.handleTopDragOver),t.addEventListener("dragover",this.handleTopDragOverCapture,!0),t.addEventListener("drop",this.handleTopDrop),t.addEventListener("drop",this.handleTopDropCapture,!0))}removeEventListeners(t){t.removeEventListener&&(t.removeEventListener("dragstart",this.handleTopDragStart),t.removeEventListener("dragstart",this.handleTopDragStartCapture,!0),t.removeEventListener("dragend",this.handleTopDragEndCapture,!0),t.removeEventListener("dragenter",this.handleTopDragEnter),t.removeEventListener("dragenter",this.handleTopDragEnterCapture,!0),t.removeEventListener("dragleave",this.handleTopDragLeaveCapture,!0),t.removeEventListener("dragover",this.handleTopDragOver),t.removeEventListener("dragover",this.handleTopDragOverCapture,!0),t.removeEventListener("drop",this.handleTopDrop),t.removeEventListener("drop",this.handleTopDropCapture,!0))}getCurrentSourceNodeOptions(){const t=this.monitor.getSourceId(),r=this.sourceNodeOptions.get(t);return c4({dropEffect:this.altKeyPressed?"copy":"move"},r||{})}getCurrentDropEffect(){return this.isDraggingNativeItem()?"copy":this.getCurrentSourceNodeOptions().dropEffect}getCurrentSourcePreviewNodeOptions(){const t=this.monitor.getSourceId(),r=this.sourcePreviewNodeOptions.get(t);return c4({anchorX:.5,anchorY:.5,captureDraggingState:!1},r||{})}isDraggingNativeItem(){const t=this.monitor.getItemType();return Object.keys(a4).some(r=>a4[r]===t)}beginDragNativeItem(t,r){this.clearCurrentDragSourceNode(),this.currentNativeSource=Sle(t,r),this.currentNativeHandle=this.registry.addSource(t,this.currentNativeSource),this.actions.beginDrag([this.currentNativeHandle])}setCurrentDragSourceNode(t){this.clearCurrentDragSourceNode(),this.currentDragSourceNode=t;const r=1e3;this.mouseMoveTimeoutTimer=setTimeout(()=>{var o;return(o=this.rootElement)===null||o===void 0?void 0:o.addEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0)},r)}clearCurrentDragSourceNode(){if(this.currentDragSourceNode){if(this.currentDragSourceNode=null,this.rootElement){var t;(t=this.window)===null||t===void 0||t.clearTimeout(this.mouseMoveTimeoutTimer||void 0),this.rootElement.removeEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0)}return this.mouseMoveTimeoutTimer=null,!0}return!1}handleDragStart(t,r){t.defaultPrevented||(this.dragStartSourceIds||(this.dragStartSourceIds=[]),this.dragStartSourceIds.unshift(r))}handleDragEnter(t,r){this.dragEnterTargetIds.unshift(r)}handleDragOver(t,r){this.dragOverTargetIds===null&&(this.dragOverTargetIds=[]),this.dragOverTargetIds.unshift(r)}handleDrop(t,r){this.dropTargetIds.unshift(r)}constructor(t,r,o){this.sourcePreviewNodes=new Map,this.sourcePreviewNodeOptions=new Map,this.sourceNodes=new Map,this.sourceNodeOptions=new Map,this.dragStartSourceIds=null,this.dropTargetIds=[],this.dragEnterTargetIds=[],this.currentNativeSource=null,this.currentNativeHandle=null,this.currentDragSourceNode=null,this.altKeyPressed=!1,this.mouseMoveTimeoutTimer=null,this.asyncEndDragFrameId=null,this.dragOverTargetIds=null,this.lastClientOffset=null,this.hoverRafId=null,this.getSourceClientOffset=u=>{const m=this.sourceNodes.get(u);return m&&UV(m)||null},this.endDragNativeItem=()=>{this.isDraggingNativeItem()&&(this.actions.endDrag(),this.currentNativeHandle&&this.registry.removeSource(this.currentNativeHandle),this.currentNativeHandle=null,this.currentNativeSource=null)},this.isNodeInDocument=u=>!!(u&&this.document&&this.document.body&&this.document.body.contains(u)),this.endDragIfSourceWasRemovedFromDOM=()=>{const u=this.currentDragSourceNode;u==null||this.isNodeInDocument(u)||(this.clearCurrentDragSourceNode()&&this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover())},this.scheduleHover=u=>{this.hoverRafId===null&&typeof requestAnimationFrame<"u"&&(this.hoverRafId=requestAnimationFrame(()=>{this.monitor.isDragging()&&this.actions.hover(u||[],{clientOffset:this.lastClientOffset}),this.hoverRafId=null}))},this.cancelHover=()=>{this.hoverRafId!==null&&typeof cancelAnimationFrame<"u"&&(cancelAnimationFrame(this.hoverRafId),this.hoverRafId=null)},this.handleTopDragStartCapture=()=>{this.clearCurrentDragSourceNode(),this.dragStartSourceIds=[]},this.handleTopDragStart=u=>{if(u.defaultPrevented)return;const{dragStartSourceIds:m}=this;this.dragStartSourceIds=null;const _=Tv(u);this.monitor.isDragging()&&(this.actions.endDrag(),this.cancelHover()),this.actions.beginDrag(m||[],{publishSource:!1,getSourceClientOffset:this.getSourceClientOffset,clientOffset:_});const{dataTransfer:b}=u,s=aE(b);if(this.monitor.isDragging()){if(b&&typeof b.setDragImage=="function"){const O=this.monitor.getSourceId(),F=this.sourceNodes.get(O),q=this.sourcePreviewNodes.get(O)||F;if(q){const{anchorX:H,anchorY:J,offsetX:U,offsetY:te}=this.getCurrentSourcePreviewNodeOptions(),re=Mle(F,q,_,{anchorX:H,anchorY:J},{offsetX:U,offsetY:te});b.setDragImage(q,re.x,re.y)}}try{b==null||b.setData("application/json",{})}catch{}this.setCurrentDragSourceNode(u.target);const{captureDraggingState:k}=this.getCurrentSourcePreviewNodeOptions();k?this.actions.publishDragSource():setTimeout(()=>this.actions.publishDragSource(),0)}else if(s)this.beginDragNativeItem(s);else{if(b&&!b.types&&(u.target&&!u.target.hasAttribute||!u.target.hasAttribute("draggable")))return;u.preventDefault()}},this.handleTopDragEndCapture=()=>{this.clearCurrentDragSourceNode()&&this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover()},this.handleTopDragEnterCapture=u=>{if(this.dragEnterTargetIds=[],this.isDraggingNativeItem()){var m;(m=this.currentNativeSource)===null||m===void 0||m.loadDataTransfer(u.dataTransfer)}if(!this.enterLeaveCounter.enter(u.target)||this.monitor.isDragging())return;const{dataTransfer:b}=u,s=aE(b);s&&this.beginDragNativeItem(s,b)},this.handleTopDragEnter=u=>{const{dragEnterTargetIds:m}=this;if(this.dragEnterTargetIds=[],!this.monitor.isDragging())return;this.altKeyPressed=u.altKey,m.length>0&&this.actions.hover(m,{clientOffset:Tv(u)}),m.some(b=>this.monitor.canDropOnTarget(b))&&(u.preventDefault(),u.dataTransfer&&(u.dataTransfer.dropEffect=this.getCurrentDropEffect()))},this.handleTopDragOverCapture=u=>{if(this.dragOverTargetIds=[],this.isDraggingNativeItem()){var m;(m=this.currentNativeSource)===null||m===void 0||m.loadDataTransfer(u.dataTransfer)}},this.handleTopDragOver=u=>{const{dragOverTargetIds:m}=this;if(this.dragOverTargetIds=[],!this.monitor.isDragging()){u.preventDefault(),u.dataTransfer&&(u.dataTransfer.dropEffect="none");return}this.altKeyPressed=u.altKey,this.lastClientOffset=Tv(u),this.scheduleHover(m),(m||[]).some(b=>this.monitor.canDropOnTarget(b))?(u.preventDefault(),u.dataTransfer&&(u.dataTransfer.dropEffect=this.getCurrentDropEffect())):this.isDraggingNativeItem()?u.preventDefault():(u.preventDefault(),u.dataTransfer&&(u.dataTransfer.dropEffect="none"))},this.handleTopDragLeaveCapture=u=>{this.isDraggingNativeItem()&&u.preventDefault(),this.enterLeaveCounter.leave(u.target)&&(this.isDraggingNativeItem()&&setTimeout(()=>this.endDragNativeItem(),0),this.cancelHover())},this.handleTopDropCapture=u=>{if(this.dropTargetIds=[],this.isDraggingNativeItem()){var m;u.preventDefault(),(m=this.currentNativeSource)===null||m===void 0||m.loadDataTransfer(u.dataTransfer)}else aE(u.dataTransfer)&&u.preventDefault();this.enterLeaveCounter.reset()},this.handleTopDrop=u=>{const{dropTargetIds:m}=this;this.dropTargetIds=[],this.actions.hover(m,{clientOffset:Tv(u)}),this.actions.drop({dropEffect:this.getCurrentDropEffect()}),this.isDraggingNativeItem()?this.endDragNativeItem():this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover()},this.handleSelectStart=u=>{const m=u.target;typeof m.dragDrop=="function"&&(m.tagName==="INPUT"||m.tagName==="SELECT"||m.tagName==="TEXTAREA"||m.isContentEditable||(u.preventDefault(),m.dragDrop()))},this.options=new Ale(r,o),this.actions=t.getActions(),this.monitor=t.getMonitor(),this.registry=t.getRegistry(),this.enterLeaveCounter=new ble(this.isNodeInDocument)}}const Rle=function(t,r,o){return new Dle(t,r,o)};var $V={exports:{}};(function(e,t){var r={};(function(o,u){e.exports=u()})(M$,function(){var o,u,m;function _(s,k){if(!o)o=k;else if(!u)u=k;else{var O="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+o+")(sharedChunk); ("+u+")(sharedChunk); self.onerror = null;",F={};o(F),m=k(F),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(m.workerUrl=window.URL.createObjectURL(new Blob([O],{type:"text/javascript"})))}}_(["exports"],function(s){function k(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var O,F={},q={};function H(){if(O)return q;O=1,Object.defineProperty(q,"__esModule",{value:!0}),q.setMatrixArrayType=function(g){q.ARRAY_TYPE=n=g},q.toRadian=function(g){return g*d},q.equals=function(g,h){return Math.abs(g-h)<=c*Math.max(1,Math.abs(g),Math.abs(h))},q.RANDOM=q.ARRAY_TYPE=q.EPSILON=void 0;var c=1e-6;q.EPSILON=c;var n=typeof Float32Array<"u"?Float32Array:Array;q.ARRAY_TYPE=n;var a=Math.random;q.RANDOM=a;var d=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var g=0,h=arguments.length;h--;)g+=arguments[h]*arguments[h];return Math.sqrt(g)}),q}var J,U={};function te(){if(J)return U;function c(h){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},c(h)}J=1,Object.defineProperty(U,"__esModule",{value:!0}),U.create=function(){var h=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h},U.clone=function(h){var y=new n.ARRAY_TYPE(4);return y[0]=h[0],y[1]=h[1],y[2]=h[2],y[3]=h[3],y},U.copy=function(h,y){return h[0]=y[0],h[1]=y[1],h[2]=y[2],h[3]=y[3],h},U.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h},U.fromValues=function(h,y,T,M){var D=new n.ARRAY_TYPE(4);return D[0]=h,D[1]=y,D[2]=T,D[3]=M,D},U.set=function(h,y,T,M,D){return h[0]=y,h[1]=T,h[2]=M,h[3]=D,h},U.transpose=function(h,y){if(h===y){var T=y[1];h[1]=y[2],h[2]=T}else h[0]=y[0],h[1]=y[2],h[2]=y[1],h[3]=y[3];return h},U.invert=function(h,y){var T=y[0],M=y[1],D=y[2],v=y[3],C=T*v-D*M;return C?(h[0]=v*(C=1/C),h[1]=-M*C,h[2]=-D*C,h[3]=T*C,h):null},U.adjoint=function(h,y){var T=y[0];return h[0]=y[3],h[1]=-y[1],h[2]=-y[2],h[3]=T,h},U.determinant=function(h){return h[0]*h[3]-h[2]*h[1]},U.multiply=d,U.rotate=function(h,y,T){var M=y[0],D=y[1],v=y[2],C=y[3],I=Math.sin(T),P=Math.cos(T);return h[0]=M*P+v*I,h[1]=D*P+C*I,h[2]=M*-I+v*P,h[3]=D*-I+C*P,h},U.scale=function(h,y,T){var M=y[1],D=y[2],v=y[3],C=T[0],I=T[1];return h[0]=y[0]*C,h[1]=M*C,h[2]=D*I,h[3]=v*I,h},U.fromRotation=function(h,y){var T=Math.sin(y),M=Math.cos(y);return h[0]=M,h[1]=T,h[2]=-T,h[3]=M,h},U.fromScaling=function(h,y){return h[0]=y[0],h[1]=0,h[2]=0,h[3]=y[1],h},U.str=function(h){return"mat2("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+")"},U.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3])},U.LDU=function(h,y,T,M){return h[2]=M[2]/M[0],T[0]=M[0],T[1]=M[1],T[3]=M[3]-h[2]*T[1],[h,y,T]},U.add=function(h,y,T){return h[0]=y[0]+T[0],h[1]=y[1]+T[1],h[2]=y[2]+T[2],h[3]=y[3]+T[3],h},U.subtract=g,U.exactEquals=function(h,y){return h[0]===y[0]&&h[1]===y[1]&&h[2]===y[2]&&h[3]===y[3]},U.equals=function(h,y){var T=h[0],M=h[1],D=h[2],v=h[3],C=y[0],I=y[1],P=y[2],A=y[3];return Math.abs(T-C)<=n.EPSILON*Math.max(1,Math.abs(T),Math.abs(C))&&Math.abs(M-I)<=n.EPSILON*Math.max(1,Math.abs(M),Math.abs(I))&&Math.abs(D-P)<=n.EPSILON*Math.max(1,Math.abs(D),Math.abs(P))&&Math.abs(v-A)<=n.EPSILON*Math.max(1,Math.abs(v),Math.abs(A))},U.multiplyScalar=function(h,y,T){return h[0]=y[0]*T,h[1]=y[1]*T,h[2]=y[2]*T,h[3]=y[3]*T,h},U.multiplyScalarAndAdd=function(h,y,T,M){return h[0]=y[0]+T[0]*M,h[1]=y[1]+T[1]*M,h[2]=y[2]+T[2]*M,h[3]=y[3]+T[3]*M,h},U.sub=U.mul=void 0;var n=function(h,y){if(h&&h.__esModule)return h;if(h===null||c(h)!=="object"&&typeof h!="function")return{default:h};var T=a(void 0);if(T&&T.has(h))return T.get(h);var M={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in h)if(v!=="default"&&Object.prototype.hasOwnProperty.call(h,v)){var C=D?Object.getOwnPropertyDescriptor(h,v):null;C&&(C.get||C.set)?Object.defineProperty(M,v,C):M[v]=h[v]}return M.default=h,T&&T.set(h,M),M}(H());function a(h){if(typeof WeakMap!="function")return null;var y=new WeakMap,T=new WeakMap;return(a=function(M){return M?T:y})(h)}function d(h,y,T){var M=y[0],D=y[1],v=y[2],C=y[3],I=T[0],P=T[1],A=T[2],N=T[3];return h[0]=M*I+v*P,h[1]=D*I+C*P,h[2]=M*A+v*N,h[3]=D*A+C*N,h}function g(h,y,T){return h[0]=y[0]-T[0],h[1]=y[1]-T[1],h[2]=y[2]-T[2],h[3]=y[3]-T[3],h}return U.mul=d,U.sub=g,U}var Q,ee={};function re(){if(Q)return ee;function c(h){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},c(h)}Q=1,Object.defineProperty(ee,"__esModule",{value:!0}),ee.create=function(){var h=new n.ARRAY_TYPE(6);return n.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[4]=0,h[5]=0),h[0]=1,h[3]=1,h},ee.clone=function(h){var y=new n.ARRAY_TYPE(6);return y[0]=h[0],y[1]=h[1],y[2]=h[2],y[3]=h[3],y[4]=h[4],y[5]=h[5],y},ee.copy=function(h,y){return h[0]=y[0],h[1]=y[1],h[2]=y[2],h[3]=y[3],h[4]=y[4],h[5]=y[5],h},ee.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=0,h[5]=0,h},ee.fromValues=function(h,y,T,M,D,v){var C=new n.ARRAY_TYPE(6);return C[0]=h,C[1]=y,C[2]=T,C[3]=M,C[4]=D,C[5]=v,C},ee.set=function(h,y,T,M,D,v,C){return h[0]=y,h[1]=T,h[2]=M,h[3]=D,h[4]=v,h[5]=C,h},ee.invert=function(h,y){var T=y[0],M=y[1],D=y[2],v=y[3],C=y[4],I=y[5],P=T*v-M*D;return P?(h[0]=v*(P=1/P),h[1]=-M*P,h[2]=-D*P,h[3]=T*P,h[4]=(D*I-v*C)*P,h[5]=(M*C-T*I)*P,h):null},ee.determinant=function(h){return h[0]*h[3]-h[1]*h[2]},ee.multiply=d,ee.rotate=function(h,y,T){var M=y[0],D=y[1],v=y[2],C=y[3],I=y[4],P=y[5],A=Math.sin(T),N=Math.cos(T);return h[0]=M*N+v*A,h[1]=D*N+C*A,h[2]=M*-A+v*N,h[3]=D*-A+C*N,h[4]=I,h[5]=P,h},ee.scale=function(h,y,T){var M=y[1],D=y[2],v=y[3],C=y[4],I=y[5],P=T[0],A=T[1];return h[0]=y[0]*P,h[1]=M*P,h[2]=D*A,h[3]=v*A,h[4]=C,h[5]=I,h},ee.translate=function(h,y,T){var M=y[0],D=y[1],v=y[2],C=y[3],I=y[4],P=y[5],A=T[0],N=T[1];return h[0]=M,h[1]=D,h[2]=v,h[3]=C,h[4]=M*A+v*N+I,h[5]=D*A+C*N+P,h},ee.fromRotation=function(h,y){var T=Math.sin(y),M=Math.cos(y);return h[0]=M,h[1]=T,h[2]=-T,h[3]=M,h[4]=0,h[5]=0,h},ee.fromScaling=function(h,y){return h[0]=y[0],h[1]=0,h[2]=0,h[3]=y[1],h[4]=0,h[5]=0,h},ee.fromTranslation=function(h,y){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=y[0],h[5]=y[1],h},ee.str=function(h){return"mat2d("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+")"},ee.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],1)},ee.add=function(h,y,T){return h[0]=y[0]+T[0],h[1]=y[1]+T[1],h[2]=y[2]+T[2],h[3]=y[3]+T[3],h[4]=y[4]+T[4],h[5]=y[5]+T[5],h},ee.subtract=g,ee.multiplyScalar=function(h,y,T){return h[0]=y[0]*T,h[1]=y[1]*T,h[2]=y[2]*T,h[3]=y[3]*T,h[4]=y[4]*T,h[5]=y[5]*T,h},ee.multiplyScalarAndAdd=function(h,y,T,M){return h[0]=y[0]+T[0]*M,h[1]=y[1]+T[1]*M,h[2]=y[2]+T[2]*M,h[3]=y[3]+T[3]*M,h[4]=y[4]+T[4]*M,h[5]=y[5]+T[5]*M,h},ee.exactEquals=function(h,y){return h[0]===y[0]&&h[1]===y[1]&&h[2]===y[2]&&h[3]===y[3]&&h[4]===y[4]&&h[5]===y[5]},ee.equals=function(h,y){var T=h[0],M=h[1],D=h[2],v=h[3],C=h[4],I=h[5],P=y[0],A=y[1],N=y[2],j=y[3],V=y[4],X=y[5];return Math.abs(T-P)<=n.EPSILON*Math.max(1,Math.abs(T),Math.abs(P))&&Math.abs(M-A)<=n.EPSILON*Math.max(1,Math.abs(M),Math.abs(A))&&Math.abs(D-N)<=n.EPSILON*Math.max(1,Math.abs(D),Math.abs(N))&&Math.abs(v-j)<=n.EPSILON*Math.max(1,Math.abs(v),Math.abs(j))&&Math.abs(C-V)<=n.EPSILON*Math.max(1,Math.abs(C),Math.abs(V))&&Math.abs(I-X)<=n.EPSILON*Math.max(1,Math.abs(I),Math.abs(X))},ee.sub=ee.mul=void 0;var n=function(h,y){if(h&&h.__esModule)return h;if(h===null||c(h)!=="object"&&typeof h!="function")return{default:h};var T=a(void 0);if(T&&T.has(h))return T.get(h);var M={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in h)if(v!=="default"&&Object.prototype.hasOwnProperty.call(h,v)){var C=D?Object.getOwnPropertyDescriptor(h,v):null;C&&(C.get||C.set)?Object.defineProperty(M,v,C):M[v]=h[v]}return M.default=h,T&&T.set(h,M),M}(H());function a(h){if(typeof WeakMap!="function")return null;var y=new WeakMap,T=new WeakMap;return(a=function(M){return M?T:y})(h)}function d(h,y,T){var M=y[0],D=y[1],v=y[2],C=y[3],I=y[4],P=y[5],A=T[0],N=T[1],j=T[2],V=T[3],X=T[4],K=T[5];return h[0]=M*A+v*N,h[1]=D*A+C*N,h[2]=M*j+v*V,h[3]=D*j+C*V,h[4]=M*X+v*K+I,h[5]=D*X+C*K+P,h}function g(h,y,T){return h[0]=y[0]-T[0],h[1]=y[1]-T[1],h[2]=y[2]-T[2],h[3]=y[3]-T[3],h[4]=y[4]-T[4],h[5]=y[5]-T[5],h}return ee.mul=d,ee.sub=g,ee}var xe,Ee={};function He(){if(xe)return Ee;function c(h){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},c(h)}xe=1,Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.create=function(){var h=new n.ARRAY_TYPE(9);return n.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,h},Ee.fromMat4=function(h,y){return h[0]=y[0],h[1]=y[1],h[2]=y[2],h[3]=y[4],h[4]=y[5],h[5]=y[6],h[6]=y[8],h[7]=y[9],h[8]=y[10],h},Ee.clone=function(h){var y=new n.ARRAY_TYPE(9);return y[0]=h[0],y[1]=h[1],y[2]=h[2],y[3]=h[3],y[4]=h[4],y[5]=h[5],y[6]=h[6],y[7]=h[7],y[8]=h[8],y},Ee.copy=function(h,y){return h[0]=y[0],h[1]=y[1],h[2]=y[2],h[3]=y[3],h[4]=y[4],h[5]=y[5],h[6]=y[6],h[7]=y[7],h[8]=y[8],h},Ee.fromValues=function(h,y,T,M,D,v,C,I,P){var A=new n.ARRAY_TYPE(9);return A[0]=h,A[1]=y,A[2]=T,A[3]=M,A[4]=D,A[5]=v,A[6]=C,A[7]=I,A[8]=P,A},Ee.set=function(h,y,T,M,D,v,C,I,P,A){return h[0]=y,h[1]=T,h[2]=M,h[3]=D,h[4]=v,h[5]=C,h[6]=I,h[7]=P,h[8]=A,h},Ee.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},Ee.transpose=function(h,y){if(h===y){var T=y[1],M=y[2],D=y[5];h[1]=y[3],h[2]=y[6],h[3]=T,h[5]=y[7],h[6]=M,h[7]=D}else h[0]=y[0],h[1]=y[3],h[2]=y[6],h[3]=y[1],h[4]=y[4],h[5]=y[7],h[6]=y[2],h[7]=y[5],h[8]=y[8];return h},Ee.invert=function(h,y){var T=y[0],M=y[1],D=y[2],v=y[3],C=y[4],I=y[5],P=y[6],A=y[7],N=y[8],j=N*C-I*A,V=-N*v+I*P,X=A*v-C*P,K=T*j+M*V+D*X;return K?(h[0]=j*(K=1/K),h[1]=(-N*M+D*A)*K,h[2]=(I*M-D*C)*K,h[3]=V*K,h[4]=(N*T-D*P)*K,h[5]=(-I*T+D*v)*K,h[6]=X*K,h[7]=(-A*T+M*P)*K,h[8]=(C*T-M*v)*K,h):null},Ee.adjoint=function(h,y){var T=y[0],M=y[1],D=y[2],v=y[3],C=y[4],I=y[5],P=y[6],A=y[7],N=y[8];return h[0]=C*N-I*A,h[1]=D*A-M*N,h[2]=M*I-D*C,h[3]=I*P-v*N,h[4]=T*N-D*P,h[5]=D*v-T*I,h[6]=v*A-C*P,h[7]=M*P-T*A,h[8]=T*C-M*v,h},Ee.determinant=function(h){var y=h[3],T=h[4],M=h[5],D=h[6],v=h[7],C=h[8];return h[0]*(C*T-M*v)+h[1]*(-C*y+M*D)+h[2]*(v*y-T*D)},Ee.multiply=d,Ee.translate=function(h,y,T){var M=y[0],D=y[1],v=y[2],C=y[3],I=y[4],P=y[5],A=y[6],N=y[7],j=y[8],V=T[0],X=T[1];return h[0]=M,h[1]=D,h[2]=v,h[3]=C,h[4]=I,h[5]=P,h[6]=V*M+X*C+A,h[7]=V*D+X*I+N,h[8]=V*v+X*P+j,h},Ee.rotate=function(h,y,T){var M=y[0],D=y[1],v=y[2],C=y[3],I=y[4],P=y[5],A=y[6],N=y[7],j=y[8],V=Math.sin(T),X=Math.cos(T);return h[0]=X*M+V*C,h[1]=X*D+V*I,h[2]=X*v+V*P,h[3]=X*C-V*M,h[4]=X*I-V*D,h[5]=X*P-V*v,h[6]=A,h[7]=N,h[8]=j,h},Ee.scale=function(h,y,T){var M=T[0],D=T[1];return h[0]=M*y[0],h[1]=M*y[1],h[2]=M*y[2],h[3]=D*y[3],h[4]=D*y[4],h[5]=D*y[5],h[6]=y[6],h[7]=y[7],h[8]=y[8],h},Ee.fromTranslation=function(h,y){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=y[0],h[7]=y[1],h[8]=1,h},Ee.fromRotation=function(h,y){var T=Math.sin(y),M=Math.cos(y);return h[0]=M,h[1]=T,h[2]=0,h[3]=-T,h[4]=M,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},Ee.fromScaling=function(h,y){return h[0]=y[0],h[1]=0,h[2]=0,h[3]=0,h[4]=y[1],h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},Ee.fromMat2d=function(h,y){return h[0]=y[0],h[1]=y[1],h[2]=0,h[3]=y[2],h[4]=y[3],h[5]=0,h[6]=y[4],h[7]=y[5],h[8]=1,h},Ee.fromQuat=function(h,y){var T=y[0],M=y[1],D=y[2],v=y[3],C=T+T,I=M+M,P=D+D,A=T*C,N=M*C,j=M*I,V=D*C,X=D*I,K=D*P,$=v*C,ne=v*I,ie=v*P;return h[0]=1-j-K,h[3]=N-ie,h[6]=V+ne,h[1]=N+ie,h[4]=1-A-K,h[7]=X-$,h[2]=V-ne,h[5]=X+$,h[8]=1-A-j,h},Ee.normalFromMat4=function(h,y){var T=y[0],M=y[1],D=y[2],v=y[3],C=y[4],I=y[5],P=y[6],A=y[7],N=y[8],j=y[9],V=y[10],X=y[11],K=y[12],$=y[13],ne=y[14],ie=y[15],ue=T*I-M*C,pe=T*P-D*C,ge=T*A-v*C,he=M*P-D*I,Se=M*A-v*I,_e=D*A-v*P,Ce=N*$-j*K,Le=N*ne-V*K,je=N*ie-X*K,ze=j*ne-V*$,Fe=j*ie-X*$,Ze=V*ie-X*ne,Ve=ue*Ze-pe*Fe+ge*ze+he*je-Se*Le+_e*Ce;return Ve?(h[0]=(I*Ze-P*Fe+A*ze)*(Ve=1/Ve),h[1]=(P*je-C*Ze-A*Le)*Ve,h[2]=(C*Fe-I*je+A*Ce)*Ve,h[3]=(D*Fe-M*Ze-v*ze)*Ve,h[4]=(T*Ze-D*je+v*Le)*Ve,h[5]=(M*je-T*Fe-v*Ce)*Ve,h[6]=($*_e-ne*Se+ie*he)*Ve,h[7]=(ne*ge-K*_e-ie*pe)*Ve,h[8]=(K*Se-$*ge+ie*ue)*Ve,h):null},Ee.projection=function(h,y,T){return h[0]=2/y,h[1]=0,h[2]=0,h[3]=0,h[4]=-2/T,h[5]=0,h[6]=-1,h[7]=1,h[8]=1,h},Ee.str=function(h){return"mat3("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+", "+h[6]+", "+h[7]+", "+h[8]+")"},Ee.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],h[8])},Ee.add=function(h,y,T){return h[0]=y[0]+T[0],h[1]=y[1]+T[1],h[2]=y[2]+T[2],h[3]=y[3]+T[3],h[4]=y[4]+T[4],h[5]=y[5]+T[5],h[6]=y[6]+T[6],h[7]=y[7]+T[7],h[8]=y[8]+T[8],h},Ee.subtract=g,Ee.multiplyScalar=function(h,y,T){return h[0]=y[0]*T,h[1]=y[1]*T,h[2]=y[2]*T,h[3]=y[3]*T,h[4]=y[4]*T,h[5]=y[5]*T,h[6]=y[6]*T,h[7]=y[7]*T,h[8]=y[8]*T,h},Ee.multiplyScalarAndAdd=function(h,y,T,M){return h[0]=y[0]+T[0]*M,h[1]=y[1]+T[1]*M,h[2]=y[2]+T[2]*M,h[3]=y[3]+T[3]*M,h[4]=y[4]+T[4]*M,h[5]=y[5]+T[5]*M,h[6]=y[6]+T[6]*M,h[7]=y[7]+T[7]*M,h[8]=y[8]+T[8]*M,h},Ee.exactEquals=function(h,y){return h[0]===y[0]&&h[1]===y[1]&&h[2]===y[2]&&h[3]===y[3]&&h[4]===y[4]&&h[5]===y[5]&&h[6]===y[6]&&h[7]===y[7]&&h[8]===y[8]},Ee.equals=function(h,y){var T=h[0],M=h[1],D=h[2],v=h[3],C=h[4],I=h[5],P=h[6],A=h[7],N=h[8],j=y[0],V=y[1],X=y[2],K=y[3],$=y[4],ne=y[5],ie=y[6],ue=y[7],pe=y[8];return Math.abs(T-j)<=n.EPSILON*Math.max(1,Math.abs(T),Math.abs(j))&&Math.abs(M-V)<=n.EPSILON*Math.max(1,Math.abs(M),Math.abs(V))&&Math.abs(D-X)<=n.EPSILON*Math.max(1,Math.abs(D),Math.abs(X))&&Math.abs(v-K)<=n.EPSILON*Math.max(1,Math.abs(v),Math.abs(K))&&Math.abs(C-$)<=n.EPSILON*Math.max(1,Math.abs(C),Math.abs($))&&Math.abs(I-ne)<=n.EPSILON*Math.max(1,Math.abs(I),Math.abs(ne))&&Math.abs(P-ie)<=n.EPSILON*Math.max(1,Math.abs(P),Math.abs(ie))&&Math.abs(A-ue)<=n.EPSILON*Math.max(1,Math.abs(A),Math.abs(ue))&&Math.abs(N-pe)<=n.EPSILON*Math.max(1,Math.abs(N),Math.abs(pe))},Ee.sub=Ee.mul=void 0;var n=function(h,y){if(h&&h.__esModule)return h;if(h===null||c(h)!=="object"&&typeof h!="function")return{default:h};var T=a(void 0);if(T&&T.has(h))return T.get(h);var M={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in h)if(v!=="default"&&Object.prototype.hasOwnProperty.call(h,v)){var C=D?Object.getOwnPropertyDescriptor(h,v):null;C&&(C.get||C.set)?Object.defineProperty(M,v,C):M[v]=h[v]}return M.default=h,T&&T.set(h,M),M}(H());function a(h){if(typeof WeakMap!="function")return null;var y=new WeakMap,T=new WeakMap;return(a=function(M){return M?T:y})(h)}function d(h,y,T){var M=y[0],D=y[1],v=y[2],C=y[3],I=y[4],P=y[5],A=y[6],N=y[7],j=y[8],V=T[0],X=T[1],K=T[2],$=T[3],ne=T[4],ie=T[5],ue=T[6],pe=T[7],ge=T[8];return h[0]=V*M+X*C+K*A,h[1]=V*D+X*I+K*N,h[2]=V*v+X*P+K*j,h[3]=$*M+ne*C+ie*A,h[4]=$*D+ne*I+ie*N,h[5]=$*v+ne*P+ie*j,h[6]=ue*M+pe*C+ge*A,h[7]=ue*D+pe*I+ge*N,h[8]=ue*v+pe*P+ge*j,h}function g(h,y,T){return h[0]=y[0]-T[0],h[1]=y[1]-T[1],h[2]=y[2]-T[2],h[3]=y[3]-T[3],h[4]=y[4]-T[4],h[5]=y[5]-T[5],h[6]=y[6]-T[6],h[7]=y[7]-T[7],h[8]=y[8]-T[8],h}return Ee.mul=d,Ee.sub=g,Ee}var qe,Ne={};function ft(){if(qe)return Ne;function c(v){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},c(v)}qe=1,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.create=function(){var v=new n.ARRAY_TYPE(16);return n.ARRAY_TYPE!=Float32Array&&(v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=0,v[12]=0,v[13]=0,v[14]=0),v[0]=1,v[5]=1,v[10]=1,v[15]=1,v},Ne.clone=function(v){var C=new n.ARRAY_TYPE(16);return C[0]=v[0],C[1]=v[1],C[2]=v[2],C[3]=v[3],C[4]=v[4],C[5]=v[5],C[6]=v[6],C[7]=v[7],C[8]=v[8],C[9]=v[9],C[10]=v[10],C[11]=v[11],C[12]=v[12],C[13]=v[13],C[14]=v[14],C[15]=v[15],C},Ne.copy=function(v,C){return v[0]=C[0],v[1]=C[1],v[2]=C[2],v[3]=C[3],v[4]=C[4],v[5]=C[5],v[6]=C[6],v[7]=C[7],v[8]=C[8],v[9]=C[9],v[10]=C[10],v[11]=C[11],v[12]=C[12],v[13]=C[13],v[14]=C[14],v[15]=C[15],v},Ne.fromValues=function(v,C,I,P,A,N,j,V,X,K,$,ne,ie,ue,pe,ge){var he=new n.ARRAY_TYPE(16);return he[0]=v,he[1]=C,he[2]=I,he[3]=P,he[4]=A,he[5]=N,he[6]=j,he[7]=V,he[8]=X,he[9]=K,he[10]=$,he[11]=ne,he[12]=ie,he[13]=ue,he[14]=pe,he[15]=ge,he},Ne.set=function(v,C,I,P,A,N,j,V,X,K,$,ne,ie,ue,pe,ge,he){return v[0]=C,v[1]=I,v[2]=P,v[3]=A,v[4]=N,v[5]=j,v[6]=V,v[7]=X,v[8]=K,v[9]=$,v[10]=ne,v[11]=ie,v[12]=ue,v[13]=pe,v[14]=ge,v[15]=he,v},Ne.identity=d,Ne.transpose=function(v,C){if(v===C){var I=C[1],P=C[2],A=C[3],N=C[6],j=C[7],V=C[11];v[1]=C[4],v[2]=C[8],v[3]=C[12],v[4]=I,v[6]=C[9],v[7]=C[13],v[8]=P,v[9]=N,v[11]=C[14],v[12]=A,v[13]=j,v[14]=V}else v[0]=C[0],v[1]=C[4],v[2]=C[8],v[3]=C[12],v[4]=C[1],v[5]=C[5],v[6]=C[9],v[7]=C[13],v[8]=C[2],v[9]=C[6],v[10]=C[10],v[11]=C[14],v[12]=C[3],v[13]=C[7],v[14]=C[11],v[15]=C[15];return v},Ne.invert=function(v,C){var I=C[0],P=C[1],A=C[2],N=C[3],j=C[4],V=C[5],X=C[6],K=C[7],$=C[8],ne=C[9],ie=C[10],ue=C[11],pe=C[12],ge=C[13],he=C[14],Se=C[15],_e=I*V-P*j,Ce=I*X-A*j,Le=I*K-N*j,je=P*X-A*V,ze=P*K-N*V,Fe=A*K-N*X,Ze=$*ge-ne*pe,Ve=$*he-ie*pe,rt=$*Se-ue*pe,ct=ne*he-ie*ge,Je=ne*Se-ue*ge,Dt=ie*Se-ue*he,Pt=_e*Dt-Ce*Je+Le*ct+je*rt-ze*Ve+Fe*Ze;return Pt?(v[0]=(V*Dt-X*Je+K*ct)*(Pt=1/Pt),v[1]=(A*Je-P*Dt-N*ct)*Pt,v[2]=(ge*Fe-he*ze+Se*je)*Pt,v[3]=(ie*ze-ne*Fe-ue*je)*Pt,v[4]=(X*rt-j*Dt-K*Ve)*Pt,v[5]=(I*Dt-A*rt+N*Ve)*Pt,v[6]=(he*Le-pe*Fe-Se*Ce)*Pt,v[7]=($*Fe-ie*Le+ue*Ce)*Pt,v[8]=(j*Je-V*rt+K*Ze)*Pt,v[9]=(P*rt-I*Je-N*Ze)*Pt,v[10]=(pe*ze-ge*Le+Se*_e)*Pt,v[11]=(ne*Le-$*ze-ue*_e)*Pt,v[12]=(V*Ve-j*ct-X*Ze)*Pt,v[13]=(I*ct-P*Ve+A*Ze)*Pt,v[14]=(ge*Ce-pe*je-he*_e)*Pt,v[15]=($*je-ne*Ce+ie*_e)*Pt,v):null},Ne.adjoint=function(v,C){var I=C[0],P=C[1],A=C[2],N=C[3],j=C[4],V=C[5],X=C[6],K=C[7],$=C[8],ne=C[9],ie=C[10],ue=C[11],pe=C[12],ge=C[13],he=C[14],Se=C[15];return v[0]=V*(ie*Se-ue*he)-ne*(X*Se-K*he)+ge*(X*ue-K*ie),v[1]=-(P*(ie*Se-ue*he)-ne*(A*Se-N*he)+ge*(A*ue-N*ie)),v[2]=P*(X*Se-K*he)-V*(A*Se-N*he)+ge*(A*K-N*X),v[3]=-(P*(X*ue-K*ie)-V*(A*ue-N*ie)+ne*(A*K-N*X)),v[4]=-(j*(ie*Se-ue*he)-$*(X*Se-K*he)+pe*(X*ue-K*ie)),v[5]=I*(ie*Se-ue*he)-$*(A*Se-N*he)+pe*(A*ue-N*ie),v[6]=-(I*(X*Se-K*he)-j*(A*Se-N*he)+pe*(A*K-N*X)),v[7]=I*(X*ue-K*ie)-j*(A*ue-N*ie)+$*(A*K-N*X),v[8]=j*(ne*Se-ue*ge)-$*(V*Se-K*ge)+pe*(V*ue-K*ne),v[9]=-(I*(ne*Se-ue*ge)-$*(P*Se-N*ge)+pe*(P*ue-N*ne)),v[10]=I*(V*Se-K*ge)-j*(P*Se-N*ge)+pe*(P*K-N*V),v[11]=-(I*(V*ue-K*ne)-j*(P*ue-N*ne)+$*(P*K-N*V)),v[12]=-(j*(ne*he-ie*ge)-$*(V*he-X*ge)+pe*(V*ie-X*ne)),v[13]=I*(ne*he-ie*ge)-$*(P*he-A*ge)+pe*(P*ie-A*ne),v[14]=-(I*(V*he-X*ge)-j*(P*he-A*ge)+pe*(P*X-A*V)),v[15]=I*(V*ie-X*ne)-j*(P*ie-A*ne)+$*(P*X-A*V),v},Ne.determinant=function(v){var C=v[0],I=v[1],P=v[2],A=v[3],N=v[4],j=v[5],V=v[6],X=v[7],K=v[8],$=v[9],ne=v[10],ie=v[11],ue=v[12],pe=v[13],ge=v[14],he=v[15];return(C*j-I*N)*(ne*he-ie*ge)-(C*V-P*N)*($*he-ie*pe)+(C*X-A*N)*($*ge-ne*pe)+(I*V-P*j)*(K*he-ie*ue)-(I*X-A*j)*(K*ge-ne*ue)+(P*X-A*V)*(K*pe-$*ue)},Ne.multiply=g,Ne.translate=function(v,C,I){var P,A,N,j,V,X,K,$,ne,ie,ue,pe,ge=I[0],he=I[1],Se=I[2];return C===v?(v[12]=C[0]*ge+C[4]*he+C[8]*Se+C[12],v[13]=C[1]*ge+C[5]*he+C[9]*Se+C[13],v[14]=C[2]*ge+C[6]*he+C[10]*Se+C[14],v[15]=C[3]*ge+C[7]*he+C[11]*Se+C[15]):(A=C[1],N=C[2],j=C[3],V=C[4],X=C[5],K=C[6],$=C[7],ne=C[8],ie=C[9],ue=C[10],pe=C[11],v[0]=P=C[0],v[1]=A,v[2]=N,v[3]=j,v[4]=V,v[5]=X,v[6]=K,v[7]=$,v[8]=ne,v[9]=ie,v[10]=ue,v[11]=pe,v[12]=P*ge+V*he+ne*Se+C[12],v[13]=A*ge+X*he+ie*Se+C[13],v[14]=N*ge+K*he+ue*Se+C[14],v[15]=j*ge+$*he+pe*Se+C[15]),v},Ne.scale=function(v,C,I){var P=I[0],A=I[1],N=I[2];return v[0]=C[0]*P,v[1]=C[1]*P,v[2]=C[2]*P,v[3]=C[3]*P,v[4]=C[4]*A,v[5]=C[5]*A,v[6]=C[6]*A,v[7]=C[7]*A,v[8]=C[8]*N,v[9]=C[9]*N,v[10]=C[10]*N,v[11]=C[11]*N,v[12]=C[12],v[13]=C[13],v[14]=C[14],v[15]=C[15],v},Ne.rotate=function(v,C,I,P){var A,N,j,V,X,K,$,ne,ie,ue,pe,ge,he,Se,_e,Ce,Le,je,ze,Fe,Ze,Ve,rt,ct,Je=P[0],Dt=P[1],Pt=P[2],xt=Math.hypot(Je,Dt,Pt);return xt<n.EPSILON?null:(Je*=xt=1/xt,Dt*=xt,Pt*=xt,A=Math.sin(I),N=Math.cos(I),X=C[1],K=C[2],$=C[3],ie=C[5],ue=C[6],pe=C[7],he=C[9],Se=C[10],_e=C[11],Ce=Je*Je*(j=1-N)+N,ze=Je*Dt*j-Pt*A,Fe=Dt*Dt*j+N,Ze=Pt*Dt*j+Je*A,Ve=Je*Pt*j+Dt*A,rt=Dt*Pt*j-Je*A,ct=Pt*Pt*j+N,v[0]=(V=C[0])*Ce+(ne=C[4])*(Le=Dt*Je*j+Pt*A)+(ge=C[8])*(je=Pt*Je*j-Dt*A),v[1]=X*Ce+ie*Le+he*je,v[2]=K*Ce+ue*Le+Se*je,v[3]=$*Ce+pe*Le+_e*je,v[4]=V*ze+ne*Fe+ge*Ze,v[5]=X*ze+ie*Fe+he*Ze,v[6]=K*ze+ue*Fe+Se*Ze,v[7]=$*ze+pe*Fe+_e*Ze,v[8]=V*Ve+ne*rt+ge*ct,v[9]=X*Ve+ie*rt+he*ct,v[10]=K*Ve+ue*rt+Se*ct,v[11]=$*Ve+pe*rt+_e*ct,C!==v&&(v[12]=C[12],v[13]=C[13],v[14]=C[14],v[15]=C[15]),v)},Ne.rotateX=function(v,C,I){var P=Math.sin(I),A=Math.cos(I),N=C[4],j=C[5],V=C[6],X=C[7],K=C[8],$=C[9],ne=C[10],ie=C[11];return C!==v&&(v[0]=C[0],v[1]=C[1],v[2]=C[2],v[3]=C[3],v[12]=C[12],v[13]=C[13],v[14]=C[14],v[15]=C[15]),v[4]=N*A+K*P,v[5]=j*A+$*P,v[6]=V*A+ne*P,v[7]=X*A+ie*P,v[8]=K*A-N*P,v[9]=$*A-j*P,v[10]=ne*A-V*P,v[11]=ie*A-X*P,v},Ne.rotateY=function(v,C,I){var P=Math.sin(I),A=Math.cos(I),N=C[0],j=C[1],V=C[2],X=C[3],K=C[8],$=C[9],ne=C[10],ie=C[11];return C!==v&&(v[4]=C[4],v[5]=C[5],v[6]=C[6],v[7]=C[7],v[12]=C[12],v[13]=C[13],v[14]=C[14],v[15]=C[15]),v[0]=N*A-K*P,v[1]=j*A-$*P,v[2]=V*A-ne*P,v[3]=X*A-ie*P,v[8]=N*P+K*A,v[9]=j*P+$*A,v[10]=V*P+ne*A,v[11]=X*P+ie*A,v},Ne.rotateZ=function(v,C,I){var P=Math.sin(I),A=Math.cos(I),N=C[0],j=C[1],V=C[2],X=C[3],K=C[4],$=C[5],ne=C[6],ie=C[7];return C!==v&&(v[8]=C[8],v[9]=C[9],v[10]=C[10],v[11]=C[11],v[12]=C[12],v[13]=C[13],v[14]=C[14],v[15]=C[15]),v[0]=N*A+K*P,v[1]=j*A+$*P,v[2]=V*A+ne*P,v[3]=X*A+ie*P,v[4]=K*A-N*P,v[5]=$*A-j*P,v[6]=ne*A-V*P,v[7]=ie*A-X*P,v},Ne.fromTranslation=function(v,C){return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=1,v[11]=0,v[12]=C[0],v[13]=C[1],v[14]=C[2],v[15]=1,v},Ne.fromScaling=function(v,C){return v[0]=C[0],v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=C[1],v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=C[2],v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},Ne.fromRotation=function(v,C,I){var P,A,N,j=I[0],V=I[1],X=I[2],K=Math.hypot(j,V,X);return K<n.EPSILON?null:(j*=K=1/K,V*=K,X*=K,P=Math.sin(C),A=Math.cos(C),v[0]=j*j*(N=1-A)+A,v[1]=V*j*N+X*P,v[2]=X*j*N-V*P,v[3]=0,v[4]=j*V*N-X*P,v[5]=V*V*N+A,v[6]=X*V*N+j*P,v[7]=0,v[8]=j*X*N+V*P,v[9]=V*X*N-j*P,v[10]=X*X*N+A,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v)},Ne.fromXRotation=function(v,C){var I=Math.sin(C),P=Math.cos(C);return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=P,v[6]=I,v[7]=0,v[8]=0,v[9]=-I,v[10]=P,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},Ne.fromYRotation=function(v,C){var I=Math.sin(C),P=Math.cos(C);return v[0]=P,v[1]=0,v[2]=-I,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=I,v[9]=0,v[10]=P,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},Ne.fromZRotation=function(v,C){var I=Math.sin(C),P=Math.cos(C);return v[0]=P,v[1]=I,v[2]=0,v[3]=0,v[4]=-I,v[5]=P,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=1,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},Ne.fromRotationTranslation=h,Ne.fromQuat2=function(v,C){var I=new n.ARRAY_TYPE(3),P=-C[0],A=-C[1],N=-C[2],j=C[3],V=C[4],X=C[5],K=C[6],$=C[7],ne=P*P+A*A+N*N+j*j;return ne>0?(I[0]=2*(V*j+$*P+X*N-K*A)/ne,I[1]=2*(X*j+$*A+K*P-V*N)/ne,I[2]=2*(K*j+$*N+V*A-X*P)/ne):(I[0]=2*(V*j+$*P+X*N-K*A),I[1]=2*(X*j+$*A+K*P-V*N),I[2]=2*(K*j+$*N+V*A-X*P)),h(v,C,I),v},Ne.getTranslation=function(v,C){return v[0]=C[12],v[1]=C[13],v[2]=C[14],v},Ne.getScaling=y,Ne.getRotation=function(v,C){var I=new n.ARRAY_TYPE(3);y(I,C);var P=1/I[0],A=1/I[1],N=1/I[2],j=C[0]*P,V=C[1]*A,X=C[2]*N,K=C[4]*P,$=C[5]*A,ne=C[6]*N,ie=C[8]*P,ue=C[9]*A,pe=C[10]*N,ge=j+$+pe,he=0;return ge>0?(he=2*Math.sqrt(ge+1),v[3]=.25*he,v[0]=(ne-ue)/he,v[1]=(ie-X)/he,v[2]=(V-K)/he):j>$&&j>pe?(he=2*Math.sqrt(1+j-$-pe),v[3]=(ne-ue)/he,v[0]=.25*he,v[1]=(V+K)/he,v[2]=(ie+X)/he):$>pe?(he=2*Math.sqrt(1+$-j-pe),v[3]=(ie-X)/he,v[0]=(V+K)/he,v[1]=.25*he,v[2]=(ne+ue)/he):(he=2*Math.sqrt(1+pe-j-$),v[3]=(V-K)/he,v[0]=(ie+X)/he,v[1]=(ne+ue)/he,v[2]=.25*he),v},Ne.fromRotationTranslationScale=function(v,C,I,P){var A=C[0],N=C[1],j=C[2],V=C[3],X=A+A,K=N+N,$=j+j,ne=A*X,ie=A*K,ue=A*$,pe=N*K,ge=N*$,he=j*$,Se=V*X,_e=V*K,Ce=V*$,Le=P[0],je=P[1],ze=P[2];return v[0]=(1-(pe+he))*Le,v[1]=(ie+Ce)*Le,v[2]=(ue-_e)*Le,v[3]=0,v[4]=(ie-Ce)*je,v[5]=(1-(ne+he))*je,v[6]=(ge+Se)*je,v[7]=0,v[8]=(ue+_e)*ze,v[9]=(ge-Se)*ze,v[10]=(1-(ne+pe))*ze,v[11]=0,v[12]=I[0],v[13]=I[1],v[14]=I[2],v[15]=1,v},Ne.fromRotationTranslationScaleOrigin=function(v,C,I,P,A){var N=C[0],j=C[1],V=C[2],X=C[3],K=N+N,$=j+j,ne=V+V,ie=N*K,ue=N*$,pe=N*ne,ge=j*$,he=j*ne,Se=V*ne,_e=X*K,Ce=X*$,Le=X*ne,je=P[0],ze=P[1],Fe=P[2],Ze=A[0],Ve=A[1],rt=A[2],ct=(1-(ge+Se))*je,Je=(ue+Le)*je,Dt=(pe-Ce)*je,Pt=(ue-Le)*ze,xt=(1-(ie+Se))*ze,ht=(he+_e)*ze,Ht=(pe+Ce)*Fe,At=(he-_e)*Fe,Lt=(1-(ie+ge))*Fe;return v[0]=ct,v[1]=Je,v[2]=Dt,v[3]=0,v[4]=Pt,v[5]=xt,v[6]=ht,v[7]=0,v[8]=Ht,v[9]=At,v[10]=Lt,v[11]=0,v[12]=I[0]+Ze-(ct*Ze+Pt*Ve+Ht*rt),v[13]=I[1]+Ve-(Je*Ze+xt*Ve+At*rt),v[14]=I[2]+rt-(Dt*Ze+ht*Ve+Lt*rt),v[15]=1,v},Ne.fromQuat=function(v,C){var I=C[0],P=C[1],A=C[2],N=C[3],j=I+I,V=P+P,X=A+A,K=I*j,$=P*j,ne=P*V,ie=A*j,ue=A*V,pe=A*X,ge=N*j,he=N*V,Se=N*X;return v[0]=1-ne-pe,v[1]=$+Se,v[2]=ie-he,v[3]=0,v[4]=$-Se,v[5]=1-K-pe,v[6]=ue+ge,v[7]=0,v[8]=ie+he,v[9]=ue-ge,v[10]=1-K-ne,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},Ne.frustum=function(v,C,I,P,A,N,j){var V=1/(I-C),X=1/(A-P),K=1/(N-j);return v[0]=2*N*V,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=2*N*X,v[6]=0,v[7]=0,v[8]=(I+C)*V,v[9]=(A+P)*X,v[10]=(j+N)*K,v[11]=-1,v[12]=0,v[13]=0,v[14]=j*N*2*K,v[15]=0,v},Ne.perspectiveNO=T,Ne.perspectiveZO=function(v,C,I,P,A){var N,j=1/Math.tan(C/2);return v[0]=j/I,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=j,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=-1,v[12]=0,v[13]=0,v[15]=0,A!=null&&A!==1/0?(v[10]=A*(N=1/(P-A)),v[14]=A*P*N):(v[10]=-1,v[14]=-P),v},Ne.perspectiveFromFieldOfView=function(v,C,I,P){var A=Math.tan(C.upDegrees*Math.PI/180),N=Math.tan(C.downDegrees*Math.PI/180),j=Math.tan(C.leftDegrees*Math.PI/180),V=Math.tan(C.rightDegrees*Math.PI/180),X=2/(j+V),K=2/(A+N);return v[0]=X,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=K,v[6]=0,v[7]=0,v[8]=-(j-V)*X*.5,v[9]=(A-N)*K*.5,v[10]=P/(I-P),v[11]=-1,v[12]=0,v[13]=0,v[14]=P*I/(I-P),v[15]=0,v},Ne.orthoNO=M,Ne.orthoZO=function(v,C,I,P,A,N,j){var V=1/(C-I),X=1/(P-A),K=1/(N-j);return v[0]=-2*V,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=-2*X,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=K,v[11]=0,v[12]=(C+I)*V,v[13]=(A+P)*X,v[14]=N*K,v[15]=1,v},Ne.lookAt=function(v,C,I,P){var A,N,j,V,X,K,$,ne,ie,ue,pe=C[0],ge=C[1],he=C[2],Se=P[0],_e=P[1],Ce=P[2],Le=I[0],je=I[1],ze=I[2];return Math.abs(pe-Le)<n.EPSILON&&Math.abs(ge-je)<n.EPSILON&&Math.abs(he-ze)<n.EPSILON?d(v):($=pe-Le,ne=ge-je,ie=he-ze,A=_e*(ie*=ue=1/Math.hypot($,ne,ie))-Ce*(ne*=ue),N=Ce*($*=ue)-Se*ie,j=Se*ne-_e*$,(ue=Math.hypot(A,N,j))?(A*=ue=1/ue,N*=ue,j*=ue):(A=0,N=0,j=0),V=ne*j-ie*N,X=ie*A-$*j,K=$*N-ne*A,(ue=Math.hypot(V,X,K))?(V*=ue=1/ue,X*=ue,K*=ue):(V=0,X=0,K=0),v[0]=A,v[1]=V,v[2]=$,v[3]=0,v[4]=N,v[5]=X,v[6]=ne,v[7]=0,v[8]=j,v[9]=K,v[10]=ie,v[11]=0,v[12]=-(A*pe+N*ge+j*he),v[13]=-(V*pe+X*ge+K*he),v[14]=-($*pe+ne*ge+ie*he),v[15]=1,v)},Ne.targetTo=function(v,C,I,P){var A=C[0],N=C[1],j=C[2],V=P[0],X=P[1],K=P[2],$=A-I[0],ne=N-I[1],ie=j-I[2],ue=$*$+ne*ne+ie*ie;ue>0&&($*=ue=1/Math.sqrt(ue),ne*=ue,ie*=ue);var pe=X*ie-K*ne,ge=K*$-V*ie,he=V*ne-X*$;return(ue=pe*pe+ge*ge+he*he)>0&&(pe*=ue=1/Math.sqrt(ue),ge*=ue,he*=ue),v[0]=pe,v[1]=ge,v[2]=he,v[3]=0,v[4]=ne*he-ie*ge,v[5]=ie*pe-$*he,v[6]=$*ge-ne*pe,v[7]=0,v[8]=$,v[9]=ne,v[10]=ie,v[11]=0,v[12]=A,v[13]=N,v[14]=j,v[15]=1,v},Ne.str=function(v){return"mat4("+v[0]+", "+v[1]+", "+v[2]+", "+v[3]+", "+v[4]+", "+v[5]+", "+v[6]+", "+v[7]+", "+v[8]+", "+v[9]+", "+v[10]+", "+v[11]+", "+v[12]+", "+v[13]+", "+v[14]+", "+v[15]+")"},Ne.frob=function(v){return Math.hypot(v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],v[8],v[9],v[10],v[11],v[12],v[13],v[14],v[15])},Ne.add=function(v,C,I){return v[0]=C[0]+I[0],v[1]=C[1]+I[1],v[2]=C[2]+I[2],v[3]=C[3]+I[3],v[4]=C[4]+I[4],v[5]=C[5]+I[5],v[6]=C[6]+I[6],v[7]=C[7]+I[7],v[8]=C[8]+I[8],v[9]=C[9]+I[9],v[10]=C[10]+I[10],v[11]=C[11]+I[11],v[12]=C[12]+I[12],v[13]=C[13]+I[13],v[14]=C[14]+I[14],v[15]=C[15]+I[15],v},Ne.subtract=D,Ne.multiplyScalar=function(v,C,I){return v[0]=C[0]*I,v[1]=C[1]*I,v[2]=C[2]*I,v[3]=C[3]*I,v[4]=C[4]*I,v[5]=C[5]*I,v[6]=C[6]*I,v[7]=C[7]*I,v[8]=C[8]*I,v[9]=C[9]*I,v[10]=C[10]*I,v[11]=C[11]*I,v[12]=C[12]*I,v[13]=C[13]*I,v[14]=C[14]*I,v[15]=C[15]*I,v},Ne.multiplyScalarAndAdd=function(v,C,I,P){return v[0]=C[0]+I[0]*P,v[1]=C[1]+I[1]*P,v[2]=C[2]+I[2]*P,v[3]=C[3]+I[3]*P,v[4]=C[4]+I[4]*P,v[5]=C[5]+I[5]*P,v[6]=C[6]+I[6]*P,v[7]=C[7]+I[7]*P,v[8]=C[8]+I[8]*P,v[9]=C[9]+I[9]*P,v[10]=C[10]+I[10]*P,v[11]=C[11]+I[11]*P,v[12]=C[12]+I[12]*P,v[13]=C[13]+I[13]*P,v[14]=C[14]+I[14]*P,v[15]=C[15]+I[15]*P,v},Ne.exactEquals=function(v,C){return v[0]===C[0]&&v[1]===C[1]&&v[2]===C[2]&&v[3]===C[3]&&v[4]===C[4]&&v[5]===C[5]&&v[6]===C[6]&&v[7]===C[7]&&v[8]===C[8]&&v[9]===C[9]&&v[10]===C[10]&&v[11]===C[11]&&v[12]===C[12]&&v[13]===C[13]&&v[14]===C[14]&&v[15]===C[15]},Ne.equals=function(v,C){var I=v[0],P=v[1],A=v[2],N=v[3],j=v[4],V=v[5],X=v[6],K=v[7],$=v[8],ne=v[9],ie=v[10],ue=v[11],pe=v[12],ge=v[13],he=v[14],Se=v[15],_e=C[0],Ce=C[1],Le=C[2],je=C[3],ze=C[4],Fe=C[5],Ze=C[6],Ve=C[7],rt=C[8],ct=C[9],Je=C[10],Dt=C[11],Pt=C[12],xt=C[13],ht=C[14],Ht=C[15];return Math.abs(I-_e)<=n.EPSILON*Math.max(1,Math.abs(I),Math.abs(_e))&&Math.abs(P-Ce)<=n.EPSILON*Math.max(1,Math.abs(P),Math.abs(Ce))&&Math.abs(A-Le)<=n.EPSILON*Math.max(1,Math.abs(A),Math.abs(Le))&&Math.abs(N-je)<=n.EPSILON*Math.max(1,Math.abs(N),Math.abs(je))&&Math.abs(j-ze)<=n.EPSILON*Math.max(1,Math.abs(j),Math.abs(ze))&&Math.abs(V-Fe)<=n.EPSILON*Math.max(1,Math.abs(V),Math.abs(Fe))&&Math.abs(X-Ze)<=n.EPSILON*Math.max(1,Math.abs(X),Math.abs(Ze))&&Math.abs(K-Ve)<=n.EPSILON*Math.max(1,Math.abs(K),Math.abs(Ve))&&Math.abs($-rt)<=n.EPSILON*Math.max(1,Math.abs($),Math.abs(rt))&&Math.abs(ne-ct)<=n.EPSILON*Math.max(1,Math.abs(ne),Math.abs(ct))&&Math.abs(ie-Je)<=n.EPSILON*Math.max(1,Math.abs(ie),Math.abs(Je))&&Math.abs(ue-Dt)<=n.EPSILON*Math.max(1,Math.abs(ue),Math.abs(Dt))&&Math.abs(pe-Pt)<=n.EPSILON*Math.max(1,Math.abs(pe),Math.abs(Pt))&&Math.abs(ge-xt)<=n.EPSILON*Math.max(1,Math.abs(ge),Math.abs(xt))&&Math.abs(he-ht)<=n.EPSILON*Math.max(1,Math.abs(he),Math.abs(ht))&&Math.abs(Se-Ht)<=n.EPSILON*Math.max(1,Math.abs(Se),Math.abs(Ht))},Ne.sub=Ne.mul=Ne.ortho=Ne.perspective=void 0;var n=function(v,C){if(v&&v.__esModule)return v;if(v===null||c(v)!=="object"&&typeof v!="function")return{default:v};var I=a(void 0);if(I&&I.has(v))return I.get(v);var P={},A=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var N in v)if(N!=="default"&&Object.prototype.hasOwnProperty.call(v,N)){var j=A?Object.getOwnPropertyDescriptor(v,N):null;j&&(j.get||j.set)?Object.defineProperty(P,N,j):P[N]=v[N]}return P.default=v,I&&I.set(v,P),P}(H());function a(v){if(typeof WeakMap!="function")return null;var C=new WeakMap,I=new WeakMap;return(a=function(P){return P?I:C})(v)}function d(v){return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=1,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v}function g(v,C,I){var P=C[0],A=C[1],N=C[2],j=C[3],V=C[4],X=C[5],K=C[6],$=C[7],ne=C[8],ie=C[9],ue=C[10],pe=C[11],ge=C[12],he=C[13],Se=C[14],_e=C[15],Ce=I[0],Le=I[1],je=I[2],ze=I[3];return v[0]=Ce*P+Le*V+je*ne+ze*ge,v[1]=Ce*A+Le*X+je*ie+ze*he,v[2]=Ce*N+Le*K+je*ue+ze*Se,v[3]=Ce*j+Le*$+je*pe+ze*_e,v[4]=(Ce=I[4])*P+(Le=I[5])*V+(je=I[6])*ne+(ze=I[7])*ge,v[5]=Ce*A+Le*X+je*ie+ze*he,v[6]=Ce*N+Le*K+je*ue+ze*Se,v[7]=Ce*j+Le*$+je*pe+ze*_e,v[8]=(Ce=I[8])*P+(Le=I[9])*V+(je=I[10])*ne+(ze=I[11])*ge,v[9]=Ce*A+Le*X+je*ie+ze*he,v[10]=Ce*N+Le*K+je*ue+ze*Se,v[11]=Ce*j+Le*$+je*pe+ze*_e,v[12]=(Ce=I[12])*P+(Le=I[13])*V+(je=I[14])*ne+(ze=I[15])*ge,v[13]=Ce*A+Le*X+je*ie+ze*he,v[14]=Ce*N+Le*K+je*ue+ze*Se,v[15]=Ce*j+Le*$+je*pe+ze*_e,v}function h(v,C,I){var P=C[0],A=C[1],N=C[2],j=C[3],V=P+P,X=A+A,K=N+N,$=P*V,ne=P*X,ie=P*K,ue=A*X,pe=A*K,ge=N*K,he=j*V,Se=j*X,_e=j*K;return v[0]=1-(ue+ge),v[1]=ne+_e,v[2]=ie-Se,v[3]=0,v[4]=ne-_e,v[5]=1-($+ge),v[6]=pe+he,v[7]=0,v[8]=ie+Se,v[9]=pe-he,v[10]=1-($+ue),v[11]=0,v[12]=I[0],v[13]=I[1],v[14]=I[2],v[15]=1,v}function y(v,C){var I=C[4],P=C[5],A=C[6],N=C[8],j=C[9],V=C[10];return v[0]=Math.hypot(C[0],C[1],C[2]),v[1]=Math.hypot(I,P,A),v[2]=Math.hypot(N,j,V),v}function T(v,C,I,P,A){var N,j=1/Math.tan(C/2);return v[0]=j/I,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=j,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=-1,v[12]=0,v[13]=0,v[15]=0,A!=null&&A!==1/0?(v[10]=(A+P)*(N=1/(P-A)),v[14]=2*A*P*N):(v[10]=-1,v[14]=-2*P),v}function M(v,C,I,P,A,N,j){var V=1/(C-I),X=1/(P-A),K=1/(N-j);return v[0]=-2*V,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=-2*X,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=2*K,v[11]=0,v[12]=(C+I)*V,v[13]=(A+P)*X,v[14]=(j+N)*K,v[15]=1,v}function D(v,C,I){return v[0]=C[0]-I[0],v[1]=C[1]-I[1],v[2]=C[2]-I[2],v[3]=C[3]-I[3],v[4]=C[4]-I[4],v[5]=C[5]-I[5],v[6]=C[6]-I[6],v[7]=C[7]-I[7],v[8]=C[8]-I[8],v[9]=C[9]-I[9],v[10]=C[10]-I[10],v[11]=C[11]-I[11],v[12]=C[12]-I[12],v[13]=C[13]-I[13],v[14]=C[14]-I[14],v[15]=C[15]-I[15],v}return Ne.perspective=T,Ne.ortho=M,Ne.mul=g,Ne.sub=D,Ne}var ut,mt={},pt={};function en(){if(ut)return pt;function c(A){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(N){return typeof N}:function(N){return N&&typeof Symbol=="function"&&N.constructor===Symbol&&N!==Symbol.prototype?"symbol":typeof N},c(A)}ut=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.create=d,pt.clone=function(A){var N=new n.ARRAY_TYPE(3);return N[0]=A[0],N[1]=A[1],N[2]=A[2],N},pt.length=g,pt.fromValues=function(A,N,j){var V=new n.ARRAY_TYPE(3);return V[0]=A,V[1]=N,V[2]=j,V},pt.copy=function(A,N){return A[0]=N[0],A[1]=N[1],A[2]=N[2],A},pt.set=function(A,N,j,V){return A[0]=N,A[1]=j,A[2]=V,A},pt.add=function(A,N,j){return A[0]=N[0]+j[0],A[1]=N[1]+j[1],A[2]=N[2]+j[2],A},pt.subtract=h,pt.multiply=y,pt.divide=T,pt.ceil=function(A,N){return A[0]=Math.ceil(N[0]),A[1]=Math.ceil(N[1]),A[2]=Math.ceil(N[2]),A},pt.floor=function(A,N){return A[0]=Math.floor(N[0]),A[1]=Math.floor(N[1]),A[2]=Math.floor(N[2]),A},pt.min=function(A,N,j){return A[0]=Math.min(N[0],j[0]),A[1]=Math.min(N[1],j[1]),A[2]=Math.min(N[2],j[2]),A},pt.max=function(A,N,j){return A[0]=Math.max(N[0],j[0]),A[1]=Math.max(N[1],j[1]),A[2]=Math.max(N[2],j[2]),A},pt.round=function(A,N){return A[0]=Math.round(N[0]),A[1]=Math.round(N[1]),A[2]=Math.round(N[2]),A},pt.scale=function(A,N,j){return A[0]=N[0]*j,A[1]=N[1]*j,A[2]=N[2]*j,A},pt.scaleAndAdd=function(A,N,j,V){return A[0]=N[0]+j[0]*V,A[1]=N[1]+j[1]*V,A[2]=N[2]+j[2]*V,A},pt.distance=M,pt.squaredDistance=D,pt.squaredLength=v,pt.negate=function(A,N){return A[0]=-N[0],A[1]=-N[1],A[2]=-N[2],A},pt.inverse=function(A,N){return A[0]=1/N[0],A[1]=1/N[1],A[2]=1/N[2],A},pt.normalize=function(A,N){var j=N[0],V=N[1],X=N[2],K=j*j+V*V+X*X;return K>0&&(K=1/Math.sqrt(K)),A[0]=N[0]*K,A[1]=N[1]*K,A[2]=N[2]*K,A},pt.dot=C,pt.cross=function(A,N,j){var V=N[0],X=N[1],K=N[2],$=j[0],ne=j[1],ie=j[2];return A[0]=X*ie-K*ne,A[1]=K*$-V*ie,A[2]=V*ne-X*$,A},pt.lerp=function(A,N,j,V){var X=N[0],K=N[1],$=N[2];return A[0]=X+V*(j[0]-X),A[1]=K+V*(j[1]-K),A[2]=$+V*(j[2]-$),A},pt.hermite=function(A,N,j,V,X,K){var $=K*K,ne=$*(2*K-3)+1,ie=$*(K-2)+K,ue=$*(K-1),pe=$*(3-2*K);return A[0]=N[0]*ne+j[0]*ie+V[0]*ue+X[0]*pe,A[1]=N[1]*ne+j[1]*ie+V[1]*ue+X[1]*pe,A[2]=N[2]*ne+j[2]*ie+V[2]*ue+X[2]*pe,A},pt.bezier=function(A,N,j,V,X,K){var $=1-K,ne=$*$,ie=K*K,ue=ne*$,pe=3*K*ne,ge=3*ie*$,he=ie*K;return A[0]=N[0]*ue+j[0]*pe+V[0]*ge+X[0]*he,A[1]=N[1]*ue+j[1]*pe+V[1]*ge+X[1]*he,A[2]=N[2]*ue+j[2]*pe+V[2]*ge+X[2]*he,A},pt.random=function(A,N){N=N||1;var j=2*n.RANDOM()*Math.PI,V=2*n.RANDOM()-1,X=Math.sqrt(1-V*V)*N;return A[0]=Math.cos(j)*X,A[1]=Math.sin(j)*X,A[2]=V*N,A},pt.transformMat4=function(A,N,j){var V=N[0],X=N[1],K=N[2],$=j[3]*V+j[7]*X+j[11]*K+j[15];return A[0]=(j[0]*V+j[4]*X+j[8]*K+j[12])/($=$||1),A[1]=(j[1]*V+j[5]*X+j[9]*K+j[13])/$,A[2]=(j[2]*V+j[6]*X+j[10]*K+j[14])/$,A},pt.transformMat3=function(A,N,j){var V=N[0],X=N[1],K=N[2];return A[0]=V*j[0]+X*j[3]+K*j[6],A[1]=V*j[1]+X*j[4]+K*j[7],A[2]=V*j[2]+X*j[5]+K*j[8],A},pt.transformQuat=function(A,N,j){var V=j[0],X=j[1],K=j[2],$=N[0],ne=N[1],ie=N[2],ue=X*ie-K*ne,pe=K*$-V*ie,ge=V*ne-X*$,he=X*ge-K*pe,Se=K*ue-V*ge,_e=V*pe-X*ue,Ce=2*j[3];return pe*=Ce,ge*=Ce,Se*=2,_e*=2,A[0]=$+(ue*=Ce)+(he*=2),A[1]=ne+pe+Se,A[2]=ie+ge+_e,A},pt.rotateX=function(A,N,j,V){var X=[],K=[];return X[0]=N[0]-j[0],X[1]=N[1]-j[1],X[2]=N[2]-j[2],K[0]=X[0],K[1]=X[1]*Math.cos(V)-X[2]*Math.sin(V),K[2]=X[1]*Math.sin(V)+X[2]*Math.cos(V),A[0]=K[0]+j[0],A[1]=K[1]+j[1],A[2]=K[2]+j[2],A},pt.rotateY=function(A,N,j,V){var X=[],K=[];return X[0]=N[0]-j[0],X[1]=N[1]-j[1],X[2]=N[2]-j[2],K[0]=X[2]*Math.sin(V)+X[0]*Math.cos(V),K[1]=X[1],K[2]=X[2]*Math.cos(V)-X[0]*Math.sin(V),A[0]=K[0]+j[0],A[1]=K[1]+j[1],A[2]=K[2]+j[2],A},pt.rotateZ=function(A,N,j,V){var X=[],K=[];return X[0]=N[0]-j[0],X[1]=N[1]-j[1],X[2]=N[2]-j[2],K[0]=X[0]*Math.cos(V)-X[1]*Math.sin(V),K[1]=X[0]*Math.sin(V)+X[1]*Math.cos(V),K[2]=X[2],A[0]=K[0]+j[0],A[1]=K[1]+j[1],A[2]=K[2]+j[2],A},pt.angle=function(A,N){var j=A[0],V=A[1],X=A[2],K=N[0],$=N[1],ne=N[2],ie=Math.sqrt(j*j+V*V+X*X)*Math.sqrt(K*K+$*$+ne*ne),ue=ie&&C(A,N)/ie;return Math.acos(Math.min(Math.max(ue,-1),1))},pt.zero=function(A){return A[0]=0,A[1]=0,A[2]=0,A},pt.str=function(A){return"vec3("+A[0]+", "+A[1]+", "+A[2]+")"},pt.exactEquals=function(A,N){return A[0]===N[0]&&A[1]===N[1]&&A[2]===N[2]},pt.equals=function(A,N){var j=A[0],V=A[1],X=A[2],K=N[0],$=N[1],ne=N[2];return Math.abs(j-K)<=n.EPSILON*Math.max(1,Math.abs(j),Math.abs(K))&&Math.abs(V-$)<=n.EPSILON*Math.max(1,Math.abs(V),Math.abs($))&&Math.abs(X-ne)<=n.EPSILON*Math.max(1,Math.abs(X),Math.abs(ne))},pt.forEach=pt.sqrLen=pt.len=pt.sqrDist=pt.dist=pt.div=pt.mul=pt.sub=void 0;var n=function(A,N){if(A&&A.__esModule)return A;if(A===null||c(A)!=="object"&&typeof A!="function")return{default:A};var j=a(void 0);if(j&&j.has(A))return j.get(A);var V={},X=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var K in A)if(K!=="default"&&Object.prototype.hasOwnProperty.call(A,K)){var $=X?Object.getOwnPropertyDescriptor(A,K):null;$&&($.get||$.set)?Object.defineProperty(V,K,$):V[K]=A[K]}return V.default=A,j&&j.set(A,V),V}(H());function a(A){if(typeof WeakMap!="function")return null;var N=new WeakMap,j=new WeakMap;return(a=function(V){return V?j:N})(A)}function d(){var A=new n.ARRAY_TYPE(3);return n.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0),A}function g(A){return Math.hypot(A[0],A[1],A[2])}function h(A,N,j){return A[0]=N[0]-j[0],A[1]=N[1]-j[1],A[2]=N[2]-j[2],A}function y(A,N,j){return A[0]=N[0]*j[0],A[1]=N[1]*j[1],A[2]=N[2]*j[2],A}function T(A,N,j){return A[0]=N[0]/j[0],A[1]=N[1]/j[1],A[2]=N[2]/j[2],A}function M(A,N){return Math.hypot(N[0]-A[0],N[1]-A[1],N[2]-A[2])}function D(A,N){var j=N[0]-A[0],V=N[1]-A[1],X=N[2]-A[2];return j*j+V*V+X*X}function v(A){var N=A[0],j=A[1],V=A[2];return N*N+j*j+V*V}function C(A,N){return A[0]*N[0]+A[1]*N[1]+A[2]*N[2]}pt.sub=h,pt.mul=y,pt.div=T,pt.dist=M,pt.sqrDist=D,pt.len=g,pt.sqrLen=v;var I,P=(I=d(),function(A,N,j,V,X,K){var $,ne;for(N||(N=3),j||(j=0),ne=V?Math.min(V*N+j,A.length):A.length,$=j;$<ne;$+=N)I[0]=A[$],I[1]=A[$+1],I[2]=A[$+2],X(I,I,K),A[$]=I[0],A[$+1]=I[1],A[$+2]=I[2];return A});return pt.forEach=P,pt}var Yt,dn,It={};function Et(){if(Yt)return It;function c(P){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},c(P)}Yt=1,Object.defineProperty(It,"__esModule",{value:!0}),It.create=d,It.clone=function(P){var A=new n.ARRAY_TYPE(4);return A[0]=P[0],A[1]=P[1],A[2]=P[2],A[3]=P[3],A},It.fromValues=function(P,A,N,j){var V=new n.ARRAY_TYPE(4);return V[0]=P,V[1]=A,V[2]=N,V[3]=j,V},It.copy=function(P,A){return P[0]=A[0],P[1]=A[1],P[2]=A[2],P[3]=A[3],P},It.set=function(P,A,N,j,V){return P[0]=A,P[1]=N,P[2]=j,P[3]=V,P},It.add=function(P,A,N){return P[0]=A[0]+N[0],P[1]=A[1]+N[1],P[2]=A[2]+N[2],P[3]=A[3]+N[3],P},It.subtract=g,It.multiply=h,It.divide=y,It.ceil=function(P,A){return P[0]=Math.ceil(A[0]),P[1]=Math.ceil(A[1]),P[2]=Math.ceil(A[2]),P[3]=Math.ceil(A[3]),P},It.floor=function(P,A){return P[0]=Math.floor(A[0]),P[1]=Math.floor(A[1]),P[2]=Math.floor(A[2]),P[3]=Math.floor(A[3]),P},It.min=function(P,A,N){return P[0]=Math.min(A[0],N[0]),P[1]=Math.min(A[1],N[1]),P[2]=Math.min(A[2],N[2]),P[3]=Math.min(A[3],N[3]),P},It.max=function(P,A,N){return P[0]=Math.max(A[0],N[0]),P[1]=Math.max(A[1],N[1]),P[2]=Math.max(A[2],N[2]),P[3]=Math.max(A[3],N[3]),P},It.round=function(P,A){return P[0]=Math.round(A[0]),P[1]=Math.round(A[1]),P[2]=Math.round(A[2]),P[3]=Math.round(A[3]),P},It.scale=function(P,A,N){return P[0]=A[0]*N,P[1]=A[1]*N,P[2]=A[2]*N,P[3]=A[3]*N,P},It.scaleAndAdd=function(P,A,N,j){return P[0]=A[0]+N[0]*j,P[1]=A[1]+N[1]*j,P[2]=A[2]+N[2]*j,P[3]=A[3]+N[3]*j,P},It.distance=T,It.squaredDistance=M,It.length=D,It.squaredLength=v,It.negate=function(P,A){return P[0]=-A[0],P[1]=-A[1],P[2]=-A[2],P[3]=-A[3],P},It.inverse=function(P,A){return P[0]=1/A[0],P[1]=1/A[1],P[2]=1/A[2],P[3]=1/A[3],P},It.normalize=function(P,A){var N=A[0],j=A[1],V=A[2],X=A[3],K=N*N+j*j+V*V+X*X;return K>0&&(K=1/Math.sqrt(K)),P[0]=N*K,P[1]=j*K,P[2]=V*K,P[3]=X*K,P},It.dot=function(P,A){return P[0]*A[0]+P[1]*A[1]+P[2]*A[2]+P[3]*A[3]},It.cross=function(P,A,N,j){var V=N[0]*j[1]-N[1]*j[0],X=N[0]*j[2]-N[2]*j[0],K=N[0]*j[3]-N[3]*j[0],$=N[1]*j[2]-N[2]*j[1],ne=N[1]*j[3]-N[3]*j[1],ie=N[2]*j[3]-N[3]*j[2],ue=A[0],pe=A[1],ge=A[2],he=A[3];return P[0]=pe*ie-ge*ne+he*$,P[1]=-ue*ie+ge*K-he*X,P[2]=ue*ne-pe*K+he*V,P[3]=-ue*$+pe*X-ge*V,P},It.lerp=function(P,A,N,j){var V=A[0],X=A[1],K=A[2],$=A[3];return P[0]=V+j*(N[0]-V),P[1]=X+j*(N[1]-X),P[2]=K+j*(N[2]-K),P[3]=$+j*(N[3]-$),P},It.random=function(P,A){var N,j,V,X,K,$;A=A||1;do K=(N=2*n.RANDOM()-1)*N+(j=2*n.RANDOM()-1)*j;while(K>=1);do $=(V=2*n.RANDOM()-1)*V+(X=2*n.RANDOM()-1)*X;while($>=1);var ne=Math.sqrt((1-K)/$);return P[0]=A*N,P[1]=A*j,P[2]=A*V*ne,P[3]=A*X*ne,P},It.transformMat4=function(P,A,N){var j=A[0],V=A[1],X=A[2],K=A[3];return P[0]=N[0]*j+N[4]*V+N[8]*X+N[12]*K,P[1]=N[1]*j+N[5]*V+N[9]*X+N[13]*K,P[2]=N[2]*j+N[6]*V+N[10]*X+N[14]*K,P[3]=N[3]*j+N[7]*V+N[11]*X+N[15]*K,P},It.transformQuat=function(P,A,N){var j=A[0],V=A[1],X=A[2],K=N[0],$=N[1],ne=N[2],ie=N[3],ue=ie*j+$*X-ne*V,pe=ie*V+ne*j-K*X,ge=ie*X+K*V-$*j,he=-K*j-$*V-ne*X;return P[0]=ue*ie+he*-K+pe*-ne-ge*-$,P[1]=pe*ie+he*-$+ge*-K-ue*-ne,P[2]=ge*ie+he*-ne+ue*-$-pe*-K,P[3]=A[3],P},It.zero=function(P){return P[0]=0,P[1]=0,P[2]=0,P[3]=0,P},It.str=function(P){return"vec4("+P[0]+", "+P[1]+", "+P[2]+", "+P[3]+")"},It.exactEquals=function(P,A){return P[0]===A[0]&&P[1]===A[1]&&P[2]===A[2]&&P[3]===A[3]},It.equals=function(P,A){var N=P[0],j=P[1],V=P[2],X=P[3],K=A[0],$=A[1],ne=A[2],ie=A[3];return Math.abs(N-K)<=n.EPSILON*Math.max(1,Math.abs(N),Math.abs(K))&&Math.abs(j-$)<=n.EPSILON*Math.max(1,Math.abs(j),Math.abs($))&&Math.abs(V-ne)<=n.EPSILON*Math.max(1,Math.abs(V),Math.abs(ne))&&Math.abs(X-ie)<=n.EPSILON*Math.max(1,Math.abs(X),Math.abs(ie))},It.forEach=It.sqrLen=It.len=It.sqrDist=It.dist=It.div=It.mul=It.sub=void 0;var n=function(P,A){if(P&&P.__esModule)return P;if(P===null||c(P)!=="object"&&typeof P!="function")return{default:P};var N=a(void 0);if(N&&N.has(P))return N.get(P);var j={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var X in P)if(X!=="default"&&Object.prototype.hasOwnProperty.call(P,X)){var K=V?Object.getOwnPropertyDescriptor(P,X):null;K&&(K.get||K.set)?Object.defineProperty(j,X,K):j[X]=P[X]}return j.default=P,N&&N.set(P,j),j}(H());function a(P){if(typeof WeakMap!="function")return null;var A=new WeakMap,N=new WeakMap;return(a=function(j){return j?N:A})(P)}function d(){var P=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(P[0]=0,P[1]=0,P[2]=0,P[3]=0),P}function g(P,A,N){return P[0]=A[0]-N[0],P[1]=A[1]-N[1],P[2]=A[2]-N[2],P[3]=A[3]-N[3],P}function h(P,A,N){return P[0]=A[0]*N[0],P[1]=A[1]*N[1],P[2]=A[2]*N[2],P[3]=A[3]*N[3],P}function y(P,A,N){return P[0]=A[0]/N[0],P[1]=A[1]/N[1],P[2]=A[2]/N[2],P[3]=A[3]/N[3],P}function T(P,A){return Math.hypot(A[0]-P[0],A[1]-P[1],A[2]-P[2],A[3]-P[3])}function M(P,A){var N=A[0]-P[0],j=A[1]-P[1],V=A[2]-P[2],X=A[3]-P[3];return N*N+j*j+V*V+X*X}function D(P){return Math.hypot(P[0],P[1],P[2],P[3])}function v(P){var A=P[0],N=P[1],j=P[2],V=P[3];return A*A+N*N+j*j+V*V}It.sub=g,It.mul=h,It.div=y,It.dist=T,It.sqrDist=M,It.len=D,It.sqrLen=v;var C,I=(C=d(),function(P,A,N,j,V,X){var K,$;for(A||(A=4),N||(N=0),$=j?Math.min(j*A+N,P.length):P.length,K=N;K<$;K+=A)C[0]=P[K],C[1]=P[K+1],C[2]=P[K+2],C[3]=P[K+3],V(C,C,X),P[K]=C[0],P[K+1]=C[1],P[K+2]=C[2],P[K+3]=C[3];return P});return It.forEach=I,It}function tt(){if(dn)return mt;function c(_e){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Ce){return typeof Ce}:function(Ce){return Ce&&typeof Symbol=="function"&&Ce.constructor===Symbol&&Ce!==Symbol.prototype?"symbol":typeof Ce},c(_e)}dn=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.create=T,mt.identity=function(_e){return _e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e},mt.setAxisAngle=M,mt.getAxisAngle=function(_e,Ce){var Le=2*Math.acos(Ce[3]),je=Math.sin(Le/2);return je>n.EPSILON?(_e[0]=Ce[0]/je,_e[1]=Ce[1]/je,_e[2]=Ce[2]/je):(_e[0]=1,_e[1]=0,_e[2]=0),Le},mt.getAngle=function(_e,Ce){var Le=N(_e,Ce);return Math.acos(2*Le*Le-1)},mt.multiply=D,mt.rotateX=function(_e,Ce,Le){Le*=.5;var je=Ce[0],ze=Ce[1],Fe=Ce[2],Ze=Ce[3],Ve=Math.sin(Le),rt=Math.cos(Le);return _e[0]=je*rt+Ze*Ve,_e[1]=ze*rt+Fe*Ve,_e[2]=Fe*rt-ze*Ve,_e[3]=Ze*rt-je*Ve,_e},mt.rotateY=function(_e,Ce,Le){Le*=.5;var je=Ce[0],ze=Ce[1],Fe=Ce[2],Ze=Ce[3],Ve=Math.sin(Le),rt=Math.cos(Le);return _e[0]=je*rt-Fe*Ve,_e[1]=ze*rt+Ze*Ve,_e[2]=Fe*rt+je*Ve,_e[3]=Ze*rt-ze*Ve,_e},mt.rotateZ=function(_e,Ce,Le){Le*=.5;var je=Ce[0],ze=Ce[1],Fe=Ce[2],Ze=Ce[3],Ve=Math.sin(Le),rt=Math.cos(Le);return _e[0]=je*rt+ze*Ve,_e[1]=ze*rt-je*Ve,_e[2]=Fe*rt+Ze*Ve,_e[3]=Ze*rt-Fe*Ve,_e},mt.calculateW=function(_e,Ce){var Le=Ce[0],je=Ce[1],ze=Ce[2];return _e[0]=Le,_e[1]=je,_e[2]=ze,_e[3]=Math.sqrt(Math.abs(1-Le*Le-je*je-ze*ze)),_e},mt.exp=v,mt.ln=C,mt.pow=function(_e,Ce,Le){return C(_e,Ce),A(_e,_e,Le),v(_e,_e),_e},mt.slerp=I,mt.random=function(_e){var Ce=n.RANDOM(),Le=n.RANDOM(),je=n.RANDOM(),ze=Math.sqrt(1-Ce),Fe=Math.sqrt(Ce);return _e[0]=ze*Math.sin(2*Math.PI*Le),_e[1]=ze*Math.cos(2*Math.PI*Le),_e[2]=Fe*Math.sin(2*Math.PI*je),_e[3]=Fe*Math.cos(2*Math.PI*je),_e},mt.invert=function(_e,Ce){var Le=Ce[0],je=Ce[1],ze=Ce[2],Fe=Ce[3],Ze=Le*Le+je*je+ze*ze+Fe*Fe,Ve=Ze?1/Ze:0;return _e[0]=-Le*Ve,_e[1]=-je*Ve,_e[2]=-ze*Ve,_e[3]=Fe*Ve,_e},mt.conjugate=function(_e,Ce){return _e[0]=-Ce[0],_e[1]=-Ce[1],_e[2]=-Ce[2],_e[3]=Ce[3],_e},mt.fromMat3=P,mt.fromEuler=function(_e,Ce,Le,je){var ze=.5*Math.PI/180;Ce*=ze,Le*=ze,je*=ze;var Fe=Math.sin(Ce),Ze=Math.cos(Ce),Ve=Math.sin(Le),rt=Math.cos(Le),ct=Math.sin(je),Je=Math.cos(je);return _e[0]=Fe*rt*Je-Ze*Ve*ct,_e[1]=Ze*Ve*Je+Fe*rt*ct,_e[2]=Ze*rt*ct-Fe*Ve*Je,_e[3]=Ze*rt*Je+Fe*Ve*ct,_e},mt.str=function(_e){return"quat("+_e[0]+", "+_e[1]+", "+_e[2]+", "+_e[3]+")"},mt.setAxes=mt.sqlerp=mt.rotationTo=mt.equals=mt.exactEquals=mt.normalize=mt.sqrLen=mt.squaredLength=mt.len=mt.length=mt.lerp=mt.dot=mt.scale=mt.mul=mt.add=mt.set=mt.copy=mt.fromValues=mt.clone=void 0;var n=y(H()),a=y(He()),d=y(en()),g=y(Et());function h(_e){if(typeof WeakMap!="function")return null;var Ce=new WeakMap,Le=new WeakMap;return(h=function(je){return je?Le:Ce})(_e)}function y(_e,Ce){if(_e&&_e.__esModule)return _e;if(_e===null||c(_e)!=="object"&&typeof _e!="function")return{default:_e};var Le=h(Ce);if(Le&&Le.has(_e))return Le.get(_e);var je={},ze=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Fe in _e)if(Fe!=="default"&&Object.prototype.hasOwnProperty.call(_e,Fe)){var Ze=ze?Object.getOwnPropertyDescriptor(_e,Fe):null;Ze&&(Ze.get||Ze.set)?Object.defineProperty(je,Fe,Ze):je[Fe]=_e[Fe]}return je.default=_e,Le&&Le.set(_e,je),je}function T(){var _e=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(_e[0]=0,_e[1]=0,_e[2]=0),_e[3]=1,_e}function M(_e,Ce,Le){Le*=.5;var je=Math.sin(Le);return _e[0]=je*Ce[0],_e[1]=je*Ce[1],_e[2]=je*Ce[2],_e[3]=Math.cos(Le),_e}function D(_e,Ce,Le){var je=Ce[0],ze=Ce[1],Fe=Ce[2],Ze=Ce[3],Ve=Le[0],rt=Le[1],ct=Le[2],Je=Le[3];return _e[0]=je*Je+Ze*Ve+ze*ct-Fe*rt,_e[1]=ze*Je+Ze*rt+Fe*Ve-je*ct,_e[2]=Fe*Je+Ze*ct+je*rt-ze*Ve,_e[3]=Ze*Je-je*Ve-ze*rt-Fe*ct,_e}function v(_e,Ce){var Le=Ce[0],je=Ce[1],ze=Ce[2],Fe=Ce[3],Ze=Math.sqrt(Le*Le+je*je+ze*ze),Ve=Math.exp(Fe),rt=Ze>0?Ve*Math.sin(Ze)/Ze:0;return _e[0]=Le*rt,_e[1]=je*rt,_e[2]=ze*rt,_e[3]=Ve*Math.cos(Ze),_e}function C(_e,Ce){var Le=Ce[0],je=Ce[1],ze=Ce[2],Fe=Ce[3],Ze=Math.sqrt(Le*Le+je*je+ze*ze),Ve=Ze>0?Math.atan2(Ze,Fe)/Ze:0;return _e[0]=Le*Ve,_e[1]=je*Ve,_e[2]=ze*Ve,_e[3]=.5*Math.log(Le*Le+je*je+ze*ze+Fe*Fe),_e}function I(_e,Ce,Le,je){var ze,Fe,Ze,Ve,rt,ct=Ce[0],Je=Ce[1],Dt=Ce[2],Pt=Ce[3],xt=Le[0],ht=Le[1],Ht=Le[2],At=Le[3];return(Fe=ct*xt+Je*ht+Dt*Ht+Pt*At)<0&&(Fe=-Fe,xt=-xt,ht=-ht,Ht=-Ht,At=-At),1-Fe>n.EPSILON?(ze=Math.acos(Fe),Ze=Math.sin(ze),Ve=Math.sin((1-je)*ze)/Ze,rt=Math.sin(je*ze)/Ze):(Ve=1-je,rt=je),_e[0]=Ve*ct+rt*xt,_e[1]=Ve*Je+rt*ht,_e[2]=Ve*Dt+rt*Ht,_e[3]=Ve*Pt+rt*At,_e}function P(_e,Ce){var Le,je=Ce[0]+Ce[4]+Ce[8];if(je>0)Le=Math.sqrt(je+1),_e[3]=.5*Le,_e[0]=(Ce[5]-Ce[7])*(Le=.5/Le),_e[1]=(Ce[6]-Ce[2])*Le,_e[2]=(Ce[1]-Ce[3])*Le;else{var ze=0;Ce[4]>Ce[0]&&(ze=1),Ce[8]>Ce[3*ze+ze]&&(ze=2);var Fe=(ze+1)%3,Ze=(ze+2)%3;Le=Math.sqrt(Ce[3*ze+ze]-Ce[3*Fe+Fe]-Ce[3*Ze+Ze]+1),_e[ze]=.5*Le,_e[3]=(Ce[3*Fe+Ze]-Ce[3*Ze+Fe])*(Le=.5/Le),_e[Fe]=(Ce[3*Fe+ze]+Ce[3*ze+Fe])*Le,_e[Ze]=(Ce[3*Ze+ze]+Ce[3*ze+Ze])*Le}return _e}mt.clone=g.clone,mt.fromValues=g.fromValues,mt.copy=g.copy,mt.set=g.set,mt.add=g.add,mt.mul=D;var A=g.scale;mt.scale=A;var N=g.dot;mt.dot=N,mt.lerp=g.lerp;var j=g.length;mt.length=j,mt.len=j;var V=g.squaredLength;mt.squaredLength=V,mt.sqrLen=V;var X=g.normalize;mt.normalize=X,mt.exactEquals=g.exactEquals,mt.equals=g.equals;var K,$,ne,ie=(K=d.create(),$=d.fromValues(1,0,0),ne=d.fromValues(0,1,0),function(_e,Ce,Le){var je=d.dot(Ce,Le);return je<-.999999?(d.cross(K,$,Ce),d.len(K)<1e-6&&d.cross(K,ne,Ce),d.normalize(K,K),M(_e,K,Math.PI),_e):je>.999999?(_e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e):(d.cross(K,Ce,Le),_e[0]=K[0],_e[1]=K[1],_e[2]=K[2],_e[3]=1+je,X(_e,_e))});mt.rotationTo=ie;var ue,pe,ge=(ue=T(),pe=T(),function(_e,Ce,Le,je,ze,Fe){return I(ue,Ce,ze,Fe),I(pe,Le,je,Fe),I(_e,ue,pe,2*Fe*(1-Fe)),_e});mt.sqlerp=ge;var he,Se=(he=a.create(),function(_e,Ce,Le,je){return he[0]=Le[0],he[3]=Le[1],he[6]=Le[2],he[1]=je[0],he[4]=je[1],he[7]=je[2],he[2]=-Ce[0],he[5]=-Ce[1],he[8]=-Ce[2],X(_e,P(_e,he))});return mt.setAxes=Se,mt}var Ft,St={};function hn(){if(Ft)return St;function c(I){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},c(I)}Ft=1,Object.defineProperty(St,"__esModule",{value:!0}),St.create=function(){var I=new n.ARRAY_TYPE(8);return n.ARRAY_TYPE!=Float32Array&&(I[0]=0,I[1]=0,I[2]=0,I[4]=0,I[5]=0,I[6]=0,I[7]=0),I[3]=1,I},St.clone=function(I){var P=new n.ARRAY_TYPE(8);return P[0]=I[0],P[1]=I[1],P[2]=I[2],P[3]=I[3],P[4]=I[4],P[5]=I[5],P[6]=I[6],P[7]=I[7],P},St.fromValues=function(I,P,A,N,j,V,X,K){var $=new n.ARRAY_TYPE(8);return $[0]=I,$[1]=P,$[2]=A,$[3]=N,$[4]=j,$[5]=V,$[6]=X,$[7]=K,$},St.fromRotationTranslationValues=function(I,P,A,N,j,V,X){var K=new n.ARRAY_TYPE(8);K[0]=I,K[1]=P,K[2]=A,K[3]=N;var $=.5*j,ne=.5*V,ie=.5*X;return K[4]=$*N+ne*A-ie*P,K[5]=ne*N+ie*I-$*A,K[6]=ie*N+$*P-ne*I,K[7]=-$*I-ne*P-ie*A,K},St.fromRotationTranslation=y,St.fromTranslation=function(I,P){return I[0]=0,I[1]=0,I[2]=0,I[3]=1,I[4]=.5*P[0],I[5]=.5*P[1],I[6]=.5*P[2],I[7]=0,I},St.fromRotation=function(I,P){return I[0]=P[0],I[1]=P[1],I[2]=P[2],I[3]=P[3],I[4]=0,I[5]=0,I[6]=0,I[7]=0,I},St.fromMat4=function(I,P){var A=a.create();d.getRotation(A,P);var N=new n.ARRAY_TYPE(3);return d.getTranslation(N,P),y(I,A,N),I},St.copy=T,St.identity=function(I){return I[0]=0,I[1]=0,I[2]=0,I[3]=1,I[4]=0,I[5]=0,I[6]=0,I[7]=0,I},St.set=function(I,P,A,N,j,V,X,K,$){return I[0]=P,I[1]=A,I[2]=N,I[3]=j,I[4]=V,I[5]=X,I[6]=K,I[7]=$,I},St.getDual=function(I,P){return I[0]=P[4],I[1]=P[5],I[2]=P[6],I[3]=P[7],I},St.setDual=function(I,P){return I[4]=P[0],I[5]=P[1],I[6]=P[2],I[7]=P[3],I},St.getTranslation=function(I,P){var A=P[4],N=P[5],j=P[6],V=P[7],X=-P[0],K=-P[1],$=-P[2],ne=P[3];return I[0]=2*(A*ne+V*X+N*$-j*K),I[1]=2*(N*ne+V*K+j*X-A*$),I[2]=2*(j*ne+V*$+A*K-N*X),I},St.translate=function(I,P,A){var N=P[0],j=P[1],V=P[2],X=P[3],K=.5*A[0],$=.5*A[1],ne=.5*A[2],ie=P[4],ue=P[5],pe=P[6],ge=P[7];return I[0]=N,I[1]=j,I[2]=V,I[3]=X,I[4]=X*K+j*ne-V*$+ie,I[5]=X*$+V*K-N*ne+ue,I[6]=X*ne+N*$-j*K+pe,I[7]=-N*K-j*$-V*ne+ge,I},St.rotateX=function(I,P,A){var N=-P[0],j=-P[1],V=-P[2],X=P[3],K=P[4],$=P[5],ne=P[6],ie=P[7],ue=K*X+ie*N+$*V-ne*j,pe=$*X+ie*j+ne*N-K*V,ge=ne*X+ie*V+K*j-$*N,he=ie*X-K*N-$*j-ne*V;return a.rotateX(I,P,A),I[4]=ue*(X=I[3])+he*(N=I[0])+pe*(V=I[2])-ge*(j=I[1]),I[5]=pe*X+he*j+ge*N-ue*V,I[6]=ge*X+he*V+ue*j-pe*N,I[7]=he*X-ue*N-pe*j-ge*V,I},St.rotateY=function(I,P,A){var N=-P[0],j=-P[1],V=-P[2],X=P[3],K=P[4],$=P[5],ne=P[6],ie=P[7],ue=K*X+ie*N+$*V-ne*j,pe=$*X+ie*j+ne*N-K*V,ge=ne*X+ie*V+K*j-$*N,he=ie*X-K*N-$*j-ne*V;return a.rotateY(I,P,A),I[4]=ue*(X=I[3])+he*(N=I[0])+pe*(V=I[2])-ge*(j=I[1]),I[5]=pe*X+he*j+ge*N-ue*V,I[6]=ge*X+he*V+ue*j-pe*N,I[7]=he*X-ue*N-pe*j-ge*V,I},St.rotateZ=function(I,P,A){var N=-P[0],j=-P[1],V=-P[2],X=P[3],K=P[4],$=P[5],ne=P[6],ie=P[7],ue=K*X+ie*N+$*V-ne*j,pe=$*X+ie*j+ne*N-K*V,ge=ne*X+ie*V+K*j-$*N,he=ie*X-K*N-$*j-ne*V;return a.rotateZ(I,P,A),I[4]=ue*(X=I[3])+he*(N=I[0])+pe*(V=I[2])-ge*(j=I[1]),I[5]=pe*X+he*j+ge*N-ue*V,I[6]=ge*X+he*V+ue*j-pe*N,I[7]=he*X-ue*N-pe*j-ge*V,I},St.rotateByQuatAppend=function(I,P,A){var N=A[0],j=A[1],V=A[2],X=A[3],K=P[0],$=P[1],ne=P[2],ie=P[3];return I[0]=K*X+ie*N+$*V-ne*j,I[1]=$*X+ie*j+ne*N-K*V,I[2]=ne*X+ie*V+K*j-$*N,I[3]=ie*X-K*N-$*j-ne*V,I[4]=(K=P[4])*X+(ie=P[7])*N+($=P[5])*V-(ne=P[6])*j,I[5]=$*X+ie*j+ne*N-K*V,I[6]=ne*X+ie*V+K*j-$*N,I[7]=ie*X-K*N-$*j-ne*V,I},St.rotateByQuatPrepend=function(I,P,A){var N=P[0],j=P[1],V=P[2],X=P[3],K=A[0],$=A[1],ne=A[2],ie=A[3];return I[0]=N*ie+X*K+j*ne-V*$,I[1]=j*ie+X*$+V*K-N*ne,I[2]=V*ie+X*ne+N*$-j*K,I[3]=X*ie-N*K-j*$-V*ne,I[4]=N*(ie=A[7])+X*(K=A[4])+j*(ne=A[6])-V*($=A[5]),I[5]=j*ie+X*$+V*K-N*ne,I[6]=V*ie+X*ne+N*$-j*K,I[7]=X*ie-N*K-j*$-V*ne,I},St.rotateAroundAxis=function(I,P,A,N){if(Math.abs(N)<n.EPSILON)return T(I,P);var j=Math.hypot(A[0],A[1],A[2]);N*=.5;var V=Math.sin(N),X=V*A[0]/j,K=V*A[1]/j,$=V*A[2]/j,ne=Math.cos(N),ie=P[0],ue=P[1],pe=P[2],ge=P[3];I[0]=ie*ne+ge*X+ue*$-pe*K,I[1]=ue*ne+ge*K+pe*X-ie*$,I[2]=pe*ne+ge*$+ie*K-ue*X,I[3]=ge*ne-ie*X-ue*K-pe*$;var he=P[4],Se=P[5],_e=P[6],Ce=P[7];return I[4]=he*ne+Ce*X+Se*$-_e*K,I[5]=Se*ne+Ce*K+_e*X-he*$,I[6]=_e*ne+Ce*$+he*K-Se*X,I[7]=Ce*ne-he*X-Se*K-_e*$,I},St.add=function(I,P,A){return I[0]=P[0]+A[0],I[1]=P[1]+A[1],I[2]=P[2]+A[2],I[3]=P[3]+A[3],I[4]=P[4]+A[4],I[5]=P[5]+A[5],I[6]=P[6]+A[6],I[7]=P[7]+A[7],I},St.multiply=M,St.scale=function(I,P,A){return I[0]=P[0]*A,I[1]=P[1]*A,I[2]=P[2]*A,I[3]=P[3]*A,I[4]=P[4]*A,I[5]=P[5]*A,I[6]=P[6]*A,I[7]=P[7]*A,I},St.lerp=function(I,P,A,N){var j=1-N;return D(P,A)<0&&(N=-N),I[0]=P[0]*j+A[0]*N,I[1]=P[1]*j+A[1]*N,I[2]=P[2]*j+A[2]*N,I[3]=P[3]*j+A[3]*N,I[4]=P[4]*j+A[4]*N,I[5]=P[5]*j+A[5]*N,I[6]=P[6]*j+A[6]*N,I[7]=P[7]*j+A[7]*N,I},St.invert=function(I,P){var A=C(P);return I[0]=-P[0]/A,I[1]=-P[1]/A,I[2]=-P[2]/A,I[3]=P[3]/A,I[4]=-P[4]/A,I[5]=-P[5]/A,I[6]=-P[6]/A,I[7]=P[7]/A,I},St.conjugate=function(I,P){return I[0]=-P[0],I[1]=-P[1],I[2]=-P[2],I[3]=P[3],I[4]=-P[4],I[5]=-P[5],I[6]=-P[6],I[7]=P[7],I},St.normalize=function(I,P){var A=C(P);if(A>0){A=Math.sqrt(A);var N=P[0]/A,j=P[1]/A,V=P[2]/A,X=P[3]/A,K=P[4],$=P[5],ne=P[6],ie=P[7],ue=N*K+j*$+V*ne+X*ie;I[0]=N,I[1]=j,I[2]=V,I[3]=X,I[4]=(K-N*ue)/A,I[5]=($-j*ue)/A,I[6]=(ne-V*ue)/A,I[7]=(ie-X*ue)/A}return I},St.str=function(I){return"quat2("+I[0]+", "+I[1]+", "+I[2]+", "+I[3]+", "+I[4]+", "+I[5]+", "+I[6]+", "+I[7]+")"},St.exactEquals=function(I,P){return I[0]===P[0]&&I[1]===P[1]&&I[2]===P[2]&&I[3]===P[3]&&I[4]===P[4]&&I[5]===P[5]&&I[6]===P[6]&&I[7]===P[7]},St.equals=function(I,P){var A=I[0],N=I[1],j=I[2],V=I[3],X=I[4],K=I[5],$=I[6],ne=I[7],ie=P[0],ue=P[1],pe=P[2],ge=P[3],he=P[4],Se=P[5],_e=P[6],Ce=P[7];return Math.abs(A-ie)<=n.EPSILON*Math.max(1,Math.abs(A),Math.abs(ie))&&Math.abs(N-ue)<=n.EPSILON*Math.max(1,Math.abs(N),Math.abs(ue))&&Math.abs(j-pe)<=n.EPSILON*Math.max(1,Math.abs(j),Math.abs(pe))&&Math.abs(V-ge)<=n.EPSILON*Math.max(1,Math.abs(V),Math.abs(ge))&&Math.abs(X-he)<=n.EPSILON*Math.max(1,Math.abs(X),Math.abs(he))&&Math.abs(K-Se)<=n.EPSILON*Math.max(1,Math.abs(K),Math.abs(Se))&&Math.abs($-_e)<=n.EPSILON*Math.max(1,Math.abs($),Math.abs(_e))&&Math.abs(ne-Ce)<=n.EPSILON*Math.max(1,Math.abs(ne),Math.abs(Ce))},St.sqrLen=St.squaredLength=St.len=St.length=St.dot=St.mul=St.setReal=St.getReal=void 0;var n=h(H()),a=h(tt()),d=h(ft());function g(I){if(typeof WeakMap!="function")return null;var P=new WeakMap,A=new WeakMap;return(g=function(N){return N?A:P})(I)}function h(I,P){if(I&&I.__esModule)return I;if(I===null||c(I)!=="object"&&typeof I!="function")return{default:I};var A=g(P);if(A&&A.has(I))return A.get(I);var N={},j=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in I)if(V!=="default"&&Object.prototype.hasOwnProperty.call(I,V)){var X=j?Object.getOwnPropertyDescriptor(I,V):null;X&&(X.get||X.set)?Object.defineProperty(N,V,X):N[V]=I[V]}return N.default=I,A&&A.set(I,N),N}function y(I,P,A){var N=.5*A[0],j=.5*A[1],V=.5*A[2],X=P[0],K=P[1],$=P[2],ne=P[3];return I[0]=X,I[1]=K,I[2]=$,I[3]=ne,I[4]=N*ne+j*$-V*K,I[5]=j*ne+V*X-N*$,I[6]=V*ne+N*K-j*X,I[7]=-N*X-j*K-V*$,I}function T(I,P){return I[0]=P[0],I[1]=P[1],I[2]=P[2],I[3]=P[3],I[4]=P[4],I[5]=P[5],I[6]=P[6],I[7]=P[7],I}function M(I,P,A){var N=P[0],j=P[1],V=P[2],X=P[3],K=A[4],$=A[5],ne=A[6],ie=A[7],ue=P[4],pe=P[5],ge=P[6],he=P[7],Se=A[0],_e=A[1],Ce=A[2],Le=A[3];return I[0]=N*Le+X*Se+j*Ce-V*_e,I[1]=j*Le+X*_e+V*Se-N*Ce,I[2]=V*Le+X*Ce+N*_e-j*Se,I[3]=X*Le-N*Se-j*_e-V*Ce,I[4]=N*ie+X*K+j*ne-V*$+ue*Le+he*Se+pe*Ce-ge*_e,I[5]=j*ie+X*$+V*K-N*ne+pe*Le+he*_e+ge*Se-ue*Ce,I[6]=V*ie+X*ne+N*$-j*K+ge*Le+he*Ce+ue*_e-pe*Se,I[7]=X*ie-N*K-j*$-V*ne+he*Le-ue*Se-pe*_e-ge*Ce,I}St.getReal=a.copy,St.setReal=a.copy,St.mul=M;var D=a.dot;St.dot=D;var v=a.length;St.length=v,St.len=v;var C=a.squaredLength;return St.squaredLength=C,St.sqrLen=C,St}var Un,wr,Ut={};function Cr(){if(Un)return Ut;function c(P){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},c(P)}Un=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.create=d,Ut.clone=function(P){var A=new n.ARRAY_TYPE(2);return A[0]=P[0],A[1]=P[1],A},Ut.fromValues=function(P,A){var N=new n.ARRAY_TYPE(2);return N[0]=P,N[1]=A,N},Ut.copy=function(P,A){return P[0]=A[0],P[1]=A[1],P},Ut.set=function(P,A,N){return P[0]=A,P[1]=N,P},Ut.add=function(P,A,N){return P[0]=A[0]+N[0],P[1]=A[1]+N[1],P},Ut.subtract=g,Ut.multiply=h,Ut.divide=y,Ut.ceil=function(P,A){return P[0]=Math.ceil(A[0]),P[1]=Math.ceil(A[1]),P},Ut.floor=function(P,A){return P[0]=Math.floor(A[0]),P[1]=Math.floor(A[1]),P},Ut.min=function(P,A,N){return P[0]=Math.min(A[0],N[0]),P[1]=Math.min(A[1],N[1]),P},Ut.max=function(P,A,N){return P[0]=Math.max(A[0],N[0]),P[1]=Math.max(A[1],N[1]),P},Ut.round=function(P,A){return P[0]=Math.round(A[0]),P[1]=Math.round(A[1]),P},Ut.scale=function(P,A,N){return P[0]=A[0]*N,P[1]=A[1]*N,P},Ut.scaleAndAdd=function(P,A,N,j){return P[0]=A[0]+N[0]*j,P[1]=A[1]+N[1]*j,P},Ut.distance=T,Ut.squaredDistance=M,Ut.length=D,Ut.squaredLength=v,Ut.negate=function(P,A){return P[0]=-A[0],P[1]=-A[1],P},Ut.inverse=function(P,A){return P[0]=1/A[0],P[1]=1/A[1],P},Ut.normalize=function(P,A){var N=A[0],j=A[1],V=N*N+j*j;return V>0&&(V=1/Math.sqrt(V)),P[0]=A[0]*V,P[1]=A[1]*V,P},Ut.dot=function(P,A){return P[0]*A[0]+P[1]*A[1]},Ut.cross=function(P,A,N){var j=A[0]*N[1]-A[1]*N[0];return P[0]=P[1]=0,P[2]=j,P},Ut.lerp=function(P,A,N,j){var V=A[0],X=A[1];return P[0]=V+j*(N[0]-V),P[1]=X+j*(N[1]-X),P},Ut.random=function(P,A){A=A||1;var N=2*n.RANDOM()*Math.PI;return P[0]=Math.cos(N)*A,P[1]=Math.sin(N)*A,P},Ut.transformMat2=function(P,A,N){var j=A[0],V=A[1];return P[0]=N[0]*j+N[2]*V,P[1]=N[1]*j+N[3]*V,P},Ut.transformMat2d=function(P,A,N){var j=A[0],V=A[1];return P[0]=N[0]*j+N[2]*V+N[4],P[1]=N[1]*j+N[3]*V+N[5],P},Ut.transformMat3=function(P,A,N){var j=A[0],V=A[1];return P[0]=N[0]*j+N[3]*V+N[6],P[1]=N[1]*j+N[4]*V+N[7],P},Ut.transformMat4=function(P,A,N){var j=A[0],V=A[1];return P[0]=N[0]*j+N[4]*V+N[12],P[1]=N[1]*j+N[5]*V+N[13],P},Ut.rotate=function(P,A,N,j){var V=A[0]-N[0],X=A[1]-N[1],K=Math.sin(j),$=Math.cos(j);return P[0]=V*$-X*K+N[0],P[1]=V*K+X*$+N[1],P},Ut.angle=function(P,A){var N=P[0],j=P[1],V=A[0],X=A[1],K=Math.sqrt(N*N+j*j)*Math.sqrt(V*V+X*X);return Math.acos(Math.min(Math.max(K&&(N*V+j*X)/K,-1),1))},Ut.zero=function(P){return P[0]=0,P[1]=0,P},Ut.str=function(P){return"vec2("+P[0]+", "+P[1]+")"},Ut.exactEquals=function(P,A){return P[0]===A[0]&&P[1]===A[1]},Ut.equals=function(P,A){var N=P[0],j=P[1],V=A[0],X=A[1];return Math.abs(N-V)<=n.EPSILON*Math.max(1,Math.abs(N),Math.abs(V))&&Math.abs(j-X)<=n.EPSILON*Math.max(1,Math.abs(j),Math.abs(X))},Ut.forEach=Ut.sqrLen=Ut.sqrDist=Ut.dist=Ut.div=Ut.mul=Ut.sub=Ut.len=void 0;var n=function(P,A){if(P&&P.__esModule)return P;if(P===null||c(P)!=="object"&&typeof P!="function")return{default:P};var N=a(void 0);if(N&&N.has(P))return N.get(P);var j={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var X in P)if(X!=="default"&&Object.prototype.hasOwnProperty.call(P,X)){var K=V?Object.getOwnPropertyDescriptor(P,X):null;K&&(K.get||K.set)?Object.defineProperty(j,X,K):j[X]=P[X]}return j.default=P,N&&N.set(P,j),j}(H());function a(P){if(typeof WeakMap!="function")return null;var A=new WeakMap,N=new WeakMap;return(a=function(j){return j?N:A})(P)}function d(){var P=new n.ARRAY_TYPE(2);return n.ARRAY_TYPE!=Float32Array&&(P[0]=0,P[1]=0),P}function g(P,A,N){return P[0]=A[0]-N[0],P[1]=A[1]-N[1],P}function h(P,A,N){return P[0]=A[0]*N[0],P[1]=A[1]*N[1],P}function y(P,A,N){return P[0]=A[0]/N[0],P[1]=A[1]/N[1],P}function T(P,A){return Math.hypot(A[0]-P[0],A[1]-P[1])}function M(P,A){var N=A[0]-P[0],j=A[1]-P[1];return N*N+j*j}function D(P){return Math.hypot(P[0],P[1])}function v(P){var A=P[0],N=P[1];return A*A+N*N}Ut.len=D,Ut.sub=g,Ut.mul=h,Ut.div=y,Ut.dist=T,Ut.sqrDist=M,Ut.sqrLen=v;var C,I=(C=d(),function(P,A,N,j,V,X){var K,$;for(A||(A=2),N||(N=0),$=j?Math.min(j*A+N,P.length):P.length,K=N;K<$;K+=A)C[0]=P[K],C[1]=P[K+1],V(C,C,X),P[K]=C[0],P[K+1]=C[1];return P});return Ut.forEach=I,Ut}function or(){if(wr)return F;function c(P){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},c(P)}wr=1,Object.defineProperty(F,"__esModule",{value:!0}),F.vec4=F.vec3=F.vec2=F.quat2=F.quat=F.mat4=F.mat3=F.mat2d=F.mat2=F.glMatrix=void 0;var n=I(H());F.glMatrix=n;var a=I(te());F.mat2=a;var d=I(re());F.mat2d=d;var g=I(He());F.mat3=g;var h=I(ft());F.mat4=h;var y=I(tt());F.quat=y;var T=I(hn());F.quat2=T;var M=I(Cr());F.vec2=M;var D=I(en());F.vec3=D;var v=I(Et());function C(P){if(typeof WeakMap!="function")return null;var A=new WeakMap,N=new WeakMap;return(C=function(j){return j?N:A})(P)}function I(P,A){if(P&&P.__esModule)return P;if(P===null||c(P)!=="object"&&typeof P!="function")return{default:P};var N=C(A);if(N&&N.has(P))return N.get(P);var j={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var X in P)if(X!=="default"&&Object.prototype.hasOwnProperty.call(P,X)){var K=V?Object.getOwnPropertyDescriptor(P,X):null;K&&(K.get||K.set)?Object.defineProperty(j,X,K):j[X]=P[X]}return j.default=P,N&&N.set(P,j),j}return F.vec4=v,F}var Qt,dr,Jr,hr,Ie=or(),er=function(){if(dr)return Qt;function c(n,a,d,g){this.cx=3*n,this.bx=3*(d-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(g-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=a,this.p2x=d,this.p2y=g}return dr=1,Qt=c,c.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,a){if(a===void 0&&(a=1e-6),n<0)return 0;if(n>1)return 1;for(var d=n,g=0;g<8;g++){var h=this.sampleCurveX(d)-n;if(Math.abs(h)<a)return d;var y=this.sampleCurveDerivativeX(d);if(Math.abs(y)<1e-6)break;d-=h/y}var T=0,M=1;for(d=n,g=0;g<20&&(h=this.sampleCurveX(d),!(Math.abs(h-n)<a));g++)n>h?T=d:M=d,d=.5*(M-T)+T;return d},solve:function(n,a){return this.sampleCurveY(this.solveCurveX(n,a))}},Qt}(),Qr=k(er);function Fi(){if(hr)return Jr;function c(n,a){this.x=n,this.y=a}return hr=1,Jr=c,c.prototype={clone:function(){return new c(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,a){return this.clone()._rotateAround(n,a)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var a=n.x-this.x,d=n.y-this.y;return a*a+d*d},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,a){return Math.atan2(this.x*a-this.y*n,this.x*n+this.y*a)},_matMult:function(n){var a=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=a,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var a=Math.cos(n),d=Math.sin(n),g=d*this.x+a*this.y;return this.x=a*this.x-d*this.y,this.y=g,this},_rotateAround:function(n,a){var d=Math.cos(n),g=Math.sin(n),h=a.y+g*(this.x-a.x)+d*(this.y-a.y);return this.x=a.x+d*(this.x-a.x)-g*(this.y-a.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},c.convert=function(n){return n instanceof c?n:Array.isArray(n)?new c(n[0],n[1]):n},Jr}var Tt=k(Fi());function ws(c,n){if(Array.isArray(c)){if(!Array.isArray(n)||c.length!==n.length)return!1;for(let a=0;a<c.length;a++)if(!ws(c[a],n[a]))return!1;return!0}if(typeof c=="object"&&c!==null&&n!==null){if(typeof n!="object"||Object.keys(c).length!==Object.keys(n).length)return!1;for(const a in c)if(!ws(c[a],n[a]))return!1;return!0}return c===n}const Br=Math.PI/180,ro=180/Math.PI;function wn(c){return c*Br}function vi(c){return c*ro}const io=[[0,0],[1,0],[1,1],[0,1]];function Sl(c){if(c<=0)return 0;if(c>=1)return 1;const n=c*c,a=n*c;return 4*(c<.5?a:3*(c-n)+a-.75)}function Wa(c,n,a,d){const g=new Qr(c,n,a,d);return function(h){return g.solve(h)}}const xc=Wa(.25,.1,.25,1);function mn(c,n,a){return Math.min(a,Math.max(n,c))}function vc(c,n,a){return(a=mn((a-c)/(n-c),0,1))*a*(3-2*a)}function ua(c,n,a){const d=a-n,g=((c-n)%d+d)%d+n;return g===n?a:g}function Tl(c,n,a){if(!c.length)return a(null,[]);let d=c.length;const g=new Array(c.length);let h=null;c.forEach((y,T)=>{n(y,(M,D)=>{M&&(h=M),g[T]=D,--d==0&&a(h,g)})})}function Bi(c,...n){for(const a of n)for(const d in a)c[d]=a[d];return c}let Ss=1;function pd(){return Ss++}function md(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function bc(c,n){c.forEach(a=>{n[a]&&(n[a]=n[a].bind(n))})}function da(c,n){return c.indexOf(n,c.length-n.length)!==-1}function El(c,n,a){const d={};for(const g in c)d[g]=n.call(this,c[g],g,c);return d}function wc(c,n,a){const d={};for(const g in c)n.call(this,c[g],g,c)&&(d[g]=c[g]);return d}function Bs(c){return Array.isArray(c)?c.map(Bs):typeof c=="object"&&c?El(c,Bs):c}const gd={};function zn(c){gd[c]||(typeof console<"u"&&console.warn(c),gd[c]=!0)}function No(c,n,a){return(a.y-c.y)*(n.x-c.x)>(n.y-c.y)*(a.x-c.x)}function Xh(c){let n=0;for(let a,d,g=0,h=c.length,y=h-1;g<h;y=g++)a=c[g],d=c[y],n+=(d.x-a.x)*(a.y+d.y);return n}function Ts([c,n,a]){const d=wn(n+90),g=wn(a);return{x:c*Math.cos(d)*Math.sin(g),y:c*Math.sin(d)*Math.sin(g),z:c*Math.cos(g),azimuthal:n,polar:a}}function Cl(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function yd(c){const n={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,d,g,h)=>{const y=g||h;return n[d]=!y||y.toLowerCase(),""}),n["max-age"]){const a=parseInt(n["max-age"],10);isNaN(a)?delete n["max-age"]:n["max-age"]=a}return n}let Sc,_d=null;function Pl(c,n){return[c[4*n],c[4*n+1],c[4*n+2],c[4*n+3]]}function Ke(c,n,a,d){for(;n<a;){const g=n+a>>1;c[g]<d?n=g+1:a=g}return n}function ce(c,n,a,d){for(;n<a;){const g=n+a>>1;c[g]<=d?n=g+1:a=g}return n}function de(c){return c>0?1/(1.001-c):1+c}function we(c){return c>0?1-1/(1.001-c):-c}const Re={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Sc==null){const c=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Sc=r.API_URL_REGEX!=null?new RegExp(r.API_URL_REGEX):c}catch{Sc=c}}return Sc},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Re.API_URL)return null;try{const c=new URL(Re.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Ae(c){return Re.API_URL_REGEX.test(c)}function Be(c){return Re.API_SPRITE_REGEX.test(c)}let Xe,Ge,Ye,st,nt,yt;function Rt(){return Xe==null&&(Xe=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Xe}const kt={now:()=>st!==void 0?st:performance.now(),setNow(c){st=c},restoreNow(){st=void 0},frame(c){const n=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(n)}},getImageData(c,n=0){const{width:a,height:d}=c;nt||(nt=document.createElement("canvas"));const g=nt.getContext("2d",{willReadFrequently:!0});if(!g)throw new Error("failed to create canvas 2d context");return(a>nt.width||d>nt.height)&&(nt.width=a,nt.height=d),g.clearRect(-n,-n,a+2*n,d+2*n),g.drawImage(c,0,0,a,d),g.getImageData(-n,-n,a+2*n,d+2*n)},resolveURL:c=>(Ge||(Ge=document.createElement("a")),Ge.href=c,Ge.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ye==null&&(Ye=window.matchMedia("(prefers-reduced-motion: reduce)")),Ye.matches)},hasCanvasFingerprintNoise(){if(yt!==void 0)return yt;if(!Rt())return yt=!1,!1;const c=new OffscreenCanvas(85,1),n=c.getContext("2d",{willReadFrequently:!0});let a=0;for(let g=0;g<c.width;++g)n.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,n.fillRect(g,0,1,1);const d=n.getImageData(0,0,c.width,c.height);a=0;for(let g=0;g<d.data.length;++g)if(g%4!=3&&a++!==d.data[g])return yt=!0,!0;return yt=!1,!1}};function rn(c,n){const a=c.indexOf("?");if(a<0)return`${c}?${new URLSearchParams(n).toString()}`;const d=new URLSearchParams(c.slice(a));for(const g in n)d.set(g,n[g]);return`${c.slice(0,a)}?${d.toString()}`}function on(c,n={persistentParams:[]}){const a=c.indexOf("?");if(a<0)return c;const d=new URLSearchParams,g=new URLSearchParams(c.slice(a));for(const y of n.persistentParams){const T=g.get(y);T&&d.set(y,T)}const h=d.toString();return`${c.slice(0,a)}${h.length>0?`?${h}`:""}`}const ln="mapbox-tiles";let an=500,Xn=50;const rr=["language","worldview","jobid"];let gn,tr;function Er(){try{return caches}catch{}}function ei(){const c=Er();c&&gn==null&&(gn=c.open(ln))}let si=1/0;const Di={supported:!1,testSupport:function(c){!Yh&&ha&&(xd?Kh(c):so=c)}};let so,ha,Yh=!1,xd=!1;const Tc=typeof self<"u"?self:{};function Kh(c){const n=c.createTexture();c.bindTexture(c.TEXTURE_2D,n);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,ha),c.isContextLost())return;Di.supported=!0}catch{}c.deleteTexture(n),Yh=!0}Tc.document&&(ha=Tc.document.createElement("img"),ha.onload=function(){so&&Kh(so),so=null,xd=!0},ha.onerror=function(){Yh=!0,so=null},ha.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ec={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Ec);class Em extends Error{constructor(n,a,d){a===401&&Ae(d)&&(n+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(n),this.status=a,this.url=d}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Cm=Cl()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,vd=function(c,n){if(!(/^file:/.test(a=c.url)||/^file:/.test(Cm())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(d,g){const h=new AbortController,y=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:Cm(),referrerPolicy:d.referrerPolicy,signal:h.signal});let T=!1,M=!1;const D=(v=y.url).indexOf("sku=")>0&&Ae(v);var v;d.type==="json"&&y.headers.set("Accept","application/json");const C=(P,A,N)=>{if(M)return;if(P&&P.message!=="SecurityError"&&zn(P.toString()),A&&N)return I(A);const j=Date.now();fetch(y).then(V=>{if(V.ok){const X=D?V.clone():null;return I(V,X,j)}return g(new Em(V.statusText,V.status,d.url))}).catch(V=>{V.name!=="AbortError"&&g(new Error(`${V.message} ${d.url}`))})},I=(P,A,N)=>{(d.type==="arrayBuffer"?P.arrayBuffer():d.type==="json"?P.json():P.text()).then(j=>{M||(A&&N&&function(V,X,K){if(ei(),gn==null)return;const $=yd(X.headers.get("Cache-Control")||"");if($["no-store"])return;const ne={status:X.status,statusText:X.statusText,headers:new Headers};X.headers.forEach((pe,ge)=>ne.headers.set(ge,pe)),$["max-age"]&&ne.headers.set("Expires",new Date(K+1e3*$["max-age"]).toUTCString());const ie=ne.headers.get("Expires");if(!ie||new Date(ie).getTime()-K<42e4)return;let ue=on(V.url,{persistentParams:rr});if(X.status===206){const pe=V.headers.get("Range");if(!pe)return;ne.status=200,ue=rn(ue,{range:pe})}(function(pe,ge){if(tr===void 0)try{new Response(new ReadableStream),tr=!0}catch{tr=!1}tr?ge(pe.body):pe.blob().then(ge)})(X,pe=>{const ge=new Response((he=X.status)!==200&&he!==404&&[101,103,204,205,304].includes(he)?null:pe,ne);var he;ei(),gn!=null&&gn.then(Se=>Se.put(ue,ge)).catch(Se=>zn(Se.message))})}(y,A,N),T=!0,g(null,j,P.headers.get("Cache-Control"),P.headers.get("Expires")))}).catch(j=>{M||g(new Error(j.message))})};return D?function(P,A){if(ei(),gn==null)return A(null);gn.then(N=>{let j=on(P.url,{persistentParams:rr});const V=P.headers.get("Range");V&&(j=rn(j,{range:V})),N.match(j).then(X=>{const K=function($){if(!$)return!1;const ne=new Date($.headers.get("Expires")||0),ie=yd($.headers.get("Cache-Control")||"");return ne>Date.now()&&!ie["no-cache"]}(X);N.delete(j),K&&N.put(j,X.clone()),A(null,X,K)}).catch(A)}).catch(A)}(y,C):C(null,null),{cancel:()=>{M=!0,T||h.abort()}}}(c,n);if(Cl()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,n,void 0,!0)}var a;return function(d,g){const h=new XMLHttpRequest;h.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const y in d.headers)h.setRequestHeader(y,d.headers[y]);return d.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=d.credentials==="include",h.onerror=()=>{g(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let y=h.response;if(d.type==="json")try{y=JSON.parse(h.response)}catch(T){return g(T)}g(null,y,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else g(new Em(h.statusText,h.status,d.url))},h.send(d.body),{cancel:()=>h.abort()}}(c,n)},Cc=function(c,n){return vd(Bi(c,{type:"arrayBuffer"}),n)};function Vs(c){const n=document.createElement("a");return n.href=c,n.protocol===location.protocol&&n.host===location.host}const oo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ao,as;ao=[],as=0;const Lo=function(c,n){if(Di.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),as>=Re.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:c,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return ao.push(h),h}as++;let a=!1;const d=()=>{if(!a)for(a=!0,as--;ao.length&&as<Re.MAX_PARALLEL_IMAGE_REQUESTS;){const h=ao.shift(),{requestParameters:y,callback:T,cancelled:M}=h;M||(h.cancel=Lo(y,T).cancel)}},g=Cc(c,(h,y,T,M)=>{d(),h?n(h):y&&(self.createImageBitmap?function(D,v){const C=new Blob([new Uint8Array(D)],{type:"image/png"});createImageBitmap(C).then(I=>{v(null,I)}).catch(I=>{v(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(D,v)=>n(D,v,T,M)):function(D,v){const C=new Image;C.onload=()=>{v(null,C),URL.revokeObjectURL(C.src),C.onload=null,requestAnimationFrame(()=>{C.src=oo})},C.onerror=()=>v(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const I=new Blob([new Uint8Array(D)],{type:"image/png"});C.src=D.byteLength?URL.createObjectURL(I):oo}(y,(D,v)=>n(D,v,T,M)))});return{cancel:()=>{g.cancel(),d()}}};var bd,Pm,Mm,Oo={exports:{}},Jh={exports:{}},sx={exports:{}},tw=function(){if(Mm)return Oo.exports;Mm=1;var c=(bd||(bd=1,Jh.exports=function(a,d){var g,h,y,T,M,D,v,C;for(h=a.length-(g=3&a.length),y=d,M=3432918353,D=461845907,C=0;C<h;)v=255&a.charCodeAt(C)|(255&a.charCodeAt(++C))<<8|(255&a.charCodeAt(++C))<<16|(255&a.charCodeAt(++C))<<24,++C,y=27492+(65535&(T=5*(65535&(y=(y^=v=(65535&(v=(v=(65535&v)*M+(((v>>>16)*M&65535)<<16)&4294967295)<<15|v>>>17))*D+(((v>>>16)*D&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(v=0,g){case 3:v^=(255&a.charCodeAt(C+2))<<16;case 2:v^=(255&a.charCodeAt(C+1))<<8;case 1:y^=v=(65535&(v=(v=(65535&(v^=255&a.charCodeAt(C)))*M+(((v>>>16)*M&65535)<<16)&4294967295)<<15|v>>>17))*D+(((v>>>16)*D&65535)<<16)&4294967295}return y^=a.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),Jh.exports),n=(Pm||(Pm=1,sx.exports=function(a,d){for(var g,h=a.length,y=d^h,T=0;h>=4;)g=1540483477*(65535&(g=255&a.charCodeAt(T)|(255&a.charCodeAt(++T))<<8|(255&a.charCodeAt(++T))<<16|(255&a.charCodeAt(++T))<<24))+((1540483477*(g>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),h-=4,++T;switch(h){case 3:y^=(255&a.charCodeAt(T+2))<<16;case 2:y^=(255&a.charCodeAt(T+1))<<8;case 1:y=1540483477*(65535&(y^=255&a.charCodeAt(T)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),sx.exports);return Oo.exports=c,Oo.exports.murmur3=c,Oo.exports.murmur2=n,Oo.exports}(),ls=k(tw);class Ha{constructor(n,...a){Bi(this,a[0]||{}),this.type=n}}class wd extends Ha{constructor(n,a={}){super("error",Bi({error:n},a))}}function Pc(c,n,a){a[c]&&a[c].indexOf(n)!==-1||(a[c]=a[c]||[],a[c].push(n))}function Am(c,n,a){if(a&&a[c]){const d=a[c].indexOf(n);d!==-1&&a[c].splice(d,1)}}class Mc{on(n,a){return this._listeners=this._listeners||{},Pc(n,a,this._listeners),this}off(n,a){return Am(n,a,this._listeners),Am(n,a,this._oneTimeListeners),this}once(n,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Pc(n,a,this._oneTimeListeners),this):new Promise(d=>this.once(n,d))}fire(n,a){const d=typeof n=="string"?new Ha(n,a):n,g=d.type;if(this.listens(g)){d.target=this;const h=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(const M of h)M.call(this,d);const y=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(const M of y)Am(g,M,this._oneTimeListeners),M.call(this,d);const T=this._eventedParent;T&&(Bi(d,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(d))}else d instanceof wd&&console.error(d.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,a){return this._eventedParent=n,this._eventedParentData=a,this}}var Im,Fn={},Dm=function(){if(Im)return Fn;Im=1;var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(h){return(h=Math.round(h))<0?0:h>255?255:h}function a(h){return n(h[h.length-1]==="%"?parseFloat(h)/100*255:parseInt(h))}function d(h){return(y=h[h.length-1]==="%"?parseFloat(h)/100:parseFloat(h))<0?0:y>1?1:y;var y}function g(h,y,T){return T<0?T+=1:T>1&&(T-=1),6*T<1?h+(y-h)*T*6:2*T<1?y:3*T<2?h+(y-h)*(2/3-T)*6:h}try{Fn.parseCSSColor=function(h){var y,T=h.replace(/ /g,"").toLowerCase();if(T in c)return c[T].slice();if(T[0]==="#")return T.length===4?(y=parseInt(T.substr(1),16))>=0&&y<=4095?[(3840&y)>>4|(3840&y)>>8,240&y|(240&y)>>4,15&y|(15&y)<<4,1]:null:T.length===7&&(y=parseInt(T.substr(1),16))>=0&&y<=16777215?[(16711680&y)>>16,(65280&y)>>8,255&y,1]:null;var M=T.indexOf("("),D=T.indexOf(")");if(M!==-1&&D+1===T.length){var v=T.substr(0,M),C=T.substr(M+1,D-(M+1)).split(","),I=1;switch(v){case"rgba":if(C.length!==4)return null;I=d(C.pop());case"rgb":return C.length!==3?null:[a(C[0]),a(C[1]),a(C[2]),I];case"hsla":if(C.length!==4)return null;I=d(C.pop());case"hsl":if(C.length!==3)return null;var P=(parseFloat(C[0])%360+360)%360/360,A=d(C[1]),N=d(C[2]),j=N<=.5?N*(A+1):N+A-N*A,V=2*N-j;return[n(255*g(V,j,P+1/3)),n(255*g(V,j,P)),n(255*g(V,j,P-1/3)),I];default:return null}}return null}}catch{}return Fn}();class Yn{constructor(n,a,d,g=1){this.r=n,this.g=a,this.b=d,this.a=g}static parse(n){if(!n)return;if(n instanceof Yn)return n;if(typeof n!="string")return;const a=Dm.parseCSSColor(n);return a?new Yn(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){const[n,a,d,g]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(n)},${Math.round(a)},${Math.round(d)},${g})`}toRenderColor(n){const{r:a,g:d,b:g,a:h}=this;return new nw(n,a,d,g,h)}}class nw{constructor(n,a,d,g,h){if(n){const y=n.image.height,T=y*y;a=h===0?0:a/h*(y-1),d=h===0?0:d/h*(y-1),g=h===0?0:g/h*(y-1);const M=Math.floor(a),D=Math.floor(d),v=Math.floor(g),C=Math.ceil(a),I=Math.ceil(d),P=Math.ceil(g),A=a-M,N=d-D,j=g-v,V=n.image.data,X=4*(M+D*T+v*y),K=4*(M+D*T+P*y),$=4*(M+I*T+v*y),ne=4*(M+I*T+P*y),ie=4*(C+D*T+v*y),ue=4*(C+D*T+P*y),pe=4*(C+I*T+v*y),ge=4*(C+I*T+P*y);if(X<0||ge>=V.length)throw new Error("out of range");this.r=Xt(Xt(Xt(V[X],V[K],j),Xt(V[$],V[ne],j),N),Xt(Xt(V[ie],V[ue],j),Xt(V[pe],V[ge],j),N),A)/255*h,this.g=Xt(Xt(Xt(V[X+1],V[K+1],j),Xt(V[$+1],V[ne+1],j),N),Xt(Xt(V[ie+1],V[ue+1],j),Xt(V[pe+1],V[ge+1],j),N),A)/255*h,this.b=Xt(Xt(Xt(V[X+2],V[K+2],j),Xt(V[$+2],V[ne+2],j),N),Xt(Xt(V[ie+2],V[ue+2],j),Xt(V[pe+2],V[ge+2],j),N),A)/255*h,this.a=h}else this.r=a,this.g=d,this.b=g,this.a=h}toArray(){const{r:n,g:a,b:d,a:g}=this;return g===0?[0,0,0,0]:[255*n/g,255*a/g,255*d/g,g]}toArray01(){const{r:n,g:a,b:d,a:g}=this;return g===0?[0,0,0,0]:[n/g,a/g,d/g,g]}toArray01Scaled(n){const{r:a,g:d,b:g,a:h}=this;return h===0?[0,0,0]:[a/h*n,d/h*n,g/h*n]}toArray01PremultipliedAlpha(){const{r:n,g:a,b:d,a:g}=this;return[n,a,d,g]}toArray01Linear(){const{r:n,g:a,b:d,a:g}=this;return g===0?[0,0,0,0]:[Math.pow(n/g,2.2),Math.pow(a/g,2.2),Math.pow(d/g,2.2),g]}}function Xt(c,n,a){return c*(1-a)+n*a}function Sd(c,n,a){return c.map((d,g)=>Xt(d,n[g],a))}Yn.black=new Yn(0,0,0,1),Yn.white=new Yn(1,1,1,1),Yn.transparent=new Yn(0,0,0,0),Yn.red=new Yn(1,0,0,1),Yn.blue=new Yn(0,0,1,1);var Ml=Object.freeze({__proto__:null,array:Sd,color:function(c,n,a){return new Yn(Xt(c.r,n.r,a),Xt(c.g,n.g,a),Xt(c.b,n.b,a),Xt(c.a,n.a,a))},number:Xt});function Ac(c,...n){for(const a of n)for(const d in a)c[d]=a[d];return c}class jo extends Error{constructor(n,a){super(a),this.message=a,this.key=n}}class Qh{constructor(n,a=[]){this.parent=n,this.bindings={};for(const[d,g]of a)this.bindings[d]=g}concat(n){return new Qh(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const lo={kind:"null"},zt={kind:"number"},Dn={kind:"string"},Rn={kind:"boolean"},cs={kind:"color"},Vi={kind:"object"},On={kind:"value"},ef={kind:"collator"},Ic={kind:"formatted"},Dc={kind:"resolvedImage"};function Xi(c,n){return{kind:"array",itemType:c,N:n}}function Or(c){if(c.kind==="array"){const n=Or(c.itemType);return typeof c.N=="number"?`array<${n}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${n}>`}return c.kind}const ox=[lo,zt,Dn,Rn,cs,Ic,Vi,Xi(On),Dc];function Rc(c,n){if(n.kind==="error")return null;if(c.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!Rc(c.itemType,n.itemType))&&(typeof c.N!="number"||c.N===n.N))return null}else{if(c.kind===n.kind)return null;if(c.kind==="value"){for(const a of ox)if(!Rc(a,n))return null}}return`Expected ${Or(c)} but found ${Or(n)} instead.`}function kc(c,n){return n.some(a=>a.kind===c.kind)}function zo(c,n){return n.some(a=>a==="null"?c===null:a==="array"?Array.isArray(c):a==="object"?c&&!Array.isArray(c)&&typeof c=="object":a===typeof c)}class tf{constructor(n,a,d){this.sensitivity=n?a?"variant":"case":a?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,a){return this.collator.compare(n,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Es{constructor(n,a,d,g,h){this.text=n.normalize?n.normalize():n,this.image=a,this.scale=d,this.fontStack=g,this.textColor=h}}class Ui{constructor(n){this.sections=n}static fromString(n){return new Ui([new Es(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.namePrimary.length!==0)}static factory(n){return n instanceof Ui?n:Ui.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const a of this.sections){if(a.image){n.push(["image",a.image.namePrimary]);continue}n.push(a.text);const d={};a.fontStack&&(d["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(d["font-scale"]=a.scale),a.textColor&&(d["text-color"]=["rgba"].concat(a.textColor.toRenderColor(null).toArray())),n.push(d)}return n}}class Yi{constructor(n){this.namePrimary=n.namePrimary,n.nameSecondary&&(this.nameSecondary=n.nameSecondary),this.available=n.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(n,a){return n?new Yi({namePrimary:n,nameSecondary:a,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function ax(c,n,a,d){return typeof c=="number"&&c>=0&&c<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof a=="number"&&a>=0&&a<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[c,n,a,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[c,n,a,d]:[c,n,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function qa(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Yn||c instanceof tf||c instanceof Ui||c instanceof Yi)return!0;if(Array.isArray(c)){for(const n of c)if(!qa(n))return!1;return!0}if(typeof c=="object"){for(const n in c)if(!qa(c[n]))return!1;return!0}return!1}function Wr(c){if(c===null)return lo;if(typeof c=="string")return Dn;if(typeof c=="boolean")return Rn;if(typeof c=="number")return zt;if(c instanceof Yn)return cs;if(c instanceof tf)return ef;if(c instanceof Ui)return Ic;if(c instanceof Yi)return Dc;if(Array.isArray(c)){const n=c.length;let a;for(const d of c){const g=Wr(d);if(a){if(a===g)continue;a=On;break}a=g}return Xi(a||On,n)}return Vi}function Ki(c){const n=typeof c;return c===null?"":n==="string"||n==="number"||n==="boolean"?String(c):c instanceof Yn||c instanceof Ui||c instanceof Yi?c.toString():JSON.stringify(c)}class co{constructor(n,a){this.type=n,this.value=a}static parse(n,a){if(n.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!qa(n[1]))return a.error("invalid value");const d=n[1];let g=Wr(d);const h=a.expectedType;return g.kind!=="array"||g.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(g=h),new co(g,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Yn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Ui?this.value.serialize():this.value}}class mi{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const Rm={string:Dn,number:zt,boolean:Rn,object:Vi};class uo{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");let d,g=1;const h=n[0];if(h==="array"){let T,M;if(n.length>2){const D=n[1];if(typeof D!="string"||!(D in Rm)||D==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);T=Rm[D],g++}else T=On;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return a.error('The length argument to "array" must be a positive integer literal',2);M=n[2],g++}d=Xi(T,M)}else d=Rm[h];const y=[];for(;g<n.length;g++){const T=a.parse(n[g],g,On);if(!T)return null;y.push(T)}return new uo(d,y)}evaluate(n){for(let a=0;a<this.args.length;a++){const d=this.args[a].evaluate(n);if(!Rc(this.type,Wr(d)))return d;if(a===this.args.length-1)throw new mi(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${Or(Wr(d))} but was expected to be of type ${Or(this.type)}.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,a=[n.kind];if(n.kind==="array"){const d=n.itemType;if(d.kind==="string"||d.kind==="number"||d.kind==="boolean"){a.push(d.kind);const g=n.N;(typeof g=="number"||this.args.length>1)&&a.push(g)}}return a.concat(this.args.map(d=>d.serialize()))}}class Nc{constructor(n){this.type=Ic,this.sections=n}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");const d=n[1];if(!Array.isArray(d)&&typeof d=="object")return a.error("First argument must be an image or text section.");const g=[];let h=!1;for(let y=1;y<=n.length-1;++y){const T=n[y];if(h&&typeof T=="object"&&!Array.isArray(T)){h=!1;let M=null;if(T["font-scale"]&&(M=a.parseObjectValue(T["font-scale"],y,"font-scale",zt),!M))return null;let D=null;if(T["text-font"]&&(D=a.parseObjectValue(T["text-font"],y,"text-font",Xi(Dn)),!D))return null;let v=null;if(T["text-color"]&&(v=a.parseObjectValue(T["text-color"],y,"text-color",cs),!v))return null;const C=g[g.length-1];C.scale=M,C.font=D,C.textColor=v}else{const M=a.parse(n[y],y,On);if(!M)return null;const D=M.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,g.push({content:M,scale:null,font:null,textColor:null})}}return new Nc(g)}evaluate(n){return new Ui(this.sections.map(a=>{const d=a.content.evaluate(n);return Wr(d)===Dc?new Es("",d,null,null,null):new Es(Ki(d),null,a.scale?a.scale.evaluate(n):null,a.font?a.font.evaluate(n).join(","):null,a.textColor?a.textColor.evaluate(n):null)}))}eachChild(n){for(const a of this.sections)n(a.content),a.scale&&n(a.scale),a.font&&n(a.font),a.textColor&&n(a.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const a of this.sections){n.push(a.content.serialize());const d={};a.scale&&(d["font-scale"]=a.scale.serialize()),a.font&&(d["text-font"]=a.font.serialize()),a.textColor&&(d["text-color"]=a.textColor.serialize()),n.push(d)}return n}}class Al{constructor(n,a){this.type=Dc,this.inputPrimary=n,this.inputSecondary=a}static parse(n,a){if(n.length<2)return a.error("Expected two or more arguments.");const d=a.parse(n[1],1,Dn);if(!d)return a.error("No image name provided.");if(n.length===2)return new Al(d);const g=a.parse(n[2],1,Dn);return g?new Al(d,g):a.error("Secondary image variant is not a string.")}evaluate(n){const a=Yi.fromString(this.inputPrimary.evaluate(n),this.inputSecondary?this.inputSecondary.evaluate(n):void 0);return a&&n.availableImages&&(a.available=n.availableImages.indexOf(a.namePrimary)>-1,a.nameSecondary&&a.available&&n.availableImages&&(a.available=n.availableImages.indexOf(a.nameSecondary)>-1)),a}eachChild(n){n(this.inputPrimary),this.inputSecondary&&n(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Il(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}const nf={"to-boolean":Rn,"to-color":cs,"to-number":zt,"to-string":Dn};class fa{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");const d=n[0],g=[];let h=lo;if(d==="to-array"){if(!Array.isArray(n[1]))return null;const y=n[1].length;if(a.expectedType){if(a.expectedType.kind!=="array")return a.error(`Expected ${a.expectedType.kind} but found array.`);h=Xi(a.expectedType.itemType,y)}else{if(!(y>0&&qa(n[1][0])))return null;h=Xi(Wr(n[1][0]),y)}for(let T=0;T<y;T++){const M=n[1][T];let D;if(Il(M)==="array")D=a.parse(M,void 0,h.itemType);else{const v=Il(M);if(v!==h.itemType.kind)return a.error(`Expected ${h.itemType.kind} but found ${v}.`);D=a.registry.literal.parse(["literal",M===void 0?null:M],a)}if(!D)return null;g.push(D)}}else{if((d==="to-boolean"||d==="to-string")&&n.length!==2)return a.error("Expected one argument.");h=nf[d];for(let y=1;y<n.length;y++){const T=a.parse(n[y],y,On);if(!T)return null;g.push(T)}}return new fa(h,g)}evaluate(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){let a,d;for(const g of this.args){if(a=g.evaluate(n),d=null,a instanceof Yn)return a;if(typeof a=="string"){const h=n.parseColor(a);if(h)return h}else if(Array.isArray(a)&&(d=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:ax(a[0],a[1],a[2],a[3]),!d))return new Yn(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new mi(d||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(const d of this.args){if(a=d.evaluate(n),a===null)return 0;const g=Number(a);if(!isNaN(g))return g}throw new mi(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?Ui.fromString(Ki(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?Yi.fromString(Ki(this.args[0].evaluate(n))):this.type.kind==="array"?this.args.map(a=>a.evaluate(n)):Ki(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Nc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Al(this.args[0]).serialize();const n=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(a=>{n.push(a.serialize())}),n}}const rw=["Unknown","Point","LineString","Polygon"];class lx{constructor(n,a){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=n,this.options=a}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?rw[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(n){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:d,y:g}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(d*a-n[0])+this.featureDistanceData.bearing[1]*(g*a-n[1])}return 0}parseColor(n){let a=this._parseColorCache[n];return a||(a=this._parseColorCache[n]=Yn.parse(n)),a}getConfig(n){return this.options?this.options.get(n):null}}class us{constructor(n,a,d,g,h){this.name=n,this.type=a,this._evaluate=d,this.args=g,this._overloadIndex=h}evaluate(n){if(!this._evaluate){const a=us.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,a){const d=n[0],g=us.definitions[d];if(!g)return a.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(g)?g[0]:g.type,y=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,T=[];let M=null,D=-1;for(const[v,C]of y){if(Array.isArray(v)&&v.length!==n.length-1)continue;T.push(v),D++,M=new vx(a.registry,a.path,null,a.scope,void 0,a._scope,a.options);const I=[];let P=!1;for(let A=1;A<n.length;A++){const N=n[A],j=Array.isArray(v)?v[A-1]:v.type,V=M.parse(N,1+I.length,j);if(!V){P=!0;break}I.push(V)}if(!P)if(Array.isArray(v)&&v.length!==I.length)M.error(`Expected ${v.length} arguments, but found ${I.length} instead.`);else{for(let A=0;A<I.length;A++){const N=Array.isArray(v)?v[A]:v.type,j=I[A];M.concat(A+1).checkSubtype(N,j.type)}if(M.errors.length===0)return new us(d,h,C,I,D)}}if(T.length===1)a.errors.push(...M.errors);else{const v=(T.length?T:y.map(([I])=>I)).map(iw).join(" | "),C=[];for(let I=1;I<n.length;I++){const P=a.parse(n[I],1+C.length);if(!P)return null;C.push(Or(P.type))}a.error(`Expected arguments of type ${v}, but found (${C.join(", ")}) instead.`)}return null}static register(n,a){us.definitions=a;for(const d in a)n[d]=us}}function iw(c){return Array.isArray(c)?`(${c.map(Or).join(", ")})`:`(${Or(c.type)}...)`}class rf{constructor(n,a,d){this.type=ef,this.locale=d,this.caseSensitive=n,this.diacriticSensitive=a}static parse(n,a){if(n.length!==2)return a.error("Expected one argument.");const d=n[1];if(typeof d!="object"||Array.isArray(d))return a.error("Collator options argument must be an object.");const g=d["case-sensitive"]===void 0?a.parse(!1,1,Rn):a.parseObjectValue(d["case-sensitive"],1,"case-sensitive",Rn);if(!g)return null;const h=d["diacritic-sensitive"]===void 0?a.parse(!1,1,Rn):a.parseObjectValue(d["diacritic-sensitive"],1,"diacritic-sensitive",Rn);if(!h)return null;let y=null;return d.locale&&(y=a.parseObjectValue(d.locale,1,"locale",Dn),!y)?null:new rf(g,h,y)}evaluate(n){return new tf(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}function cx(c,n,a=0,d=c.length-1,g=Oc){for(;d>a;){if(d-a>600){const M=d-a+1,D=n-a+1,v=Math.log(M),C=.5*Math.exp(2*v/3),I=.5*Math.sqrt(v*C*(M-C)/M)*(D-M/2<0?-1:1);cx(c,n,Math.max(a,Math.floor(n-D*C/M+I)),Math.min(d,Math.floor(n+(M-D)*C/M+I)),g)}const h=c[n];let y=a,T=d;for(Lc(c,a,n),g(c[d],h)>0&&Lc(c,a,d);y<T;){for(Lc(c,y,T),y++,T--;g(c[y],h)<0;)y++;for(;g(c[T],h)>0;)T--}g(c[a],h)===0?Lc(c,a,T):(T++,Lc(c,T,d)),T<=n&&(a=T+1),n<=T&&(d=T-1)}}function Lc(c,n,a){const d=c[n];c[n]=c[a],c[a]=d}function Oc(c,n){return c<n?-1:c>n?1:0}function sw(c){let n=0;for(let a,d,g=0,h=c.length,y=h-1;g<h;y=g++)a=c[g],d=c[y],n+=(d.x-a.x)*(a.y+d.y);return n}function Td(c,n){c[0]=Math.min(c[0],n[0]),c[1]=Math.min(c[1],n[1]),c[2]=Math.max(c[2],n[0]),c[3]=Math.max(c[3],n[1])}function Dl(c,n){return!(c[0]<=n[0]||c[2]>=n[2]||c[1]<=n[1]||c[3]>=n[3])}function ow(c,n,a){const d=c[0]-n[0],g=c[1]-n[1],h=c[0]-a[0],y=c[1]-a[1];return d*y-h*g==0&&d*h<=0&&g*y<=0}function jc(c,n,a=!1){let d=!1;for(let T=0,M=n.length;T<M;T++){const D=n[T];for(let v=0,C=D.length,I=C-1;v<C;I=v++){const P=D[I],A=D[v];if(ow(c,P,A))return a;(h=P)[1]>(g=c)[1]!=(y=A)[1]>g[1]&&g[0]<(y[0]-h[0])*(g[1]-h[1])/(y[1]-h[1])+h[0]&&(d=!d)}}var g,h,y;return d}function ux(c,n,a,d){const g=d[0]-a[0],h=d[1]-a[1],y=(c[0]-a[0])*h-g*(c[1]-a[1]),T=(n[0]-a[0])*h-g*(n[1]-a[1]);return y>0&&T<0||y<0&&T>0}function sf(c,n,a,d){return(g=[d[0]-a[0],d[1]-a[1]])[0]*(h=[n[0]-c[0],n[1]-c[1]])[1]-g[1]*h[0]!=0&&!(!ux(c,n,a,d)||!ux(a,d,c,n));var g,h}const Cs=8192;function En(c,n){const a=(180+c[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,g=Math.pow(2,n.z);return[Math.round(a*g*Cs),Math.round(d*g*Cs)]}function qt(c,n){for(let a=0;a<n.length;a++)if(jc(c,n[a]))return!0;return!1}function km(c,n,a){for(const d of a)for(let g=0,h=d.length,y=h-1;g<h;y=g++)if(sf(c,n,d[y],d[g]))return!0;return!1}function un(c,n){for(let a=0;a<c.length;++a)if(!jc(c[a],n))return!1;for(let a=0;a<c.length-1;++a)if(km(c[a],c[a+1],n))return!1;return!0}function Nm(c,n){for(let a=0;a<n.length;a++)if(un(c,n[a]))return!0;return!1}function Ed(c,n,a){const d=[];for(let g=0;g<c.length;g++){const h=[];for(let y=0;y<c[g].length;y++){const T=En(c[g][y],a);Td(n,T),h.push(T)}d.push(h)}return d}function tn(c,n,a){const d=[];for(let g=0;g<c.length;g++){const h=Ed(c[g],n,a);d.push(h)}return d}function Lm(c,n,a,d){if(c[0]<a[0]||c[0]>a[2]){const g=.5*d;let h=c[0]-a[0]>g?-d:a[0]-c[0]>g?d:0;h===0&&(h=c[0]-a[2]>g?-d:a[2]-c[0]>g?d:0),c[0]+=h}Td(n,c)}function of(c,n,a,d){const g=Math.pow(2,d.z)*Cs,h=[d.x*Cs,d.y*Cs],y=[];if(!c)return y;for(const T of c)for(const M of T){const D=[M.x+h[0],M.y+h[1]];Lm(D,n,a,g),y.push(D)}return y}function Om(c,n,a,d){const g=Math.pow(2,d.z)*Cs,h=[d.x*Cs,d.y*Cs],y=[];if(!c)return y;for(const M of c){const D=[];for(const v of M){const C=[v.x+h[0],v.y+h[1]];Td(n,C),D.push(C)}y.push(D)}if(n[2]-n[0]<=g/2){(T=n)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const M of y)for(const D of M)Lm(D,n,a,g)}var T;return y}class Za{constructor(n,a){this.type=Rn,this.geojson=n,this.geometries=a}static parse(n,a){if(n.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(qa(n[1])){const d=n[1];if(d.type==="FeatureCollection")for(let g=0;g<d.features.length;++g){const h=d.features[g].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Za(d,d.features[g].geometry)}else if(d.type==="Feature"){const g=d.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Za(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new Za(d,d)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(a,d){const g=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if(d.type==="Polygon"){const T=Ed(d.coordinates,h,y),M=of(a.geometry(),g,h,y);if(!Dl(g,h))return!1;for(const D of M)if(!jc(D,T))return!1}if(d.type==="MultiPolygon"){const T=tn(d.coordinates,h,y),M=of(a.geometry(),g,h,y);if(!Dl(g,h))return!1;for(const D of M)if(!qt(D,T))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(a,d){const g=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if(d.type==="Polygon"){const T=Ed(d.coordinates,h,y),M=Om(a.geometry(),g,h,y);if(!Dl(g,h))return!1;for(const D of M)if(!un(D,T))return!1}if(d.type==="MultiPolygon"){const T=tn(d.coordinates,h,y),M=Om(a.geometry(),g,h,y);if(!Dl(g,h))return!1;for(const D of M)if(!Nm(D,T))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Rl={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Ni=1/298.257223563,af=Ni*(2-Ni),zc=Math.PI/180;class Fc{static fromTile(n,a,d){const g=Math.PI*(1-2*(n+.5)/Math.pow(2,a)),h=Math.atan(.5*(Math.exp(g)-Math.exp(-g)))/zc;return new Fc(h,d)}static get units(){return Rl}constructor(n,a){if(n===void 0)throw new Error("No latitude given.");if(a&&!Rl[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(Rl).join(", ")}`);const d=6378.137*zc*(a?Rl[a]:1),g=Math.cos(n*zc),h=1/(1-af*(1-g*g)),y=Math.sqrt(h);this.kx=d*y*g,this.ky=d*y*h*(1-af)}distance(n,a){const d=Pr(n[0]-a[0])*this.kx,g=(n[1]-a[1])*this.ky;return Math.sqrt(d*d+g*g)}bearing(n,a){const d=Pr(a[0]-n[0])*this.kx;return Math.atan2(d,(a[1]-n[1])*this.ky)/zc}destination(n,a,d){const g=d*zc;return this.offset(n,Math.sin(g)*a,Math.cos(g)*a)}offset(n,a,d){return[n[0]+a/this.kx,n[1]+d/this.ky]}lineDistance(n){let a=0;for(let d=0;d<n.length-1;d++)a+=this.distance(n[d],n[d+1]);return a}area(n){let a=0;for(let d=0;d<n.length;d++){const g=n[d];for(let h=0,y=g.length,T=y-1;h<y;T=h++)a+=Pr(g[h][0]-g[T][0])*(g[h][1]+g[T][1])*(d?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(n,a){let d=0;if(a<=0)return n[0];for(let g=0;g<n.length-1;g++){const h=n[g],y=n[g+1],T=this.distance(h,y);if(d+=T,d>a)return pa(h,y,(a-(d-T))/T)}return n[n.length-1]}pointToSegmentDistance(n,a,d){let[g,h]=a,y=Pr(d[0]-g)*this.kx,T=(d[1]-h)*this.ky;if(y!==0||T!==0){const M=(Pr(n[0]-g)*this.kx*y+(n[1]-h)*this.ky*T)/(y*y+T*T);M>1?(g=d[0],h=d[1]):M>0&&(g+=y/this.kx*M,h+=T/this.ky*M)}return y=Pr(n[0]-g)*this.kx,T=(n[1]-h)*this.ky,Math.sqrt(y*y+T*T)}pointOnLine(n,a){let d=1/0,g=n[0][0],h=n[0][1],y=0,T=0;for(let M=0;M<n.length-1;M++){let D=n[M][0],v=n[M][1],C=Pr(n[M+1][0]-D)*this.kx,I=(n[M+1][1]-v)*this.ky,P=0;C===0&&I===0||(P=(Pr(a[0]-D)*this.kx*C+(a[1]-v)*this.ky*I)/(C*C+I*I),P>1?(D=n[M+1][0],v=n[M+1][1]):P>0&&(D+=C/this.kx*P,v+=I/this.ky*P)),C=Pr(a[0]-D)*this.kx,I=(a[1]-v)*this.ky;const A=C*C+I*I;A<d&&(d=A,g=D,h=v,y=M,T=P)}return{point:[g,h],index:y,t:Math.max(0,Math.min(1,T))}}lineSlice(n,a,d){let g=this.pointOnLine(d,n),h=this.pointOnLine(d,a);if(g.index>h.index||g.index===h.index&&g.t>h.t){const D=g;g=h,h=D}const y=[g.point],T=g.index+1,M=h.index;!lf(d[T],y[0])&&T<=M&&y.push(d[T]);for(let D=T+1;D<=M;D++)y.push(d[D]);return lf(d[M],h.point)||y.push(h.point),y}lineSliceAlong(n,a,d){let g=0;const h=[];for(let y=0;y<d.length-1;y++){const T=d[y],M=d[y+1],D=this.distance(T,M);if(g+=D,g>n&&h.length===0&&h.push(pa(T,M,(n-(g-D))/D)),g>=a)return h.push(pa(T,M,(a-(g-D))/D)),h;g>n&&h.push(M)}return h}bufferPoint(n,a){const d=a/this.ky,g=a/this.kx;return[n[0]-g,n[1]-d,n[0]+g,n[1]+d]}bufferBBox(n,a){const d=a/this.ky,g=a/this.kx;return[n[0]-g,n[1]-d,n[2]+g,n[3]+d]}insideBBox(n,a){return Pr(n[0]-a[0])>=0&&Pr(n[0]-a[2])<=0&&n[1]>=a[1]&&n[1]<=a[3]}}function lf(c,n){return c[0]===n[0]&&c[1]===n[1]}function pa(c,n,a){const d=Pr(n[0]-c[0]);return[c[0]+d*a,c[1]+(n[1]-c[1])*a]}function Pr(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}class jm{constructor(n=[],a=(d,g)=>d<g?-1:d>g?1:0){if(this.data=n,this.length=this.data.length,this.compare=a,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:a,compare:d}=this,g=a[n];for(;n>0;){const h=n-1>>1,y=a[h];if(d(g,y)>=0)break;a[n]=y,n=h}a[n]=g}_down(n){const{data:a,compare:d}=this,g=this.length>>1,h=a[n];for(;n<g;){let y=1+(n<<1);const T=y+1;if(T<this.length&&d(a[T],a[y])<0&&(y=T),d(a[y],h)>=0)break;a[n]=a[y],n=y}a[n]=h}}var Mt=8192;function dx(c,n){return n.dist-c.dist}const Bc=100,cf=50;function uf(c){const n=[1/0,1/0,-1/0,-1/0];if(n.length!==c.length)return!1;for(let a=0;a<n.length;a++)if(n[a]!==c[a])return!1;return!0}function df(c){return c[1]-c[0]+1}function ma(c,n){const a=c[1]>=c[0]&&c[1]<n;return a||console.warn("Distance Expression: Index is out of range"),a}function zm(c,n){if(c[0]>c[1])return[null,null];const a=df(c);if(n){if(a===2)return[c,null];const d=Math.floor(a/2);return[[c[0],c[0]+d],[c[0]+d,c[1]]]}{if(a===1)return[c,null];const d=Math.floor(a/2)-1;return[[c[0],c[0]+d],[c[0]+d+1,c[1]]]}}function Ps(c,n){const a=[1/0,1/0,-1/0,-1/0];if(!ma(n,c.length))return a;for(let d=n[0];d<=n[1];++d)Td(a,c[d]);return a}function hf(c){const n=[1/0,1/0,-1/0,-1/0];for(let a=0;a<c.length;++a)for(let d=0;d<c[a].length;++d)Td(n,c[a][d]);return n}function Vc(c,n,a){if(uf(c)||uf(n))return NaN;let d=0,g=0;return c[2]<n[0]&&(d=n[0]-c[2]),c[0]>n[2]&&(d=c[0]-n[2]),c[1]>n[3]&&(g=c[1]-n[3]),c[3]<n[1]&&(g=n[1]-c[3]),a.distance([0,0],[d,g])}function hx(c){return 360*c-180}function fx(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Ms(c,n){const a=Math.pow(2,n.z),d=(c.y/Mt+n.y)/a;return[hx((c.x/Mt+n.x)/a),fx(d)]}function px(c,n){const a=[];for(let d=0;d<c.length;++d)a.push(Ms(c[d],n));return a}function Fm(c,n,a){const d=a.pointOnLine(n,c).point;return a.distance(c,d)}function Bm(c,n,a,d,g){const h=a.slice(d[0],d[1]+1);let y=1/0;for(let T=n[0];T<=n[1];++T)if((y=Math.min(y,Fm(c[T],h,g)))===0)return 0;return y}function ff(c,n,a,d,g){const h=Math.min(g.pointToSegmentDistance(c,a,d),g.pointToSegmentDistance(n,a,d)),y=Math.min(g.pointToSegmentDistance(a,c,n),g.pointToSegmentDistance(d,c,n));return Math.min(h,y)}function mx(c,n,a,d,g){if(!ma(n,c.length)||!ma(d,a.length))return NaN;let h=1/0;for(let y=n[0];y<n[1];++y)for(let T=d[0];T<d[1];++T){if(sf(c[y],c[y+1],a[T],a[T+1]))return 0;h=Math.min(h,ff(c[y],c[y+1],a[T],a[T+1],g))}return h}function gx(c,n,a,d,g){if(!ma(n,c.length)||!ma(d,a.length))return NaN;let h=1/0;for(let y=n[0];y<=n[1];++y)for(let T=d[0];T<=d[1];++T)if((h=Math.min(h,g.distance(c[y],a[T])))===0)return h;return h}function yx(c,n,a){if(jc(c,n,!0))return 0;let d=1/0;for(const g of n){const h=g.length;if(h<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(g[0]!==g[h-1]&&(d=Math.min(d,a.pointToSegmentDistance(c,g[h-1],g[0])))===0||(d=Math.min(d,Fm(c,g,a)))===0)return d}return d}function _x(c,n,a,d){if(!ma(n,c.length))return NaN;for(let h=n[0];h<=n[1];++h)if(jc(c[h],a,!0))return 0;let g=1/0;for(let h=n[0];h<n[1];++h)for(const y of a)for(let T=0,M=y.length,D=M-1;T<M;D=T++){if(sf(c[h],c[h+1],y[D],y[T]))return 0;g=Math.min(g,ff(c[h],c[h+1],y[D],y[T],d))}return g}function Vm(c,n){for(const a of c)for(let d=0;d<=a.length-1;++d)if(jc(a[d],n,!0))return!0;return!1}function xx(c,n,a,d=1/0){const g=hf(c),h=hf(n);if(d!==1/0&&Vc(g,h,a)>=d)return d;if(Dl(g,h)){if(Vm(c,n))return 0}else if(Vm(n,c))return 0;let y=d;for(const T of c)for(let M=0,D=T.length,v=D-1;M<D;v=M++)for(const C of n)for(let I=0,P=C.length,A=P-1;I<P;A=I++){if(sf(T[v],T[M],C[A],C[I]))return 0;y=Math.min(y,ff(T[v],T[M],C[A],C[I],a))}return y}function Cd(c,n,a,d,g,h,y){if(h===null||y===null)return;const T=Vc(Ps(d,h),Ps(g,y),a);T<n&&c.push({dist:T,range1:h,range2:y})}function pf(c,n,a,d,g=1/0){let h=Math.min(d.distance(c[0],a[0][0]),g);if(h===0)return h;const y=new jm([{dist:0,range1:[0,c.length-1],range2:[0,0]}],dx),T=n?cf:Bc,M=hf(a);for(;y.length;){const D=y.pop();if(D.dist>=h)continue;const v=D.range1;if(df(v)<=T){if(!ma(v,c.length))return NaN;if(n){const C=_x(c,v,a,d);if((h=Math.min(h,C))===0)return h}else for(let C=v[0];C<=v[1];++C){const I=yx(c[C],a,d);if((h=Math.min(h,I))===0)return h}}else{const C=zm(v,n);if(C[0]!==null){const I=Vc(Ps(c,C[0]),M,d);I<h&&y.push({dist:I,range1:C[0],range2:[0,0]})}if(C[1]!==null){const I=Vc(Ps(c,C[1]),M,d);I<h&&y.push({dist:I,range1:C[1],range2:[0,0]})}}}return h}function Pd(c,n,a,d,g,h=1/0){let y=Math.min(h,g.distance(c[0],a[0]));if(y===0)return y;const T=new jm([{dist:0,range1:[0,c.length-1],range2:[0,a.length-1]}],dx),M=n?cf:Bc,D=d?cf:Bc;for(;T.length;){const v=T.pop();if(v.dist>=y)continue;const C=v.range1,I=v.range2;if(df(C)<=M&&df(I)<=D){if(!ma(C,c.length)||!ma(I,a.length))return NaN;if(n&&d?y=Math.min(y,mx(c,C,a,I,g)):n||d?n&&!d?y=Math.min(y,Bm(a,I,c,C,g)):!n&&d&&(y=Math.min(y,Bm(c,C,a,I,g))):y=Math.min(y,gx(c,C,a,I,g)),y===0)return y}else{const P=zm(C,n),A=zm(I,d);Cd(T,y,g,c,a,P[0],A[0]),Cd(T,y,g,c,a,P[0],A[1]),Cd(T,y,g,c,a,P[1],A[0]),Cd(T,y,g,c,a,P[1],A[1])}}return y}function Uc(c,n,a,d,g=1/0){let h=g;const y=Ps(c,[0,c.length-1]);for(const T of a)if(!(h!==1/0&&Vc(y,Ps(T,[0,T.length-1]),d)>=h)&&(h=Math.min(h,Pd(c,n,T,!0,d,h)),h===0))return h;return h}function Md(c,n,a,d,g=1/0){let h=g;const y=Ps(c,[0,c.length-1]);for(const T of a){if(h!==1/0&&Vc(y,hf(T),d)>=h)continue;const M=pf(c,n,T,d,h);if(isNaN(M))return M;if((h=Math.min(h,M))===0)return h}return h}function mf(c){return c==="Point"||c==="MultiPoint"||c==="LineString"||c==="MultiLineString"||c==="Polygon"||c==="MultiPolygon"}class Xa{constructor(n,a){this.type=zt,this.geojson=n,this.geometries=a}static parse(n,a){if(n.length!==2)return a.error(`'distance' expression requires either one argument, but found ' ${n.length-1} instead.`);if(qa(n[1])){const d=n[1];if(d.type==="FeatureCollection"){for(let g=0;g<d.features.length;++g)if(mf(d.features[g].geometry.type))return new Xa(d,d.features[g].geometry)}else if(d.type==="Feature"){if(mf(d.geometry.type))return new Xa(d,d.geometry)}else if(mf(d.type))return new Xa(d,d)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(n){const a=n.geometry(),d=n.canonicalID();if(a!=null&&d!=null){if(n.geometryType()==="Point")return function(g,h,y){const T=[];for(const D of g)for(const v of D)T.push(Ms(v,h));const M=new Fc(T[0][1],"meters");return y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString"?Pd(T,!1,y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",M):y.type==="MultiLineString"?Uc(T,!1,y.coordinates,M):y.type==="Polygon"||y.type==="MultiPolygon"?Md(T,!1,y.type==="Polygon"?[y.coordinates]:y.coordinates,M):null}(a,d,this.geometries);if(n.geometryType()==="LineString")return function(g,h,y){const T=[];for(const D of g){const v=[];for(const C of D)v.push(Ms(C,h));T.push(v)}const M=new Fc(T[0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return Uc(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",T,M);if(y.type==="MultiLineString"){let D=1/0;for(let v=0;v<y.coordinates.length;v++){const C=Uc(y.coordinates[v],!0,T,M,D);if(isNaN(C))return C;if((D=Math.min(D,C))===0)return D}return D}if(y.type==="Polygon"||y.type==="MultiPolygon"){let D=1/0;for(let v=0;v<T.length;v++){const C=Md(T[v],!0,y.type==="Polygon"?[y.coordinates]:y.coordinates,M,D);if(isNaN(C))return C;if((D=Math.min(D,C))===0)return D}return D}return null}(a,d,this.geometries);if(n.geometryType()==="Polygon")return function(g,h,y){const T=[];for(const D of function(v,C){const I=v.length;if(I<=1)return[v];const P=[];let A,N;for(let j=0;j<I;j++){const V=sw(v[j]);V!==0&&(v[j].area=Math.abs(V),N===void 0&&(N=V<0),N===V<0?(A&&P.push(A),A=[v[j]]):A.push(v[j]))}return A&&P.push(A),P}(g)){const v=[];for(let C=0;C<D.length;++C)v.push(px(D[C],h));T.push(v)}const M=new Fc(T[0][0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return Md(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",T,M);if(y.type==="MultiLineString"){let D=1/0;for(let v=0;v<y.coordinates.length;v++){const C=Md(y.coordinates[v],!0,T,M,D);if(isNaN(C))return C;if((D=Math.min(D,C))===0)return D}return D}return y.type==="Polygon"||y.type==="MultiPolygon"?function(D,v,C){let I=1/0;for(const P of D)for(const A of v){const N=xx(P,A,C,I);if(isNaN(N))return N;if((I=Math.min(I,N))===0)return I}return I}(y.type==="Polygon"?[y.coordinates]:y.coordinates,T,M):null}(a,d,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ya(c,n){switch(c){case"string":return Ki(n);case"number":return+n;case"boolean":return!!n;case"color":return Yn.parse(n);case"formatted":return Ui.fromString(Ki(n));case"resolvedImage":return Yi.fromString(Ki(n))}return n}function kn(c,n,a,d){return d!==void 0&&(c=d*Math.round(c/d)),n!==void 0&&c<n&&(c=n),a!==void 0&&c>a&&(c=a),c}class $c{constructor(n,a,d){this.type=n,this.key=a,this.scope=d}static parse(n,a){let d=a.expectedType;if(d==null&&(d=On),n.length<2||n.length>3)return a.error("Invalid number of arguments for 'config' expression.");const g=a.parse(n[1],1);if(!(g instanceof co))return a.error("Key name of 'config' expression must be a string literal.");if(n.length>=3){const h=a.parse(n[2],2);return h instanceof co?new $c(d,Ki(g.value),Ki(h.value)):a.error("Scope of 'config' expression must be a string literal.")}return new $c(d,Ki(g.value))}evaluate(n){const a=[this.key,this.scope,n.scope].filter(Boolean).join(""),d=n.getConfig(a);if(!d)return null;const{type:g,value:h,values:y,minValue:T,maxValue:M,stepValue:D}=d,v=d.default.evaluate(n);let C=v;if(h){const I=n.scope;n.scope=(I||"").split("").slice(1).join(""),C=h.evaluate(n),n.scope=I}return g&&(C=Ya(g,C)),C===void 0||T===void 0&&M===void 0&&D===void 0||(typeof C=="number"?C=kn(C,T,M,D):Array.isArray(C)&&(C=C.map(I=>typeof I=="number"?kn(I,T,M,D):I))),h!==void 0&&C!==void 0&&y&&!y.includes(C)&&(C=v,g&&(C=Ya(g,C))),(g&&g!==this.type||C!==void 0&&Wr(C)!==this.type)&&(C=Ya(this.type.kind,C)),C}eachChild(){}outputDefined(){return!1}serialize(){const n=["config",this.key];return this.scope&&n.concat(this.key),n}}function Ad(c){if(c instanceof us&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof Za||c instanceof Xa)return!1;let n=!0;return c.eachChild(a=>{n&&!Ad(a)&&(n=!1)}),n}function gf(c){if(c instanceof us&&c.name==="feature-state")return!1;let n=!0;return c.eachChild(a=>{n&&!gf(a)&&(n=!1)}),n}function yf(c){if(c instanceof $c)return new Set([c.key]);let n=new Set;return c.eachChild(a=>{n=new Set([...n,...yf(a)])}),n}function Id(c,n){if(c instanceof us&&n.indexOf(c.name)>=0)return!1;let a=!0;return c.eachChild(d=>{a&&!Id(d,n)&&(a=!1)}),a}class ar{constructor(n,a){this.type=a.type,this.name=n,this.boundExpression=a}static parse(n,a){if(n.length!==2||typeof n[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const d=n[1];return a.scope.has(d)?new ar(d,a.scope.get(d)):a.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Um{constructor(n,a=[],d,g=new Qh,h=[],y,T){this.registry=n,this.path=a,this.key=a.map(M=>typeof M=="string"?`['${M}']`:`[${M}]`).join(""),this.scope=g,this.errors=h,this.expectedType=d,this._scope=y,this.options=T}parse(n,a,d,g,h={}){return a||d?this.concat(a,null,d,g)._parse(n,h):this._parse(n,h)}parseObjectValue(n,a,d,g,h,y={}){return this.concat(a,d,g,h)._parse(n,y)}_parse(n,a){function d(g,h,y){return y==="assert"?new uo(h,[g]):y==="coerce"?new fa(h,[g]):g}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=typeof n[0]=="string"?this.registry[n[0]]:void 0;if(g){let h=g.parse(n,this);if(!h)return null;if(this.expectedType){const y=this.expectedType,T=h.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||T.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string"){if(this.checkSubtype(y,T))return null}else h=d(h,y,a.typeAnnotation||"coerce");else h=d(h,y,a.typeAnnotation||"assert")}if(!(h instanceof co)&&h.type.kind!=="resolvedImage"&&$m(h)){const y=new lx(this._scope,this.options);try{h=new co(h.type,h.evaluate(y))}catch(T){return this.error(T.message),null}}return h}return fa.parse(["to-array",n],this)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,a,d,g){let h=typeof n=="number"?this.path.concat(n):this.path;h=typeof a=="string"?h.concat(a):h;const y=g?this.scope.concat(g):this.scope;return new Um(this.registry,h,d||null,y,this.errors,this._scope,this.options)}error(n,...a){const d=`${this.key}${a.map(g=>`[${g}]`).join("")}`;this.errors.push(new jo(d,n))}checkSubtype(n,a){const d=Rc(n,a);return d&&this.error(d),d}}var vx=Um;function $m(c){if(c instanceof ar)return $m(c.boundExpression);if(c instanceof us&&c.name==="error"||c instanceof rf||c instanceof Za||c instanceof Xa||c instanceof $c)return!1;const n=c instanceof fa||c instanceof uo;let a=!0;return c.eachChild(d=>{a=n?a&&$m(d):a&&d instanceof co}),!!a&&Ad(c)&&Id(c,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function _f(c,n){const a=c.length-1;let d,g,h=0,y=a,T=0;for(;h<=y;)if(T=Math.floor((h+y)/2),d=c[T],g=c[T+1],d<=n){if(T===a||n<g)return T;h=T+1}else{if(!(d>n))throw new mi("Input is not a number.");y=T-1}return 0}class Dd{constructor(n,a,d){this.type=n,this.input=a,this.labels=[],this.outputs=[];for(const[g,h]of d)this.labels.push(g),this.outputs.push(h)}static parse(n,a){if(n.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return a.error("Expected an even number of arguments.");const d=a.parse(n[1],1,zt);if(!d)return null;const g=[];let h=null;a.expectedType&&a.expectedType.kind!=="value"&&(h=a.expectedType);for(let y=1;y<n.length;y+=2){const T=y===1?-1/0:n[y],M=n[y+1],D=y,v=y+1;if(typeof T!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(g.length&&g[g.length-1][0]>=T)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const C=a.parse(M,v,h);if(!C)return null;h=h||C.type,g.push([T,C])}return new Dd(h,d,g)}evaluate(n){const a=this.labels,d=this.outputs;if(a.length===1)return d[0].evaluate(n);const g=this.input.evaluate(n);if(g<=a[0])return d[0].evaluate(n);const h=a.length;return g>=a[h-1]?d[h-1].evaluate(n):d[_f(a,g)].evaluate(n)}eachChild(n){n(this.input);for(const a of this.outputs)n(a)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&n.push(this.labels[a]),n.push(this.outputs[a].serialize());return n}}const bx=.95047,wx=1.08883,Sx=4/29,Gc=6/29,Tx=3*Gc*Gc,aw=Gc*Gc*Gc,lw=Math.PI/180,cw=180/Math.PI;function Gm(c){return c>aw?Math.pow(c,1/3):c/Tx+Sx}function Wm(c){return c>Gc?c*c*c:Tx*(c-Sx)}function Hm(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function qm(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Ex(c){const n=qm(c.r),a=qm(c.g),d=qm(c.b),g=Gm((.4124564*n+.3575761*a+.1804375*d)/bx),h=Gm((.2126729*n+.7151522*a+.072175*d)/1);return{l:116*h-16,a:500*(g-h),b:200*(h-Gm((.0193339*n+.119192*a+.9503041*d)/wx)),alpha:c.a}}function Cx(c){let n=(c.l+16)/116,a=isNaN(c.a)?n:n+c.a/500,d=isNaN(c.b)?n:n-c.b/200;return n=1*Wm(n),a=bx*Wm(a),d=wx*Wm(d),new Yn(Hm(3.2404542*a-1.5371385*n-.4985314*d),Hm(-.969266*a+1.8760108*n+.041556*d),Hm(.0556434*a-.2040259*n+1.0572252*d),c.alpha)}function uw(c,n,a){const d=n-c;return c+a*(d>180||d<-180?d-360*Math.round(d/360):d)}const Rd={forward:Ex,reverse:Cx,interpolate:function(c,n,a){return{l:Xt(c.l,n.l,a),a:Xt(c.a,n.a,a),b:Xt(c.b,n.b,a),alpha:Xt(c.alpha,n.alpha,a)}}},kd={forward:function(c){const{l:n,a,b:d}=Ex(c),g=Math.atan2(d,a)*cw;return{h:g<0?g+360:g,c:Math.sqrt(a*a+d*d),l:n,alpha:c.a}},reverse:function(c){const n=c.h*lw,a=c.c;return Cx({l:c.l,a:Math.cos(n)*a,b:Math.sin(n)*a,alpha:c.alpha})},interpolate:function(c,n,a){return{h:uw(c.h,n.h,a),c:Xt(c.c,n.c,a),l:Xt(c.l,n.l,a),alpha:Xt(c.alpha,n.alpha,a)}}};var Px=Object.freeze({__proto__:null,hcl:kd,lab:Rd});class As{constructor(n,a,d,g,h){this.type=n,this.operator=a,this.interpolation=d,this.input=g,this.labels=[],this.outputs=[];for(const[y,T]of h)this.labels.push(y),this.outputs.push(T)}static interpolationFactor(n,a,d,g){let h=0;if(n.name==="exponential")h=Zm(a,n.base,d,g);else if(n.name==="linear")h=Zm(a,1,d,g);else if(n.name==="cubic-bezier"){const y=n.controlPoints;h=new Qr(y[0],y[1],y[2],y[3]).solve(Zm(a,1,d,g))}return h}static parse(n,a){let[d,g,h,...y]=n;if(!Array.isArray(g)||g.length===0)return a.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const D=g[1];if(typeof D!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:D}}else{if(g[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const D=g.slice(1);if(D.length!==4||D.some(v=>typeof v!="number"||v<0||v>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:D}}}if(n.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(h=a.parse(h,2,zt),!h)return null;const T=[];let M=null;d==="interpolate-hcl"||d==="interpolate-lab"?M=cs:a.expectedType&&a.expectedType.kind!=="value"&&(M=a.expectedType);for(let D=0;D<y.length;D+=2){const v=y[D],C=y[D+1],I=D+3,P=D+4;if(typeof v!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(T.length&&T[T.length-1][0]>=v)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const A=a.parse(C,P,M);if(!A)return null;M=M||A.type,T.push([v,A])}return M.kind==="number"||M.kind==="color"||M.kind==="array"&&M.itemType.kind==="number"&&typeof M.N=="number"?new As(M,d,g,h,T):a.error(`Type ${Or(M)} is not interpolatable.`)}evaluate(n){const a=this.labels,d=this.outputs;if(a.length===1)return d[0].evaluate(n);const g=this.input.evaluate(n);if(g<=a[0])return d[0].evaluate(n);const h=a.length;if(g>=a[h-1])return d[h-1].evaluate(n);const y=_f(a,g),T=As.interpolationFactor(this.interpolation,g,a[y],a[y+1]),M=d[y].evaluate(n),D=d[y+1].evaluate(n);return this.operator==="interpolate"?Ml[this.type.kind.toLowerCase()](M,D,T):this.operator==="interpolate-hcl"?kd.reverse(kd.interpolate(kd.forward(M),kd.forward(D),T)):Rd.reverse(Rd.interpolate(Rd.forward(M),Rd.forward(D),T))}eachChild(n){n(this.input);for(const a of this.outputs)n(a)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const a=[this.operator,n,this.input.serialize()];for(let d=0;d<this.labels.length;d++)a.push(this.labels[d],this.outputs[d].serialize());return a}}function Zm(c,n,a,d){const g=d-a,h=c-a;return g===0?0:n===1?h/g:(Math.pow(n,h)-1)/(Math.pow(n,g)-1)}class xf{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expectected at least one argument.");let d=null;const g=a.expectedType;g&&g.kind!=="value"&&(d=g);const h=[];for(const T of n.slice(1)){const M=a.parse(T,1+h.length,d,void 0,{typeAnnotation:"omit"});if(!M)return null;d=d||M.type,h.push(M)}const y=g&&h.some(T=>Rc(g,T.type));return new xf(y?On:d,h)}evaluate(n){let a,d=null,g=0;for(const h of this.args){if(g++,d=h.evaluate(n),d&&d instanceof Yi&&!d.available&&(a||(a=d),d=null,g===this.args.length))return a;if(d!==null)break}return d}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(a=>{n.push(a.serialize())}),n}}class vf{constructor(n,a){this.type=a.type,this.bindings=[].concat(n),this.result=a}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const a of this.bindings)n(a[1]);n(this.result)}static parse(n,a){if(n.length<4)return a.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const d=[];for(let h=1;h<n.length-1;h+=2){const y=n[h];if(typeof y!="string")return a.error(`Expected string, but found ${typeof y} instead.`,h);if(/[^a-zA-Z0-9_]/.test(y))return a.error("Variable names must contain only alphanumeric characters or '_'.",h);const T=a.parse(n[h+1],h+1);if(!T)return null;d.push([y,T])}const g=a.parse(n[n.length-1],n.length-1,a.expectedType,d);return g?new vf(d,g):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[a,d]of this.bindings)n.push(a,d.serialize());return n.push(this.result.serialize()),n}}class Xm{constructor(n,a,d){this.type=n,this.index=a,this.input=d}static parse(n,a){if(n.length!==3)return a.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const d=a.parse(n[1],1,zt),g=a.parse(n[2],2,Xi(a.expectedType||On));return d&&g?new Xm(g.type.itemType,d,g):null}evaluate(n){const a=this.index.evaluate(n),d=this.input.evaluate(n);if(a<0)throw new mi(`Array index out of bounds: ${a} < 0.`);if(a>=d.length)throw new mi(`Array index out of bounds: ${a} > ${d.length-1}.`);if(a!==Math.floor(a))throw new mi(`Array index must be an integer, but found ${a} instead.`);return d[a]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ym{constructor(n,a){this.type=Rn,this.needle=n,this.haystack=a}static parse(n,a){if(n.length!==3)return a.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const d=a.parse(n[1],1,On),g=a.parse(n[2],2,On);return d&&g?kc(d.type,[Rn,Dn,zt,lo,On])?new Ym(d,g):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Or(d.type)} instead`):null}evaluate(n){const a=this.needle.evaluate(n),d=this.haystack.evaluate(n);if(d==null)return!1;if(!zo(a,["boolean","string","number","null"]))throw new mi(`Expected first argument to be of type boolean, string, number or null, but found ${Or(Wr(a))} instead.`);if(!zo(d,["string","array"]))throw new mi(`Expected second argument to be of type array or string, but found ${Or(Wr(d))} instead.`);return d.indexOf(a)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class bf{constructor(n,a,d){this.type=zt,this.needle=n,this.haystack=a,this.fromIndex=d}static parse(n,a){if(n.length<=2||n.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const d=a.parse(n[1],1,On),g=a.parse(n[2],2,On);if(!d||!g)return null;if(!kc(d.type,[Rn,Dn,zt,lo,On]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Or(d.type)} instead`);if(n.length===4){const h=a.parse(n[3],3,zt);return h?new bf(d,g,h):null}return new bf(d,g)}evaluate(n){const a=this.needle.evaluate(n),d=this.haystack.evaluate(n);if(!zo(a,["boolean","string","number","null"]))throw new mi(`Expected first argument to be of type boolean, string, number or null, but found ${Or(Wr(a))} instead.`);if(!zo(d,["string","array"]))throw new mi(`Expected second argument to be of type array or string, but found ${Or(Wr(d))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(n);return d.indexOf(a,g)}return d.indexOf(a)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Km{constructor(n,a,d,g,h,y){this.inputType=n,this.type=a,this.input=d,this.cases=g,this.outputs=h,this.otherwise=y}static parse(n,a){if(n.length<5)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return a.error("Expected an even number of arguments.");let d,g;a.expectedType&&a.expectedType.kind!=="value"&&(g=a.expectedType);const h={},y=[];for(let D=2;D<n.length-1;D+=2){let v=n[D];const C=n[D+1];Array.isArray(v)||(v=[v]);const I=a.concat(D);if(v.length===0)return I.error("Expected at least one branch label.");for(const A of v){if(typeof A!="number"&&typeof A!="string")return I.error("Branch labels must be numbers or strings.");if(typeof A=="number"&&Math.abs(A)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof A=="number"&&Math.floor(A)!==A)return I.error("Numeric branch labels must be integer values.");if(d){if(I.checkSubtype(d,Wr(A)))return null}else d=Wr(A);if(h[String(A)]!==void 0)return I.error("Branch labels must be unique.");h[String(A)]=y.length}const P=a.parse(C,D,g);if(!P)return null;g=g||P.type,y.push(P)}const T=a.parse(n[1],1,On);if(!T)return null;const M=a.parse(n[n.length-1],n.length-1,g);return M?T.type.kind!=="value"&&a.concat(1).checkSubtype(d,T.type)?null:new Km(d,g,T,h,y,M):null}evaluate(n){const a=this.input.evaluate(n);return(Wr(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),d=[],g={};for(const y of a){const T=g[this.cases[y]];T===void 0?(g[this.cases[y]]=d.length,d.push([this.cases[y],[y]])):d[T][1].push(y)}const h=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,T]of d)n.push(T.length===1?h(T[0]):T.map(h)),n.push(this.outputs[y].serialize());return n.push(this.otherwise.serialize()),n}}class Nd{constructor(n,a,d){this.type=n,this.branches=a,this.otherwise=d}static parse(n,a){if(n.length<4)return a.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return a.error("Expected an odd number of arguments.");let d;a.expectedType&&a.expectedType.kind!=="value"&&(d=a.expectedType);const g=[];for(let y=1;y<n.length-1;y+=2){const T=a.parse(n[y],y,Rn);if(!T)return null;const M=a.parse(n[y+1],y+1,d);if(!M)return null;g.push([T,M]),d=d||M.type}const h=a.parse(n[n.length-1],n.length-1,d);return h?new Nd(d,g,h):null}evaluate(n){for(const[a,d]of this.branches)if(a.evaluate(n))return d.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[a,d]of this.branches)n(a),n(d);n(this.otherwise)}outputDefined(){return this.branches.every(([n,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(a=>{n.push(a.serialize())}),n}}class wf{constructor(n,a,d,g){this.type=n,this.input=a,this.beginIndex=d,this.endIndex=g}static parse(n,a){if(n.length<=2||n.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const d=a.parse(n[1],1,On),g=a.parse(n[2],2,zt);if(!d||!g)return null;if(!kc(d.type,[Xi(On),Dn,On]))return a.error(`Expected first argument to be of type array or string, but found ${Or(d.type)} instead`);if(n.length===4){const h=a.parse(n[3],3,zt);return h?new wf(d.type,d,g,h):null}return new wf(d.type,d,g)}evaluate(n){const a=this.input.evaluate(n),d=this.beginIndex.evaluate(n);if(!zo(a,["string","array"]))throw new mi(`Expected first argument to be of type array or string, but found ${Or(Wr(a))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(n);return a.slice(d,g)}return a.slice(d)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Jm(c,n){return c==="=="||c==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function Mx(c,n,a,d){return d.compare(n,a)===0}function Wc(c,n,a){const d=c!=="=="&&c!=="!=";return class GV{constructor(h,y,T){this.type=Rn,this.lhs=h,this.rhs=y,this.collator=T,this.hasUntypedArgument=h.type.kind==="value"||y.type.kind==="value"}static parse(h,y){if(h.length!==3&&h.length!==4)return y.error("Expected two or three arguments.");const T=h[0];let M=y.parse(h[1],1,On);if(!M)return null;if(!Jm(T,M.type))return y.concat(1).error(`"${T}" comparisons are not supported for type '${Or(M.type)}'.`);let D=y.parse(h[2],2,On);if(!D)return null;if(!Jm(T,D.type))return y.concat(2).error(`"${T}" comparisons are not supported for type '${Or(D.type)}'.`);if(M.type.kind!==D.type.kind&&M.type.kind!=="value"&&D.type.kind!=="value")return y.error(`Cannot compare types '${Or(M.type)}' and '${Or(D.type)}'.`);d&&(M.type.kind==="value"&&D.type.kind!=="value"?M=new uo(D.type,[M]):M.type.kind!=="value"&&D.type.kind==="value"&&(D=new uo(M.type,[D])));let v=null;if(h.length===4){if(M.type.kind!=="string"&&D.type.kind!=="string"&&M.type.kind!=="value"&&D.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(v=y.parse(h[3],3,ef),!v)return null}return new GV(M,D,v)}evaluate(h){const y=this.lhs.evaluate(h),T=this.rhs.evaluate(h);if(d&&this.hasUntypedArgument){const M=Wr(y),D=Wr(T);if(M.kind!==D.kind||M.kind!=="string"&&M.kind!=="number")throw new mi(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${M.kind}, ${D.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const M=Wr(y),D=Wr(T);if(M.kind!=="string"||D.kind!=="string")return n(h,y,T)}return this.collator?a(h,y,T,this.collator.evaluate(h)):n(h,y,T)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[c];return this.eachChild(y=>{h.push(y.serialize())}),h}}}const dw=Wc("==",function(c,n,a){return n===a},Mx),Ax=Wc("!=",function(c,n,a){return n!==a},function(c,n,a,d){return!Mx(0,n,a,d)}),Ix=Wc("<",function(c,n,a){return n<a},function(c,n,a,d){return d.compare(n,a)<0}),Hc=Wc(">",function(c,n,a){return n>a},function(c,n,a,d){return d.compare(n,a)>0}),Dx=Wc("<=",function(c,n,a){return n<=a},function(c,n,a,d){return d.compare(n,a)<=0}),Rx=Wc(">=",function(c,n,a){return n>=a},function(c,n,a,d){return d.compare(n,a)>=0});class Qm{constructor(n,a,d,g,h,y){this.type=Dn,this.number=n,this.locale=a,this.currency=d,this.unit=g,this.minFractionDigits=h,this.maxFractionDigits=y}static parse(n,a){if(n.length!==3)return a.error("Expected two arguments.");const d=a.parse(n[1],1,zt);if(!d)return null;const g=n[2];if(typeof g!="object"||Array.isArray(g))return a.error("NumberFormat options argument must be an object.");let h=null;if(g.locale&&(h=a.parseObjectValue(g.locale,2,"locale",Dn),!h))return null;let y=null;if(g.currency&&(y=a.parseObjectValue(g.currency,2,"currency",Dn),!y))return null;let T=null;if(g.unit&&(T=a.parseObjectValue(g.unit,2,"unit",Dn),!T))return null;let M=null;if(g["min-fraction-digits"]&&(M=a.parseObjectValue(g["min-fraction-digits"],2,"min-fraction-digits",zt),!M))return null;let D=null;return g["max-fraction-digits"]&&(D=a.parseObjectValue(g["max-fraction-digits"],2,"max-fraction-digits",zt),!D)?null:new Qm(d,h,y,T,M,D)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(n):void 0,unit:this.unit?this.unit.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.unit&&n(this.unit),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.unit&&(n.unit=this.unit.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class Ld{constructor(n){this.type=zt,this.input=n}static parse(n,a){if(n.length!==2)return a.error(`Expected 1 argument, but found ${n.length-1} instead.`);const d=a.parse(n[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${Or(d.type)} instead.`):new Ld(d):null}evaluate(n){const a=this.input.evaluate(n);if(typeof a=="string"||Array.isArray(a))return a.length;throw new mi(`Expected value to be of type string or array, but found ${Or(Wr(a))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(a=>{n.push(a.serialize())}),n}}function Sf(c){return function(){c=1831565813+(c|=0)|0;let n=Math.imul(c^c>>>15,1|c);return n=n+Math.imul(n^n>>>7,61|n)^n,((n^n>>>14)>>>0)/4294967296}}const qc={"==":dw,"!=":Ax,">":Hc,"<":Ix,">=":Rx,"<=":Dx,array:uo,at:Xm,boolean:uo,case:Nd,coalesce:xf,collator:rf,format:Nc,image:Al,in:Ym,"index-of":bf,interpolate:As,"interpolate-hcl":As,"interpolate-lab":As,length:Ld,let:vf,literal:co,match:Km,number:uo,"number-format":Qm,object:uo,slice:wf,step:Dd,string:uo,"to-boolean":fa,"to-color":fa,"to-number":fa,"to-string":fa,var:ar,within:Za,distance:Xa,config:$c};function kx(c,[n,a,d,g]){n=n.evaluate(c),a=a.evaluate(c),d=d.evaluate(c);const h=g?g.evaluate(c):1,y=ax(n,a,d,h);if(y)throw new mi(y);return new Yn(n/255*h,a/255*h,d/255*h,h)}function eg(c,[n,a,d,g]){n=n.evaluate(c),a=a.evaluate(c),d=d.evaluate(c);const h=g?g.evaluate(c):1,y=function(D,v,C,I){return typeof D=="number"&&D>=0&&D<=360?typeof v=="number"&&v>=0&&v<=100&&typeof C=="number"&&C>=0&&C<=100?I===void 0||typeof I=="number"&&I>=0&&I<=1?null:`Invalid hsla value [${[D,v,C,I].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof I=="number"?[D,v,C,I]:[D,v,C]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof I=="number"?[D,v,C,I]:[D,v,C]).join(", ")}]: 'h' must be between 0 and 360.`}(n,a,d,h);if(y)throw new mi(y);const T=`hsla(${n}, ${a}%, ${d}%, ${h})`,M=Yn.parse(T);if(!M)throw new mi(`Failed to parse HSLA color: ${T}`);return M}function tg(c,n){return c in n}function ng(c,n){const a=n[c];return a===void 0?null:a}function kl(c){return{type:c}}function Nx(c){return{result:"success",value:c}}function Ka(c){return{result:"error",value:c}}function rg(c,n){return!!c&&!!c.parameters&&c.parameters.indexOf(n)>-1}function Tf(c){return c["property-type"]==="data-driven"}function ig(c){return rg(c.expression,"measure-light")}function Lx(c){return rg(c.expression,"zoom")}function sg(c){return!!c.expression&&c.expression.interpolated}function Ef(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function Ox(c){return c}function jx(c,n){const a=n.type==="color",d=c.stops&&typeof c.stops[0][0]=="object",g=d||!(d||c.property!==void 0),h=c.type||(sg(n)?"exponential":"interval");if(a&&((c=Ac({},c)).stops&&(c.stops=c.stops.map(D=>[D[0],Yn.parse(D[1])])),c.default=Yn.parse(c.default?c.default:n.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!Px[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let y,T,M;if(h==="exponential")y=Fx;else if(h==="interval")y=zx;else if(h==="categorical"){y=hw,T=Object.create(null);for(const D of c.stops)T[D[0]]=D[1];M=typeof c.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);y=fw}if(d){const D={},v=[];for(let P=0;P<c.stops.length;P++){const A=c.stops[P],N=A[0].zoom;D[N]===void 0&&(D[N]={zoom:N,type:c.type,property:c.property,default:c.default,stops:[]},v.push(N)),D[N].stops.push([A[0].value,A[1]])}const C=[];for(const P of v)C.push([D[P].zoom,jx(D[P],n)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:As.interpolationFactor.bind(void 0,I),zoomStops:C.map(P=>P[0]),evaluate:({zoom:P},A)=>Fx({stops:C,base:c.base},n,P).evaluate(P,A)}}if(g){const D=h==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:As.interpolationFactor.bind(void 0,D),zoomStops:c.stops.map(v=>v[0]),evaluate:({zoom:v})=>y(c,n,v,T,M)}}return{kind:"source",evaluate(D,v){const C=v&&v.properties?v.properties[c.property]:void 0;return C===void 0?Od(c.default,n.default):y(c,n,C,T,M)}}}function Od(c,n,a){return c!==void 0?c:n!==void 0?n:a!==void 0?a:void 0}function hw(c,n,a,d,g){return Od(typeof a===g?d[a]:void 0,c.default,n.default)}function zx(c,n,a){if(Il(a)!=="number")return Od(c.default,n.default);const d=c.stops.length;if(d===1||a<=c.stops[0][0])return c.stops[0][1];if(a>=c.stops[d-1][0])return c.stops[d-1][1];const g=_f(c.stops.map(h=>h[0]),a);return c.stops[g][1]}function Fx(c,n,a){const d=c.base!==void 0?c.base:1;if(Il(a)!=="number")return Od(c.default,n.default);const g=c.stops.length;if(g===1||a<=c.stops[0][0])return c.stops[0][1];if(a>=c.stops[g-1][0])return c.stops[g-1][1];const h=_f(c.stops.map(v=>v[0]),a),y=function(v,C,I,P){const A=P-I,N=v-I;return A===0?0:C===1?N/A:(Math.pow(C,N)-1)/(Math.pow(C,A)-1)}(a,d,c.stops[h][0],c.stops[h+1][0]),T=c.stops[h][1],M=c.stops[h+1][1];let D=Ml[n.type]||Ox;if(c.colorSpace&&c.colorSpace!=="rgb"){const v=Px[c.colorSpace];D=(C,I)=>v.reverse(v.interpolate(v.forward(C),v.forward(I),y))}return typeof T.evaluate=="function"?{evaluate(...v){const C=T.evaluate.apply(void 0,v),I=M.evaluate.apply(void 0,v);if(C!==void 0&&I!==void 0)return D(C,I,y)}}:D(T,M,y)}function fw(c,n,a){return n.type==="color"?a=Yn.parse(a):n.type==="formatted"?a=Ui.fromString(a.toString()):n.type==="resolvedImage"?a=Yi.fromString(a.toString()):Il(a)===n.type||n.type==="enum"&&n.values[a]||(a=void 0),Od(a,c.default,n.default)}us.register(qc,{error:[{kind:"error"},[Dn],(c,[n])=>{throw new mi(n.evaluate(c))}],typeof:[Dn,[On],(c,[n])=>Or(Wr(n.evaluate(c)))],"to-rgba":[Xi(zt,4),[cs],(c,[n])=>n.evaluate(c).toRenderColor(null).toArray()],rgb:[cs,[zt,zt,zt],kx],rgba:[cs,[zt,zt,zt,zt],kx],hsl:[cs,[zt,zt,zt],eg],hsla:[cs,[zt,zt,zt,zt],eg],has:{type:Rn,overloads:[[[Dn],(c,[n])=>tg(n.evaluate(c),c.properties())],[[Dn,Vi],(c,[n,a])=>tg(n.evaluate(c),a.evaluate(c))]]},get:{type:On,overloads:[[[Dn],(c,[n])=>ng(n.evaluate(c),c.properties())],[[Dn,Vi],(c,[n,a])=>ng(n.evaluate(c),a.evaluate(c))]]},"feature-state":[On,[Dn],(c,[n])=>ng(n.evaluate(c),c.featureState||{})],properties:[Vi,[],c=>c.properties()],"geometry-type":[Dn,[],c=>c.geometryType()],id:[On,[],c=>c.id()],zoom:[zt,[],c=>c.globals.zoom],pitch:[zt,[],c=>c.globals.pitch||0],"distance-from-center":[zt,[],c=>c.distanceFromCenter()],"measure-light":[zt,[Dn],(c,[n])=>c.measureLight(n.evaluate(c))],"heatmap-density":[zt,[],c=>c.globals.heatmapDensity||0],"line-progress":[zt,[],c=>c.globals.lineProgress||0],"raster-value":[zt,[],c=>c.globals.rasterValue||0],"raster-particle-speed":[zt,[],c=>c.globals.rasterParticleSpeed||0],"sky-radial-progress":[zt,[],c=>c.globals.skyRadialProgress||0],accumulated:[On,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[zt,kl(zt),(c,n)=>{let a=0;for(const d of n)a+=d.evaluate(c);return a}],"*":[zt,kl(zt),(c,n)=>{let a=1;for(const d of n)a*=d.evaluate(c);return a}],"-":{type:zt,overloads:[[[zt,zt],(c,[n,a])=>n.evaluate(c)-a.evaluate(c)],[[zt],(c,[n])=>-n.evaluate(c)]]},"/":[zt,[zt,zt],(c,[n,a])=>n.evaluate(c)/a.evaluate(c)],"%":[zt,[zt,zt],(c,[n,a])=>n.evaluate(c)%a.evaluate(c)],ln2:[zt,[],()=>Math.LN2],pi:[zt,[],()=>Math.PI],e:[zt,[],()=>Math.E],"^":[zt,[zt,zt],(c,[n,a])=>Math.pow(n.evaluate(c),a.evaluate(c))],sqrt:[zt,[zt],(c,[n])=>Math.sqrt(n.evaluate(c))],log10:[zt,[zt],(c,[n])=>Math.log(n.evaluate(c))/Math.LN10],ln:[zt,[zt],(c,[n])=>Math.log(n.evaluate(c))],log2:[zt,[zt],(c,[n])=>Math.log(n.evaluate(c))/Math.LN2],sin:[zt,[zt],(c,[n])=>Math.sin(n.evaluate(c))],cos:[zt,[zt],(c,[n])=>Math.cos(n.evaluate(c))],tan:[zt,[zt],(c,[n])=>Math.tan(n.evaluate(c))],asin:[zt,[zt],(c,[n])=>Math.asin(n.evaluate(c))],acos:[zt,[zt],(c,[n])=>Math.acos(n.evaluate(c))],atan:[zt,[zt],(c,[n])=>Math.atan(n.evaluate(c))],min:[zt,kl(zt),(c,n)=>Math.min(...n.map(a=>a.evaluate(c)))],max:[zt,kl(zt),(c,n)=>Math.max(...n.map(a=>a.evaluate(c)))],abs:[zt,[zt],(c,[n])=>Math.abs(n.evaluate(c))],round:[zt,[zt],(c,[n])=>{const a=n.evaluate(c);return a<0?-Math.round(-a):Math.round(a)}],floor:[zt,[zt],(c,[n])=>Math.floor(n.evaluate(c))],ceil:[zt,[zt],(c,[n])=>Math.ceil(n.evaluate(c))],"filter-==":[Rn,[Dn,On],(c,[n,a])=>c.properties()[n.value]===a.value],"filter-id-==":[Rn,[On],(c,[n])=>c.id()===n.value],"filter-type-==":[Rn,[Dn],(c,[n])=>c.geometryType()===n.value],"filter-<":[Rn,[Dn,On],(c,[n,a])=>{const d=c.properties()[n.value],g=a.value;return typeof d==typeof g&&d<g}],"filter-id-<":[Rn,[On],(c,[n])=>{const a=c.id(),d=n.value;return typeof a==typeof d&&a<d}],"filter->":[Rn,[Dn,On],(c,[n,a])=>{const d=c.properties()[n.value],g=a.value;return typeof d==typeof g&&d>g}],"filter-id->":[Rn,[On],(c,[n])=>{const a=c.id(),d=n.value;return typeof a==typeof d&&a>d}],"filter-<=":[Rn,[Dn,On],(c,[n,a])=>{const d=c.properties()[n.value],g=a.value;return typeof d==typeof g&&d<=g}],"filter-id-<=":[Rn,[On],(c,[n])=>{const a=c.id(),d=n.value;return typeof a==typeof d&&a<=d}],"filter->=":[Rn,[Dn,On],(c,[n,a])=>{const d=c.properties()[n.value],g=a.value;return typeof d==typeof g&&d>=g}],"filter-id->=":[Rn,[On],(c,[n])=>{const a=c.id(),d=n.value;return typeof a==typeof d&&a>=d}],"filter-has":[Rn,[On],(c,[n])=>n.value in c.properties()],"filter-has-id":[Rn,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Rn,[Xi(Dn)],(c,[n])=>n.value.indexOf(c.geometryType())>=0],"filter-id-in":[Rn,[Xi(On)],(c,[n])=>n.value.indexOf(c.id())>=0],"filter-in-small":[Rn,[Dn,Xi(On)],(c,[n,a])=>a.value.indexOf(c.properties()[n.value])>=0],"filter-in-large":[Rn,[Dn,Xi(On)],(c,[n,a])=>function(d,g,h,y){for(;h<=y;){const T=h+y>>1;if(g[T]===d)return!0;g[T]>d?y=T-1:h=T+1}return!1}(c.properties()[n.value],a.value,0,a.value.length-1)],all:{type:Rn,overloads:[[[Rn,Rn],(c,[n,a])=>n.evaluate(c)&&a.evaluate(c)],[kl(Rn),(c,n)=>{for(const a of n)if(!a.evaluate(c))return!1;return!0}]]},any:{type:Rn,overloads:[[[Rn,Rn],(c,[n,a])=>n.evaluate(c)||a.evaluate(c)],[kl(Rn),(c,n)=>{for(const a of n)if(a.evaluate(c))return!0;return!1}]]},"!":[Rn,[Rn],(c,[n])=>!n.evaluate(c)],"is-supported-script":[Rn,[Dn],(c,[n])=>{const a=c.globals&&c.globals.isSupportedScript;return!a||a(n.evaluate(c))}],upcase:[Dn,[Dn],(c,[n])=>n.evaluate(c).toUpperCase()],downcase:[Dn,[Dn],(c,[n])=>n.evaluate(c).toLowerCase()],concat:[Dn,kl(On),(c,n)=>n.map(a=>Ki(a.evaluate(c))).join("")],"resolved-locale":[Dn,[ef],(c,[n])=>n.evaluate(c).resolvedLocale()],random:[zt,[zt,zt,On],(c,n)=>{const[a,d,g]=n.map(y=>y.evaluate(c));if(a>d||a===d)return a;let h;if(typeof g=="string")h=function(y){let T=0;if(y.length===0)return T;for(let M=0;M<y.length;M++)T=(T<<5)-T+y.charCodeAt(M),T|=0;return T}(g);else{if(typeof g!="number")throw new mi(`Invalid seed input: ${g}`);h=g}return a+Sf(h)()*(d-a)}]});class Cf{constructor(n,a,d,g){this.expression=n,this._warningHistory={},this._evaluator=new lx(d,g),this._defaultValue=a?function(h){return h.type==="color"&&(Ef(h.default)||Array.isArray(h.default))?new Yn(0,0,0,0):h.type==="color"?Yn.parse(h.default)||null:h.default===void 0?null:h.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null}evaluateWithoutErrorHandling(n,a,d,g,h,y,T,M){return this._evaluator.globals=n,this._evaluator.feature=a,this._evaluator.featureState=d,this._evaluator.canonical=g||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=M||null,this.expression.evaluate(this._evaluator)}evaluate(n,a,d,g,h,y,T,M){this._evaluator.globals=n,this._evaluator.feature=a||null,this._evaluator.featureState=d||null,this._evaluator.canonical=g||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=M||null;try{const D=this.expression.evaluate(this._evaluator);if(D==null||typeof D=="number"&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new mi(`Expected value to be one of ${Object.keys(this._enumValues).map(v=>JSON.stringify(v)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${D.message}`)),this._defaultValue}}}function Pf(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in qc}function jd(c,n,a,d){const g=new vx(qc,[],n?function(y){const T={color:cs,string:Dn,number:zt,enum:Dn,boolean:Rn,formatted:Ic,resolvedImage:Dc};return y.type==="array"?Xi(T[y.value]||On,y.length):T[y.type]}(n):void 0,void 0,void 0,a,d),h=g.parse(c,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Nx(new Cf(h,n,a,d)):Ka(g.errors)}class og{constructor(n,a,d){this.kind=n,this._styleExpression=a,this.isLightConstant=d,this.isStateDependent=n!=="constant"&&!gf(a.expression),this.configDependencies=yf(a.expression)}evaluateWithoutErrorHandling(n,a,d,g,h,y){return this._styleExpression.evaluateWithoutErrorHandling(n,a,d,g,h,y)}evaluate(n,a,d,g,h,y){return this._styleExpression.evaluate(n,a,d,g,h,y)}}class Fo{constructor(n,a,d,g,h){this.kind=n,this.zoomStops=d,this._styleExpression=a,this.isStateDependent=n!=="camera"&&!gf(a.expression),this.isLightConstant=h,this.configDependencies=yf(a.expression),this.interpolationType=g}evaluateWithoutErrorHandling(n,a,d,g,h,y){return this._styleExpression.evaluateWithoutErrorHandling(n,a,d,g,h,y)}evaluate(n,a,d,g,h,y){return this._styleExpression.evaluate(n,a,d,g,h,y)}interpolationFactor(n,a,d){return this.interpolationType?As.interpolationFactor(this.interpolationType,n,a,d):0}}function Bx(c,n,a,d){if((c=jd(c,n,a,d)).result==="error")return c;const g=c.value.expression,h=Ad(g);if(!h&&!Tf(n))return Ka([new jo("","data expressions not supported")]);const y=Id(g,["zoom","pitch","distance-from-center"]);if(!y&&!Lx(n))return Ka([new jo("","zoom expressions not supported")]);const T=Id(g,["measure-light"]);if(!T&&!ig(n))return Ka([new jo("","measure-light expression not supported")]);const M=n.expression&&n.expression.relaxZoomRestriction,D=Af(g);return D||y||M?D instanceof jo?Ka([D]):D instanceof As&&!sg(n)?Ka([new jo("",'"interpolate" expressions cannot be used with this property')]):Nx(D?new Fo(h?"camera":"composite",c.value,D.labels,D instanceof As?D.interpolation:void 0,T):new og(h?"constant":"source",c.value,T)):Ka([new jo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Mf{constructor(n,a){this._parameters=n,this._specification=a,Ac(this,jx(this._parameters,this._specification))}static deserialize(n){return new Mf(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Af(c){let n=null;if(c instanceof vf)n=Af(c.result);else if(c instanceof xf){for(const a of c.args)if(n=Af(a),n)break}else(c instanceof Dd||c instanceof As)&&c.input instanceof us&&c.input.name==="zoom"&&(n=c);return n instanceof jo||c.eachChild(a=>{const d=Af(a);d instanceof jo?n=d:n&&d&&n!==d&&(n=new jo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}var If,ag,Vx=function(){if(ag)return If;ag=1,If=n;var c=3;function n(a,d,g){var h=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var y=new Int32Array(this.arrayBuffer);a=y[0],this.d=(d=y[1])+2*(g=y[2]);for(var T=0;T<this.d*this.d;T++){var M=y[c+T],D=y[c+T+1];h.push(M===D?null:y.subarray(M,D))}var v=y[c+h.length+1];this.keys=y.subarray(y[c+h.length],v),this.bboxes=y.subarray(v),this.insert=this._insertReadonly}else{this.d=d+2*g;for(var C=0;C<this.d*this.d;C++)h.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=a,this.padding=g,this.scale=d/a,this.uid=0;var I=g/d*a;this.min=-I,this.max=a+I}return n.prototype.insert=function(a,d,g,h,y){this._forEachCell(d,g,h,y,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(h),this.bboxes.push(y)},n.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},n.prototype._insertCell=function(a,d,g,h,y,T){this.cells[y].push(T)},n.prototype.query=function(a,d,g,h,y){var T=this.min,M=this.max;if(a<=T&&d<=T&&M<=g&&M<=h&&!y)return Array.prototype.slice.call(this.keys);var D=[];return this._forEachCell(a,d,g,h,this._queryCell,D,{},y),D},n.prototype._queryCell=function(a,d,g,h,y,T,M,D){var v=this.cells[y];if(v!==null)for(var C=this.keys,I=this.bboxes,P=0;P<v.length;P++){var A=v[P];if(M[A]===void 0){var N=4*A;(D?D(I[N+0],I[N+1],I[N+2],I[N+3]):a<=I[N+2]&&d<=I[N+3]&&g>=I[N+0]&&h>=I[N+1])?(M[A]=!0,T.push(C[A])):M[A]=!1}}},n.prototype._forEachCell=function(a,d,g,h,y,T,M,D){for(var v=this._convertToCellCoord(a),C=this._convertToCellCoord(d),I=this._convertToCellCoord(g),P=this._convertToCellCoord(h),A=v;A<=I;A++)for(var N=C;N<=P;N++){var j=this.d*N+A;if((!D||D(this._convertFromCellCoord(A),this._convertFromCellCoord(N),this._convertFromCellCoord(A+1),this._convertFromCellCoord(N+1)))&&y.call(this,a,d,g,h,j,T,M,D))return}},n.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},n.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},n.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,d=c+this.cells.length+1+1,g=0,h=0;h<this.cells.length;h++)g+=this.cells[h].length;var y=new Int32Array(d+g+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var T=d,M=0;M<a.length;M++){var D=a[M];y[c+M]=T,y.set(D,T),T+=D.length}return y[c+a.length]=T,y.set(this.keys,T),y[c+a.length+1]=T+=this.keys.length,y.set(this.bboxes,T),T+=this.bboxes.length,y.buffer},If}(),Nl=k(Vx);const Zc={};function Ot(c,n,a={}){Object.defineProperty(c,"_classRegistryKey",{value:n,writable:!1}),Zc[n]={klass:c,omit:a.omit||[]}}Ot(Object,"Object"),Nl.serialize=function(c,n){const a=c.toArrayBuffer();return n&&n.add(a),{buffer:a}},Nl.deserialize=function(c){return new Nl(c.buffer)},Object.defineProperty(Nl,"name",{value:"Grid"}),Ot(Nl,"Grid"),Ot(Yn,"Color"),Ot(Error,"Error"),Ot(Ui,"Formatted"),Ot(Es,"FormattedSection"),Ot(Em,"AJAXError"),Ot(Yi,"ResolvedImage"),Ot(Mf,"StylePropertyFunction"),Ot(Cf,"StyleExpression",{omit:["_evaluator"]}),Ot(Fo,"ZoomDependentExpression"),Ot(og,"ZoomConstantExpression"),Ot(us,"CompoundExpression",{omit:["_evaluate"]});for(const c in qc)Zc[qc[c]._classRegistryKey]||Ot(qc[c],`Expression${c}`);function lg(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function Ux(c){return self.ImageBitmap&&c instanceof ImageBitmap}function ds(c,n){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(lg(c)||Ux(c))return n&&n.add(c),c;if(ArrayBuffer.isView(c)){const a=c;return n&&n.add(a.buffer),a}if(c instanceof ImageData)return n&&n.add(c.data.buffer),c;if(Array.isArray(c)){const a=[];for(const d of c)a.push(ds(d,n));return a}if(c instanceof Map){const a={$name:"Map"};for(const[d,g]of c.entries())a[d]=ds(g);return a}if(c instanceof Set){const a={$name:"Set"};let d=0;for(const g of c.values())a[++d]=ds(g);return a}if(typeof c=="object"){const a=c.constructor,d=a._classRegistryKey;if(!d)throw new Error(`can't serialize object of unregistered class ${d}`);const g=a.serialize?a.serialize(c,n):{};if(!a.serialize){for(const h in c)c.hasOwnProperty(h)&&(Zc[d].omit.indexOf(h)>=0||(g[h]=ds(c[h],n)));c instanceof Error&&(g.message=c.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(g.$name=d),g}throw new Error("can't serialize object of type "+typeof c)}function Ll(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||lg(c)||Ux(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(Ll);if(typeof c=="object"){const n=c.$name||"Object";if(n==="Map"){const g=new Map;for(const h of Object.keys(c))h!=="$name"&&g.set(h,Ll(c[h]));return g}if(n==="Set"){const g=new Set;for(const h of Object.keys(c))h!=="$name"&&g.add(Ll(c[h]));return g}const{klass:a}=Zc[n];if(!a)throw new Error(`can't deserialize unregistered class ${n}`);if(a.deserialize)return a.deserialize(c);const d=Object.create(a.prototype);for(const g of Object.keys(c))g!=="$name"&&(d[g]=Ll(c[g]));return d}throw new Error("can't deserialize object of type "+typeof c)}const $t={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519,"CJK Unified Ideographs Extension B":c=>c>=131072&&c<=173791};function Df(c){for(const n of c)if(kf(n.charCodeAt(0)))return!0;return!1}function pw(c){for(const n of c)if(!Rf(n.charCodeAt(0)))return!1;return!0}function Rf(c){return!($t.Arabic(c)||$t["Arabic Supplement"](c)||$t["Arabic Extended-A"](c)||$t["Arabic Presentation Forms-A"](c)||$t["Arabic Presentation Forms-B"](c))}function kf(c){return!(c!==746&&c!==747&&(c<4352||!($t["Bopomofo Extended"](c)||$t.Bopomofo(c)||$t["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||$t["CJK Compatibility Ideographs"](c)||$t["CJK Compatibility"](c)||$t["CJK Radicals Supplement"](c)||$t["CJK Strokes"](c)||!(!$t["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||$t["CJK Unified Ideographs Extension A"](c)||$t["CJK Unified Ideographs"](c)||$t["Enclosed CJK Letters and Months"](c)||$t["Hangul Compatibility Jamo"](c)||$t["Hangul Jamo Extended-A"](c)||$t["Hangul Jamo Extended-B"](c)||$t["Hangul Jamo"](c)||$t["Hangul Syllables"](c)||$t.Hiragana(c)||$t["Ideographic Description Characters"](c)||$t.Kanbun(c)||$t["Kangxi Radicals"](c)||$t["Katakana Phonetic Extensions"](c)||$t.Katakana(c)&&c!==12540||!(!$t["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!$t["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||$t["Unified Canadian Aboriginal Syllabics"](c)||$t["Unified Canadian Aboriginal Syllabics Extended"](c)||$t["Vertical Forms"](c)||$t["Yijing Hexagram Symbols"](c)||$t["Yi Syllables"](c)||$t["Yi Radicals"](c))))}function zd(c){return!(kf(c)||function(n){return!!($t["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||$t["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||$t["Letterlike Symbols"](n)||$t["Number Forms"](n)||$t["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||$t["Control Pictures"](n)&&n!==9251||$t["Optical Character Recognition"](n)||$t["Enclosed Alphanumerics"](n)||$t["Geometric Shapes"](n)||$t["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||$t["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||$t["CJK Symbols and Punctuation"](n)||$t.Katakana(n)||$t["Private Use Area"](n)||$t["CJK Compatibility Forms"](n)||$t["Small Form Variants"](n)||$t["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(c))}function cg(c){return c>=1424&&c<=2303||$t["Arabic Presentation Forms-A"](c)||$t["Arabic Presentation Forms-B"](c)}function mw(c,n){return!(!n&&cg(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||$t.Khmer(c))}function gw(c){for(const n of c)if(cg(n.charCodeAt(0)))return!0;return!1}const Fd="deferred",Bd="loading",Nf="loaded";let Xc=null,bi="unavailable",Ja=null;const $x=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(bi="error"),Xc&&Xc(c)};function ug(){dg.fire(new Ha("pluginStateChange",{pluginStatus:bi,pluginURL:Ja}))}const dg=new Mc,hg=function(){return bi},fg=function(){if(bi!==Fd||!Ja)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");bi=Bd,ug(),Ja&&Cc({url:Ja},c=>{c?$x(c):(bi=Nf,ug())})},hs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>bi===Nf||hs.applyArabicShaping!=null,isLoading:()=>bi===Bd,setState(c){bi=c.pluginStatus,Ja=c.pluginURL},isParsed:()=>hs.applyArabicShaping!=null&&hs.processBidirectionalText!=null&&hs.processStyledBidirectionalText!=null,getPluginURL:()=>Ja};class kr{constructor(n,a){this.zoom=n,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(n){return function(a,d){for(const g of a)if(!mw(g.charCodeAt(0),d))return!1;return!0}(n,hs.isLoaded())}}class Lf{constructor(n,a,d,g){this.property=n,this.value=a,this.expression=function(h,y,T,M){if(Ef(h))return new Mf(h,y);if(Pf(h)||Array.isArray(h)&&h.length>0){const D=Bx(h,y,T,M);if(D.result==="error")throw new Error(D.value.map(v=>`${v.key}: ${v.message}`).join(", "));return D.value}{let D=h;return typeof h=="string"&&y.type==="color"&&(D=Yn.parse(h)),{kind:"constant",configDependencies:new Set,evaluate:()=>D}}}(a===void 0?n.specification.default:a,n.specification,d,g)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,a,d){return this.property.possiblyEvaluate(this,n,a,d)}}class pg{constructor(n,a,d){this.property=n,this.value=new Lf(n,void 0,a,d)}transitioned(n,a){return new Wx(this.property,this.value,a,Bi({},n.transition,this.transition),n.now)}untransitioned(){return new Wx(this.property,this.value,null,{},0)}}class Gx{constructor(n,a,d){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues),this._scope=a,this._options=d,this.configDependencies=new Set}getValue(n){return Bs(this._values[n].value.value)}setValue(n,a){this._values.hasOwnProperty(n)||(this._values[n]=new pg(this._values[n].property,this._scope,this._options)),this._values[n].value=new Lf(this._values[n].property,a===null?void 0:Bs(a),this._scope,this._options),this._values[n].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].value.expression.configDependencies]))}setTransitionOrValue(n,a){a&&(this._options=a);const d=this._properties.properties;if(n)for(const g in n){const h=n[g];if(da(g,"-transition")){const y=g.slice(0,-11);d[y]&&this.setTransition(y,h)}else d.hasOwnProperty(g)&&this.setValue(g,h)}}getTransition(n){return Bs(this._values[n].transition)}setTransition(n,a){this._values.hasOwnProperty(n)||(this._values[n]=new pg(this._values[n].property)),this._values[n].transition=Bs(a)||void 0}serialize(){const n={};for(const a of Object.keys(this._values)){const d=this.getValue(a);d!==void 0&&(n[a]=d);const g=this.getTransition(a);g!==void 0&&(n[`${a}-transition`]=g)}return n}transitioned(n,a){const d=new Hx(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].transitioned(n,a._values[g]);return d}untransitioned(){const n=new Hx(this._properties);for(const a of Object.keys(this._values))n._values[a]=this._values[a].untransitioned();return n}}class Wx{constructor(n,a,d,g,h){const y=g.delay||0,T=g.duration||0;h=h||0,this.property=n,this.value=a,this.begin=h+y,this.end=this.begin+T,n.specification.transition&&(g.delay||g.duration)&&(this.prior=d)}possiblyEvaluate(n,a,d){const g=n.now||0,h=this.value.possiblyEvaluate(n,a,d),y=this.prior;if(y){if(g>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(g<this.begin)return y.possiblyEvaluate(n,a,d);{const T=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(n,a,d),h,Sl(T))}}return h}}class Hx{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,a,d){const g=new Kc(this._properties);for(const h of Object.keys(this._values))g._values[h]=this._values[h].possiblyEvaluate(n,a,d);return g}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class yw{constructor(n,a,d){this._properties=n,this._values=Object.create(n.defaultPropertyValues),this._scope=a,this._options=d,this.configDependencies=new Set}getValue(n){return Bs(this._values[n].value)}setValue(n,a){this._values[n]=new Lf(this._values[n].property,a===null?void 0:Bs(a),this._scope,this._options),this._values[n].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].expression.configDependencies]))}serialize(){const n={};for(const a of Object.keys(this._values)){const d=this.getValue(a);d!==void 0&&(n[a]=d)}return n}possiblyEvaluate(n,a,d){const g=new Kc(this._properties);for(const h of Object.keys(this._values))g._values[h]=this._values[h].possiblyEvaluate(n,a,d);return g}}class Yc{constructor(n,a,d){this.property=n,this.value=a,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,a,d,g){return this.property.evaluate(this.value,this.parameters,n,a,d,g)}}class Kc{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class bt{constructor(n){this.specification=n}possiblyEvaluate(n,a){return n.expression.evaluate(a)}interpolate(n,a,d){const g=Ml[this.specification.type];return g?g(n,a,d):n}}class Gt{constructor(n,a){this.specification=n,this.overrides=a}possiblyEvaluate(n,a,d,g){return new Yc(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(a,null,{},d,g)}:n.expression,a)}interpolate(n,a,d){if(n.value.kind!=="constant"||a.value.kind!=="constant")return n;if(n.value.value===void 0||a.value.value===void 0)return new Yc(this,{kind:"constant",value:void 0},n.parameters);const g=Ml[this.specification.type];return g?new Yc(this,{kind:"constant",value:g(n.value.value,a.value.value,d)},n.parameters):n}evaluate(n,a,d,g,h,y){return n.kind==="constant"?n.value:n.evaluate(a,d,g,h,y)}}class ho{constructor(n){this.specification=n}possiblyEvaluate(n,a,d,g){return!!n.expression.evaluate(a,null,{},d,g)}interpolate(){return!1}}class Sr{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new kr(0,{});for(const d in n){const g=n[d];g.specification.overridable&&this.overridableProperties.push(d);const h=this.defaultPropertyValues[d]=new Lf(g,void 0),y=this.defaultTransitionablePropertyValues[d]=new pg(g);this.defaultTransitioningPropertyValues[d]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=h.possiblyEvaluate(a)}}}Ot(Gt,"DataDrivenProperty"),Ot(bt,"DataConstantProperty"),Ot(ho,"ColorRampProperty");var We=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Vd(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function Of(c){if(Array.isArray(c))return c.map(Of);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const n={};for(const a in c)n[a]=Of(c[a]);return n}return Vd(c)}function mg(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const n of c.slice(1))if(!mg(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function fo(c,n="",a=null,d="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};mg(c)||(c=jf(c));const g=c;let h=!0;try{h=function(C){if(!Jc(C))return C;let I=Of(C);return Ol(I),I=gg(I),I}(g)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(g,null,2)}
        `)}const y=We[`filter_${d}`],T=jd(h,y,n,a);let M=null;if(T.result==="error")throw new Error(T.value.map(C=>`${C.key}: ${C.message}`).join(", "));M=(C,I,P)=>T.value.evaluate(C,I,{},P);let D=null,v=null;if(h!==g){const C=jd(g,y,n,a);if(C.result==="error")throw new Error(C.value.map(I=>`${I.key}: ${I.message}`).join(", "));D=(I,P,A,N,j)=>C.value.evaluate(I,P,{},A,void 0,void 0,N,j),v=!Ad(C.value.expression)}return{filter:M,dynamicFilter:D||void 0,needGeometry:qx(h),needFeature:!!v}}function gg(c){if(!Array.isArray(c))return c;const n=function(a){if(_w.has(a[0])){for(let d=1;d<a.length;d++)if(Jc(a[d]))return!0}return a}(c);return n===!0?n:n.map(a=>gg(a))}function Ol(c){let n=!1;const a=[];if(c[0]==="case"){for(let d=1;d<c.length-1;d+=2)n=n||Jc(c[d]),a.push(c[d+1]);a.push(c[c.length-1])}else if(c[0]==="match"){n=n||Jc(c[1]);for(let d=2;d<c.length-1;d+=2)a.push(c[d+1]);a.push(c[c.length-1])}else if(c[0]==="step"){n=n||Jc(c[1]);for(let d=1;d<c.length-1;d+=2)a.push(c[d+1])}n&&(c.length=0,c.push("any",...a));for(let d=1;d<c.length;d++)Ol(c[d])}function Jc(c){if(!Array.isArray(c))return!1;if((n=c[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let a=1;a<c.length;a++)if(Jc(c[a]))return!0;return!1}const _w=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function xw(c,n){return c<n?-1:c>n?1:0}function qx(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let n=1;n<c.length;n++)if(qx(c[n]))return!0;return!1}function jf(c){if(!c)return!0;const n=c[0];return c.length<=1?n!=="any":n==="=="?zf(c[1],c[2],"=="):n==="!="?$d(zf(c[1],c[2],"==")):n==="<"||n===">"||n==="<="||n===">="?zf(c[1],c[2],n):n==="any"?(a=c.slice(1),["any"].concat(a.map(jf))):n==="all"?["all"].concat(c.slice(1).map(jf)):n==="none"?["all"].concat(c.slice(1).map(jf).map($d)):n==="in"?Ff(c[1],c.slice(2)):n==="!in"?$d(Ff(c[1],c.slice(2))):n==="has"?Ud(c[1]):n!=="!has"||$d(Ud(c[1]));var a}function zf(c,n,a){switch(c){case"$type":return[`filter-type-${a}`,n];case"$id":return[`filter-id-${a}`,n];default:return[`filter-${a}`,c,n]}}function Ff(c,n){if(n.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(a=>typeof a!=typeof n[0])?["filter-in-large",c,["literal",n.sort(xw)]]:["filter-in-small",c,["literal",n]]}}function Ud(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function $d(c){return["!",c]}const Qc="";function Zx(c,n){return n?`${c}${Qc}${n}`:c}const po="-transition",vw=new Set(["fill","line","background","hillshade","raster"]);class $i extends Mc{constructor(n,a,d,g,h){if(super(),this.id=n.id,this.fqid=Zx(this.id,d),this.type=n.type,this.scope=d,this.lut=g,this.options=h,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&n.type!=="sky"&&n.type!=="slot"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),n.slot&&(this.slot=n.slot),a.layout&&(this._unevaluatedLayout=new yw(a.layout,this.scope,h),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),a.paint)){this._transitionablePaint=new Gx(a.paint,this.scope,h);for(const y in n.paint)this.setPaintProperty(y,n.paint[y]);for(const y in n.layout)this.setLayoutProperty(y,n.layout[y]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Kc(a.paint)}}onAdd(n){}onRemove(n){}isDraped(n){return!this.is3D()&&vw.has(this.type)}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,a){if(this.type==="custom"&&n==="visibility")return void(this.visibility=a);const d=this._unevaluatedLayout;d._properties.properties[n]&&(d.setValue(n,a),this.configDependencies=new Set([...this.configDependencies,...d.configDependencies]),n==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(n){return da(n,po)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,a){const d=this._transitionablePaint,g=d._properties.properties;if(da(n,po)){const C=n.slice(0,-11);return g[C]&&d.setTransition(C,a||void 0),!1}if(!g[n])return!1;const h=d._values[n],y=h.value.isDataDriven(),T=h.value;d.setValue(n,a),this.configDependencies=new Set([...this.configDependencies,...d.configDependencies]),this._handleSpecialPaintPropertyUpdate(n);const M=d._values[n].value,D=M.isDataDriven(),v=da(n,"pattern")||n==="line-dasharray";return D||y||v||this._handleOverridablePaintPropertyUpdate(n,T,M)}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getDefaultProgramParams(n,a,d){return null}_handleOverridablePaintPropertyUpdate(n,a,d){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,a)}serialize(){return wc({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(n,a)=>!(n===void 0||a==="layout"&&!Object.keys(n).length||a==="paint"&&!Object.keys(n).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const n in this.paint._values){const a=this.paint.get(n);if(a instanceof Yc&&Tf(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}compileFilter(n){this._filterCompiled||(this._featureFilter=fo(this.filter,this.scope,n),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(n){this._stats&&(n.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(n){}queryIntersectsFeature(n,a,d,g,h,y,T,M,D){}queryIntersectsMatchingFeature(n,a,d,g){}}const bw={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Gd{constructor(n,a){this._structArray=n,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class xr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,a){return n._trim(),a&&(n.isTransferred=!0,a.add(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const a=Object.create(this.prototype);return a.arrayBuffer=n.arrayBuffer,a.length=n.length,a.capacity=n.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...n){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...n){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Bn(c,n=1){let a=0,d=0;return{members:c.map(g=>{const h=bw[g.type].BYTES_PER_ELEMENT,y=a=Xx(a,Math.max(n,h)),T=g.components||1;return d=Math.max(d,h),a+=h*T,{name:g.name,type:g.type,components:T,offset:y}}),size:Xx(a,Math.max(d,n)),alignment:n}}function Xx(c,n){return Math.ceil(c/n)*n}class Qa extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a){const d=this.length;return this.resize(d+1),this.emplace(d,n,a)}emplace(n,a,d){const g=2*n;return this.int16[g+0]=a,this.int16[g+1]=d,n}}Qa.prototype.bytesPerElement=4,Ot(Qa,"StructArrayLayout2i4");class Bf extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,d){const g=this.length;return this.resize(g+1),this.emplace(g,n,a,d)}emplace(n,a,d,g){const h=3*n;return this.int16[h+0]=a,this.int16[h+1]=d,this.int16[h+2]=g,n}}Bf.prototype.bytesPerElement=6,Ot(Bf,"StructArrayLayout3i6");class el extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,d,g){const h=this.length;return this.resize(h+1),this.emplace(h,n,a,d,g)}emplace(n,a,d,g,h){const y=4*n;return this.int16[y+0]=a,this.int16[y+1]=d,this.int16[y+2]=g,this.int16[y+3]=h,n}}el.prototype.bytesPerElement=8,Ot(el,"StructArrayLayout4i8");class Vf extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,d,g,h){const y=this.length;return this.resize(y+1),this.emplace(y,n,a,d,g,h)}emplace(n,a,d,g,h,y){const T=5*n;return this.int16[T+0]=a,this.int16[T+1]=d,this.int16[T+2]=g,this.int16[T+3]=h,this.int16[T+4]=y,n}}Vf.prototype.bytesPerElement=10,Ot(Vf,"StructArrayLayout5i10");class yg extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d,g,h,y,T){const M=this.length;return this.resize(M+1),this.emplace(M,n,a,d,g,h,y,T)}emplace(n,a,d,g,h,y,T,M){const D=6*n,v=12*n,C=3*n;return this.int16[D+0]=a,this.int16[D+1]=d,this.uint8[v+4]=g,this.uint8[v+5]=h,this.uint8[v+6]=y,this.uint8[v+7]=T,this.float32[C+2]=M,n}}yg.prototype.bytesPerElement=12,Ot(yg,"StructArrayLayout2i4ub1f12");class ga extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d,g){const h=this.length;return this.resize(h+1),this.emplace(h,n,a,d,g)}emplace(n,a,d,g,h){const y=4*n;return this.float32[y+0]=a,this.float32[y+1]=d,this.float32[y+2]=g,this.float32[y+3]=h,n}}ga.prototype.bytesPerElement=16,Ot(ga,"StructArrayLayout4f16");class tl extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d){const g=this.length;return this.resize(g+1),this.emplace(g,n,a,d)}emplace(n,a,d,g){const h=3*n;return this.float32[h+0]=a,this.float32[h+1]=d,this.float32[h+2]=g,n}}tl.prototype.bytesPerElement=12,Ot(tl,"StructArrayLayout3f12");class ya extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d,g,h){const y=this.length;return this.resize(y+1),this.emplace(y,n,a,d,g,h)}emplace(n,a,d,g,h,y){const T=6*n,M=3*n;return this.uint16[T+0]=a,this.uint16[T+1]=d,this.uint16[T+2]=g,this.uint16[T+3]=h,this.float32[M+2]=y,n}}ya.prototype.bytesPerElement=12,Ot(ya,"StructArrayLayout4ui1f12");class jl extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,d,g){const h=this.length;return this.resize(h+1),this.emplace(h,n,a,d,g)}emplace(n,a,d,g,h){const y=4*n;return this.uint16[y+0]=a,this.uint16[y+1]=d,this.uint16[y+2]=g,this.uint16[y+3]=h,n}}jl.prototype.bytesPerElement=8,Ot(jl,"StructArrayLayout4ui8");class Uf extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,d,g,h,y){const T=this.length;return this.resize(T+1),this.emplace(T,n,a,d,g,h,y)}emplace(n,a,d,g,h,y,T){const M=6*n;return this.int16[M+0]=a,this.int16[M+1]=d,this.int16[M+2]=g,this.int16[M+3]=h,this.int16[M+4]=y,this.int16[M+5]=T,n}}Uf.prototype.bytesPerElement=12,Ot(Uf,"StructArrayLayout6i12");class _g extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,d,g,h,y,T,M,D,v,C,I){const P=this.length;return this.resize(P+1),this.emplace(P,n,a,d,g,h,y,T,M,D,v,C,I)}emplace(n,a,d,g,h,y,T,M,D,v,C,I,P){const A=12*n;return this.int16[A+0]=a,this.int16[A+1]=d,this.int16[A+2]=g,this.int16[A+3]=h,this.uint16[A+4]=y,this.uint16[A+5]=T,this.uint16[A+6]=M,this.uint16[A+7]=D,this.int16[A+8]=v,this.int16[A+9]=C,this.int16[A+10]=I,this.int16[A+11]=P,n}}_g.prototype.bytesPerElement=24,Ot(_g,"StructArrayLayout4i4ui4i24");class xg extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d,g,h,y){const T=this.length;return this.resize(T+1),this.emplace(T,n,a,d,g,h,y)}emplace(n,a,d,g,h,y,T){const M=10*n,D=5*n;return this.int16[M+0]=a,this.int16[M+1]=d,this.int16[M+2]=g,this.float32[D+2]=h,this.float32[D+3]=y,this.float32[D+4]=T,n}}xg.prototype.bytesPerElement=20,Ot(xg,"StructArrayLayout3i3f20");class vg extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint32[1*n+0]=a,n}}vg.prototype.bytesPerElement=4,Ot(vg,"StructArrayLayout1ul4");class nl extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a){const d=this.length;return this.resize(d+1),this.emplace(d,n,a)}emplace(n,a,d){const g=2*n;return this.uint16[g+0]=a,this.uint16[g+1]=d,n}}nl.prototype.bytesPerElement=4,Ot(nl,"StructArrayLayout2ui4");class eu extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,d,g,h,y,T,M,D,v,C,I,P){const A=this.length;return this.resize(A+1),this.emplace(A,n,a,d,g,h,y,T,M,D,v,C,I,P)}emplace(n,a,d,g,h,y,T,M,D,v,C,I,P,A){const N=20*n,j=10*n;return this.int16[N+0]=a,this.int16[N+1]=d,this.int16[N+2]=g,this.int16[N+3]=h,this.int16[N+4]=y,this.float32[j+3]=T,this.float32[j+4]=M,this.float32[j+5]=D,this.float32[j+6]=v,this.int16[N+14]=C,this.uint32[j+8]=I,this.uint16[N+18]=P,this.uint16[N+19]=A,n}}eu.prototype.bytesPerElement=40,Ot(eu,"StructArrayLayout5i4f1i1ul2ui40");class zl extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,d,g,h,y,T){const M=this.length;return this.resize(M+1),this.emplace(M,n,a,d,g,h,y,T)}emplace(n,a,d,g,h,y,T,M){const D=8*n;return this.int16[D+0]=a,this.int16[D+1]=d,this.int16[D+2]=g,this.int16[D+4]=h,this.int16[D+5]=y,this.int16[D+6]=T,this.int16[D+7]=M,n}}zl.prototype.bytesPerElement=16,Ot(zl,"StructArrayLayout3i2i2i16");class Ji extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,d,g,h){const y=this.length;return this.resize(y+1),this.emplace(y,n,a,d,g,h)}emplace(n,a,d,g,h,y){const T=4*n,M=8*n;return this.float32[T+0]=a,this.float32[T+1]=d,this.float32[T+2]=g,this.int16[M+6]=h,this.int16[M+7]=y,n}}Ji.prototype.bytesPerElement=16,Ot(Ji,"StructArrayLayout2f1f2i16");class tu extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d,g,h,y){const T=this.length;return this.resize(T+1),this.emplace(T,n,a,d,g,h,y)}emplace(n,a,d,g,h,y,T){const M=20*n,D=5*n;return this.uint8[M+0]=a,this.uint8[M+1]=d,this.float32[D+1]=g,this.float32[D+2]=h,this.float32[D+3]=y,this.float32[D+4]=T,n}}tu.prototype.bytesPerElement=20,Ot(tu,"StructArrayLayout2ub4f20");class Ri extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,d){const g=this.length;return this.resize(g+1),this.emplace(g,n,a,d)}emplace(n,a,d,g){const h=3*n;return this.uint16[h+0]=a,this.uint16[h+1]=d,this.uint16[h+2]=g,n}}Ri.prototype.bytesPerElement=6,Ot(Ri,"StructArrayLayout3ui6");class bg extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,a,d,g,h,y,T,M,D,v,C,I,P,A,N,j,V,X,K,$,ne){const ie=this.length;return this.resize(ie+1),this.emplace(ie,n,a,d,g,h,y,T,M,D,v,C,I,P,A,N,j,V,X,K,$,ne)}emplace(n,a,d,g,h,y,T,M,D,v,C,I,P,A,N,j,V,X,K,$,ne,ie){const ue=30*n,pe=15*n,ge=60*n;return this.int16[ue+0]=a,this.int16[ue+1]=d,this.int16[ue+2]=g,this.float32[pe+2]=h,this.float32[pe+3]=y,this.uint16[ue+8]=T,this.uint16[ue+9]=M,this.uint32[pe+5]=D,this.uint32[pe+6]=v,this.uint32[pe+7]=C,this.uint16[ue+16]=I,this.uint16[ue+17]=P,this.uint16[ue+18]=A,this.float32[pe+10]=N,this.float32[pe+11]=j,this.uint8[ge+48]=V,this.uint8[ge+49]=X,this.uint8[ge+50]=K,this.uint32[pe+13]=$,this.int16[ue+28]=ne,this.uint8[ge+58]=ie,n}}bg.prototype.bytesPerElement=60,Ot(bg,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class wg extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,a,d,g,h,y,T,M,D,v,C,I,P,A,N,j,V,X,K,$,ne,ie,ue,pe,ge,he,Se,_e,Ce,Le,je,ze){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,n,a,d,g,h,y,T,M,D,v,C,I,P,A,N,j,V,X,K,$,ne,ie,ue,pe,ge,he,Se,_e,Ce,Le,je,ze)}emplace(n,a,d,g,h,y,T,M,D,v,C,I,P,A,N,j,V,X,K,$,ne,ie,ue,pe,ge,he,Se,_e,Ce,Le,je,ze,Fe){const Ze=20*n,Ve=40*n,rt=80*n;return this.float32[Ze+0]=a,this.float32[Ze+1]=d,this.int16[Ve+4]=g,this.int16[Ve+5]=h,this.int16[Ve+6]=y,this.int16[Ve+7]=T,this.int16[Ve+8]=M,this.int16[Ve+9]=D,this.int16[Ve+10]=v,this.int16[Ve+11]=C,this.int16[Ve+12]=I,this.uint16[Ve+13]=P,this.uint16[Ve+14]=A,this.uint16[Ve+15]=N,this.uint16[Ve+16]=j,this.uint16[Ve+17]=V,this.uint16[Ve+18]=X,this.uint16[Ve+19]=K,this.uint16[Ve+20]=$,this.uint16[Ve+21]=ne,this.uint16[Ve+22]=ie,this.uint16[Ve+23]=ue,this.uint16[Ve+24]=pe,this.uint16[Ve+25]=ge,this.uint16[Ve+26]=he,this.uint16[Ve+27]=Se,this.uint32[Ze+14]=_e,this.float32[Ze+15]=Ce,this.float32[Ze+16]=Le,this.float32[Ze+17]=je,this.float32[Ze+18]=ze,this.uint8[rt+76]=Fe,n}}wg.prototype.bytesPerElement=80,Ot(wg,"StructArrayLayout2f9i15ui1ul4f1ub80");class nu extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.float32[1*n+0]=a,n}}nu.prototype.bytesPerElement=4,Ot(nu,"StructArrayLayout1f4");class _a extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d,g,h){const y=this.length;return this.resize(y+1),this.emplace(y,n,a,d,g,h)}emplace(n,a,d,g,h,y){const T=5*n;return this.float32[T+0]=a,this.float32[T+1]=d,this.float32[T+2]=g,this.float32[T+3]=h,this.float32[T+4]=y,n}}_a.prototype.bytesPerElement=20,Ot(_a,"StructArrayLayout5f20");class Sg extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d,g,h,y,T){const M=this.length;return this.resize(M+1),this.emplace(M,n,a,d,g,h,y,T)}emplace(n,a,d,g,h,y,T,M){const D=7*n;return this.float32[D+0]=a,this.float32[D+1]=d,this.float32[D+2]=g,this.float32[D+3]=h,this.float32[D+4]=y,this.float32[D+5]=T,this.float32[D+6]=M,n}}Sg.prototype.bytesPerElement=28,Ot(Sg,"StructArrayLayout7f28");class Wd extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,d,g){const h=this.length;return this.resize(h+1),this.emplace(h,n,a,d,g)}emplace(n,a,d,g,h){const y=6*n;return this.uint32[3*n+0]=a,this.uint16[y+2]=d,this.uint16[y+3]=g,this.uint16[y+4]=h,n}}Wd.prototype.bytesPerElement=12,Ot(Wd,"StructArrayLayout1ul3ui12");class Tg extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint16[1*n+0]=a,n}}Tg.prototype.bytesPerElement=2,Ot(Tg,"StructArrayLayout1ui2");class Hd extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a){const d=this.length;return this.resize(d+1),this.emplace(d,n,a)}emplace(n,a,d){const g=2*n;return this.float32[g+0]=a,this.float32[g+1]=d,n}}Hd.prototype.bytesPerElement=8,Ot(Hd,"StructArrayLayout2f8");class qd extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d,g,h,y,T,M,D,v,C,I,P,A,N,j){const V=this.length;return this.resize(V+1),this.emplace(V,n,a,d,g,h,y,T,M,D,v,C,I,P,A,N,j)}emplace(n,a,d,g,h,y,T,M,D,v,C,I,P,A,N,j,V){const X=16*n;return this.float32[X+0]=a,this.float32[X+1]=d,this.float32[X+2]=g,this.float32[X+3]=h,this.float32[X+4]=y,this.float32[X+5]=T,this.float32[X+6]=M,this.float32[X+7]=D,this.float32[X+8]=v,this.float32[X+9]=C,this.float32[X+10]=I,this.float32[X+11]=P,this.float32[X+12]=A,this.float32[X+13]=N,this.float32[X+14]=j,this.float32[X+15]=V,n}}qd.prototype.bytesPerElement=64,Ot(qd,"StructArrayLayout16f64");class $f extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d,g,h,y,T){const M=this.length;return this.resize(M+1),this.emplace(M,n,a,d,g,h,y,T)}emplace(n,a,d,g,h,y,T,M){const D=10*n,v=5*n;return this.uint16[D+0]=a,this.uint16[D+1]=d,this.uint16[D+2]=g,this.uint16[D+3]=h,this.float32[v+2]=y,this.float32[v+3]=T,this.float32[v+4]=M,n}}$f.prototype.bytesPerElement=20,Ot($f,"StructArrayLayout4ui3f20");class Gf extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.int16[1*n+0]=a,n}}Gf.prototype.bytesPerElement=2,Ot(Gf,"StructArrayLayout1i2");class Wf extends xr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint8[1*n+0]=a,n}}Wf.prototype.bytesPerElement=1,Ot(Wf,"StructArrayLayout1ub1");class Yx extends Gd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Yx.prototype.size=40;class Hf extends eu{get(n){return new Yx(this,n)}}Ot(Hf,"CollisionBoxArray");class Zd extends Gd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}Zd.prototype.size=60;class Eg extends bg{get(n){return new Zd(this,n)}}Ot(Eg,"PlacedSymbolArray");class Kx extends Gd{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(n){this._structArray.uint32[this._pos4+14]=n}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(n){this._structArray.float32[this._pos4+18]=n}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Kx.prototype.size=80;class Cg extends wg{get(n){return new Kx(this,n)}}Ot(Cg,"SymbolInstanceArray");class Jx extends nu{getoffsetX(n){return this.float32[1*n+0]}}Ot(Jx,"GlyphOffsetArray");class qf extends Qa{getx(n){return this.int16[2*n+0]}gety(n){return this.int16[2*n+1]}}Ot(qf,"SymbolLineVertexArray");class Qx extends Gd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Qx.prototype.size=12;class e0 extends Wd{get(n){return new Qx(this,n)}}Ot(e0,"FeatureIndexArray");class t0 extends nl{geta_centroid_pos0(n){return this.uint16[2*n+0]}geta_centroid_pos1(n){return this.uint16[2*n+1]}}Ot(t0,"FillExtrusionCentroidArray");class n0 extends Gd{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}n0.prototype.size=6;class Pg extends Bf{get(n){return new n0(this,n)}}Ot(Pg,"FillExtrusionWallArray");const ww=Bn([{name:"a_pos",components:2,type:"Int16"}],4),Sw=Bn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Nr{constructor(n=[]){this.segments=n}_prepareSegment(n,a,d,g){let h=this.segments[this.segments.length-1];return n>Nr.MAX_VERTEX_ARRAY_LENGTH&&zn(`Max vertices per segment is ${Nr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!h||h.vertexLength+n>Nr.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==g)&&(h={vertexOffset:a,primitiveOffset:d,vertexLength:0,primitiveLength:0},g!==void 0&&(h.sortKey=g),this.segments.push(h)),h}prepareSegment(n,a,d,g){return this._prepareSegment(n,a.length,d.length,g)}get(){return this.segments}destroy(){for(const n of this.segments)for(const a in n.vaos)n.vaos[a].destroy()}static simpleSegment(n,a,d,g){return new Nr([{vertexOffset:n,primitiveOffset:a,vertexLength:d,primitiveLength:g,vaos:{},sortKey:0}])}}function r0(c,n){return 256*(c=mn(Math.floor(c),0,255))+mn(Math.floor(n),0,255)}Nr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ot(Nr,"SegmentVector");const Tw=Bn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ew=Bn([{name:"a_dash",components:4,type:"Uint16"}]);class Xd{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(n,a,d,g){this.ids.push(i0(n)),this.positions.push(a,d,g)}eachPosition(n,a){const d=i0(n);let g=0,h=this.ids.length-1;for(;g<h;){const y=g+h>>1;this.ids[y]>=d?h=y:g=y+1}for(;this.ids[g]===d;)a(this.positions[3*g],this.positions[3*g+1],this.positions[3*g+2]),g++}static serialize(n,a){const d=new Float64Array(n.ids),g=new Uint32Array(n.positions);return ru(d,g,0,d.length-1),a&&(a.add(d.buffer),a.add(g.buffer)),{ids:d,positions:g}}static deserialize(n){const a=new Xd;let d;a.ids=n.ids,a.positions=n.positions;for(const g of a.ids)g!==d&&a.uniqueIds.push(g),d=g;return a.indexed=!0,a}}function i0(c){const n=+c;return!isNaN(n)&&Number.MIN_SAFE_INTEGER<=n&&n<=Number.MAX_SAFE_INTEGER?n:ls(String(c))}function ru(c,n,a,d){for(;a<d;){const g=c[a+d>>1];let h=a-1,y=d+1;for(;;){do h++;while(c[h]<g);do y--;while(c[y]>g);if(h>=y)break;Zf(c,h,y),Zf(n,3*h,3*y),Zf(n,3*h+1,3*y+1),Zf(n,3*h+2,3*y+2)}y-a<d-y?(ru(c,n,a,y),a=y+1):(ru(c,n,y+1,d),d=y)}}function Zf(c,n,a){const d=c[n];c[n]=c[a],c[a]=d}Ot(Xd,"FeaturePositionMap");class xa{constructor(n){this.gl=n.gl,this.initialized=!1}fetchUniformLocation(n,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(n,a),this.initialized=!0),!!this.location}set(n,a,d){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Fl extends xa{constructor(n){super(n),this.current=0}set(n,a,d){this.fetchUniformLocation(n,a)&&this.current!==d&&(this.current=d,this.gl.uniform1i(this.location,d))}}class Gi extends xa{constructor(n){super(n),this.current=0}set(n,a,d){this.fetchUniformLocation(n,a)&&this.current!==d&&(this.current=d,this.gl.uniform1f(this.location,d))}}class Bo extends xa{constructor(n){super(n),this.current=[0,0]}set(n,a,d){this.fetchUniformLocation(n,a)&&(d[0]===this.current[0]&&d[1]===this.current[1]||(this.current=d,this.gl.uniform2f(this.location,d[0],d[1])))}}class Mg extends xa{constructor(n){super(n),this.current=[0,0,0]}set(n,a,d){this.fetchUniformLocation(n,a)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]||(this.current=d,this.gl.uniform3f(this.location,d[0],d[1],d[2])))}}class Xf extends xa{constructor(n){super(n),this.current=[0,0,0,0]}set(n,a,d){this.fetchUniformLocation(n,a)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]&&d[3]===this.current[3]||(this.current=d,this.gl.uniform4f(this.location,d[0],d[1],d[2],d[3])))}}class Ag extends xa{constructor(n){super(n),this.current=Yn.transparent.toRenderColor(null)}set(n,a,d){this.fetchUniformLocation(n,a)&&(d.r===this.current.r&&d.g===this.current.g&&d.b===this.current.b&&d.a===this.current.a||(this.current=d,this.gl.uniform4f(this.location,d.r,d.g,d.b,d.a)))}}const s0=new Float32Array(16);class Yd extends xa{constructor(n){super(n),this.current=s0}set(n,a,d){if(this.fetchUniformLocation(n,a)){if(d[12]!==this.current[12]||d[0]!==this.current[0])return this.current=d,void this.gl.uniformMatrix4fv(this.location,!1,d);for(let g=1;g<16;g++)if(d[g]!==this.current[g]){this.current=d,this.gl.uniformMatrix4fv(this.location,!1,d);break}}}}const Cw=new Float32Array(9),Pw=new Float32Array(4);class Ig extends xa{constructor(n){super(n),this.current=Pw}set(n,a,d){if(this.fetchUniformLocation(n,a)){for(let g=0;g<4;g++)if(d[g]!==this.current[g]){this.current=d,this.gl.uniformMatrix2fv(this.location,!1,d);break}}}}function Dg(c){return[r0(255*c.r,255*c.g),r0(255*c.b,255*c.a)]}class Kd{constructor(n,a,d,g){this.value=n,this.uniformNames=a.map(h=>`u_${h}`),this.type=d,this.context=g}setUniform(n,a,d,g,h){const y=g.constantOr(this.value);a.set(n,h,y instanceof Yn?y.toRenderColor(this.context.lut):y)}getBinding(n,a){return this.type==="color"?new Ag(n):new Gi(n)}}class iu{constructor(n,a){this.uniformNames=a.map(d=>`u_${d}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(n){this.pixelRatio=n.pixelRatio||1,this.pattern=n.tl.concat(n.br)}setUniform(n,a,d,g,h){const y=h==="u_pattern"||h==="u_dash"?this.pattern:h==="u_pixel_ratio"?this.pixelRatio:null;y&&a.set(n,h,y)}getBinding(n,a){return a==="u_pattern"||a==="u_dash"?new Xf(n):new Gi(n)}}class Vo{constructor(n,a,d,g){this.expression=n,this.type=d,this.maxValue=0,this.paintVertexAttributes=a.map(h=>({name:`a_${h}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(n,a,d,g,h,y,T){const M=this.paintVertexArray.length,D=this.expression.evaluate(new kr(0,{brightness:y}),a,{},h,g,T);this.paintVertexArray.resize(n),this._setPaintValue(M,n,D,this.context)}updatePaintArray(n,a,d,g,h,y,T){const M=this.expression.evaluate({zoom:0,brightness:T},d,g,void 0,h);this._setPaintValue(n,a,M,this.context)}_setPaintValue(n,a,d,g){if(this.type==="color"){const h=Dg(d.toRenderColor(g.lut));for(let y=n;y<a;y++)this.paintVertexArray.emplace(y,h[0],h[1])}else{for(let h=n;h<a;h++)this.paintVertexArray.emplace(h,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Is{constructor(n,a,d,g,h,y){this.expression=n,this.uniformNames=a.map(T=>`u_${T}_t`),this.type=d,this.useIntegerZoom=g,this.context=h,this.maxValue=0,this.paintVertexAttributes=a.map(T=>({name:`a_${T}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(n,a,d,g,h,y,T){const M=this.expression.evaluate(new kr(this.context.zoom,{brightness:y}),a,{},h,g,T),D=this.expression.evaluate(new kr(this.context.zoom+1,{brightness:y}),a,{},h,g,T),v=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(v,n,M,D,this.context)}updatePaintArray(n,a,d,g,h,y,T){const M=this.expression.evaluate({zoom:this.context.zoom,brightness:T},d,g,void 0,h),D=this.expression.evaluate({zoom:this.context.zoom+1,brightness:T},d,g,void 0,h);this._setPaintValue(n,a,M,D,this.context)}_setPaintValue(n,a,d,g,h){if(this.type==="color"){const y=Dg(d.toRenderColor(h.lut)),T=Dg(d.toRenderColor(h.lut));for(let M=n;M<a;M++)this.paintVertexArray.emplace(M,y[0],y[1],T[0],T[1])}else{for(let y=n;y<a;y++)this.paintVertexArray.emplace(y,d,g);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(g))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,a,d,g,h){const y=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,T=mn(this.expression.interpolationFactor(y,this.context.zoom,this.context.zoom+1),0,1);a.set(n,h,T)}getBinding(n,a){return new Gi(n)}}class Uo{constructor(n,a,d,g,h){this.expression=n,this.layerId=h,this.paintVertexAttributes=(d==="array"?Ew:Tw).members;for(let y=0;y<a.length;++y);this.paintVertexArray=new g}populatePaintArray(n,a,d,g){const h=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValues(h,n,a.patterns&&a.patterns[this.layerId],d)}updatePaintArray(n,a,d,g,h,y,T){this._setPaintValues(n,a,d.patterns&&d.patterns[this.layerId],y)}_setPaintValues(n,a,d,g){if(!g||!d)return;const h=g[d];if(!h)return;const{tl:y,br:T,pixelRatio:M}=h;for(let D=n;D<a;D++)this.paintVertexArray.emplace(D,y[0],y[1],T[0],T[1],M)}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Bl{constructor(n,a,d=()=>!0){this.binders={},this._buffers=[],this.context=a;const g=[];for(const h in n.paint._values){const y=n.paint.get(h);if(!d(h)||!(y instanceof Yc&&Tf(y.property.specification)))continue;const T=Aw(h,n.type),M=y.value,D=y.property.specification.type,v=!!y.property.useIntegerZoom,C=h==="line-dasharray"||h.endsWith("pattern"),I=h==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant";if(M.kind!=="constant"||I)if(M.kind==="source"||I||C){const P=f(h,D,"source");this.binders[h]=C?new Uo(M,T,D,P,n.id):new Vo(M,T,D,P),g.push(`/a_${h}`)}else{const P=f(h,D,"composite");this.binders[h]=new Is(M,T,D,v,a,P),g.push(`/z_${h}`)}else this.binders[h]=C?new iu(M.value,T):new Kd(M.value,T,D,a),g.push(`/u_${h}`)}this.cacheKey=g.sort().join("")}getMaxValue(n){const a=this.binders[n];return a instanceof Vo||a instanceof Is?a.maxValue:0}populatePaintArrays(n,a,d,g,h,y,T){for(const M in this.binders){const D=this.binders[M];D.context=this.context,(D instanceof Vo||D instanceof Is||D instanceof Uo)&&D.populatePaintArray(n,a,d,g,h,y,T)}}setConstantPatternPositions(n){for(const a in this.binders){const d=this.binders[a];d instanceof iu&&d.setConstantPatternPositions(n)}}updatePaintArrays(n,a,d,g,h,y,T,M){let D=!1;const v=Object.keys(n),C=v.length!==0,I=C?v:a.uniqueIds;this.context.lut=h.lut;for(const P in this.binders){const A=this.binders[P];if(A.context=this.context,(A instanceof Vo||A instanceof Is||A instanceof Uo)&&(A.expression.isStateDependent===!0||A.expression.isLightConstant===!1)){const N=h.paint.get(P);A.expression=N.value;for(const j of I){const V=n[j.toString()];a.eachPosition(j,(X,K,$)=>{const ne=g.feature(X);A.updatePaintArray(K,$,ne,V,y,T,M)})}if(!C)for(const j of d.uniqueIds){const V=n[j.toString()];d.eachPosition(j,(X,K,$)=>{const ne=g.feature(X);A.updatePaintArray(K,$,ne,V,y,T,M)})}D=!0}}return D}defines(){const n=[];for(const a in this.binders){const d=this.binders[a];(d instanceof Kd||d instanceof iu)&&n.push(...d.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return n}getBinderAttributes(){const n=[];for(const a in this.binders){const d=this.binders[a];if(d instanceof Vo||d instanceof Is||d instanceof Uo)for(let g=0;g<d.paintVertexAttributes.length;g++)n.push(d.paintVertexAttributes[g].name)}return n}getBinderUniforms(){const n=[];for(const a in this.binders){const d=this.binders[a];if(d instanceof Kd||d instanceof iu||d instanceof Is)for(const g of d.uniformNames)n.push(g)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n){const a=[];for(const d in this.binders){const g=this.binders[d];if(g instanceof Kd||g instanceof iu||g instanceof Is)for(const h of g.uniformNames)a.push({name:h,property:d,binding:g.getBinding(n,h)})}return a}setUniforms(n,a,d,g,h){for(const{name:y,property:T,binding:M}of d)this.binders[T].setUniform(n,M,h,g.get(T),y)}updatePaintBuffers(){this._buffers=[];for(const n in this.binders){const a=this.binders[n];(a instanceof Vo||a instanceof Is||a instanceof Uo)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(n){for(const a in this.binders){const d=this.binders[a];(d instanceof Vo||d instanceof Is||d instanceof Uo)&&d.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const a=this.binders[n];(a instanceof Vo||a instanceof Is||a instanceof Uo)&&a.destroy()}}}class rl{constructor(n,a,d=()=>!0){this.programConfigurations={};for(const g of n)this.programConfigurations[g.id]=new Bl(g,a,d);this.needsUpload=!1,this._featureMap=new Xd,this._featureMapWithoutIds=new Xd,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(n,a,d,g,h,y,T,M){for(const D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(n,a,g,h,y,T,M);a.id!==void 0?this._featureMap.add(a.id,d,this._bufferOffset,n):(this._featureMapWithoutIds.add(this._idlessCounter,d,this._bufferOffset,n),this._idlessCounter+=1),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,a,d,g,h,y){for(const T of d)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(n,this._featureMap,this._featureMapWithoutIds,a,T,g,h,y||0)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const Mw={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Aw(c,n){return Mw[c]||[c.replace(`${n}-`,"").replace(/-/g,"_")]}const Iw={"line-pattern":{source:ya,composite:ya},"fill-pattern":{source:ya,composite:ya},"fill-extrusion-pattern":{source:ya,composite:ya},"line-dasharray":{source:jl,composite:jl}},o0={color:{source:Hd,composite:ga},number:{source:nu,composite:Hd}};function f(c,n,a){const d=Iw[c];return d&&d[a]||o0[n][a]}Ot(Kd,"ConstantBinder"),Ot(iu,"PatternConstantBinder"),Ot(Vo,"SourceExpressionBinder"),Ot(Uo,"PatternCompositeBinder"),Ot(Is,"CompositeExpressionBinder"),Ot(Bl,"ProgramConfiguration",{omit:["_buffers"]}),Ot(rl,"ProgramConfigurationSet");const i=Mt/Math.PI/2,l=5,p=6,x=16383,w=64,E=[w,32,16],R=-i,L=i;function z(c,n,a,d=i){return a=wn(a),[c*Math.sin(a)*d,-n*d,c*Math.cos(a)*d]}function B(c,n,a){return z(Math.cos(wn(c)),Math.sin(wn(c)),n,a)}const G=63710088e-1,Z=2*Math.PI*G;class Y{constructor(n,a){if(isNaN(n)||isNaN(a))throw new Error(`Invalid LngLat object: (${n}, ${a})`);if(this.lng=+n,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Y(ua(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const a=Math.PI/180,d=this.lat*a,g=n.lat*a,h=Math.sin(d)*Math.sin(g)+Math.cos(d)*Math.cos(g)*Math.cos((n.lng-this.lng)*a);return G*Math.acos(Math.min(h,1))}toBounds(n=0){const a=360*n/40075017,d=a/Math.cos(Math.PI/180*this.lat);return new se({lng:this.lng-d,lat:this.lat-a},{lng:this.lng+d,lat:this.lat+a})}toEcef(n){return B(this.lat,this.lng,i+n*i/G)}static convert(n){if(n instanceof Y)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new Y(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new Y(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class se{constructor(n,a){if(n)if(a)this.setSouthWest(n).setNorthEast(a);else if(n.length===4){const d=n;this.setSouthWest([d[0],d[1]]).setNorthEast([d[2],d[3]])}else{const d=n;this.setSouthWest(d[0]).setNorthEast(d[1])}}setNorthEast(n){return this._ne=n instanceof Y?new Y(n.lng,n.lat):Y.convert(n),this}setSouthWest(n){return this._sw=n instanceof Y?new Y(n.lng,n.lat):Y.convert(n),this}extend(n){const a=this._sw,d=this._ne;let g,h;if(n instanceof Y)g=n,h=n;else{if(!(n instanceof se))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(se.convert(n)):this.extend(Y.convert(n)):typeof n=="object"&&n!==null&&n.hasOwnProperty("lat")&&(n.hasOwnProperty("lon")||n.hasOwnProperty("lng"))?this.extend(Y.convert(n)):this;if(g=n._sw,h=n._ne,!g||!h)return this}return a||d?(a.lng=Math.min(g.lng,a.lng),a.lat=Math.min(g.lat,a.lat),d.lng=Math.max(h.lng,d.lng),d.lat=Math.max(h.lat,d.lat)):(this._sw=new Y(g.lng,g.lat),this._ne=new Y(h.lng,h.lat)),this}getCenter(){return new Y((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Y(this.getWest(),this.getNorth())}getSouthEast(){return new Y(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:a,lat:d}=Y.convert(n);let g=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&g}static convert(n){if(n)return n instanceof se?n:new se(n)}}const oe=0,ae=25.5;function le(c){return Z*Math.cos(c*Math.PI/180)}function me(c){return(180+c)/360}function ye(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function fe(c,n){return c/le(n)}function be(c){return 360*c-180}function ve(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Pe(c,n){return c*le(ve(n))}const Te=85.051129;function Me(c){return Math.cos(wn(mn(c,-Te,Te)))}function Oe(c,n){const a=mn(n,oe,ae),d=Math.pow(2,a);return Me(c)*Z/(512*d)}function ke(c){return 1/Math.cos(c*Math.PI/180)}function De(c,n=0){const a=Math.exp(Math.PI*(1-(c.y+n/Mt)/(1<<c.z)*2));return 80150034*a/(a*a+1)/Mt/(1<<c.z)}class Ue{constructor(n,a,d=0){this.x=+n,this.y=+a,this.z=+d}static fromLngLat(n,a=0){const d=Y.convert(n);return new Ue(me(d.lng),ye(d.lat),fe(a,d.lat))}toLngLat(){return new Y(be(this.x),ve(this.y))}toAltitude(){return Pe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Z*ke(ve(this.y))}}function et(c,n,a,d,g,h,y,T,M){const D=(n+d)/2,v=(a+g)/2,C=new Tt(D,v);T(C),function(I,P,A,N,j,V){const X=A-j,K=N-V;return Math.abs((N-P)*X-(A-I)*K)/Math.hypot(X,K)}(C.x,C.y,h.x,h.y,y.x,y.y)>=M?(et(c,n,a,D,v,h,C,T,M),et(c,D,v,d,g,C,y,T,M)):c.push(y)}function lt(c,n,a){let d=c[0],g=d.x,h=d.y;n(d);const y=[d];for(let T=1;T<c.length;T++){const M=c[T],{x:D,y:v}=M;n(M),et(y,g,h,D,v,d,M,n,a),g=D,h=v,d=M}return y}function Qe(c,n,a,d){if(d(n,a)){const g=n.add(a)._mult(.5);Qe(c,n,g,d),Qe(c,g,a,d)}else c.push(a)}function gt(c,n){let a=c[0];const d=[a];for(let g=1;g<c.length;g++){const h=c[g];Qe(d,a,h,n),a=h}return d}const $e=Math.pow(2,14)-1,ot=-$e-1;function it(c,n){const a=Math.round(c.x*n),d=Math.round(c.y*n);return c.x=mn(a,ot,$e),c.y=mn(d,ot,$e),(a<c.x||a>c.x+1||d<c.y||d>c.y+1)&&zn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function _t(c,n,a){const d=c.loadGeometry(),g=c.extent,h=Mt/g;if(n&&a&&a.projection.isReprojectedInTileSpace){const y=1<<n.z,{scale:T,x:M,y:D,projection:v}=a,C=I=>{const P=be((n.x+I.x/g)/y),A=ve((n.y+I.y/g)/y),N=v.project(P,A);I.x=(N.x*T-M)*g,I.y=(N.y*T-D)*g};for(let I=0;I<d.length;I++)if(c.type!==1)d[I]=lt(d[I],C,1);else{const P=[];for(const A of d[I])A.x<0||A.x>=g||A.y<0||A.y>=g||(C(A),P.push(A));d[I]=P}}for(const y of d)for(const T of y)it(T,h);return d}function vt(c,n){return{type:c.type,id:c.id,properties:c.properties,geometry:n?_t(c):[]}}function at(c,n,a,d,g){c.emplaceBack(2*n+(d+1)/2,2*a+(g+1)/2)}function dt(c,n,a){c.emplaceBack(n.x,n.y,n.z,a[0]*16384,a[1]*16384,a[2]*16384)}class Wt{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new Qa,this.indexArray=new Ri,this.segments=new Nr,this.programConfigurations=new rl(n.layers,{zoom:n.zoom,lut:n.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}updateFootprints(n,a){}populate(n,a,d,g){const h=this.layers[0],y=[];let T=null;h.type==="circle"&&(T=h.layout.get("circle-sort-key"));for(const{feature:D,id:v,index:C,sourceLayerIndex:I}of n){const P=this.layers[0]._featureFilter.needGeometry,A=vt(D,P);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),A,d))continue;const N=T?T.evaluate(A,{},d):void 0,j={id:v,properties:D.properties,type:D.type,sourceLayerIndex:I,index:C,geometry:P?A.geometry:_t(D,d,g),patterns:{},sortKey:N};y.push(j)}T&&y.sort((D,v)=>D.sortKey-v.sortKey);let M=null;g.projection.name==="globe"&&(this.globeExtVertexArray=new Uf,M=g.projection);for(const D of y){const{geometry:v,index:C,sourceLayerIndex:I}=D,P=n[C].feature;this.addFeature(D,v,C,a.availableImages,d,M,a.brightness),a.featureIndex.insert(P,v,C,I,this.index)}}update(n,a,d,g,h){const y=Object.keys(n).length!==0;y&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,a,y?this.stateDependentLayers:this.layers,d,g,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,ww.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,Sw.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(n,a,d,g,h,y,T){for(const M of a)for(const D of M){const v=D.x,C=D.y;if(v<0||v>=Mt||C<0||C>=Mt)continue;if(y){const A=y.projectTilePoint(v,C,h),N=y.upVector(h,v,C),j=this.globeExtVertexArray;dt(j,A,N),dt(j,A,N),dt(j,A,N),dt(j,A,N)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),P=I.vertexLength;at(this.layoutVertexArray,v,C,-1,-1),at(this.layoutVertexArray,v,C,1,-1),at(this.layoutVertexArray,v,C,1,1),at(this.layoutVertexArray,v,C,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+2,P+3),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,{},g,h,T)}}function Ct(c,n){for(let a=0;a<c.length;a++)if(yr(n,c[a]))return!0;for(let a=0;a<n.length;a++)if(yr(c,n[a]))return!0;return!!Zt(c,n)}function Nt(c,n,a){return!!yr(c,n)||!!yn(n,c,a)}function Kt(c,n){if(c.length===1)return lr(n,c[0]);for(let a=0;a<n.length;a++){const d=n[a];for(let g=0;g<d.length;g++)if(yr(c,d[g]))return!0}for(let a=0;a<c.length;a++)if(lr(n,c[a]))return!0;for(let a=0;a<n.length;a++)if(Zt(c,n[a]))return!0;return!1}function Bt(c,n,a){if(c.length>1){if(Zt(c,n))return!0;for(let d=0;d<n.length;d++)if(yn(n[d],c,a))return!0}for(let d=0;d<c.length;d++)if(yn(c[d],n,a))return!0;return!1}function Zt(c,n){if(c.length===0||n.length===0)return!1;for(let a=0;a<c.length-1;a++){const d=c[a],g=c[a+1];for(let h=0;h<n.length-1;h++)if(vn(d,g,n[h],n[h+1]))return!0}return!1}function vn(c,n,a,d){return No(c,a,d)!==No(n,a,d)&&No(c,n,a)!==No(c,n,d)}function yn(c,n,a){const d=a*a;if(n.length===1)return c.distSqr(n[0])<d;for(let g=1;g<n.length;g++)if(nr(c,n[g-1],n[g])<d)return!0;return!1}function nr(c,n,a){const d=n.distSqr(a);if(d===0)return c.distSqr(n);const g=((c.x-n.x)*(a.x-n.x)+(c.y-n.y)*(a.y-n.y))/d;return c.distSqr(g<0?n:g>1?a:a.sub(n)._mult(g)._add(n))}function lr(c,n){let a,d,g,h=!1;for(let y=0;y<c.length;y++){a=c[y];for(let T=0,M=a.length-1;T<a.length;M=T++)d=a[T],g=a[M],d.y>n.y!=g.y>n.y&&n.x<(g.x-d.x)*(n.y-d.y)/(g.y-d.y)+d.x&&(h=!h)}return h}function yr(c,n){let a=!1;for(let d=0,g=c.length-1;d<c.length;g=d++){const h=c[d],y=c[g];h.y>n.y!=y.y>n.y&&n.x<(y.x-h.x)*(n.y-h.y)/(y.y-h.y)+h.x&&(a=!a)}return a}function Us(c,n,a,d,g){for(const y of c)if(n<=y.x&&a<=y.y&&d>=y.x&&g>=y.y)return!0;const h=[new Tt(n,a),new Tt(n,g),new Tt(d,g),new Tt(d,a)];if(c.length>2){for(const y of h)if(yr(c,y))return!0}for(let y=0;y<c.length-1;y++)if(Vr(c[y],c[y+1],h))return!0;return!1}function Vr(c,n,a){const d=a[0],g=a[2];if(c.x<d.x&&n.x<d.x||c.x>g.x&&n.x>g.x||c.y<d.y&&n.y<d.y||c.y>g.y&&n.y>g.y)return!1;const h=No(c,n,a[0]);return h!==No(c,n,a[1])||h!==No(c,n,a[2])||h!==No(c,n,a[3])}function Cn(c,n,a,d,g,h){let y=n.y-c.y,T=c.x-n.x;if(h=h||0){const M=y*y+T*T;if(M===0)return!0;const D=Math.sqrt(M);y/=D,T/=D}return!((a.x-c.x)*y+(a.y-c.y)*T-h<0||(d.x-c.x)*y+(d.y-c.y)*T-h<0||(g.x-c.x)*y+(g.y-c.y)*T-h<0)}function sr(c,n,a,d,g,h,y){return!(Cn(c,n,d,g,h,y)||Cn(n,a,d,g,h,y)||Cn(a,c,d,g,h,y)||Cn(d,g,c,n,a,y)||Cn(g,h,c,n,a,y)||Cn(h,d,c,n,a,y))}function Tr(c,n,a){const d=n.paint.get(c).value;return d.kind==="constant"?d.value:a.programConfigurations.get(n.id).getMaxValue(c)}function ir(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function _n(c,n,a,d,g){if(!n[0]&&!n[1])return c;const h=Tt.convert(n)._mult(g);a==="viewport"&&h._rotate(-d);const y=[];for(let T=0;T<c.length;T++)y.push(c[T].sub(h));return y}function Vn(c,n,a,d){const g=Tt.convert(c)._mult(d);return n==="viewport"&&g._rotate(-a),g}let Kn,Lr;Ot(Wt,"CircleBucket",{omit:["layers"]});var Ur,Nn={exports:{}},oi=(Ur||(Ur=1,function(c,n){(function(a){function d(h,y,T){var M=g(256*h,256*(y=Math.pow(2,T)-y-1),T),D=g(256*(h+1),256*(y+1),T);return M[0]+","+M[1]+","+D[0]+","+D[1]}function g(h,y,T){var M=2*Math.PI*6378137/256/Math.pow(2,T);return[h*M-2*Math.PI*6378137/2,y*M-2*Math.PI*6378137/2]}a.getURL=function(h,y,T,M,D,v){return v=v||{},h+"?"+["bbox="+d(T,M,D),"format="+(v.format||"image/png"),"service="+(v.service||"WMS"),"version="+(v.version||"1.1.1"),"request="+(v.request||"GetMap"),"srs="+(v.srs||"EPSG:3857"),"width="+(v.width||256),"height="+(v.height||256),"layers="+y].join("&")},a.getTileBBox=d,a.getMercCoords=g,Object.defineProperty(a,"__esModule",{value:!0})})(n)}(0,Nn.exports)),Nn.exports);class gi{constructor(n,a,d){this.z=n,this.x=a,this.y=d,this.key=Qi(0,n,n,a,d)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,a){const d=oi.getTileBBox(this.x,this.y,this.z),g=function(h,y,T){let M,D="";for(let v=h;v>0;v--)M=1<<v-1,D+=(y&M?1:0)+(T&M?2:0);return D}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",g).replace("{bbox-epsg-3857}",d)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ai{constructor(n,a){this.wrap=n,this.canonical=a,this.key=Qi(n,a.z,a.z,a.x,a.y)}}class fr{constructor(n,a,d,g,h){this.overscaledZ=n,this.wrap=a,this.canonical=new gi(d,+g,+h),this.key=a===0&&n===d?this.canonical.key:Qi(a,n,d,g,h)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const a=this.canonical.z-n;return n>this.canonical.z?new fr(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new fr(n,this.wrap,n,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(n,a=!0){if(this.overscaledZ===n&&a)return this.key;if(n>this.canonical.z)return Qi(this.wrap*+a,n,this.canonical.z,this.canonical.x,this.canonical.y);{const d=this.canonical.z-n;return Qi(this.wrap*+a,n,n,this.canonical.x>>d,this.canonical.y>>d)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const a=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.z<this.canonical.z&&n.canonical.x===this.canonical.x>>a&&n.canonical.y===this.canonical.y>>a}children(n){if(this.overscaledZ>=n)return[new fr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,d=2*this.canonical.x,g=2*this.canonical.y;return[new fr(a,this.wrap,a,d,g),new fr(a,this.wrap,a,d+1,g),new fr(a,this.wrap,a,d,g+1),new fr(a,this.wrap,a,d+1,g+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new fr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new fr(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ai(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Qi(c,n,a,d,g){const h=1<<Math.min(a,22);let y=h*(g%h)+d%h;return c&&a<22&&(y+=h*h*((c<0?-2*c-1:2*c)%(1<<2*(22-a)))),16*(32*y+a)+(n-a)}const es=[c=>{let n=c.canonical.x-1,a=c.wrap;return n<0&&(n=(1<<c.canonical.z)-1,a--),new fr(c.overscaledZ,a,c.canonical.z,n,c.canonical.y)},c=>{let n=c.canonical.x+1,a=c.wrap;return n===1<<c.canonical.z&&(n=0,a++),new fr(c.overscaledZ,a,c.canonical.z,n,c.canonical.y)},c=>new fr(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,(c.canonical.y===0?1<<c.canonical.z:c.canonical.y)-1),c=>new fr(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y===(1<<c.canonical.z)-1?0:c.canonical.y+1)];Ot(gi,"CanonicalTileID"),Ot(fr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const $s=Bn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ds}=$s,fs=Bn([{name:"a_pos_3",components:3,type:"Int16"}]);var Gs=Bn([{name:"a_pos",type:"Int16",components:2}]);class va{constructor(n,a){this.pos=n,this.dir=a}intersectsPlane(n,a,d){const g=Ie.vec3.dot(a,this.dir);if(Math.abs(g)<1e-6)return!1;const h=((n[0]-this.pos[0])*a[0]+(n[1]-this.pos[1])*a[1]+(n[2]-this.pos[2])*a[2])/g;return d[0]=this.pos[0]+this.dir[0]*h,d[1]=this.pos[1]+this.dir[1]*h,d[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(n,a,d){if(Ie.vec3.equals(this.pos,n)||a===0)return d[0]=d[1]=d[2]=0,!1;const[g,h,y]=this.dir,T=this.pos[0]-n[0],M=this.pos[1]-n[1],D=this.pos[2]-n[2],v=g*g+h*h+y*y,C=2*(T*g+M*h+D*y),I=C*C-4*v*(T*T+M*M+D*D-a*a);if(I<0){const P=Math.max(-C/2,0),A=T+g*P,N=M+h*P,j=D+y*P,V=Math.hypot(A,N,j);return d[0]=A*a/V,d[1]=N*a/V,d[2]=j*a/V,!1}{const P=(-C-Math.sqrt(I))/(2*v);if(P<0){const A=Math.hypot(T,M,D);return d[0]=T*a/A,d[1]=M*a/A,d[2]=D*a/A,!1}return d[0]=T+g*P,d[1]=M+h*P,d[2]=D+y*P,!0}}}class il{constructor(n,a,d,g,h){this.TL=n,this.TR=a,this.BR=d,this.BL=g,this.horizon=h}static fromInvProjectionMatrix(n,a,d){const g=[-1,1,1],h=[1,1,1],y=[1,-1,1],T=[-1,-1,1],M=Ie.vec3.transformMat4(g,g,n),D=Ie.vec3.transformMat4(h,h,n),v=Ie.vec3.transformMat4(y,y,n),C=Ie.vec3.transformMat4(T,T,n);return new il(M,D,v,C,a/d)}}function $o(c,n,a){let d=1/0,g=-1/0;const h=[];for(const y of c){Ie.vec3.sub(h,y,n);const T=Ie.vec3.dot(h,a);d=Math.min(d,T),g=Math.max(g,T)}return[d,g]}function su(c,n){let a=!0;for(let d=0;d<c.planes.length;d++){const g=c.planes[d];let h=0;for(let y=0;y<n.length;y++)h+=Ie.vec3.dot(g,n[y])+g[3]>=0;if(h===0)return 0;h!==n.length&&(a=!1)}return a?2:1}function ou(c,n){for(const a of c.projections){const d=$o(n,c.points[0],a.axis);if(a.projection[1]<d[0]||a.projection[0]>d[1])return 0}return 1}function Yf(c,n){let a=0;const d=[0,0,0,0];for(let g=0;g<c.length;g++)d[0]=c[g][0],d[1]=c[g][1],d[2]=c[g][2],d[3]=1,Ie.vec4.dot(d,n)>=0&&a++;return a}class au{constructor(n,a){this.points=n||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=pr.fromPoints(this.points),this.projections=[],this.frustumEdges=[Ie.vec3.sub([],this.points[2],this.points[3]),Ie.vec3.sub([],this.points[0],this.points[3]),Ie.vec3.sub([],this.points[4],this.points[0]),Ie.vec3.sub([],this.points[5],this.points[1]),Ie.vec3.sub([],this.points[6],this.points[2]),Ie.vec3.sub([],this.points[7],this.points[3])];for(const d of this.frustumEdges){const g=[0,-d[2],d[1]],h=[d[2],0,-d[0]];this.projections.push({axis:g,projection:$o(this.points,this.points[0],g)}),this.projections.push({axis:h,projection:$o(this.points,this.points[0],h)})}}static fromInvProjectionMatrix(n,a,d,g){const h=Math.pow(2,d),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const v=Ie.vec4.transformMat4([],D,n),C=1/v[3]/a*h;return Ie.vec4.mul(v,v,[C,C,g?1/v[3]:C,C])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const v=Ie.vec3.sub([],y[D[0]],y[D[1]]),C=Ie.vec3.sub([],y[D[2]],y[D[1]]),I=Ie.vec3.normalize([],Ie.vec3.cross([],v,C)),P=-Ie.vec3.dot(I,y[D[1]]);return I.concat(P)}),M=[];for(let D=0;D<y.length;D++)M.push([y[D][0],y[D][1],y[D][2]]);return new au(M,T)}intersectsPrecise(n,a,d){for(let g=0;g<a.length;g++)if(!Yf(n,a[g]))return 0;for(let g=0;g<this.planes.length;g++)if(!Yf(n,this.planes[g]))return 0;for(const g of d)for(const h of this.frustumEdges){const y=Ie.vec3.cross([],g,h),T=Ie.vec3.length(y);if(T===0)continue;Ie.vec3.scale(y,y,1/T);const M=$o(this.points,this.points[0],y),D=$o(n,this.points[0],y);if(M[0]>D[1]||D[0]>M[1])return 0}return 1}containsPoint(n){for(const a of this.planes){const d=a[3];if(Ie.vec3.dot([a[0],a[1],a[2]],n)+d<0)return!1}return!0}}class pr{static fromPoints(n){const a=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];for(const g of n)Ie.vec3.min(a,a,g),Ie.vec3.max(d,d,g);return new pr(a,d)}static fromTileIdAndHeight(n,a,d){const g=1<<n.canonical.z,h=n.canonical.x,y=n.canonical.y;return new pr([h/g,y/g,a],[(h+1)/g,(y+1)/g,d])}static applyTransform(n,a){const d=n.getCorners();for(let g=0;g<d.length;++g)Ie.vec3.transformMat4(d[g],d[g],a);return pr.fromPoints(d)}static applyTransformFast(n,a){const d=[a[12],a[13],a[14]],g=[...d];for(let h=0;h<3;h++)for(let y=0;y<3;y++){const T=a[4*y+h],M=T*n.min[y],D=T*n.max[y];d[h]+=Math.min(M,D),g[h]+=Math.max(M,D)}return new pr(d,g)}static projectAabbCorners(n,a){const d=n.getCorners();for(let g=0;g<d.length;++g)Ie.vec3.transformMat4(d[g],d[g],a);return d}constructor(n,a){this.min=n,this.max=a,this.center=Ie.vec3.scale([],Ie.vec3.add([],this.min,this.max),.5)}quadrant(n){const a=[n%2==0,n<2],d=Ie.vec3.clone(this.min),g=Ie.vec3.clone(this.max);for(let h=0;h<a.length;h++)d[h]=a[h]?this.min[h]:this.center[h],g[h]=a[h]?this.center[h]:this.max[h];return g[2]=this.max[2],new pr(d,g)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,a=this.max;return[[n[0],n[1],n[2]],[a[0],n[1],n[2]],[a[0],a[1],n[2]],[n[0],a[1],n[2]],[n[0],n[1],a[2]],[a[0],n[1],a[2]],[a[0],a[1],a[2]],[n[0],a[1],a[2]]]}intersects(n){return this.intersectsAabb(n.bounds)?su(n,this.getCorners()):0}intersectsFlat(n){return this.intersectsAabb(n.bounds)?su(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(n,a){return a||this.intersects(n)?ou(n,this.getCorners()):0}intersectsPreciseFlat(n,a){return a||this.intersectsFlat(n)?ou(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(n){for(let a=0;a<3;++a)if(this.min[a]>n.max[a]||n.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(n){return!(this.min[0]>n.max[0]||n.min[0]>this.max[0]||this.min[1]>n.max[1]||n.min[1]>this.max[1])}encapsulate(n){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],n.min[a]),this.max[a]=Math.max(this.max[a],n.max[a])}encapsulatePoint(n){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],n[a]),this.max[a]=Math.max(this.max[a],n[a])}closestPoint(n){return[Math.max(Math.min(this.max[0],n[0]),this.min[0]),Math.max(Math.min(this.max[1],n[1]),this.min[1]),Math.max(Math.min(this.max[2],n[2]),this.min[2])]}}function Vl(c){return c*i/G}Ot(pr,"Aabb");const Dw=[new pr([R,R,R],[L,L,L]),new pr([R,R,R],[0,0,L]),new pr([0,R,R],[L,0,L]),new pr([R,0,R],[0,L,L]),new pr([0,0,R],[L,L,L])];function a0(c,n,a,d=!0){const g=Ie.vec3.scale([],c._camera.position,c.worldSize),h=[n,a,1,1];Ie.vec4.transformMat4(h,h,c.pixelMatrixInverse),Ie.vec4.scale(h,h,1/h[3]);const y=Ie.vec3.sub([],h,g),T=Ie.vec3.normalize([],y),M=c.globeMatrix,D=[M[12],M[13],M[14]],v=Ie.vec3.sub([],D,g),C=Ie.vec3.length(v),I=Ie.vec3.normalize([],v),P=c.worldSize/(2*Math.PI),A=Ie.vec3.dot(I,T),N=Math.asin(P/C);if(N<Math.acos(A)){if(!d)return null;const Se=[],_e=[];Ie.vec3.scale(Se,T,C/A),Ie.vec3.normalize(_e,Ie.vec3.sub(_e,Se,v)),Ie.vec3.normalize(T,Ie.vec3.add(T,v,Ie.vec3.scale(T,_e,Math.tan(N)*C)))}const j=[];new va(g,T).closestPointOnSphere(D,P,j);const V=Ie.vec3.normalize([],Pl(M,0)),X=Ie.vec3.normalize([],Pl(M,1)),K=Ie.vec3.normalize([],Pl(M,2)),$=Ie.vec3.dot(V,j),ne=Ie.vec3.dot(X,j),ie=Ie.vec3.dot(K,j),ue=vi(Math.asin(-ne/P));let pe=vi(Math.atan2($,ie));pe=c.center.lng+function(Se,_e){const Ce=(_e-Se+180)%360-180;return Ce<-180?Ce+360:Ce}(c.center.lng,pe);const ge=me(pe),he=mn(ye(ue),0,1);return new Ue(ge,he)}class Z8{constructor(n,a,d){this.a=Ie.vec3.sub([],n,d),this.b=Ie.vec3.sub([],a,d),this.center=d;const g=Ie.vec3.normalize([],this.a),h=Ie.vec3.normalize([],this.b);this.angle=Math.acos(Ie.vec3.dot(g,h))}}function Rw(c,n){if(c.angle===0)return null;let a;return a=c.a[n]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[n]/c.a[n]/Math.sin(c.angle)-1/Math.tan(c.angle)),a<0||a>1?null:function(d,g,h,y){const T=Math.sin(h);return d*(Math.sin((1-y)*h)/T)+g*(Math.sin(y*h)/T)}(c.a[n],c.b[n],c.angle,mn(a,0,1))+c.center[n]}function sl(c){if(c.z<=1)return Dw[c.z+2*c.y+c.x];const n=kw(l0(c));return pr.fromPoints(n)}function Ul(c,n,a){return Ie.vec3.scale(c,c,1-a),Ie.vec3.scaleAndAdd(c,c,n,a)}function VA(c,n,a){for(const d of c)Ie.vec3.transformMat4(d,d,n),Ie.vec3.scale(d,d,a)}function UA(c,n,a,d){const g=n/c.worldSize,h=c.globeMatrix;if(a.z<=1){const ge=sl(a).getCorners();return VA(ge,h,g),pr.fromPoints(ge)}const y=l0(a,d),T=kw(y,i+Vl(c._tileCoverLift));VA(T,h,g);const M=Number.MAX_VALUE,D=[-M,-M,-M],v=[M,M,M];if(y.contains(c.center)){for(const Se of T)Ie.vec3.min(v,v,Se),Ie.vec3.max(D,D,Se);D[2]=0;const ge=c.point,he=[ge.x*g,ge.y*g,0];return Ie.vec3.min(v,v,he),Ie.vec3.max(D,D,he),new pr(v,D)}if(c._tileCoverLift>0){for(const ge of T)Ie.vec3.min(v,v,ge),Ie.vec3.max(D,D,ge);return new pr(v,D)}const C=[h[12]*g,h[13]*g,h[14]*g],I=y.getCenter(),P=mn(c.center.lat,-Te,Te),A=mn(I.lat,-Te,Te),N=me(c.center.lng),j=ye(P);let V=N-me(I.lng);const X=j-ye(A);V>.5?V-=1:V<-.5&&(V+=1);let K=0;if(Math.abs(V)>Math.abs(X))K=V>=0?1:3;else{K=X>=0?0:2;const ge=[h[4]*g,h[5]*g,h[6]*g],he=-Math.sin(wn(X>=0?y.getSouth():y.getNorth()))*i;Ie.vec3.scaleAndAdd(C,C,ge,he)}const $=T[K],ne=T[(K+1)%4],ie=new Z8($,ne,C),ue=[Rw(ie,0)||$[0],Rw(ie,1)||$[1],Rw(ie,2)||$[2]],pe=lu(c.zoom);if(pe>0){const ge=function({x:Se,y:_e,z:Ce},Le,je,ze,Fe){const Ze=1/(1<<Ce);let Ve=Se*Ze,rt=Ve+Ze,ct=_e*Ze,Je=ct+Ze,Dt=0;const Pt=(Ve+rt)/2-ze;return Pt>.5?Dt=-1:Pt<-.5&&(Dt=1),Ve=((Ve+Dt)*Le-(ze*=Le))*je+ze,rt=((rt+Dt)*Le-ze)*je+ze,ct=(ct*Le-(Fe*=Le))*je+Fe,Je=(Je*Le-Fe)*je+Fe,[[Ve,Je,0],[rt,Je,0],[rt,ct,0],[Ve,ct,0]]}(a,n,c._pixelsPerMercatorPixel,N,j);for(let Se=0;Se<T.length;Se++)Ul(T[Se],ge[Se],pe);const he=Ie.vec3.add([],ge[K],ge[(K+1)%4]);Ie.vec3.scale(he,he,.5),Ul(ue,he,pe)}for(const ge of T)Ie.vec3.min(v,v,ge),Ie.vec3.max(D,D,ge);return v[2]=Math.min($[2],ne[2]),Ie.vec3.min(v,v,ue),Ie.vec3.max(D,D,ue),new pr(v,D)}function l0({x:c,y:n,z:a},d=!1){const g=1/(1<<a),h=new Y(be(c*g),n===(1<<a)-1&&d?-90:ve((n+1)*g)),y=new Y(be((c+1)*g),n===0&&d?90:ve(n*g));return new se(h,y)}function kw(c,n=i){const a=wn(c.getNorth()),d=wn(c.getSouth()),g=Math.cos(a),h=Math.cos(d),y=Math.sin(a),T=Math.sin(d),M=c.getWest(),D=c.getEast();return[z(h,T,M,n),z(h,T,D,n),z(g,y,D,n),z(g,y,M,n)]}function Rg(c,n,a,d){const g=1<<a.z,h=(c/Mt+a.x)/g;return B(ve((n/Mt+a.y)/g),be(h),d)}function c0({min:c,max:n}){return x/Math.max(n[0]-c[0],n[1]-c[1],n[2]-c[2])}const $A=new Float64Array(16);function u0(c){const n=c0(c),a=Ie.mat4.fromScaling($A,[n,n,n]);return Ie.mat4.translate(a,a,Ie.vec3.negate([],c.min))}function Nw(c){const n=Ie.mat4.fromTranslation($A,c.min),a=1/c0(c);return Ie.mat4.scale(n,n,[a,a,a])}function Lw(c){const n=Mt/(2*Math.PI);return c/(2*Math.PI)/n}function GA(c,n){return Mt/(512*Math.pow(2,c))*c0(sl(n))}function WA(c,n,a,d,g){const h=Lw(a),y=[c,n,-a/(2*Math.PI)],T=Ie.mat4.identity(new Float64Array(16));return Ie.mat4.translate(T,T,y),Ie.mat4.scale(T,T,[h,h,h]),Ie.mat4.rotateX(T,T,wn(-g)),Ie.mat4.rotateY(T,T,wn(-d)),T}function lu(c){return vc(l,p,c)}function HA(c,n){const a=B(n.lat,n.lng),d=function(h){const y=B(h._center.lat,h._center.lng),T=Ie.vec3.fromValues(0,1,0);let M=Ie.vec3.cross([],T,y);const D=Ie.mat4.fromRotation([],-h.angle,y);M=Ie.vec3.transformMat4(M,M,D),Ie.mat4.fromRotation(D,-h._pitch,M);const v=Ie.vec3.normalize([],y);return Ie.vec3.scale(v,v,Vl(h.cameraToCenterDistance/h.pixelsPerMeter)),Ie.vec3.transformMat4(v,v,D),Ie.vec3.add([],y,v)}(c),g=Ie.vec3.subtract([],d,a);return Ie.vec3.angle(g,a)}function Ow(c,n){return HA(c,n)>Math.PI/2*1.01}const qA=wn(85),X8=Math.cos(qA),Y8=Math.sin(qA),K8=Ie.mat4.create(),ZA=c=>{const n=[];return c.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n};function XA(c,n,a,d,g,h,y,T,M){if(h&&c.queryGeometry.isAboveHorizon)return!1;h&&(M*=c.pixelToTileUnitsFactor);const D=c.tileID.canonical,v=a.projection.upVectorScale(D,a.center.lat,a.worldSize).metersToTile;for(const C of n)for(const I of C){const P=I.add(T),A=g&&a.elevation?a.elevation.exaggeration()*g.getElevationAt(P.x,P.y,!0):0,N=a.projection.projectTilePoint(P.x,P.y,D);if(A>0){const K=a.projection.upVector(D,P.x,P.y);N.x+=K[0]*v*A,N.y+=K[1]*v*A,N.z+=K[2]*v*A}const j=h?P:J8(N.x,N.y,N.z,d),V=h?c.tilespaceRays.map(K=>eU(K,A)):c.queryGeometry.screenGeometry,X=Ie.vec4.transformMat4([],[N.x,N.y,N.z,1],d);if(!y&&h?M*=X[3]/a.cameraToCenterDistance:y&&!h&&(M*=a.cameraToCenterDistance/X[3]),h){const K=ve((I.y/Mt+D.y)/(1<<D.z));M/=a.projection.pixelsPerMeter(K,1)/fe(1,K)}if(Nt(V,j,M))return!0}return!1}function J8(c,n,a,d){const g=Ie.vec4.transformMat4([],[c,n,a,1],d);return new Tt(g[0]/g[3],g[1]/g[3])}const YA=Ie.vec3.fromValues(0,0,0),Q8=Ie.vec3.fromValues(0,0,1);function eU(c,n){const a=Ie.vec3.create();return YA[2]=n,c.intersectsPlane(YA,Q8,a),new Tt(a[0],a[1])}class KA extends Wt{}let JA,QA,eI,tI;function nI(c,{width:n,height:a},d,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==n*a*d)throw new RangeError("mismatched image size")}else g=new Uint8Array(n*a*d);return c.width=n,c.height=a,c.data=g,c}function rI(c,n,a){const{width:d,height:g}=n;d===c.width&&g===c.height||(jw(c,n,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,d),height:Math.min(c.height,g)},a,null),c.width=d,c.height=g,c.data=n.data)}function jw(c,n,a,d,g,h,y,T){if(g.width===0||g.height===0)return n;if(g.width>c.width||g.height>c.height||a.x>c.width-g.width||a.y>c.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>n.width||g.height>n.height||d.x>n.width-g.width||d.y>n.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const M=c.data,D=n.data,v=h===4&&T;for(let C=0;C<g.height;C++){const I=((a.y+C)*c.width+a.x)*h,P=((d.y+C)*n.width+d.x)*h;if(v)for(let A=0;A<g.width;A++){const N=I+A*h+3,j=P+A*h;D[j+0]=255,D[j+1]=255,D[j+2]=255,D[j+3]=M[N]}else if(y)for(let A=0;A<g.width;A++){const N=I+A*h,j=P+A*h,V=M[N+3],X=new Yn(M[N+0]/255*V,M[N+1]/255*V,M[N+2]/255*V,V).toRenderColor(y).toArray();D[j+0]=X[0],D[j+1]=X[1],D[j+2]=X[2],D[j+3]=X[3]}else for(let A=0;A<g.width*h;A++)D[P+A]=M[I+A]}return n}Ot(KA,"HeatmapBucket",{omit:["layers"]});class cu{constructor(n,a){nI(this,n,1,a)}resize(n){rI(this,new cu(n),1)}clone(){return new cu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,a,d,g,h){jw(n,a,d,g,h,1,null)}}class ts{constructor(n,a){nI(this,n,4,a)}resize(n){rI(this,new ts(n),4)}replace(n,a){a?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new ts({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,a,d,g,h,y,T){jw(n,a,d,g,h,4,y,T)}}class iI{constructor(n,a){this.width=n.width,this.height=n.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}function kg(c){const n={},a=c.resolution||256,d=c.clips?c.clips.length:1,g=c.image||new ts({width:a,height:d}),h=(y,T,M)=>{n[c.evaluationKey]=M;const D=c.expression.evaluate(n);D&&(g.data[y+T+0]=Math.floor(255*D.r/D.a),g.data[y+T+1]=Math.floor(255*D.g/D.a),g.data[y+T+2]=Math.floor(255*D.b/D.a),g.data[y+T+3]=Math.floor(255*D.a))};if(c.clips)for(let y=0,T=0;y<d;++y,T+=4*a)for(let M=0,D=0;M<a;M++,D+=4){const v=M/(a-1),{start:C,end:I}=c.clips[y];h(T,D,C*(1-v)+I*v)}else for(let y=0,T=0;y<a;y++,T+=4)h(0,T,y/(a-1));return g}Ot(cu,"AlphaImage"),Ot(ts,"RGBAImage");const tU=Bn([{name:"a_pos",components:2,type:"Int16"}],4),{members:nU}=tU;function Ng(c,n,a=2){const d=n&&n.length,g=d?n[0]*a:c.length;let h=sI(c,0,g,a,!0);const y=[];if(!h||h.next===h.prev)return y;let T,M,D;if(d&&(h=function(v,C,I,P){const A=[];for(let N=0,j=C.length;N<j;N++){const V=sI(v,C[N]*P,N<j-1?C[N+1]*P:v.length,P,!1);V===V.next&&(V.steiner=!0),A.push(uU(V))}A.sort(aU);for(let N=0;N<A.length;N++)I=lU(A[N],I);return I}(c,n,h,a)),c.length>80*a){T=1/0,M=1/0;let v=-1/0,C=-1/0;for(let I=a;I<g;I+=a){const P=c[I],A=c[I+1];P<T&&(T=P),A<M&&(M=A),P>v&&(v=P),A>C&&(C=A)}D=Math.max(v-T,C-M),D=D!==0?32767/D:0}return Lg(h,y,a,T,M,D,0),y}function sI(c,n,a,d,g){let h;if(g===function(y,T,M,D){let v=0;for(let C=T,I=M-D;C<M;C+=D)v+=(y[I]-y[C])*(y[C+1]+y[I+1]),I=C;return v}(c,n,a,d)>0)for(let y=n;y<a;y+=d)h=lI(y/d|0,c[y],c[y+1],h);else for(let y=a-d;y>=n;y-=d)h=lI(y/d|0,c[y],c[y+1],h);return h&&d0(h,h.next)&&(jg(h),h=h.next),h}function Jd(c,n){if(!c)return c;n||(n=c);let a,d=c;do if(a=!1,d.steiner||!d0(d,d.next)&&li(d.prev,d,d.next)!==0)d=d.next;else{if(jg(d),d=n=d.prev,d===d.next)break;a=!0}while(a||d!==n);return n}function Lg(c,n,a,d,g,h,y){if(!c)return;!y&&h&&function(M,D,v,C){let I=M;do I.z===0&&(I.z=zw(I.x,I.y,D,v,C)),I.prevZ=I.prev,I.nextZ=I.next,I=I.next;while(I!==M);I.prevZ.nextZ=null,I.prevZ=null,function(P){let A,N=1;do{let j,V=P;P=null;let X=null;for(A=0;V;){A++;let K=V,$=0;for(let ie=0;ie<N&&($++,K=K.nextZ,K);ie++);let ne=N;for(;$>0||ne>0&&K;)$!==0&&(ne===0||!K||V.z<=K.z)?(j=V,V=V.nextZ,$--):(j=K,K=K.nextZ,ne--),X?X.nextZ=j:P=j,j.prevZ=X,X=j;V=K}X.nextZ=null,N*=2}while(A>1)}(I)}(c,d,g,h);let T=c;for(;c.prev!==c.next;){const M=c.prev,D=c.next;if(h?iU(c,d,g,h):rU(c))n.push(M.i,c.i,D.i),jg(c),c=D.next,T=D.next;else if((c=D)===T){y?y===1?Lg(c=sU(Jd(c),n),n,a,d,g,h,2):y===2&&oU(c,n,a,d,g,h):Lg(Jd(c),n,a,d,g,h,1);break}}}function rU(c){const n=c.prev,a=c,d=c.next;if(li(n,a,d)>=0)return!1;const g=n.x,h=a.x,y=d.x,T=n.y,M=a.y,D=d.y,v=g<h?g<y?g:y:h<y?h:y,C=T<M?T<D?T:D:M<D?M:D,I=g>h?g>y?g:y:h>y?h:y,P=T>M?T>D?T:D:M>D?M:D;let A=d.next;for(;A!==n;){if(A.x>=v&&A.x<=I&&A.y>=C&&A.y<=P&&Kf(g,T,h,M,y,D,A.x,A.y)&&li(A.prev,A,A.next)>=0)return!1;A=A.next}return!0}function iU(c,n,a,d){const g=c.prev,h=c,y=c.next;if(li(g,h,y)>=0)return!1;const T=g.x,M=h.x,D=y.x,v=g.y,C=h.y,I=y.y,P=T<M?T<D?T:D:M<D?M:D,A=v<C?v<I?v:I:C<I?C:I,N=T>M?T>D?T:D:M>D?M:D,j=v>C?v>I?v:I:C>I?C:I,V=zw(P,A,n,a,d),X=zw(N,j,n,a,d);let K=c.prevZ,$=c.nextZ;for(;K&&K.z>=V&&$&&$.z<=X;){if(K.x>=P&&K.x<=N&&K.y>=A&&K.y<=j&&K!==g&&K!==y&&Kf(T,v,M,C,D,I,K.x,K.y)&&li(K.prev,K,K.next)>=0||(K=K.prevZ,$.x>=P&&$.x<=N&&$.y>=A&&$.y<=j&&$!==g&&$!==y&&Kf(T,v,M,C,D,I,$.x,$.y)&&li($.prev,$,$.next)>=0))return!1;$=$.nextZ}for(;K&&K.z>=V;){if(K.x>=P&&K.x<=N&&K.y>=A&&K.y<=j&&K!==g&&K!==y&&Kf(T,v,M,C,D,I,K.x,K.y)&&li(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;$&&$.z<=X;){if($.x>=P&&$.x<=N&&$.y>=A&&$.y<=j&&$!==g&&$!==y&&Kf(T,v,M,C,D,I,$.x,$.y)&&li($.prev,$,$.next)>=0)return!1;$=$.nextZ}return!0}function sU(c,n){let a=c;do{const d=a.prev,g=a.next.next;!d0(d,g)&&oI(d,a,a.next,g)&&Og(d,g)&&Og(g,d)&&(n.push(d.i,a.i,g.i),jg(a),jg(a.next),a=c=g),a=a.next}while(a!==c);return Jd(a)}function oU(c,n,a,d,g,h){let y=c;do{let T=y.next.next;for(;T!==y.prev;){if(y.i!==T.i&&dU(y,T)){let M=aI(y,T);return y=Jd(y,y.next),M=Jd(M,M.next),Lg(y,n,a,d,g,h,0),void Lg(M,n,a,d,g,h,0)}T=T.next}y=y.next}while(y!==c)}function aU(c,n){return c.x-n.x}function lU(c,n){const a=function(g,h){let y=h;const T=g.x,M=g.y;let D,v=-1/0;do{if(M<=y.y&&M>=y.next.y&&y.next.y!==y.y){const N=y.x+(M-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(N<=T&&N>v&&(v=N,D=y.x<y.next.x?y:y.next,N===T))return D}y=y.next}while(y!==h);if(!D)return null;const C=D,I=D.x,P=D.y;let A=1/0;y=D;do{if(T>=y.x&&y.x>=I&&T!==y.x&&Kf(M<P?T:v,M,I,P,M<P?v:T,M,y.x,y.y)){const N=Math.abs(M-y.y)/(T-y.x);Og(y,g)&&(N<A||N===A&&(y.x>D.x||y.x===D.x&&cU(D,y)))&&(D=y,A=N)}y=y.next}while(y!==C);return D}(c,n);if(!a)return n;const d=aI(a,c);return Jd(d,d.next),Jd(a,a.next)}function cU(c,n){return li(c.prev,c,n.prev)<0&&li(n.next,c,c.next)<0}function zw(c,n,a,d,g){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-a)*g|0)|c<<8))|c<<4))|c<<2))|c<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-d)*g|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function uU(c){let n=c,a=c;do(n.x<a.x||n.x===a.x&&n.y<a.y)&&(a=n),n=n.next;while(n!==c);return a}function Kf(c,n,a,d,g,h,y,T){return(g-y)*(n-T)>=(c-y)*(h-T)&&(c-y)*(d-T)>=(a-y)*(n-T)&&(a-y)*(h-T)>=(g-y)*(d-T)}function dU(c,n){return c.next.i!==n.i&&c.prev.i!==n.i&&!function(a,d){let g=a;do{if(g.i!==a.i&&g.next.i!==a.i&&g.i!==d.i&&g.next.i!==d.i&&oI(g,g.next,a,d))return!0;g=g.next}while(g!==a);return!1}(c,n)&&(Og(c,n)&&Og(n,c)&&function(a,d){let g=a,h=!1;const y=(a.x+d.x)/2,T=(a.y+d.y)/2;do g.y>T!=g.next.y>T&&g.next.y!==g.y&&y<(g.next.x-g.x)*(T-g.y)/(g.next.y-g.y)+g.x&&(h=!h),g=g.next;while(g!==a);return h}(c,n)&&(li(c.prev,c,n.prev)||li(c,n.prev,n))||d0(c,n)&&li(c.prev,c,c.next)>0&&li(n.prev,n,n.next)>0)}function li(c,n,a){return(n.y-c.y)*(a.x-n.x)-(n.x-c.x)*(a.y-n.y)}function d0(c,n){return c.x===n.x&&c.y===n.y}function oI(c,n,a,d){const g=f0(li(c,n,a)),h=f0(li(c,n,d)),y=f0(li(a,d,c)),T=f0(li(a,d,n));return g!==h&&y!==T||!(g!==0||!h0(c,a,n))||!(h!==0||!h0(c,d,n))||!(y!==0||!h0(a,c,d))||!(T!==0||!h0(a,n,d))}function h0(c,n,a){return n.x<=Math.max(c.x,a.x)&&n.x>=Math.min(c.x,a.x)&&n.y<=Math.max(c.y,a.y)&&n.y>=Math.min(c.y,a.y)}function f0(c){return c>0?1:c<0?-1:0}function Og(c,n){return li(c.prev,c,c.next)<0?li(c,n,c.next)>=0&&li(c,c.prev,n)>=0:li(c,n,c.prev)<0||li(c,c.next,n)<0}function aI(c,n){const a=Fw(c.i,c.x,c.y),d=Fw(n.i,n.x,n.y),g=c.next,h=n.prev;return c.next=n,n.prev=c,a.next=g,g.prev=a,d.next=a,a.prev=d,h.next=d,d.prev=h,d}function lI(c,n,a,d){const g=Fw(c,n,a);return d?(g.next=d.next,g.prev=d,d.next.prev=g,d.next=g):(g.prev=g,g.next=g),g}function jg(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Fw(c,n,a){return{i:c,x:n,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function p0(c,n){const a=c.length;if(a<=1)return[c];const d=[];let g,h;for(let y=0;y<a;y++){const T=Xh(c[y]);T!==0&&(c[y].area=Math.abs(T),h===void 0&&(h=T<0),h===T<0?(g&&d.push(g),g=[c[y]]):g.push(c[y]))}if(g&&d.push(g),n>1)for(let y=0;y<d.length;y++)d[y].length<=n||(cx(d[y],n,1,d[y].length-1,hU),d[y]=d[y].slice(0,n));return d}function hU(c,n){return n.area-c.area}function Bw(c,n,a){const d=a.patternDependencies;let g=!1;for(const h of n){const y=h.paint.get(`${c}-pattern`);y.isConstant()||(g=!0);const T=y.constantOr(null);T&&(g=!0,d[T]=!0)}return g}function Vw(c,n,a,d,g){const h=g.patternDependencies;for(const y of n){const T=y.paint.get(`${c}-pattern`).value;if(T.kind!=="constant"){let M=T.evaluate({zoom:d},a,{},g.availableImages);M=M&&M.name?M.name:M,h[M]=!0,a.patterns[y.id]=M}}return a}class Uw{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Qa,this.indexArray=new Ri,this.indexArray2=new nl,this.programConfigurations=new rl(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new Nr,this.segments2=new Nr,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=n.projection}updateFootprints(n,a){}populate(n,a,d,g){this.hasPattern=Bw("fill",this.layers,a);const h=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:T,id:M,index:D,sourceLayerIndex:v}of n){const C=this.layers[0]._featureFilter.needGeometry,I=vt(T,C);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),I,d))continue;const P=h?h.evaluate(I,{},d,a.availableImages):void 0,A={id:M,properties:T.properties,type:T.type,sourceLayerIndex:v,index:D,geometry:C?I.geometry:_t(T,d,g),patterns:{},sortKey:P};y.push(A)}h&&y.sort((T,M)=>T.sortKey-M.sortKey);for(const T of y){const{geometry:M,index:D,sourceLayerIndex:v}=T;if(this.hasPattern){const C=Vw("fill",this.layers,T,this.zoom,a);this.patternFeatures.push(C)}else this.addFeature(T,M,D,d,{},a.availableImages,a.brightness);a.featureIndex.insert(n[D].feature,M,D,v,this.index)}}update(n,a,d,g,h){const y=Object.keys(n).length!==0;y&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,a,y?this.stateDependentLayers:this.layers,d,g,h)}addFeatures(n,a,d,g,h,y){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,a,d,g,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,nU),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,a,d,g,h,y=[],T){for(const M of p0(a,500)){let D=0;for(const N of M)D+=N.length;const v=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),C=v.vertexLength,I=[],P=[];for(const N of M){if(N.length===0)continue;N!==M[0]&&P.push(I.length/2);const j=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),V=j.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(V+N.length-1,V),I.push(N[0].x),I.push(N[0].y);for(let X=1;X<N.length;X++)this.layoutVertexArray.emplaceBack(N[X].x,N[X].y),this.indexArray2.emplaceBack(V+X-1,V+X),I.push(N[X].x),I.push(N[X].y);j.vertexLength+=N.length,j.primitiveLength+=N.length}const A=Ng(I,P);for(let N=0;N<A.length;N+=3)this.indexArray.emplaceBack(C+A[N],C+A[N+1],C+A[N+2]);v.vertexLength+=D,v.primitiveLength+=A.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,h,y,g,T)}}let cI,uI,dI,hI;Ot(Uw,"FillBucket",{omit:["layers","patternFeatures"]});class $w{constructor(n,a,d,g){if(this.triangleCount=a.length/3,this.min=new Tt(0,0),this.max=new Tt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||n.length===0)return;const[h,y]=[n[0].clone(),n[0].clone()];for(let C=1;C<n.length;++C){const I=n[C];h.x=Math.min(h.x,I.x),h.y=Math.min(h.y,I.y),y.x=Math.max(y.x,I.x),y.y=Math.max(y.y,I.y)}if(g){const C=Math.ceil(Math.max(y.x-h.x,y.y-h.y)/g);d=Math.max(d,C)}if(d===0)return;this.min=h,this.max=y;const T=this.max.sub(this.min);T.x=Math.max(T.x,1),T.y=Math.max(T.y,1);const M=Math.max(T.x,T.y)/d;this.cellsX=Math.max(1,Math.ceil(T.x/M)),this.cellsY=Math.max(1,Math.ceil(T.y/M)),this.xScale=1/M,this.yScale=1/M;const D=[];for(let C=0;C<this.triangleCount;C++){const I=n[a[3*C+0]].sub(this.min),P=n[a[3*C+1]].sub(this.min),A=n[a[3*C+2]].sub(this.min),N=ol(Math.floor(Math.min(I.x,P.x,A.x)),this.xScale,this.cellsX),j=ol(Math.floor(Math.max(I.x,P.x,A.x)),this.xScale,this.cellsX),V=ol(Math.floor(Math.min(I.y,P.y,A.y)),this.yScale,this.cellsY),X=ol(Math.floor(Math.max(I.y,P.y,A.y)),this.yScale,this.cellsY),K=new Tt(0,0),$=new Tt(0,0),ne=new Tt(0,0),ie=new Tt(0,0);for(let ue=V;ue<=X;++ue){K.y=$.y=ue*M,ne.y=ie.y=(ue+1)*M;for(let pe=N;pe<=j;++pe)K.x=ne.x=pe*M,$.x=ie.x=(pe+1)*M,(sr(I,P,A,K,$,ie)||sr(I,P,A,K,ie,ne))&&D.push({cellIdx:ue*this.cellsX+pe,triIdx:C})}}if(D.length===0)return;D.sort((C,I)=>C.cellIdx-I.cellIdx||C.triIdx-I.triIdx);let v=0;for(;v<D.length;){const C=D[v].cellIdx,I={start:this.payload.length,len:0};for(;v<D.length&&D[v].cellIdx===C;)++I.len,this.payload.push(D[v++].triIdx);this.cells[C]=I}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(n,a){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>n.x||n.y>this.max.y||this.min.y>n.y)return;const d=ol(n.x-this.min.x,this.xScale,this.cellsX),g=ol(n.y-this.min.y,this.yScale,this.cellsY),h=this.cells[g*this.cellsX+d];if(h){this._lazyInitLookup();for(let y=0;y<h.len;y++){const T=this.payload[h.start+y],M=Math.floor(T/8),D=1<<T%8;if(!(this.lookup[M]&D)&&(this.lookup[M]|=D,a.push(T),a.length===this.triangleCount))return}}}query(n,a,d){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>a.x||n.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();const g=ol(n.x-this.min.x,this.xScale,this.cellsX),h=ol(a.x-this.min.x,this.xScale,this.cellsX),y=ol(n.y-this.min.y,this.yScale,this.cellsY),T=ol(a.y-this.min.y,this.yScale,this.cellsY);for(let M=y;M<=T;M++)for(let D=g;D<=h;D++){const v=this.cells[M*this.cellsX+D];if(v)for(let C=0;C<v.len;C++){const I=this.payload[v.start+C],P=Math.floor(I/8),A=1<<I%8;if(!(this.lookup[P]&A)&&(this.lookup[P]|=A,d.push(I),d.length===this.triangleCount))return}}}}function ol(c,n,a){return Math.max(0,Math.min(a-1,Math.floor(c*n)))}Ot($w,"TriangleGridIndex");class fI{constructor(n){this.zoom=n.zoom,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=n.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.footprints=[]}updateFootprints(n,a){for(const d of this.footprints)a.push({footprint:d,id:n})}populate(n,a,d,g){const h=[];for(const{feature:y,id:T,index:M,sourceLayerIndex:D}of n){const v=this.layers[0]._featureFilter.needGeometry,C=vt(y,v);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),C,d))continue;const I={id:T,properties:y.properties,type:y.type,sourceLayerIndex:D,index:M,geometry:v?C.geometry:_t(y,d,g),patterns:{}};h.push(I)}for(const y of h){const{geometry:T,index:M,sourceLayerIndex:D}=y;this.addFeature(y,T,M,d,{},a.availableImages,a.brightness),a.featureIndex.insert(n[M].feature,T,M,D,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(n){}update(n,a,d,g,h){}destroy(){}addFeature(n,a,d,g,h,y=[],T){for(const M of p0(a,2)){const D=[],v=[],C=[],I=new Tt(1/0,1/0),P=new Tt(-1/0,-1/0);for(const j of M)if(j.length!==0){j!==M[0]&&C.push(v.length/2);for(let V=0;V<j.length;V++)v.push(j[V].x),v.push(j[V].y),D.push(j[V]),I.x=Math.min(I.x,j[V].x),I.y=Math.min(I.y,j[V].y),P.x=Math.max(P.x,j[V].x),P.y=Math.max(P.y,j[V].y)}const A=Ng(v,C),N=new $w(D,A,8,256);this.footprints.push({vertices:D,indices:A,grid:N,min:I,max:P})}}}Ot(fI,"ClipBucket",{omit:["layers"]});const fU=Bn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),pU=Bn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),mU=Bn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),gU=Bn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),yU=Bn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),_U=Bn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:xU}=fU;var Gw,pI,Ww,mI,Hw,gI,yI,m0={};function _I(){if(pI)return Gw;pI=1;var c=Fi();function n(g,h,y,T,M){this.properties={},this.extent=y,this.type=0,this._pbf=g,this._geometry=-1,this._keys=T,this._values=M,g.readFields(a,this,h)}function a(g,h,y){g==1?h.id=y.readVarint():g==2?function(T,M){for(var D=T.readVarint()+T.pos;T.pos<D;){var v=M._keys[T.readVarint()],C=M._values[T.readVarint()];M.properties[v]=C}}(y,h):g==3?h.type=y.readVarint():g==4&&(h._geometry=y.pos)}function d(g){for(var h,y,T=0,M=0,D=g.length,v=D-1;M<D;v=M++)T+=((y=g[v]).x-(h=g[M]).x)*(h.y+y.y);return T}return Gw=n,n.types=["Unknown","Point","LineString","Polygon"],n.prototype.loadGeometry=function(){var g=this._pbf;g.pos=this._geometry;for(var h,y=g.readVarint()+g.pos,T=1,M=0,D=0,v=0,C=[];g.pos<y;){if(M<=0){var I=g.readVarint();T=7&I,M=I>>3}if(M--,T===1||T===2)D+=g.readSVarint(),v+=g.readSVarint(),T===1&&(h&&C.push(h),h=[]),h.push(new c(D,v));else{if(T!==7)throw new Error("unknown command "+T);h&&h.push(h[0].clone())}}return h&&C.push(h),C},n.prototype.bbox=function(){var g=this._pbf;g.pos=this._geometry;for(var h=g.readVarint()+g.pos,y=1,T=0,M=0,D=0,v=1/0,C=-1/0,I=1/0,P=-1/0;g.pos<h;){if(T<=0){var A=g.readVarint();y=7&A,T=A>>3}if(T--,y===1||y===2)(M+=g.readSVarint())<v&&(v=M),M>C&&(C=M),(D+=g.readSVarint())<I&&(I=D),D>P&&(P=D);else if(y!==7)throw new Error("unknown command "+y)}return[v,I,C,P]},n.prototype.toGeoJSON=function(g,h,y){var T,M,D=this.extent*Math.pow(2,y),v=this.extent*g,C=this.extent*h,I=this.loadGeometry(),P=n.types[this.type];function A(V){for(var X=0;X<V.length;X++){var K=V[X];V[X]=[360*(K.x+v)/D-180,360/Math.PI*Math.atan(Math.exp((180-360*(K.y+C)/D)*Math.PI/180))-90]}}switch(this.type){case 1:var N=[];for(T=0;T<I.length;T++)N[T]=I[T][0];A(I=N);break;case 2:for(T=0;T<I.length;T++)A(I[T]);break;case 3:for(I=function(V){var X=V.length;if(X<=1)return[V];for(var K,$,ne=[],ie=0;ie<X;ie++){var ue=d(V[ie]);ue!==0&&($===void 0&&($=ue<0),$===ue<0?(K&&ne.push(K),K=[V[ie]]):K.push(V[ie]))}return K&&ne.push(K),ne}(I),T=0;T<I.length;T++)for(M=0;M<I[T].length;M++)A(I[T][M])}I.length===1?I=I[0]:P="Multi"+P;var j={type:"Feature",geometry:{type:P,coordinates:I},properties:this.properties};return"id"in this&&(j.id=this.id),j},Gw}function xI(){if(mI)return Ww;mI=1;var c=_I();function n(d,g){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=d,this._keys=[],this._values=[],this._features=[],d.readFields(a,this,g),this.length=this._features.length}function a(d,g,h){d===15?g.version=h.readVarint():d===1?g.name=h.readString():d===5?g.extent=h.readVarint():d===2?g._features.push(h.pos):d===3?g._keys.push(h.readString()):d===4&&g._values.push(function(y){for(var T=null,M=y.readVarint()+y.pos;y.pos<M;){var D=y.readVarint()>>3;T=D===1?y.readString():D===2?y.readFloat():D===3?y.readDouble():D===4?y.readVarint64():D===5?y.readVarint():D===6?y.readSVarint():D===7?y.readBoolean():null}return T}(h))}return Ww=n,n.prototype.feature=function(d){if(d<0||d>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[d];var g=this._pbf.readVarint()+this._pbf.pos;return new c(this._pbf,g,this.extent,this._keys,this._values)},Ww}function vI(){return yI||(yI=1,m0.VectorTile=function(){if(gI)return Hw;gI=1;var c=xI();function n(a,d,g){if(a===3){var h=new c(g,g.readVarint()+g.pos);h.length&&(d[h.name]=h)}}return Hw=function(a,d){this.layers=a.readFields(n,{},d)},Hw}(),m0.VectorTileFeature=_I(),m0.VectorTileLayer=xI()),m0}var Jf=vI();class Qd extends Tt{constructor(n,a,d){super(n,a),this.z=d}}class bI extends Qd{constructor(n,a,d,g){super(n,a,d),this.w=g}}function g0(c,n,a,d){const g=[],h=d===0?(y,T,M,D,v,C)=>{y.push(new Tt(C,M+(C-T)/(D-T)*(v-M)))}:(y,T,M,D,v,C)=>{y.push(new Tt(T+(C-M)/(v-M)*(D-T),C))};for(const y of c){const T=[];for(const M of y){if(M.length<=2)continue;const D=[];for(let I=0;I<M.length-1;I++){const P=M[I].x,A=M[I].y,N=M[I+1].x,j=M[I+1].y,V=d===0?P:A,X=d===0?N:j;V<n?X>n&&h(D,P,A,N,j,n):V>a?X<a&&h(D,P,A,N,j,a):D.push(M[I]),X<n&&V>=n&&h(D,P,A,N,j,n),X>a&&V<=a&&h(D,P,A,N,j,a)}let v=M[M.length-1];const C=d===0?v.x:v.y;C>=n&&C<=a&&D.push(v),D.length&&(v=D[D.length-1],D[0].x===v.x&&D[0].y===v.y||D.push(D[0]),T.push(D))}T.length&&g.push(T)}return g}function wI(c,n,a,d){const g=a==="x"?"y":"x",h=(d-c[a])/(n[a]-c[a]);c[g]=c[g]+(n[g]-c[g])*h,c[a]=d,c.hasOwnProperty("z")&&(c.z=Xt(c.z,n.z,h)),c.hasOwnProperty("w")&&(c.w=Xt(c.w,n.w,h))}function SI(c,n,a,d){const g=a,h=d;for(const y of["x","y"]){let T=c,M=n;T[y]>=M[y]&&(T=n,M=c),T[y]<g&&M[y]>g&&wI(T,M,y,g),T[y]<h&&M[y]>h&&wI(M,T,y,h)}}const y0=Number.MAX_SAFE_INTEGER;function TI(c,n,a,d){return c.order<n||c.order===y0||!(c.clipMask&a)||function(g,h){return h.length!==0&&h.find(y=>y===g)===void 0}(d,c.clipScope)}function _0(c,n){return c.x-n.x||c.y-n.y}function EI(c,n){return _0(c.min,n.min)===0&&_0(c.max,n.max)===0}function qw(c,n){return!(c.min.x>n.max.x||c.max.x<n.min.x||c.min.y>n.max.y||c.max.y<n.min.y)}function Zw(c,n){if(c.length!==n.length)return!1;for(let a=0;a<c.length;a++)if(c[a].sourceId!==n[a].sourceId||!EI(c[a],n[a])||c[a].order!==n[a].order||c[a].clipMask!==n[a].clipMask||!ws(c[a].clipScope,n[a].clipScope))return!1;return!0}function CI(c,n,a){const d=1/Mt,g=1/(1<<a.canonical.z),h=(n.x*d+a.canonical.x)*g+a.wrap,y=(n.y*d+a.canonical.y)*g;return{min:new Tt((c.x*d+a.canonical.x)*g+a.wrap,(c.y*d+a.canonical.y)*g),max:new Tt(h,y)}}function vU(c,n,a){const d=1<<a.canonical.z,g=((n.x-a.wrap)*d-a.canonical.x)*Mt,h=(n.y*d-a.canonical.y)*Mt;return{min:new Tt(((c.x-a.wrap)*d-a.canonical.x)*Mt,(c.y*d-a.canonical.y)*Mt),max:new Tt(g,h)}}function PI(c,n,a,d,g,h,y){const T=c.indices,M=c.vertices,D=[];for(let v=d;v<d+g;v+=3){const C=n[a[v+0]+h],I=n[a[v+1]+h],P=n[a[v+2]+h],A=Math.min(C.x,I.x,P.x),N=Math.max(C.x,I.x,P.x),j=Math.min(C.y,I.y,P.y),V=Math.max(C.y,I.y,P.y);D.length=0,c.grid.query(new Tt(A,j),new Tt(N,V),D);for(let X=0;X<D.length;X++){const K=D[X];if(sr(M[T[3*K+0]],M[T[3*K+1]],M[T[3*K+2]],C,I,P,y))return!0}}return!1}function MI(c,n,a,d){if(!c||!a)return!1;let g=c.vertices;if(!n.canonical.equals(d.canonical)||n.wrap!==d.wrap){if(a.vertices.length<c.vertices.length)return MI(a,d,c,n);const h=n.canonical,y=d.canonical,T=Math.pow(2,y.z-h.z);g=c.vertices.map(M=>new Tt((M.x+h.x*Mt)*T-y.x*Mt,(M.y+h.y*Mt)*T-y.y*Mt))}return PI(a,g,c.indices,0,c.indices.length,0,0)}function AI(c,n,a,d){const g=Math.pow(2,d.z-a.z);return new Tt((c+a.x*Mt)*g-d.x*Mt,(n+a.y*Mt)*g-d.y*Mt)}function II(c,n){const a=[];n.grid.queryPoint(c,a);const d=n.indices,g=n.vertices;for(let h=0;h<a.length;h++){const y=a[h];if(yr([g[d[3*y+0]],g[d[3*y+1]],g[d[3*y+2]]],c))return!0}return!1}const Xw=[new Tt(0,0),new Tt(Mt,0),new Tt(Mt,Mt),new Tt(0,Mt)];function DI(c,n){const a=[];let d=[];if(!n||c.length<2)return[c];if(c.length===2)return Vr(c[0],c[1],Xw)?[c]:[];for(let g=0;g<c.length+2;g++){const h=c[g%c.length],y=c[(g+1)%c.length],T=Vr(g===0?c[c.length-1]:c[(g-1)%c.length],h,Xw),M=Vr(h,y,Xw),D=T||M;D&&d.push(h),D&&M||d.length>0&&(d.length>1&&a.push(d),d=[])}return d.length>1&&a.push(d),a}const Yw=Jf.VectorTileFeature.types,bU=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],wU=["fill-extrusion-flood-light-ground-radius"],SU=Math.pow(2,13),TU=Math.pow(2,15)-1,RI=new Tt(0,1),uu=2147483648;function zg(c,n,a,d,g,h,y,T){c.emplaceBack((n<<1)+y,(a<<1)+h,(Math.floor(d*SU)<<1)+g,Math.round(T))}function Fg(c,n,a){c.emplaceBack(n.x*Mt,n.y*Mt,a?1:0)}function x0(c,n,a,d,g,h){c.emplaceBack(n.x,n.y,(a.x<<1)+d,(a.y<<1)+g,h)}function Bg(c,n,a){c.emplaceBack(n.x,n.y,n.z,a[0]*16384,a[1]*16384,a[2]*16384)}class kI{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class NI{constructor(){this.centroidXY=new Tt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Tt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Tt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Tt(this.max.x-this.min.x,this.max.y-this.min.y)}}class LI{constructor(){this.acc=new Tt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(n,a){n.min.x===Number.MAX_VALUE&&(n.min.x=n.max.x=a.x,n.min.y=n.max.y=a.y)}appendEdge(n,a,d){this.accCount++,this.acc._add(a);let g=!!this.borders;a.x<n.min.x?(n.min.x=a.x,g=!0):a.x>n.max.x&&(n.max.x=a.x,g=!0),a.y<n.min.y?(n.min.y=a.y,g=!0):a.y>n.max.y&&(n.max.y=a.y,g=!0),((a.x===0||a.x===Mt)&&a.x===d.x)!=((a.y===0||a.y===Mt)&&a.y===d.y)&&this.processBorderOverlap(a,d),g&&this.checkBorderIntersection(a,d)}checkBorderIntersection(n,a){a.x<0!=n.x<0&&this.addBorderIntersection(0,Xt(a.y,n.y,(0-a.x)/(n.x-a.x))),a.x>Mt!=n.x>Mt&&this.addBorderIntersection(1,Xt(a.y,n.y,(Mt-a.x)/(n.x-a.x))),a.y<0!=n.y<0&&this.addBorderIntersection(2,Xt(a.x,n.x,(0-a.y)/(n.y-a.y))),a.y>Mt!=n.y>Mt&&this.addBorderIntersection(3,Xt(a.x,n.x,(Mt-a.y)/(n.y-a.y)))}addBorderIntersection(n,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const d=this.borders[n];a<d[0]&&(d[0]=a),a>d[1]&&(d[1]=a)}processBorderOverlap(n,a){if(n.x===a.x){if(n.y===a.y)return;const d=n.x===0?0:1;this.addBorderIntersection(d,a.y),this.addBorderIntersection(d,n.y)}else{const d=n.y===0?2:3;this.addBorderIntersection(d,a.x),this.addBorderIntersection(d,n.x)}}centroid(){return this.accCount===0?new Tt(0,0):new Tt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((n,a)=>n+ +(a[0]!==Number.MAX_VALUE),0):0}}function OI(c,n){const a=c.add(n)._unit(),d=mn(c.x*a.x+c.y*a.y,-1,1);var g,h,y;return y=Math.acos(d),Math.min(4,Math.max(-4,Math.tan(y)))/4*TU*((g=c).x*(h=n).y-g.y*h.x<0?-1:1)}const EU=[c=>c.x<0,c=>c.x>Mt,c=>c.y<0,c=>c.y>Mt];function CU(c,n,a,d){const g=[4];if(d===0)return g;a._mult(d);const h=c.sub(a),y=n.sub(a),T=[c,n,h,y];for(let M=0;M<4;M++)for(const D of T)if(EU[M](D)){g.push(M);break}return g}class jI{constructor(n){this.vertexArray=new Vf,this.indexArray=new Ri,this.programConfigurations=new rl(n.layers,{zoom:n.zoom,lut:n.lut},a=>wU.includes(a)),this._segments=new Nr,this.hiddenByLandmarkVertexArray=new Wf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Nr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(n,a,d,g=!1){const h=n.length;if(h>2){let y=Math.max(0,this._segments.get().length-1);const T=this._segments._prepareSegment(4*h,this.vertexArray.length,2*this._segmentToGroundQuads[y].length);let M;y!==this._segments.get().length-1&&(y++,this._segmentToGroundQuads[y]=[],this._segmentToRegionTriCounts[y]=[0,0,0,0,0]);{const D=n[0],v=n[1];M=OI(D.sub(n[h-1])._perp()._unit(),v.sub(D)._perp()._unit())}for(let D=0;D<h;D++){const v=D===h-1?0:D+1,C=n[D],I=n[v],P=n[v===h-1?0:v+1],A=I.sub(C)._perp()._unit(),N=OI(A,P.sub(I)._perp()._unit()),j=M,V=N;if(Kw(C,I,a)||g&&BI(C,a)&&BI(I,a)){M=N;continue}const X=T.vertexLength;x0(this.vertexArray,C,I,1,1,j),x0(this.vertexArray,C,I,1,0,j),x0(this.vertexArray,C,I,0,1,V),x0(this.vertexArray,C,I,0,0,V),T.vertexLength+=4;const K=CU(C,I,A,d);for(const $ of K)this._segmentToGroundQuads[y].push({id:X,region:$}),this._segmentToRegionTriCounts[y][$]+=2,T.primitiveLength+=2;M=N}}}prepareBorderSegments(){if(!this.hasData())return;const n=this._segments.get(),a=n.length;for(let d=0;d<a;d++)this._segmentToGroundQuads[d].sort((g,h)=>g.region-h.region);for(let d=0;d<a;d++){const g=this._segmentToGroundQuads[d],h=n[d],y=this._segmentToRegionTriCounts[d];y.reduce((M,D)=>M+D,0);let T=0;for(let M=0;M<=4;M++){const D=y[M];if(D!==0){let v=this.regionSegments[M];v||(v=this.regionSegments[M]=new Nr);const C={vertexOffset:h.vertexOffset,primitiveOffset:h.primitiveOffset+T,vertexLength:h.vertexLength,primitiveLength:D};v.get().push(C)}T+=D}for(let M=0;M<g.length;M++){const D=g[M].id;this.indexArray.emplaceBack(D,D+1,D+3),this.indexArray.emplaceBack(D,D+3,D+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(n,a,d,g,h,y){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,n,a,d,g,h,y)}upload(n){this.hasData()&&(this.vertexBuffer=n.createVertexBuffer(this.vertexArray,pU.members),this.indexBuffer=n.createIndexBuffer(this.indexArray))}uploadPaintProperties(n){this.hasData()&&this.programConfigurations.upload(n)}update(n,a,d,g,h,y){this.hasData()&&this.programConfigurations.updatePaintArrays(n,a,d,g,h,y)}updateHiddenByLandmark(n){if(!this.hasData())return;const a=n.groundVertexCount+n.groundVertexArrayOffset;if(n.groundVertexCount===0)return;const d=n.flags&uu?1:0;for(let g=n.groundVertexArrayOffset;g<a;++g)this.hiddenByLandmarkVertexArray.emplace(g,d);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(n){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=n.createVertexBuffer(this.hiddenByLandmarkVertexArray,yU.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let n=0;n<=4;n++){const a=this.regionSegments[n];a&&a.destroy()}}}}class v0{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=n.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=n.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ri,this.footprintVertices=new Qa,this.footprintSegments=[],this.layoutVertexArray=new el,this.centroidVertexArray=new t0,this.wallVertexArray=new Pg,this.indexArray=new Ri,this.programConfigurations=new rl(n.layers,{zoom:n.zoom,lut:n.lut},a=>bU.includes(a)),this.segments=new Nr,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.groundEffect=new jI(n),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(n,a){}populate(n,a,d,g){this.features=[],this.hasPattern=Bw("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=De(d),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:h,id:y,index:T,sourceLayerIndex:M}of n){const D=this.layers[0]._featureFilter.needGeometry,v=vt(h,D);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),v,d))continue;const C={id:y,sourceLayerIndex:M,index:T,geometry:D?v.geometry:_t(h,d,g),properties:h.properties,type:h.type,patterns:{}},I=this.layoutVertexArray.length,P=Yw[C.type]==="Polygon";if(this.hasPattern)this.features.push(Vw("fill-extrusion",this.layers,C,this.zoom,a));else if(this.wallMode)for(const A of C.geometry)for(const N of DI(A,P))this.addFeature(C,[N],T,d,{},a.availableImages,g,a.brightness);else this.addFeature(C,C.geometry,T,d,{},a.availableImages,g,a.brightness);a.featureIndex.insert(h,C.geometry,T,M,this.index,I)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(n,a,d,g,h,y){for(const T of this.features){const M=Yw[T.type]==="Polygon",{geometry:D}=T;if(this.wallMode)for(const v of D)for(const C of DI(v,M))this.addFeature(T,[C],T.index,a,d,g,h,y);else this.addFeature(T,D,T.index,a,d,g,h,y)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(n,a,d,g,h){const y=Object.keys(n).length!==0;if(y&&!this.stateDependentLayers.length)return;const T=y?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(n,a,T,d,g,h),this.groundEffect.update(n,a,T,d,g,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,xU),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.wallVertexBuffer=n.createVertexBuffer(this.wallVertexArray,gU.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,_U.members,!0)),this.groundEffect.upload(n)),this.groundEffect.uploadPaintProperties(n),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.groundEffect.uploadHiddenByLandmark(n),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,mU.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,a,d,g,h,y,T,M){const D=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,v=[new Tt(0,0),new Tt(Mt,Mt)],C=T.projection,I=C.name==="globe",P=this.wallMode||Yw[n.type]==="Polygon",A=new LI;A.centroidDataIndex=this.centroidData.length;const N=new NI,j=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},g)<=0,V=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},g);let X;if(N.height=V,N.vertexArrayOffset=this.layoutVertexArray.length,N.groundVertexArrayOffset=this.groundEffect.vertexArray.length,I&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Uf),this.wallMode){if(I)return void zn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(a.length!==1)return;X=function(he){const Se=he[0].x===he[he.length-1].x&&he[0].y===he[he.length-1].y;(function(xt){let ht=0;const Ht=xt.length;for(let At=0;At<Ht;At++)ht+=(xt[(At+1)%Ht].x-xt[At].x)*(xt[(At+1)%Ht].y+xt[At].y);return ht>=0})(he)||(he=he.reverse());const Ce={geometry:[],joinNormals:[],indices:[]},Le=[],je=[],ze=[];let Fe=he.length;if(Fe<(Se?3:2))return Ce;for(;Fe>=2&&he[Fe-1].equals(he[Fe-2]);)Fe--;let Ze,Ve,rt,ct,Je,Dt=0;for(;Dt<Fe-1&&he[Dt].equals(he[Dt+1]);)Dt++;Se&&(Ze=he[Fe-2],Je=he[Dt].sub(Ze)._unit()._perp());for(let xt=Dt;xt<Fe;xt++){if(rt=xt===Fe-1?Se?he[Dt+1]:void 0:he[xt+1],rt&&he[xt].equals(rt))continue;Je&&(ct=Je),Ze&&(Ve=Ze),Ze=he[xt],Je=rt?rt.sub(Ze)._unit()._perp():ct,ct=ct||Je;let ht=ct.add(Je);ht.x===0&&ht.y===0||ht._unit();const Ht=ht.x*Je.x+ht.y*Je.y,At=Ht!==0?1/Ht:1/0,Lt=ct.x*Je.y-ct.y*Je.x>0;let nn="miter";const xn=2;nn==="miter"&&At>xn&&(nn="bevel"),nn==="bevel"&&(At>100&&(nn="flipbevel"),At<xn&&(nn="miter"));const fn=(pn,Sn,Tn,cr)=>{const Jn=new Tt(pn.x,pn.y),sn=new Tt(pn.x,pn.y);Jn.x+=Sn.x*cr,Jn.y+=Sn.y*cr,sn.x-=Sn.x*Math.max(Tn,1),sn.y-=Sn.y*Math.max(Tn,1),ze.push(Sn),Le.push(Jn),je.push(sn)};if(nn==="miter")ht._mult(At),fn(Ze,ht,0,0);else if(nn==="flipbevel")ht=Je.mult(-1),fn(Ze,ht,0,0),fn(Ze,ht.mult(-1),0,0);else{const pn=-Math.sqrt(At*At-1),Sn=Lt?pn:0,Tn=Lt?0:pn;Ve&&fn(Ze,ct,Sn,Tn),rt&&fn(Ze,Je,Sn,Tn)}}Ce.geometry=[...Le,...je.reverse(),Le[0]],Ce.joinNormals=[...ze,...ze.reverse(),ze[ze.length-1]];const Pt=Ce.geometry.length-1;for(let xt=0;xt<Pt/2;xt++)if(xt+1<Pt/2){let ht=xt,Ht=xt+1,At=Pt-1-xt,Lt=Pt-2-xt;ht=ht===0?Pt-1:ht-1,Ht=Ht===0?Pt-1:Ht-1,At=At===0?Pt-1:At-1,Lt=Lt===0?Pt-1:Lt-1,Ce.indices.push(At),Ce.indices.push(Ht),Ce.indices.push(ht),Ce.indices.push(At),Ce.indices.push(Lt),Ce.indices.push(Ht)}return Ce}(a[0]),a=[X.geometry]}const K=(he,Se)=>he<(Se.length-1)/2||he===Se.length-1,$=this.wallMode?[a]:p0(a,500);for(let he=$.length-1;he>=0;he--){const Se=$[he];(Se.length===0||(ne=Se[0]).every(_e=>_e.x<=0)||ne.every(_e=>_e.x>=Mt)||ne.every(_e=>_e.y<=0)||ne.every(_e=>_e.y>=Mt))&&$.splice(he,1)}var ne;let ie;if(I)ie=GI($,v,g);else{ie=[];for(const he of $)ie.push({polygon:he,bounds:v})}const ue=P?this.edgeRadius:0,pe=ue>0&&this.zoom<17,ge=(he,Se)=>{if(he.length===0)return!1;const _e=he[he.length-1];return Se.x===_e.x&&Se.y===_e.y};for(const{polygon:he,bounds:Se}of ie){let _e=0,Ce=0;for(const Fe of he)P&&!Fe[0].equals(Fe[Fe.length-1])&&Fe.push(Fe[0]),Ce+=P?Fe.length-1:Fe.length;const Le=this.segments.prepareSegment((P?5:4)*Ce,this.layoutVertexArray,this.indexArray);N.footprintSegIdx<0&&(N.footprintSegIdx=this.footprintSegments.length),N.polygonSegIdx<0&&(N.polygonSegIdx=this.polygonSegments.length);const je={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ze=new kI;if(ze.vertexOffset=this.footprintVertices.length,ze.indexOffset=3*this.footprintIndices.length,ze.ringIndices=[],P){const Fe=[],Ze=[];_e=Le.vertexLength;for(let rt=0;rt<he.length;rt++){const ct=he[rt];ct.length&&rt!==0&&Ze.push(Fe.length/2);const Je=[];let Dt,Pt;Dt=ct[1].sub(ct[0])._perp()._unit(),ze.ringIndices.push(ct.length-1);for(let xt=1;xt<ct.length;xt++){const ht=ct[xt],Ht=ct[xt===ct.length-1?1:xt+1],At=ht.clone();if(ue){Pt=Ht.sub(ht)._perp()._unit();const Lt=Dt.add(Pt)._unit(),nn=ue*Math.min(4,1/(Dt.x*Lt.x+Dt.y*Lt.y));At.x+=nn*Lt.x,At.y+=nn*Lt.y,At.x=Math.round(At.x),At.y=Math.round(At.y),Dt=Pt}if(!j||ue!==0&&!pe||ge(Je,At)||Je.push(At),zg(this.layoutVertexArray,At.x,At.y,0,0,1,1,0),this.wallMode){const Lt=K(xt,ct);Fg(this.wallVertexArray,X.joinNormals[xt],!Lt)}Le.vertexLength++,this.footprintVertices.emplaceBack(ht.x,ht.y),Fe.push(ht.x,ht.y),I&&Bg(this.layoutVertexExtArray,C.projectTilePoint(At.x,At.y,g),C.upVector(g,At.x,At.y))}j&&(ue===0||pe)&&(Je.length!==0&&ge(Je,Je[0])&&Je.pop(),this.groundEffect.addData(Je,Se,D))}const Ve=this.wallMode?X.indices:Ng(Fe,Ze);for(let rt=0;rt<Ve.length;rt+=3)this.footprintIndices.emplaceBack(ze.vertexOffset+Ve[rt+0],ze.vertexOffset+Ve[rt+1],ze.vertexOffset+Ve[rt+2]),this.indexArray.emplaceBack(_e+Ve[rt],_e+Ve[rt+2],_e+Ve[rt+1]),Le.primitiveLength++;ze.indexCount+=Ve.length,ze.vertexCount+=this.footprintVertices.length-ze.vertexOffset}for(let Fe=0;Fe<he.length;Fe++){const Ze=he[Fe];A.startRing(N,Ze[0]);let Ve=Ze.length>4&&VI(Ze[Ze.length-2],Ze[0],Ze[1]),rt=ue?PU(Ze[Ze.length-2],Ze[0],Ze[1],ue):0;const ct=[];let Je,Dt,Pt;Dt=Ze[1].sub(Ze[0])._perp()._unit();let xt=!0;for(let ht=1,Ht=0;ht<Ze.length;ht++){let At=Ze[ht-1],Lt=Ze[ht];const nn=Ze[ht===Ze.length-1?1:ht+1];if(A.appendEdge(N,Lt,At),Kw(Lt,At,Se)){ue&&(Dt=nn.sub(Lt)._perp()._unit(),xt=!xt);continue}const xn=Lt.sub(At)._perp(),fn=xn.x/(Math.abs(xn.x)+Math.abs(xn.y)),pn=xn.y>0?1:0,Sn=At.dist(Lt);if(Ht+Sn>32768&&(Ht=0),ue){Pt=nn.sub(Lt)._perp()._unit();let sn=FI(At,Lt,nn,zI(Dt,Pt),ue);isNaN(sn)&&(sn=0);const $n=Lt.sub(At)._unit();At=At.add($n.mult(rt))._round(),Lt=Lt.add($n.mult(-sn))._round(),rt=sn,Dt=Pt,j&&this.zoom>=17&&(ge(ct,At)||ct.push(At),ge(ct,Lt)||ct.push(Lt))}const Tn=Le.vertexLength,cr=Ze.length>4&&VI(At,Lt,nn);let Jn=UI(Ht,Ve,xt);if(zg(this.layoutVertexArray,At.x,At.y,fn,pn,0,0,Jn),zg(this.layoutVertexArray,At.x,At.y,fn,pn,0,1,Jn),this.wallMode){const sn=K(ht-1,Ze),$n=X.joinNormals[ht-1];Fg(this.wallVertexArray,$n,sn),Fg(this.wallVertexArray,$n,sn)}if(Ht+=Sn,Jn=UI(Ht,cr,!xt),Ve=cr,zg(this.layoutVertexArray,Lt.x,Lt.y,fn,pn,0,0,Jn),zg(this.layoutVertexArray,Lt.x,Lt.y,fn,pn,0,1,Jn),this.wallMode){const sn=K(ht,Ze),$n=X.joinNormals[ht];Fg(this.wallVertexArray,$n,sn),Fg(this.wallVertexArray,$n,sn)}if(Le.vertexLength+=4,this.indexArray.emplaceBack(Tn+0,Tn+1,Tn+2),this.indexArray.emplaceBack(Tn+1,Tn+3,Tn+2),Le.primitiveLength+=2,ue){const sn=_e+(ht===1?Ze.length-2:ht-2),$n=ht===1?_e:sn+1;if(this.indexArray.emplaceBack(Tn+1,sn,Tn+3),this.indexArray.emplaceBack(sn,$n,Tn+3),Le.primitiveLength+=2,Je===void 0&&(Je=Tn),!Kw(nn,Ze[ht],Se)){const Wn=ht===Ze.length-1?Je:Le.vertexLength;this.indexArray.emplaceBack(Tn+2,Tn+3,Wn),this.indexArray.emplaceBack(Tn+3,Wn+1,Wn),this.indexArray.emplaceBack(Tn+3,$n,Wn+1),Le.primitiveLength+=3}xt=!xt}if(I){const sn=this.layoutVertexExtArray,$n=C.projectTilePoint(At.x,At.y,g),Wn=C.projectTilePoint(Lt.x,Lt.y,g),_r=C.upVector(g,At.x,At.y),jr=C.upVector(g,Lt.x,Lt.y);Bg(sn,$n,_r),Bg(sn,$n,_r),Bg(sn,Wn,jr),Bg(sn,Wn,jr)}}P&&(_e+=Ze.length-1),j&&ue&&this.zoom>=17&&(ct.length!==0&&ge(ct,ct[0])&&ct.pop(),this.groundEffect.addData(ct,Se,D,ue>0))}this.footprintSegments.push(ze),je.triangleCount=this.indexArray.length-je.triangleArrayOffset,this.polygonSegments.push(je),++N.footprintSegLen,++N.polygonSegLen}if(N.vertexCount=this.layoutVertexArray.length-N.vertexArrayOffset,N.groundVertexCount=this.groundEffect.vertexArray.length-N.groundVertexArrayOffset,N.vertexCount!==0){if(N.centroidXY=A.borders?RI:this.encodeCentroid(A,N),this.centroidData.push(N),A.borders){this.featuresOnBorder.push(A);const he=this.featuresOnBorder.length-1;for(let Se=0;Se<A.borders.length;Se++)A.borders[Se][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Se].push(he)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,h,y,g,M),this.groundEffect.addPaintPropertiesData(n,d,h,y,g,M),this.maxHeight=Math.max(this.maxHeight,V)}}sortBorders(){for(let n=0;n<this.borderFeatureIndices.length;n++)this.borderFeatureIndices[n].sort((a,d)=>this.featuresOnBorder[a].borders[n][0]-this.featuresOnBorder[d].borders[n][0])}splitToSubtiles(){const n=[];for(let T=0;T<this.centroidData.length;T++){const M=this.centroidData[T],D=+(M.min.y+M.max.y>Mt),v=2*D+(+(M.min.x+M.max.x>Mt)^D);for(let C=0;C<M.polygonSegLen;C++){const I=M.polygonSegIdx+C;n.push({centroidIdx:T,subtile:v,polygonSegmentIdx:I,triangleSegmentIdx:this.polygonSegments[I].triangleSegIdx})}}const a=new Ri;n.sort((T,M)=>T.triangleSegmentIdx===M.triangleSegmentIdx?T.subtile-M.subtile:T.triangleSegmentIdx-M.triangleSegmentIdx);let d=0,g=0,h=0;for(const T of n){if(T.triangleSegmentIdx!==d)break;h++}const y=n.length;for(;g!==n.length;){d=n[g].triangleSegmentIdx;let T=0,M=g,D=g;for(let v=M;v<h&&n[v].subtile===T;v++)D++;for(;M!==h;){const v=n[M];T=v.subtile;const C=this.centroidData[v.centroidIdx].min.clone(),I=this.centroidData[v.centroidIdx].max.clone(),P={vertexOffset:this.segments.segments[d].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[d].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let A=M;A<D;A++){const N=n[A],j=this.polygonSegments[N.polygonSegmentIdx],V=this.centroidData[N.centroidIdx].min,X=this.centroidData[N.centroidIdx].max,K=this.indexArray.uint16;for(let $=j.triangleArrayOffset;$<j.triangleArrayOffset+j.triangleCount;$++)a.emplaceBack(K[3*$],K[3*$+1],K[3*$+2]);P.primitiveLength+=j.triangleCount,C.x=Math.min(C.x,V.x),C.y=Math.min(C.y,V.y),I.x=Math.max(I.x,X.x),I.y=Math.max(I.y,X.y)}P.primitiveLength>0&&this.triangleSubSegments.push({segment:P,min:C,max:I}),M=D;for(let A=M;A<h&&n[A].subtile===n[M].subtile;A++)D++}g=h;for(let v=g;v<y&&n[v].triangleSegmentIdx===n[g].triangleSegmentIdx;v++)h++}a._trim(),this.indexArray=a}getVisibleSegments(n,a,d){const g=new Nr;if(this.wallMode){for(const N of this.triangleSubSegments)g.segments.push(N.segment);return g}let h=0,y=0;const T=1<<n.canonical.z;if(a){const N=a.getMinMaxForTile(n);N&&(h=N.min,y=N.max)}y+=this.maxHeight;const M=n.toUnwrapped();let D;const v=[M.canonical.x/T+M.wrap,M.canonical.y/T],C=[(M.canonical.x+1)/T+M.wrap,(M.canonical.y+1)/T],I=(N,j,V)=>[N[0]*(1-V[0])+j[0]*V[0],N[1]*(1-V[1])+j[1]*V[1]],P=[],A=[];for(const N of this.triangleSubSegments){P[0]=N.min.x/Mt,P[1]=N.min.y/Mt,A[0]=N.max.x/Mt,A[1]=N.max.y/Mt;const j=I(v,C,P),V=I(v,C,A);if(new pr([j[0],j[1],h],[V[0],V[1],y]).intersectsPrecise(d)===0){D&&(g.segments.push(D),D=void 0);continue}const X=N.segment;D&&D.vertexOffset!==X.vertexOffset&&(g.segments.push(D),D=void 0),D?(D.vertexLength+=X.vertexLength,D.primitiveLength+=X.primitiveLength):D={vertexOffset:X.vertexOffset,primitiveLength:X.primitiveLength,vertexLength:X.vertexLength,primitiveOffset:X.primitiveOffset,sortKey:void 0,vaos:{}}}return D&&g.segments.push(D),g}encodeCentroid(n,a){const d=n.centroid(),g=a.span(),h=Math.min(7,Math.round(g.x*this.tileToMeter/10)),y=Math.min(7,Math.round(g.y*this.tileToMeter/10));return new Tt(mn(d.x,1,Mt-1)<<3|h,mn(d.y,1,Mt-1)<<3|y)}encodeBorderCentroid(n){if(!n.borders)return new Tt(0,0);const a=n.borders,d=Number.MAX_VALUE;if(a[0][0]!==d||a[1][0]!==d){const g=a[0][0]!==d?0:1;return new Tt(6|(a[0][0]!==d?0:65528),(a[g][0]+a[g][1])/2<<3|6)}{const g=a[2][0]!==d?2:3;return new Tt((a[g][0]+a[g][1])/2<<3|6,6|(a[2][0]!==d?0:65528))}}showCentroid(n){const a=this.centroidData[n.centroidDataIndex];a.flags&=uu,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(n){this.groundEffect.updateHiddenByLandmark(n);const a=n.vertexArrayOffset,d=n.vertexCount+n.vertexArrayOffset,g=n.flags&uu?RI:n.centroidXY,h=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==g.y||h!==g.x){for(let y=a;y<d;++y)this.centroidVertexArray.emplace(y,g.x,g.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const n of this.centroidData)this.writeCentroidToBuffer(n)}updateReplacement(n,a,d){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const g=a.getReplacementRegionsForTile(n.toUnwrapped());if(Zw(this.activeReplacements,g))return;if(this.activeReplacements=g,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const y of this.centroidData)y.flags&=2147483647;const h=[];for(const y of this.activeReplacements){if(y.order<d)continue;const T=Math.pow(2,y.footprintTileId.canonical.z-n.canonical.z);for(const M of this.centroidData)if(!(M.flags&uu||y.min.x>M.max.x||M.min.x>y.max.x||y.min.y>M.max.y||M.min.y>y.max.y))for(let D=0;D<M.footprintSegLen;D++){const v=this.footprintSegments[M.footprintSegIdx+D];if(h.length=0,MU(this.footprintVertices,v.vertexOffset,v.vertexCount,y.footprintTileId.canonical,n.canonical,h),PI(y.footprint,h,this.footprintIndices.uint16,v.indexOffset,v.indexCount,-v.vertexOffset,-T)){M.flags|=uu;break}}}for(const y of this.centroidData)this.writeCentroidToBuffer(y);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(n,a,d){let g=!1;for(let h=0;h<d.footprintSegLen;h++){const y=this.footprintSegments[d.footprintSegIdx+h];let T=0;for(const M of y.ringIndices){for(let D=T,v=M+T-1;D<M+T;v=D++){const C=this.footprintVertices.int16[2*(D+y.vertexOffset)+0],I=this.footprintVertices.int16[2*(D+y.vertexOffset)+1],P=this.footprintVertices.int16[2*(v+y.vertexOffset)+1];I>a!=P>a&&n<(this.footprintVertices.int16[2*(v+y.vertexOffset)+0]-C)*(a-I)/(P-I)+C&&(g=!g)}T=M}}return g}getHeightAtTileCoord(n,a){let d=Number.NEGATIVE_INFINITY,g=!0;const h=4*(n+Mt)*Mt+(a+Mt);if(this.partLookup.hasOwnProperty(h)){const y=this.partLookup[h];return y?{height:y.height,hidden:!!(y.flags&uu)}:void 0}for(const y of this.centroidData)n>y.max.x||y.min.x>n||a>y.max.y||y.min.y>a||this.footprintContainsPoint(n,a,y)&&y&&y.height>d&&(d=y.height,this.partLookup[h]=y,g=!!(y.flags&uu));if(d!==Number.NEGATIVE_INFINITY)return{height:d,hidden:g};this.partLookup[h]=void 0}}function zI(c,n){const a=c.add(n)._unit();return c.x*a.x+c.y*a.y}function PU(c,n,a,d){const g=n.sub(c)._perp()._unit(),h=a.sub(n)._perp()._unit();return FI(c,n,a,zI(g,h),d)}function FI(c,n,a,d,g){const h=Math.sqrt(1-d*d);return Math.min(c.dist(n)/3,n.dist(a)/3,g*h/d)}function Kw(c,n,a){return c.x<a[0].x&&n.x<a[0].x||c.x>a[1].x&&n.x>a[1].x||c.y<a[0].y&&n.y<a[0].y||c.y>a[1].y&&n.y>a[1].y}function BI(c,n){return c.x<n[0].x||c.x>n[1].x||c.y<n[0].y||c.y>n[1].y}function VI(c,n,a){if(c.x<0||c.x>=Mt||n.x<0||n.x>=Mt||a.x<0||a.x>=Mt)return!1;const d=a.sub(n),g=d.perp(),h=c.sub(n);return(d.x*h.x+d.y*h.y)/Math.sqrt((d.x*d.x+d.y*d.y)*(h.x*h.x+h.y*h.y))>-.866&&g.x*h.x+g.y*h.y<0}function UI(c,n,a){const d=n?2|c:-3&c;return a?1|d:-2&d}function $I(){const c=Math.PI/32,n=Math.tan(c),a=G;return a*Math.sqrt(1+2*n*n)-a}function GI(c,n,a){const d=1<<a.z,g=be(a.x/d),h=be((a.x+1)/d),y=ve(a.y/d),T=ve((a.y+1)/d);return function(M,D,v,C,I=0,P){const A=[];if(!M.length||!v||!C)return A;const N=(ie,ue)=>{for(const pe of ie)A.push({polygon:pe,bounds:ue})},j=Math.ceil(Math.log2(v)),V=Math.ceil(Math.log2(C)),X=j-V,K=[];for(let ie=0;ie<Math.abs(X);ie++)K.push(X>0?0:1);for(let ie=0;ie<Math.min(j,V);ie++)K.push(0),K.push(1);let $=M;if($=g0($,D[0].y-I,D[1].y+I,1),$=g0($,D[0].x-I,D[1].x+I,0),!$.length)return A;const ne=[];for(K.length?ne.push({polygons:$,bounds:D,depth:0}):N($,D);ne.length;){const ie=ne.pop(),ue=ie.depth,pe=K[ue],ge=ie.bounds[0],he=ie.bounds[1],Se=pe===0?ge.x:ge.y,_e=pe===0?he.x:he.y,Ce=P?P(pe,Se,_e):.5*(Se+_e),Le=g0(ie.polygons,Se-I,Ce+I,pe),je=g0(ie.polygons,Ce-I,_e+I,pe);if(Le.length){const ze=[ge,new Tt(pe===0?Ce:he.x,pe===1?Ce:he.y)];K.length>ue+1?ne.push({polygons:Le,bounds:ze,depth:ue+1}):N(Le,ze)}if(je.length){const ze=[new Tt(pe===0?Ce:ge.x,pe===1?Ce:ge.y),he];K.length>ue+1?ne.push({polygons:je,bounds:ze,depth:ue+1}):N(je,ze)}}return A}(c,n,Math.ceil((h-g)/11.25),Math.ceil((y-T)/11.25),1,(M,D,v)=>{if(M===0)return .5*(D+v);{const C=ve((a.y+D/Mt)/d);return(ye(.5*(ve((a.y+v/Mt)/d)+C))*d-a.y)*Mt}})}function MU(c,n,a,d,g,h){const y=Math.pow(2,d.z-g.z);for(let T=0;T<a;T++){let M=c.int16[2*(T+n)+0],D=c.int16[2*(T+n)+1];M=(M+g.x*Mt)*y-d.x*Mt,D=(D+g.y*Mt)*y-d.y*Mt,h.push(new Tt(M,D))}}let WI,HI;function Vg(c,n){return c.x*n.x+c.y*n.y}function qI(c,n){if(c.length===1){let a=0;const d=n[a++];let g;for(;!g||d.equals(g);)if(g=n[a++],!g)return 1/0;for(;a<n.length;a++){const h=n[a],y=c[0],T=g.sub(d),M=h.sub(d),D=y.sub(d),v=Vg(T,T),C=Vg(T,M),I=Vg(M,M),P=Vg(D,T),A=Vg(D,M),N=v*I-C*C,j=(I*P-C*A)/N,V=(v*A-C*P)/N,X=d.z*(1-j-V)+g.z*j+h.z*V;if(isFinite(X))return X}return 1/0}{let a=1/0;for(const d of n)a=Math.min(a,d.z);return a}}function ZI(c,n,a,d,g,h,y,T){const M=y*g.getElevationAt(c,n,!0,!0),D=h[0]!==0,v=D?h[1]===0?y*(h[0]/7-450):y*function(C,I,P){const A=Math.floor(I[0]/8),N=Math.floor(I[1]/8),j=10*(I[0]-8*A),V=10*(I[1]-8*N),X=C.getElevationAt(A,N,!0,!0),K=C.getMeterToDEM(P),$=Math.floor(.5*(j*K-1)),ne=Math.floor(.5*(V*K-1)),ie=C.tileCoordToPixel(A,N),ue=2*$+1,pe=2*ne+1,ge=function(je,ze,Fe,Ze,Ve){return[je.getElevationAtPixel(ze,Fe,!0),je.getElevationAtPixel(ze+Ve,Fe,!0),je.getElevationAtPixel(ze,Fe+Ve,!0),je.getElevationAtPixel(ze+Ze,Fe+Ve,!0)]}(C,ie.x-$,ie.y-ne,ue,pe),he=Math.abs(ge[0]-ge[1]),Se=Math.abs(ge[2]-ge[3]),_e=Math.abs(ge[0]-ge[2])+Math.abs(ge[1]-ge[3]),Ce=Math.min(.25,.5*K*(he+Se)/ue),Le=Math.min(.25,.5*K*_e/pe);return X+Math.max(Ce*j,Le*V)}(g,h,T):M;return{base:M+(a===0)?-1:a,top:D?Math.max(v+d,M+a+2):M+d}}Ot(v0,"FillExtrusionBucket",{omit:["layers","features"]}),Ot(NI,"PartData"),Ot(kI,"FootprintSegment"),Ot(LI,"BorderCentroidData"),Ot(jI,"GroundEffect");const AU=Bn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),IU=Bn([{name:"a_z_offset",components:1,type:"Float32"}],4),{members:DU}=AU,RU=Bn([{name:"a_packed",components:4,type:"Float32"}]),{members:kU}=RU,NU=Bn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:LU}=NU;class XI{constructor(n,a){this.width=n,this.height=a,this.nextRow=0,this.image=new cu({width:n,height:a}),this.positions={},this.uploaded=!1}getDash(n,a){const d=this.getKey(n,a);return this.positions[d]}trim(){const n=this.width,a=this.height=md(this.nextRow);this.image.resize({width:n,height:a})}getKey(n,a){return n.join(",")+a}getDashRanges(n,a,d){const g=[];let h=n.length%2==1?-n[n.length-1]*d:0,y=n[0]*d,T=!0;g.push({left:h,right:y,isDash:T,zeroLength:n[0]===0});let M=n[0];for(let D=1;D<n.length;D++){T=!T;const v=n[D];h=M*d,M+=v,y=M*d,g.push({left:h,right:y,isDash:T,zeroLength:v===0})}return g}addRoundDash(n,a,d){const g=a/2;for(let h=-d;h<=d;h++){const y=this.width*(this.nextRow+d+h);let T=0,M=n[T];for(let D=0;D<this.width;D++){D/M.right>1&&(M=n[++T]);const v=Math.abs(D-M.left),C=Math.abs(D-M.right),I=Math.min(v,C);let P;const A=h/d*(g+1);if(M.isDash){const N=g-Math.abs(A);P=Math.sqrt(I*I+N*N)}else P=g-Math.sqrt(I*I+A*A);this.image.data[y+D]=Math.max(0,Math.min(255,P+128))}}}addRegularDash(n,a){for(let M=n.length-1;M>=0;--M){const D=n[M],v=n[M+1];D.zeroLength?n.splice(M,1):v&&v.isDash===D.isDash&&(v.left=D.left,n.splice(M,1))}const d=n[0],g=n[n.length-1];d.isDash===g.isDash&&(d.left=g.left-this.width,g.right=d.right+this.width);const h=this.width*this.nextRow;let y=0,T=n[y];for(let M=0;M<this.width;M++){M/T.right>1&&(T=n[++y]);const D=Math.abs(M-T.left),v=Math.abs(M-T.right),C=Math.min(D,v);this.image.data[h+M]=Math.max(0,Math.min(255,(T.isDash?C:-C)+a+128))}}addDash(n,a){const d=this.getKey(n,a);if(this.positions[d])return this.positions[d];const g=a==="round",h=g?7:0,y=2*h+1;if(this.nextRow+y>this.height)return zn("LineAtlas out of space"),null;n.length===0&&n.push(1);let T=0;for(let v=0;v<n.length;v++)n[v]<0&&(zn("Negative value is found in line dasharray, replacing values with 0"),n[v]=0),T+=n[v];if(T!==0){const v=this.width/T,C=this.getDashRanges(n,this.width,v);g?this.addRoundDash(C,v,h):this.addRegularDash(C,a==="square"?.5*v:0)}const M=this.nextRow+h;this.nextRow+=y;const D={tl:[M,h],br:[T,0]};return this.positions[d]=D,D}}Ot(XI,"LineAtlas");const OU=Jf.VectorTileFeature.types,jU=Math.cos(Math.PI/180*37.5),zU=Math.cos(Math.PI/180*5);class Jw{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new yg,this.layoutVertexArray2=new ga,this.patternVertexArray=new tl,this.indexArray=new Ri,this.programConfigurations=new rl(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new Nr,this.maxLineLength=0,this.zOffsetVertexArray=new nu,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.tessellationStep=n.tessellationStep?n.tessellationStep:Mt/64}updateFootprints(n,a){}populate(n,a,d,g){this.hasPattern=Bw("line",this.layers,a);const h=this.layers[0].layout.get("line-sort-key"),y=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!y.isConstant()||!!y.constantOr(0);const T=[];for(const{feature:C,id:I,index:P,sourceLayerIndex:A}of n){const N=this.layers[0]._featureFilter.needGeometry,j=vt(C,N);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),j,d))continue;const V=h?h.evaluate(j,{},d):void 0,X={id:I,properties:C.properties,type:C.type,sourceLayerIndex:A,index:P,geometry:N?j.geometry:_t(C,d,g),patterns:{},sortKey:V};T.push(X)}h&&T.sort((C,I)=>C.sortKey-I.sortKey);const{lineAtlas:M,featureIndex:D}=a,v=this.addConstantDashes(M);for(const C of T){const{geometry:I,index:P,sourceLayerIndex:A}=C;if(v&&this.addFeatureDashes(C,M),this.hasPattern){const N=Vw("line",this.layers,C,this.zoom,a);this.patternFeatures.push(N)}else this.addFeature(C,I,P,d,M.positions,a.availableImages,a.brightness);D.insert(n[P].feature,I,P,A,this.index)}}addConstantDashes(n){let a=!1;for(const d of this.layers){const g=d.paint.get("line-dasharray").value,h=d.layout.get("line-cap").value;if(g.kind!=="constant"||h.kind!=="constant")a=!0;else{const y=h.value,T=g.value;if(!T)continue;n.addDash(T,y)}}return a}addFeatureDashes(n,a){const d=this.zoom;for(const g of this.layers){const h=g.paint.get("line-dasharray").value,y=g.layout.get("line-cap").value;if(h.kind==="constant"&&y.kind==="constant")continue;let T,M;if(h.kind==="constant"){if(T=h.value,!T)continue}else T=h.evaluate({zoom:d},n);M=y.kind==="constant"?y.value:y.evaluate({zoom:d},n),a.addDash(T,M),n.patterns[g.id]=a.getKey(T,M)}}update(n,a,d,g,h){const y=Object.keys(n).length!==0;y&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,a,y?this.stateDependentLayers:this.layers,d,g,h)}addFeatures(n,a,d,g,h,y){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,a,d,g,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,kU)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=n.createVertexBuffer(this.patternVertexArray,LU)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,IU.members,!0)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,DU),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,a,d,g,h,y,T){const M=this.layers[0].layout,D=M.get("line-join").evaluate(n,{}),v=M.get("line-cap").evaluate(n,{}),C=M.get("line-miter-limit"),I=M.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const P of a)this.addLine(P,n,g,D,v,C,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,h,y,g,T)}addLine(n,a,d,g,h,y,T){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const M={zoom:this.zoom,lineProgress:void 0},D=this.layers[0].layout,v=g==="none";if(this.patternJoinNone=this.hasPattern&&v,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ie=0;ie<n.length-1;ie++)this.totalDistance+=n[ie].dist(n[ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const C=OU[a.type]==="Polygon";let I=n.length;for(;I>=2&&n[I-1].equals(n[I-2]);)I--;let P=0;for(;P<I-1&&n[P].equals(n[P+1]);)P++;if(I<(C?3:2))return;g==="bevel"&&(y=1.05);const A=this.overscaling<=16?15*Mt/(512*this.overscaling):0,N=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let j,V,X,K,$,ne;this.e1=this.e2=-1,C&&(j=n[I-2],$=n[P].sub(j)._unit()._perp());for(let ie=P;ie<I;ie++){if(X=ie===I-1?C?n[P+1]:void 0:n[ie+1],X&&n[ie].equals(X))continue;if($&&(K=$),j&&(V=j),j=n[ie],this.hasZOffset){const ze=D.get("line-z-offset").value;if(ze.kind==="constant")ne=ze.value;else{if(this.lineClips){const Fe=this.totalDistance/(this.lineClips.end-this.lineClips.start);M.lineProgress=(Fe*this.lineClips.start+this.distance+(V?V.dist(j):0))/Fe}else zn(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),M.lineProgress=0;ne=ze.evaluate(M,a)}ne=ne||0}$=X?X.sub(j)._unit()._perp():K,K=K||$;const ue=V&&X;let pe=ue?g:C||v?"butt":h;const ge=K.x*$.x+K.y*$.y;if(v){const ze=function(Fe){if(Fe.patternJoinNone){const Ze=Fe.segmentPoints.length/2,Ve=Fe.lineSoFar-Fe.segmentStart;for(let rt=0;rt<Ze;++rt){const ct=Fe.segmentPoints[2*rt+1],Je=Math.round(Fe.segmentPoints[2*rt])+.5+.25*ct;Fe.patternVertexArray.emplaceBack(Je,Ve,Fe.segmentStart),Fe.patternVertexArray.emplaceBack(Je,Ve,Fe.segmentStart)}Fe.segmentPoints.length=0}Fe.e1=Fe.e2=-1};if(ue&&ge<zU){this.updateDistance(V,j),this.addCurrentVertex(j,K,1,1,N,ne),ze(this),this.addCurrentVertex(j,$,-1,-1,N,ne);continue}if(V){if(!X){this.updateDistance(V,j),this.addCurrentVertex(j,K,1,1,N,ne),ze(this);continue}pe="miter"}}let he=K.add($);he.x===0&&he.y===0||he._unit();const Se=he.x*$.x+he.y*$.y,_e=Se!==0?1/Se:1/0,Ce=2*Math.sqrt(2-2*Se),Le=Se<jU&&V&&X,je=K.x*$.y-K.y*$.x>0;if(Le&&ie>P){const ze=j.dist(V);if(ze>2*A){const Fe=j.sub(j.sub(V)._mult(A/ze)._round());this.updateDistance(V,Fe),this.addCurrentVertex(Fe,K,0,0,N,ne),V=Fe}}if(ue&&pe==="round"&&(_e<T?pe="miter":_e<=2&&(pe="fakeround")),pe==="miter"&&_e>y&&(pe="bevel"),pe==="bevel"&&(_e>2&&(pe="flipbevel"),_e<y&&(pe="miter")),V&&this.updateDistance(V,j),pe==="miter")he._mult(_e),this.addCurrentVertex(j,he,0,0,N,ne);else if(pe==="flipbevel"){if(_e>100)he=$.mult(-1);else{const ze=_e*K.add($).mag()/K.sub($).mag();he._perp()._mult(ze*(je?-1:1))}this.addCurrentVertex(j,he,0,0,N,ne),this.addCurrentVertex(j,he.mult(-1),0,0,N,ne)}else if(pe==="bevel"||pe==="fakeround"){const ze=-Math.sqrt(_e*_e-1),Fe=je?ze:0,Ze=je?0:ze;if(V&&this.addCurrentVertex(j,K,Fe,Ze,N,ne),pe==="fakeround"){const Ve=Math.round(180*Ce/Math.PI/20);for(let rt=1;rt<Ve;rt++){let ct=rt/Ve;if(ct!==.5){const Dt=ct-.5;ct+=ct*Dt*(ct-1)*((1.0904+ge*(ge*(3.55645-1.43519*ge)-3.2452))*Dt*Dt+(.848013+ge*(.215638*ge-1.06021)))}const Je=$.sub(K)._mult(ct)._add(K)._unit()._mult(je?-1:1);this.addHalfVertex(j,Je.x,Je.y,!1,je,0,N,ne)}}X&&this.addCurrentVertex(j,$,-Fe,-Ze,N,ne)}else pe==="butt"?this.addCurrentVertex(j,he,0,0,N,ne):pe==="square"?(V||this.addCurrentVertex(j,he,-1,-1,N,ne),this.addCurrentVertex(j,he,0,0,N,ne),V&&this.addCurrentVertex(j,he,1,1,N,ne)):pe==="round"&&(V&&(this.addCurrentVertex(j,K,0,0,N,ne),this.addCurrentVertex(j,K,1,1,N,ne,!0)),X&&(this.addCurrentVertex(j,$,-1,-1,N,ne,!0),this.addCurrentVertex(j,$,0,0,N,ne)));if(Le&&ie<I-1){const ze=j.dist(X);if(ze>2*A){const Fe=j.add(X.sub(j)._mult(A/ze)._round());this.updateDistance(j,Fe),this.addCurrentVertex(Fe,$,0,0,N,ne),j=Fe}}}}addVerticesTo(n,a,d,g,h,y,T,M,D,v){const C=(a.w-n.w)/this.tessellationStep|0;if(C>1){this.lineSoFar=n.w;const I=(a.x-n.x)/C,P=(a.y-n.y)/C,A=(a.z-n.z)/C,N=(a.w-n.w)/C;for(let j=1;j<C;++j)n.x+=I,n.y+=P,n.z+=A,this.lineSoFar+=N,this.addHalfVertex(n,d,g,v,!1,T,D,n.z),this.addHalfVertex(n,h,y,v,!0,-M,D,n.z)}this.lineSoFar=a.w,this.addHalfVertex(a,d,g,v,!1,T,D,a.z),this.addHalfVertex(a,h,y,v,!0,-M,D,a.z)}addCurrentVertex(n,a,d,g,h,y,T=!1){const M=a.x+a.y*d,D=a.y-a.x*d,v=a.y*g-a.x,C=-a.y-a.x*g;if(y!=null){const P=Mt+10,A=y,N=new bI(n.x,n.y,A,this.lineSoFar),j=YI(n,-10,P),V=this.lineSoFar;if(this.currentVertex)if(j){const X=this.currentVertexIsOutside,K=this.currentVertex,$=new bI(n.x,n.y,A,this.lineSoFar);SI(K,$,-10,P),YI($,-10,P)||(X&&(this.e1=this.e2=-1,this.lineSoFar=K.w,this.addHalfVertex(K,M,D,T,!1,d,h,K.z),this.addHalfVertex(K,v,C,T,!0,-g,h,K.z)),this.addVerticesTo(K,$,M,D,v,C,d,g,h,T))}else{const X=this.currentVertex;this.currentVertexIsOutside&&(SI(X,N,-10,P),this.e1=this.e2=-1,this.lineSoFar=X.w,this.addHalfVertex(X,M,D,T,!1,d,h,X.z),this.addHalfVertex(X,v,C,T,!0,-g,h,X.z)),this.addVerticesTo(X,N,M,D,v,C,d,g,h,T)}else j||(this.addHalfVertex(n,M,D,T,!1,d,h,y),this.addHalfVertex(n,v,C,T,!0,-g,h,y));this.currentVertex=N,this.currentVertexIsOutside=j,this.lineSoFar=V}else this.addHalfVertex(n,M,D,T,!1,d,h,y),this.addHalfVertex(n,v,C,T,!0,-g,h,y)}addHalfVertex({x:n,y:a},d,g,h,y,T,M,D){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),y||this.segmentPoints.push(this.lineSoFar-this.segmentStart,T)),this.layoutVertexArray.emplaceBack((n<<1)+(h?1:0),(a<<1)+(y?1:0),Math.round(63*d)+128,Math.round(63*g)+128,1+(T===0?0:T<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const v=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,v),M.primitiveLength++),y?this.e2=v:this.e1=v,D!=null&&this.zOffsetVertexArray.emplaceBack(D)}updateScaledDistance(){if(this.lineClips){const n=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=n*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(n,a){this.distance+=n.dist(a),this.updateScaledDistance()}}function YI(c,n,a){return c.x<n||c.x>a||c.y<n||c.y>a}let KI,JI;function QI(c,n,a){return n*(Mt/(c.tileSize*Math.pow(2,a-c.tileID.overscaledZ)))}function eD(c,n){return 1/QI(c,1,n.tileZoom)}function tD(c,n,a,d){return c.translatePosMatrix(d||n.tileID.projMatrix,n,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}Ot(Jw,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const nD=c=>{const n=[];rD(c)&&n.push("RENDER_LINE_DASH"),c.paint.get("line-gradient")&&n.push("RENDER_LINE_GRADIENT");const a=c.paint.get("line-trim-offset");a[0]===0&&a[1]===0||n.push("RENDER_LINE_TRIM_OFFSET"),c.paint.get("line-border-width").constantOr(1)!==0&&n.push("RENDER_LINE_BORDER");const d=c.layout.get("line-join").constantOr("miter")==="none",g=!!c.paint.get("line-pattern").constantOr(1);return d&&g&&n.push("LINE_JOIN_NONE"),n};function rD(c){const n=c.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}let Qw;const iD=()=>Qw||(Qw={layout:KI||(KI=new Sr({"line-cap":new Gt(We.layout_line["line-cap"]),"line-join":new Gt(We.layout_line["line-join"]),"line-miter-limit":new bt(We.layout_line["line-miter-limit"]),"line-round-limit":new bt(We.layout_line["line-round-limit"]),"line-sort-key":new Gt(We.layout_line["line-sort-key"]),"line-z-offset":new Gt(We.layout_line["line-z-offset"]),visibility:new bt(We.layout_line.visibility)})),paint:JI||(JI=new Sr({"line-opacity":new Gt(We.paint_line["line-opacity"]),"line-color":new Gt(We.paint_line["line-color"]),"line-translate":new bt(We.paint_line["line-translate"]),"line-translate-anchor":new bt(We.paint_line["line-translate-anchor"]),"line-width":new Gt(We.paint_line["line-width"]),"line-gap-width":new Gt(We.paint_line["line-gap-width"]),"line-offset":new Gt(We.paint_line["line-offset"]),"line-blur":new Gt(We.paint_line["line-blur"]),"line-dasharray":new Gt(We.paint_line["line-dasharray"]),"line-pattern":new Gt(We.paint_line["line-pattern"]),"line-gradient":new ho(We.paint_line["line-gradient"]),"line-trim-offset":new bt(We.paint_line["line-trim-offset"]),"line-trim-fade-range":new bt(We.paint_line["line-trim-fade-range"]),"line-trim-color":new bt(We.paint_line["line-trim-color"]),"line-emissive-strength":new bt(We.paint_line["line-emissive-strength"]),"line-border-width":new Gt(We.paint_line["line-border-width"]),"line-border-color":new Gt(We.paint_line["line-border-color"]),"line-occlusion-opacity":new bt(We.paint_line["line-occlusion-opacity"])}))},Qw);class FU extends Gt{possiblyEvaluate(n,a){return a=new kr(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition}),super.possiblyEvaluate(n,a)}evaluate(n,a,d,g){return a=Bi({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(n,a,d,g)}}let Ug;function sD(c,n){return n>0?n+2*c:c}const BU=Bn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),VU=Bn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),UU=Bn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Bn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const $U=Bn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),GU=Bn([{name:"a_texb",components:2,type:"Uint16"}]),WU=Bn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),HU=Bn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Bn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const oD=Bn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),qU=Bn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Bn([{name:"triangle",components:3,type:"Uint16"}]),Bn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Bn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Bn([{type:"Float32",name:"offsetX"}]),Bn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Li=24;const ba=128;function eS(c,n){const{expression:a}=n;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new kr(c+1))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:g}=a;let h=0;for(;h<d.length&&d[h]<=c;)h++;h=Math.max(0,h-1);let y=h;for(;y<d.length&&d[y]<c+1;)y++;y=Math.min(d.length-1,y);const T=d[h],M=d[y];return a.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:M,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:M,minSize:a.evaluate(new kr(T)),maxSize:a.evaluate(new kr(M)),interpolationType:g}}}function b0(c,{uSize:n,uSizeT:a},{lowerSize:d,upperSize:g}){return c.kind==="source"?d/ba:c.kind==="composite"?Xt(d/ba,g/ba,a):n}function Qf(c,n){let a=0,d=0;if(c.kind==="constant")d=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:g,minZoom:h,maxZoom:y}=c,T=g?mn(As.interpolationFactor(g,n,h,y),0,1):0;c.kind==="camera"?d=Xt(c.minSize,c.maxSize,T):a=T}return{uSizeT:a,uSize:d}}var ZU=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ba,evaluateSizeForFeature:b0,evaluateSizeForZoom:Qf,getSizeData:eS});function XU(c,n,a){return c.sections.forEach(d=>{d.text=function(g,h,y){const T=h.layout.get("text-transform").evaluate(y,{});return T==="uppercase"?g=g.toLocaleUpperCase():T==="lowercase"&&(g=g.toLocaleLowerCase()),hs.applyArabicShaping&&(g=hs.applyArabicShaping(g)),g}(d.text,n,a)}),c}const $g={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function YU(c){return c==="︶"||c==="﹈"||c==="︸"||c==="﹄"||c==="﹂"||c==="︾"||c==="︼"||c==="︺"||c==="︘"||c==="﹀"||c==="︐"||c==="︓"||c==="︔"||c==="｀"||c==="￣"||c==="︑"||c==="︒"}function KU(c){return c==="︵"||c==="﹇"||c==="︷"||c==="﹃"||c==="﹁"||c==="︽"||c==="︻"||c==="︹"||c==="︗"||c==="︿"}var aD,tS,lD,nS={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function JU(){return aD||(aD=1,nS.read=function(c,n,a,d,g){var h,y,T=8*g-d-1,M=(1<<T)-1,D=M>>1,v=-7,C=a?g-1:0,I=a?-1:1,P=c[n+C];for(C+=I,h=P&(1<<-v)-1,P>>=-v,v+=T;v>0;h=256*h+c[n+C],C+=I,v-=8);for(y=h&(1<<-v)-1,h>>=-v,v+=d;v>0;y=256*y+c[n+C],C+=I,v-=8);if(h===0)h=1-D;else{if(h===M)return y?NaN:1/0*(P?-1:1);y+=Math.pow(2,d),h-=D}return(P?-1:1)*y*Math.pow(2,h-d)},nS.write=function(c,n,a,d,g,h){var y,T,M,D=8*h-g-1,v=(1<<D)-1,C=v>>1,I=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=d?0:h-1,A=d?1:-1,N=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(T=isNaN(n)?1:0,y=v):(y=Math.floor(Math.log(n)/Math.LN2),n*(M=Math.pow(2,-y))<1&&(y--,M*=2),(n+=y+C>=1?I/M:I*Math.pow(2,1-C))*M>=2&&(y++,M/=2),y+C>=v?(T=0,y=v):y+C>=1?(T=(n*M-1)*Math.pow(2,g),y+=C):(T=n*Math.pow(2,C-1)*Math.pow(2,g),y=0));g>=8;c[a+P]=255&T,P+=A,T/=256,g-=8);for(y=y<<g|T,D+=g;D>0;c[a+P]=255&y,P+=A,y/=256,D-=8);c[a+P-A]|=128*N}),nS}function cD(){if(lD)return tS;lD=1,tS=n;var c=JU();function n($){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView($)?$:new Uint8Array($||0),this.pos=0,this.type=0,this.length=this.buf.length}n.Varint=0,n.Fixed64=1,n.Bytes=2,n.Fixed32=5;var a=4294967296,d=1/a,g=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function h($){return $.type===n.Bytes?$.readVarint()+$.pos:$.pos+1}function y($,ne,ie){return ie?4294967296*ne+($>>>0):4294967296*(ne>>>0)+($>>>0)}function T($,ne,ie){var ue=ne<=16383?1:ne<=2097151?2:ne<=268435455?3:Math.floor(Math.log(ne)/(7*Math.LN2));ie.realloc(ue);for(var pe=ie.pos-1;pe>=$;pe--)ie.buf[pe+ue]=ie.buf[pe]}function M($,ne){for(var ie=0;ie<$.length;ie++)ne.writeVarint($[ie])}function D($,ne){for(var ie=0;ie<$.length;ie++)ne.writeSVarint($[ie])}function v($,ne){for(var ie=0;ie<$.length;ie++)ne.writeFloat($[ie])}function C($,ne){for(var ie=0;ie<$.length;ie++)ne.writeDouble($[ie])}function I($,ne){for(var ie=0;ie<$.length;ie++)ne.writeBoolean($[ie])}function P($,ne){for(var ie=0;ie<$.length;ie++)ne.writeFixed32($[ie])}function A($,ne){for(var ie=0;ie<$.length;ie++)ne.writeSFixed32($[ie])}function N($,ne){for(var ie=0;ie<$.length;ie++)ne.writeFixed64($[ie])}function j($,ne){for(var ie=0;ie<$.length;ie++)ne.writeSFixed64($[ie])}function V($,ne){return($[ne]|$[ne+1]<<8|$[ne+2]<<16)+16777216*$[ne+3]}function X($,ne,ie){$[ie]=ne,$[ie+1]=ne>>>8,$[ie+2]=ne>>>16,$[ie+3]=ne>>>24}function K($,ne){return($[ne]|$[ne+1]<<8|$[ne+2]<<16)+($[ne+3]<<24)}return n.prototype={destroy:function(){this.buf=null},readFields:function($,ne,ie){for(ie=ie||this.length;this.pos<ie;){var ue=this.readVarint(),pe=ue>>3,ge=this.pos;this.type=7&ue,$(pe,ne,this),this.pos===ge&&this.skip(ue)}return ne},readMessage:function($,ne){return this.readFields($,ne,this.readVarint()+this.pos)},readFixed32:function(){var $=V(this.buf,this.pos);return this.pos+=4,$},readSFixed32:function(){var $=K(this.buf,this.pos);return this.pos+=4,$},readFixed64:function(){var $=V(this.buf,this.pos)+V(this.buf,this.pos+4)*a;return this.pos+=8,$},readSFixed64:function(){var $=V(this.buf,this.pos)+K(this.buf,this.pos+4)*a;return this.pos+=8,$},readFloat:function(){var $=c.read(this.buf,this.pos,!0,23,4);return this.pos+=4,$},readDouble:function(){var $=c.read(this.buf,this.pos,!0,52,8);return this.pos+=8,$},readVarint:function($){var ne,ie,ue=this.buf;return ne=127&(ie=ue[this.pos++]),ie<128?ne:(ne|=(127&(ie=ue[this.pos++]))<<7,ie<128?ne:(ne|=(127&(ie=ue[this.pos++]))<<14,ie<128?ne:(ne|=(127&(ie=ue[this.pos++]))<<21,ie<128?ne:function(pe,ge,he){var Se,_e,Ce=he.buf;if(Se=(112&(_e=Ce[he.pos++]))>>4,_e<128||(Se|=(127&(_e=Ce[he.pos++]))<<3,_e<128)||(Se|=(127&(_e=Ce[he.pos++]))<<10,_e<128)||(Se|=(127&(_e=Ce[he.pos++]))<<17,_e<128)||(Se|=(127&(_e=Ce[he.pos++]))<<24,_e<128)||(Se|=(1&(_e=Ce[he.pos++]))<<31,_e<128))return y(pe,Se,ge);throw new Error("Expected varint not more than 10 bytes")}(ne|=(15&(ie=ue[this.pos]))<<28,$,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var $=this.readVarint();return $%2==1?($+1)/-2:$/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var $=this.readVarint()+this.pos,ne=this.pos;return this.pos=$,$-ne>=12&&g?function(ie,ue,pe){return g.decode(ie.subarray(ue,pe))}(this.buf,ne,$):function(ie,ue,pe){for(var ge="",he=ue;he<pe;){var Se,_e,Ce,Le=ie[he],je=null,ze=Le>239?4:Le>223?3:Le>191?2:1;if(he+ze>pe)break;ze===1?Le<128&&(je=Le):ze===2?(192&(Se=ie[he+1]))==128&&(je=(31&Le)<<6|63&Se)<=127&&(je=null):ze===3?(_e=ie[he+2],(192&(Se=ie[he+1]))==128&&(192&_e)==128&&((je=(15&Le)<<12|(63&Se)<<6|63&_e)<=2047||je>=55296&&je<=57343)&&(je=null)):ze===4&&(_e=ie[he+2],Ce=ie[he+3],(192&(Se=ie[he+1]))==128&&(192&_e)==128&&(192&Ce)==128&&((je=(15&Le)<<18|(63&Se)<<12|(63&_e)<<6|63&Ce)<=65535||je>=1114112)&&(je=null)),je===null?(je=65533,ze=1):je>65535&&(je-=65536,ge+=String.fromCharCode(je>>>10&1023|55296),je=56320|1023&je),ge+=String.fromCharCode(je),he+=ze}return ge}(this.buf,ne,$)},readBytes:function(){var $=this.readVarint()+this.pos,ne=this.buf.subarray(this.pos,$);return this.pos=$,ne},readPackedVarint:function($,ne){if(this.type!==n.Bytes)return $.push(this.readVarint(ne));var ie=h(this);for($=$||[];this.pos<ie;)$.push(this.readVarint(ne));return $},readPackedSVarint:function($){if(this.type!==n.Bytes)return $.push(this.readSVarint());var ne=h(this);for($=$||[];this.pos<ne;)$.push(this.readSVarint());return $},readPackedBoolean:function($){if(this.type!==n.Bytes)return $.push(this.readBoolean());var ne=h(this);for($=$||[];this.pos<ne;)$.push(this.readBoolean());return $},readPackedFloat:function($){if(this.type!==n.Bytes)return $.push(this.readFloat());var ne=h(this);for($=$||[];this.pos<ne;)$.push(this.readFloat());return $},readPackedDouble:function($){if(this.type!==n.Bytes)return $.push(this.readDouble());var ne=h(this);for($=$||[];this.pos<ne;)$.push(this.readDouble());return $},readPackedFixed32:function($){if(this.type!==n.Bytes)return $.push(this.readFixed32());var ne=h(this);for($=$||[];this.pos<ne;)$.push(this.readFixed32());return $},readPackedSFixed32:function($){if(this.type!==n.Bytes)return $.push(this.readSFixed32());var ne=h(this);for($=$||[];this.pos<ne;)$.push(this.readSFixed32());return $},readPackedFixed64:function($){if(this.type!==n.Bytes)return $.push(this.readFixed64());var ne=h(this);for($=$||[];this.pos<ne;)$.push(this.readFixed64());return $},readPackedSFixed64:function($){if(this.type!==n.Bytes)return $.push(this.readSFixed64());var ne=h(this);for($=$||[];this.pos<ne;)$.push(this.readSFixed64());return $},skip:function($){var ne=7&$;if(ne===n.Varint)for(;this.buf[this.pos++]>127;);else if(ne===n.Bytes)this.pos=this.readVarint()+this.pos;else if(ne===n.Fixed32)this.pos+=4;else{if(ne!==n.Fixed64)throw new Error("Unimplemented type: "+ne);this.pos+=8}},writeTag:function($,ne){this.writeVarint($<<3|ne)},realloc:function($){for(var ne=this.length||16;ne<this.pos+$;)ne*=2;if(ne!==this.length){var ie=new Uint8Array(ne);ie.set(this.buf),this.buf=ie,this.length=ne}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function($){this.realloc(4),X(this.buf,$,this.pos),this.pos+=4},writeSFixed32:function($){this.realloc(4),X(this.buf,$,this.pos),this.pos+=4},writeFixed64:function($){this.realloc(8),X(this.buf,-1&$,this.pos),X(this.buf,Math.floor($*d),this.pos+4),this.pos+=8},writeSFixed64:function($){this.realloc(8),X(this.buf,-1&$,this.pos),X(this.buf,Math.floor($*d),this.pos+4),this.pos+=8},writeVarint:function($){($=+$||0)>268435455||$<0?function(ne,ie){var ue,pe;if(ne>=0?(ue=ne%4294967296|0,pe=ne/4294967296|0):(pe=~(-ne/4294967296),4294967295^(ue=~(-ne%4294967296))?ue=ue+1|0:(ue=0,pe=pe+1|0)),ne>=18446744073709552e3||ne<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ie.realloc(10),function(ge,he,Se){Se.buf[Se.pos++]=127&ge|128,ge>>>=7,Se.buf[Se.pos++]=127&ge|128,ge>>>=7,Se.buf[Se.pos++]=127&ge|128,ge>>>=7,Se.buf[Se.pos++]=127&ge|128,Se.buf[Se.pos]=127&(ge>>>=7)}(ue,0,ie),function(ge,he){var Se=(7&ge)<<4;he.buf[he.pos++]|=Se|((ge>>>=3)?128:0),ge&&(he.buf[he.pos++]=127&ge|((ge>>>=7)?128:0),ge&&(he.buf[he.pos++]=127&ge|((ge>>>=7)?128:0),ge&&(he.buf[he.pos++]=127&ge|((ge>>>=7)?128:0),ge&&(he.buf[he.pos++]=127&ge|((ge>>>=7)?128:0),ge&&(he.buf[he.pos++]=127&ge)))))}(pe,ie)}($,this):(this.realloc(4),this.buf[this.pos++]=127&$|($>127?128:0),$<=127||(this.buf[this.pos++]=127&($>>>=7)|($>127?128:0),$<=127||(this.buf[this.pos++]=127&($>>>=7)|($>127?128:0),$<=127||(this.buf[this.pos++]=$>>>7&127))))},writeSVarint:function($){this.writeVarint($<0?2*-$-1:2*$)},writeBoolean:function($){this.writeVarint(!!$)},writeString:function($){$=String($),this.realloc(4*$.length),this.pos++;var ne=this.pos;this.pos=function(ue,pe,ge){for(var he,Se,_e=0;_e<pe.length;_e++){if((he=pe.charCodeAt(_e))>55295&&he<57344){if(!Se){he>56319||_e+1===pe.length?(ue[ge++]=239,ue[ge++]=191,ue[ge++]=189):Se=he;continue}if(he<56320){ue[ge++]=239,ue[ge++]=191,ue[ge++]=189,Se=he;continue}he=Se-55296<<10|he-56320|65536,Se=null}else Se&&(ue[ge++]=239,ue[ge++]=191,ue[ge++]=189,Se=null);he<128?ue[ge++]=he:(he<2048?ue[ge++]=he>>6|192:(he<65536?ue[ge++]=he>>12|224:(ue[ge++]=he>>18|240,ue[ge++]=he>>12&63|128),ue[ge++]=he>>6&63|128),ue[ge++]=63&he|128)}return ge}(this.buf,$,this.pos);var ie=this.pos-ne;ie>=128&&T(ne,ie,this),this.pos=ne-1,this.writeVarint(ie),this.pos+=ie},writeFloat:function($){this.realloc(4),c.write(this.buf,$,this.pos,!0,23,4),this.pos+=4},writeDouble:function($){this.realloc(8),c.write(this.buf,$,this.pos,!0,52,8),this.pos+=8},writeBytes:function($){var ne=$.length;this.writeVarint(ne),this.realloc(ne);for(var ie=0;ie<ne;ie++)this.buf[this.pos++]=$[ie]},writeRawMessage:function($,ne){this.pos++;var ie=this.pos;$(ne,this);var ue=this.pos-ie;ue>=128&&T(ie,ue,this),this.pos=ie-1,this.writeVarint(ue),this.pos+=ue},writeMessage:function($,ne,ie){this.writeTag($,n.Bytes),this.writeRawMessage(ne,ie)},writePackedVarint:function($,ne){ne.length&&this.writeMessage($,M,ne)},writePackedSVarint:function($,ne){ne.length&&this.writeMessage($,D,ne)},writePackedBoolean:function($,ne){ne.length&&this.writeMessage($,I,ne)},writePackedFloat:function($,ne){ne.length&&this.writeMessage($,v,ne)},writePackedDouble:function($,ne){ne.length&&this.writeMessage($,C,ne)},writePackedFixed32:function($,ne){ne.length&&this.writeMessage($,P,ne)},writePackedSFixed32:function($,ne){ne.length&&this.writeMessage($,A,ne)},writePackedFixed64:function($,ne){ne.length&&this.writeMessage($,N,ne)},writePackedSFixed64:function($,ne){ne.length&&this.writeMessage($,j,ne)},writeBytesField:function($,ne){this.writeTag($,n.Bytes),this.writeBytes(ne)},writeFixed32Field:function($,ne){this.writeTag($,n.Fixed32),this.writeFixed32(ne)},writeSFixed32Field:function($,ne){this.writeTag($,n.Fixed32),this.writeSFixed32(ne)},writeFixed64Field:function($,ne){this.writeTag($,n.Fixed64),this.writeFixed64(ne)},writeSFixed64Field:function($,ne){this.writeTag($,n.Fixed64),this.writeSFixed64(ne)},writeVarintField:function($,ne){this.writeTag($,n.Varint),this.writeVarint(ne)},writeSVarintField:function($,ne){this.writeTag($,n.Varint),this.writeSVarint(ne)},writeStringField:function($,ne){this.writeTag($,n.Bytes),this.writeString(ne)},writeFloatField:function($,ne){this.writeTag($,n.Fixed32),this.writeFloat(ne)},writeDoubleField:function($,ne){this.writeTag($,n.Fixed64),this.writeDouble(ne)},writeBooleanField:function($,ne){this.writeVarintField($,!!ne)}},tS}var w0=k(cD());const rS=3;function QU(c,n,a){n.glyphs=[],c===1&&a.readMessage(e3,n)}function e3(c,n,a){if(c===3){const{id:d,bitmap:g,width:h,height:y,left:T,top:M,advance:D}=a.readMessage(t3,{});n.glyphs.push({id:d,bitmap:new cu({width:h+2*rS,height:y+2*rS},g),metrics:{width:h,height:y,left:T,top:M,advance:D}})}else c===4?n.ascender=a.readSVarint():c===5&&(n.descender=a.readSVarint())}function t3(c,n,a){c===1?n.id=a.readVarint():c===2?n.bitmap=a.readBytes():c===3?n.width=a.readVarint():c===4?n.height=a.readVarint():c===5?n.left=a.readSVarint():c===6?n.top=a.readSVarint():c===7&&(n.advance=a.readVarint())}const uD=rS,mo={horizontal:1,vertical:2,horizontalOnly:3};class Gg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,a){const d=new Gg;return d.scale=n||1,d.fontStack=a,d}static forImage(n){const a=new Gg;return a.imageName=n,a}}class ep{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,a){const d=new ep;for(let g=0;g<n.sections.length;g++){const h=n.sections[g];h.image?d.addImageSection(h):d.addTextSection(h,a)}return d}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCodePoint(n){return this.text.codePointAt(n)}verticalizePunctuation(n){this.text=function(a,d){let g="";for(let h=0;h<a.length;h++){const y=a.charCodeAt(h+1)||null,T=a.charCodeAt(h-1)||null;g+=!d&&(y&&zd(y)&&!$g[a[h+1]]||T&&zd(T)&&!$g[a[h-1]])||!$g[a[h]]?a[h]:$g[a[h]]}return g}(this.text,n)}trim(){let n=0;for(let d=0;d<this.text.length&&S0[this.text.charCodeAt(d)];d++)n++;let a=this.text.length;for(let d=this.text.length-1;d>=0&&d>=n&&S0[this.text.charCodeAt(d)];d--)a--;this.text=this.text.substring(n,a),this.sectionIndex=this.sectionIndex.slice(n,a)}substring(n,a){const d=new ep;return d.text=this.text.substring(n,a),d.sectionIndex=this.sectionIndex.slice(n,a),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,a)=>Math.max(n,this.sections[a].scale),0)}addTextSection(n,a){this.text+=n.text,this.sections.push(Gg.forText(n.scale,n.fontStack||a));const d=this.sections.length-1;for(let g=0;g<n.text.length;++g)this.sectionIndex.push(d)}addImageSection(n){const a=n.image?n.image.namePrimary:"";if(a.length===0)return void zn("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCodePoint(d),this.sections.push(Gg.forImage(a)),this.sectionIndex.push(this.sections.length-1)):zn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function iS(c,n,a,d,g,h,y,T,M,D,v,C,I,P,A){const N=ep.fromFeature(c,g);C===mo.vertical&&N.verticalizePunctuation(I);let j=[];const V=function(ie,ue,pe,ge,he,Se){if(!ie)return[];const _e=[],Ce=function(Fe,Ze,Ve,rt,ct,Je){let Dt=0;for(let Pt=0;Pt<Fe.length();Pt++){const xt=Fe.getSection(Pt);Dt+=dD(Fe.getCodePoint(Pt),xt,rt,ct,Ze,Je)}return Dt/Math.max(1,Math.ceil(Dt/Ve))}(ie,ue,pe,ge,he,Se),Le=ie.text.indexOf("​")>=0;let je=0;for(let Fe=0;Fe<ie.length();Fe++){const Ze=ie.getSection(Fe),Ve=ie.getCodePoint(Fe);if(S0[Ve]||(je+=dD(Ve,Ze,ge,he,ue,Se)),Fe<ie.length()-1){const rt=!((ze=Ve)<11904||!($t["Bopomofo Extended"](ze)||$t.Bopomofo(ze)||$t["CJK Compatibility Forms"](ze)||$t["CJK Compatibility Ideographs"](ze)||$t["CJK Compatibility"](ze)||$t["CJK Radicals Supplement"](ze)||$t["CJK Strokes"](ze)||$t["CJK Symbols and Punctuation"](ze)||$t["CJK Unified Ideographs Extension A"](ze)||$t["CJK Unified Ideographs"](ze)||$t["Enclosed CJK Letters and Months"](ze)||$t["Halfwidth and Fullwidth Forms"](ze)||$t.Hiragana(ze)||$t["Ideographic Description Characters"](ze)||$t["Kangxi Radicals"](ze)||$t["Katakana Phonetic Extensions"](ze)||$t.Katakana(ze)||$t["Vertical Forms"](ze)||$t["Yi Radicals"](ze)||$t["Yi Syllables"](ze)));(n3[Ve]||rt||Ze.imageName)&&_e.push(fD(Fe+1,je,Ce,_e,r3(Ve,ie.getCodePoint(Fe+1),rt&&Le),!1))}}var ze;return pD(fD(ie.length(),je,Ce,_e,0,!0))}(N,D,h,n,d,P),{processBidirectionalText:X,processStyledBidirectionalText:K}=hs;if(X&&N.sections.length===1){const ie=X(N.toString(),V);for(const ue of ie){const pe=new ep;pe.text=ue,pe.sections=N.sections;for(let ge=0;ge<ue.length;ge++)pe.sectionIndex.push(0);j.push(pe)}}else if(K){const ie=K(N.text,N.sectionIndex,V);for(const ue of ie){const pe=new ep;pe.text=ue[0],pe.sectionIndex=ue[1],pe.sections=N.sections,j.push(pe)}}else j=function(ie,ue){const pe=[],ge=ie.text;let he=0;for(const Se of ue)pe.push(ie.substring(he,Se)),he=Se;return he<ge.length&&pe.push(ie.substring(he,ge.length)),pe}(N,V);const $=[],ne={positionedLines:$,text:N.toString(),top:v[1],bottom:v[1],left:v[0],right:v[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ie,ue,pe,ge,he,Se,_e,Ce,Le,je,ze,Fe){let Ze=0,Ve=0,rt=0;const ct=Ce==="right"?1:Ce==="left"?0:.5;let Je=!1;for(const At of he){const Lt=At.getSections();for(const nn of Lt){if(nn.imageName)continue;const xn=ue[nn.fontStack];if(xn&&(Je=xn.ascender!==void 0&&xn.descender!==void 0,!Je))break}if(!Je)break}let Dt=0;for(const At of he){At.trim();const Lt=At.getMaxScale(),nn=(Lt-1)*Li,xn={positionedGlyphs:[],lineOffset:0};ie.positionedLines[Dt]=xn;const fn=xn.positionedGlyphs;let pn=0;if(!At.length()){Ve+=Se,++Dt;continue}let Sn=0,Tn=0;for(let Jn=0;Jn<At.length();Jn++){const sn=At.getSection(Jn),$n=At.getSectionIndex(Jn),Wn=At.getCodePoint(Jn);let _r=sn.scale,jr=null,qr=null,zr=null,Mr=Li,wi=0;const ti=!(Le===mo.horizontal||!ze&&!kf(Wn)||ze&&(S0[Wn]||(Pt=Wn,$t.Arabic(Pt)||$t["Arabic Supplement"](Pt)||$t["Arabic Extended-A"](Pt)||$t["Arabic Presentation Forms-A"](Pt)||$t["Arabic Presentation Forms-B"](Pt))));if(sn.imageName){const Oi=ge[sn.imageName];if(!Oi)continue;zr=sn.imageName,ie.iconsInText=ie.iconsInText||!0,qr=Oi.paddedRect;const mr=Oi.displaySize;_r=_r*Li/Fe,jr={width:mr[0],height:mr[1],left:0,top:-uD,advance:ti?mr[1]:mr[0],localGlyph:!1},wi=Je?-jr.height*_r:Lt*Li-17-mr[1]*_r,Mr=jr.advance;const Rs=(ti?mr[0]:mr[1])*_r-Li*Lt;Rs>0&&Rs>pn&&(pn=Rs)}else{const Oi=pe[sn.fontStack];if(!Oi)continue;Oi[Wn]&&(qr=Oi[Wn]);const mr=ue[sn.fontStack];if(!mr)continue;const Rs=mr.glyphs[Wn];if(!Rs)continue;if(jr=Rs.metrics,Mr=Wn!==8203?Li:0,Je){const Ca=mr.ascender!==void 0?Math.abs(mr.ascender):0,Wo=mr.descender!==void 0?Math.abs(mr.descender):0,Ho=(Ca+Wo)*_r;Sn<Ho&&(Sn=Ho,Tn=(Ca-Wo)/2*_r),wi=-Ca*_r}else wi=(Lt-_r)*Li-17}ti?(ie.verticalizable=!0,fn.push({glyph:Wn,imageName:zr,x:Ze,y:Ve+wi,vertical:ti,scale:_r,localGlyph:jr.localGlyph,fontStack:sn.fontStack,sectionIndex:$n,metrics:jr,rect:qr}),Ze+=Mr*_r+je):(fn.push({glyph:Wn,imageName:zr,x:Ze,y:Ve+wi,vertical:ti,scale:_r,localGlyph:jr.localGlyph,fontStack:sn.fontStack,sectionIndex:$n,metrics:jr,rect:qr}),Ze+=jr.advance*_r+je)}fn.length!==0&&(rt=Math.max(Ze-je,rt),Je?mD(fn,ct,pn,Tn,Se*Lt/2):mD(fn,ct,pn,0,Se/2)),Ze=0;const cr=Se*Lt+pn;xn.lineOffset=Math.max(pn,nn),Ve+=cr,++Dt}var Pt;const xt=Ve,{horizontalAlign:ht,verticalAlign:Ht}=sS(_e);(function(At,Lt,nn,xn,fn,pn){const Sn=(Lt-nn)*fn,Tn=-pn*xn;for(const cr of At)for(const Jn of cr.positionedGlyphs)Jn.x+=Sn,Jn.y+=Tn})(ie.positionedLines,ct,ht,Ht,rt,xt),ie.top+=-Ht*xt,ie.bottom=ie.top+xt,ie.left+=-ht*rt,ie.right=ie.left+rt,ie.hasBaseline=Je}(ne,n,a,d,j,y,T,M,C,D,I,A),!function(ie){for(const ue of ie)if(ue.positionedGlyphs.length!==0)return!1;return!0}($)&&ne}const S0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},n3={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function dD(c,n,a,d,g,h){if(n.imageName){const y=d[n.imageName];return y?y.displaySize[0]*n.scale*Li/h+g:0}{const y=a[n.fontStack],T=y&&y.glyphs[c];return T?T.metrics.advance*n.scale+g:0}}function hD(c,n,a,d){const g=Math.pow(c-n,2);return d?c<n?g/2:2*g:g+Math.abs(a)*a}function r3(c,n,a){let d=0;return c===10&&(d-=1e4),a&&(d+=150),c!==40&&c!==65288||(d+=50),n!==41&&n!==65289||(d+=50),d}function fD(c,n,a,d,g,h){let y=null,T=hD(n,a,g,h);for(const M of d){const D=hD(n-M.x,a,g,h)+M.badness;D<=T&&(y=M,T=D)}return{index:c,x:n,priorBreak:y,badness:T}}function pD(c){return c?pD(c.priorBreak).concat(c.index):[]}function sS(c){let n=.5,a=.5;switch(c){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:n,verticalAlign:a}}function mD(c,n,a,d,g){if(!(n||a||d||g))return;const h=c.length-1,y=c[h],T=(y.x+y.metrics.advance*y.scale)*n;for(let M=0;M<=h;M++)c[M].x-=T,c[M].y+=a+d+g}function i3(c,n,a,d){const{horizontalAlign:g,verticalAlign:h}=sS(d),y=a[0]-c.displaySize[0]*g,T=a[1]-c.displaySize[1]*h;return{imagePrimary:c,imageSecondary:n,top:T,bottom:T+c.displaySize[1],left:y,right:y+c.displaySize[0]}}function gD(c,n,a,d,g,h){const y=c.imagePrimary;let T;if(y.content){const j=y.content,V=y.pixelRatio||1;T=[j[0]/V,j[1]/V,y.displaySize[0]-j[2]/V,y.displaySize[1]-j[3]/V]}const M=n.left*h,D=n.right*h;let v,C,I,P;a==="width"||a==="both"?(P=g[0]+M-d[3],C=g[0]+D+d[1]):(P=g[0]+(M+D-y.displaySize[0])/2,C=P+y.displaySize[0]);const A=n.top*h,N=n.bottom*h;return a==="height"||a==="both"?(v=g[1]+A-d[0],I=g[1]+N+d[2]):(v=g[1]+(A+N-y.displaySize[1])/2,I=v+y.displaySize[1]),{imagePrimary:y,imageSecondary:void 0,top:v,right:C,bottom:I,left:P,collisionPadding:T}}class $l extends Tt{constructor(n,a,d,g,h){super(n,a),this.angle=g,this.z=d,h!==void 0&&(this.segment=h)}clone(){return new $l(this.x,this.y,this.z,this.angle,this.segment)}}function yD(c,n,a,d,g){if(n.segment===void 0)return!0;let h=n,y=n.segment+1,T=0;for(;T>-a/2;){if(y--,y<0)return!1;T-=c[y].dist(h),h=c[y]}T+=c[y].dist(c[y+1]),y++;const M=[];let D=0;for(;T<a/2;){const v=c[y],C=c[y+1];if(!C)return!1;let I=c[y-1].angleTo(v)-v.angleTo(C);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:T,angleDelta:I}),D+=I;T-M[0].distance>d;)D-=M.shift().angleDelta;if(D>g)return!1;y++,T+=v.dist(C)}return!0}function _D(c){let n=0;for(let a=0;a<c.length-1;a++)n+=c[a].dist(c[a+1]);return n}function xD(c,n,a){return c?.6*n*a:0}function vD(c,n){return Math.max(c?c.right-c.left:0,n?n.right-n.left:0)}function s3(c,n,a,d,g,h){const y=xD(a,g,h),T=vD(a,d)*h;let M=0;const D=_D(c)/2;for(let v=0;v<c.length-1;v++){const C=c[v],I=c[v+1],P=C.dist(I);if(M+P>D){const A=(D-M)/P,N=Xt(C.x,I.x,A),j=Xt(C.y,I.y,A),V=new $l(N,j,0,I.angleTo(C),v);return!y||yD(c,V,T,y,n)?V:void 0}M+=P}}function o3(c,n,a,d,g,h,y,T,M){const D=xD(d,h,y),v=vD(d,g),C=v*y,I=c[0].x===0||c[0].x===M||c[0].y===0||c[0].y===M;return n-C<n/4&&(n=C+n/4),bD(c,I?n/2*T%n:(v/2+2*h)*y*T%n,n,D,a,C,I,!1,M)}function bD(c,n,a,d,g,h,y,T,M){const D=h/2,v=_D(c);let C=0,I=n-a,P=[];for(let A=0;A<c.length-1;A++){const N=c[A],j=c[A+1],V=N.dist(j),X=j.angleTo(N);for(;I+a<C+V;){I+=a;const K=(I-C)/V,$=Xt(N.x,j.x,K),ne=Xt(N.y,j.y,K);if($>=0&&$<M&&ne>=0&&ne<M&&I-D>=0&&I+D<=v){const ie=new $l($,ne,0,X,A);d&&!yD(c,ie,h,d,g)||P.push(ie)}}C+=V}return T||P.length||y||(P=bD(c,C/2,a,d,g,h,y,!0,M)),P}function wD(c,n,a,d,g){const h=[];for(let y=0;y<c.length;y++){const T=c[y];let M;for(let D=0;D<T.length-1;D++){let v=T[D],C=T[D+1];v.x<n&&C.x<n||(v.x<n?v=new Tt(n,v.y+(n-v.x)/(C.x-v.x)*(C.y-v.y))._round():C.x<n&&(C=new Tt(n,v.y+(n-v.x)/(C.x-v.x)*(C.y-v.y))._round()),v.y<a&&C.y<a||(v.y<a?v=new Tt(v.x+(a-v.y)/(C.y-v.y)*(C.x-v.x),a)._round():C.y<a&&(C=new Tt(v.x+(a-v.y)/(C.y-v.y)*(C.x-v.x),a)._round()),v.x>=d&&C.x>=d||(v.x>=d?v=new Tt(d,v.y+(d-v.x)/(C.x-v.x)*(C.y-v.y))._round():C.x>=d&&(C=new Tt(d,v.y+(d-v.x)/(C.x-v.x)*(C.y-v.y))._round()),v.y>=g&&C.y>=g||(v.y>=g?v=new Tt(v.x+(g-v.y)/(C.y-v.y)*(C.x-v.x),g)._round():C.y>=g&&(C=new Tt(v.x+(g-v.y)/(C.y-v.y)*(C.x-v.x),g)._round()),M&&v.equals(M[M.length-1])||(M=[v],h.push(M)),M.push(C)))))}}return h}function SD(c){let n=0,a=0;for(const y of c)n+=y.w*y.h,a=Math.max(a,y.w);c.sort((y,T)=>T.h-y.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),a),h:1/0}];let g=0,h=0;for(const y of c)for(let T=d.length-1;T>=0;T--){const M=d[T];if(!(y.w>M.w||y.h>M.h)){if(y.x=M.x,y.y=M.y,h=Math.max(h,y.y+y.h),g=Math.max(g,y.x+y.w),y.w===M.w&&y.h===M.h){const D=d.pop();T<d.length&&(d[T]=D)}else y.h===M.h?(M.x+=y.w,M.w-=y.w):y.w===M.w?(M.y+=y.h,M.h-=y.h):(d.push({x:M.x+y.w,y:M.y,w:M.w-y.w,h:y.h}),M.y+=y.h,M.h-=y.h);break}}return{w:g,h,fill:n/(g*h)||0}}Ot($l,"Anchor");const Wg=1;class oS{constructor(n,{pixelRatio:a,version:d,stretchX:g,stretchY:h,content:y},T){this.paddedRect=n,this.pixelRatio=a,this.stretchX=g,this.stretchY=h,this.content=y,this.version=d,this.padding=T}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class TD{constructor(n,a,d){const g={},h={};this.haveRenderCallbacks=[];const y=[];this.addImages(n,g,Wg,y),this.addImages(a,h,2,y);const{w:T,h:M}=SD(y),D=new ts({width:T||1,height:M||1});for(const v in n){const C=n[v],I=g[v].paddedRect;ts.copy(C.data,D,{x:0,y:0},{x:I.x+Wg,y:I.y+Wg},C.data,d,C.sdf)}for(const v in a){const C=a[v],I=h[v].paddedRect;let P=h[v].padding;const A=I.x+P,N=I.y+P,j=C.data.width,V=C.data.height;P=P>1?P-1:P,ts.copy(C.data,D,{x:0,y:0},{x:A,y:N},C.data,d),ts.copy(C.data,D,{x:0,y:V-P},{x:A,y:N-P},{width:j,height:P},d),ts.copy(C.data,D,{x:0,y:0},{x:A,y:N+V},{width:j,height:P},d),ts.copy(C.data,D,{x:j-P,y:0},{x:A-P,y:N},{width:P,height:V},d),ts.copy(C.data,D,{x:0,y:0},{x:A+j,y:N},{width:P,height:V},d),ts.copy(C.data,D,{x:j-P,y:V-P},{x:A-P,y:N-P},{width:P,height:P},d),ts.copy(C.data,D,{x:0,y:V-P},{x:A+j,y:N-P},{width:P,height:P},d),ts.copy(C.data,D,{x:0,y:0},{x:A+j,y:N+V},{width:P,height:P},d),ts.copy(C.data,D,{x:j-P,y:0},{x:A-P,y:N+V},{width:P,height:P},d)}this.image=D,this.iconPositions=g,this.patternPositions=h}addImages(n,a,d,g){for(const h in n){const y=n[h],T={x:0,y:0,w:y.data.width+2*d,h:y.data.height+2*d};g.push(T),a[h]=new oS(T,y,d),y.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(n,a,d){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(g=>n.hasImage(g,d)),n.dispatchRenderCallbacks(this.haveRenderCallbacks,d);for(const g in n.getUpdatedImages(d))this.patchUpdatedImage(this.iconPositions[g],n.getImage(g,d),a),this.patchUpdatedImage(this.patternPositions[g],n.getImage(g,d),a)}patchUpdatedImage(n,a,d){if(!n||!a||n.version===a.version)return;n.version=a.version;const[g,h]=n.tl;d.update(a.data,{position:{x:g,y:h}})}}Ot(oS,"ImagePosition"),Ot(TD,"ImageAtlas");const Hg=1e20;function ED(c,n,a,d,g,h,y,T,M){for(let D=n;D<n+d;D++)CD(c,a*h+D,h,g,y,T,M);for(let D=a;D<a+g;D++)CD(c,D*h+n,1,d,y,T,M)}function CD(c,n,a,d,g,h,y){h[0]=0,y[0]=-Hg,y[1]=Hg,g[0]=c[n];for(let T=1,M=0,D=0;T<d;T++){g[T]=c[n+T*a];const v=T*T;do{const C=h[M];D=(g[T]-g[C]+v-C*C)/(T-C)/2}while(D<=y[M]&&--M>-1);M++,h[M]=T,y[M]=D,y[M+1]=Hg}for(let T=0,M=0;T<d;T++){for(;y[M+1]<T;)M++;const D=h[M],v=T-D;c[n+T*a]=g[D]+v*v}}const wa=2,aS={none:0,ideographs:1,all:2};class tp{constructor(n,a,d){this.requestManager=n,this.localGlyphMode=a,this.localFontFamily=d,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n,a){this.urls[a]=n}getGlyphs(n,a,d){const g=[],h=this.urls[a]||Re.GLYPHS_URL;for(const y in n)for(const T of n[y])g.push({stack:y,id:T});Tl(g,({stack:y,id:T},M)=>{let D=this.entries[y];D||(D=this.entries[y]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let v=D.glyphs[T];if(v!==void 0)return void M(null,{stack:y,id:T,glyph:v});if(v=this._tinySDF(D,y,T),v)return D.glyphs[T]=v,void M(null,{stack:y,id:T,glyph:v});const C=Math.floor(T/256);if(256*C>65535)return void M(new Error("glyphs > 65535 not supported"));if(D.ranges[C])return void M(null,{stack:y,id:T,glyph:v});let I=D.requests[C];I||(I=D.requests[C]=[],tp.loadGlyphRange(y,C,h,this.requestManager,(P,A)=>{if(A){D.ascender=A.ascender,D.descender=A.descender;for(const N in A.glyphs)this._doesCharSupportLocalGlyph(+N)||(D.glyphs[+N]=A.glyphs[+N]);D.ranges[C]=!0}for(const N of I)N(P,A);delete D.requests[C]})),I.push((P,A)=>{P?M(P):A&&M(null,{stack:y,id:T,glyph:A.glyphs[T]||null})})},(y,T)=>{if(y)d(y);else if(T){const M={};for(const{stack:D,id:v,glyph:C}of T)M[D]===void 0&&(M[D]={}),M[D].glyphs===void 0&&(M[D].glyphs={}),M[D].glyphs[v]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics},M[D].ascender=this.entries[D].ascender,M[D].descender=this.entries[D].descender;d(null,M)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==aS.none&&(this.localGlyphMode===aS.all?!!this.localFontFamily:!!this.localFontFamily&&($t["CJK Unified Ideographs"](n)||$t["Hangul Syllables"](n)||$t.Hiragana(n)||$t.Katakana(n)||$t["CJK Symbols and Punctuation"](n)||$t["CJK Unified Ideographs Extension A"](n)||$t["CJK Unified Ideographs Extension B"](n)))}_tinySDF(n,a,d){const g=this.localFontFamily;if(!g||!this._doesCharSupportLocalGlyph(d))return;let h=n.tinySDF;if(!h){let N="400";/bold/i.test(a)?N="900":/medium/i.test(a)?N="500":/light/i.test(a)&&(N="200"),h=n.tinySDF=new tp.TinySDF({fontFamily:g,fontWeight:N,fontSize:24*wa,buffer:3*wa,radius:8*wa}),h.fontWeight=N}if(this.localGlyphs[h.fontWeight][d])return this.localGlyphs[h.fontWeight][d];const y=String.fromCodePoint(d),{data:T,width:M,height:D,glyphWidth:v,glyphHeight:C,glyphLeft:I,glyphTop:P,glyphAdvance:A}=h.draw(y);return this.localGlyphs[h.fontWeight][d]={id:d,bitmap:new cu({width:M,height:D},T),metrics:{width:v/wa,height:C/wa,left:I/wa,top:P/wa-27,advance:A/wa,localGlyph:!0}}}}tp.loadGlyphRange=function(c,n,a,d,g){const h=256*n,y=h+255,T=d.transformRequest(d.normalizeGlyphsURL(a).replace("{fontstack}",c).replace("{range}",`${h}-${y}`),Ec.Glyphs);Cc(T,(M,D)=>{if(M)g(M);else if(D){const v={},C=function(I){return new w0(I).readFields(QU,{})}(D);for(const I of C.glyphs)v[I.id]=I;g(null,{glyphs:v,ascender:C.ascender,descender:C.descender})}})},tp.TinySDF=class{constructor({fontSize:c=24,buffer:n=3,radius:a=8,cutoff:d=.25,fontFamily:g="sans-serif",fontWeight:h="normal",fontStyle:y="normal"}={}){this.buffer=n,this.cutoff=d,this.radius=a;const T=this.size=c+4*n,M=this._createCanvas(T),D=this.ctx=M.getContext("2d",{willReadFrequently:!0});D.font=`${y} ${h} ${c}px ${g}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(c){const n=document.createElement("canvas");return n.width=n.height=c,n}draw(c){const{width:n,actualBoundingBoxAscent:a,actualBoundingBoxDescent:d,actualBoundingBoxLeft:g,actualBoundingBoxRight:h}=this.ctx.measureText(c),y=Math.ceil(a),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-g))),M=Math.min(this.size-this.buffer,y+Math.ceil(d)),D=T+2*this.buffer,v=M+2*this.buffer,C=Math.max(D*v,0),I=new Uint8ClampedArray(C),P={data:I,width:D,height:v,glyphWidth:T,glyphHeight:M,glyphTop:y,glyphLeft:0,glyphAdvance:n};if(T===0||M===0)return P;const{ctx:A,buffer:N,gridInner:j,gridOuter:V}=this;A.clearRect(N,N,T,M),A.fillText(c,N,N+y);const X=A.getImageData(N,N,T,M);V.fill(Hg,0,C),j.fill(0,0,C);for(let K=0;K<M;K++)for(let $=0;$<T;$++){const ne=X.data[4*(K*T+$)+3]/255;if(ne===0)continue;const ie=(K+N)*D+$+N;if(ne===1)V[ie]=0,j[ie]=Hg;else{const ue=.5-ne;V[ie]=ue>0?ue*ue:0,j[ie]=ue<0?ue*ue:0}}ED(V,0,0,D,v,D,this.f,this.v,this.z),ED(j,N,N,T,M,D,this.f,this.v,this.z);for(let K=0;K<C;K++){const $=Math.sqrt(V[K])-Math.sqrt(j[K]);I[K]=Math.round(255-255*($/this.radius+this.cutoff))}return P}};const du=Wg;function PD(c,n,a,d){const g=[],h=c.imagePrimary,y=h.pixelRatio,T=h.paddedRect.w-2*du,M=h.paddedRect.h-2*du,D=c.right-c.left,v=c.bottom-c.top,C=h.stretchX||[[0,T]],I=h.stretchY||[[0,M]],P=(Se,_e)=>Se+_e[1]-_e[0],A=C.reduce(P,0),N=I.reduce(P,0),j=T-A,V=M-N;let X=0,K=A,$=0,ne=N,ie=0,ue=j,pe=0,ge=V;if(h.content&&d){const Se=h.content;X=T0(C,0,Se[0]),$=T0(I,0,Se[1]),K=T0(C,Se[0],Se[2]),ne=T0(I,Se[1],Se[3]),ie=Se[0]-X,pe=Se[1]-$,ue=Se[2]-Se[0]-K,ge=Se[3]-Se[1]-ne}const he=(Se,_e,Ce,Le)=>{const je=E0(Se.stretch-X,K,D,c.left),ze=C0(Se.fixed-ie,ue,Se.stretch,A),Fe=E0(_e.stretch-$,ne,v,c.top),Ze=C0(_e.fixed-pe,ge,_e.stretch,N),Ve=E0(Ce.stretch-X,K,D,c.left),rt=C0(Ce.fixed-ie,ue,Ce.stretch,A),ct=E0(Le.stretch-$,ne,v,c.top),Je=C0(Le.fixed-pe,ge,Le.stretch,N),Dt=new Tt(je,Fe),Pt=new Tt(Ve,Fe),xt=new Tt(Ve,ct),ht=new Tt(je,ct),Ht=new Tt(ze/y,Ze/y),At=new Tt(rt/y,Je/y),Lt=n*Math.PI/180;if(Lt){const Tn=Math.sin(Lt),cr=Math.cos(Lt),Jn=[cr,-Tn,Tn,cr];Dt._matMult(Jn),Pt._matMult(Jn),ht._matMult(Jn),xt._matMult(Jn)}const nn=Se.stretch+Se.fixed,xn=Ce.stretch+Ce.fixed,fn=_e.stretch+_e.fixed,pn=Le.stretch+Le.fixed,Sn=c.imageSecondary;return{tl:Dt,tr:Pt,bl:ht,br:xt,texPrimary:{x:h.paddedRect.x+du+nn,y:h.paddedRect.y+du+fn,w:xn-nn,h:pn-fn},texSecondary:Sn?{x:Sn.paddedRect.x+du+nn,y:Sn.paddedRect.y+du+fn,w:xn-nn,h:pn-fn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ht,pixelOffsetBR:At,minFontScaleX:ue/y/D,minFontScaleY:ge/y/v,isSDF:a}};if(d&&(h.stretchX||h.stretchY)){const Se=MD(C,j,A),_e=MD(I,V,N);for(let Ce=0;Ce<Se.length-1;Ce++){const Le=Se[Ce],je=Se[Ce+1];for(let ze=0;ze<_e.length-1;ze++)g.push(he(Le,_e[ze],je,_e[ze+1]))}}else g.push(he({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:M+1}));return g}function T0(c,n,a){let d=0;for(const g of c)d+=Math.max(n,Math.min(a,g[1]))-Math.max(n,Math.min(a,g[0]));return d}function MD(c,n,a){const d=[{fixed:-du,stretch:0}];for(const[g,h]of c){const y=d[d.length-1];d.push({fixed:g-y.stretch,stretch:y.stretch}),d.push({fixed:g-y.stretch,stretch:y.stretch+(h-g)})}return d.push({fixed:n+du,stretch:a}),d}function E0(c,n,a,d){return c/n*a+d}function C0(c,n,a,d){return c-n*a/d}function a3(c,n,a,d){const g=n+c.positionedLines[d].lineOffset;return d===0?a+g/2:a+(g+(n+c.positionedLines[d-1].lineOffset))/2}function l3(c,n=1,a=!1){let d=1/0,g=1/0,h=-1/0,y=-1/0;const T=c[0];for(let P=0;P<T.length;P++){const A=T[P];(!P||A.x<d)&&(d=A.x),(!P||A.y<g)&&(g=A.y),(!P||A.x>h)&&(h=A.x),(!P||A.y>y)&&(y=A.y)}const M=Math.min(h-d,y-g);let D=M/2;const v=new jm([],c3);if(M===0)return new Tt(d,g);for(let P=d;P<h;P+=M)for(let A=g;A<y;A+=M)v.push(new np(P+D,A+D,D,c));let C=function(P){let A=0,N=0,j=0;const V=P[0];for(let X=0,K=V.length,$=K-1;X<K;$=X++){const ne=V[X],ie=V[$],ue=ne.x*ie.y-ie.x*ne.y;N+=(ne.x+ie.x)*ue,j+=(ne.y+ie.y)*ue,A+=3*ue}return new np(N/A,j/A,0,P)}(c),I=v.length;for(;v.length;){const P=v.pop();(P.d>C.d||!C.d)&&(C=P,a&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,I)),P.max-C.d<=n||(D=P.h/2,v.push(new np(P.p.x-D,P.p.y-D,D,c)),v.push(new np(P.p.x+D,P.p.y-D,D,c)),v.push(new np(P.p.x-D,P.p.y+D,D,c)),v.push(new np(P.p.x+D,P.p.y+D,D,c)),I+=4)}return a&&(console.log(`num probes: ${I}`),console.log(`best distance: ${C.d}`)),C.p}function c3(c,n){return n.max-c.max}class np{constructor(n,a,d,g){this.p=new Tt(n,a),this.h=d,this.d=function(h,y){let T=!1,M=1/0;for(let D=0;D<y.length;D++){const v=y[D];for(let C=0,I=v.length,P=I-1;C<I;P=C++){const A=v[C],N=v[P];A.y>h.y!=N.y>h.y&&h.x<(N.x-A.x)*(h.y-A.y)/(N.y-A.y)+A.x&&(T=!T),M=Math.min(M,nr(h,A,N))}}return(T?1:-1)*Math.sqrt(M)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}}const lS=Number.POSITIVE_INFINITY,u3=Math.sqrt(2);function AD(c,[n,a]){let d=0,g=0;if(a===lS){n<0&&(n=0);const h=n/u3;switch(c){case"top-right":case"top-left":g=h-7;break;case"bottom-right":case"bottom-left":g=7-h;break;case"bottom":g=7-n;break;case"top":g=n-7}switch(c){case"top-right":case"bottom-right":d=-h;break;case"top-left":case"bottom-left":d=h;break;case"left":d=n;break;case"right":d=-n}}else{switch(n=Math.abs(n),a=Math.abs(a),c){case"top-right":case"top-left":case"top":g=a-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-a}switch(c){case"top-right":case"bottom-right":case"right":d=-n;break;case"top-left":case"bottom-left":case"left":d=n}}return[d,g]}function cS(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function d3(c,n,a,d,g,h,y,T,M,D,v,C,I,P,A){let N=h.textMaxSize.evaluate(n,{},C);N===void 0&&(N=y);const j=c.layers[0].layout,V=j.get("icon-offset").evaluate(n,{},C),X=DD(a.horizontal)||a.vertical,K=I.name==="globe",$=Li,ne=y/$,ie=c.tilePixelRatio*N/$,ue=(je=c.overscaling,c.zoom>18&&je>2&&(je>>=1),Math.max(Mt/(512*je),1)*j.get("symbol-spacing")),pe=j.get("text-padding")*c.tilePixelRatio,ge=j.get("icon-padding")*c.tilePixelRatio,he=wn(j.get("text-max-angle")),Se=j.get("text-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",_e=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",Ce=j.get("symbol-placement"),Le=ue/2;var je;const ze=j.get("icon-text-fit").evaluate(n,{},C),Fe=j.get("icon-text-fit-padding").evaluate(n,{},C),Ze=ze!=="none";let Ve;c.hasAnyIconTextFit===!1&&Ze&&(c.hasAnyIconTextFit=!0),d&&Ze&&(c.allowVerticalPlacement&&a.vertical&&(Ve=gD(d,a.vertical,ze,Fe,V,ne)),X&&(d=gD(d,X,ze,Fe,V,ne)));const rt=(ct,Je,Dt)=>{if(Je.x<0||Je.x>=Mt||Je.y<0||Je.y>=Mt)return;let Pt=null;if(K){const{x:xt,y:ht,z:Ht}=I.projectTilePoint(Je.x,Je.y,Dt);Pt={anchor:new $l(xt,ht,Ht,0,void 0),up:I.upVector(Dt,Je.x,Je.y)}}(function(xt,ht,Ht,At,Lt,nn,xn,fn,pn,Sn,Tn,cr,Jn,sn,$n,Wn,_r,jr,qr,zr,Mr,wi,ti,Oi,mr,Rs,Ca){const Wo=xt.addToLineVertexArray(ht,At);let Ho,rh,gu,ih,uy,JR,QR,ek=0,tk=0,nk=0,rk=0,zS=-1,FS=-1;const al={};let ik=ls("");const sh=Ht?Ht.anchor:ht,BS=pn.layout.get("icon-text-fit").evaluate(Mr,{},mr)!=="none";let VS=0,US=0;if(pn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[VS,US]=pn.layout.get("text-offset").evaluate(Mr,{},mr).map(Ws=>Ws*Li):(VS=pn.layout.get("text-radial-offset").evaluate(Mr,{},mr)*Li,US=lS),xt.allowVerticalPlacement&&Lt.vertical){const Ws=Lt.vertical;if($n)JR=uS(Ws),fn&&(QR=uS(fn));else{const Hs=pn.layout.get("text-rotate").evaluate(Mr,{},mr)+90;gu=P0(Sn,sh,ht,Tn,cr,Jn,Ws,sn,Hs,Wn),fn&&(ih=P0(Sn,sh,ht,Tn,cr,Jn,fn,jr,Hs))}}if(nn){const Ws=pn.layout.get("icon-rotate").evaluate(Mr,{},mr),Hs=PD(nn,Ws,ti,BS),up=fn?PD(fn,Ws,ti,BS):void 0;rh=P0(Sn,sh,ht,Tn,cr,Jn,nn,jr,Ws),ek=4*Hs.length;const sk=xt.iconSizeData;let oh=null;sk.kind==="source"?(oh=[ba*pn.layout.get("icon-size").evaluate(Mr,{},mr)],oh[0]>hu&&zn(`${xt.layerIds[0]}: Value for "icon-size" is >= ${qg}. Reduce your "icon-size".`)):sk.kind==="composite"&&(oh=[ba*wi.compositeIconSizes[0].evaluate(Mr,{},mr),ba*wi.compositeIconSizes[1].evaluate(Mr,{},mr)],(oh[0]>hu||oh[1]>hu)&&zn(`${xt.layerIds[0]}: Value for "icon-size" is >= ${qg}. Reduce your "icon-size".`)),xt.addSymbols(xt.icon,Hs,oh,zr,qr,Mr,!1,Ht,ht,Wo.lineStartIndex,Wo.lineLength,-1,Oi,mr,Rs,Ca),zS=xt.icon.placedSymbolArray.length-1,up&&(tk=4*up.length,xt.addSymbols(xt.icon,up,oh,zr,qr,Mr,mo.vertical,Ht,ht,Wo.lineStartIndex,Wo.lineLength,-1,Oi,mr,Rs,Ca),FS=xt.icon.placedSymbolArray.length-1)}for(const Ws in Lt.horizontal){const Hs=Lt.horizontal[Ws];Ho||(ik=ls(Hs.text),$n?uy=uS(Hs):Ho=P0(Sn,sh,ht,Tn,cr,Jn,Hs,sn,pn.layout.get("text-rotate").evaluate(Mr,{},mr),Wn));const up=Hs.positionedLines.length===1;if(nk+=ID(xt,Ht,ht,Hs,xn,pn,$n,Mr,Wn,Wo,Lt.vertical?mo.horizontal:mo.horizontalOnly,up?Object.keys(Lt.horizontal):[Ws],al,zS,wi,Oi,mr,Rs),up)break}Lt.vertical&&(rk+=ID(xt,Ht,ht,Lt.vertical,xn,pn,$n,Mr,Wn,Wo,mo.vertical,["vertical"],al,FS,wi,Oi,mr,Rs));let yu=-1;const $S=(Ws,Hs)=>Ws?Math.max(Ws,Hs):Hs;yu=$S(uy,yu),yu=$S(JR,yu),yu=$S(QR,yu);const C$=yu>-1?1:0;xt.glyphOffsetArray.length>=65535&&zn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Mr.sortKey!==void 0&&xt.addToSortKeyRanges(xt.symbolInstances.length,Mr.sortKey),xt.symbolInstances.emplaceBack(ht.x,ht.y,sh.x,sh.y,sh.z,al.right>=0?al.right:-1,al.center>=0?al.center:-1,al.left>=0?al.left:-1,al.vertical>=0?al.vertical:-1,zS,FS,ik,Ho!==void 0?Ho:xt.collisionBoxArray.length,Ho!==void 0?Ho+1:xt.collisionBoxArray.length,gu!==void 0?gu:xt.collisionBoxArray.length,gu!==void 0?gu+1:xt.collisionBoxArray.length,rh!==void 0?rh:xt.collisionBoxArray.length,rh!==void 0?rh+1:xt.collisionBoxArray.length,ih||xt.collisionBoxArray.length,ih?ih+1:xt.collisionBoxArray.length,Tn,nk,rk,ek,tk,C$,0,VS,US,yu,0,BS?1:0)})(c,Je,Pt,ct,a,d,g,Ve,c.layers[0],c.collisionBoxArray,n.index,n.sourceLayerIndex,c.index,pe,Se,M,0,ge,_e,V,n,h,D,v,C,P,A)};if(Ce==="line")for(const ct of wD(n.geometry,0,0,Mt,Mt)){const Je=o3(ct,ue,he,a.vertical||X,d,$,ie,c.overscaling,Mt);for(const Dt of Je)X&&h3(c,X.text,Le,Dt)||rt(ct,Dt,C)}else if(Ce==="line-center"){for(const ct of n.geometry)if(ct.length>1){const Je=s3(ct,he,a.vertical||X,d,$,ie);Je&&rt(ct,Je,C)}}else if(n.type==="Polygon")for(const ct of p0(n.geometry,0)){const Je=l3(ct,16);rt(ct[0],new $l(Je.x,Je.y,0,0,void 0),C)}else if(n.type==="LineString")for(const ct of n.geometry)rt(ct,new $l(ct[0].x,ct[0].y,0,0,void 0),C);else if(n.type==="Point")for(const ct of n.geometry)for(const Je of ct)rt([Je],new $l(Je.x,Je.y,0,0,void 0),C)}const qg=255,hu=qg*ba;function ID(c,n,a,d,g,h,y,T,M,D,v,C,I,P,A,N,j,V){const X=function(ne,ie,ue,pe,ge,he,Se,_e){const Ce=[];if(ie.positionedLines.length===0)return Ce;const Le=pe.layout.get("text-rotate").evaluate(he,{})*Math.PI/180,je=function(rt){const ct=rt[0],Je=rt[1],Dt=ct*Je;return Dt>0?[ct,-Je]:Dt<0?[-ct,Je]:ct===0?[Je,ct]:[Je,-ct]}(ue);let ze=Math.abs(ie.top-ie.bottom);for(const rt of ie.positionedLines)ze-=rt.lineOffset;const Fe=ie.positionedLines.length,Ze=ze/Fe;let Ve=ie.top-ue[1];for(let rt=0;rt<Fe;++rt){const ct=ie.positionedLines[rt];Ve=a3(ie,Ze,Ve,rt);for(const Je of ct.positionedGlyphs){if(!Je.rect)continue;const Dt=Je.rect||{};let Pt=uD+1,xt=!0,ht=1,Ht=0;if(Je.imageName){const zr=Se[Je.imageName];if(!zr)continue;if(zr.sdf){zn("SDF images are not supported in formatted text and will be ignored.");continue}xt=!1,ht=zr.pixelRatio,Pt=Wg/ht}const At=(ge||_e)&&Je.vertical,Lt=Je.metrics.advance*Je.scale/2,nn=Je.metrics,xn=Je.rect;if(xn===null)continue;_e&&ie.verticalizable&&(Ht=Je.imageName?Lt-Je.metrics.width*Je.scale/2:0);const fn=ge?[Je.x+Lt,Je.y]:[0,0];let pn=[0,0],Sn=[0,0],Tn=!1;ge||(At?(Sn=[Je.x+Lt+je[0],Je.y+je[1]-Ht],Tn=!0):pn=[Je.x+Lt+ue[0],Je.y+ue[1]-Ht]);const cr=xn.w*Je.scale/(ht*(Je.localGlyph?wa:1)),Jn=xn.h*Je.scale/(ht*(Je.localGlyph?wa:1));let sn,$n,Wn,_r;if(At){const zr=Je.y-Ve,Mr=new Tt(-Lt,Lt-zr),wi=-Math.PI/2,ti=new Tt(...Sn);sn=new Tt(-Lt+pn[0],pn[1]),sn._rotateAround(wi,Mr)._add(ti),sn.x+=-zr+Lt,sn.y-=(nn.left-Pt)*Je.scale;const Oi=Je.imageName?nn.advance*Je.scale:Li*Je.scale,mr=String.fromCodePoint(Je.glyph);YU(mr)?sn.x+=(1-Pt)*Je.scale:KU(mr)?sn.x+=Oi-nn.height*Je.scale+(-Pt-1)*Je.scale:sn.x+=Je.imageName||nn.width+2*Pt===xn.w&&nn.height+2*Pt===xn.h?(Oi-Jn)/2:(Oi-(nn.height+2*Pt)*Je.scale)/2,$n=new Tt(sn.x,sn.y-cr),Wn=new Tt(sn.x+Jn,sn.y),_r=new Tt(sn.x+Jn,sn.y-cr)}else{const zr=(nn.left-Pt)*Je.scale-Lt+pn[0],Mr=(-nn.top-Pt)*Je.scale+pn[1],wi=zr+cr,ti=Mr+Jn;sn=new Tt(zr,Mr),$n=new Tt(wi,Mr),Wn=new Tt(zr,ti),_r=new Tt(wi,ti)}if(Le){let zr;zr=ge?new Tt(0,0):Tn?new Tt(je[0],je[1]):new Tt(ue[0],ue[1]),sn._rotateAround(Le,zr),$n._rotateAround(Le,zr),Wn._rotateAround(Le,zr),_r._rotateAround(Le,zr)}const jr=new Tt(0,0),qr=new Tt(0,0);Ce.push({tl:sn,tr:$n,bl:Wn,br:_r,texPrimary:Dt,texSecondary:void 0,writingMode:ie.writingMode,glyphOffset:fn,sectionIndex:Je.sectionIndex,isSDF:xt,pixelOffsetTL:jr,pixelOffsetBR:qr,minFontScaleX:0,minFontScaleY:0})}}return Ce}(0,d,M,h,y,T,g,c.allowVerticalPlacement),K=c.textSizeData;let $=null;K.kind==="source"?($=[ba*h.layout.get("text-size").evaluate(T,{},j)],$[0]>hu&&zn(`${c.layerIds[0]}: Value for "text-size" is >= ${qg}. Reduce your "text-size".`)):K.kind==="composite"&&($=[ba*A.compositeTextSizes[0].evaluate(T,{},j),ba*A.compositeTextSizes[1].evaluate(T,{},j)],($[0]>hu||$[1]>hu)&&zn(`${c.layerIds[0]}: Value for "text-size" is >= ${qg}. Reduce your "text-size".`)),c.addSymbols(c.text,X,$,M,y,T,v,n,a,D.lineStartIndex,D.lineLength,P,N,j,V,!1);for(const ne of C)I[ne]=c.text.placedSymbolArray.length-1;return 4*X.length}function DD(c){for(const n in c)return c[n];return null}function P0(c,n,a,d,g,h,y,T,M,D){let v=y.top,C=y.bottom,I=y.left,P=y.right;const A=y.collisionPadding;if(A&&(I-=A[0],v-=A[1],P+=A[2],C+=A[3]),M){const N=new Tt(I,v),j=new Tt(P,v),V=new Tt(I,C),X=new Tt(P,C),K=wn(M);let $=new Tt(0,0);D&&($=new Tt(D[0],D[1])),N._rotateAround(K,$),j._rotateAround(K,$),V._rotateAround(K,$),X._rotateAround(K,$),I=Math.min(N.x,j.x,V.x,X.x),P=Math.max(N.x,j.x,V.x,X.x),v=Math.min(N.y,j.y,V.y,X.y),C=Math.max(N.y,j.y,V.y,X.y)}return c.emplaceBack(n.x,n.y,n.z,a.x,a.y,I,v,P,C,T,d,g,h),c.length-1}function uS(c){c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const n=c.bottom-c.top;return n>0?Math.max(10,n):null}function h3(c,n,a,d){const g=c.compareText;if(n in g){const h=g[n];for(let y=h.length-1;y>=0;y--)if(d.dist(h[y])<a)return!0}else g[n]=[];return g[n].push(d),!1}function RD(c,n){const a=c.fovAboveCenter,d=c.elevation?c.elevation.getMinElevationBelowMSL()*n:0,g=(c._camera.position[2]*c.worldSize-d)/Math.cos(c._pitch),h=Math.sin(a)*g/Math.sin(Math.max(Math.PI/2-c._pitch-a,.01));let y=Math.sin(c._pitch)*h+g;const T=g*(1/c._horizonShift);return c.elevation&&c.elevation.exaggeration()!==0||(y*=1+Math.max(c.zoom-17,0)),Math.min(1.01*y,T)}function Zg(c,n){if(!n.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:n};const a=Math.pow(2,-c.z),d=c.x*a,g=(c.x+1)*a,h=c.y*a,y=(c.y+1)*a,T=be(d),M=be(g),D=ve(h),v=ve(y),C=n.project(T,D),I=n.project(M,D),P=n.project(M,v),A=n.project(T,v);let N=Math.min(C.x,I.x,P.x,A.x),j=Math.min(C.y,I.y,P.y,A.y),V=Math.max(C.x,I.x,P.x,A.x),X=Math.max(C.y,I.y,P.y,A.y);const K=a/16;function $(ie,ue,pe,ge,he,Se){const _e=(pe+he)/2,Ce=(ge+Se)/2,Le=n.project(be(_e),ve(Ce)),je=Math.max(0,N-Le.x,j-Le.y,Le.x-V,Le.y-X);N=Math.min(N,Le.x),V=Math.max(V,Le.x),j=Math.min(j,Le.y),X=Math.max(X,Le.y),je>K&&($(ie,Le,pe,ge,_e,Ce),$(Le,ue,_e,Ce,he,Se))}$(C,I,d,h,g,h),$(I,P,g,h,g,y),$(P,A,g,y,d,y),$(A,C,d,y,d,h),N-=K,j-=K,V+=K,X+=K;const ne=1/Math.max(V-N,X-j);return{scale:ne,x:N*ne,y:j*ne,x2:V*ne,y2:X*ne,projection:n}}function kD(c,{x:n,y:a},d=0){return new Tt(((n-d)*c.scale-c.x)*Mt,(a*c.scale-c.y)*Mt)}const f3=Ie.mat4.identity(new Float32Array(16));class fu{constructor(n){this.spec=n,this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,a){return{x:0,y:0,z:0}}unproject(n,a){return new Y(0,0)}projectTilePoint(n,a,d){return{x:n,y:a,z:0}}locationPoint(n,a,d=!0){return n._coordinatePoint(n.locationCoordinate(a),d)}pixelsPerMeter(n,a){return fe(1,n)*a}pixelSpaceConversion(n,a,d){return 1}farthestPixelDistance(n){return RD(n,n.pixelsPerMeter)}pointCoordinate(n,a,d,g){const h=n.horizonLineFromTop(!1),y=new Tt(a,Math.max(h,d));return n.rayIntersectionCoordinate(n.pointRayIntersection(y,g))}pointCoordinate3D(n,a,d){const g=new Tt(a,d);if(n.elevation)return n.elevation.pointCoordinate(g);{const h=this.pointCoordinate(n,g.x,g.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(n,a){if(n.elevation&&n.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(n,a.x,a.y);const d=n.horizonLineFromTop();return a.y<d}createInversionMatrix(n,a){return f3}createTileMatrix(n,a,d){let g,h,y;const T=d.canonical,M=Ie.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const D=Zg(T,this);g=1,h=D.x+d.wrap*D.scale,y=D.y,Ie.mat4.scale(M,M,[g/D.scale,g/D.scale,n.pixelsPerMeter/a])}else g=a/n.zoomScale(T.z),h=(T.x+Math.pow(2,T.z)*d.wrap)*g,y=T.y*g;return Ie.mat4.translate(M,M,[h,y,0]),Ie.mat4.scale(M,M,[g/Mt,g/Mt,1]),M}upVector(n,a,d){return[0,0,1]}upVectorScale(n,a,d){return{metersToTile:1}}}class p3 extends fu{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];const[a,d]=this.parallels=n.parallels||[29.5,45.5],g=Math.sin(wn(a));this.n=(g+Math.sin(wn(d)))/2,this.c=1+g*(2*this.n-g),this.r0=Math.sqrt(this.c)/this.n}project(n,a){const{n:d,c:g,r0:h}=this,y=wn(n-this.center[0]),T=wn(a),M=Math.sqrt(g-2*d*Math.sin(T))/d;return{x:M*Math.sin(y*d),y:M*Math.cos(y*d)-h,z:0}}unproject(n,a){const{n:d,c:g,r0:h}=this,y=h+a;let T=Math.atan2(n,Math.abs(y))*Math.sign(y);y*d<0&&(T-=Math.PI*Math.sign(n)*Math.sign(y));const M=wn(this.center[0])*d;T=ua(T,-Math.PI-M,Math.PI-M);const D=mn(vi(T/d)+this.center[0],-180,180),v=Math.asin(mn((g-(n*n+y*y)*d*d)/(2*d),-1,1)),C=mn(vi(v),-Te,Te);return new Y(D,C)}}const Xg=1.340264,Yg=-.081106,Kg=893e-6,Jg=.003796,M0=Math.sqrt(3)/2;class m3 extends fu{project(n,a){a=a/180*Math.PI,n=n/180*Math.PI;const d=Math.asin(M0*Math.sin(a)),g=d*d,h=g*g*g;return{x:.5*(n*Math.cos(d)/(M0*(Xg+3*Yg*g+h*(7*Kg+9*Jg*g)))/Math.PI+.5),y:1-.5*(d*(Xg+Yg*g+h*(Kg+Jg*g))/Math.PI+1),z:0}}unproject(n,a){n=(2*n-.5)*Math.PI;let d=a=(2*(1-a)-1)*Math.PI,g=d*d,h=g*g*g;for(let v,C,I,P=0;P<12&&(C=d*(Xg+Yg*g+h*(Kg+Jg*g))-a,I=Xg+3*Yg*g+h*(7*Kg+9*Jg*g),v=C/I,d=mn(d-v,-Math.PI/3,Math.PI/3),g=d*d,h=g*g*g,!(Math.abs(v)<1e-12));++P);const y=M0*n*(Xg+3*Yg*g+h*(7*Kg+9*Jg*g))/Math.cos(d),T=Math.asin(Math.sin(d)/M0),M=mn(180*y/Math.PI,-180,180),D=mn(180*T/Math.PI,-Te,Te);return new Y(M,D)}}class g3 extends fu{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,a){return{x:.5+n/360,y:.5-a/360,z:0}}unproject(n,a){const d=360*(n-.5),g=mn(360*(.5-a),-Te,Te);return new Y(d,g)}}const rp=Math.PI/2;function A0(c){return Math.tan((rp+c)/2)}class y3 extends fu{constructor(n){super(n),this.center=n.center||[0,30];const[a,d]=this.parallels=n.parallels||[30,30];let g=wn(a),h=wn(d);this.southernCenter=g+h<0,this.southernCenter&&(g=-g,h=-h);const y=Math.cos(g),T=A0(g);this.n=g===h?Math.sin(g):Math.log(y/Math.cos(h))/Math.log(A0(h)/T),this.f=y*Math.pow(A0(g),this.n)/this.n}project(n,a){a=wn(a),this.southernCenter&&(a=-a),n=wn(n-this.center[0]);const d=1e-6,{n:g,f:h}=this;h>0?a<-rp+d&&(a=-rp+d):a>rp-d&&(a=rp-d);const y=h/Math.pow(A0(a),g);let T=y*Math.sin(g*n),M=h-y*Math.cos(g*n);return T=.5*(T/Math.PI+.5),M=.5*(M/Math.PI+.5),{x:T,y:this.southernCenter?M:1-M,z:0}}unproject(n,a){n=(2*n-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:d,f:g}=this,h=g-a,y=Math.sign(h),T=Math.sign(d)*Math.sqrt(n*n+h*h);let M=Math.atan2(n,Math.abs(h))*y;h*d<0&&(M-=Math.PI*Math.sign(n)*y);const D=mn(vi(M/d)+this.center[0],-180,180),v=mn(vi(2*Math.atan(Math.pow(g/T,1/d))-rp),-Te,Te);return new Y(D,this.southernCenter?-v:v)}}class ND extends fu{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,a){return{x:me(n),y:ye(a),z:0}}unproject(n,a){const d=be(n),g=ve(a);return new Y(d,g)}}const LD=wn(Te);class _3 extends fu{project(n,a){const d=(a=wn(a))*a,g=d*d;return{x:.5*((n=wn(n))*(.8707-.131979*d+g*(g*(.003971*d-.001529*g)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+d*(.015085+g*(.028874*d-.044475-.005916*g)))/Math.PI+1),z:0}}unproject(n,a){n=(2*n-.5)*Math.PI;let d=a=(2*(1-a)-1)*Math.PI,g=25,h=0,y=d*d;do{y=d*d;const D=y*y;h=(d*(1.007226+y*(.015085+D*(.028874*y-.044475-.005916*D)))-a)/(1.007226+y*(.045255+D*(.259866*y-.311325-.005916*11*D))),d=mn(d-h,-LD,LD)}while(Math.abs(h)>1e-6&&--g>0);y=d*d;const T=mn(vi(n/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),M=vi(d);return new Y(T,M)}}const OD=wn(Te);class x3 extends fu{project(n,a){a=wn(a),n=wn(n);const d=Math.cos(a),g=2/Math.PI,h=Math.acos(d*Math.cos(n/2)),y=Math.sin(h)/h,T=.5*(n*g+2*d*Math.sin(n/2)/y)||0,M=.5*(a+Math.sin(a)/y)||0;return{x:.5*(T/Math.PI+.5),y:1-.5*(M/Math.PI+1),z:0}}unproject(n,a){let d=n=(2*n-.5)*Math.PI,g=a=(2*(1-a)-1)*Math.PI,h=25;const y=1e-6;let T=0,M=0;do{const D=Math.cos(g),v=Math.sin(g),C=2*v*D,I=v*v,P=D*D,A=Math.cos(d/2),N=Math.sin(d/2),j=2*A*N,V=N*N,X=1-P*A*A,K=X?1/X:0,$=X?Math.acos(D*A)*Math.sqrt(1/X):0,ne=.5*(2*$*D*N+2*d/Math.PI)-n,ie=.5*($*v+g)-a,ue=.5*K*(P*V+$*D*A*I)+1/Math.PI,pe=K*(j*C/4-$*v*N),ge=.125*K*(C*N-$*v*P*j),he=.5*K*(I*A+$*V*D)+.5,Se=pe*ge-he*ue;T=(ie*pe-ne*he)/Se,M=(ne*ge-ie*ue)/Se,d=mn(d-T,-Math.PI,Math.PI),g=mn(g-M,-OD,OD)}while((Math.abs(T)>y||Math.abs(M)>y)&&--h>0);return new Y(vi(d),vi(g))}}class jD extends fu{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(wn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,a){const{scale:d,cosPhi:g}=this;return{x:wn(n)*g*d+.5,y:-Math.sin(wn(a))/g*d+.5,z:0}}unproject(n,a){const{scale:d,cosPhi:g}=this,h=-(a-.5)/d,y=mn(vi((n-.5)/d)/g,-180,180),T=Math.asin(mn(h*g,-1,1)),M=mn(vi(T),-Te,Te);return new Y(y,M)}}class v3 extends ND{constructor(n){super(n),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(n,a,d){const g=Rg(n,a,d),h=u0(sl(d));return Ie.vec3.transformMat4(g,g,h),{x:g[0],y:g[1],z:g[2]}}locationPoint(n,a){const d=B(a.lat,a.lng),g=Ie.vec3.normalize([],d),h=n.elevation?n.elevation.getAtPointOrZero(n.locationCoordinate(a),n._centerAltitude):n._centerAltitude,y=fe(1,0)*Mt*h;Ie.vec3.scaleAndAdd(d,d,g,y);const T=Ie.mat4.identity(new Float64Array(16));return Ie.mat4.multiply(T,n.pixelMatrix,n.globeMatrix),Ie.vec3.transformMat4(d,d,T),new Tt(d[0],d[1])}pixelsPerMeter(n,a){return fe(1,0)*a}pixelSpaceConversion(n,a,d){const g=fe(1,n)*a,h=Xt(fe(1,45)*a,g,d);return this.pixelsPerMeter(n,a)/h}createTileMatrix(n,a,d){const g=Nw(sl(d.canonical));return Ie.mat4.multiply(new Float64Array(16),n.globeMatrix,g)}createInversionMatrix(n,a){const{center:d}=n,g=u0(sl(a));return Ie.mat4.rotateY(g,g,wn(d.lng)),Ie.mat4.rotateX(g,g,wn(d.lat)),Ie.mat4.scale(g,g,[n._pixelsPerMercatorPixel,n._pixelsPerMercatorPixel,1]),Float32Array.from(g)}pointCoordinate(n,a,d,g){return a0(n,a,d,!0)||new Ue(0,0)}pointCoordinate3D(n,a,d){const g=this.pointCoordinate(n,a,d,0);return[g.x,g.y,g.z]}isPointAboveHorizon(n,a){return!a0(n,a.x,a.y,!1)}farthestPixelDistance(n){const a=function(g,h){const y=g.cameraToCenterDistance,T=g._centerAltitude*h,M=g._camera,D=g._camera.forward(),v=Ie.vec3.add([],Ie.vec3.scale([],D,-y),[0,0,T]),C=g.worldSize/(2*Math.PI),I=[0,0,-C],P=g.width/g.height,A=Math.tan(g.fovAboveCenter),N=Ie.vec3.scale([],M.up(),A),j=Ie.vec3.scale([],M.right(),A*P),V=Ie.vec3.normalize([],Ie.vec3.add([],Ie.vec3.add([],D,N),j)),X=[];let K;if(new va(v,V).closestPointOnSphere(I,C,X)){const $=Ie.vec3.add([],X,I),ne=Ie.vec3.sub([],$,v);K=Math.cos(g.fovAboveCenter)*Ie.vec3.length(ne)}else{const $=Ie.vec3.sub([],v,I),ne=Ie.vec3.sub([],I,v);Ie.vec3.normalize(ne,ne);const ie=Ie.vec3.length($)-C;K=Math.sqrt(ie*(ie+2*C));const ue=Math.acos(K/(C+ie))-Math.acos(Ie.vec3.dot(D,ne));K*=Math.cos(ue)}return 1.01*K}(n,this.pixelsPerMeter(n.center.lat,n.worldSize)),d=lu(n.zoom);if(d>0){const g=RD(n,fe(1,n.center.lat)*n.worldSize),h=n.worldSize/(2*Math.PI),y=Math.max(n.width,n.height)/n.worldSize*Math.PI;return Xt(a,g+h*(1-Math.cos(y)),Math.pow(d,10))}return a}upVector(n,a,d){return Rg(a,d,n,1)}upVectorScale(n){return{metersToTile:Vl(c0(sl(n)))}}}function zD(c){const n=c.parallels,a=!!n&&Math.abs(n[0]+n[1])<.01;switch(c.name){case"mercator":return new ND(c);case"equirectangular":return new g3(c);case"naturalEarth":return new _3(c);case"equalEarth":return new m3(c);case"winkelTripel":return new x3(c);case"albers":return a?new jD(c):new p3(c);case"lambertConformalConic":return a?new jD(c):new y3(c);case"globe":return new v3(c)}throw new Error(`Invalid projection name: ${c.name}`)}const b3=Jf.VectorTileFeature.types,w3=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function I0(c,n,a,d,g,h,y,T,M,D,v,C,I){const P=T?Math.min(hu,Math.round(T[0])):0,A=T?Math.min(hu,Math.round(T[1])):0;c.emplaceBack(n,a,Math.round(32*d),Math.round(32*g),h,y,(P<<1)+(M?1:0),A,16*D,16*v,256*C,256*I)}function D0(c,n,a){c.emplaceBack(n,a)}function R0(c,n,a,d,g,h,y){c.emplaceBack(n,a,d,g,h,y)}function k0(c,n,a,d,g){c.emplaceBack(n,a,d,g),c.emplaceBack(n,a,d,g),c.emplaceBack(n,a,d,g),c.emplaceBack(n,a,d,g)}function S3(c){for(const n of c.sections)if(gw(n.text))return!0;return!1}class dS{constructor(n){this.layoutVertexArray=new _g,this.indexArray=new Ri,this.programConfigurations=n,this.segments=new Nr,this.dynamicLayoutVertexArray=new ga,this.opacityVertexArray=new vg,this.placedSymbolArray=new Eg,this.iconTransitioningVertexArray=new nl,this.globeExtVertexArray=new xg,this.zOffsetVertexArray=new nu}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(n,a,d,g,h){this.isEmpty()||(d&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,BU.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,UU.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,w3,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=n.createVertexBuffer(this.iconTransitioningVertexArray,GU.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,VU.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||h)&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,$U.members,!0)),this.opacityVertexBuffer.itemSize=1),(d||g)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ot(dS,"SymbolBuffers");class hS{constructor(n,a,d){this.layoutVertexArray=new n,this.layoutAttributes=a,this.indexArray=new d,this.segments=new Nr,this.collisionVertexArray=new tu,this.collisionVertexArrayExt=new ga}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,WU.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,HU.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ot(hS,"CollisionBuffers");class N0{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.lut=n.lut,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(y=>y.fqid),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ie.mat4.identity([]),this.placementViewportMatrix=Ie.mat4.identity([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=eS(this.zoom,a["text-size"]),this.iconSizeData=eS(this.zoom,a["icon-size"]);const d=this.layers[0].layout,g=d.get("symbol-sort-key"),h=d.get("symbol-z-order");this.canOverlap=d.get("text-allow-overlap")||d.get("icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&g.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=d.get("text-writing-mode").map(y=>mo[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=n.sourceID,this.projection=n.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=d.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new dS(new rl(this.layers,{zoom:this.zoom,lut:this.lut},n=>n.startsWith("text")||n.startsWith("symbol"))),this.icon=new dS(new rl(this.layers,{zoom:this.zoom,lut:this.lut},n=>n.startsWith("icon")||n.startsWith("symbol"))),this.glyphOffsetArray=new Jx,this.lineVertexArray=new qf,this.symbolInstances=new Cg}calculateGlyphDependencies(n,a,d,g,h){for(let y=0;y<n.length;y++){const T=n.codePointAt(y);if(T===void 0)break;if(a[T]=!0,g&&h&&T<=65535){const M=$g[n.charAt(y)];M&&(a[M.charCodeAt(0)]=!0)}}}updateFootprints(n,a){}updateReplacement(n,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const d=a.getReplacementRegionsForTile(n.toUnwrapped(),!0);return!Zw(this.activeReplacements,d)&&(this.activeReplacements=d,!0)}populate(n,a,d,g){const h=this.layers[0],y=h.layout,T=this.projection.name==="globe",M=y.get("text-font"),D=y.get("text-field"),v=y.get("icon-image"),C=(D.value.kind!=="constant"||D.value.value instanceof Ui&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&(M.value.kind!=="constant"||M.value.value.length>0),I=v.value.kind!=="constant"||!!v.value.value||Object.keys(v.parameters).length>0,P=y.get("symbol-sort-key");if(this.features=[],!C&&!I)return;const A=a.iconDependencies,N=a.glyphDependencies,j=a.availableImages,V=new kr(this.zoom);for(const{feature:X,id:K,index:$,sourceLayerIndex:ne}of n){const ie=h._featureFilter.needGeometry,ue=vt(X,ie);if(!h._featureFilter.filter(V,ue,d))continue;if(ie||(ue.geometry=_t(X,d,g)),T&&X.type!==1&&d.z<=5){const Se=ue.geometry,_e=.98078528056,Ce=(Le,je)=>{const ze=Rg(Le.x,Le.y,d,1),Fe=Rg(je.x,je.y,d,1);return Ie.vec3.dot(ze,Fe)<_e};for(let Le=0;Le<Se.length;Le++)Se[Le]=gt(Se[Le],Ce)}let pe,ge;if(C){const Se=h.getValueAndResolveTokens("text-field",ue,d,j),_e=Ui.factory(Se);S3(_e)&&(this.hasRTLText=!0),(!this.hasRTLText||hg()==="unavailable"||this.hasRTLText&&hs.isParsed())&&(pe=XU(_e,h,ue))}if(I){const Se=h.getValueAndResolveTokens("icon-image",ue,d,j);ge=Se instanceof Yi?Se:Yi.fromString(Se)}if(!pe&&!ge)continue;const he=this.sortFeaturesByKey?P.evaluate(ue,{},d):void 0;if(this.features.push({id:K,text:pe,icon:ge,index:$,sourceLayerIndex:ne,geometry:ue.geometry,properties:X.properties,type:b3[X.type],sortKey:he}),ge&&(A[ge.namePrimary]=!0,ge.nameSecondary&&(A[ge.nameSecondary]=!0)),pe){const Se=M.evaluate(ue,{},d).join(","),_e=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(mo.vertical)>=0;for(const Ce of pe.sections)if(Ce.image)A[Ce.image.namePrimary]=!0;else{const Le=Df(pe.toString()),je=Ce.fontStack||Se,ze=N[je]=N[je]||{};this.calculateGlyphDependencies(Ce.text,ze,_e,this.allowVerticalPlacement,Le)}}}y.get("symbol-placement")==="line"&&(this.features=function(X){const K={},$={},ne=[];let ie=0;function ue(Se){ne.push(X[Se]),ie++}function pe(Se,_e,Ce){const Le=$[Se];return delete $[Se],$[_e]=Le,ne[Le].geometry[0].pop(),ne[Le].geometry[0]=ne[Le].geometry[0].concat(Ce[0]),Le}function ge(Se,_e,Ce){const Le=K[_e];return delete K[_e],K[Se]=Le,ne[Le].geometry[0].shift(),ne[Le].geometry[0]=Ce[0].concat(ne[Le].geometry[0]),Le}function he(Se,_e,Ce){const Le=Ce?_e[0][_e[0].length-1]:_e[0][0];return`${Se}:${Le.x}:${Le.y}`}for(let Se=0;Se<X.length;Se++){const _e=X[Se],Ce=_e.geometry,Le=_e.text?_e.text.toString():null;if(!Le){ue(Se);continue}const je=he(Le,Ce),ze=he(Le,Ce,!0);if(je in $&&ze in K&&$[je]!==K[ze]){const Fe=ge(je,ze,Ce),Ze=pe(je,ze,ne[Fe].geometry);delete K[je],delete $[ze],$[he(Le,ne[Ze].geometry,!0)]=Ze,ne[Fe].geometry=null}else je in $?pe(je,ze,Ce):ze in K?ge(je,ze,Ce):(ue(Se),K[je]=ie-1,$[ze]=ie-1)}return ne.filter(Se=>Se.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((X,K)=>X.sortKey-K.sortKey)}update(n,a,d,g,h){const y=Object.keys(n).length!==0;if(y&&!this.stateDependentLayers.length)return;const T=y?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(n,a,T,d,g,h),this.icon.programConfigurations.updatePaintArrays(n,a,T,d,g,h)}updateZOffset(){const n=(h,y,T)=>{d+=y,d>h.length&&h.resize(d);for(let M=-y;M<0;M++)h.emplace(M+d,T)},a=(h,y,T)=>{g+=y,g>h.length&&h.resize(g);for(let M=-y;M<0;M++)h.emplace(M+g,T)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let d=0,g=0;for(let h=0;h<this.symbolInstances.length;h++){const y=this.symbolInstances.get(h),{numHorizontalGlyphVertices:T,numVerticalGlyphVertices:M,numIconVertices:D}=y,v=y.zOffset,C=D>0;if((T>0||M>0)&&(n(this.text.zOffsetVertexArray,T,v),n(this.text.zOffsetVertexArray,M,v)),C){const{placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:P}=y;I>=0&&a(this.icon.zOffsetVertexArray,D,v),P>=0&&a(this.icon.zOffsetVertexArray,y.numVerticalIconVertices,v)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=zD(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,a){const d=this.lineVertexArray.length;if(n.segment!==void 0)for(const{x:g,y:h}of a)this.lineVertexArray.emplaceBack(g,h);return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(n,a,d,g,h,y,T,M,D,v,C,I,P,A,N,j){const V=n.indexArray,X=n.layoutVertexArray,K=n.globeExtVertexArray,$=n.segments.prepareSegment(4*a.length,X,V,this.canOverlap?y.sortKey:void 0),ne=this.glyphOffsetArray.length,ie=$.vertexLength,ue=this.allowVerticalPlacement&&T===mo.vertical?Math.PI/2:0,pe=y.text&&y.text.sections;for(let he=0;he<a.length;he++){const{tl:Se,tr:_e,bl:Ce,br:Le,texPrimary:je,texSecondary:ze,pixelOffsetTL:Fe,pixelOffsetBR:Ze,minFontScaleX:Ve,minFontScaleY:rt,glyphOffset:ct,isSDF:Je,sectionIndex:Dt}=a[he],Pt=$.vertexLength,xt=ct[1];if(I0(X,D.x,D.y,Se.x,xt+Se.y,je.x,je.y,d,Je,Fe.x,Fe.y,Ve,rt),I0(X,D.x,D.y,_e.x,xt+_e.y,je.x+je.w,je.y,d,Je,Ze.x,Fe.y,Ve,rt),I0(X,D.x,D.y,Ce.x,xt+Ce.y,je.x,je.y+je.h,d,Je,Fe.x,Ze.y,Ve,rt),I0(X,D.x,D.y,Le.x,xt+Le.y,je.x+je.w,je.y+je.h,d,Je,Ze.x,Ze.y,Ve,rt),M){const{x:ht,y:Ht,z:At}=M.anchor,[Lt,nn,xn]=M.up;R0(K,ht,Ht,At,Lt,nn,xn),R0(K,ht,Ht,At,Lt,nn,xn),R0(K,ht,Ht,At,Lt,nn,xn),R0(K,ht,Ht,At,Lt,nn,xn),k0(n.dynamicLayoutVertexArray,ht,Ht,At,ue)}else k0(n.dynamicLayoutVertexArray,D.x,D.y,D.z,ue);if(j){const ht=ze||je;D0(n.iconTransitioningVertexArray,ht.x,ht.y),D0(n.iconTransitioningVertexArray,ht.x+ht.w,ht.y),D0(n.iconTransitioningVertexArray,ht.x,ht.y+ht.h),D0(n.iconTransitioningVertexArray,ht.x+ht.w,ht.y+ht.h)}V.emplaceBack(Pt,Pt+1,Pt+2),V.emplaceBack(Pt+1,Pt+2,Pt+3),$.vertexLength+=4,$.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ct[0]),he!==a.length-1&&Dt===a[he+1].sectionIndex||n.programConfigurations.populatePaintArrays(X.length,y,y.index,{},P,A,N,pe&&pe[Dt])}const ge=M?M.anchor:D;n.placedSymbolArray.emplaceBack(ge.x,ge.y,ge.z,D.x,D.y,ne,this.glyphOffsetArray.length-ne,ie,v,C,D.segment,d?d[0]:0,d?d[1]:0,g[0],g[1],T,0,!1,0,I,0)}_commitLayoutVertex(n,a,d,g,h,y,T){n.emplaceBack(a,d,g,h,y,Math.round(T.x),Math.round(T.y))}_addCollisionDebugVertices(n,a,d,g,h,y,T){const M=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),D=M.vertexLength,v=T.tileAnchorX,C=T.tileAnchorY;for(let P=0;P<4;P++)d.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(d.collisionVertexArrayExt,a,n.padding,T.zOffset),this._commitLayoutVertex(d.layoutVertexArray,g,h,y,v,C,new Tt(n.x1,n.y1)),this._commitLayoutVertex(d.layoutVertexArray,g,h,y,v,C,new Tt(n.x2,n.y1)),this._commitLayoutVertex(d.layoutVertexArray,g,h,y,v,C,new Tt(n.x2,n.y2)),this._commitLayoutVertex(d.layoutVertexArray,g,h,y,v,C,new Tt(n.x1,n.y2)),M.vertexLength+=4;const I=d.indexArray;I.emplaceBack(D,D+1),I.emplaceBack(D+1,D+2),I.emplaceBack(D+2,D+3),I.emplaceBack(D+3,D),M.primitiveLength+=4}_addTextDebugCollisionBoxes(n,a,d,g,h,y){for(let T=g;T<h;T++){const M=d.get(T),D=this.getSymbolInstanceTextSize(n,y,a,T);this._addCollisionDebugVertices(M,D,this.textCollisionBox,M.projectedAnchorX,M.projectedAnchorY,M.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(n,a,d,g,h,y){for(let T=g;T<h;T++){const M=d.get(T),D=this.getSymbolInstanceIconSize(n,a,y.placedIconSymbolIndex);this._addCollisionDebugVertices(M,D,this.iconCollisionBox,M.projectedAnchorX,M.projectedAnchorY,M.projectedAnchorZ,y)}}generateCollisionDebugBuffers(n,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new hS(zl,oD.members,nl),this.iconCollisionBox=new hS(zl,oD.members,nl);const d=Qf(this.iconSizeData,n),g=Qf(this.textSizeData,n);for(let h=0;h<this.symbolInstances.length;h++){const y=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(g,n,a,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(g,n,a,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(d,n,a,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(d,n,a,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(n,a,d,g){const h=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:g),y=b0(this.textSizeData,n,h)/Li;return this.tilePixelRatio*y}getSymbolInstanceIconSize(n,a,d){const g=this.icon.placedSymbolArray.get(d),h=b0(this.iconSizeData,n,g);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(n,a,d,g){n.emplaceBack(a,-d,-d,g),n.emplaceBack(a,d,-d,g),n.emplaceBack(a,d,d,g),n.emplaceBack(a,-d,d,g)}_updateTextDebugCollisionBoxes(n,a,d,g,h,y){for(let T=g;T<h;T++){const M=d.get(T),D=this.getSymbolInstanceTextSize(n,y,a,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,M.padding,y.zOffset)}}_updateIconDebugCollisionBoxes(n,a,d,g,h,y){for(let T=g;T<h;T++){const M=d.get(T),D=this.getSymbolInstanceIconSize(n,a,y.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,D,M.padding,y.zOffset)}}updateCollisionDebugBuffers(n,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const d=Qf(this.iconSizeData,n),g=Qf(this.textSizeData,n);for(let h=0;h<this.symbolInstances.length;h++){const y=this.symbolInstances.get(h);this._updateTextDebugCollisionBoxes(g,n,a,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(g,n,a,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(d,n,a,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._updateIconDebugCollisionBoxes(d,n,a,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,a,d,g,h,y,T,M,D){const v={};if(a<d){const{x1:C,y1:I,x2:P,y2:A,padding:N,projectedAnchorX:j,projectedAnchorY:V,projectedAnchorZ:X,tileAnchorX:K,tileAnchorY:$,featureIndex:ne}=n.get(a);v.textBox={x1:C,y1:I,x2:P,y2:A,padding:N,projectedAnchorX:j,projectedAnchorY:V,projectedAnchorZ:X,tileAnchorX:K,tileAnchorY:$},v.textFeatureIndex=ne}if(g<h){const{x1:C,y1:I,x2:P,y2:A,padding:N,projectedAnchorX:j,projectedAnchorY:V,projectedAnchorZ:X,tileAnchorX:K,tileAnchorY:$,featureIndex:ne}=n.get(g);v.verticalTextBox={x1:C,y1:I,x2:P,y2:A,padding:N,projectedAnchorX:j,projectedAnchorY:V,projectedAnchorZ:X,tileAnchorX:K,tileAnchorY:$},v.verticalTextFeatureIndex=ne}if(y<T){const{x1:C,y1:I,x2:P,y2:A,padding:N,projectedAnchorX:j,projectedAnchorY:V,projectedAnchorZ:X,tileAnchorX:K,tileAnchorY:$,featureIndex:ne}=n.get(y);v.iconBox={x1:C,y1:I,x2:P,y2:A,padding:N,projectedAnchorX:j,projectedAnchorY:V,projectedAnchorZ:X,tileAnchorX:K,tileAnchorY:$},v.iconFeatureIndex=ne}if(M<D){const{x1:C,y1:I,x2:P,y2:A,padding:N,projectedAnchorX:j,projectedAnchorY:V,projectedAnchorZ:X,tileAnchorX:K,tileAnchorY:$,featureIndex:ne}=n.get(M);v.verticalIconBox={x1:C,y1:I,x2:P,y2:A,padding:N,projectedAnchorX:j,projectedAnchorY:V,projectedAnchorZ:X,tileAnchorX:K,tileAnchorY:$},v.verticalIconFeatureIndex=ne}return v}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const d=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(n,a){const d=n.placedSymbolArray.get(a),g=d.vertexStartIndex+4*d.numGlyphs;for(let h=d.vertexStartIndex;h<g;h+=4)n.indexArray.emplaceBack(h,h+1,h+2),n.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(n),d=Math.cos(n),g=[],h=[],y=[];for(let T=0;T<this.symbolInstances.length;++T){y.push(T);const M=this.symbolInstances.get(T);g.push(0|Math.round(a*M.tileAnchorX+d*M.tileAnchorY)),h.push(M.featureIndex)}return y.sort((T,M)=>g[T]-g[M]||h[M]-h[T]),y}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let n=0;n<this.symbolInstances.length;++n)this.symbolInstanceIndexesSortedZOffset.push(n)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((n,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(n).zOffset)}addToSortKeyRanges(n,a){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===a?d.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const d=this.symbolInstances.get(a);this.featureSortOrder.push(d.featureIndex);const{rightJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:T,placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:D}=d;g>=0&&this.addIndicesForPlacedSymbol(this.text,g),h>=0&&h!==g&&this.addIndicesForPlacedSymbol(this.text,h),y>=0&&y!==h&&y!==g&&this.addIndicesForPlacedSymbol(this.text,y),T>=0&&this.addIndicesForPlacedSymbol(this.text,T),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let FD,BD,fS;Ot(N0,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),N0.addDynamicAttributes=k0;class VD{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:lo,this.defaultValue=n}evaluate(n){if(n.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(n.formattedSection))return a.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ot(VD,"FormatSectionOverride",{omit:["defaultValue"]});const pS=()=>fS||(fS={layout:FD||(FD=new Sr({"symbol-placement":new bt(We.layout_symbol["symbol-placement"]),"symbol-spacing":new bt(We.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new bt(We.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gt(We.layout_symbol["symbol-sort-key"]),"symbol-z-order":new bt(We.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new bt(We.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new bt(We.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new bt(We.layout_symbol["icon-ignore-placement"]),"icon-optional":new bt(We.layout_symbol["icon-optional"]),"icon-rotation-alignment":new bt(We.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gt(We.layout_symbol["icon-size"]),"icon-text-fit":new Gt(We.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Gt(We.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gt(We.layout_symbol["icon-image"]),"icon-rotate":new Gt(We.layout_symbol["icon-rotate"]),"icon-padding":new bt(We.layout_symbol["icon-padding"]),"icon-keep-upright":new bt(We.layout_symbol["icon-keep-upright"]),"icon-offset":new Gt(We.layout_symbol["icon-offset"]),"icon-anchor":new Gt(We.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new bt(We.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new bt(We.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new bt(We.layout_symbol["text-rotation-alignment"]),"text-field":new Gt(We.layout_symbol["text-field"]),"text-font":new Gt(We.layout_symbol["text-font"]),"text-size":new Gt(We.layout_symbol["text-size"]),"text-max-width":new Gt(We.layout_symbol["text-max-width"]),"text-line-height":new Gt(We.layout_symbol["text-line-height"]),"text-letter-spacing":new Gt(We.layout_symbol["text-letter-spacing"]),"text-justify":new Gt(We.layout_symbol["text-justify"]),"text-radial-offset":new Gt(We.layout_symbol["text-radial-offset"]),"text-variable-anchor":new bt(We.layout_symbol["text-variable-anchor"]),"text-anchor":new Gt(We.layout_symbol["text-anchor"]),"text-max-angle":new bt(We.layout_symbol["text-max-angle"]),"text-writing-mode":new bt(We.layout_symbol["text-writing-mode"]),"text-rotate":new Gt(We.layout_symbol["text-rotate"]),"text-padding":new bt(We.layout_symbol["text-padding"]),"text-keep-upright":new bt(We.layout_symbol["text-keep-upright"]),"text-transform":new Gt(We.layout_symbol["text-transform"]),"text-offset":new Gt(We.layout_symbol["text-offset"]),"text-allow-overlap":new bt(We.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new bt(We.layout_symbol["text-ignore-placement"]),"text-optional":new bt(We.layout_symbol["text-optional"]),visibility:new bt(We.layout_symbol.visibility)})),paint:BD||(BD=new Sr({"icon-opacity":new Gt(We.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Gt(We.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Gt(We.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Gt(We.paint_symbol["text-emissive-strength"]),"icon-color":new Gt(We.paint_symbol["icon-color"]),"icon-halo-color":new Gt(We.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gt(We.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gt(We.paint_symbol["icon-halo-blur"]),"icon-translate":new bt(We.paint_symbol["icon-translate"]),"icon-translate-anchor":new bt(We.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Gt(We.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Gt(We.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Gt(We.paint_symbol["text-occlusion-opacity"]),"text-color":new Gt(We.paint_symbol["text-color"],{runtimeType:cs,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Gt(We.paint_symbol["text-halo-color"]),"text-halo-width":new Gt(We.paint_symbol["text-halo-width"]),"text-halo-blur":new Gt(We.paint_symbol["text-halo-blur"]),"text-translate":new bt(We.paint_symbol["text-translate"]),"text-translate-anchor":new bt(We.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new bt(We.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new bt(We.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new bt(We.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new bt(We.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Gt(We.paint_symbol["symbol-z-offset"]),"symbol-elevation-reference":new bt(We.paint_symbol["symbol-elevation-reference"])}))},fS);class L0 extends $i{constructor(n,a,d,g){super(n,pS(),a,d,g),this._colorAdjustmentMatrix=Ie.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=n.paint!==void 0&&("icon-occlusion-opacity"in n.paint||"text-occlusion-opacity"in n.paint)}recalculate(n,a){super.recalculate(n,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const d=this.layout.get("text-writing-mode");if(d){const g=[];for(const h of d)g.indexOf(h)<0&&g.push(h);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(n,a,d,g){return this._saturation===n&&this._contrast===a&&this._brightnessMin===d&&this._brightnessMax===g||(this._colorAdjustmentMatrix=function(h,y,T,M){h=we(h),y=de(y);const D=Ie.mat4.create(),v=h/3,C=1-2*v,I=[C,v,v,0,v,C,v,0,v,v,C,0,0,0,0,1],P=.5-.5*y,A=M-T;return Ie.mat4.multiply(D,[A,0,0,0,0,A,0,0,0,0,A,0,T,T,T,1],[y,0,0,0,0,y,0,0,0,0,y,0,P,P,P,1]),Ie.mat4.multiply(D,D,I),D}(n,a,d,g),this._saturation=n,this._contrast=a,this._brightnessMin=d,this._brightnessMax=g),this._colorAdjustmentMatrix}getValueAndResolveTokens(n,a,d,g){const h=this.layout.get(n).evaluate(a,{},d,g),y=this._unevaluatedLayout._values[n];return y.isDataDriven()||Pf(y.value)||!h?h:function(T,M){return M.replace(/{([^{}]+)}/g,(D,v)=>v in T?String(T[v]):"")}(a.properties,h)}createBucket(n){return new N0(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of pS().paint.overridableProperties){if(!L0.hasPaintOverride(this.layout,n))continue;const a=this.paint.get(n),d=new VD(a),g=new Cf(d,a.property.specification,this.scope,this.options);let h=null;h=a.value.kind==="constant"||a.value.kind==="source"?new og("source",g):new Fo("composite",g,a.value.zoomStops,a.value._interpolationType),this.paint._values[n]=new Yc(a.property,h,a.parameters)}}_handleOverridablePaintPropertyUpdate(n,a,d){return!(!this.layout||a.isDataDriven()||d.isDataDriven())&&L0.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,a){const d=n.get("text-field"),g=pS().paint.properties[a];let h=!1;const y=T=>{for(const M of T)if(g.overrides&&g.overrides.hasOverride(M))return void(h=!0)};if(d.value.kind==="constant"&&d.value.value instanceof Ui)y(d.value.value.sections);else if(d.value.kind==="source"){const T=D=>{h||(D instanceof co&&Wr(D.value)===Ic?y(D.value.sections):D instanceof Nc?y(D.sections):D.eachChild(T))},M=d.value;M._styleExpression&&T(M._styleExpression.expression)}return h}getProgramIds(){return["symbol"]}getDefaultProgramParams(n,a,d){return{config:new Bl(this,{zoom:a,lut:d}),overrideFog:!1}}}let UD,$D,GD,WD;var mS=Bn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function gS(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function yS(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class _S{constructor(n,a,d,g){this.context=n,this.format=d,this.useMipmap=g&&g.useMipmap,this.texture=n.gl.createTexture(),this.update(a,{premultiply:g&&g.premultiply})}update(n,a){const d=n&&n instanceof HTMLVideoElement&&n.width===0?n.videoWidth:n.width,g=n&&n instanceof HTMLVideoElement&&n.height===0?n.videoHeight:n.height,{context:h}=this,{gl:y}=h,{x:T,y:M}=a&&a.position?a.position:{x:0,y:0},D=Math.max(T+d,this.size?this.size[0]:0),v=Math.max(M+g,this.size?this.size[1]:0);!this.size||this.size[0]===D&&this.size[1]===v||(y.bindTexture(y.TEXTURE_2D,null),y.deleteTexture(this.texture),this.texture=y.createTexture(),this.size=null),y.bindTexture(y.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA8&&(!a||a.premultiply!==!1));const C=n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap;if(!this.size&&D>0&&v>0){const I=this.useMipmap?Math.floor(Math.log2(Math.max(D,v)))+1:1;y.texStorage2D(y.TEXTURE_2D,I,this.format,D,v),this.size=[D,v]}if(this.size)if(C)y.texSubImage2D(y.TEXTURE_2D,0,T,M,gS(this.format),yS(this.format),n);else{const I=n.data;I&&y.texSubImage2D(y.TEXTURE_2D,0,T,M,d,g,gS(this.format),yS(this.format),I)}this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(n,a,d=!1){const{context:g}=this,{gl:h}=g;h.bindTexture(h.TEXTURE_2D,this.texture),n!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap&&!d?n===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),a!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,a),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(n,a,d,g){const{context:h}=this,{gl:y}=h;y.bindTexture(y.TEXTURE_2D,this.texture),a!==this.magFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,a),this.magFilter=a),n!==this.minFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,this.useMipmap?n===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),d!==this.wrapS&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,d),this.wrapS=d),g!==this.wrapT&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,g),this.wrapT=g)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class O0{constructor(n,a){this.context=n,this.texture=a}bind(n,a){const{context:d}=this,{gl:g}=d;g.bindTexture(g.TEXTURE_2D,this.texture),n!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,n),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,n),this.minFilter=n),a!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,a),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,a),this.wrapS=a)}}function j0(c,n,a,d,g,h,y,T){const M=[c,n,1,a,d,1,g,h,1],D=[y,T,1],v=Ie.mat3.adjoint([],M),[C,I,P]=Ie.vec3.transformMat3(D,D,v);return Ie.mat3.multiply(M,M,[C,0,0,0,I,0,0,0,P])}function HD(c,n,a,d,g,h,y,T){const M=function(D,v,C,I,P,A,N,j){const V=j0(0,0,1,0,1,1,0,1),X=j0(D,v,C,I,P,A,N,j),K=Ie.mat3.adjoint([],V);return Ie.mat3.multiply(X,X,K)}(c,n,a,d,g,h,y,T);return[M[2]/M[8]/Mt,M[5]/M[8]/Mt]}function z0(c){return[c[0],Math.min(Math.max(c[1],-Te),Te)]}class qD extends Mc{constructor(n,a,d,g){super(),this.id=n,this.dispatcher=d,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(g),this.options=a,this._dirty=!1}load(n,a){if(this._loaded=a||!1,this.fire(new Ha("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return n&&(this.coordinates=n),this._loaded=!0,void this._finishLoading();this._imageRequest=Lo(this.map._requestManager.transformRequest(this.url,Ec.Image),(d,g)=>{this._imageRequest=null,this._loaded=!0,d?this.fire(new wd(d)):g&&(this.image=g instanceof HTMLImageElement?kt.getImageData(g):g,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}setTexture(n){if(!(n.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new O0(this.map.painter.context,n.handle),this.width=n.dimensions[0],this.height=n.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ha("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(n){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof O0||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(n){if(this.coordinates=n,this._boundsArray=void 0,this._unsupportedCoords=!1,!n.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=n[0][1],d=n[0][1];for(const h of n)h[1]>d&&(d=h[1]),h[1]<a&&(a=h[1]);const g=(d+a)/2;if(g>Te?this.onNorthPole=!0:g<-Te&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const h=n.map(Ue.fromLngLat);this.tileID=function(y){let T=1/0,M=1/0,D=-1/0,v=-1/0;for(const N of y)T=Math.min(T,N.x),M=Math.min(M,N.y),D=Math.max(D,N.x),v=Math.max(v,N.y);const C=Math.max(D-T,v-M),I=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),P=Math.pow(2,I);let A=Math.floor((T+D)/2*P);return A>1&&(A-=1),new gi(I,A,Math.floor((M+v)/2*P))}(h),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ha("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(n){for(const V in this.tiles){const X=this.tiles[V];X.state!=="loaded"&&(X.state="loaded",X.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const a=Zg(new gi(0,0,0),this.map.transform.projection),d=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(V){const X=V[1].x-V[0].x,K=V[1].y-V[0].y,$=V[2].x-V[1].x,ne=V[2].y-V[1].y,ie=V[3].x-V[2].x,ue=V[3].y-V[2].y,pe=V[0].x-V[3].x,ge=V[0].y-V[3].y,he=X*ne-$*K,Se=$*ue-ie*ne,_e=ie*ge-pe*ue,Ce=pe*K-X*ge;return he>0&&Se>0&&_e>0&&Ce>0||he<0&&Se<0&&_e<0&&Ce<0}(d))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const g=Zg(this.tileID,this.map.transform.projection),[h,y,T,M]=this.coordinates.map(V=>{const X=g.projection.project(V[0],V[1]);return kD(g,X)._round()});this.perspectiveTransform=HD(h.x,h.y,y.x,y.y,T.x,T.y,M.x,M.y);const D=this._boundsArray=new el;D.emplaceBack(h.x,h.y,0,0),D.emplaceBack(y.x,y.y,Mt,0),D.emplaceBack(M.x,M.y,0,Mt),D.emplaceBack(T.x,T.y,Mt,Mt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=n.createVertexBuffer(D,mS.members),this.boundsSegments=Nr.simpleSegment(0,0,4,2);const v=[],C=[z0((I=this.coordinates)[0]),z0(I[1]),z0(I[2]),z0(I[3])];var I;const[P,A,N,j]=function(V){let X=V[0][0],K=X,$=V[0][1],ne=$;for(let ie=1;ie<V.length;ie++)V[ie][0]<X?X=V[ie][0]:V[ie][0]>K&&(K=V[ie][0]),V[ie][1]<$?$=V[ie][1]:V[ie][1]>ne&&(ne=V[ie][1]);return[X,$,K-X,ne-$]}(C);{const V=new el,[X,K,$,ne]=function(Fe){let Ze=Fe[0].x,Ve=Ze,rt=Fe[0].y,ct=rt;for(let Je=1;Je<Fe.length;Je++)Fe[Je].x<Ze?Ze=Fe[Je].x:Fe[Je].x>Ve&&(Ve=Fe[Je].x),Fe[Je].y<rt?rt=Fe[Je].y:Fe[Je].y>ct&&(ct=Fe[Je].y);return[Ze,rt,Ve-Ze,ct-rt]}(d),ie=Fe=>[(Fe.x-X)/$,(Fe.y-K)/ne],[ue,pe,ge,he]=d.map(ie),Se=function(Fe,Ze,Ve,rt,ct,Je,Dt,Pt){const xt=j0(0,0,1,0,1,1,0,1),ht=j0(Fe,Ze,Ve,rt,ct,Je,Dt,Pt),Ht=Ie.mat3.adjoint([],ht);return Ie.mat3.multiply(xt,xt,Ht)}(ue[0],ue[1],pe[0],pe[1],ge[0],ge[1],he[0],he[1]);this.elevatedGlobePerspectiveTransform=HD(ue[0],ue[1],pe[0],pe[1],ge[0],ge[1],he[0],he[1]);const _e=(Fe,Ze)=>{v.push(Fe.lng);const Ve=Math.round((Fe.lng-P)/N*Mt),rt=Math.round((Fe.lat-A)/j*Mt),ct=ie(Ze),Je=Ie.vec3.transformMat3([],[ct[0],ct[1],1],Se),Dt=Math.round(Je[0]/Je[2]*Mt),Pt=Math.round(Je[1]/Je[2]*Mt);V.emplaceBack(Ve,rt,Dt,Pt)},Ce=d[3].x-d[0].x,Le=d[3].y-d[0].y,je=d[2].x-d[1].x,ze=d[2].y-d[1].y;for(let Fe=0;Fe<65;Fe++){const Ze=Fe/64,Ve=[d[0].x+Ze*Ce,d[0].y+Ze*Le],rt=[d[1].x+Ze*je,d[1].y+Ze*ze],ct=rt[0]-Ve[0],Je=rt[1]-Ve[1];for(let Dt=0;Dt<65;Dt++){const Pt=Dt/64,xt={x:Ve[0]+ct*Pt,y:Ve[1]+Je*Pt,z:0};_e(a.projection.unproject(xt.x,xt.y),xt)}}this.elevatedGlobeVertexBuffer=n.createVertexBuffer(V,mS.members)}{this.maxLongitudeTriangleSize=0;let V=[],X=new Ri;const K=($,ne,ie)=>{X.emplaceBack($,ne,ie);const ue=v[$],pe=v[ne],ge=v[ie],he=Math.min(Math.min(ue,pe),ge),Se=Math.max(Math.max(ue,pe),ge)-he;Se>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Se),V.push(he+Se/2)};for(let $=0;$<64;$++)for(let ne=0;ne<64;ne++){const ie=65*$+ne,ue=ie+1,pe=ie+65,ge=pe+1;K(ie,pe,ue),K(ue,pe,ge)}[V,X]=function($,ne){const ie=Array.from({length:$.length},(ge,he)=>he);ie.sort((ge,he)=>$[ge]-$[he]);const ue=[],pe=new Ri;for(let ge=0;ge<ie.length;ge++){const he=ie[ge];ue.push($[he]);const Se=3*he,_e=Se+1;pe.emplaceBack(ne.uint16[Se],ne.uint16[_e],ne.uint16[_e+1])}return[ue,pe]}(V,X),this.elevatedGlobeTrianglesCenterLongitudes=V,this.elevatedGlobeIndexBuffer=n.createIndexBuffer(X)}this.elevatedGlobeSegments=Nr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,N/Mt,0,j/Mt,0,0,A,P,0])}prepare(){const n=Object.keys(this.tiles).length!==0;if(this.tileID&&!n)return;const a=this.map.painter.context,d=a.gl;!this._dirty||this.texture instanceof O0||(this.texture?this.texture.update(this.image):(this.texture=new _S(a,this.image,d.RGBA8),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),n&&this._prepareData(a)}loadTile(n,a){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},a(null)):(n.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(n){const a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;const d=this.elevatedGlobeTrianglesCenterLongitudes;let g=(h=n+180)+360*Math.round((d[0]-h)/360);var h;const y=new Nr,T=(C,I)=>{y.segments.push({vertexOffset:0,primitiveOffset:C,vertexLength:a.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},M=.51*this.maxLongitudeTriangleSize;if(Math.abs(d[0]-g)<=M){const C=ce(d,0,d.length,g+M);return C===d.length||T(C,Ke(d,C+1,d.length,g+360-M)-C),y}g<d[0]&&(g+=360);const D=Ke(d,0,d.length,g-M);if(D===d.length)return T(0,d.length),y;T(0,D-0);const v=ce(d,D+1,d.length,g+M);return v!==d.length&&T(v,d.length-v),y}}const T3=(Math.pow(256,2)-1)/16907520;class ZD extends $i{constructor(n,a,d,g){super(n,{layout:GD||(GD=new Sr({visibility:new bt(We.layout_raster.visibility)})),paint:WD||(WD=new Sr({"raster-opacity":new bt(We.paint_raster["raster-opacity"]),"raster-color":new ho(We.paint_raster["raster-color"]),"raster-color-mix":new bt(We.paint_raster["raster-color-mix"]),"raster-color-range":new bt(We.paint_raster["raster-color-range"]),"raster-hue-rotate":new bt(We.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new bt(We.paint_raster["raster-brightness-min"]),"raster-brightness-max":new bt(We.paint_raster["raster-brightness-max"]),"raster-saturation":new bt(We.paint_raster["raster-saturation"]),"raster-contrast":new bt(We.paint_raster["raster-contrast"]),"raster-resampling":new bt(We.paint_raster["raster-resampling"]),"raster-fade-duration":new bt(We.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new bt(We.paint_raster["raster-emissive-strength"]),"raster-array-band":new bt(We.paint_raster["raster-array-band"]),"raster-elevation":new bt(We.paint_raster["raster-elevation"])}))},a,d,g),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(n){return!(n&&n._source instanceof qD&&(n._source.onNorthPole||n._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(n){n!=="raster-color"&&n!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(n){if(!this.hasColorMap()||!this._curRampRange)return;const a=this._transitionablePaint._values["raster-color"].value.expression,[d,g]=n||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(d)&&isNaN(g)||d===this._curRampRange[0]&&g===this._curRampRange[1]||(this.colorRamp=kg({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:d,end:g}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[d,g])}}let XD,YD,KD,JD,QD;class eR extends $i{constructor(n,a,d,g){super(n,{layout:XD||(XD=new Sr({visibility:new bt(We["layout_raster-particle"].visibility)})),paint:YD||(YD=new Sr({"raster-particle-array-band":new bt(We["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new bt(We["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new ho(We["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new bt(We["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new bt(We["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new bt(We["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new bt(We["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new bt(We["paint_raster-particle"]["raster-particle-elevation"])}))},a,d,g),this._updateColorRamp(),this.lastInvalidatedAt=kt.now()}onRemove(n){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(n){return!1}_handleSpecialPaintPropertyUpdate(n){n!=="raster-particle-color"&&n!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),n==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const n=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=kg({expression:n,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=kt.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class E3 extends $i{constructor(n,a){super(n,{},a,null),this.implementation=n,n.slot&&(this.slot=n.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(n){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}function xS(c,n,a){const d=[0,0,1],g=Ie.quat.identity([]);return Ie.quat.rotateY(g,g,a?-wn(c)+Math.PI:wn(c)),Ie.quat.rotateX(g,g,-wn(n)),Ie.vec3.transformQuat(d,d,g),Ie.vec3.normalize(d,d)}function tR(c,n){const a=F0(c.projection,c.zoom,c.width,c.height),d=function(h,y,T,M,D){const v=new Y(T.lng-180*pu,T.lat),C=new Y(T.lng+180*pu,T.lat),I=h.project(v.lng,v.lat),P=h.project(C.lng,C.lat),A=-Math.atan2(P.y-I.y,P.x-I.x),N=Ue.fromLngLat(T);N.y=mn(N.y,-1+pu,1-pu);const j=N.toLngLat(),V=h.project(j.lng,j.lat),X=Ue.fromLngLat(j);X.x+=pu;const K=X.toLngLat(),$=h.project(K.lng,K.lat),ne=rR($.x-V.x,$.y-V.y,A),ie=Ue.fromLngLat(j);ie.y+=pu;const ue=ie.toLngLat(),pe=h.project(ue.lng,ue.lat),ge=rR(pe.x-V.x,pe.y-V.y,A),he=Math.abs(ne.x)/Math.abs(ge.y),Se=Ie.mat4.identity([]);Ie.mat4.rotateZ(Se,Se,-A*(1-(D?0:M)));const _e=Ie.mat4.identity([]);return Ie.mat4.scale(_e,_e,[1,1-(1-he)*M,1]),_e[4]=-ge.x/ge.y*M,Ie.mat4.rotateZ(_e,_e,A),Ie.mat4.multiply(_e,Se,_e),_e}(c.projection,0,c.center,a,n),g=nR(c);return Ie.mat4.scale(d,d,[g,g,1]),d}function nR(c){const n=c.projection,a=F0(c.projection,c.zoom,c.width,c.height),d=vS(n,c.center),g=vS(n,Y.convert(n.center));return Math.pow(2,d*a+(1-a)*g)}function F0(c,n,a,d,g=1/0){const h=c.range;if(!h)return 0;const y=Math.min(g,Math.max(a,d)),T=Math.log(y/1024)/Math.LN2;return vc(h[0]+T,h[1]+T,n)}const pu=1/4e4;function vS(c,n){const a=mn(n.lat,-Te,Te),d=new Y(n.lng-180*pu,a),g=new Y(n.lng+180*pu,a),h=c.project(d.lng,a),y=c.project(g.lng,a),T=Ue.fromLngLat(d),M=Ue.fromLngLat(g),D=y.x-h.x,v=y.y-h.y,C=M.x-T.x,I=M.y-T.y,P=Math.sqrt((C*C+I*I)/(D*D+v*v));return Math.log(P)/Math.LN2}function rR(c,n,a){const d=Math.cos(a),g=Math.sin(a);return{x:c*d-n*g,y:c*g+n*d}}function iR(c,n,a){Ie.mat4.identity(c),Ie.mat4.rotateZ(c,c,wn(n[2])),Ie.mat4.rotateX(c,c,wn(n[0])),Ie.mat4.rotateY(c,c,wn(n[1])),Ie.mat4.scale(c,c,a),Ie.mat4.multiply(c,c,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function B0(c,n,a,d,g,h,y,T){const M=[a[0]-n[0],a[1]-n[1],0],D=[d[0]-n[0],d[1]-n[1],0];if(Ie.vec3.length(M)<1e-12||Ie.vec3.length(D)<1e-12)return Ie.quat.identity(c);const v=Ie.vec3.cross([],M,D);Ie.vec3.normalize(v,v),Ie.vec3.subtract(D,d,n),M[2]=(h-g)*T,D[2]=(y-g)*T;const C=M;return Ie.vec3.cross(C,M,D),Ie.vec3.normalize(C,C),Ie.quat.rotationTo(c,v,C)}function bS(c,n,a=!1){const d=lu(n.zoom),g=function(h,y,T){const M=y.worldSize,D=[h[12],h[13],h[14]],v=ve(D[1]/M),C=be(D[0]/M),I=Ie.mat4.identity([]),P=fe(1,v)*M,A=fe(1,0)*M*Oe(v,y.zoom),N=1/Lw(M);let j=A*N;if(T){const $=F0(y.projection,y.zoom,y.width,y.height,1024);j=N*y.projection.pixelSpaceConversion(y.center.lat,M,$)}const V=B(v,C);Ie.vec3.add(V,V,Ie.vec3.scale([],Ie.vec3.normalize([],V),P*j*D[2]));const X=function($){const ne=[$[0],$[1],$[2]];let ie=[0,1,0];const ue=Ie.vec3.cross([],ie,ne);return Ie.vec3.cross(ie,ne,ue),Ie.vec3.squaredLength(ie)===0&&(ie=[0,1,0],Ie.vec3.cross(ue,ne,ie)),Ie.vec3.normalize(ue,ue),Ie.vec3.normalize(ie,ie),Ie.vec3.normalize(ne,ne),[ue[0],ue[1],ue[2],0,ie[0],ie[1],ie[2],0,ne[0],ne[1],ne[2],0,$[0],$[1],$[2],1]}(V);Ie.mat4.scale(I,I,[j,j,j*P]),Ie.mat4.translate(I,I,[-D[0],-D[1],-D[2]]);const K=Ie.mat4.multiply([],y.globeMatrix,X);return Ie.mat4.multiply(K,K,I),Ie.mat4.multiply(K,K,h),K}(c,n,a);if(d>0){const h=function(y,T){const M=T.worldSize,D=fe(1,0)*M*Oe(T.center.lat,T.zoom)/Lw(M),v=fe(1,T.center.lat)*M,C=Ie.mat4.identity([]);return Ie.mat4.rotateY(C,C,wn(T.center.lng)),Ie.mat4.rotateX(C,C,wn(T.center.lat)),Ie.mat4.translate(C,C,[0,0,i]),Ie.mat4.scale(C,C,[D,D,D*v]),Ie.mat4.translate(C,C,[T.point.x-.5*M,T.point.y-.5*M,0]),Ie.mat4.multiply(C,C,y),Ie.mat4.multiply(C,T.globeMatrix,C)}(c,n);return function(y,T,M){const D=(A,N,j)=>{const V=Ie.vec3.length(A),X=Ie.vec3.length(N),K=Ul(A,N,j);return Ie.vec3.scale(K,K,1/Ie.vec3.length(K)*Xt(V,X,j))},v=D([y[0],y[1],y[2]],[T[0],T[1],T[2]],M),C=D([y[4],y[5],y[6]],[T[4],T[5],T[6]],M),I=D([y[8],y[9],y[10]],[T[8],T[9],T[10]],M),P=Ul([y[12],y[13],y[14]],[T[12],T[13],T[14]],M);return[v[0],v[1],v[2],0,C[0],C[1],C[2],0,I[0],I[1],I[2],0,P[0],P[1],P[2],1]}(g,h,d)}return g}function sR(c,n,a,d){const g=pr.projectAabbCorners(d,a);let h=Number.MAX_VALUE,y=-1;for(let D=0;D<g.length;++D){const v=g[D];v[0]=(.5*v[0]+.5)*n.width,v[1]=(.5-.5*v[1])*n.height,v[2]<h&&(y=D,h=v[2])}const T=D=>new Tt(g[D][0],g[D][1]);let M;switch(y){case 0:case 6:M=[T(1),T(5),T(4),T(7),T(3),T(2),T(1)];break;case 1:case 7:M=[T(0),T(4),T(5),T(6),T(2),T(3),T(0)];break;case 3:case 5:M=[T(1),T(0),T(4),T(7),T(6),T(2),T(1)];break;default:M=[T(1),T(5),T(6),T(7),T(3),T(0),T(1)]}if(Ct(c,M))return h}const C3=Bn([{name:"a_pos_3f",components:3,type:"Float32"}]),P3=Bn([{name:"a_color_3f",components:3,type:"Float32"}]),M3=Bn([{name:"a_color_4f",components:4,type:"Float32"}]),A3=Bn([{name:"a_uv_2f",components:2,type:"Float32"}]),I3=Bn([{name:"a_normal_3f",components:3,type:"Float32"}]),D3=Bn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),R3=Bn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),oR={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class V0{constructor(n,a,d,g){this.message=(n?`${n}: `:"")+d,g&&(this.identifier=g),a!=null&&a.__line__&&(this.line=a.__line__)}}function aR(c,n){const a=c.indexOf("://")===-1;try{return new URL(c,a&&n?"http://example.com":void 0),!0}catch{return!1}}class lR{constructor(n,a){this.feature=n,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class cR{constructor(){this.instancedDataArray=new qd,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class wS{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.projection=n.projection,this.index=n.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(n,a){}populate(n,a,d,g){this.tileToMeter=De(d);const h=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:y,id:T,index:M,sourceLayerIndex:D}of n){const v=T??(y.properties&&y.properties.hasOwnProperty("id")?y.properties.id:void 0),C=vt(y,h);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),C,d))continue;const I={id:v,sourceLayerIndex:D,index:M,geometry:h?C.geometry:_t(y,d,g),properties:y.properties,type:y.type,patterns:{}},P=this.addFeature(I,I.geometry,C);P&&a.featureIndex.insert(y,I.geometry,M,D,this.index,this.instancesPerModel[P].instancedDataArray.length,Mt/32)}this.lookup=null}update(n,a,d,g){for(const h in this.instancesPerModel){const y=this.instancesPerModel[h];for(const T in n)y.idToFeaturesIndex.hasOwnProperty(T)&&(this.evaluate(y.features[y.idToFeaturesIndex[T]],n[T],y,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let n=!1;for(const a in this.instancesPerModel){const d=this.instancesPerModel[a];for(const g of d.features){const h=this.layers[0],y=g.feature,T=this.canonical,M=h.paint.get("model-rotation").evaluate(y,{},T),D=h.paint.get("model-scale").evaluate(y,{},T),v=h.paint.get("model-translation").evaluate(y,{},T);Ie.vec3.exactEquals(g.rotation,M)&&Ie.vec3.exactEquals(g.scale,D)&&Ie.vec3.exactEquals(g.translation,v)||(this.evaluate(g,g.featureStates,d,!0),n=!0)}}return n}updateReplacement(n,a,d,g){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const h=a.getReplacementRegionsForTile(n.toUnwrapped(),!0);if(Zw(this.activeReplacements,h))return!1;this.activeReplacements=h;let y=!1;for(const T in this.instancesPerModel){const M=this.instancesPerModel[T],D=M.instancedDataArray;for(const v of M.features){const C=v.instancedDataOffset,I=v.instancedDataCount;for(let P=0;P<I;P++){const A=16*(P+C);let N=D.float32[A+0];const j=N>Mt;N=j?N-Mt:N;const V=Math.floor(N),X=D.float32[A+1];let K=!1;for(const $ of this.activeReplacements)if(!TI($,d,oR.Model,g)&&!($.min.x>V||V>$.max.x||$.min.y>X||X>$.max.y)&&(K=II(AI(V,X,n.canonical,$.footprintTileId.canonical),$.footprint),K))break;D.float32[A]=K?N+Mt:N,y=y||K!==j}}}return y}isEmpty(){for(const n in this.instancesPerModel)if(this.instancesPerModel[n].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(n){if(!this.uploaded)for(const a in this.instancesPerModel){const d=this.instancesPerModel[a];d.instancedDataArray.length<0||d.instancedDataArray.length===0||(d.instancedDataBuffer?d.instancedDataBuffer.updateData(d.instancedDataArray):d.instancedDataBuffer=n.createVertexBuffer(d.instancedDataArray,D3.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const a in this.instancesPerModel){const d=this.instancesPerModel[a];d.instancedDataArray.length!==0&&d.instancedDataBuffer&&d.instancedDataBuffer.destroy()}const n=this.layers[0].modelManager;if(n&&this.modelUris)for(const a of this.modelUris)n.removeModel(a,"")}addFeature(n,a,d){const g=this.layers[0],h=g.layout.get("model-id").evaluate(d,{},this.canonical);if(!h)return zn(`modelId is not evaluated for layer ${g.id} and it is not going to get rendered.`),h;aR(h,!1)&&(this.modelUris.includes(h)||this.modelUris.push(h)),this.instancesPerModel[h]||(this.instancesPerModel[h]=new cR);const y=this.instancesPerModel[h],T=y.instancedDataArray,M=new lR(d,T.length);for(const D of a)for(const v of D){if(v.x<0||v.x>=Mt||v.y<0||v.y>=Mt)continue;const C=(this.lookupDim-1)/Mt,I=this.lookupDim*(v.y*C|0)+v.x*C|0;if(this.lookup){if(this.lookup[I]!==0)continue;this.lookup[I]=1}this.instanceCount++;const P=T.length;T.resize(P+1),y.instancesEvaluatedElevation.push(0),T.float32[16*P]=v.x,T.float32[16*P+1]=v.y}return M.instancedDataCount=y.instancedDataArray.length-M.instancedDataOffset,M.instancedDataCount>0&&(n.id&&(y.idToFeaturesIndex[n.id]=y.features.length),y.features.push(M),this.evaluate(M,{},y,!1)),h}getModelUris(){return this.modelUris}evaluate(n,a,d,g){const h=this.layers[0],y=n.feature,T=this.canonical,M=n.rotation=h.paint.get("model-rotation").evaluate(y,a,T),D=n.scale=h.paint.get("model-scale").evaluate(y,a,T),v=n.translation=h.paint.get("model-translation").evaluate(y,a,T),C=h.paint.get("model-color").evaluate(y,a,T);C.a=h.paint.get("model-color-mix-intensity").evaluate(y,a,T);const I=[];this.maxVerticalOffset<v[2]&&(this.maxVerticalOffset=v[2]),this.maxScale=Math.max(Math.max(this.maxScale,D[0]),Math.max(D[1],D[2])),iR(I,M,D);const P=Math.round(100*C.a)+C.b/1.05;for(let A=0;A<n.instancedDataCount;++A){const N=n.instancedDataOffset+A,j=16*N,V=d.instancedDataArray.float32;let X=0;g&&(X=V[j+6]-d.instancesEvaluatedElevation[N]);const K=0|V[j+1];V[j]=(0|V[j])+C.r/1.05,V[j+1]=K+C.g/1.05,V[j+2]=P,V[j+3]=1/(T.z>10?this.tileToMeter:De(T,K)),V[j+4]=v[0],V[j+5]=v[1],V[j+6]=v[2]+X,V[j+7]=I[0],V[j+8]=I[1],V[j+9]=I[2],V[j+10]=I[4],V[j+11]=I[5],V[j+12]=I[6],V[j+13]=I[8],V[j+14]=I[9],V[j+15]=I[10],d.instancesEvaluatedElevation[N]=v[2]}}}let uR,dR;Ot(wS,"ModelBucket",{omit:["layers"]}),Ot(cR,"PerModelAttributes"),Ot(lR,"ModelFeature");const eh=64,ip={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function hR(c,n,a,d,g,h,y,T,M,D=!1){const v=a.zoom,C=a.project(d),I=Oe(d.lat,v),P=1/I;Ie.mat4.identity(c),Ie.mat4.translate(c,c,[C.x+y[0]*P,C.y+y[1]*P,y[2]]);let A=1,N=1;const j=a.worldSize;if(D){if(a.projection.name==="mercator"){let $=0;a.elevation&&($=a.elevation.getAtPointOrZero(new Ue(C.x/j,C.y/j),0));const ne=Ie.vec4.transformMat4([],[C.x,C.y,$,1],a.projMatrix)[3]/a.cameraToCenterDistance;A=ne,N=ne*Oe(a.center.lat,v)}else if(a.projection.name==="globe"){const $=bS(c,a),ne=Ie.mat4.multiply([],a.projMatrix,$),ie=[0,0,0,1];Ie.vec4.transformMat4(ie,ie,ne);const ue=ie[3]/a.cameraToCenterDistance,pe=lu(v),ge=a.projection.pixelsPerMeter(d.lat,j)*Oe(d.lat,v),he=a.projection.pixelsPerMeter(a.center.lat,j)*Oe(a.center.lat,v);A=ue/Xt(ge,Me(a.center.lat),pe),N=ue*I/ge,A*=he,N*=he}}else A=P;Ie.mat4.scale(c,c,[A,A,N]);const V=[...c],X=n.orientation,K=[];if(iR(K,[X[0]+g[0],X[1]+g[1],X[2]+g[2]],h),Ie.mat4.multiply(c,V,K),T&&a.elevation){let $=0;const ne=[];if(M&&a.elevation){$=function(pe,ge,he,Se,_e){const Ce=ge.elevation;if(!Ce)return 0;const Le=pr.projectAabbCorners(he,Se),je=fe(1,_e.lat)*ge.worldSize,ze=function(Ht,At){const Lt=[0,0,1],nn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const xn of nn){const fn=Ht[xn.corners[0]],pn=Ht[xn.corners[1]],Sn=Ht[xn.corners[2]],Tn=[pn[0]-fn[0],pn[1]-fn[1],At*(pn[2]-fn[2])],cr=Ie.vec3.cross(Tn,Tn,[Sn[0]-fn[0],Sn[1]-fn[1],At*(Sn[2]-fn[2])]);Ie.vec3.normalize(cr,cr),xn.dotProductWithUp=Ie.vec3.dot(cr,Lt)}return nn.sort((xn,fn)=>xn.dotProductWithUp-fn.dotProductWithUp),nn[0].corners}(Le,je),Fe=Le[ze[0]],Ze=Le[ze[1]],Ve=Le[ze[2]],rt=Le[ze[3]],ct=Ce.getAtPointOrZero(new Ue(Fe[0]/ge.worldSize,Fe[1]/ge.worldSize),0),Je=Ce.getAtPointOrZero(new Ue(Ze[0]/ge.worldSize,Ze[1]/ge.worldSize),0),Dt=Ce.getAtPointOrZero(new Ue(Ve[0]/ge.worldSize,Ve[1]/ge.worldSize),0),Pt=Ce.getAtPointOrZero(new Ue(rt[0]/ge.worldSize,rt[1]/ge.worldSize),0),xt=(ct+Pt)/2,ht=(Je+Dt)/2;return xt>ht?Je<Dt?B0(pe,Ze,rt,Fe,Je,Pt,ct,je):B0(pe,Ve,Fe,rt,Dt,ct,Pt,je):ct<Pt?B0(pe,Fe,Ze,Ve,ct,Je,Dt,je):B0(pe,rt,Ve,Ze,Pt,Dt,Je,je),Math.max(xt,ht)}(ne,a,n.aabb,c,d);const ie=Ie.mat4.fromQuat([],ne),ue=Ie.mat4.multiply([],ie,K);Ie.mat4.multiply(c,V,ue)}else $=a.elevation.getAtPointOrZero(new Ue(C.x/j,C.y/j),0);$!==0&&(c[14]+=$)}}function Qg(c,n,a=!1){c.uploaded||(c.gfxTexture=new _S(n,c.image,a?n.gl.R8:n.gl.RGBA8,{useMipmap:c.sampler.minFilter>=n.gl.NEAREST_MIPMAP_NEAREST}),c.uploaded=!0,c.image=null)}function k3(c,n,a){c.indexBuffer=n.createIndexBuffer(c.indexArray,!1,!0),c.vertexBuffer=n.createVertexBuffer(c.vertexArray,C3.members,!1,!0),c.normalArray&&(c.normalBuffer=n.createVertexBuffer(c.normalArray,I3.members,!1,!0)),c.texcoordArray&&(c.texcoordBuffer=n.createVertexBuffer(c.texcoordArray,A3.members,!1,!0)),c.colorArray&&(c.colorBuffer=n.createVertexBuffer(c.colorArray,(c.colorArray.bytesPerElement===12?P3:M3).members,!1,!0)),c.featureArray&&(c.pbrBuffer=n.createVertexBuffer(c.featureArray,R3.members,!0)),c.segments=Nr.simpleSegment(0,0,c.vertexArray.length,c.indexArray.length);const d=c.material;d.pbrMetallicRoughness.baseColorTexture&&Qg(d.pbrMetallicRoughness.baseColorTexture,n),d.pbrMetallicRoughness.metallicRoughnessTexture&&Qg(d.pbrMetallicRoughness.metallicRoughnessTexture,n),d.normalTexture&&Qg(d.normalTexture,n),d.occlusionTexture&&Qg(d.occlusionTexture,n,a),d.emissionTexture&&Qg(d.emissionTexture,n)}function SS(c,n,a){if(c.meshes)for(const d of c.meshes)k3(d,n,a);if(c.children)for(const d of c.children)SS(d,n,a)}function U0(c){if(c.meshes)for(const n of c.meshes)n.indexArray.destroy(),n.vertexArray.destroy(),n.colorArray&&n.colorArray.destroy(),n.normalArray&&n.normalArray.destroy(),n.texcoordArray&&n.texcoordArray.destroy(),n.featureArray&&n.featureArray.destroy();if(c.children)for(const n of c.children)U0(n)}function TS(c){if(c.meshes)for(const a of c.meshes)a.vertexBuffer&&(a.vertexBuffer.destroy(),a.indexBuffer.destroy(),a.normalBuffer&&a.normalBuffer.destroy(),a.texcoordBuffer&&a.texcoordBuffer.destroy(),a.colorBuffer&&a.colorBuffer.destroy(),a.pbrBuffer&&a.pbrBuffer.destroy(),a.segments.destroy(),a.material&&((n=a.material).pbrMetallicRoughness.baseColorTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),n.pbrMetallicRoughness.metallicRoughnessTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),n.normalTexture&&n.normalTexture.gfxTexture&&n.normalTexture.gfxTexture.destroy(),n.emissionTexture&&n.emissionTexture.gfxTexture&&n.emissionTexture.gfxTexture.destroy(),n.occlusionTexture&&n.occlusionTexture.gfxTexture&&n.occlusionTexture.gfxTexture.destroy()));var n;if(c.children)for(const a of c.children)TS(a)}class sp{constructor(n,a,d){this._demTile=n,this._dem=this._demTile.dem,this._scale=a,this._offset=d}static create(n,a,d){const g=d||n.findDEMTileFor(a);if(!g||!g.dem)return;const h=g.dem,y=g.tileID,T=1<<a.canonical.z-y.canonical.z;return new sp(g,h.dim/Mt/T,[(a.canonical.x/T-y.canonical.x)*h.dim,(a.canonical.y/T-y.canonical.y)*h.dim])}tileCoordToPixel(n,a){const d=a*this._scale+this._offset[1],g=Math.floor(n*this._scale+this._offset[0]),h=Math.floor(d);return new Tt(g,h)}getElevationAt(n,a,d,g){const h=n*this._scale+this._offset[0],y=a*this._scale+this._offset[1],T=Math.floor(h),M=Math.floor(y),D=this._dem;return g=!!g,d?Xt(Xt(D.get(T,M,g),D.get(T,M+1,g),y-M),Xt(D.get(T+1,M,g),D.get(T+1,M+1,g),y-M),h-T):D.get(T,M,g)}getElevationAtPixel(n,a,d){return this._dem.get(n,a,!!d)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*fe(1,n)*this._dem.stride}}const ES=new Float32Array(262144),th=new Uint8Array(262144);function fR(c){let n=0;if(c.meshes)for(const a of c.meshes)n=Math.max(n,a.aabb.max[2]);if(c.children)for(const a of c.children)n=Math.max(n,fR(a));return n}function pR(c,n,a){if(c.meshes)for(const d of c.meshes)d.aabb.min[0]!==1/0&&a.insert(n,d.aabb.min[0],d.aabb.min[1],d.aabb.max[0],d.aabb.max[1]);if(c.children)for(const d of c.children)pR(d,n,a)}const mR=["","wall","door","roof","window","lamp","logo"];class gR{constructor(n){this.node=n,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:n.id,geometry:[],properties:{height:fR(n)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new pr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let n=0;const a=new pr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const d of this.node.meshes)this.node.lightMeshIndex!==n&&(d.transformedAabb=pr.applyTransformFast(d.aabb,this.node.matrix),a.encapsulate(d.transformedAabb)),n++;this.aabb=a}return this.aabb}}class $0{constructor(n,a,d,g,h,y){this.id=a,this.modelTraits|=ip.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,d&&(this.modelTraits|=ip.HasMapboxMeshFeatures),g&&(this.modelTraits|=ip.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=h,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const T of n)this.nodesInfo.push(new gR(T)),pR(T,y.featureIndexArray.length,y.grid),y.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,y.bucketLayerIDs.length-1,0)}updateFootprints(n,a){for(const d of this.getNodesInfo()){const g=d.node;g.footprint&&a.push({footprint:g.footprint,id:n})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(n){if(!this.needsUpload)return;const a=this.getNodesInfo();for(const d of a){const g=d.node;this.uploaded?this.updatePbrBuffer(g):SS(g,n,!0)}for(const d of a)U0(d.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(n){let a=!1;if(!n.meshes)return a;for(const d of n.meshes)d.pbrBuffer&&(d.pbrBuffer.updateData(d.featureArray),a=!0);return a}needsReEvaluation(n,a,d){const g=n.transform.projectionOptions,h=n.style.getBrightness(),y=this.brightness!==h;return!!(!this.uploaded||this.dirty||g.name!==this.projection.name||ey(d.paint.get("model-color").value,y)||ey(d.paint.get("model-color-mix-intensity").value,y)||ey(d.paint.get("model-roughness").value,y)||ey(d.paint.get("model-emissive-strength").value,y)||ey(d.paint.get("model-height-based-emissive-strength-multiplier").value,y))&&(this.projection=g,this.brightness=h,!0)}evaluateScale(n,a){if(n.transform.zoom===this.zoom)return;this.zoom=n.transform.zoom;const d=this.getNodesInfo(),g=this.id.canonical;for(const h of d){const y=h.feature;h.evaluatedScale=a.paint.get("model-scale").evaluate(y,{},g)}}evaluate(n){const a=this.getNodesInfo();for(const d of a){if(!d.node.meshes)continue;const g=d.feature,h=d.node.meshes&&d.node.meshes[0].featureData,y=d.evaluatedColor[2],T=d.evaluatedRMEA[2],M=this.id.canonical;if(d.hasTranslucentParts=!1,h){for(let D=0;D<mR.length;D++){const v=mR[D];v.length&&(g.properties.part=v);const C=n.paint.get("model-color").evaluate(g,{},M).toRenderColor(null),I=n.paint.get("model-color-mix-intensity").evaluate(g,{},M);d.evaluatedColor[D]=[C.r,C.g,C.b,I],d.evaluatedRMEA[D][0]=n.paint.get("model-roughness").evaluate(g,{},M),d.evaluatedRMEA[D][2]=n.paint.get("model-emissive-strength").evaluate(g,{},M),d.evaluatedRMEA[D][3]=C.a,d.emissionHeightBasedParams[D]=n.paint.get("model-height-based-emissive-strength-multiplier").evaluate(g,{},M),!d.hasTranslucentParts&&C.a<1&&(d.hasTranslucentParts=!0)}delete g.properties.part,L3(d,y!==d.evaluatedColor[2]||T!==d.evaluatedRMEA[2],this.modelTraits)}else d.evaluatedRMEA[0][2]=n.paint.get("model-emissive-strength").evaluate(g,{},M);d.evaluatedScale=n.paint.get("model-scale").evaluate(g,{},M),this.updatePbrBuffer(d.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(n,a,d,g){const h=n.findDEMTileFor(d);if(h&&(h.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(h.dem&&h.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=h.tileID.overscaledZ;const y=sp.create(n,d,h);if(!y)return;this.modelTraits&ip.HasMapboxMeshFeatures&&this.updateDEM(n,y,d,g);for(const T of this.getNodesInfo()){const M=T.node;if(!M.footprint||!M.footprint.vertices||!M.footprint.vertices.length)continue;const D=M.footprint.vertices;let v=y.getElevationAt(D[0].x,D[0].y,!0,!0);for(let C=1;C<D.length;C++)v=Math.min(v,y.getElevationAt(D[C].x,D[C].y,!0,!0));M.elevation=v}}this.terrainTile=h.tileID.canonical,this.terrainExaggeration=a}}updateDEM(n,a,d,g){let h=a._dem._modifiedForSources[g];if(h===void 0&&(a._dem._modifiedForSources[g]=[],h=a._dem._modifiedForSources[g]),h.includes(d.canonical))return;const y=a._dem.dim;h.push(d.canonical);let T=!1;for(const M of this.getNodesInfo()){const D=M.node;if(!D.footprint||!D.footprint.grid)continue;const v=D.footprint.grid,C=a.tileCoordToPixel(v.min.x,v.min.y),I=a.tileCoordToPixel(v.max.x,v.max.y),P=Math.min(Math.min(y-I.y,C.x),Math.min(C.y,y-I.x));if(P<0)continue;const A=mn(P,2,5);let N=Math.max(0,C.x-A),j=Math.max(0,C.y-A),V=Math.min(I.x+A,y-1),X=Math.min(I.y+A,y-1);for(let ie=j;ie<=X;++ie)for(let ue=N;ue<=V;++ue)th[ie*y+ue]=255;let K=0,$=0;for(let ie=0;ie<v.cellsY;++ie)for(let ue=0;ue<v.cellsX;++ue){if(!v.cells[ie*v.cellsX+ue])continue;const pe=a.tileCoordToPixel(v.min.x+ue/v.xScale,v.min.y+ie/v.yScale),ge=a.tileCoordToPixel(v.min.x+(ue+1)/v.xScale,v.min.y+(ie+1)/v.yScale);for(let he=pe.y;he<=Math.min(ge.y+1,y-1);++he)for(let Se=pe.x;Se<=Math.min(ge.x+1,y-1);++Se)th[he*y+Se]===255&&(th[he*y+Se]=0,K+=a.getElevationAtPixel(Se,he),$++)}const ne=K/$;N=Math.max(1,C.x-A),j=Math.max(1,C.y-A),V=Math.min(I.x+A,y-2),X=Math.min(I.y+A,y-2),T=!0;for(let ie=j;ie<=X;++ie)for(let ue=N;ue<=V;++ue)th[ie*y+ue]===0&&(ES[ie*y+ue]=a._dem.set(ue,ie,ne));for(let ie=1;ie<A;++ie){N=Math.max(1,C.x-ie),j=Math.max(1,C.y-ie),V=Math.min(I.x+ie,y-2),X=Math.min(I.y+ie,y-2);for(let ue=j;ue<=X;++ue)for(let pe=N;pe<=V;++pe){const ge=ue*y+pe;if(th[ge]===255){let he=0,Se=0,_e=-1,Ce=-1;for(let Le=-1;Le<=1;++Le)for(let je=-1;je<=1;++je){const ze=(ue+Le)*y+pe+je;if(th[ze]>=ie)continue;const Fe=ES[ze],Ze=Math.abs(Fe);Ze>Se&&(he=Fe,Se=Ze,_e=je,Ce=Le)}if(Se>.1){const Le=1-(ie+.5*Math.abs(_e*Ce))/A;let je=a._dem.get(pe,ue)+he*Le;const ze=a._dem.get(pe+_e,ue+Ce),Fe=a._dem.get(pe-_e,ue-Ce,!0);(je-ze)*(je-Fe)>0&&(je=(ze+Fe)/2),ES[ge]=a._dem.set(pe,ue,je),th[ge]=ie}}}}}T&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=kt.now())}getNodesInfo(){return this.nodesInfo}destroy(){const n=this.getNodesInfo();for(const a of n)U0(a.node),TS(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(n,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const d=a.getReplacementRegionsForTile(n.toUnwrapped()),g=this.getNodesInfo();for(let h=0;h<this.nodesInfo.length;h++){const y=g[h].node;g[h].hiddenByReplacement=!!y.footprint&&!d.find(T=>T.footprint===y.footprint)}}getHeightAtTileCoord(n,a){const d=this.getNodesInfo(),g=[],h=[0,0,0],y=Ie.mat4.identity([]);for(let T=0;T<this.nodesInfo.length;T++){const M=d[T],D=M.node.meshes[0],v=D.transformedAabb;if(n<v.min[0]||a<v.min[1]||n>v.max[0]||a>v.max[1])continue;if(M.node.hidden===!0)return{height:1/0,maxHeight:M.feature.properties.height,hidden:!1,verticalScale:M.evaluatedScale[2]};Ie.mat4.invert(y,M.node.matrix),h[0]=n,h[1]=a,Ie.vec3.transformMat4(h,h,y);const C=(h[0]-D.aabb.min[0])/(D.aabb.max[0]-D.aabb.min[0])*eh|0,I=Math.min(63,(h[1]-D.aabb.min[1])/(D.aabb.max[1]-D.aabb.min[1])*eh|0)*eh+Math.min(63,C),P=D.heightmap[I];if(!(P<0&&M.node.footprint))return M.hiddenByReplacement?void 0:{height:P,maxHeight:M.feature.properties.height,hidden:!1,verticalScale:M.evaluatedScale[2]};if(M.node.footprint.grid.query(new Tt(n,a),new Tt(n,a),g),g.length>0)return{height:void 0,maxHeight:M.feature.properties.height,hidden:M.hiddenByReplacement,verticalScale:M.evaluatedScale[2]}}}}function ey(c,n){return!c.isLightConstant&&n}function N3(c,n,a,d,g,h,y,T){let M=(61440&n|(61440&n)>>4)>>8,D=(3840&n|(3840&n)>>4)>>4,v=240&n|(240&n)>>4;a[3]>0&&(M=Xt(M,255*a[0],a[3]),D=Xt(D,255*a[1],a[3]),v=Xt(v,255*a[2],a[3]));const C=M<<8|D,I=v<<8|Math.floor(255*d[3]),P=function(ie){const ue=mn(ie,0,2);return Math.min(Math.round(.5*ue*255),255)}(d[2])<<8|15*d[0]<<4|15*d[1],A=mn(g[0],0,1),N=mn(g[1],0,1),j=mn(g[2],0,1),V=mn(g[3],0,1);let X,K,$,ne;if(A!==N&&y!==h&&N!==A){const ie=y-h;K=1/(ie*(N-A)),$=-(h+ie*A)/(ie*(N-A));const ue=mn(g[4],-1,1);ne=Math.pow(10,ue),X=255*j<<8|255*V}else X=65535,K=0,$=1,ne=1;if(c.emplaceBack(C,I,P,X,K,$,ne),T){const ie=T.length;T.clear();for(let ue=0;ue<ie;ue++)T.emplaceBack(C,I,P,X,K,$,ne)}}function L3(c,n,a){const d=c.node;let g=0;const h=a&ip.HasMeshoptCompression;for(const y of d.meshes){if(d.lights&&d.lightMeshIndex===g||!y.featureData)continue;y.featureArray=new $f,y.featureArray.reserve(y.featureData.length);let T=n;for(const M of y.featureData){const D=h?65535&M:M>>16&65535,v=h?M>>16&65535:65535&M,C=(15&v)<8?15&v:0,I=c.evaluatedRMEA[C],P=c.evaluatedColor[C],A=c.emissionHeightBasedParams[C];let N;if(T&&C===2&&d.lights&&(N=new $f,N.resize(10*d.lights.length)),N3(y.featureArray,D,P,I,A,y.aabb.min[2],y.aabb.max[2],N),N&&T){T=!1;const j=d.meshes[d.lightMeshIndex];j.featureArray=N,j.featureArray._trim()}}y.featureArray._trim(),g++}}function yR(c,n,a,d){const g=1<<c.z;n.lat=ve((d/Mt+c.y)/g),n.lng=be((a/Mt+c.x)/g)}Ot($0,"Tiled3dModelBucket",{omit:["layers"]}),Ot(gR,"Tiled3dModelFeature");const O3={circle:class extends $i{constructor(c,n,a,d){super(c,{layout:Kn||(Kn=new Sr({"circle-sort-key":new Gt(We.layout_circle["circle-sort-key"]),visibility:new bt(We.layout_circle.visibility)})),paint:Lr||(Lr=new Sr({"circle-radius":new Gt(We.paint_circle["circle-radius"]),"circle-color":new Gt(We.paint_circle["circle-color"]),"circle-blur":new Gt(We.paint_circle["circle-blur"]),"circle-opacity":new Gt(We.paint_circle["circle-opacity"]),"circle-translate":new bt(We.paint_circle["circle-translate"]),"circle-translate-anchor":new bt(We.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new bt(We.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new bt(We.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gt(We.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gt(We.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gt(We.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new bt(We.paint_circle["circle-emissive-strength"])}))},n,a,d)}createBucket(c){return new Wt(c)}queryRadius(c){const n=c;return Tr("circle-radius",this,n)+Tr("circle-stroke-width",this,n)+ir(this.paint.get("circle-translate"))}queryIntersectsFeature(c,n,a,d,g,h,y,T){const M=Vn(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(n,a)+this.paint.get("circle-stroke-width").evaluate(n,a);return XA(c,d,h,y,T,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",M,D)}getProgramIds(){return["circle"]}getDefaultProgramParams(c,n,a){const d=ZA(this);return{config:new Bl(this,{zoom:n,lut:a}),defines:d,overrideFog:!1}}},heatmap:class extends $i{createBucket(c){return new KA(c)}constructor(c,n,a,d){super(c,{layout:JA||(JA=new Sr({visibility:new bt(We.layout_heatmap.visibility)})),paint:QA||(QA=new Sr({"heatmap-radius":new Gt(We.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gt(We.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new bt(We.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ho(We.paint_heatmap["heatmap-color"]),"heatmap-opacity":new bt(We.paint_heatmap["heatmap-opacity"])}))},n,a,d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=kg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(c){return Tr("heatmap-radius",this,c)}queryIntersectsFeature(c,n,a,d,g,h,y,T){const M=this.paint.get("heatmap-radius").evaluate(n,a);return XA(c,d,h,y,T,!0,!0,new Tt(0,0),M)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(c,n,a){return c==="heatmap"?{config:new Bl(this,{zoom:n,lut:a}),overrideFog:!1}:{}}},hillshade:class extends $i{constructor(c,n,a,d){super(c,{layout:eI||(eI=new Sr({visibility:new bt(We.layout_hillshade.visibility)})),paint:tI||(tI=new Sr({"hillshade-illumination-direction":new bt(We.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new bt(We.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new bt(We.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new bt(We.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new bt(We.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new bt(We.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new bt(We.paint_hillshade["hillshade-emissive-strength"])}))},n,a,d)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(c,n,a){return{overrideFog:!1}}},fill:class extends $i{constructor(c,n,a,d){super(c,{layout:cI||(cI=new Sr({"fill-sort-key":new Gt(We.layout_fill["fill-sort-key"]),visibility:new bt(We.layout_fill.visibility)})),paint:uI||(uI=new Sr({"fill-antialias":new bt(We.paint_fill["fill-antialias"]),"fill-opacity":new Gt(We.paint_fill["fill-opacity"]),"fill-color":new Gt(We.paint_fill["fill-color"]),"fill-outline-color":new Gt(We.paint_fill["fill-outline-color"]),"fill-translate":new bt(We.paint_fill["fill-translate"]),"fill-translate-anchor":new bt(We.paint_fill["fill-translate-anchor"]),"fill-pattern":new Gt(We.paint_fill["fill-pattern"]),"fill-emissive-strength":new bt(We.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Gt(We.paint_fill["fill-z-offset"])}))},n,a,d)}getProgramIds(){const c=this.paint.get("fill-pattern"),n=c&&c.constantOr(1),a=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(c,n,a){return{config:new Bl(this,{zoom:n,lut:a}),overrideFog:!1}}recalculate(c,n){super.recalculate(c,n);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new Uw(c)}queryRadius(){return ir(this.paint.get("fill-translate"))}queryIntersectsFeature(c,n,a,d,g,h){return!c.queryGeometry.isAboveHorizon&&Kt(_n(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),d)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends $i{constructor(c,n,a,d){super(c,{layout:WI||(WI=new Sr({visibility:new bt(We["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new bt(We["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:HI||(HI=new Sr({"fill-extrusion-opacity":new bt(We["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gt(We["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new bt(We["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new bt(We["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Gt(We["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Gt(We["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gt(We["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new bt(We["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new bt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new bt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new bt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new bt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new bt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new bt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new bt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Gt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Gt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new bt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new bt(We["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new bt(We["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new bt(We["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Gt(We["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Gt(We["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new bt(We["paint_fill-extrusion"]["fill-extrusion-cast-shadows"])}))},n,a,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new v0(c)}queryRadius(){return ir(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(c,n,a,d,g,h,y,T,M){const D=Vn(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),v=this.paint.get("fill-extrusion-height").evaluate(n,a),C=this.paint.get("fill-extrusion-base").evaluate(n,a),I=[0,0],P=T&&h.elevation,A=h.elevation?h.elevation.exaggeration():1,N=c.tile.getBucket(this);if(P&&N instanceof v0){const $=N.centroidVertexArray,ne=M+1;ne<$.length&&(I[0]=$.geta_centroid_pos0(ne),I[1]=$.geta_centroid_pos1(ne))}if(I[0]===0&&I[1]===1)return!1;h.projection.name==="globe"&&(d=GI([d],[new Tt(0,0),new Tt(Mt,Mt)],c.tileID.canonical).map($=>$.polygon).flat());const j=P?T:null,[V,X]=function($,ne,ie,ue,pe,ge,he,Se,_e,Ce,Le){return $.projection.name==="globe"?function(je,ze,Fe,Ze,Ve,rt,ct,Je,Dt,Pt,xt){const ht=[],Ht=[],At=je.projection.upVectorScale(xt,je.center.lat,je.worldSize).metersToTile,Lt=[0,0,0,1],nn=[0,0,0,1],xn=(pn,Sn,Tn,cr)=>{pn[0]=Sn,pn[1]=Tn,pn[2]=cr,pn[3]=1},fn=$I();Fe>0&&(Fe+=fn),Ze+=fn;for(const pn of ze){const Sn=[],Tn=[];for(const cr of pn){const Jn=cr.x+Ve.x,sn=cr.y+Ve.y,$n=je.projection.projectTilePoint(Jn,sn,xt),Wn=je.projection.upVector(xt,cr.x,cr.y);let _r=Fe,jr=Ze;if(ct){const qr=ZI(Jn,sn,Fe,Ze,ct,Je,Dt,Pt);_r+=qr.base,jr+=qr.top}Fe!==0?xn(Lt,$n.x+Wn[0]*At*_r,$n.y+Wn[1]*At*_r,$n.z+Wn[2]*At*_r):xn(Lt,$n.x,$n.y,$n.z),xn(nn,$n.x+Wn[0]*At*jr,$n.y+Wn[1]*At*jr,$n.z+Wn[2]*At*jr),Ie.vec3.transformMat4(Lt,Lt,rt),Ie.vec3.transformMat4(nn,nn,rt),Sn.push(new Qd(Lt[0],Lt[1],Lt[2])),Tn.push(new Qd(nn[0],nn[1],nn[2]))}ht.push(Sn),Ht.push(Tn)}return[ht,Ht]}($,ne,ie,ue,pe,ge,he,Se,_e,Ce,Le):he?function(je,ze,Fe,Ze,Ve,rt,ct,Je,Dt){const Pt=[],xt=[],ht=[0,0,0,1];for(const Ht of je){const At=[],Lt=[];for(const nn of Ht){const xn=nn.x+Ze.x,fn=nn.y+Ze.y,pn=ZI(xn,fn,ze,Fe,rt,ct,Je,Dt);ht[0]=xn,ht[1]=fn,ht[2]=pn.base,ht[3]=1,Ie.vec4.transformMat4(ht,ht,Ve),ht[3]=Math.max(ht[3],1e-5);const Sn=new Qd(ht[0]/ht[3],ht[1]/ht[3],ht[2]/ht[3]);ht[0]=xn,ht[1]=fn,ht[2]=pn.top,ht[3]=1,Ie.vec4.transformMat4(ht,ht,Ve),ht[3]=Math.max(ht[3],1e-5);const Tn=new Qd(ht[0]/ht[3],ht[1]/ht[3],ht[2]/ht[3]);At.push(Sn),Lt.push(Tn)}Pt.push(At),xt.push(Lt)}return[Pt,xt]}(ne,ie,ue,pe,ge,he,Se,_e,Ce):function(je,ze,Fe,Ze,Ve){const rt=[],ct=[],Je=Ve[8]*ze,Dt=Ve[9]*ze,Pt=Ve[10]*ze,xt=Ve[11]*ze,ht=Ve[8]*Fe,Ht=Ve[9]*Fe,At=Ve[10]*Fe,Lt=Ve[11]*Fe;for(const nn of je){const xn=[],fn=[];for(const pn of nn){const Sn=pn.x+Ze.x,Tn=pn.y+Ze.y,cr=Ve[0]*Sn+Ve[4]*Tn+Ve[12],Jn=Ve[1]*Sn+Ve[5]*Tn+Ve[13],sn=Ve[2]*Sn+Ve[6]*Tn+Ve[14],$n=Ve[3]*Sn+Ve[7]*Tn+Ve[15],Wn=cr+Je,_r=Jn+Dt,jr=sn+Pt,qr=Math.max($n+xt,1e-5),zr=cr+ht,Mr=Jn+Ht,wi=sn+At,ti=Math.max($n+Lt,1e-5);xn.push(new Qd(Wn/qr,_r/qr,jr/qr)),fn.push(new Qd(zr/ti,Mr/ti,wi/ti))}rt.push(xn),ct.push(fn)}return[rt,ct]}(ne,ie,ue,pe,ge)}(h,d,C,v,D,y,j,I,A,h.center.lat,c.tileID.canonical),K=c.queryGeometry;return function($,ne,ie){let ue=1/0;Kt(ie,ne)&&(ue=qI(ie,ne[0]));for(let pe=0;pe<ne.length;pe++){const ge=ne[pe],he=$[pe];for(let Se=0;Se<ge.length-1;Se++){const _e=ge[Se],Ce=[_e,ge[Se+1],he[Se+1],he[Se],_e];Ct(ie,Ce)&&(ue=Math.min(ue,qI(ie,Ce)))}}return ue!==1/0&&ue}(V,X,K.isPointQuery()?K.screenBounds:K.screenGeometry)}},line:class extends $i{constructor(c,n,a,d){const g=iD();super(c,g,n,a,d),g.layout&&(this.layout=new Kc(g.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof Dd,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(c,n){super.recalculate(c,n),this.paint._values["line-floorwidth"]=(()=>{if(Ug)return Ug;const a=iD();return Ug=new FU(a.paint.properties["line-width"].specification),Ug.useIntegerZoom=!0,Ug})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new Jw(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(c,n,a){const d=nD(this);return{config:new Bl(this,{zoom:n,lut:a}),defines:d,overrideFog:!1}}queryRadius(c){const n=c,a=sD(Tr("line-width",this,n),Tr("line-gap-width",this,n)),d=Tr("line-offset",this,n);return a/2+Math.abs(d)+ir(this.paint.get("line-translate"))}queryIntersectsFeature(c,n,a,d,g,h){if(c.queryGeometry.isAboveHorizon)return!1;const y=_n(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),T=c.pixelToTileUnitsFactor/2*sD(this.paint.get("line-width").evaluate(n,a),this.paint.get("line-gap-width").evaluate(n,a)),M=this.paint.get("line-offset").evaluate(n,a);return M&&(d=function(D,v){const C=[],I=new Tt(0,0);for(let P=0;P<D.length;P++){const A=D[P],N=[];for(let j=0;j<A.length;j++){const V=A[j],X=A[j+1],K=j===0?I:V.sub(A[j-1])._unit()._perp(),$=j===A.length-1?I:X.sub(V)._unit()._perp(),ne=K._add($)._unit();ne._mult(1/(ne.x*$.x+ne.y*$.y)),N.push(ne._mult(v)._add(V))}C.push(N)}return C}(d,M*c.pixelToTileUnitsFactor)),function(D,v,C){for(let I=0;I<v.length;I++){const P=v[I];if(D.length>=3){for(let A=0;A<P.length;A++)if(yr(D,P[A]))return!0}if(Bt(D,P,C))return!0}return!1}(y,d,T)}isTileClipped(){return!0}isDraped(c){const n=this.layout.get("line-z-offset");return n.isConstant()&&!n.constantOr(0)}},symbol:L0,background:class extends $i{constructor(c,n,a,d){super(c,{layout:UD||(UD=new Sr({visibility:new bt(We.layout_background.visibility)})),paint:$D||($D=new Sr({"background-pitch-alignment":new bt(We.paint_background["background-pitch-alignment"]),"background-color":new bt(We.paint_background["background-color"]),"background-pattern":new bt(We.paint_background["background-pattern"]),"background-opacity":new bt(We.paint_background["background-opacity"]),"background-emissive-strength":new bt(We.paint_background["background-emissive-strength"])}))},n,a,d)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(c,n,a){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:ZD,"raster-particle":eR,sky:class extends $i{constructor(c,n,a,d){super(c,{layout:KD||(KD=new Sr({visibility:new bt(We.layout_sky.visibility)})),paint:JD||(JD=new Sr({"sky-type":new bt(We.paint_sky["sky-type"]),"sky-atmosphere-sun":new bt(We.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new bt(We.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new bt(We.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new bt(We.paint_sky["sky-gradient-radius"]),"sky-gradient":new ho(We.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new bt(We.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new bt(We.paint_sky["sky-atmosphere-color"]),"sky-opacity":new bt(We.paint_sky["sky-opacity"])}))},n,a,d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=kg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(c,n){if(this.paint.get("sky-type")==="atmosphere"){const d=this.paint.get("sky-atmosphere-sun"),g=!d,h=c.style.light,y=h.properties.get("position");return g&&h.properties.get("anchor")==="viewport"&&zn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),g?xS(y.azimuthal,90-y.polar,n):xS(d[0],90-d[1],n)}const a=this.paint.get("sky-gradient-center");return xS(a[0],90-a[1],n)}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}},slot:class extends $i{constructor(c,n,a,d){super(c,{paint:QD||(QD=new Sr({}))},n,null)}},model:class extends $i{constructor(c,n,a,d){super(c,{layout:uR||(uR=new Sr({visibility:new bt(We.layout_model.visibility),"model-id":new Gt(We.layout_model["model-id"])})),paint:dR||(dR=new Sr({"model-opacity":new bt(We.paint_model["model-opacity"]),"model-rotation":new Gt(We.paint_model["model-rotation"]),"model-scale":new Gt(We.paint_model["model-scale"]),"model-translation":new Gt(We.paint_model["model-translation"]),"model-color":new Gt(We.paint_model["model-color"]),"model-color-mix-intensity":new Gt(We.paint_model["model-color-mix-intensity"]),"model-type":new bt(We.paint_model["model-type"]),"model-cast-shadows":new bt(We.paint_model["model-cast-shadows"]),"model-receive-shadows":new bt(We.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new bt(We.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Gt(We.paint_model["model-emissive-strength"]),"model-roughness":new Gt(We.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Gt(We.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new bt(We.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new bt(We.paint_model["model-front-cutoff"])}))},n,a,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new wS(c)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(c){return c instanceof $0?Mt-1:0}queryIntersectsFeature(c,n,a,d,g,h){if(!this.modelManager)return!1;const y=this.modelManager,T=c.tile.getBucket(this);if(!(T&&T instanceof wS))return!1;const M=T;for(const D in M.instancesPerModel){const v=M.instancesPerModel[D],C=n.id!==void 0?n.id:n.properties&&n.properties.hasOwnProperty("id")?n.properties.id:void 0;if(v.idToFeaturesIndex.hasOwnProperty(C)){const I=v.features[v.idToFeaturesIndex[C]],P=y.getModel(D,this.scope);if(!P)return!1;let A=Ie.mat4.create();const N=new Y(0,0),j=M.canonical;let V=Number.MAX_VALUE;for(let X=0;X<I.instancedDataCount;++X){const K=16*(I.instancedDataOffset+X),$=v.instancedDataArray.float32,ne=[$[K+4],$[K+5],$[K+6]];yR(j,N,$[K],0|$[K+1]),hR(A,P,h,N,I.rotation,I.scale,ne,!1,!1,!1),h.projection.name==="globe"&&(A=bS(A,h));const ie=Ie.mat4.multiply([],h.projMatrix,A),ue=c.queryGeometry,pe=sR(ue.isPointQuery()?ue.screenBounds:ue.screenGeometry,h,ie,P.aabb);pe!=null&&(V=Math.min(pe,V))}return V!==Number.MAX_VALUE&&V}}return!1}_handleOverridablePaintPropertyUpdate(c,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven()||c!=="model-color"&&c!=="model-color-mix-intensity"&&c!=="model-rotation"&&c!=="model-scale"&&c!=="model-translation"&&c!=="model-emissive-strength")}_isPropertyZoomDependent(c){const n=this._transitionablePaint._values[c];return n!=null&&n.value!=null&&n.value.expression!=null&&n.value.expression instanceof Fo}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(c,n,a,d){const g=c.tile,h=g.getBucket(this);let y=null,T=Number.MAX_VALUE;if(!(h&&h instanceof $0))return{queryFeature:y,intersectionZ:T};const M=h.getNodesInfo()[n];if(M.hiddenByReplacement||!M.node.meshes||!a.filter(new kr(g.tileID.overscaledZ),M.feature,g.tileID.canonical))return{queryFeature:y,intersectionZ:T};const D=M.node,v=d.calculatePosMatrix(g.tileID.toUnwrapped(),d.worldSize),C=M.evaluatedScale;let I=0;d.elevation&&D.elevation&&(I=D.elevation*d.elevation.exaggeration()),Ie.mat4.translate(v,v,[(D.anchor?D.anchor[0]:0)*(C[0]-1),(D.anchor?D.anchor[1]:0)*(C[1]-1),I]),Ie.mat4.scale(v,v,C),Ie.mat4.multiply(v,v,D.matrix);const P=c.queryGeometry,A=P.isPointQuery()?P.screenBounds:P.screenGeometry,N=function(V){const X=Ie.mat4.multiply([],v,V.matrix),K=Ie.mat4.multiply(X,d.expandedFarZProjMatrix,X);for(let $=0;$<V.meshes.length;++$){const ne=V.meshes[$];if($===V.lightMeshIndex)continue;const ie=sR(A,d,K,ne.aabb);ie!=null&&(T=Math.min(ie,T))}if(V.children)for(const $ of V.children)N($)};if(N(D),T===Number.MAX_VALUE)return{queryFeature:y,intersectionZ:T};const j=new Y(0,0);return yR(g.tileID.canonical,j,M.node.anchor[0],M.node.anchor[1]),y={type:"Feature",geometry:{type:"Point",coordinates:[j.lng,j.lat]},properties:M.feature.properties,id:M.feature.id,state:{},layer:this.serialize()},{queryFeature:y,intersectionZ:T}}},clip:class extends $i{constructor(c,n,a,d){super(c,{layout:dI||(dI=new Sr({"clip-layer-types":new bt(We.layout_clip["clip-layer-types"]),"clip-layer-scope":new bt(We.layout_clip["clip-layer-scope"])})),paint:hI||(hI=new Sr({}))},n,a,d)}recalculate(c,n){super.recalculate(c,n)}createBucket(c){return new fI(c)}isTileClipped(){return!0}is3D(){return!0}}};class j3{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class z3{constructor(){this.tasks={},this.taskQueue=[],bc(["process"],this),this.invoker=new j3(this.process),this.nextId=0}add(n,a){const d=this.nextId++,g=function({type:h,isSymbolTile:y,zoom:T}){return T=T||0,h==="message"?0:h!=="maybePrepare"||y?h!=="parseTile"||y?h==="parseTile"&&y?300-T:h==="maybePrepare"&&y?400-T:500:200-T:100-T}(a);if(g===0){try{n()}finally{}return null}return this.tasks[d]={fn:n,metadata:a,priority:g,id:d},this.taskQueue.push(d),this.invoker.trigger(),{cancel:()=>{delete this.tasks[d]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(d=>!!this.tasks[d]),!this.taskQueue.length)return;const n=this.pick();if(n===null)return;const a=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let n=null,a=1/0;for(let g=0;g<this.taskQueue.length;g++){const h=this.tasks[this.taskQueue[g]];h.priority<a&&(a=h.priority,n=g)}if(n===null)return null;const d=this.taskQueue[n];return this.taskQueue.splice(n,1),d}remove(){this.invoker.remove()}}class _R{constructor(n,a,d){this.target=n,this.parent=a,this.mapId=d,this.callbacks={},this.cancelCallbacks={},bc(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new z3}send(n,a,d,g,h=!1,y){const T=Math.round(1e18*Math.random()).toString(36).substring(0,10);d&&(d.metadata=y,this.callbacks[T]=d);const M=new Set;return this.target.postMessage({id:T,type:n,hasCallback:!!d,targetMapId:g,mustQueue:h,sourceMapId:this.mapId,data:ds(a,M)},M),{cancel:()=>{d&&delete this.callbacks[T],this.target.postMessage({id:T,type:"<cancel>",targetMapId:g,sourceMapId:this.mapId})}}}receive(n){const a=n.data,d=a.id;if(d&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){const g=this.cancelCallbacks[d];delete this.cancelCallbacks[d],g&&g.cancel()}else if(a.mustQueue||Cl()){const g=this.callbacks[d],h=this.scheduler.add(()=>this.processTask(d,a),g&&g.metadata||{type:"message"});h&&(this.cancelCallbacks[d]=h)}else this.processTask(d,a)}processTask(n,a){if(delete this.cancelCallbacks[n],a.type==="<response>"){const d=this.callbacks[n];delete this.callbacks[n],d&&(a.error?d(Ll(a.error)):d(null,Ll(a.data)))}else{const d=new Set,g=a.hasCallback?(y,T)=>{this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:y?ds(y):null,data:ds(T,d)},d)}:y=>{},h=Ll(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,h,g);else if(this.parent.getWorkerSource){const y=a.type.split(".");this.parent.getWorkerSource(a.sourceMapId,y[0],h.source,h.scope)[y[1]](h,g)}else g(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class op{constructor(n,a){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=pd();const d=this.workerPool.acquire(this.id);for(let g=0;g<d.length;g++){const h=new op.Actor(d[g],a,this.id);h.name=`Worker ${g}`,this.actors.push(h)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,a,d){Tl(this.actors,(g,h)=>{g.send(n,a,h)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}op.Actor=_R;class xR{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,a){const d=this.toIdx(n,a);return{min:this.minimums[d],max:this.maximums[d]}}isLeaf(n,a){return this.leaves[this.toIdx(n,a)]}toIdx(n,a){return a*this.size+n}}function vR(c,n,a,d){let g=0,h=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(d[y])<1e-15){if(a[y]<c[y]||a[y]>n[y])return null}else{const T=1/d[y];let M=(c[y]-a[y])*T,D=(n[y]-a[y])*T;if(M>D){const v=M;M=D,D=v}if(M>g&&(g=M),D<h&&(h=D),g>h)return null}return g}function bR(c,n,a,d,g,h,y,T,M,D,v){const C=d-c,I=g-n,P=h-a,A=y-c,N=T-n,j=M-a,V=v[1]*j-v[2]*N,X=v[2]*A-v[0]*j,K=v[0]*N-v[1]*A,$=C*V+I*X+P*K;if(Math.abs($)<1e-15)return null;const ne=1/$,ie=D[0]-c,ue=D[1]-n,pe=D[2]-a,ge=(ie*V+ue*X+pe*K)*ne;if(ge<0||ge>1)return null;const he=ue*P-pe*I,Se=pe*C-ie*P,_e=ie*I-ue*C,Ce=(v[0]*he+v[1]*Se+v[2]*_e)*ne;return Ce<0||ge+Ce>1?null:(A*he+N*Se+j*_e)*ne}function wR(c,n,a){return(c-n)/(a-n)}function SR(c,n,a,d,g,h,y,T,M){const D=1<<a,v=h-d,C=y-g,I=(c+1)/D*v+d,P=(n+0)/D*C+g,A=(n+1)/D*C+g;T[0]=(c+0)/D*v+d,T[1]=P,M[0]=I,M[1]=A}class TR{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(h){const y=Math.ceil(Math.log2(h.dim/8)),T=[];let M=Math.ceil(Math.pow(2,y));const D=1/M,v=(P,A,N,j,V)=>{const X=j?1:0,K=(P+1)*N-X,$=A*N,ne=(A+1)*N-X;V[0]=P*N,V[1]=$,V[2]=K,V[3]=ne};let C=new xR(M);const I=[];for(let P=0;P<M*M;P++){v(P%M,Math.floor(P/M),D,!1,I);const A=mu(I[0],I[1],h),N=mu(I[2],I[1],h),j=mu(I[2],I[3],h),V=mu(I[0],I[3],h);C.minimums.push(Math.min(A,N,j,V)),C.maximums.push(Math.max(A,N,j,V)),C.leaves.push(1)}for(T.push(C),M/=2;M>=1;M/=2){const P=T[T.length-1];C=new xR(M);for(let A=0;A<M*M;A++){v(A%M,Math.floor(A/M),2,!0,I);const N=P.getElevation(I[0],I[1]),j=P.getElevation(I[2],I[1]),V=P.getElevation(I[2],I[3]),X=P.getElevation(I[0],I[3]),K=P.isLeaf(I[0],I[1]),$=P.isLeaf(I[2],I[1]),ne=P.isLeaf(I[2],I[3]),ie=P.isLeaf(I[0],I[3]),ue=Math.min(N.min,j.min,V.min,X.min),pe=Math.max(N.max,j.max,V.max,X.max),ge=K&&$&&ne&&ie;C.maximums.push(pe),C.minimums.push(ue),C.leaves.push(pe-ue<=5&&ge?1:0)}T.push(C)}return T}(this.dem),d=a.length-1,g=a[d];this._addNode(g.minimums[0],g.maximums[0],g.leaves[0]),this._construct(a,0,0,d,0)}raycastRoot(n,a,d,g,h,y,T=1){return vR([n,a,-100],[d,g,this.maximums[0]*T],h,y)}raycast(n,a,d,g,h,y,T=1){if(!this.nodeCount)return null;const M=this.raycastRoot(n,a,d,g,h,y,T);if(M==null)return null;const D=[],v=[],C=[],I=[],P=[{idx:0,t:M,nodex:0,nodey:0,depth:0}];for(;P.length>0;){const{idx:A,t:N,nodex:j,nodey:V,depth:X}=P.pop();if(this.leaves[A]){SR(j,V,X,n,a,d,g,C,I);const $=1<<X,ne=(j+0)/$,ie=(j+1)/$,ue=(V+0)/$,pe=(V+1)/$,ge=mu(ne,ue,this.dem)*T,he=mu(ie,ue,this.dem)*T,Se=mu(ie,pe,this.dem)*T,_e=mu(ne,pe,this.dem)*T,Ce=bR(C[0],C[1],ge,I[0],C[1],he,I[0],I[1],Se,h,y),Le=bR(I[0],I[1],Se,C[0],I[1],_e,C[0],C[1],ge,h,y),je=Math.min(Ce!==null?Ce:Number.MAX_VALUE,Le!==null?Le:Number.MAX_VALUE);if(je!==Number.MAX_VALUE)return je;{const ze=Ie.vec3.scaleAndAdd([],h,y,N);if(ER(ge,he,_e,Se,wR(ze[0],C[0],I[0]),wR(ze[1],C[1],I[1]))>=ze[2])return N}continue}let K=0;for(let $=0;$<this._siblingOffset.length;$++){SR((j<<1)+this._siblingOffset[$][0],(V<<1)+this._siblingOffset[$][1],X+1,n,a,d,g,C,I),C[2]=-100,I[2]=this.maximums[this.childOffsets[A]+$]*T;const ne=vR(C,I,h,y);if(ne!=null){const ie=ne;D[$]=ie;let ue=!1;for(let pe=0;pe<K&&!ue;pe++)ie>=D[v[pe]]&&(v.splice(pe,0,$),ue=!0);ue||(v[K]=$),K++}}for(let $=0;$<K;$++){const ne=v[$];P.push({idx:this.childOffsets[A]+ne,t:D[ne],nodex:(j<<1)+this._siblingOffset[ne][0],nodey:(V<<1)+this._siblingOffset[ne][1],depth:X+1})}}return null}_addNode(n,a,d){return this.minimums.push(n),this.maximums.push(a),this.leaves.push(d),this.childOffsets.push(0),this.nodeCount++}_construct(n,a,d,g,h){if(n[g].isLeaf(a,d)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const y=g-1,T=n[y];let M=0,D=0;for(let v=0;v<this._siblingOffset.length;v++){const C=2*a+this._siblingOffset[v][0],I=2*d+this._siblingOffset[v][1],P=T.getElevation(C,I),A=T.isLeaf(C,I),N=this._addNode(P.min,P.max,A);A&&(M|=1<<v),D||(D=N)}for(let v=0;v<this._siblingOffset.length;v++)M&1<<v||this._construct(n,2*a+this._siblingOffset[v][0],2*d+this._siblingOffset[v][1],y,D+v)}}function ER(c,n,a,d,g,h){return Xt(Xt(c,a,h),Xt(n,d,h),g)}function mu(c,n,a){const d=a.dim,g=mn(c*d-.5,0,d-1),h=mn(n*d-.5,0,d-1),y=Math.floor(g),T=Math.floor(h),M=Math.min(y+1,d-1),D=Math.min(T+1,d-1);return ER(a.get(y,T),a.get(M,T),a.get(y,D),a.get(M,D),g-y,h-T)}const F3={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function B3(c,n,a){return(256*c*256+256*n+a)/10-1e4}function V3(c,n,a){return 256*c+n+a/256-32768}class G0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,a,d,g=!1){if(this.uid=n,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(d&&d!=="mapbox"&&d!=="terrarium")return void zn(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const h=this.dim=a.height-2,y=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=g,this._modifiedForSources={},!g){for(let M=0;M<h;M++)y[this._idx(-1,M)]=y[this._idx(0,M)],y[this._idx(h,M)]=y[this._idx(h-1,M)],y[this._idx(M,-1)]=y[this._idx(M,0)],y[this._idx(M,h)]=y[this._idx(M,h-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(h,-1)]=y[this._idx(h-1,0)],y[this._idx(-1,h)]=y[this._idx(0,h-1)],y[this._idx(h,h)]=y[this._idx(h-1,h-1)]}const T=d==="terrarium"?V3:B3;for(let M=0;M<y.length;++M){const D=4*M;this.floatView[M]=T(this.pixels[D],this.pixels[D+1],this.pixels[D+2])}this._timestamp=kt.now()}_buildQuadTree(){this._tree=new TR(this)}get(n,a,d=!1){d&&(n=mn(n,-1,this.dim),a=mn(a,-1,this.dim));const g=this._idx(n,a);return this.floatView[g]}set(n,a,d){const g=this._idx(n,a),h=this.floatView[g];return this.floatView[g]=d,d-h}static getUnpackVector(n){return F3[n]}_idx(n,a){if(n<-1||n>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(n+1)}static pack(n,a){const d=[0,0,0,0],g=G0.getUnpackVector(a);let h=Math.floor((n+g[3])/g[2]);return d[2]=h%256,h=Math.floor(h/256),d[1]=h%256,h=Math.floor(h/256),d[0]=h,d}getPixels(){return new iI({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,a,d){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let g=a*this.dim,h=a*this.dim+this.dim,y=d*this.dim,T=d*this.dim+this.dim;switch(a){case-1:g=h-1;break;case 1:h=g+1}switch(d){case-1:y=T-1;break;case 1:T=y+1}const M=-a*this.dim,D=-d*this.dim;for(let v=y;v<T;v++)for(let C=g;C<h;C++){const I=4*this._idx(C,v),P=4*this._idx(C+M,v+D);this.pixels[I+0]=n.pixels[P+0],this.pixels[I+1]=n.pixels[P+1],this.pixels[I+2]=n.pixels[P+2],this.pixels[I+3]=n.pixels[P+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function U3(c,n,a){c===1?n.header_length=a.readFixed32():c===2?n.x=a.readVarint():c===3?n.y=a.readVarint():c===4?n.z=a.readVarint():c===5&&n.layers.push(function(d,g){return d.readFields(q3,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},g)}(a,a.readVarint()+a.pos))}function $3(c,n,a){c===1?(n.delta_filter=function(d,g){return d.readFields(G3,{block_size:0},g)}(a,a.readVarint()+a.pos),n.filter="delta_filter"):c===2?(a.readVarint(),n.filter="zigzag_filter"):c===3?(a.readVarint(),n.filter="bitshuffle_filter"):c===4&&(a.readVarint(),n.filter="byteshuffle_filter")}function G3(c,n,a){c===1&&(n.block_size=a.readVarint())}function W3(c,n,a){c===1?(a.readVarint(),n.codec="gzip_data"):c===2?(a.readVarint(),n.codec="jpeg_image"):c===3?(a.readVarint(),n.codec="webp_image"):c===4&&(a.readVarint(),n.codec="png_image")}function H3(c,n,a){c===1?n.first_byte=a.readFixed64():c===2?n.last_byte=a.readFixed64():c===3?n.filters.push(function(d,g){return d.readFields($3,{},g)}(a,a.readVarint()+a.pos)):c===4?n.codec=function(d,g){return d.readFields(W3,{},g)}(a,a.readVarint()+a.pos):c===5?n.deprecated_offset=a.readFloat():c===6?n.deprecated_scale=a.readFloat():c===7?n.bands.push(a.readString()):c===8?n.offset=a.readDouble():c===9&&(n.scale=a.readDouble())}function q3(c,n,a){c===1?n.version=a.readVarint():c===2?n.name=a.readString():c===3?n.units=a.readString():c===4?n.tilesize=a.readVarint():c===5?n.buffer=a.readVarint():c===6?n.pixel_format=a.readVarint():c===7&&n.data_index.push(function(d,g){return d.readFields(H3,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},g)}(a,a.readVarint()+a.pos))}function Z3(c,n,a){if(c===2)(function(d,g,h){d.readFields(X3,h,g)})(a,a.readVarint()+a.pos,n);else if(c===3)throw new Error("Not implemented")}function X3(c,n,a){if(c===1){let d=0;const g=a.readVarint()+a.pos;for(;a.pos<g;)n[d++]=a.readVarint()}}Ot(G0,"DEMData"),Ot(TR,"DemMinMaxQuadTree",{omit:["dem"]});class Y3{constructor(n){this.capacity=n,this.cache=new Map}get(n){if(!this.cache.has(n))return;const a=this.cache.get(n);return this.cache.delete(n),this.cache.set(n,a),a}put(n,a){this.cache.has(n)?this.cache.delete(n):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(n,a)}}function K3(c,n){if(n.length!==4)throw new Error(`Expected data of dimension 4 but got ${n.length}.`);let a=n[3];for(let d=2;d>=1;d--){const g=d===1?1:0,h=d===2?1:0;for(let y=0;y<n[0];y++){const T=n[1]*y;for(let M=g;M<n[1];M++){const D=n[2]*(M+T);for(let v=h;v<n[2];v++){const C=n[3]*(v+D);for(let I=0;I<n[3];I++){const P=C+I;c[P]+=c[P-a]}}}}a*=n[d]}return c}function J3(c){for(let n=0,a=c.length;n<a;n++)c[n]=c[n]>>>1^-(1&c[n]);return c}function Q3(c,n){switch(n){case"uint32":return c;case"uint16":for(let a=0;a<c.length;a+=2){const d=c[a],g=c[a+1];c[a]=(240&d)>>4|(61440&d)>>8|(240&g)<<4|61440&g,c[a+1]=15&d|(3840&d)>>4|(15&g)<<8|(3840&g)<<4}return c;case"uint8":for(let a=0;a<c.length;a+=4){const d=c[a],g=c[a+1],h=c[a+2],y=c[a+3];c[a+0]=(192&d)>>6|(192&g)>>4|(192&h)>>2|192&y,c[a+1]=(48&d)>>4|(48&g)>>2|48&h|(48&y)<<2,c[a+2]=(12&d)>>2|12&g|(12&h)<<2|(12&y)<<4,c[a+3]=3&d|(3&g)<<2|(3&h)<<4|(3&y)<<6}return c;default:throw new Error(`Invalid pixel format, "${n}"`)}}var go=Uint8Array,ty=Uint16Array,e$=Int32Array,CR=new go([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),PR=new go([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),t$=new go([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),MR=function(c,n){for(var a=new ty(31),d=0;d<31;++d)a[d]=n+=1<<c[d-1];var g=new e$(a[30]);for(d=1;d<30;++d)for(var h=a[d];h<a[d+1];++h)g[h]=h-a[d]<<5|d;return{b:a,r:g}},AR=MR(CR,2),IR=AR.b,n$=AR.r;IR[28]=258,n$[258]=28;for(var r$=MR(PR,0).b,DR=new ty(32768),Hr=0;Hr<32768;++Hr){var ap=(43690&Hr)>>1|(21845&Hr)<<1;DR[Hr]=((65280&(ap=(61680&(ap=(52428&ap)>>2|(13107&ap)<<2))>>4|(3855&ap)<<4))>>8|(255&ap)<<8)>>1}var ny=function(c,n,a){for(var d=c.length,g=0,h=new ty(n);g<d;++g)c[g]&&++h[c[g]-1];var y,T=new ty(n);for(g=1;g<n;++g)T[g]=T[g-1]+h[g-1]<<1;y=new ty(1<<n);var M=15-n;for(g=0;g<d;++g)if(c[g])for(var D=g<<4|c[g],v=n-c[g],C=T[c[g]-1]++<<v,I=C|(1<<v)-1;C<=I;++C)y[DR[C]>>M]=D;return y},ry=new go(288);for(Hr=0;Hr<144;++Hr)ry[Hr]=8;for(Hr=144;Hr<256;++Hr)ry[Hr]=9;for(Hr=256;Hr<280;++Hr)ry[Hr]=7;for(Hr=280;Hr<288;++Hr)ry[Hr]=8;var RR=new go(32);for(Hr=0;Hr<32;++Hr)RR[Hr]=5;var i$=ny(ry,9),s$=ny(RR,5),CS=function(c){for(var n=c[0],a=1;a<c.length;++a)c[a]>n&&(n=c[a]);return n},Sa=function(c,n,a){var d=n/8|0;return(c[d]|c[d+1]<<8)>>(7&n)&a},PS=function(c,n){var a=n/8|0;return(c[a]|c[a+1]<<8|c[a+2]<<16)>>(7&n)},o$=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ta=function(c,n,a){var d=new Error(n||o$[c]);if(d.code=c,Error.captureStackTrace&&Error.captureStackTrace(d,Ta),!a)throw d;return d},a$=new go(0),l$=typeof TextDecoder<"u"&&new TextDecoder;try{l$.decode(a$,{stream:!0})}catch{}const c$={gzip_data:"gzip"};class Go extends Error{constructor(n){super(n),this.name="MRTError"}}const u$={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},kR={uint32:1,uint16:2,uint8:4},d$={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let MS;class AS{constructor(n=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=n}getLayer(n){const a=this.layers[n];if(!a)throw new Go(`Layer '${n}' not found`);return a}getHeaderLength(n){const a=new Uint8Array(n),d=new DataView(n);if(a[0]!==13)throw new Go("File is not a valid MRT.");return d.getUint32(1,!0)}parseHeader(n){const a=new Uint8Array(n),d=this.getHeaderLength(n);if(a.length<d)throw new Go(`Expected header with length >= ${d} but got buffer of length ${a.length}`);const g=function(h,y){return h.readFields(U3,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new MS(a.subarray(0,d)));if(!isNaN(this.x)&&(this.x!==g.x||this.y!==g.y||this.z!==g.z))throw new Go(`Invalid attempt to parse header ${g.z}/${g.x}/${g.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=g.x,this.y=g.y,this.z=g.z;for(const h of g.layers)this.layers[h.name]=new h$(h,{cacheSize:this._cacheSize});return this}createDecodingTask(n){const a=[],d=this.getLayer(n.layerName);for(let g of n.blockIndices){const h=d.dataIndex[g],y=h.first_byte-n.firstByte,T=h.last_byte-n.firstByte;if(d._blocksInProgress.has(g))continue;const M={layerName:d.name,firstByte:y,lastByte:T,pixelFormat:d.pixelFormat,blockIndex:g,blockShape:[h.bands.length].concat(d.bandShape),buffer:d.buffer,codec:h.codec.codec,filters:h.filters.map(D=>D.filter)};d._blocksInProgress.add(g),a.push(M)}return new NR(a,()=>{a.forEach(g=>d._blocksInProgress.delete(g.blockIndex))},(g,h)=>{if(a.forEach(y=>d._blocksInProgress.delete(y.blockIndex)),g)throw g;h.forEach(y=>{this.getLayer(y.layerName).processDecodedData(y)})})}}class h${constructor({version:n,name:a,units:d,tilesize:g,pixel_format:h,buffer:y,data_index:T},M){if(this.version=n,this.version!==1)throw new Go(`Cannot parse raster layer encoded with MRT version ${n}`);this.name=a,this.units=d,this.tileSize=g,this.buffer=y,this.pixelFormat=u$[h],this.dataIndex=T,this.bandShape=[g+2*y,g+2*y,kR[this.pixelFormat]],this._decodedBlocks=new Y3(M?M.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return kR[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:n})=>n).flat()}processDecodedData(n){const a=n.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,n.data)}getBlockForBand(n){let a=0;switch(typeof n){case"string":for(const[d,g]of this.dataIndex.entries()){for(const[h,y]of g.bands.entries())if(y===n)return{bandIndex:a+h,blockIndex:d,blockBandIndex:h};a+=g.bands.length}break;case"number":for(const[d,g]of this.dataIndex.entries()){if(n>=a&&n<a+g.bands.length)return{bandIndex:n,blockIndex:d,blockBandIndex:n-a};a+=g.bands.length}break;default:throw new Go(`Invalid band \`${JSON.stringify(n)}\`. Expected string or integer.`)}throw new Go(`Band not found: ${JSON.stringify(n)}`)}getDataRange(n){let a=1/0,d=-1/0;const g=[],h=new Set;for(const y of n){const{blockIndex:T}=this.getBlockForBand(y);if(T<0)throw new Go(`Invalid band: ${JSON.stringify(y)}`);const M=this.dataIndex[T];g.includes(T)||g.push(T),h.add(T),a=Math.min(a,M.first_byte),d=Math.max(d,M.last_byte)}if(h.size>this.cacheSize)throw new Go(`Number of blocks to decode (${h.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:d,blockIndices:g}}hasBand(n){const{blockIndex:a}=this.getBlockForBand(n);return a>=0}hasDataForBand(n){const{blockIndex:a}=this.getBlockForBand(n);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(n){const{blockIndex:a,blockBandIndex:d}=this.getBlockForBand(n),g=this._decodedBlocks.get(a.toString());if(!g)throw new Go(`Data for band ${JSON.stringify(n)} of layer "${this.name}" not decoded.`);const h=this.dataIndex[a],y=this.bandShape.reduce((D,v)=>D*v,1),T=d*y,M=g.subarray(T,T+y);return{data:M,bytes:new Uint8Array(M.buffer).subarray(M.byteOffset,M.byteOffset+M.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:h.offset!==0?h.offset:h.deprecated_offset,scale:h.scale!==0?h.scale:h.deprecated_scale}}}AS.setPbf=function(c){MS=c};class NR{constructor(n,a,d){this.tasks=n,this._onCancel=a,this._onComplete=d,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(n,a){this._finalized||(this._onComplete(n,a),this._finalized=!0)}}AS.performDecoding=function(c,n){const a=new Uint8Array(c);return Promise.all(n.tasks.map(d=>{const{layerName:g,firstByte:h,lastByte:y,pixelFormat:T,blockShape:M,blockIndex:D,filters:v,codec:C}=d,I=a.subarray(h,y+1),P=new Uint32Array(M[0]*M[1]*M[2]);let A;if(C!=="gzip_data")throw new Go(`Unhandled codec: ${C}`);return A=function(N,j){if(!globalThis.DecompressionStream&&j==="gzip_data")return Promise.resolve((($=function(ue){ue[0]==31&&ue[1]==139&&ue[2]==8||Ta(6,"invalid gzip data");var pe=ue[3],ge=10;4&pe&&(ge+=2+(ue[10]|ue[11]<<8));for(var he=(pe>>3&1)+(pe>>4&1);he>0;he-=!ue[ge++]);return ge+(2&pe)}(K=N))+8>K.length&&Ta(6,"invalid gzip data"),function(ue,pe,ge,he){var Se=ue.length;if(!Se||pe.f&&!pe.l)return ge||new go(0);var _e=!ge,Ce=_e||pe.i!=2,Le=pe.i;_e&&(ge=new go(3*Se));var je,ze,Fe=function(gu){var ih=ge.length;if(gu>ih){var uy=new go(Math.max(2*ih,gu));uy.set(ge),ge=uy}},Ze=pe.f||0,Ve=pe.p||0,rt=pe.b||0,ct=pe.l,Je=pe.d,Dt=pe.m,Pt=pe.n,xt=8*Se;do{if(!ct){Ze=Sa(ue,Ve,1);var ht=Sa(ue,Ve+1,3);if(Ve+=3,!ht){var Ht=ue[(sn=4+((Ve+7)/8|0))-4]|ue[sn-3]<<8,At=sn+Ht;if(At>Se){Le&&Ta(0);break}Ce&&Fe(rt+Ht),ge.set(ue.subarray(sn,At),rt),pe.b=rt+=Ht,pe.p=Ve=8*At,pe.f=Ze;continue}if(ht==1)ct=i$,Je=s$,Dt=9,Pt=5;else if(ht==2){var Lt=Sa(ue,Ve,31)+257,nn=Sa(ue,Ve+10,15)+4,xn=Lt+Sa(ue,Ve+5,31)+1;Ve+=14;for(var fn=new go(xn),pn=new go(19),Sn=0;Sn<nn;++Sn)pn[t$[Sn]]=Sa(ue,Ve+3*Sn,7);Ve+=3*nn;var Tn=CS(pn),cr=(1<<Tn)-1,Jn=ny(pn,Tn);for(Sn=0;Sn<xn;){var sn,$n=Jn[Sa(ue,Ve,cr)];if(Ve+=15&$n,(sn=$n>>4)<16)fn[Sn++]=sn;else{var Wn=0,_r=0;for(sn==16?(_r=3+Sa(ue,Ve,3),Ve+=2,Wn=fn[Sn-1]):sn==17?(_r=3+Sa(ue,Ve,7),Ve+=3):sn==18&&(_r=11+Sa(ue,Ve,127),Ve+=7);_r--;)fn[Sn++]=Wn}}var jr=fn.subarray(0,Lt),qr=fn.subarray(Lt);Dt=CS(jr),Pt=CS(qr),ct=ny(jr,Dt),Je=ny(qr,Pt)}else Ta(1);if(Ve>xt){Le&&Ta(0);break}}Ce&&Fe(rt+131072);for(var zr=(1<<Dt)-1,Mr=(1<<Pt)-1,wi=Ve;;wi=Ve){var ti=(Wn=ct[PS(ue,Ve)&zr])>>4;if((Ve+=15&Wn)>xt){Le&&Ta(0);break}if(Wn||Ta(2),ti<256)ge[rt++]=ti;else{if(ti==256){wi=Ve,ct=null;break}var Oi=ti-254;ti>264&&(Oi=Sa(ue,Ve,(1<<(Ca=CR[Sn=ti-257]))-1)+IR[Sn],Ve+=Ca);var mr=Je[PS(ue,Ve)&Mr],Rs=mr>>4;if(mr||Ta(3),Ve+=15&mr,qr=r$[Rs],Rs>3){var Ca=PR[Rs];qr+=PS(ue,Ve)&(1<<Ca)-1,Ve+=Ca}if(Ve>xt){Le&&Ta(0);break}Ce&&Fe(rt+131072);var Wo=rt+Oi;if(rt<qr){var Ho=0-qr,rh=Math.min(qr,Wo);for(Ho+rt<0&&Ta(3);rt<rh;++rt)ge[rt]=(void 0)[Ho+rt]}for(;rt<Wo;++rt)ge[rt]=ge[rt-qr]}}pe.l=ct,pe.p=wi,pe.b=rt,pe.f=Ze,ct&&(Ze=1,pe.m=Dt,pe.d=Je,pe.n=Pt)}while(!Ze);return rt!=ge.length&&_e?(je=ge,((ze=rt)==null||ze>je.length)&&(ze=je.length),new go(je.subarray(0,ze))):ge.subarray(0,rt)}(K.subarray($,-8),{i:2},new go(((V=K)[(X=V.length)-4]|V[X-3]<<8|V[X-2]<<16|V[X-1]<<24)>>>0))));var V,X,K,$;const ne=c$[j];if(!ne)throw new Error(`Unhandled codec: ${j}`);const ie=new globalThis.DecompressionStream(ne);return new Response(new Blob([N]).stream().pipeThrough(ie)).arrayBuffer().then(ue=>new Uint8Array(ue))}(I,C).then(N=>(function(j,V){j.readFields(Z3,V)}(new MS(N),P),new d$[T](P.buffer))),A.then(N=>{for(let j=v.length-1;j>=0;j--)switch(v[j]){case"delta_filter":K3(N,M);break;case"zigzag_filter":J3(N);break;case"bitshuffle_filter":Q3(N,T);break;default:throw new Go(`Unhandled filter "${v[j]}"`)}return{layerName:g,blockIndex:D,data:N}}).catch(N=>{throw N})}))},Ot(NR,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});var iy={workerUrl:"",workerClass:null,workerParams:void 0};const IS="mapboxgl_preloaded_worker_pool";class sy{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<sy.workerCount;)this.workers.push(iy.workerClass!=null?new iy.workerClass:new self.Worker(iy.workerUrl,iy.workerParams));return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.workers&&this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[IS]}numActive(){return Object.keys(this.active).length}}let oy;function W0(){return oy||(oy=new sy),oy}sy.workerCount=2;let ay,DS,Ea,lp,RS,cp=null;function LR(){return Cl()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:DS||Re.DRACO_URL}function OR(){if(Cl()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(lp)return lp;const c=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return lp=WebAssembly.validate(c)?Re.MESHOPT_SIMD_URL:Re.MESHOPT_URL,lp}const H0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},f$={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},ly={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function jR(c,n,a){const d=a.json.bufferViews.length,g=a.buffers.length;n.bufferView=d,a.json.bufferViews[d]={buffer:g,byteLength:c.byteLength},a.buffers[g]=c}const kS="KHR_draco_mesh_compression";function p$(c,n){const a=c.extensions&&c.extensions[kS];if(!a)return;const d=new Ea.Decoder,g=VR(n,a.bufferView),h=new Ea.Mesh;if(!d.DecodeArrayToMesh(g,g.byteLength,h))throw new Error("Failed to decode Draco mesh");const y=n.json.accessors[c.indices],T=H0[y.componentType],M=y.count*T.BYTES_PER_ELEMENT,D=Ea._malloc(M);T===Uint16Array?d.GetTrianglesUInt16Array(h,M,D):d.GetTrianglesUInt32Array(h,M,D),jR(Ea.memory.buffer.slice(D,D+M),y,n),Ea._free(D);for(const v of Object.keys(a.attributes)){const C=d.GetAttributeByUniqueId(h,a.attributes[v]),I=n.json.accessors[c.attributes[v]],P=f$[I.componentType],A=I.count*ly[I.type]*H0[I.componentType].BYTES_PER_ELEMENT,N=Ea._malloc(A);d.GetAttributeDataArrayForAllPoints(h,C,Ea[P],A,N),jR(Ea.memory.buffer.slice(N,N+A),I,n),Ea._free(N)}d.destroy(),h.destroy(),delete c.extensions[kS]}const q0="EXT_meshopt_compression";function m$(c,n){if(!c.extensions||!c.extensions[q0])return;const a=c.extensions[q0],d=new Uint8Array(n.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),g=new Uint8Array(a.count*a.byteStride);RS.decodeGltfBuffer(g,a.count,a.byteStride,d,a.mode,a.filter),c.buffer=n.buffers.length,c.byteOffset=0,n.buffers[c.buffer]=g.buffer,delete c.extensions[q0]}const zR=1179937895,FR=new TextDecoder("utf8");function BR(c,n){return new URL(c,n).href}function g$(c,n,a,d){return fetch(BR(c.uri,d)).then(g=>g.arrayBuffer()).then(g=>{n.buffers[a]=g})}function VR(c,n){const a=c.json.bufferViews[n];return new Uint8Array(c.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function y$(c,n,a,d){if(c.uri){const g=BR(c.uri,d);return fetch(g).then(h=>h.blob()).then(h=>createImageBitmap(h)).then(h=>{n.images[a]=h})}if(c.bufferView!==void 0){const g=VR(n,c.bufferView),h=new Blob([g],{type:c.mimeType});return createImageBitmap(h).then(y=>{n.images[a]=y})}}function UR(c,n=0,a){const d={json:null,images:[],buffers:[]};if(new Uint32Array(c,n,1)[0]===zR){const v=new Uint32Array(c,n);let C=2;const I=(v[C++]>>2)-3,P=v[C++]>>2;if(C++,d.json=JSON.parse(FR.decode(v.subarray(C,C+P))),C+=P,C<I){const A=v[C++];C++;const N=n+(C<<2);d.buffers[0]=c.slice(N,N+A)}}else d.json=JSON.parse(FR.decode(new Uint8Array(c,n)));const{buffers:g,images:h,meshes:y,extensionsUsed:T,bufferViews:M}=d.json;let D=Promise.resolve();if(g){const v=[];for(let C=0;C<g.length;C++){const I=g[C];I.uri?v.push(g$(I,d,C,a)):d.buffers[C]||(d.buffers[C]=null)}D=Promise.all(v)}return D.then(()=>{const v=[],C=T&&T.includes(kS),I=T&&T.includes(q0);if(C&&v.push(function(){if(!Ea)return ay??(ay=function(P){let A,N=null;function j(){A=new Uint8Array(N.buffer)}function V(){throw new Error("Unexpected Draco error.")}const X={a:{a:V,d:function(K,$,ne){return A.copyWithin(K,$,$+ne)},c:function(K){const $=A.length,ne=Math.max(K>>>0,Math.ceil(1.2*$)),ie=Math.ceil((ne-$)/65536);try{return N.grow(ie),j(),!0}catch{return!1}},b:V}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(P,X):P.then(K=>K.arrayBuffer()).then(K=>WebAssembly.instantiate(K,X))).then(K=>{const{Rb:$,Qb:ne,P:ie,T:ue,X:pe,Ja:ge,La:he,Qa:Se,Va:_e,Wa:Ce,eb:Le,jb:je,f:ze,e:Fe,yb:Ze,zb:Ve,Ab:rt,Bb:ct,Db:Je,Gb:Dt}=K.instance.exports;N=Fe;const Pt=(()=>{let xt=0,ht=0,Ht=0,At=0;return Lt=>{Ht&&($(At),$(xt),ht+=Ht,Ht=xt=0),xt||(ht+=128,xt=ne(ht));const nn=Lt.length+7&-8;let xn=xt;nn>=ht&&(Ht=nn,xn=At=ne(nn));for(let fn=0;fn<Lt.length;fn++)A[xn+fn]=Lt[fn];return xn}})();return j(),ze(),{memory:Fe,_free:$,_malloc:ne,Mesh:class{constructor(){this.ptr=ie()}destroy(){ue(this.ptr)}},Decoder:class{constructor(){this.ptr=ge()}destroy(){je(this.ptr)}DecodeArrayToMesh(xt,ht,Ht){const At=Pt(xt),Lt=he(this.ptr,At,ht,Ht.ptr);return!!pe(Lt)}GetAttributeByUniqueId(xt,ht){return{ptr:Se(this.ptr,xt.ptr,ht)}}GetTrianglesUInt16Array(xt,ht,Ht){_e(this.ptr,xt.ptr,ht,Ht)}GetTrianglesUInt32Array(xt,ht,Ht){Ce(this.ptr,xt.ptr,ht,Ht)}GetAttributeDataArrayForAllPoints(xt,ht,Ht,At,Lt){Le(this.ptr,xt.ptr,ht.ptr,Ht,At,Lt)}},DT_INT8:Ze(),DT_UINT8:Ve(),DT_INT16:rt(),DT_UINT16:ct(),DT_UINT32:Je(),DT_FLOAT32:Dt()}})}(fetch(LR())),ay.then(P=>{Ea=P,ay=void 0}))}()),I&&v.push(function(){if(RS)return;const P=function(A){let N;const j=WebAssembly.instantiateStreaming(A,{}).then(K=>{N=K.instance,N.exports.__wasm_call_ctors()}),V={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},X={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:j,supported:!0,decodeGltfBuffer(K,$,ne,ie,ue,pe){(function(ge,he,Se,_e,Ce,Le,je){const ze=ge.exports.sbrk,Fe=_e+3&-4,Ze=ze(Fe*Ce),Ve=ze(Le.length),rt=new Uint8Array(ge.exports.memory.buffer);rt.set(Le,Ve);const ct=he(Ze,_e,Ce,Ve,Le.length);if(ct===0&&je&&je(Ze,Fe,Ce),Se.set(rt.subarray(Ze,Ze+_e*Ce)),ze(Ze-ze(0)),ct!==0)throw new Error(`Malformed buffer data: ${ct}`)})(N,N.exports[X[ue]],K,$,ne,ie,N.exports[V[pe]])}}}(fetch(OR()));return P.ready.then(()=>{RS=P})}()),h)for(let P=0;P<h.length;P++)v.push(y$(h[P],d,P,a));return(v.length?Promise.all(v):Promise.resolve()).then(()=>{if(C&&y)for(const{primitives:P}of y)for(const A of P)p$(A,d);if(I&&y&&M)for(const P of M)m$(P,d);return d})})}function nh(c,n){const a=c.json.bufferViews[n.bufferView],d=H0[n.componentType];return new d(c.buffers[a.buffer],(n.byteOffset||0)+(a.byteOffset||0),n.count*(a.byteStride&&a.byteStride!==ly[n.type]*d.BYTES_PER_ELEMENT?a.byteStride/d.BYTES_PER_ELEMENT:ly[n.type]))}function NS(c,n,a,d){const g=H0[n.componentType],h=function(v){switch(v){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(g),y=c.json.bufferViews[n.bufferView],T=y.byteStride?y.byteStride/g.BYTES_PER_ELEMENT:ly[n.type],M=a.float32,D=M.length/a.capacity;for(let v=0,C=0;v<n.count*T;v+=T,C+=D)for(let I=0;I<D;I++)M[C+I]=d[v+I]*h;a._trim()}function _$(c,n,a){const d=c.indices,g=c.attributes,h={};h.indexArray=new Ri;const y=n.json.accessors[d],T=y.count/3;h.indexArray.reserve(T);const M=nh(n,y);for(let I=0;I<T;I++)h.indexArray.emplaceBack(M[3*I],M[3*I+1],M[3*I+2]);h.indexArray._trim(),h.vertexArray=new tl;const D=n.json.accessors[g.POSITION];h.vertexArray.reserve(D.count);const v=nh(n,D);for(let I=0;I<D.count;I++)h.vertexArray.emplaceBack(v[3*I],v[3*I+1],v[3*I+2]);if(h.vertexArray._trim(),h.aabb=new pr(D.min,D.max),h.centroid=function(I,P){const A=[0,0,0],N=I.length;if(N>0){for(let j=0;j<N;j++){const V=3*I[j];A[0]+=P[V],A[1]+=P[V+1],A[2]+=P[V+2]}A[0]/=N,A[1]/=N,A[2]/=N}return A}(M,v),g.COLOR_0!==void 0){const I=n.json.accessors[g.COLOR_0],P=ly[I.type],A=nh(n,I);h.colorArray=P===3?new tl:new ga,h.colorArray.resize(I.count),NS(n,I,h.colorArray,A)}if(g.NORMAL!==void 0){h.normalArray=new tl;const I=n.json.accessors[g.NORMAL];h.normalArray.resize(I.count);const P=nh(n,I);NS(n,I,h.normalArray,P)}if(g.TEXCOORD_0!==void 0&&a.length>0){h.texcoordArray=new Hd;const I=n.json.accessors[g.TEXCOORD_0];h.texcoordArray.resize(I.count);const P=nh(n,I);NS(n,I,h.texcoordArray,P)}if(g._FEATURE_ID_RGBA4444!==void 0){const I=n.json.accessors[g._FEATURE_ID_RGBA4444];n.json.extensionsUsed&&n.json.extensionsUsed.includes("EXT_meshopt_compression")&&(h.featureData=nh(n,I))}g._FEATURE_RGBA4444!==void 0&&(h.featureData=new Uint32Array(nh(n,n.json.accessors[g._FEATURE_RGBA4444]).buffer));const C=c.material;return h.material=function(I,P){const{emissiveFactor:A=[0,0,0],alphaMode:N="OPAQUE",alphaCutoff:j=.5,normalTexture:V,occlusionTexture:X,emissiveTexture:K,doubleSided:$}=I,{baseColorFactor:ne=[1,1,1,1],metallicFactor:ie=1,roughnessFactor:ue=1,baseColorTexture:pe,metallicRoughnessTexture:ge}=I.pbrMetallicRoughness||{},he=X?P[X.index]:void 0;if(X&&X.extensions&&X.extensions.KHR_texture_transform&&he){const Se=X.extensions.KHR_texture_transform;he.offsetScale=[Se.offset[0],Se.offset[1],Se.scale[0],Se.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Yn(...ne),metallicFactor:ie,roughnessFactor:ue,baseColorTexture:pe?P[pe.index]:void 0,metallicRoughnessTexture:ge?P[ge.index]:void 0},doubleSided:$,emissiveFactor:A,alphaMode:N,alphaCutoff:j,normalTexture:V?P[V.index]:void 0,occlusionTexture:he,emissionTexture:K?P[K.index]:void 0,defined:I.defined===void 0}}(C!==void 0?n.json.materials[C]:{defined:!1},a),h}function $R(c,n,a){const{matrix:d,rotation:g,translation:h,scale:y,mesh:T,extras:M,children:D}=c,v={};if(v.matrix=d||Ie.mat4.fromRotationTranslationScale([],g||[0,0,0,1],h||[0,0,0],y||[1,1,1]),T!==void 0){v.meshes=a[T];const C=v.anchor=[0,0];for(const I of v.meshes){const{min:P,max:A}=I.aabb;C[0]+=P[0]+A[0],C[1]+=P[1]+A[1]}C[0]=Math.floor(C[0]/v.meshes.length/2),C[1]=Math.floor(C[1]/v.meshes.length/2)}if(M&&(M.id&&(v.id=M.id),M.lights&&(v.lights=function(C){if(!C.length)return[];const I=function(V){const X=atob(V),K=new Uint8Array(X.length);for(let $=0;$<X.length;$++)K[$]=X.codePointAt($);return K}(C),P=[],A=I.length/24,N=new Uint16Array(I.buffer),j=new Float32Array(I.buffer);for(let V=0;V<A;V++){const X=N[2*V*6]/30,K=N[2*V*6+1]/30,$=N[2*V*6+10]/100,ne=j[6*V+1],ie=j[6*V+2],ue=j[6*V+3],pe=j[6*V+4],ge=ue-ne,he=pe-ie,Se=Math.hypot(ge,he);P.push({pos:[ne+.5*ge,ie+.5*he,K],normal:[he/Se,-ge/Se,0],width:Se,height:X,depth:$,points:[ne,ie,ue,pe]})}return P}(M.lights))),D){const C=[];for(const I of D)C.push($R(n.json.nodes[I],n,a));v.children=C}return v}function x$(c){if(c.vertices.length===0||c.indices.length===0)return null;const n=new $w(c.vertices,c.indices,8,256),[a,d]=[n.min.clone(),n.max.clone()];return{vertices:c.vertices,indices:c.indices,grid:n,min:a,max:d}}function v$(c){if(!c.extras||!c.extras.ground)return null;const n=c.extras.ground;if(!n||!Array.isArray(n)||n.length===0)return null;const a=n[0];if(!a||!Array.isArray(a)||a.length===0)return null;const d=[];for(const y of a){if(!Array.isArray(y)||y.length!==2)continue;const T=y[0],M=y[1];typeof T=="number"&&typeof M=="number"&&d.push(new Tt(T,M))}if(d.length<3)return null;d.length>1&&d[d.length-1].equals(d[0])&&d.pop();let g=0;for(let y=0;y<d.length;y++){const T=d[y],M=d[(y+1)%d.length],D=d[(y+2)%d.length];g+=(T.x-M.x)*(D.y-M.y)-(D.x-M.x)*(T.y-M.y)}g>0&&d.reverse();const h=Ng(d.flatMap(y=>[y.x,y.y]),[]);return h.length===0?null:{vertices:d,indices:h}}function b$(c,n){const a=[],d=[];let g=0;const h=[];for(const y of c){g=a.length;const T=y.vertexArray.float32,M=y.indexArray.uint16;for(let D=0;D<y.vertexArray.length;D++)h[0]=T[3*D+0],h[1]=T[3*D+1],h[2]=T[3*D+2],Ie.vec3.transformMat4(h,h,n),a.push(new Tt(h[0],h[1]));for(let D=0;D<3*y.indexArray.length;D++)d.push(M[D]+g)}if(d.length%3!=0)return null;for(let y=0;y<d.length;y+=3){const T=a[d[y+0]],M=a[d[y+1]],D=a[d[y+2]];(T.x-M.x)*(D.y-M.y)-(D.x-M.x)*(T.y-M.y)>0&&([d[y+1],d[y+2]]=[d[y+2],d[y+1]])}return{vertices:a,indices:d}}function GR(c){const n=function(M,D){const v=[],C=WebGL2RenderingContext;if(M.json.textures)for(const I of M.json.textures){const P={magFilter:C.LINEAR,minFilter:C.NEAREST,wrapS:C.REPEAT,wrapT:C.REPEAT};I.sampler!==void 0&&Object.assign(P,M.json.samplers[I.sampler]),v.push({image:D[I.source],sampler:P,uploaded:!1})}return v}(c,c.images),a=function(M,D){const v=[];for(const C of M.json.meshes){const I=[];for(const P of C.primitives)I.push(_$(P,M,D));v.push(I)}return v}(c,n),{scenes:d,scene:g,nodes:h}=c.json,y=d?d[g||0].nodes:h,T=[];for(const M of y)T.push($R(h[M],c,a));return function(M,D,v){const C={},I=new Set;for(let P=0;P<M.length;P++){const A=v[D[P]];if(!A.extras)continue;const N=A.extras["mapbox:footprint:version"],j=A.extras["mapbox:footprint:id"];(N||j)&&I.add(P),N==="1.0.0"&&j&&(C[j]=P)}for(let P=0;P<M.length;P++){if(I.has(P))continue;const A=M[P],N=v[D[P]];if(!N.extras)continue;let j=null;A.id in C&&(j=b$(M[C[A.id]].meshes,A.matrix)),j||(j=v$(N)),j&&(A.footprint=x$(j))}if(I.size>0){const P=Array.from(I.values()).sort((A,N)=>A-N);for(let A=P.length-1;A>=0;A--)M.splice(P[A],1)}}(T,y,c.json.nodes),T}function w$(c){c.heightmap=new Float32Array(4096),c.heightmap.fill(-1);const n=c.vertexArray.float32,a=c.aabb.min[0]-1,d=c.aabb.min[1]-1,g=eh/(c.aabb.max[0]-a+2),h=eh/(c.aabb.max[1]-d+2);for(let y=0;y<n.length;y+=3){const T=n[y+2],M=(n[y+0]-a)*g|0,D=(n[y+1]-d)*h|0;T>c.heightmap[D*eh+M]&&(c.heightmap[D*eh+M]=T)}}function S$(c,n){const a={};a.indexArray=new Ri,a.indexArray.reserve(4*c.length),a.vertexArray=new tl,a.vertexArray.reserve(10*c.length),a.colorArray=new ga,a.vertexArray.reserve(10*c.length);let d=0;for(const y of c){const T=Math.min(10,Math.max(4,1.3*y.height))*n,M=[-y.normal[1],y.normal[0],0],D=Math.min(.29,.1*y.width/y.depth),v=y.width-2*y.depth*n*(D+.01),C=Ie.vec3.scaleAndAdd([],y.pos,M,v/2),I=Ie.vec3.scaleAndAdd([],y.pos,M,-v/2),P=[C[0],C[1],C[2]+y.height],A=[I[0],I[1],I[2]+y.height],N=Ie.vec3.scaleAndAdd([],y.normal,M,D);Ie.vec3.scale(N,N,T);const j=Ie.vec3.scaleAndAdd([],y.normal,M,-D);Ie.vec3.scale(j,j,T),Ie.vec3.add(N,C,N),Ie.vec3.add(j,I,j),C[2]+=.1,I[2]+=.1,a.vertexArray.emplaceBack(N[0],N[1],N[2]),a.vertexArray.emplaceBack(j[0],j[1],j[2]),a.vertexArray.emplaceBack(C[0],C[1],C[2]),a.vertexArray.emplaceBack(I[0],I[1],I[2]),a.vertexArray.emplaceBack(P[0],P[1],P[2]),a.vertexArray.emplaceBack(A[0],A[1],A[2]),a.vertexArray.emplaceBack(C[0],C[1],C[2]),a.vertexArray.emplaceBack(I[0],I[1],I[2]),a.vertexArray.emplaceBack(N[0],N[1],N[2]),a.vertexArray.emplaceBack(j[0],j[1],j[2]);const V=v/T/2;a.colorArray.emplaceBack(-V-D,-1,V,.8),a.colorArray.emplaceBack(V+D,-1,V,.8),a.colorArray.emplaceBack(-V,0,V,1.3),a.colorArray.emplaceBack(V,0,V,1.3),a.colorArray.emplaceBack(V+D,-.8,V,.7),a.colorArray.emplaceBack(V+D,-.8,V,.7),a.colorArray.emplaceBack(0,0,V,1.3),a.colorArray.emplaceBack(0,0,V,1.3),a.colorArray.emplaceBack(V+D,-1.2,V,.8),a.colorArray.emplaceBack(V+D,-1.2,V,.8),a.indexArray.emplaceBack(6+d,4+d,8+d),a.indexArray.emplaceBack(7+d,9+d,5+d),a.indexArray.emplaceBack(0+d,1+d,2+d),a.indexArray.emplaceBack(1+d,3+d,2+d),d+=10}const g={defined:!0,emissiveFactor:[0,0,0]},h={};return h.baseColorFactor=Yn.white,g.pbrMetallicRoughness=h,a.material=g,a.aabb=new pr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}class WR{constructor(n){this._stringToNumber={},this._numberToString=[];for(let a=0;a<n.length;a++){const d=n[a];this._stringToNumber[d]=a,this._numberToString[a]=d}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}const T$=["id","tile","layer","source","sourceLayer","state"];class HR{constructor(n,a,d,g,h){this.type="Feature",this._vectorTileFeature=n,this._z=a,this._x=d,this._y=g,this.properties=n.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const a of T$)this[a]!==void 0&&(n[a]=this[a]);return n}}class qR{constructor(n,a){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Nl(Mt,16,0),this.featureIndexArray=new e0,this.promoteId=a,this.is3DTile=!1}insert(n,a,d,g,h,y=0,T=0){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,g,h,y);const D=this.grid;for(let v=0;v<a.length;v++){const C=a[v],I=[1/0,1/0,-1/0,-1/0];for(let P=0;P<C.length;P++){const A=C[P];I[0]=Math.min(I[0],A.x),I[1]=Math.min(I[1],A.y),I[2]=Math.max(I[2],A.x),I[3]=Math.max(I[3],A.y)}T!==0&&(I[0]-=T,I[1]-=T,I[2]+=T,I[3]+=T),I[0]<Mt&&I[1]<Mt&&I[2]>=0&&I[3]>=0&&D.insert(M,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Jf.VectorTile(new w0(this.rawTileData)).layers,this.sourceLayerCoder=new WR(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,a,d,g){this.loadVTLayers();const h=n.params||{},y=fo(h.filter),T=n.tileResult,M=n.transform,D=T.bufferedTilespaceBounds,v=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(A,N,j,V)=>Us(T.bufferedTilespaceGeometry,A,N,j,V));v.sort(E$);let C=null;M.elevation&&v.length>0&&(C=sp.create(M.elevation,this.tileID));const I={};let P;for(let A=0;A<v.length;A++){const N=v[A];if(N===P)continue;P=N;const j=this.featureIndexArray.get(N);let V=null;if(this.is3DTile){const X=this.bucketLayerIDs[0][0],K=a[X];if(K.type!=="model")continue;const{queryFeature:$,intersectionZ:ne}=K.queryIntersectsMatchingFeature(T,j.featureIndex,y,M);$&&this.appendToResult(I,X,j.featureIndex,$,ne)}else this.loadMatchingFeature(I,j,y,h.layers,h.availableImages,a,d,g,(X,K,$,ne=0)=>(V||(V=_t(X,this.tileID.canonical,n.tileTransform)),K.queryIntersectsFeature(T,X,$,V,this.z,n.transform,n.pixelPosMatrix,C,ne)))}return I}loadMatchingFeature(n,a,d,g,h,y,T,M,D){const{featureIndex:v,bucketIndex:C,sourceLayerIndex:I,layoutVertexArrayOffset:P}=a,A=this.bucketLayerIDs[C];if(g&&!function(X,K){for(let $=0;$<X.length;$++)if(K.indexOf(X[$])>=0)return!0;return!1}(g,A))return;const N=this.sourceLayerCoder.decode(I),j=this.vtLayers[N].feature(v);if(d.needGeometry){const X=vt(j,!0);if(!d.filter(new kr(this.tileID.overscaledZ),X,this.tileID.canonical))return}else if(!d.filter(new kr(this.tileID.overscaledZ),j))return;const V=this.getId(j,N);for(let X=0;X<A.length;X++){const K=A[X];if(g&&g.indexOf(K)<0)continue;const $=y[K];if(!$)continue;let ne={};V!==void 0&&M&&(ne=M.getState($.sourceLayer||"_geojsonTileLayer",V));const ie=!D||D(j,$,ne,P);if(!ie)continue;const ue=new HR(j,this.z,this.x,this.y,V),pe=Bi({},T[K]);pe.paint=ZR(pe.paint,$.paint,j,ne,h),pe.layout=ZR(pe.layout,$.layout,j,ne,h),ue.layer=pe,this.appendToResult(n,K,v,ue,ie)}}appendToResult(n,a,d,g,h){let y=n[a];y===void 0&&(y=n[a]=[]),y.push({featureIndex:d,feature:g,intersectionZ:h})}lookupSymbolFeatures(n,a,d,g,h,y,T,M){const D={};this.loadVTLayers();const v=fo(h);for(const C of n)this.loadMatchingFeature(D,{bucketIndex:d,sourceLayerIndex:g,featureIndex:C,layoutVertexArrayOffset:0},v,y,T,M,a);return D}loadFeature(n){const{featureIndex:a,sourceLayerIndex:d}=n;this.loadVTLayers();const g=this.sourceLayerCoder.decode(d),h=this.vtFeatures[g];if(h[a])return h[a];const y=this.vtLayers[g].feature(a);return h[a]=y,y}hasLayer(n){for(const a of this.bucketLayerIDs)for(const d of a)if(n===d)return!0;return!1}getId(n,a){let d=n.id;if(this.promoteId){const g=typeof this.promoteId=="string"?this.promoteId:this.promoteId[a];g!=null&&(d=n.properties[g]),typeof d=="boolean"&&(d=Number(d))}return d}}function ZR(c,n,a,d,g){return El(c,(h,y)=>{const T=n instanceof Kc?n.get(y):null;return T&&T.evaluate?T.evaluate(a,d,g):T})}function E$(c,n){return n-c}Ot(qR,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const XR=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class LS{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,d]=new Uint8Array(n,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=d>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const h=XR[15&d];if(!h)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(n,2,1),[T]=new Uint32Array(n,4,1);return new LS(T,y,h,n)}constructor(n,a=64,d=Float64Array,g){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=d,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const h=XR.indexOf(this.ArrayType),y=2*n*this.ArrayType.BYTES_PER_ELEMENT,T=n*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-T%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${d}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+T+M,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+y+T+M),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+T+M,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=n)}add(n,a){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=n,this.coords[this._pos++]=a,d}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return OS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,a,d,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:y,nodeSize:T}=this,M=[0,h.length-1,0],D=[];for(;M.length;){const v=M.pop()||0,C=M.pop()||0,I=M.pop()||0;if(C-I<=T){for(let j=I;j<=C;j++){const V=y[2*j],X=y[2*j+1];V>=n&&V<=d&&X>=a&&X<=g&&D.push(h[j])}continue}const P=I+C>>1,A=y[2*P],N=y[2*P+1];A>=n&&A<=d&&N>=a&&N<=g&&D.push(h[P]),(v===0?n<=A:a<=N)&&(M.push(I),M.push(P-1),M.push(1-v)),(v===0?d>=A:g>=N)&&(M.push(P+1),M.push(C),M.push(1-v))}return D}within(n,a,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:h,nodeSize:y}=this,T=[0,g.length-1,0],M=[],D=d*d;for(;T.length;){const v=T.pop()||0,C=T.pop()||0,I=T.pop()||0;if(C-I<=y){for(let j=I;j<=C;j++)KR(h[2*j],h[2*j+1],n,a)<=D&&M.push(g[j]);continue}const P=I+C>>1,A=h[2*P],N=h[2*P+1];KR(A,N,n,a)<=D&&M.push(g[P]),(v===0?n-d<=A:a-d<=N)&&(T.push(I),T.push(P-1),T.push(1-v)),(v===0?n+d>=A:a+d>=N)&&(T.push(P+1),T.push(C),T.push(1-v))}return M}}function OS(c,n,a,d,g,h){if(g-d<=a)return;const y=d+g>>1;YR(c,n,y,d,g,h),OS(c,n,a,d,y-1,1-h),OS(c,n,a,y+1,g,1-h)}function YR(c,n,a,d,g,h){for(;g>d;){if(g-d>600){const D=g-d+1,v=a-d+1,C=Math.log(D),I=.5*Math.exp(2*C/3),P=.5*Math.sqrt(C*I*(D-I)/D)*(v-D/2<0?-1:1);YR(c,n,a,Math.max(d,Math.floor(a-v*I/D+P)),Math.min(g,Math.floor(a+(D-v)*I/D+P)),h)}const y=n[2*a+h];let T=d,M=g;for(cy(c,n,d,a),n[2*g+h]>y&&cy(c,n,d,g);T<M;){for(cy(c,n,T,M),T++,M--;n[2*T+h]<y;)T++;for(;n[2*M+h]>y;)M--}n[2*d+h]===y?cy(c,n,d,M):(M++,cy(c,n,M,g)),M<=a&&(d=M+1),a<=M&&(g=M-1)}}function cy(c,n,a,d){jS(c,a,d),jS(n,2*a,2*d),jS(n,2*a+1,2*d+1)}function jS(c,n,a){const d=c[n];c[n]=c[a],c[a]=d}function KR(c,n,a,d){const g=c-a,h=n-d;return g*g+h*h}s.$=Gx,s.A=class extends V0{},s.B=Il,s.C=Ac,s.D=Vd,s.E=Mc,s.F=sg,s.G=Tf,s.H=Lx,s.I=oS,s.J=Pf,s.K=Of,s.L=Bx,s.M=jd,s.N=gf,s.O=Id,s.P=Tt,s.Q=Ad,s.R=Ec,s.S=us,s.T=_S,s.U=Dm,s.V=V0,s.W=mg,s.X=Ef,s.Y=ig,s.Z=function(c){const n=c.value;let a=[];if(!n)return a;const d=Il(n);return d!=="string"?(a=a.concat([new V0(c.key,n,`string expected, "${d}" found`)]),a):(aR(n,!0)||(a=a.concat([new V0(c.key,n,`invalid url "${n}"`)])),a)},s._=We,s.a=function(c){return Re.API_CDN_URL_REGEX.test(c)},s.a$=Tg,s.a0=Sr,s.a1=bt,s.a2=class{constructor(c){this.specification=c}possiblyEvaluate(c,n){return Ts(c.expression.evaluate(n))}interpolate(c,n,a){return{x:Xt(c.x,n.x,a),y:Xt(c.y,n.y,a),z:Xt(c.z,n.z,a),azimuthal:Xt(c.azimuthal,n.azimuthal,a),polar:Xt(c.polar,n.polar,a)}}},s.a3=kr,s.a4=Fo,s.a5=Ue,s.a6=Ie,s.a7=vc,s.a8=Kc,s.a9=lu,s.aA=fr,s.aB=ZD,s.aC=eR,s.aD=qD,s.aE=function(c,n){const a=document.createElement("video");a.muted=!0,a.onloadstart=function(){n(null,a)};for(let d=0;d<c.length;d++){const g=document.createElement("source");Vs(c[d])||(a.crossOrigin="Anonymous"),g.src=c[d],a.appendChild(g)}return{cancel:()=>{}}},s.aF=O0,s.aG=function(c){return fetch(c).then(n=>n.arrayBuffer()).then(n=>UR(n,0,c))},s.aH=GR,s.aI=class{constructor(c,n,a,d){this.id=c,this.position=n!=null?new Y(n[0],n[1]):new Y(0,0),this.orientation=a??[0,0,0],this.nodes=d,this.uploaded=!1,this.aabb=new pr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(c,n){if(Ie.mat4.multiply(c.matrix,n,c.matrix),c.meshes)for(const a of c.meshes){const d=pr.applyTransformFast(a.aabb,c.matrix);this.aabb.encapsulate(d)}if(c.children)for(const a of c.children)this._applyTransformations(a,c.matrix)}computeBoundsAndApplyParent(){const c=Ie.mat4.identity([]);for(const n of this.nodes)this._applyTransformations(n,c)}computeModelMatrix(c,n,a,d,g,h,y=!1){hR(this.matrix,this,c.transform,this.position,n,a,d,g,h,y)}upload(c){if(!this.uploaded){for(const n of this.nodes)SS(n,c);for(const n of this.nodes)U0(n);this.uploaded=!0}}destroy(){for(const c of this.nodes)TS(c)}},s.aJ=bc,s.aK=Zg,s.aL=be,s.aM=ve,s.aN=el,s.aO=Ri,s.aP=pd,s.aQ=Hf,s.aR=N0,s.aS=function(){hs.isLoading()||hs.isLoaded()||hg()!=="deferred"||fg()},s.aT=fo,s.aU=vt,s.aV=HR,s.aW=yd,s.aX=Jw,s.aY=Uw,s.aZ=_t,s.a_=Qa,s.aa=Xt,s.ab=Mt,s.ac=Sd,s.ad=class{constructor(c){this.specification=c}possiblyEvaluate(c,n){return function([a,d]){const g=Ts([1,a,d]);return{x:g.x,y:g.y,z:g.z}}(c.expression.evaluate(n))}interpolate(c,n,a){return{x:Xt(c.x,n.x,a),y:Xt(c.y,n.y,a),z:Xt(c.z,n.z,a)}}},s.ae=function(c,n,a=0,d=!0){const g=new Tt(a,a),h=c.sub(g),y=n.add(g),T=[h,new Tt(y.x,h.y),y,new Tt(h.x,y.y)];return d&&T.push(h.clone()),T},s.af=function(c,n){const a=[];for(let d=0;d<c.length;d++){const g=ua(d-1,-1,c.length-1),h=ua(d+1,-1,c.length-1),y=c[d],T=c[h],M=c[g].sub(y).unit(),D=T.sub(y).unit(),v=D.angleWithSep(M.x,M.y),C=M.add(D).unit().mult(-1*n/Math.sin(v/2));a.push(y.add(C))}return a},s.ag=kD,s.ah=Us,s.ai=function(c,n,a=0){return Ie.vec3.fromValues(((n.x-a)*c.scale-c.x)*Mt,(n.y*c.scale-c.y)*Mt,Pe(n.z,n.y))},s.aj=va,s.ak=QI,s.al=function(c){let n=1/0,a=1/0,d=-1/0,g=-1/0;for(const h of c)n=Math.min(n,h.x),a=Math.min(a,h.y),d=Math.max(d,h.x),g=Math.max(g,h.y);return{min:new Tt(n,a),max:new Tt(d,g)}},s.am=me,s.an=yr,s.ao=lt,s.ap=mn,s.aq=i,s.ar=function(c,n){const a={};for(let d=0;d<n.length;d++){const g=n[d];g in c&&(a[g]=c[g])}return a},s.as=se,s.at=ye,s.au=class{constructor(c){this.entries={},this.scheduler=c}request(c,n,a,d){const g=this.entries[c]=this.entries[c]||{callbacks:[]};if(g.result){const[h,y]=g.result;return this.scheduler?this.scheduler.add(()=>{d(h,y)},n):d(h,y),()=>{}}return g.callbacks.push(d),g.cancel||(g.cancel=a((h,y)=>{g.result=[h,y];for(const T of g.callbacks)this.scheduler?this.scheduler.add(()=>{T(h,y)},n):T(h,y);setTimeout(()=>delete this.entries[c],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(h=>h!==d),g.callbacks.length||(g.cancel(),delete this.entries[c]))}}},s.av=Zx,s.aw=function(c,n,a){const d=JSON.stringify(c.request);return c.data&&(this.deduped.entries[d]={result:[null,c.data]}),this.deduped.request(d,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},g=>{const h=Cc(c.request,(y,T,M,D)=>{y?g(y):T&&g(null,{vectorTile:a?void 0:new Jf.VectorTile(new w0(T)),rawData:T,cacheControl:M,expires:D})});return()=>{h.cancel(),g()}},n)},s.ax=function(c){si++,si>Xn&&(c.getActor().send("enforceCacheSizeLimit",an),si=0)},s.ay=Rt,s.az=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))},s.b=function(c){return Re.API_FONTS_REGEX.test(c)},s.b$=function(c){const{x:n,y:a}=c.point,{lng:d,lat:g}=c._center;return WA(n,a,c.worldSize,d,g)},s.b0=Gs,s.b1=Nr,s.b2=Ng,s.b3=mS,s.b4=function(c,n){const a=lu(n.zoom);if(a===0)return sl(c);const d=l0(c),g=kw(d),h=me(d.getWest())*n.worldSize,y=me(d.getEast())*n.worldSize,T=ye(d.getNorth())*n.worldSize,M=ye(d.getSouth())*n.worldSize,D=[h,T,0],v=[y,T,0],C=[h,M,0],I=[y,M,0],P=Ie.mat4.invert([],n.globeMatrix);return Ie.vec3.transformMat4(D,D,P),Ie.vec3.transformMat4(v,v,P),Ie.vec3.transformMat4(C,C,P),Ie.vec3.transformMat4(I,I,P),g[0]=Ul(g[0],C,a),g[1]=Ul(g[1],I,a),g[2]=Ul(g[2],v,a),g[3]=Ul(g[3],D,a),pr.fromPoints(g)},s.b5=u0,s.b6=Rg,s.b7=Ul,s.b8=Bf,s.b9=fs,s.bA=ua,s.bB=wn,s.bC=Pl,s.bD=fe,s.bE=function(c,n,a){c[4*n+0]=a[0],c[4*n+1]=a[1],c[4*n+2]=a[2],c[4*n+3]=a[3]},s.bF=Yd,s.bG=Bo,s.bH=Mg,s.bI=Gi,s.bJ=Fl,s.bK=Y,s.bL=zD,s.bM=ai,s.bN=au,s.bO=nR,s.bP=gi,s.bQ=UA,s.bR=function(c,n,a,d,g,h,y,T,M){if(M.name==="globe")return UA(c,n,new gi(a,d,g),!1);const D=Zg({z:a,x:d,y:g},M);return new pr([(h+D.x/D.scale)*n,n*(D.y/D.scale),y],[(h+D.x2/D.scale)*n,n*(D.y2/D.scale),T])},s.bS=function(c,n,a){let d=0;for(let g=0;g<2;++g)c[g]>0&&(d+=(c[g]-0)*(c[g]-0)),n[g]<0&&(d+=(0-n[g])*(0-n[g]));return d},s.bT=Te,s.bU=p,s.bV=function(c){const n=Ie.mat4.identity(new Float64Array(16));Ie.mat4.multiply(n,c.pixelMatrix,c.globeMatrix);const a=[0,R,0],d=[0,L,0];return Ie.vec3.transformMat4(a,a,n),Ie.vec3.transformMat4(d,d,n),[a[0]>0&&a[0]<=c.width&&a[1]>0&&a[1]<=c.height&&!Ow(c,new Y(c.center.lat,90)),d[0]>0&&d[0]<=c.width&&d[1]>0&&d[1]<=c.height&&!Ow(c,new Y(c.center.lat,-90))]},s.bW=function(c,n){const{scale:a}=c.tileTransform,d=a*Mt/(c.tileSize*Math.pow(2,n.zoom-c.tileID.overscaledZ+c.tileID.canonical.z));return Ie.mat2.scale(new Float32Array(4),n.inverseAdjustmentMatrix,[d,d])},s.bX=F0,s.bY=tR,s.bZ=function(c){const n=tR(c,!0);return Ie.mat2.invert([],[n[0],n[1],n[4],n[5]])},s.b_=il,s.ba=AS,s.bb=w0,s.bc=Cc,s.bd=function(c){const n=[];for(const a in c)n.push(c[a]);return n},s.be=function(c,n){const a=[];for(const d in c)d in n||a.push(d);return a},s.bf=Tl,s.bg=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.bh=ws,s.bi=function(c,n){const{x:a,y:d}=c.point,g=WA(a,d,c.worldSize/c._pixelsPerMercatorPixel,0,0);return Ie.mat4.multiply(g,g,Nw(sl(n)))},s.bj=Qf,s.bk=mo,s.bl=b0,s.bm=function(c,n,a,d,g){const h=5*n+2;c.float32[h+0]=a,c.float32[h+1]=d,c.float32[h+2]=g},s.bn=k0,s.bo=wD,s.bp=Ct,s.bq=Li,s.br=TI,s.bs=oR,s.bt=AI,s.bu=II,s.bv=cS,s.bw=AD,s.bx=sS,s.by=LS,s.bz=Yn,s.c=Be,s.c$=es,s.c0=vi,s.c1=Qi,s.c2=l,s.c3=function(c){const n=Math.round((c+45+360)%360/90)%4;return io[n]},s.c4=45,s.c5=le,s.c6=Xf,s.c7=function(c,n,a){const d=Math.sqrt(c*c+n*n+a*a),g=d>0?Math.acos(a/d)*ro:0;let h=c!==0||n!==0?Math.atan2(-n,-c)*ro+90:0;return h<0&&(h+=360),[d,h,g]},s.c8=De,s.c9=pr,s.cA=function(c){const n=Te-5;c=mn(c,-n,n)/n*90;const a=Math.pow(Math.abs(Math.sin(wn(c))),3);return Math.round(a*(E.length-1))},s.cB=function(c,n,a,d){const g=n.getNorth(),h=n.getSouth(),y=n.getWest(),T=n.getEast(),M=1<<c.z,D=T-y,v=g-h,C=D/w,I=-v/E[a],P=[0,C,0,I,0,0,g,y,0];if(c.z>0){const A=180/d;Ie.mat3.multiply(P,P,[A/D+1,0,0,0,A/v+1,0,-.5*A/C,.5*A/I,1])}return P[2]=M,P[5]=c.x,P[8]=c.y,P},s.cC=sl,s.cD=function(c,n,a){const d=Ie.mat4.identity(new Float64Array(16)),g=(n/(1<<c)-.5)*Math.PI*2;return Ie.mat4.rotateY(d,a.globeMatrix,g),Float32Array.from(d)},s.cE=class{isDataAvailableAtPoint(c){const n=this._source();if(this.isUsingMockSource()||!n||c.y<0||c.y>1)return!1;const a=n.getSource().maxzoom,d=1<<a,g=Math.floor(c.x),h=Math.floor((c.x-g)*d),y=Math.floor(c.y*d),T=this.findDEMTileFor(new fr(a,g,a,h,y));return!(!T||!T.dem)}getAtPointOrZero(c,n=0){return this.getAtPoint(c,n)||0}getAtPoint(c,n,a=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);const d=this._source();if(!d||c.y<0||c.y>1)return n;const g=d.getSource().maxzoom,h=1<<g,y=Math.floor(c.x),T=c.x-y,M=new fr(g,y,g,Math.floor(T*h),Math.floor(c.y*h)),D=this.findDEMTileFor(M);if(!D||!D.dem)return n;const v=D.dem,C=1<<D.tileID.canonical.z,I=(T*C-D.tileID.canonical.x)*v.dim,P=(c.y*C-D.tileID.canonical.y)*v.dim,A=Math.floor(I),N=Math.floor(P);return(a?this.exaggeration():1)*Xt(Xt(v.get(A,N),v.get(A,N+1),P-N),Xt(v.get(A+1,N),v.get(A+1,N+1),P-N),I-A)}getAtTileOffset(c,n,a){const d=1<<c.canonical.z;return this.getAtPointOrZero(new Ue(c.wrap+(c.canonical.x+n/Mt)/d,(c.canonical.y+a/Mt)/d))}getAtTileOffsetFunc(c,n,a,d){return g=>{const h=this.getAtTileOffset(c,g.x,g.y),y=d.upVector(c.canonical,g.x,g.y),T=d.upVectorScale(c.canonical,n,a).metersToTile;return Ie.vec3.scale(y,y,h*T),y}}getForTilePoints(c,n,a,d){if(this.isUsingMockSource())return!1;const g=sp.create(this,c,d);return!!g&&(n.forEach(h=>{h[2]=this.exaggeration()*g.getElevationAt(h[0],h[1],a)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(c);if(!n||!n.dem)return null;const a=n.dem.tree,d=n.tileID,g=1<<c.canonical.z-d.canonical.z;let h=c.canonical.x/g-d.canonical.x,y=c.canonical.y/g-d.canonical.y,T=0;for(let M=0;M<c.canonical.z-d.canonical.z&&!a.leaves[T];M++){h*=2,y*=2;const D=2*Math.floor(y)+Math.floor(h);T=a.childOffsets[T]+D,h%=1,y%=1}return{min:this.exaggeration()*a.minimums[T],max:this.exaggeration()*a.maximums[T]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,n,a){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const c=this.visibleDemTiles;if(c.length===0)return null;let n=!1,a=Number.MAX_VALUE,d=Number.MIN_VALUE;for(const g of c){const h=this.getMinMaxForTile(g.tileID);h&&(a=Math.min(a,h.min),d=Math.max(d,h.max),n=!0)}return n?{min:a,max:d}:null}},s.cF=iI,s.cG=Vl,s.cH=function(c,n){return[Math.pow(c[0],2.2)*n,Math.pow(c[1],2.2)*n,Math.pow(c[2],2.2)*n]},s.cI=GA,s.cJ=we,s.cK=de,s.cL=256,s.cM=function(c,n){const a=[0,0,0],d=u0(sl(n.canonical));return Ie.vec3.transformMat4(a,a,d),Ie.vec3.transformMat4(a,a,c),a},s.cN=c=>({u_camera_to_center_distance:new Gi(c),u_extrude_scale:new Ig(c),u_device_pixel_ratio:new Gi(c),u_matrix:new Yd(c),u_inv_rot_matrix:new Yd(c),u_merc_center:new Bo(c),u_tile_id:new Mg(c),u_zoom_transition:new Gi(c),u_up_dir:new Mg(c),u_emissive_strength:new Gi(c)}),s.cO=c=>({u_matrix:new Yd(c),u_pixels_to_tile_units:new Ig(c),u_device_pixel_ratio:new Gi(c),u_units_to_pixels:new Bo(c),u_dash_image:new Fl(c),u_gradient_image:new Fl(c),u_image_height:new Gi(c),u_texsize:new Bo(c),u_tile_units_to_pixels:new Gi(c),u_alpha_discard_threshold:new Gi(c),u_trim_offset:new Bo(c),u_trim_fade_range:new Bo(c),u_trim_color:new Xf(c),u_emissive_strength:new Gi(c)}),s.cP=c=>({u_matrix:new Yd(c),u_texsize:new Bo(c),u_pixels_to_tile_units:new Ig(c),u_device_pixel_ratio:new Gi(c),u_image:new Fl(c),u_units_to_pixels:new Bo(c),u_tile_units_to_pixels:new Gi(c),u_alpha_discard_threshold:new Gi(c),u_trim_offset:new Bo(c)}),s.cQ=Ji,s.cR=qU,s.cS=ZU,s.cT=ZA,s.cU=(c,n,a,d,g,h)=>{const y=c.transform,T=y.projection.name==="globe";let M;if(h.paint.get("circle-pitch-alignment")==="map")if(T){const v=GA(y.zoom,n.canonical)*y._pixelsPerMercatorPixel;M=Float32Array.from([v,0,0,v])}else M=y.calculatePixelsToTileUnitsMatrix(a);else M=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);const D={u_camera_to_center_distance:c.transform.getCameraToCenterDistance(y.projection),u_matrix:c.translatePosMatrix(n.projMatrix,a,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_device_pixel_ratio:kt.devicePixelRatio,u_extrude_scale:M,u_inv_rot_matrix:K8,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:h.paint.get("circle-emissive-strength")};if(T){D.u_inv_rot_matrix=d,D.u_merc_center=g,D.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],D.u_zoom_transition=lu(y.zoom);const v=g[0]*Mt,C=g[1]*Mt;D.u_up_dir=y.projection.upVector(new gi(0,0,0),v,C)}return D},s.cV=nD,s.cW=(c,n,a,d,g,h)=>{const y=c.transform;return{u_matrix:tD(c,n,a,d),u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:y.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:g,u_image:0,u_tile_units_to_pixels:eD(n,y),u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:h}},s.cX=(c,n,a,d,g,h,y)=>{const T=c.transform,M=T.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:tD(c,n,a,d),u_pixels_to_tile_units:M,u_device_pixel_ratio:h,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:g,u_texsize:rD(a)&&n.lineAtlasTexture?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:eD(n,c.transform),u_alpha_discard_threshold:0,u_trim_offset:y,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toRenderColor(a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength")}},s.cY=md,s.cZ=kg,s.c_=$I,s.ca=Ts,s.cb=function(c){return[Math.pow(c[0],1/2.2),Math.pow(c[1],1/2.2),Math.pow(c[2],1/2.2)]},s.cc=function(c){return c({pluginStatus:bi,pluginURL:Ja}),dg.on("pluginStateChange",c),c},s.cd=op,s.ce=W0,s.cf=tp,s.cg=aS,s.ch=Cm,s.ci=$x,s.cj=on,s.ck=ls,s.cl=Bs,s.cm=function(c){const n=c.indexOf(Qc);return n>=0?c.slice(0,n):c},s.cn=function(c){return c.indexOf(Qc)>=0},s.co=function(c){const n=c.indexOf(Qc);return n>=0?c.slice(n+1):""},s.cp=function(c){const n=[],a=c.id;return a===void 0&&n.push({message:`layers.${a}: missing required property "id"`}),c.render===void 0&&n.push({message:`layers.${a}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&n.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),n},s.cq=function(c,n,a,d){return c.type==="custom"?new E3(c,n):new O3[c.type](c,n,a,d)},s.cr=wc,s.cs=dg,s.ct=vd,s.cu=Ag,s.cv=class extends xa{constructor(c){super(c),this.current=Cw}set(c,n,a){if(this.fetchUniformLocation(c,n)){for(let d=0;d<9;d++)if(a[d]!==this.current[d]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},s.cw=Sl,s.cx=function(c,n,a){const d=lu(a.zoom),g=c.style.map._antialias,h=n.options.extStandardDerivativesForceOff||c.terrain&&c.terrain.exaggeration()>0;return d===0&&!g&&!h},s.cy=function(c){const n=c.pixelsPerMeter,a=n/fe(1,c.center.lat),d=Ie.mat4.identity(new Float64Array(16));return Ie.mat4.translate(d,d,[c.point.x,c.point.y,0]),Ie.mat4.scale(d,d,[a,a,n]),Float32Array.from(d)},s.cz=l0,s.d=function(c){return Re.API_TILEJSON_REGEX.test(c)},s.d$=k,s.d0=v0,s.d1=uu,s.d2=450,s.d3=7,s.d4=T3,s.d5=Bn,s.d6=Gf,s.d7=256,s.d8=Nw,s.d9=tl,s.dA=HA,s.dB=function(c){const n=[0,0,0],a=Ie.mat4.identity(new Float64Array(16));return Ie.mat4.multiply(a,c.pixelMatrix,c.globeMatrix),Ie.vec3.transformMat4(n,n,a),new Tt(n[0],n[1])},s.dC=function(c,n,a=!1){if(bi===Fd||bi===Bd||bi===Nf)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ja=kt.resolveURL(c),bi=Fd,Xc=n,ug(),a||fg()},s.dD=hg,s.dE=function(){W0().acquire(IS)},s.dF=function(){const c=oy;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(IS),oy=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.dG=sy,s.dH=function(c){const n=Er();if(!n)return;const a=n.delete(ln);c&&a.catch(c).then(()=>c())},s.dI=iy,s.dJ=LR,s.dK=function(c){DS=kt.resolveURL(c),cp||(cp=new op(W0(),new Mc)),cp.broadcast("setDracoUrl",DS)},s.dL=OR,s.dM=function(c){lp=kt.resolveURL(c),cp||(cp=new op(W0(),new Mc)),cp.broadcast("setMeshoptUrl",lp)},s.dN=Ot,s.dO=cu,s.dP=wa,s.dQ=WR,s.dR=qR,s.dS=XI,s.dT=El,s.dU=TD,s.dV=function(c,n,a,d,g,h,y,T,M,D,v){c.createArrays(),c.tilePixelRatio=Mt/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const C=c.layers[0].layout,I=c.layers[0]._unevaluatedLayout._values,P={};if(c.textSizeData.kind==="composite"){const{minZoom:V,maxZoom:X}=c.textSizeData;P.compositeTextSizes=[I["text-size"].possiblyEvaluate(new kr(V),T),I["text-size"].possiblyEvaluate(new kr(X),T)]}if(c.iconSizeData.kind==="composite"){const{minZoom:V,maxZoom:X}=c.iconSizeData;P.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new kr(V),T),I["icon-size"].possiblyEvaluate(new kr(X),T)]}P.layoutTextSize=I["text-size"].possiblyEvaluate(new kr(M+1),T),P.layoutIconSize=I["icon-size"].possiblyEvaluate(new kr(M+1),T),P.textMaxSize=I["text-size"].possiblyEvaluate(new kr(18),T);const A=C.get("text-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",N=C.get("text-size");let j=!1;for(const V of c.features)if(V.icon&&V.icon.nameSecondary){j=!0;break}for(const V of c.features){const X=C.get("text-font").evaluate(V,{},T).join(","),K=N.evaluate(V,{},T),$=P.layoutTextSize.evaluate(V,{},T),ne=(P.layoutIconSize.evaluate(V,{},T),{horizontal:{},vertical:void 0}),ie=V.text;let ue,pe=[0,0];if(ie){const Se=ie.toString(),_e=C.get("text-letter-spacing").evaluate(V,{},T)*Li,Ce=C.get("text-line-height").evaluate(V,{},T)*Li,Le=pw(Se)?_e:0,je=C.get("text-anchor").evaluate(V,{},T),ze=C.get("text-variable-anchor");if(!ze){const ct=C.get("text-radial-offset").evaluate(V,{},T);pe=ct?AD(je,[ct*Li,lS]):C.get("text-offset").evaluate(V,{},T).map(Je=>Je*Li)}let Fe=A?"center":C.get("text-justify").evaluate(V,{},T);const Ze=C.get("symbol-placement")==="point",Ve=Ze?C.get("text-max-width").evaluate(V,{},T)*Li:1/0,rt=ct=>{c.allowVerticalPlacement&&Df(Se)&&(ne.vertical=iS(ie,n,a,g,X,Ve,Ce,je,ct,Le,pe,mo.vertical,!0,$,K))};if(!A&&ze){const ct=Fe==="auto"?ze.map(Dt=>cS(Dt)):[Fe];let Je=!1;for(let Dt=0;Dt<ct.length;Dt++){const Pt=ct[Dt];if(!ne.horizontal[Pt])if(Je)ne.horizontal[Pt]=ne.horizontal[0];else{const xt=iS(ie,n,a,g,X,Ve,Ce,"center",Pt,Le,pe,mo.horizontal,!1,$,K);xt&&(ne.horizontal[Pt]=xt,Je=xt.positionedLines.length===1)}}rt("left")}else{if(Fe==="auto"&&(Fe=cS(je)),Ze||C.get("text-writing-mode").indexOf("horizontal")>=0||!Df(Se)){const ct=iS(ie,n,a,g,X,Ve,Ce,je,Fe,Le,pe,mo.horizontal,!1,$,K);ct&&(ne.horizontal[Fe]=ct)}rt(Ze?"left":Fe)}}let ge=!1;if(V.icon&&V.icon.namePrimary){const Se=d[V.icon.namePrimary];Se&&(ue=i3(g[V.icon.namePrimary],V.icon.nameSecondary?g[V.icon.nameSecondary]:void 0,C.get("icon-offset").evaluate(V,{},T),C.get("icon-anchor").evaluate(V,{},T)),ge=Se.sdf,c.sdfIcons===void 0?c.sdfIcons=Se.sdf:c.sdfIcons!==Se.sdf&&zn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Se.pixelRatio!==c.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0))}const he=DD(ne.horizontal)||ne.vertical;c.iconsInText||(c.iconsInText=!!he&&he.iconsInText),(he||ue)&&d3(c,V,ne,ue,d,P,$,0,pe,ge,y,T,D,v,j)}h&&c.generateCollisionDebugBuffers(M,c.collisionBoxArray)},s.dW=Jf,s.dX=G0,s.dY=Fi,s.dZ=vI,s.d_=cD,s.da=_a,s.db=Sg,s.dc=function(c,n,a,d,g){return mn((c-n)/(a-n)*(g-d)+d,d,g)},s.dd=Sf,s.de=Oe,s.df=class{constructor(c,n,a,d){this.context=c,this.format=d,this.size=a,this.texture=c.gl.createTexture();const[g,h,y]=this.size,{gl:T}=c;T.bindTexture(T.TEXTURE_3D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(!1),T.texImage3D(T.TEXTURE_3D,0,this.format,g,h,y,0,gS(this.format),yS(this.format),n.data)}bind(c,n){const{context:a}=this,{gl:d}=a;d.bindTexture(d.TEXTURE_3D,this.texture),c!==this.minFilter&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MAG_FILTER,c),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MIN_FILTER,c),this.minFilter=c),n!==this.wrapS&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_T,n),this.wrapS=n)}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}},s.dg=bS,s.dh=[1,1,1],s.di=sp,s.dj=ip,s.dk=nl,s.dl=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Tt(1/0,1/0),max:new Tt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(c,n=!1){const a=CI(new Tt(0,0),new Tt(Mt,Mt),c),d=[];if(n&&!qw(a,this._globalClipBounds))return d;for(const g of this._activeRegions){if(g.hiddenByOverlap||!qw(a,g))continue;const h=vU(g.min,g.max,c);d.push({min:h.min,max:h.max,sourceId:this._sourceIds[g.priority],footprint:g.footprint,footprintTileId:g.tileId,order:g.order,clipMask:g.clipMask,clipScope:g.clipScope})}return d}setSources(c){this._setSources(c.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const a=[];for(const d of n.cache.getVisibleCoordinates()){const g=n.cache.getTile(d).buckets[n.layer];g&&g.updateFootprints(d.toUnwrapped(),a)}return a},getOrder:()=>n.order,getClipMask:()=>n.clipMask,getClipScope:()=>n.clipScope})))}_addSource(c){const n=c.getFootprints();if(n.length===0)return;const a=c.getOrder(),d=c.getClipMask(),g=c.getClipScope();for(const h of n){if(!h.footprint)continue;const y=CI(h.footprint.min,h.footprint.max,h.id);this._activeRegions.push({min:y.min,max:y.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:h.id,footprint:h.footprint,order:a,clipMask:d,clipScope:g})}this._sourceIds.push(c.getSourceId())}_computeReplacement(){this._activeRegions.sort((n,a)=>n.priority-a.priority||_0(n.min,a.min)||_0(n.max,a.max)||n.order-a.order||n.clipMask-a.clipMask||function(d,g){const h=(y,T)=>y+T;return d.length-g.length||d.reduce(h,"").localeCompare(g.reduce(h,""))}(n.clipScope,a.clipScope));let c=this._activeRegions.length!==this._prevRegions.length;if(!c){let n=0;for(;!c&&n!==this._activeRegions.length;){const a=this._activeRegions[n],d=this._prevRegions[n];c=a.priority!==d.priority||!EI(a,d)||a.order!==d.order||a.clipMask!==d.clipMask||!ws(a.clipScope,d.clipScope),++n}}if(c){++this._updateTime;for(const a of this._activeRegions)a.order!==y0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));const n=a=>{const d=this._activeRegions;if(a>=d.length)return a;const g=d[a].priority;for(;a<d.length&&d[a].priority===g;)++a;return a};if(this._sourceIds.length>1){let a=0,d=n(a);for(;a!==d;){let g=a;const h=a;for(;g!==d;){const y=this._activeRegions[g];y.hiddenByOverlap=!1;for(let T=0;T<h;T++){const M=this._activeRegions[T];if(!M.hiddenByOverlap&&y.order===y0&&qw(y,M)&&(y.hiddenByOverlap=MI(y.footprint,y.tileId,M.footprint,M.tileId),y.hiddenByOverlap))break}++g}a=d,d=n(a)}}}}_setSources(c){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=c.length-1;n>=0;n--)this._addSource(c[n]);this._computeReplacement()}},s.dm=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy()}_fillGridMeshWithLods(c,n){const a=new Qa,d=new Ri,g=[],h=c+1+2,y=n[0]+1,T=n[0]+1+(1+n.length),M=(D,v,C)=>{let I=D===h-1?D-2:D===0?D:D-1;return I+=C?24575:0,[I,v]};for(let D=0;D<h;++D)a.emplaceBack(...M(D,0,!0));for(let D=0;D<y;++D)for(let v=0;v<h;++v)a.emplaceBack(...M(v,D,(v===0||v===h-1)&&!0));for(let D=0;D<n.length;++D){const v=n[D];for(let C=0;C<h;++C)a.emplaceBack(...M(C,v,!0))}for(let D=0;D<n.length;++D){const v=d.length,C=n[D]+1+2,I=new Ri;for(let N=0;N<C-1;N++){const j=N===C-2,V=j?h*(T-n.length+D-N):h;for(let X=0;X<h-1;X++){const K=N*h+X;N===0||j||X===0||X===h-2?(I.emplaceBack(K+1,K,K+V),I.emplaceBack(K+V,K+V+1,K+1)):(d.emplaceBack(K+1,K,K+V),d.emplaceBack(K+V,K+V+1,K+1))}}const P=Nr.simpleSegment(0,v,a.length,d.length-v);for(let N=0;N<I.uint16.length;N+=3)d.emplaceBack(I.uint16[N],I.uint16[N+1],I.uint16[N+2]);const A=Nr.simpleSegment(0,v,a.length,d.length-v);g.push({withoutSkirts:P,withSkirts:A})}return{vertices:a,indices:d,segments:g}}_createGrid(c){const n=this._fillGridMeshWithLods(w,E);this._gridSegments=n.segments,this._gridBuffer=c.createVertexBuffer(n.vertices,Gs.members),this._gridIndexBuffer=c.createIndexBuffer(n.indices,!0)}_createPoles(c){const n=new Ri;for(let y=0;y<=w;y++)n.emplaceBack(0,y+1,y+2);this._poleIndexBuffer=c.createIndexBuffer(n,!0);const a=new _a,d=new _a,g=new _a,h=new _a;this._poleSegments=[];for(let y=0,T=0;y<l;y++){const M=360/(1<<y);a.emplaceBack(0,-i,0,.5,0),d.emplaceBack(0,-i,0,.5,1),g.emplaceBack(0,-i,0,.5,.5),h.emplaceBack(0,-i,0,.5,.5);for(let D=0;D<=w;D++){let v=D/w,C=0;const I=Xt(0,M,v),[P,A,N]=z(X8,Y8,I,i);a.emplaceBack(P,A,N,v,C),d.emplaceBack(P,A,N,v,1-C);const j=wn(I);v=.5+.5*Math.sin(j),C=.5+.5*Math.cos(j),g.emplaceBack(P,A,N,v,C),h.emplaceBack(P,A,N,v,1-C)}this._poleSegments.push(Nr.simpleSegment(T,0,66,64)),T+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(a,Ds,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(d,Ds,!1),this._texturedPoleNorthVertexBuffer=c.createVertexBuffer(g,Ds,!1),this._texturedPoleSouthVertexBuffer=c.createVertexBuffer(h,Ds,!1)}getGridBuffers(c,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}},s.dn=y0,s.dp=Wa,s.dq=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.dr=xc,s.ds=ke,s.dt=B,s.du=function([c,n,a]){const d=Math.hypot(c,n,a),g=Math.atan2(c,a),h=.5*Math.PI-Math.acos(-n/d);return new Y(vi(g),vi(h))},s.dv=vS,s.dw=G,s.dx=function(c){const n=c.navigator?c.navigator.userAgent:null;return!!function(a){if(_d==null){const d=a.navigator?a.navigator.userAgent:null;_d=!!a.safari||!(!d||!(/\b(iPad|iPhone|iPod)\b/.test(d)||d.match("Safari")&&!d.match("Chrome")))}return _d}(c)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.dy=function(c,n){an=c,Xn=n},s.dz=Ow,s.e=Re,s.e0=function(c){let n=0;if(new Uint32Array(c,0,1)[0]!==zR){const a=new Uint32Array(c,0,7),[,,d,g,h,y]=a;n=a.byteLength+g+h+y+h,(d!==c.byteLength||n>=c.byteLength)&&zn("Invalid b3dm header information.")}return UR(c,n)},s.e1=function(c,n){const a=GR(c);for(const d of a){for(const g of d.meshes)w$(g);d.lights&&(d.lightMeshIndex=d.meshes.length,d.meshes.push(S$(d.lights,n)))}return a},s.e2=$0,s.e3=_R,s.e4=hs,s.e5=function(c){ei(),gn!=null&&gn.then(n=>{n.keys().then(a=>{for(let d=0;d<a.length-c;d++)n.delete(a[d])})})},s.f=function(c){return c.indexOf("mapbox:")===0},s.g=function(c,n){return vd(Bi(c,{method:"GET"}),n)},s.h=Ae,s.i=function(c){return Re.API_STYLE_REGEX.test(c)&&!Be(c)},s.j=function(c){return decodeURIComponent(atob(c).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.k=function(c){return btoa(encodeURIComponent(c).replace(/%([0-9A-F]{2})/g,(n,a)=>String.fromCharCode(+("0x"+a))))},s.l=Bi,s.m=Di,s.n=function(c,n){return vd(Bi(c,{type:"json"}),n)},s.o=Lo,s.p=function(c,n){return vd(Bi(c,{method:"POST"}),n)},s.q=kt,s.r=ts,s.s=function(c){try{const n=self[c];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=wd,s.u=function(){return function c(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()},s.v=function(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)},s.w=zn,s.x=Ha,s.y=2,s.z=SD}),_(["./shared"],function(s){function k(Ke){const ce=Ke?Ke.url.toString():void 0;return ce?performance.getEntriesByName(ce):[]}function O(Ke){if(typeof Ke=="number"||typeof Ke=="boolean"||typeof Ke=="string"||Ke==null)return JSON.stringify(Ke);if(Array.isArray(Ke)){let de="[";for(const we of Ke)de+=`${O(we)},`;return`${de}]`}let ce="{";for(const de of Object.keys(Ke).sort())ce+=`${de}:${O(Ke[de])},`;return`${ce}}`}function F(Ke){let ce="";for(const de of s.bg)ce+=`/${O(Ke[de])}`;return ce}class q{constructor(ce){this.keyCache={},this._layers={},this._layerConfigs={},ce&&this.replace(ce)}replace(ce,de){this._layerConfigs={},this._layers={},this.update(ce,[],de)}update(ce,de,we){this._options=we;for(const Ae of ce)this._layerConfigs[Ae.id]=Ae,(this._layers[Ae.id]=s.cq(Ae,this.scope,null,this._options)).compileFilter(we),this.keyCache[Ae.id]&&delete this.keyCache[Ae.id];for(const Ae of de)delete this.keyCache[Ae],delete this._layerConfigs[Ae],delete this._layers[Ae];this.familiesBySource={};const Re=function(Ae,Be){const Xe={};for(let Ye=0;Ye<Ae.length;Ye++){const st=Be&&Be[Ae[Ye].id]||F(Ae[Ye]);Be&&(Be[Ae[Ye].id]=st);let nt=Xe[st];nt||(nt=Xe[st]=[]),nt.push(Ae[Ye])}const Ge=[];for(const Ye in Xe)Ge.push(Xe[Ye]);return Ge}(s.bd(this._layerConfigs),this.keyCache);for(const Ae of Re){const Be=Ae.map(yt=>this._layers[yt.id]),Xe=Be[0];if(Xe.visibility==="none")continue;const Ge=Xe.source||"";let Ye=this.familiesBySource[Ge];Ye||(Ye=this.familiesBySource[Ge]={});const st=Xe.sourceLayer||"_geojsonTileLayer";let nt=Ye[st];nt||(nt=Ye[st]=[]),nt.push(Be)}}}const H=1*s.dP;class J{constructor(ce){const de={},we=[];for(const Xe in ce){const Ge=ce[Xe],Ye=de[Xe]={};for(const st in Ge.glyphs){const nt=Ge.glyphs[+st];if(!nt||nt.bitmap.width===0||nt.bitmap.height===0)continue;const yt=nt.metrics.localGlyph?H:1,Rt={x:0,y:0,w:nt.bitmap.width+2*yt,h:nt.bitmap.height+2*yt};we.push(Rt),Ye[st]=Rt}}const{w:Re,h:Ae}=s.z(we),Be=new s.dO({width:Re||1,height:Ae||1});for(const Xe in ce){const Ge=ce[Xe];for(const Ye in Ge.glyphs){const st=Ge.glyphs[+Ye];if(!st||st.bitmap.width===0||st.bitmap.height===0)continue;const nt=de[Xe][Ye],yt=st.metrics.localGlyph?H:1;s.dO.copy(st.bitmap,Be,{x:0,y:0},{x:nt.x+yt,y:nt.y+yt},st.bitmap)}}this.image=Be,this.positions=de}}s.dN(J,"GlyphAtlas");class U{constructor(ce){this.tileID=new s.aA(ce.tileID.overscaledZ,ce.tileID.wrap,ce.tileID.canonical.z,ce.tileID.canonical.x,ce.tileID.canonical.y),this.tileZoom=ce.tileZoom,this.uid=ce.uid,this.zoom=ce.zoom,this.lut=ce.lut,this.canonical=ce.tileID.canonical,this.pixelRatio=ce.pixelRatio,this.tileSize=ce.tileSize,this.source=ce.source,this.scope=ce.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ce.showCollisionBoxes,this.collectResourceTiming=!!ce.collectResourceTiming,this.promoteId=ce.promoteId,this.isSymbolTile=ce.isSymbolTile,this.tileTransform=s.aK(ce.tileID.canonical,ce.projection),this.projection=ce.projection,this.brightness=ce.brightness,this.extraShadowCaster=!!ce.extraShadowCaster,this.tessellationStep=ce.tessellationStep}parse(ce,de,we,Re,Ae){this.status="parsing",this.data=ce,this.collisionBoxArray=new s.aQ;const Be=new s.dQ(Object.keys(ce.layers).sort()),Xe=new s.dR(this.tileID,this.promoteId);Xe.bucketLayerIDs=[];const Ge={},Ye=new s.dS(256,256),st={featureIndex:Xe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Ye,availableImages:we,brightness:this.brightness},nt=de.familiesBySource[this.source];for(const an in nt){const Xn=ce.layers[an];if(!Xn)continue;let rr=!1,gn=!1,tr=!1;for(const si of nt[an])si[0].type==="symbol"?rr=!0:gn=!0,si[0].is3D()&&si[0].type!=="model"&&(tr=!0);if(this.extraShadowCaster&&!tr||this.isSymbolTile===!0&&!rr||this.isSymbolTile===!1&&!gn)continue;Xn.version===1&&s.w(`Vector tile source "${this.source}" layer "${an}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Er=Be.encode(an),ei=[];for(let si=0;si<Xn.length;si++){const Di=Xn.feature(si),so=Xe.getId(Di,an);ei.push({feature:Di,id:so,index:si,sourceLayerIndex:Er})}for(const si of nt[an]){const Di=si[0];(!this.extraShadowCaster||Di.is3D()&&Di.type!=="model")&&(this.isSymbolTile!==void 0&&Di.type==="symbol"!==this.isSymbolTile||Di.minzoom&&this.zoom<Math.floor(Di.minzoom)||Di.maxzoom&&this.zoom>=Di.maxzoom||Di.visibility!=="none"&&(te(si,this.zoom,st.brightness,we),(Ge[Di.id]=Di.createBucket({index:Xe.bucketLayerIDs.length,layers:si,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Er,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(ei,st,this.tileID.canonical,this.tileTransform),Xe.bucketLayerIDs.push(si.map(so=>so.id))))}}let yt,Rt,kt,rn;Ye.trim();const on={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ln=()=>{if(yt)return this.status="done",Ae(yt);if(this.extraShadowCaster)this.status="done",Ae(null,{buckets:s.bd(Ge).filter(an=>!an.isEmpty()),featureIndex:Xe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:st.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Rt&&kt&&rn){const an=new J(Rt),Xn=new s.dU(kt,rn,this.lut);for(const rr in Ge){const gn=Ge[rr];gn instanceof s.aR?(te(gn.layers,this.zoom,st.brightness,we),s.dV(gn,Rt,an.positions,kt,Xn.iconPositions,this.showCollisionBoxes,we,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):gn.hasPattern&&(gn instanceof s.aX||gn instanceof s.aY||gn instanceof s.d0)&&(te(gn.layers,this.zoom,st.brightness,we),gn.addFeatures(st,this.tileID.canonical,Xn.patternPositions,we,this.tileTransform,this.brightness))}this.status="done",Ae(null,{buckets:s.bd(Ge).filter(rr=>!rr.isEmpty()),featureIndex:Xe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:an.image,lineAtlas:Ye,imageAtlas:Xn,brightness:st.brightness})}};if(!this.extraShadowCaster){const an=s.dT(st.glyphDependencies,gn=>Object.keys(gn).map(Number));Object.keys(an).length?Re.send("getGlyphs",{uid:this.uid,stacks:an,scope:this.scope},(gn,tr)=>{yt||(yt=gn,Rt=tr,ln())},void 0,!1,on):Rt={};const Xn=Object.keys(st.iconDependencies);Xn.length?Re.send("getImages",{icons:Xn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(gn,tr)=>{yt||(yt=gn,kt=tr,ln())},void 0,!1,on):kt={};const rr=Object.keys(st.patternDependencies);rr.length?Re.send("getImages",{icons:rr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(gn,tr)=>{yt||(yt=gn,rn=tr,ln())},void 0,!1,on):rn={}}ln()}}function te(Ke,ce,de,we){const Re=new s.a3(ce,{brightness:de});for(const Ae of Ke)Ae.recalculate(Re,we)}class Q extends s.E{constructor(ce,de,we,Re,Ae,Be){super(),this.actor=ce,this.layerIndex=de,this.availableImages=we,this.loadVectorData=Ae||s.aw,this.loading={},this.loaded={},this.deduped=new s.au(ce.scheduler),this.isSpriteLoaded=Re,this.scheduler=ce.scheduler,this.brightness=Be}loadTile(ce,de){const we=ce.uid,Re=ce&&ce.request,Ae=Re&&Re.collectResourceTiming,Be=this.loading[we]=new U(ce);Be.abort=this.loadVectorData(ce,(Xe,Ge)=>{const Ye=!this.loading[we];if(delete this.loading[we],Ye||Xe||!Ge)return Be.status="done",Ye||(this.loaded[we]=Be),de(Xe);const st=Ge.rawData,nt={};Ge.expires&&(nt.expires=Ge.expires),Ge.cacheControl&&(nt.cacheControl=Ge.cacheControl),Be.vectorTile=Ge.vectorTile||new s.dW.VectorTile(new s.bb(st));const yt=()=>{Be.parse(Be.vectorTile,this.layerIndex,this.availableImages,this.actor,(Rt,kt)=>{if(Rt||!kt)return de(Rt);const rn={};if(Ae){const on=k(Re);on.length>0&&(rn.resourceTiming=JSON.parse(JSON.stringify(on)))}de(null,s.l({rawTileData:st.slice(0)},kt,nt,rn))})};this.isSpriteLoaded?yt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(yt,{type:"parseTile",isSymbolTile:ce.isSymbolTile,zoom:ce.tileZoom}):yt()}),this.loaded=this.loaded||{},this.loaded[we]=Be})}reloadTile(ce,de){const we=this.loaded,Re=ce.uid;if(we&&we[Re]){const Ae=we[Re];Ae.showCollisionBoxes=ce.showCollisionBoxes,Ae.projection=ce.projection,Ae.brightness=ce.brightness,Ae.tileTransform=s.aK(ce.tileID.canonical,ce.projection),Ae.extraShadowCaster=ce.extraShadowCaster,Ae.lut=ce.lut;const Be=(Xe,Ge)=>{const Ye=Ae.reloadCallback;Ye&&(delete Ae.reloadCallback,Ae.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.actor,Ye)),de(Xe,Ge)};Ae.status==="parsing"?Ae.reloadCallback=Be:Ae.status==="done"&&(Ae.vectorTile?Ae.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.actor,Be):Be())}else de(null,void 0)}abortTile(ce,de){const we=ce.uid,Re=this.loading[we];Re&&(Re.abort&&Re.abort(),delete this.loading[we]),de()}removeTile(ce,de){const we=this.loaded,Re=ce.uid;we&&we[Re]&&delete we[Re],de()}}class ee{loadTile(ce,de){const{uid:we,encoding:Re,rawImageData:Ae,padding:Be}=ce,Xe=ImageBitmap&&Ae instanceof ImageBitmap?this.getImageData(Ae,Be):Ae;de(null,new s.dX(we,Xe,Re,Be<1))}getImageData(ce,de){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ce.width,ce.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ce.width,this.offscreenCanvas.height=ce.height,this.offscreenCanvasContext.drawImage(ce,0,0,ce.width,ce.height);const we=this.offscreenCanvasContext.getImageData(-de,-de,ce.width+2*de,ce.height+2*de);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),we}}s.ba.setPbf(s.bb);class re{decodeRasterArray({task:ce,buffer:de},we){s.ba.performDecoding(de,ce).then(Re=>{we(null,Re)},Re=>{we(Re)})}}const xe=s.dW.VectorTileFeature.prototype.toGeoJSON;class Ee{constructor(ce){this._feature=ce,this.extent=s.ab,this.type=ce.type,this.properties=ce.tags,"id"in ce&&!isNaN(ce.id)&&(this.id=parseInt(ce.id,10))}loadGeometry(){if(this._feature.type===1){const ce=[];for(const de of this._feature.geometry)ce.push([new s.P(de[0],de[1])]);return ce}{const ce=[];for(const de of this._feature.geometry){const we=[];for(const Re of de)we.push(new s.P(Re[0],Re[1]));ce.push(we)}return ce}}toGeoJSON(ce,de,we){return xe.call(this,ce,de,we)}}class He{constructor(ce){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.ab,this.length=ce.length,this._features=ce}feature(ce){return new Ee(this._features[ce])}}const qe=64/4096,Ne=128;class ft{constructor(){this.features=new Map}clear(){this.features.clear()}load(ce=[],de){for(const we of ce){const Re=we.id;if(Re==null)continue;let Ae=this.features.get(Re);Ae&&this.updateCache(Ae,de),we.geometry?(Ae=mt(we),this.updateCache(Ae,de),this.features.set(Re,Ae)):this.features.delete(Re),this.updateCache(Ae,de)}}updateCache(ce,de){for(const{canonical:we,uid:Re}of Object.values(de)){const{z:Ae,x:Be,y:Xe}=we;ut(ce,Math.pow(2,Ae),Be,Xe)&&delete de[Re]}}getTile(ce,de,we){const Re=Math.pow(2,ce),Ae=[];for(const Be of this.features.values())ut(Be,Re,de,we)&&Ae.push(dn(Be,Re,de,we));return{features:Ae}}getFeatures(){return[...this.features.values()]}}function ut({minX:Ke,minY:ce,maxX:de,maxY:we},Re,Ae,Be){return Ke<(Ae+1+qe)/Re&&ce<(Be+1+qe)/Re&&de>(Ae-qe)/Re&&we>(Be-qe)/Re}function mt(Ke){const{id:ce,geometry:de,properties:we}=Ke;if(!de)return;if(de.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Re,coordinates:Ae}=de,Be={id:ce,type:1,geometry:[],tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Xe=Be.geometry;if(Re==="Point")pt(Ae,Xe,Be);else if(Re==="MultiPoint")for(const Ge of Ae)pt(Ge,Xe,Be);else if(Re==="LineString")Be.type=2,en(Ae,Xe,Be);else if(Re==="MultiLineString")Be.type=2,Yt(Ae,Xe,Be);else if(Re==="Polygon")Be.type=3,Yt(Ae,Xe,Be,!0);else{if(Re!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Be.type=3;for(const Ge of Ae)Yt(Ge,Xe,Be,!0)}return Be}function pt([Ke,ce],de,we){const Re=s.am(Ke);let Ae=s.at(ce);Ae=Ae<0?0:Ae>1?1:Ae,de.push(Re,Ae),we.minX=Math.min(we.minX,Re),we.minY=Math.min(we.minY,Ae),we.maxX=Math.max(we.maxX,Re),we.maxY=Math.max(we.maxY,Ae)}function en(Ke,ce,de,we=!1,Re=!1){const Ae=[];for(const Be of Ke)pt(Be,Ae,de);ce.push(Ae),we&&function(Be,Xe){let Ge=0;for(let Ye=0,st=Be.length,nt=st-2;Ye<st;nt=Ye,Ye+=2)Ge+=(Be[Ye]-Be[nt])*(Be[Ye+1]+Be[nt+1]);if(Ge>0===Xe)for(let Ye=0,st=Be.length;Ye<st/2;Ye+=2){const nt=Be[Ye],yt=Be[Ye+1];Be[Ye]=Be[st-2-Ye],Be[Ye+1]=Be[st-1-Ye],Be[st-2-Ye]=nt,Be[st-1-Ye]=yt}}(Ae,Re)}function Yt(Ke,ce,de,we=!1){for(let Re=0;Re<Ke.length;Re++)en(Ke[Re],ce,de,we,Re===0)}function dn(Ke,ce,de,we){const{id:Re,type:Ae,geometry:Be,tags:Xe}=Ke,Ge=[];if(Ae===1)(function(Ye,st,nt,yt,Rt){for(let kt=0;kt<Ye.length;kt+=2){const rn=Math.round(s.ab*(Ye[kt+0]*st-nt)),on=Math.round(s.ab*(Ye[kt+1]*st-yt));Rt.push([rn,on])}})(Be,ce,de,we,Ge);else for(const Ye of Be)It(Ye,ce,de,we,Ge);return{id:Re,type:Ae,geometry:Ge,tags:Xe}}function It(Ke,ce,de,we,Re){const Ae=-Ne,Be=s.ab+Ne;let Xe;for(let Ge=0;Ge<Ke.length-2;Ge+=2){let Ye=Math.round(s.ab*(Ke[Ge+0]*ce-de)),st=Math.round(s.ab*(Ke[Ge+1]*ce-we)),nt=Math.round(s.ab*(Ke[Ge+2]*ce-de)),yt=Math.round(s.ab*(Ke[Ge+3]*ce-we));const Rt=nt-Ye,kt=yt-st;Ye<Ae&&nt<Ae||(Ye<Ae?(st+=Math.round(kt*((Ae-Ye)/Rt)),Ye=Ae):nt<Ae&&(yt=st+Math.round(kt*((Ae-Ye)/Rt)),nt=Ae),st<Ae&&yt<Ae||(st<Ae?(Ye+=Math.round(Rt*((Ae-st)/kt)),st=Ae):yt<Ae&&(nt=Ye+Math.round(Rt*((Ae-st)/kt)),yt=Ae),Ye>=Be&&nt>=Be||(Ye>=Be?(st+=Math.round(kt*((Be-Ye)/Rt)),Ye=Be):nt>=Be&&(yt=st+Math.round(kt*((Be-Ye)/Rt)),nt=Be),st>=Be&&yt>=Be||(st>=Be?(Ye+=Math.round(Rt*((Be-st)/kt)),st=Be):yt>=Be&&(nt=Ye+Math.round(Rt*((Be-st)/kt)),yt=Be),Xe&&Ye===Xe[Xe.length-1][0]&&st===Xe[Xe.length-1][1]||(Xe=[[Ye,st]],Re.push(Xe)),Xe.push([nt,yt])))))}}var Et,tt,Ft,St={exports:{}},hn=function(){if(Ft)return St.exports;Ft=1;var Ke=s.d_(),ce=function(){if(tt)return Et;tt=1;var st=s.dY(),nt=s.dZ().VectorTileFeature;function yt(kt,rn){this.options=rn||{},this.features=kt,this.length=kt.length}function Rt(kt,rn){this.id=typeof kt.id=="number"?kt.id:void 0,this.type=kt.type,this.rawGeometry=kt.type===1?[kt.geometry]:kt.geometry,this.properties=kt.tags,this.extent=rn||4096}return Et=yt,yt.prototype.feature=function(kt){return new Rt(this.features[kt],this.options.extent)},Rt.prototype.loadGeometry=function(){var kt=this.rawGeometry;this.geometry=[];for(var rn=0;rn<kt.length;rn++){for(var on=kt[rn],ln=[],an=0;an<on.length;an++)ln.push(new st(on[an][0],on[an][1]));this.geometry.push(ln)}return this.geometry},Rt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var kt=this.geometry,rn=1/0,on=-1/0,ln=1/0,an=-1/0,Xn=0;Xn<kt.length;Xn++)for(var rr=kt[Xn],gn=0;gn<rr.length;gn++){var tr=rr[gn];rn=Math.min(rn,tr.x),on=Math.max(on,tr.x),ln=Math.min(ln,tr.y),an=Math.max(an,tr.y)}return[rn,ln,on,an]},Rt.prototype.toGeoJSON=nt.prototype.toGeoJSON,Et}();function de(st){var nt=new Ke;return function(yt,Rt){for(var kt in yt.layers)Rt.writeMessage(3,we,yt.layers[kt])}(st,nt),nt.finish()}function we(st,nt){var yt;nt.writeVarintField(15,st.version||1),nt.writeStringField(1,st.name||""),nt.writeVarintField(5,st.extent||4096);var Rt={keys:[],values:[],keycache:{},valuecache:{}};for(yt=0;yt<st.length;yt++)Rt.feature=st.feature(yt),nt.writeMessage(2,Re,Rt);var kt=Rt.keys;for(yt=0;yt<kt.length;yt++)nt.writeStringField(3,kt[yt]);var rn=Rt.values;for(yt=0;yt<rn.length;yt++)nt.writeMessage(4,Ye,rn[yt])}function Re(st,nt){var yt=st.feature;yt.id!==void 0&&nt.writeVarintField(1,yt.id),nt.writeMessage(2,Ae,st),nt.writeVarintField(3,yt.type),nt.writeMessage(4,Ge,yt)}function Ae(st,nt){var yt=st.feature,Rt=st.keys,kt=st.values,rn=st.keycache,on=st.valuecache;for(var ln in yt.properties){var an=yt.properties[ln],Xn=rn[ln];if(an!==null){Xn===void 0&&(Rt.push(ln),rn[ln]=Xn=Rt.length-1),nt.writeVarint(Xn);var rr=typeof an;rr!=="string"&&rr!=="boolean"&&rr!=="number"&&(an=JSON.stringify(an));var gn=rr+":"+an,tr=on[gn];tr===void 0&&(kt.push(an),on[gn]=tr=kt.length-1),nt.writeVarint(tr)}}}function Be(st,nt){return(nt<<3)+(7&st)}function Xe(st){return st<<1^st>>31}function Ge(st,nt){for(var yt=st.loadGeometry(),Rt=st.type,kt=0,rn=0,on=yt.length,ln=0;ln<on;ln++){var an=yt[ln],Xn=1;Rt===1&&(Xn=an.length),nt.writeVarint(Be(1,Xn));for(var rr=Rt===3?an.length-1:an.length,gn=0;gn<rr;gn++){gn===1&&Rt!==1&&nt.writeVarint(Be(2,rr-1));var tr=an[gn].x-kt,Er=an[gn].y-rn;nt.writeVarint(Xe(tr)),nt.writeVarint(Xe(Er)),kt+=tr,rn+=Er}Rt===3&&nt.writeVarint(Be(7,1))}}function Ye(st,nt){var yt=typeof st;yt==="string"?nt.writeStringField(1,st):yt==="boolean"?nt.writeBooleanField(7,st):yt==="number"&&(st%1!=0?nt.writeDoubleField(3,st):st<0?nt.writeSVarintField(6,st):nt.writeVarintField(5,st))}return St.exports=de,St.exports.fromVectorTileJs=de,St.exports.fromGeojsonVt=function(st,nt){nt=nt||{};var yt={};for(var Rt in st)yt[Rt]=new ce(st[Rt].features,nt),yt[Rt].name=Rt,yt[Rt].version=nt.version,yt[Rt].extent=nt.extent;return de({layers:yt})},St.exports.GeoJSONWrapper=ce,St.exports}(),Un=s.d$(hn);const wr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ke=>Ke},Ut=Math.fround||(Cr=new Float32Array(1),Ke=>(Cr[0]=+Ke,Cr[0]));var Cr;const or=3,Qt=5,dr=6;class Jr{constructor(ce){this.options=Object.assign(Object.create(wr),ce),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ce){const{log:de,minZoom:we,maxZoom:Re}=this.options;de&&console.time("total time");const Ae=`prepare ${ce.length} points`;de&&console.time(Ae),this.points=ce;const Be=[];for(let Ge=0;Ge<ce.length;Ge++){const Ye=ce[Ge];if(!Ye.geometry)continue;const[st,nt]=Ye.geometry.coordinates,yt=Ut(er(st)),Rt=Ut(Qr(nt));Be.push(yt,Rt,1/0,Ge,-1,1),this.options.reduce&&Be.push(0)}let Xe=this.trees[Re+1]=this._createTree(Be);de&&console.timeEnd(Ae);for(let Ge=Re;Ge>=we;Ge--){const Ye=+Date.now();Xe=this.trees[Ge]=this._createTree(this._cluster(Xe,Ge)),de&&console.log("z%d: %d clusters in %dms",Ge,Xe.numItems,+Date.now()-Ye)}return de&&console.timeEnd("total time"),this}getClusters(ce,de){let we=((ce[0]+180)%360+360)%360-180;const Re=Math.max(-90,Math.min(90,ce[1]));let Ae=ce[2]===180?180:((ce[2]+180)%360+360)%360-180;const Be=Math.max(-90,Math.min(90,ce[3]));if(ce[2]-ce[0]>=360)we=-180,Ae=180;else if(we>Ae){const nt=this.getClusters([we,Re,180,Be],de),yt=this.getClusters([-180,Re,Ae,Be],de);return nt.concat(yt)}const Xe=this.trees[this._limitZoom(de)],Ge=Xe.range(er(we),Qr(Be),er(Ae),Qr(Re)),Ye=Xe.data,st=[];for(const nt of Ge){const yt=this.stride*nt;st.push(Ye[yt+Qt]>1?hr(Ye,yt,this.clusterProps):this.points[Ye[yt+or]])}return st}getChildren(ce){const de=this._getOriginId(ce),we=this._getOriginZoom(ce),Re="No cluster with the specified id.",Ae=this.trees[we];if(!Ae)throw new Error(Re);const Be=Ae.data;if(de*this.stride>=Be.length)throw new Error(Re);const Xe=this.options.radius/(this.options.extent*Math.pow(2,we-1)),Ge=Ae.within(Be[de*this.stride],Be[de*this.stride+1],Xe),Ye=[];for(const st of Ge){const nt=st*this.stride;Be[nt+4]===ce&&Ye.push(Be[nt+Qt]>1?hr(Be,nt,this.clusterProps):this.points[Be[nt+or]])}if(Ye.length===0)throw new Error(Re);return Ye}getLeaves(ce,de,we){const Re=[];return this._appendLeaves(Re,ce,de=de||10,we=we||0,0),Re}getTile(ce,de,we){const Re=this.trees[this._limitZoom(ce)],Ae=Math.pow(2,ce),{extent:Be,radius:Xe}=this.options,Ge=Xe/Be,Ye=(we-Ge)/Ae,st=(we+1+Ge)/Ae,nt={features:[]};return this._addTileFeatures(Re.range((de-Ge)/Ae,Ye,(de+1+Ge)/Ae,st),Re.data,de,we,Ae,nt),de===0&&this._addTileFeatures(Re.range(1-Ge/Ae,Ye,1,st),Re.data,Ae,we,Ae,nt),de===Ae-1&&this._addTileFeatures(Re.range(0,Ye,Ge/Ae,st),Re.data,-1,we,Ae,nt),nt.features.length?nt:null}getClusterExpansionZoom(ce){let de=this._getOriginZoom(ce)-1;for(;de<=this.options.maxZoom;){const we=this.getChildren(ce);if(de++,we.length!==1)break;ce=we[0].properties.cluster_id}return de}_appendLeaves(ce,de,we,Re,Ae){const Be=this.getChildren(de);for(const Xe of Be){const Ge=Xe.properties;if(Ge&&Ge.cluster?Ae+Ge.point_count<=Re?Ae+=Ge.point_count:Ae=this._appendLeaves(ce,Ge.cluster_id,we,Re,Ae):Ae<Re?Ae++:ce.push(Xe),ce.length===we)break}return Ae}_createTree(ce){const de=new s.by(ce.length/this.stride|0,this.options.nodeSize,Float32Array);for(let we=0;we<ce.length;we+=this.stride)de.add(ce[we],ce[we+1]);return de.finish(),de.data=ce,de}_addTileFeatures(ce,de,we,Re,Ae,Be){for(const Xe of ce){const Ge=Xe*this.stride,Ye=de[Ge+Qt]>1;let st,nt,yt;if(Ye)st=Ie(de,Ge,this.clusterProps),nt=de[Ge],yt=de[Ge+1];else{const rn=this.points[de[Ge+or]];st=rn.properties;const[on,ln]=rn.geometry.coordinates;nt=er(on),yt=Qr(ln)}const Rt={type:1,geometry:[[Math.round(this.options.extent*(nt*Ae-we)),Math.round(this.options.extent*(yt*Ae-Re))]],tags:st};let kt;kt=Ye||this.options.generateId?de[Ge+or]:this.points[de[Ge+or]].id,kt!==void 0&&(Rt.id=kt),Be.features.push(Rt)}}_limitZoom(ce){return Math.max(this.options.minZoom,Math.min(Math.floor(+ce),this.options.maxZoom+1))}_cluster(ce,de){const{radius:we,extent:Re,reduce:Ae,minPoints:Be}=this.options,Xe=we/(Re*Math.pow(2,de)),Ge=ce.data,Ye=[],st=this.stride;for(let nt=0;nt<Ge.length;nt+=st){if(Ge[nt+2]<=de)continue;Ge[nt+2]=de;const yt=Ge[nt],Rt=Ge[nt+1],kt=ce.within(Ge[nt],Ge[nt+1],Xe),rn=Ge[nt+Qt];let on=rn;for(const ln of kt){const an=ln*st;Ge[an+2]>de&&(on+=Ge[an+Qt])}if(on>rn&&on>=Be){let ln,an=yt*rn,Xn=Rt*rn,rr=-1;const gn=(nt/st<<5)+(de+1)+this.points.length;for(const tr of kt){const Er=tr*st;if(Ge[Er+2]<=de)continue;Ge[Er+2]=de;const ei=Ge[Er+Qt];an+=Ge[Er]*ei,Xn+=Ge[Er+1]*ei,Ge[Er+4]=gn,Ae&&(ln||(ln=this._map(Ge,nt,!0),rr=this.clusterProps.length,this.clusterProps.push(ln)),Ae(ln,this._map(Ge,Er)))}Ge[nt+4]=gn,Ye.push(an/on,Xn/on,1/0,gn,-1,on),Ae&&Ye.push(rr)}else{for(let ln=0;ln<st;ln++)Ye.push(Ge[nt+ln]);if(on>1)for(const ln of kt){const an=ln*st;if(!(Ge[an+2]<=de)){Ge[an+2]=de;for(let Xn=0;Xn<st;Xn++)Ye.push(Ge[an+Xn])}}}}return Ye}_getOriginId(ce){return ce-this.points.length>>5}_getOriginZoom(ce){return(ce-this.points.length)%32}_map(ce,de,we){if(ce[de+Qt]>1){const Be=this.clusterProps[ce[de+dr]];return we?Object.assign({},Be):Be}const Re=this.points[ce[de+or]].properties,Ae=this.options.map(Re);return we&&Ae===Re?Object.assign({},Ae):Ae}}function hr(Ke,ce,de){return{type:"Feature",id:Ke[ce+or],properties:Ie(Ke,ce,de),geometry:{type:"Point",coordinates:[(we=Ke[ce],360*(we-.5)),Fi(Ke[ce+1])]}};var we}function Ie(Ke,ce,de){const we=Ke[ce+Qt],Re=we>=1e4?`${Math.round(we/1e3)}k`:we>=1e3?Math.round(we/100)/10+"k":we,Ae=Ke[ce+dr],Be=Ae===-1?{}:Object.assign({},de[Ae]);return Object.assign(Be,{cluster:!0,cluster_id:Ke[ce+or],point_count:we,point_count_abbreviated:Re})}function er(Ke){return Ke/360+.5}function Qr(Ke){const ce=Math.sin(Ke*Math.PI/180),de=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return de<0?0:de>1?1:de}function Fi(Ke){const ce=(180-360*Ke)*Math.PI/180;return 360*Math.atan(Math.exp(ce))/Math.PI-90}function Tt(Ke,ce,de,we){let Re=we;const Ae=ce+(de-ce>>1);let Be,Xe=de-ce;const Ge=Ke[ce],Ye=Ke[ce+1],st=Ke[de],nt=Ke[de+1];for(let yt=ce+3;yt<de;yt+=3){const Rt=ws(Ke[yt],Ke[yt+1],Ge,Ye,st,nt);if(Rt>Re)Be=yt,Re=Rt;else if(Rt===Re){const kt=Math.abs(yt-Ae);kt<Xe&&(Be=yt,Xe=kt)}}Re>we&&(Be-ce>3&&Tt(Ke,ce,Be,we),Ke[Be+2]=Re,de-Be>3&&Tt(Ke,Be,de,we))}function ws(Ke,ce,de,we,Re,Ae){let Be=Re-de,Xe=Ae-we;if(Be!==0||Xe!==0){const Ge=((Ke-de)*Be+(ce-we)*Xe)/(Be*Be+Xe*Xe);Ge>1?(de=Re,we=Ae):Ge>0&&(de+=Be*Ge,we+=Xe*Ge)}return Be=Ke-de,Xe=ce-we,Be*Be+Xe*Xe}function Br(Ke,ce,de,we){const Re={id:Ke??null,type:ce,geometry:de,tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ce==="Point"||ce==="MultiPoint"||ce==="LineString")ro(Re,de);else if(ce==="Polygon")ro(Re,de[0]);else if(ce==="MultiLineString")for(const Ae of de)ro(Re,Ae);else if(ce==="MultiPolygon")for(const Ae of de)ro(Re,Ae[0]);return Re}function ro(Ke,ce){for(let de=0;de<ce.length;de+=3)Ke.minX=Math.min(Ke.minX,ce[de]),Ke.minY=Math.min(Ke.minY,ce[de+1]),Ke.maxX=Math.max(Ke.maxX,ce[de]),Ke.maxY=Math.max(Ke.maxY,ce[de+1])}function wn(Ke,ce,de,we){if(!ce.geometry)return;const Re=ce.geometry.coordinates;if(Re&&Re.length===0)return;const Ae=ce.geometry.type,Be=Math.pow(de.tolerance/((1<<de.maxZoom)*de.extent),2);let Xe=[],Ge=ce.id;if(de.promoteId?Ge=ce.properties[de.promoteId]:de.generateId&&(Ge=we||0),Ae==="Point")vi(Re,Xe);else if(Ae==="MultiPoint")for(const Ye of Re)vi(Ye,Xe);else if(Ae==="LineString")io(Re,Xe,Be,!1);else if(Ae==="MultiLineString"){if(de.lineMetrics){for(const Ye of Re)Xe=[],io(Ye,Xe,Be,!1),Ke.push(Br(Ge,"LineString",Xe,ce.properties));return}Sl(Re,Xe,Be,!1)}else if(Ae==="Polygon")Sl(Re,Xe,Be,!0);else{if(Ae!=="MultiPolygon"){if(Ae==="GeometryCollection"){for(const Ye of ce.geometry.geometries)wn(Ke,{id:Ge,geometry:Ye,properties:ce.properties},de,we);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ye of Re){const st=[];Sl(Ye,st,Be,!0),Xe.push(st)}}Ke.push(Br(Ge,Ae,Xe,ce.properties))}function vi(Ke,ce){ce.push(Wa(Ke[0]),xc(Ke[1]),0)}function io(Ke,ce,de,we){let Re,Ae,Be=0;for(let Ge=0;Ge<Ke.length;Ge++){const Ye=Wa(Ke[Ge][0]),st=xc(Ke[Ge][1]);ce.push(Ye,st,0),Ge>0&&(Be+=we?(Re*st-Ye*Ae)/2:Math.sqrt(Math.pow(Ye-Re,2)+Math.pow(st-Ae,2))),Re=Ye,Ae=st}const Xe=ce.length-3;ce[2]=1,Tt(ce,0,Xe,de),ce[Xe+2]=1,ce.size=Math.abs(Be),ce.start=0,ce.end=ce.size}function Sl(Ke,ce,de,we){for(let Re=0;Re<Ke.length;Re++){const Ae=[];io(Ke[Re],Ae,de,we),ce.push(Ae)}}function Wa(Ke){return Ke/360+.5}function xc(Ke){const ce=Math.sin(Ke*Math.PI/180),de=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return de<0?0:de>1?1:de}function mn(Ke,ce,de,we,Re,Ae,Be,Xe){if(we/=ce,Ae>=(de/=ce)&&Be<we)return Ke;if(Be<de||Ae>=we)return null;const Ge=[];for(const Ye of Ke){const st=Ye.geometry;let nt=Ye.type;const yt=Re===0?Ye.minX:Ye.minY,Rt=Re===0?Ye.maxX:Ye.maxY;if(yt>=de&&Rt<we){Ge.push(Ye);continue}if(Rt<de||yt>=we)continue;let kt=[];if(nt==="Point"||nt==="MultiPoint")vc(st,kt,de,we,Re);else if(nt==="LineString")ua(st,kt,de,we,Re,!1,Xe.lineMetrics);else if(nt==="MultiLineString")Bi(st,kt,de,we,Re,!1);else if(nt==="Polygon")Bi(st,kt,de,we,Re,!0);else if(nt==="MultiPolygon")for(const rn of st){const on=[];Bi(rn,on,de,we,Re,!0),on.length&&kt.push(on)}if(kt.length){if(Xe.lineMetrics&&nt==="LineString"){for(const rn of kt)Ge.push(Br(Ye.id,nt,rn,Ye.tags));continue}nt!=="LineString"&&nt!=="MultiLineString"||(kt.length===1?(nt="LineString",kt=kt[0]):nt="MultiLineString"),nt!=="Point"&&nt!=="MultiPoint"||(nt=kt.length===3?"Point":"MultiPoint"),Ge.push(Br(Ye.id,nt,kt,Ye.tags))}}return Ge.length?Ge:null}function vc(Ke,ce,de,we,Re){for(let Ae=0;Ae<Ke.length;Ae+=3){const Be=Ke[Ae+Re];Be>=de&&Be<=we&&Ss(ce,Ke[Ae],Ke[Ae+1],Ke[Ae+2])}}function ua(Ke,ce,de,we,Re,Ae,Be){let Xe=Tl(Ke);const Ge=Re===0?pd:md;let Ye,st,nt=Ke.start;for(let on=0;on<Ke.length-3;on+=3){const ln=Ke[on],an=Ke[on+1],Xn=Ke[on+2],rr=Ke[on+3],gn=Ke[on+4],tr=Re===0?ln:an,Er=Re===0?rr:gn;let ei=!1;Be&&(Ye=Math.sqrt(Math.pow(ln-rr,2)+Math.pow(an-gn,2))),tr<de?Er>de&&(st=Ge(Xe,ln,an,rr,gn,de),Be&&(Xe.start=nt+Ye*st)):tr>we?Er<we&&(st=Ge(Xe,ln,an,rr,gn,we),Be&&(Xe.start=nt+Ye*st)):Ss(Xe,ln,an,Xn),Er<de&&tr>=de&&(st=Ge(Xe,ln,an,rr,gn,de),ei=!0),Er>we&&tr<=we&&(st=Ge(Xe,ln,an,rr,gn,we),ei=!0),!Ae&&ei&&(Be&&(Xe.end=nt+Ye*st),ce.push(Xe),Xe=Tl(Ke)),Be&&(nt+=Ye)}let yt=Ke.length-3;const Rt=Ke[yt],kt=Ke[yt+1],rn=Re===0?Rt:kt;rn>=de&&rn<=we&&Ss(Xe,Rt,kt,Ke[yt+2]),yt=Xe.length-3,Ae&&yt>=3&&(Xe[yt]!==Xe[0]||Xe[yt+1]!==Xe[1])&&Ss(Xe,Xe[0],Xe[1],Xe[2]),Xe.length&&ce.push(Xe)}function Tl(Ke){const ce=[];return ce.size=Ke.size,ce.start=Ke.start,ce.end=Ke.end,ce}function Bi(Ke,ce,de,we,Re,Ae){for(const Be of Ke)ua(Be,ce,de,we,Re,Ae,!1)}function Ss(Ke,ce,de,we){Ke.push(ce,de,we)}function pd(Ke,ce,de,we,Re,Ae){const Be=(Ae-ce)/(we-ce);return Ss(Ke,Ae,de+(Re-de)*Be,1),Be}function md(Ke,ce,de,we,Re,Ae){const Be=(Ae-de)/(Re-de);return Ss(Ke,ce+(we-ce)*Be,Ae,1),Be}function bc(Ke,ce){const de=[];for(let we=0;we<Ke.length;we++){const Re=Ke[we],Ae=Re.type;let Be;if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")Be=da(Re.geometry,ce);else if(Ae==="MultiLineString"||Ae==="Polygon"){Be=[];for(const Xe of Re.geometry)Be.push(da(Xe,ce))}else if(Ae==="MultiPolygon"){Be=[];for(const Xe of Re.geometry){const Ge=[];for(const Ye of Xe)Ge.push(da(Ye,ce));Be.push(Ge)}}de.push(Br(Re.id,Ae,Be,Re.tags))}return de}function da(Ke,ce){const de=[];de.size=Ke.size,Ke.start!==void 0&&(de.start=Ke.start,de.end=Ke.end);for(let we=0;we<Ke.length;we+=3)de.push(Ke[we]+ce,Ke[we+1],Ke[we+2]);return de}function El(Ke,ce){if(Ke.transformed)return Ke;const de=1<<Ke.z,we=Ke.x,Re=Ke.y;for(const Ae of Ke.features){const Be=Ae.geometry,Xe=Ae.type;if(Ae.geometry=[],Xe===1)for(let Ge=0;Ge<Be.length;Ge+=2)Ae.geometry.push(wc(Be[Ge],Be[Ge+1],ce,de,we,Re));else for(let Ge=0;Ge<Be.length;Ge++){const Ye=[];for(let st=0;st<Be[Ge].length;st+=2)Ye.push(wc(Be[Ge][st],Be[Ge][st+1],ce,de,we,Re));Ae.geometry.push(Ye)}}return Ke.transformed=!0,Ke}function wc(Ke,ce,de,we,Re,Ae){return[Math.round(de*(Ke*we-Re)),Math.round(de*(ce*we-Ae))]}function Bs(Ke,ce,de,we,Re){const Ae=ce===Re.maxZoom?0:Re.tolerance/((1<<ce)*Re.extent),Be={features:[],numPoints:0,numSimplified:0,numFeatures:Ke.length,source:null,x:de,y:we,z:ce,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Xe of Ke)gd(Be,Xe,Ae,Re);return Be}function gd(Ke,ce,de,we){const Re=ce.geometry,Ae=ce.type,Be=[];if(Ke.minX=Math.min(Ke.minX,ce.minX),Ke.minY=Math.min(Ke.minY,ce.minY),Ke.maxX=Math.max(Ke.maxX,ce.maxX),Ke.maxY=Math.max(Ke.maxY,ce.maxY),Ae==="Point"||Ae==="MultiPoint")for(let Xe=0;Xe<Re.length;Xe+=3)Be.push(Re[Xe],Re[Xe+1]),Ke.numPoints++,Ke.numSimplified++;else if(Ae==="LineString")zn(Be,Re,Ke,de,!1,!1);else if(Ae==="MultiLineString"||Ae==="Polygon")for(let Xe=0;Xe<Re.length;Xe++)zn(Be,Re[Xe],Ke,de,Ae==="Polygon",Xe===0);else if(Ae==="MultiPolygon")for(let Xe=0;Xe<Re.length;Xe++){const Ge=Re[Xe];for(let Ye=0;Ye<Ge.length;Ye++)zn(Be,Ge[Ye],Ke,de,!0,Ye===0)}if(Be.length){let Xe=ce.tags||null;if(Ae==="LineString"&&we.lineMetrics){Xe={};for(const Ye in ce.tags)Xe[Ye]=ce.tags[Ye];Xe.mapbox_clip_start=Re.start/Re.size,Xe.mapbox_clip_end=Re.end/Re.size}const Ge={geometry:Be,type:Ae==="Polygon"||Ae==="MultiPolygon"?3:Ae==="LineString"||Ae==="MultiLineString"?2:1,tags:Xe};ce.id!==null&&(Ge.id=ce.id),Ke.features.push(Ge)}}function zn(Ke,ce,de,we,Re,Ae){const Be=we*we;if(we>0&&ce.size<(Re?Be:we))return void(de.numPoints+=ce.length/3);const Xe=[];for(let Ge=0;Ge<ce.length;Ge+=3)(we===0||ce[Ge+2]>Be)&&(de.numSimplified++,Xe.push(ce[Ge],ce[Ge+1])),de.numPoints++;Re&&function(Ge,Ye){let st=0;for(let nt=0,yt=Ge.length,Rt=yt-2;nt<yt;Rt=nt,nt+=2)st+=(Ge[nt]-Ge[Rt])*(Ge[nt+1]+Ge[Rt+1]);if(st>0===Ye)for(let nt=0,yt=Ge.length;nt<yt/2;nt+=2){const Rt=Ge[nt],kt=Ge[nt+1];Ge[nt]=Ge[yt-2-nt],Ge[nt+1]=Ge[yt-1-nt],Ge[yt-2-nt]=Rt,Ge[yt-1-nt]=kt}}(Xe,Ae),Ke.push(Xe)}const No={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Xh{constructor(ce,de){const we=(de=this.options=function(Ae,Be){for(const Xe in Be)Ae[Xe]=Be[Xe];return Ae}(Object.create(No),de)).debug;if(we&&console.time("preprocess data"),de.maxZoom<0||de.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(de.promoteId&&de.generateId)throw new Error("promoteId and generateId cannot be used together.");let Re=function(Ae,Be){const Xe=[];if(Ae.type==="FeatureCollection")for(let Ge=0;Ge<Ae.features.length;Ge++)wn(Xe,Ae.features[Ge],Be,Ge);else wn(Xe,Ae.type==="Feature"?Ae:{geometry:Ae},Be);return Xe}(ce,de);this.tiles={},this.tileCoords=[],we&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",de.indexMaxZoom,de.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Re=function(Ae,Be){const Xe=Be.buffer/Be.extent;let Ge=Ae;const Ye=mn(Ae,1,-1-Xe,Xe,0,-1,2,Be),st=mn(Ae,1,1-Xe,2+Xe,0,-1,2,Be);return(Ye||st)&&(Ge=mn(Ae,1,-Xe,1+Xe,0,-1,2,Be)||[],Ye&&(Ge=bc(Ye,1).concat(Ge)),st&&(Ge=Ge.concat(bc(st,-1)))),Ge}(Re,de),Re.length&&this.splitTile(Re,0,0,0),we&&(Re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ce,de,we,Re,Ae,Be,Xe){const Ge=[ce,de,we,Re],Ye=this.options,st=Ye.debug;for(;Ge.length;){Re=Ge.pop(),we=Ge.pop(),de=Ge.pop(),ce=Ge.pop();const nt=1<<de,yt=Ts(de,we,Re);let Rt=this.tiles[yt];if(!Rt&&(st>1&&console.time("creation"),Rt=this.tiles[yt]=Bs(ce,de,we,Re,Ye),this.tileCoords.push({z:de,x:we,y:Re}),st)){st>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",de,we,Re,Rt.numFeatures,Rt.numPoints,Rt.numSimplified),console.timeEnd("creation"));const ei=`z${de}`;this.stats[ei]=(this.stats[ei]||0)+1,this.total++}if(Rt.source=ce,Ae==null){if(de===Ye.indexMaxZoom||Rt.numPoints<=Ye.indexMaxPoints)continue}else{if(de===Ye.maxZoom||de===Ae)continue;if(Ae!=null){const ei=Ae-de;if(we!==Be>>ei||Re!==Xe>>ei)continue}}if(Rt.source=null,ce.length===0)continue;st>1&&console.time("clipping");const kt=.5*Ye.buffer/Ye.extent,rn=.5-kt,on=.5+kt,ln=1+kt;let an=null,Xn=null,rr=null,gn=null,tr=mn(ce,nt,we-kt,we+on,0,Rt.minX,Rt.maxX,Ye),Er=mn(ce,nt,we+rn,we+ln,0,Rt.minX,Rt.maxX,Ye);ce=null,tr&&(an=mn(tr,nt,Re-kt,Re+on,1,Rt.minY,Rt.maxY,Ye),Xn=mn(tr,nt,Re+rn,Re+ln,1,Rt.minY,Rt.maxY,Ye),tr=null),Er&&(rr=mn(Er,nt,Re-kt,Re+on,1,Rt.minY,Rt.maxY,Ye),gn=mn(Er,nt,Re+rn,Re+ln,1,Rt.minY,Rt.maxY,Ye),Er=null),st>1&&console.timeEnd("clipping"),Ge.push(an||[],de+1,2*we,2*Re),Ge.push(Xn||[],de+1,2*we,2*Re+1),Ge.push(rr||[],de+1,2*we+1,2*Re),Ge.push(gn||[],de+1,2*we+1,2*Re+1)}}getTile(ce,de,we){ce=+ce,de=+de,we=+we;const Re=this.options,{extent:Ae,debug:Be}=Re;if(ce<0||ce>24)return null;const Xe=1<<ce,Ge=Ts(ce,de=de+Xe&Xe-1,we);if(this.tiles[Ge])return El(this.tiles[Ge],Ae);Be>1&&console.log("drilling down to z%d-%d-%d",ce,de,we);let Ye,st=ce,nt=de,yt=we;for(;!Ye&&st>0;)st--,nt>>=1,yt>>=1,Ye=this.tiles[Ts(st,nt,yt)];return Ye&&Ye.source?(Be>1&&(console.log("found parent tile z%d-%d-%d",st,nt,yt),console.time("drilling down")),this.splitTile(Ye.source,st,nt,yt,ce,de,we),Be>1&&console.timeEnd("drilling down"),this.tiles[Ge]?El(this.tiles[Ge],Ae):null):null}}function Ts(Ke,ce,de){return 32*((1<<Ke)*de+ce)+Ke}function Cl(Ke,ce){const de=Ke.tileID.canonical;if(!this._geoJSONIndex)return void ce(null,null);const we=this._geoJSONIndex.getTile(de.z,de.x,de.y);if(!we)return void ce(null,null);const Re=new He(we.features);let Ae=Un(Re);Ae.byteOffset===0&&Ae.byteLength===Ae.buffer.byteLength||(Ae=new Uint8Array(Ae)),ce(null,{vectorTile:Re,rawData:Ae.buffer})}class yd extends Q{constructor(ce,de,we,Re,Ae,Be){super(ce,de,we,Re,Cl,Be),Ae&&(this.loadGeoJSON=Ae),this._dynamicIndex=new ft}loadData(ce,de){const we=ce&&ce.request,Re=we&&we.collectResourceTiming;this.loadGeoJSON(ce,(Ae,Be)=>{if(Ae||!Be)return de(Ae);if(typeof Be!="object")return de(new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`));{try{if(ce.filter){const Ge=s.M(ce.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ge.result==="error")throw new Error(Ge.value.map(Ye=>`${Ye.key}: ${Ye.message}`).join(", "));Be.features=Be.features.filter(Ye=>Ge.value.evaluate({zoom:0},Ye))}ce.dynamic?(Be.type==="Feature"&&(Be={type:"FeatureCollection",features:[Be]}),ce.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Be.features,this.loaded),ce.cluster&&(Be.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ce.cluster?new Jr(function({superclusterOptions:Ge,clusterProperties:Ye}){if(!Ye||!Ge)return Ge;const st={},nt={},yt={accumulated:null,zoom:0},Rt={properties:null},kt=Object.keys(Ye);for(const rn of kt){const[on,ln]=Ye[rn],an=s.M(ln),Xn=s.M(typeof on=="string"?[on,["accumulated"],["get",rn]]:on);st[rn]=an.value,nt[rn]=Xn.value}return Ge.map=rn=>{Rt.properties=rn;const on={};for(const ln of kt)on[ln]=st[ln].evaluate(yt,Rt);return on},Ge.reduce=(rn,on)=>{Rt.properties=on;for(const ln of kt)yt.accumulated=rn[ln],rn[ln]=nt[ln].evaluate(yt,Rt)},Ge}(ce)).load(Be.features):ce.dynamic?this._dynamicIndex:function(Ge,Ye){return new Xh(Ge,Ye)}(Be,ce.geojsonVtOptions)}catch(Ge){return de(Ge)}const Xe={};if(Re){const Ge=k(we);Ge&&(Xe.resourceTiming={},Xe.resourceTiming[ce.source]=JSON.parse(JSON.stringify(Ge)))}de(null,Xe)}})}reloadTile(ce,de){const we=this.loaded;return we&&we[ce.uid]?ce.partial?de(null,void 0):super.reloadTile(ce,de):this.loadTile(ce,de)}loadGeoJSON(ce,de){if(ce.request)s.n(ce.request,de);else{if(typeof ce.data!="string")return de(new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`));try{return de(null,JSON.parse(ce.data))}catch{return de(new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ce,de){try{de(null,this._geoJSONIndex.getClusterExpansionZoom(ce.clusterId))}catch(we){de(we)}}getClusterChildren(ce,de){try{de(null,this._geoJSONIndex.getChildren(ce.clusterId))}catch(we){de(we)}}getClusterLeaves(ce,de){try{de(null,this._geoJSONIndex.getLeaves(ce.clusterId,ce.limit,ce.offset))}catch(we){de(we)}}}class Sc{constructor(ce,de){this.tileID=new s.aA(ce.tileID.overscaledZ,ce.tileID.wrap,ce.tileID.canonical.z,ce.tileID.canonical.x,ce.tileID.canonical.y),this.tileZoom=ce.tileZoom,this.uid=ce.uid,this.zoom=ce.zoom,this.canonical=ce.tileID.canonical,this.pixelRatio=ce.pixelRatio,this.tileSize=ce.tileSize,this.source=ce.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ce.projection,this.brightness=de}parse(ce,de,we,Re){this.status="parsing";const Ae=new s.aA(we.tileID.overscaledZ,we.tileID.wrap,we.tileID.canonical.z,we.tileID.canonical.x,we.tileID.canonical.y),Be={},Xe=de.familiesBySource[we.source],Ge=new s.dR(Ae,we.promoteId);return Ge.bucketLayerIDs=[],Ge.is3DTile=!0,s.e0(ce).then(Ye=>{if(!Ye)return Re(new Error("Could not parse tile"));const st=s.e1(Ye,1/s.c8(we.tileID.canonical)),nt=Ye.json.extensionsUsed&&Ye.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ye.json.asset.extras&&Ye.json.asset.extras.MAPBOX_mesh_features,yt=Ye.json.extensionsUsed&&Ye.json.extensionsUsed.includes("EXT_meshopt_compression"),Rt=new s.a3(this.zoom,{brightness:this.brightness});for(const kt in Xe)for(const rn of Xe[kt]){const on=rn[0];Ge.bucketLayerIDs.push(rn.map(an=>an.id)),on.recalculate(Rt,[]);const ln=new s.e2(st,Ae,nt,yt,this.brightness,Ge);nt||(ln.needsUpload=!0),Be[on.fqid]=ln,ln.evaluate(on)}this.status="done",Re(null,{buckets:Be,featureIndex:Ge})}).catch(Ye=>Re(new Error(Ye.message)))}}class _d{constructor(ce,de,we,Re,Ae,Be){this.actor=ce,this.layerIndex=de,this.brightness=Be,this.loading={},this.loaded={}}loadTile(ce,de){const we=ce.uid,Re=this.loading[we]=new Sc(ce,this.brightness);s.bc(ce.request,(Ae,Be)=>{const Xe=!this.loading[we];return delete this.loading[we],Xe||Ae?(Re.status="done",Xe||(this.loaded[we]=Re),de(Ae)):Be&&Be.byteLength!==0?void Re.parse(Be,this.layerIndex,ce,(Ge,Ye)=>{Re.status="done",this.loaded=this.loaded||{},this.loaded[we]=Re,Ge||!Ye?de(Ge):de(null,Ye)}):(Re.status="done",this.loaded[we]=Re,de())})}reloadTile(ce,de){const we=this.loaded,Re=ce.uid;if(we&&we[Re]){const Ae=we[Re];Ae.projection=ce.projection,Ae.brightness=ce.brightness;const Be=(Xe,Ge)=>{Ae.reloadCallback&&(delete Ae.reloadCallback,this.loadTile(ce,de)),de(Xe,Ge)};Ae.status==="parsing"?Ae.reloadCallback=Be:Ae.status==="done"&&this.loadTile(ce,de)}}abortTile(ce,de){const we=ce.uid;this.loading[we]&&delete this.loading[we],de()}removeTile(ce,de){const we=this.loaded,Re=ce.uid;we&&we[Re]&&delete we[Re],de()}}class Pl{constructor(ce){this.self=ce,this.actor=new s.e3(ce,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.bL({name:"mercator"}),this.workerSourceTypes={vector:Q,geojson:yd,"batched-model":_d},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(de,we)=>{if(this.workerSourceTypes[de])throw new Error(`Worker source with name "${de}" already registered.`);this.workerSourceTypes[de]=we},this.self.registerRTLTextPlugin=de=>{if(s.e4.isParsed())throw new Error("RTL text plugin already registered.");s.e4.applyArabicShaping=de.applyArabicShaping,s.e4.processBidirectionalText=de.processBidirectionalText,s.e4.processStyledBidirectionalText=de.processStyledBidirectionalText}}clearCaches(ce,de,we){delete this.layerIndexes[ce],delete this.availableImages[ce],delete this.workerSources[ce],delete this.demWorkerSources[ce],delete this.rasterArrayWorkerSource,we()}checkIfReady(ce,de,we){we()}setReferrer(ce,de){this.referrer=de}spriteLoaded(ce,{scope:de,isLoaded:we}){if(this.isSpriteLoaded[ce]||(this.isSpriteLoaded[ce]={}),this.isSpriteLoaded[ce][de]=we,this.workerSources[ce]&&this.workerSources[ce][de])for(const Re in this.workerSources[ce][de]){const Ae=this.workerSources[ce][de][Re];for(const Be in Ae){const Xe=Ae[Be];Xe instanceof Q&&(Xe.isSpriteLoaded=we,Xe.fire(new s.x("isSpriteLoaded")))}}}setImages(ce,{scope:de,images:we},Re){if(this.availableImages[ce]||(this.availableImages[ce]={}),this.availableImages[ce][de]=we,this.workerSources[ce]&&this.workerSources[ce][de]){for(const Ae in this.workerSources[ce][de]){const Be=this.workerSources[ce][de][Ae];for(const Xe in Be)Be[Xe].availableImages=we}Re()}else Re()}setProjection(ce,de){this.projections[ce]=s.bL(de)}setBrightness(ce,de,we){this.brightness=de,we()}setLayers(ce,de,we){this.getLayerIndex(ce,de.scope).replace(de.layers,de.options),we()}updateLayers(ce,de,we){this.getLayerIndex(ce,de.scope).update(de.layers,de.removedIds,de.options),we()}loadTile(ce,de,we){de.projection=this.projections[ce]||this.defaultProjection,this.getWorkerSource(ce,de.type,de.source,de.scope).loadTile(de,we)}loadDEMTile(ce,de,we){this.getDEMWorkerSource(ce,de.source,de.scope).loadTile(de,we)}decodeRasterArray(ce,de,we){this.getRasterArrayWorkerSource().decodeRasterArray(de,we)}reloadTile(ce,de,we){de.projection=this.projections[ce]||this.defaultProjection,this.getWorkerSource(ce,de.type,de.source,de.scope).reloadTile(de,we)}abortTile(ce,de,we){this.getWorkerSource(ce,de.type,de.source,de.scope).abortTile(de,we)}removeTile(ce,de,we){this.getWorkerSource(ce,de.type,de.source,de.scope).removeTile(de,we)}removeSource(ce,de,we){if(!(this.workerSources[ce]&&this.workerSources[ce][de.scope]&&this.workerSources[ce][de.scope][de.type]&&this.workerSources[ce][de.scope][de.type][de.source]))return;const Re=this.workerSources[ce][de.scope][de.type][de.source];delete this.workerSources[ce][de.scope][de.type][de.source],Re.removeSource!==void 0?Re.removeSource(de,we):we()}loadWorkerSource(ce,de,we){try{this.self.importScripts(de.url),we()}catch(Re){we(Re.toString())}}syncRTLPluginState(ce,de,we){try{s.e4.setState(de);const Re=s.e4.getPluginURL();if(s.e4.isLoaded()&&!s.e4.isParsed()&&Re!=null){this.self.importScripts(Re);const Ae=s.e4.isParsed();we(Ae?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Re}`),Ae)}}catch(Re){we(Re.toString())}}setDracoUrl(ce,de){this.dracoUrl=de}getAvailableImages(ce,de){this.availableImages[ce]||(this.availableImages[ce]={});let we=this.availableImages[ce][de];return we||(we=[]),we}getLayerIndex(ce,de){this.layerIndexes[ce]||(this.layerIndexes[ce]={});let we=this.layerIndexes[ce][de];return we||(we=this.layerIndexes[ce][de]=new q,we.scope=de),we}getWorkerSource(ce,de,we,Re){return this.workerSources[ce]||(this.workerSources[ce]={}),this.workerSources[ce][Re]||(this.workerSources[ce][Re]={}),this.workerSources[ce][Re][de]||(this.workerSources[ce][Re][de]={}),this.isSpriteLoaded[ce]||(this.isSpriteLoaded[ce]={}),this.workerSources[ce][Re][de][we]||(this.workerSources[ce][Re][de][we]=new this.workerSourceTypes[de]({send:(Ae,Be,Xe,Ge,Ye,st)=>{this.actor.send(Ae,Be,Xe,ce,Ye,st)},scheduler:this.actor.scheduler},this.getLayerIndex(ce,Re),this.getAvailableImages(ce,Re),this.isSpriteLoaded[ce][Re],void 0,this.brightness)),this.workerSources[ce][Re][de][we]}getDEMWorkerSource(ce,de,we){return this.demWorkerSources[ce]||(this.demWorkerSources[ce]={}),this.demWorkerSources[ce][we]||(this.demWorkerSources[ce][we]={}),this.demWorkerSources[ce][we][de]||(this.demWorkerSources[ce][we][de]=new ee),this.demWorkerSources[ce][we][de]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new re),this.rasterArrayWorkerSource}enforceCacheSizeLimit(ce,de){s.e5(de)}getWorkerPerformanceMetrics(ce,de,we){we(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Pl(self)),Pl}),_(["./shared"],function(s){var k="3.7.0";const O={create:"create",load:"load",fullLoad:"fullLoad"},F={mark(f){performance.mark(f)},measure(f,i,l){performance.measure(f,i,l)}};function q(f){const i=f.name.split("?")[0];return s.a(i)&&i.includes("mapbox-gl.js")?"javascript":s.a(i)&&i.includes("mapbox-gl.css")?"css":s.b(i)?"fontRange":s.c(i)?"sprite":s.i(i)?"style":s.d(i)?"tilejson":"other"}var H,J={},U=function(){if(H)return J;function f(p){return!i(p)}function i(p){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var w,E,R=new Blob([""],{type:"text/javascript"}),L=URL.createObjectURL(R);try{E=new Worker(L),w=!0}catch{w=!1}return E&&E.terminate(),URL.revokeObjectURL(L),w}()?function(){var w=document.createElement("canvas");w.width=w.height=1;var E=w.getContext("2d");if(!E)return!1;var R=E.getImageData(0,0,1,1);return R&&R.width===w.width}()?(l[x=p&&p.failIfMajorPerformanceCaveat]===void 0&&(l[x]=function(w){var E,R=function(L){var z=document.createElement("canvas"),B=Object.create(f.webGLContextAttributes);return B.failIfMajorPerformanceCaveat=L,z.getContext("webgl2",B)}(w);if(!R)return!1;try{E=R.createShader(R.VERTEX_SHADER)}catch{return!1}return!(!E||R.isContextLost())&&(R.shaderSource(E,"void main() {}"),R.compileShader(E),R.getShaderParameter(E,R.COMPILE_STATUS)===!0)}(x)),l[x]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var x}H=1,J.supported=f,J.notSupportedReason=i;var l={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},J}();function te(f,i,l){const p=document.createElement(f);return i!=null&&(p.className=i),l&&l.appendChild(p),p}function Q(f,i,l){const p=document.createElementNS("http://www.w3.org/2000/svg",f);for(const x of Object.keys(i))p.setAttributeNS(null,x,String(i[x]));return l&&l.appendChild(p),p}const ee=typeof document<"u"?document.documentElement&&document.documentElement.style:null,re=ee&&ee.userSelect!==void 0?"userSelect":"WebkitUserSelect";let xe;function Ee(){ee&&re&&(xe=ee[re],ee[re]="none")}function He(){ee&&re&&(ee[re]=xe)}function qe(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",qe,!0)}function Ne(){window.addEventListener("click",qe,!0),window.setTimeout(()=>{window.removeEventListener("click",qe,!0)},0)}function ft(f,i){const l=f.getBoundingClientRect();return pt(f,l,i)}function ut(f,i){const l=f.getBoundingClientRect(),p=[];for(let x=0;x<i.length;x++)p.push(pt(f,l,i[x]));return p}function mt(f){return window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function pt(f,i,l){const p=f.offsetWidth===i.width?1:f.offsetWidth/i.width;return new s.P((l.clientX-i.left)*p,(l.clientY-i.top)*p)}const en="01",Yt="NO_ACCESS_TOKEN";class dn{constructor(i,l,p){this._transformRequestFn=i,this._customAccessToken=l,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const i=function(){let l="";for(let p=0;p<10;p++)l+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",en,l].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,l){return this._transformRequestFn&&this._transformRequestFn(i,l)||{url:i}}normalizeStyleURL(i,l){if(!s.f(i))return i;const p=Et(i);return p.params.push(`sdk=js-${k}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||l)}normalizeGlyphsURL(i,l){if(!s.f(i))return i;const p=Et(i);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||l)}normalizeModelURL(i,l){if(!s.f(i))return i;const p=Et(i);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||l)}normalizeSourceURL(i,l,p,x){if(!s.f(i))return i;const w=Et(i);return w.path=`/v4/${w.authority}.json`,w.params.push("secure"),p&&w.params.push(`language=${p}`),x&&w.params.push(`worldview=${x}`),this._makeAPIURL(w,this._customAccessToken||l)}normalizeSpriteURL(i,l,p,x){const w=Et(i);return s.f(i)?(w.path=`/styles/v1${w.path}/sprite${l}${p}`,this._makeAPIURL(w,this._customAccessToken||x)):(w.path+=`${l}${p}`,tt(w))}normalizeTileURL(i,l,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!s.f(i))return i;const x=Et(i);x.path=x.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${l||p&&x.authority!=="raster"&&p===512?"@2x":""}${s.m.supported?".webp":"$1"}`),x.authority==="raster"?x.path=`/${s.e.RASTER_URL_PREFIX}${x.path}`:x.authority==="rasterarrays"?x.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${x.path}`:x.authority==="3dtiles"?x.path=`/${s.e.TILES3D_URL_PREFIX}${x.path}`:(x.path=x.path.replace(/^.+\/v4\//,"/"),x.path=`/${s.e.TILE_URL_VERSION}${x.path}`);const w=this._customAccessToken||function(E){for(const R of E){const L=R.match(/^access_token=(.*)$/);if(L)return L[1]}return null}(x.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&w&&this._skuToken&&x.params.push(`sku=${this._skuToken}`),this._makeAPIURL(x,w)}canonicalizeTileURL(i,l){const p=Et(i);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return i;let x="mapbox://";p.path.match(/^\/raster\/v1\//)?x+=`raster/${p.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?x+=`rasterarrays/${p.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:x+=`tiles/${p.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let w=p.params;return l&&(w=w.filter(E=>!E.match(/^access_token=/))),w.length&&(x+=`?${w.join("&")}`),x}canonicalizeTileset(i,l){const p=!!l&&s.f(l),x=[];for(const w of i.tiles||[])s.h(w)?x.push(this.canonicalizeTileURL(w,p)):x.push(w);return x}_makeAPIURL(i,l){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",x=Et(s.e.API_URL);if(i.protocol=x.protocol,i.authority=x.authority,i.protocol==="http"){const w=i.params.indexOf("secure");w>=0&&i.params.splice(w,1)}if(x.path!=="/"&&(i.path=`${x.path}${i.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return tt(i);if(l=l||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!l)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(l[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return i.params=i.params.filter(w=>w.indexOf("access_token")===-1),i.params.push(`access_token=${l||""}`),tt(i)}}const It=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Et(f){const i=f.match(It);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function tt(f){const i=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${i}`}const Ft="mapbox.eventData";function St(f){if(!f)return null;const i=f.split(".");if(!i||i.length!==3)return null;try{return JSON.parse(s.j(i[1]))}catch{return null}}class hn{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const l=St(s.e.ACCESS_TOKEN);let p="";return p=l&&l.u?s.k(l.u):s.e.ACCESS_TOKEN||"",i?`${Ft}.${i}:${p}`:`${Ft}:${p}`}fetchEventData(){const i=s.s("localStorage"),l=this.getStorageKey(),p=this.getStorageKey("uuid");if(i)try{const x=localStorage.getItem(l);x&&(this.eventData=JSON.parse(x));const w=localStorage.getItem(p);w&&(this.anonId=w)}catch{s.w("Unable to read from LocalStorage")}}saveEventData(){const i=s.s("localStorage"),l=this.getStorageKey(),p=this.getStorageKey("uuid"),x=this.anonId;if(i&&x)try{localStorage.setItem(p,x),Object.keys(this.eventData).length>=1&&localStorage.setItem(l,JSON.stringify(this.eventData))}catch{s.w("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,l,p,x){if(!s.e.EVENTS_URL)return;const w=Et(s.e.EVENTS_URL);w.params.push(`access_token=${x||s.e.ACCESS_TOKEN||""}`);const E={event:this.type,created:new Date(i).toISOString()},R=l?s.l(E,l):E,L={url:tt(w),headers:{"Content-Type":"text/plain"},body:JSON.stringify([R])};this.pendingRequest=s.p(L,z=>{this.pendingRequest=null,p(z),this.saveEventData(),this.processRequests(x)})}queueRequest(i,l){this.queue.push(i),this.processRequests(l)}}const Un=new class extends hn{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,i){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(l=>s.f(l)||s.h(l))&&this.queueRequest(Date.now(),i)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=St(s.e.ACCESS_TOKEN),l=i?i.u:s.e.ACCESS_TOKEN;let p=l!==this.eventData.tokenU;s.v(this.anonId)||(this.anonId=s.u(),p=!0);const x=this.queue.shift();if(this.eventData.lastSuccess){const w=new Date(this.eventData.lastSuccess),E=new Date(x),R=(x-this.eventData.lastSuccess)/864e5;p=p||R>=1||R<-1||w.getDate()!==E.getDate()}else p=!0;p?this.postEvent(x,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:en,"enabled.telemetry":!1,userId:this.anonId},w=>{w||(this.eventData.lastSuccess=x,this.eventData.tokenU=l)},f):this.processRequests()}},wr=Un.postTurnstileEvent.bind(Un),Ut=new class extends hn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,i,l,p){this.skuToken=i,this.errorCb=p,s.e.EVENTS_URL&&(l||s.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},l):this.errorCb(new Error(Yt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:l}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),s.v(this.anonId)||(this.anonId=s.u()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:en,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):i&&(this.success[i]=!0)},f))}remove(){this.errorCb=null}},Cr=Ut.postMapLoadEvent.bind(Ut),or=new class extends hn{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let i=this.mapInstanceIdMap.get(f);return i||(i=s.u(),this.mapInstanceIdMap.set(f,i)),i}getEventId(f){const i=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,i+1),i}postStyleLoadEvent(f,i){const{map:l,style:p,importedStyles:x}=i;if(!s.e.EVENTS_URL||!f&&!s.e.ACCESS_TOKEN)return;const w=this.getMapInstanceId(l),E={mapInstanceId:w,eventId:this.getEventId(w),style:p};x.length&&(E.importedStyles=x),this.queueRequest({timestamp:Date.now(),payload:E},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,payload:l}=this.queue.shift();this.postEvent(i,l,()=>{},f)}},Qt=or.postStyleLoadEvent.bind(or),dr=new class extends hn{constructor(){super("gljs.performance")}postPerformanceEvent(f,i){s.e.EVENTS_URL&&(f||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,performanceData:l}=this.queue.shift(),p=function(x){const w=performance.getEntriesByType("resource"),E=performance.getEntriesByType("mark"),R=function(Y){const se={};if(Y){for(const oe in Y)if(oe!=="other")for(const ae of Y[oe]){const le=`${oe}ResolveRangeMin`,me=`${oe}ResolveRangeMax`,ye=`${oe}RequestCount`,fe=`${oe}RequestCachedCount`;se[le]=Math.min(se[le]||1/0,ae.startTime),se[me]=Math.max(se[me]||-1/0,ae.responseEnd);const be=ve=>{se[ve]===void 0&&(se[ve]=0),++se[ve]};ae.transferSize!==void 0&&ae.transferSize===0&&be(fe),be(ye)}}return se}(function(Y,se){const oe={};if(Y)for(const ae of Y){const le=se(ae);oe[le]===void 0&&(oe[le]=[]),oe[le].push(ae)}return oe}(w,q)),L=window.devicePixelRatio,z=navigator.connection||navigator.mozConnection||navigator.webkitConnection,B=z?z.effectiveType:void 0,G={counters:[],metadata:[],attributes:[]},Z=(Y,se,oe)=>{oe!=null&&Y.push({name:se,value:oe.toString()})};for(const Y in R)Z(G.counters,Y,R[Y]);if(x.interactionRange[0]!==1/0&&x.interactionRange[1]!==-1/0&&(Z(G.counters,"interactionRangeMin",x.interactionRange[0]),Z(G.counters,"interactionRangeMax",x.interactionRange[1])),E)for(const Y of Object.keys(O)){const se=O[Y],oe=E.find(ae=>ae.name===se);oe&&Z(G.counters,se,oe.startTime)}return Z(G.counters,"visibilityHidden",x.visibilityHidden),Z(G.attributes,"style",function(Y){if(Y)for(const se of Y){const oe=se.name.split("?")[0];if(s.i(oe)){const ae=oe.split("/").slice(-2);if(ae.length===2)return`mapbox://styles/${ae[0]}/${ae[1]}`}}}(w)),Z(G.attributes,"terrainEnabled",x.terrainEnabled?"true":"false"),Z(G.attributes,"fogEnabled",x.fogEnabled?"true":"false"),Z(G.attributes,"projection",x.projection),Z(G.attributes,"zoom",x.zoom),Z(G.metadata,"devicePixelRatio",L),Z(G.metadata,"connectionEffectiveType",B),Z(G.metadata,"navigatorUserAgent",navigator.userAgent),Z(G.metadata,"screenWidth",window.screen.width),Z(G.metadata,"screenHeight",window.screen.height),Z(G.metadata,"windowWidth",window.innerWidth),Z(G.metadata,"windowHeight",window.innerHeight),Z(G.metadata,"mapWidth",x.width/L),Z(G.metadata,"mapHeight",x.height/L),Z(G.metadata,"webglRenderer",x.renderer),Z(G.metadata,"webglVendor",x.vendor),Z(G.metadata,"sdkVersion",k),Z(G.metadata,"sdkIdentifier","mapbox-gl-js"),G}(l);for(const x of p.metadata);for(const x of p.counters);for(const x of p.attributes);this.postEvent(i,p,()=>{},f)}},Jr=dr.postPerformanceEvent.bind(dr),hr=new class extends hn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,i,l,p){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const x=Et(s.e.API_URL+s.e.SESSION_PATH);x.params.push(`sku=${i||""}`),x.params.push(`access_token=${p||s.e.ACCESS_TOKEN||""}`);const w={url:tt(x),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(w,E=>{this.pendingRequest=null,l(E),this.saveEventData(),this.processRequests(p)})}getSessionAPI(f,i,l,p){this.skuToken=i,this.errorCb=p,s.e.SESSION_PATH&&s.e.API_URL&&(l||s.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},l):this.errorCb(new Error(Yt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:l}=this.queue.shift();i&&this.success[i]||this.getSession(l,this.skuToken,p=>{p?this.errorCb(p):i&&(this.success[i]=!0)},f)}remove(){this.errorCb=null}},Ie=hr.getSessionAPI.bind(hr),er=new Set;function Qr(f,i){i?er.add(f):er.delete(f)}class Fi{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,l){this._updatedSourceCaches[i]=l,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){const l=i.scope;this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._updatedLayers[l].add(i.id),this.setDirty()}removeLayer(i){const l=i.scope;this._removedLayers[l]=this._removedLayers[l]||{},this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._removedLayers[l][i.id]=i,this._updatedLayers[l].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){const i={};for(const l in this._updatedLayers)i[l]=i[l]||{},i[l].updatedIds=Array.from(this._updatedLayers[l].values());for(const l in this._removedLayers)i[l]=i[l]||{},i[l].removedIds=Object.keys(this._removedLayers[l]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(i){this._updatedImages.add(i),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Tt(f){const{userImage:i}=f;return!!(i&&i.render&&i.render())&&(f.data.replace(new Uint8Array(i.data.buffer)),!0)}class ws extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(i){this.images[i]={},this.loaded[i]=!1,this.updatedImages[i]={},this.patterns[i]={},this.callbackDispatchedThisFrame[i]={},this.atlasImage[i]=new s.r({width:1,height:1})}isLoaded(){for(const i in this.loaded)if(!this.loaded[i])return!1;return!0}setLoaded(i,l){if(this.loaded[l]!==i&&(this.loaded[l]=i,i)){for(const{ids:p,callback:x}of this.requestors)this._notify(p,l,x);this.requestors=[]}}hasImage(i,l){return!!this.getImage(i,l)}getImage(i,l){return this.images[l][i]}addImage(i,l,p){this._validate(i,p)&&(this.images[l][i]=p)}_validate(i,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new s.t(new Error(`Image "${i}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new s.t(new Error(`Image "${i}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new s.t(new Error(`Image "${i}" has invalid "content" value`))),p=!1),p}_validateStretch(i,l){if(!i)return!0;let p=0;for(const x of i){if(x[0]<p||x[1]<x[0]||l<x[1])return!1;p=x[1]}return!0}_validateContent(i,l){return!(i&&(i.length!==4||i[0]<0||l.data.width<i[0]||i[1]<0||l.data.height<i[1]||i[2]<0||l.data.width<i[2]||i[3]<0||l.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,l,p){p.version=this.images[l][i].version+1,this.images[l][i]=p,this.updatedImages[l][i]=!0}removeImage(i,l){const p=this.images[l][i];delete this.images[l][i],delete this.patterns[l][i],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(i){return Object.keys(this.images[i])}getImages(i,l,p){let x=!0;const w=!!this.loaded[l];if(!w)for(const E of i)this.images[l][E]||(x=!1);w||x?this._notify(i,l,p):this.requestors.push({ids:i,scope:l,callback:p})}getUpdatedImages(i){return this.updatedImages[i]}_notify(i,l,p){const x={};for(const w of i){this.images[l][w]||this.fire(new s.x("styleimagemissing",{id:w}));const E=this.images[l][w];E?x[w]={data:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!!(E.userImage&&E.userImage.render)}:s.w(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}p(null,x)}getPixelSize(i){const{width:l,height:p}=this.atlasImage[i];return{width:l,height:p}}getPattern(i,l,p){const x=this.patterns[l][i],w=this.getImage(i,l);if(!w)return null;if(x&&x.position.version===w.version)return x.position;if(x)x.position.version=w.version;else{const E={w:w.data.width+2*s.y,h:w.data.height+2*s.y,x:0,y:0},R=new s.I(E,w,s.y);this.patterns[l][i]={bin:E,position:R}}return this._updatePatternAtlas(l,p),this.patterns[l][i].position}bind(i,l){const p=i.gl;let x=this.atlasTexture[l];x?this.dirty&&(x.update(this.atlasImage[l]),this.dirty=!1):(x=new s.T(i,this.atlasImage[l],p.RGBA8),this.atlasTexture[l]=x),x.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(i,l){const p=[];for(const R in this.patterns[i])p.push(this.patterns[i][R].bin);const{w:x,h:w}=s.z(p),E=this.atlasImage[i];E.resize({width:x||1,height:w||1});for(const R in this.patterns[i]){const{bin:L,position:z}=this.patterns[i][R];let B=z.padding;const G=L.x+B,Z=L.y+B,Y=this.images[i][R].data,se=Y.width,oe=Y.height;B=B>1?B-1:B,s.r.copy(Y,E,{x:0,y:0},{x:G,y:Z},{width:se,height:oe},l),s.r.copy(Y,E,{x:0,y:oe-B},{x:G,y:Z-B},{width:se,height:B},l),s.r.copy(Y,E,{x:0,y:0},{x:G,y:Z+oe},{width:se,height:B},l),s.r.copy(Y,E,{x:se-B,y:0},{x:G-B,y:Z},{width:B,height:oe},l),s.r.copy(Y,E,{x:0,y:0},{x:G+se,y:Z},{width:B,height:oe},l),s.r.copy(Y,E,{x:se-B,y:oe-B},{x:G-B,y:Z-B},{width:B,height:B},l),s.r.copy(Y,E,{x:0,y:oe-B},{x:G+se,y:Z-B},{width:B,height:B},l),s.r.copy(Y,E,{x:0,y:0},{x:G+se,y:Z+oe},{width:B,height:B},l),s.r.copy(Y,E,{x:se-B,y:0},{x:G-B,y:Z+oe},{width:B,height:B},l)}this.dirty=!0}beginFrame(){for(const i in this.images)this.callbackDispatchedThisFrame[i]={}}dispatchRenderCallbacks(i,l){for(const p of i){if(this.callbackDispatchedThisFrame[l][p])continue;this.callbackDispatchedThisFrame[l][p]=!0;const x=this.images[l][p];Tt(x)&&this.updateImage(p,l,x)}}}function Br(f){const i=f.key,l=f.value,p=f.valueSpec||{},x=f.objectElementValidators||{},w=f.style,E=f.styleSpec;let R=[];const L=s.B(l);if(L!=="object")return[new s.V(i,l,`object expected, ${L} found`)];for(const z in l){const B=z.split(".")[0];let G;x[B]?G=x[B]:p[B]?G=zn:x["*"]?G=x["*"]:p["*"]&&(G=zn),G?R=R.concat(G({key:(i&&`${i}.`)+z,value:l[z],valueSpec:p[B]||p["*"],style:w,styleSpec:E,object:l,objectKey:z},l)):R.push(new s.A(i,l[z],`unknown property "${z}"`))}for(const z in p)x[z]||p[z].required&&p[z].default===void 0&&l[z]===void 0&&R.push(new s.V(i,l,`missing required property "${z}"`));return R}function ro(f){const i=f.value,l=f.valueSpec,p=f.style,x=f.styleSpec,w=f.key,E=f.arrayElementValidator||zn;if(s.B(i)!=="array")return[new s.V(w,i,`array expected, ${s.B(i)} found`)];if(l.length&&i.length!==l.length)return[new s.V(w,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new s.V(w,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let R={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};x.$version<7&&(R.function=l.function),s.B(l.value)==="object"&&(R=l.value);let L=[];for(let z=0;z<i.length;z++)L=L.concat(E({array:i,arrayIndex:z,value:i[z],valueSpec:R,style:p,styleSpec:x,key:`${w}[${z}]`},!0));return L}function wn(f){const i=f.key,l=f.value,p=f.valueSpec;let x=s.B(l);if(x==="number"&&l!=l&&(x="NaN"),x!=="number")return[new s.V(i,l,`number expected, ${x} found`)];if("minimum"in p){let w=p.minimum;if(s.B(p.minimum)==="array"&&(w=p.minimum[f.arrayIndex]),l<w)return[new s.V(i,l,`${l} is less than the minimum value ${w}`)]}if("maximum"in p){let w=p.maximum;if(s.B(p.maximum)==="array"&&(w=p.maximum[f.arrayIndex]),l>w)return[new s.V(i,l,`${l} is greater than the maximum value ${w}`)]}return[]}function vi(f){const i=f.valueSpec,l=s.D(f.value.type);let p,x,w,E={};const R=l!=="categorical"&&f.value.property===void 0,L=!R,z=s.B(f.value.stops)==="array"&&s.B(f.value.stops[0])==="array"&&s.B(f.value.stops[0][0])==="object",B=Br({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(Y){if(l==="identity")return[new s.V(Y.key,Y.value,'identity function may not have a "stops" property')];let se=[];const oe=Y.value;return se=se.concat(ro({key:Y.key,value:oe,valueSpec:Y.valueSpec,style:Y.style,styleSpec:Y.styleSpec,arrayElementValidator:G})),s.B(oe)==="array"&&oe.length===0&&se.push(new s.V(Y.key,oe,"array must have at least one stop")),se},default:function(Y){return zn({key:Y.key,value:Y.value,valueSpec:i,style:Y.style,styleSpec:Y.styleSpec})}}});return l==="identity"&&R&&B.push(new s.V(f.key,f.value,'missing required property "property"')),l==="identity"||f.value.stops||B.push(new s.V(f.key,f.value,'missing required property "stops"')),l==="exponential"&&f.valueSpec.expression&&!s.F(f.valueSpec)&&B.push(new s.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(L&&!s.G(f.valueSpec)?B.push(new s.V(f.key,f.value,"property functions not supported")):R&&!s.H(f.valueSpec)&&B.push(new s.V(f.key,f.value,"zoom functions not supported"))),l!=="categorical"&&!z||f.value.property!==void 0||B.push(new s.V(f.key,f.value,'"property" property is required')),B;function G(Y){let se=[];const oe=Y.value,ae=Y.key;if(s.B(oe)!=="array")return[new s.V(ae,oe,`array expected, ${s.B(oe)} found`)];if(oe.length!==2)return[new s.V(ae,oe,`array length 2 expected, length ${oe.length} found`)];if(z){if(s.B(oe[0])!=="object")return[new s.V(ae,oe,`object expected, ${s.B(oe[0])} found`)];if(oe[0].zoom===void 0)return[new s.V(ae,oe,"object stop key must have zoom")];if(oe[0].value===void 0)return[new s.V(ae,oe,"object stop key must have value")];const le=s.D(oe[0].zoom);if(typeof le!="number")return[new s.V(ae,oe[0].zoom,"stop zoom values must be numbers")];if(w&&w>le)return[new s.V(ae,oe[0].zoom,"stop zoom values must appear in ascending order")];le!==w&&(w=le,x=void 0,E={}),se=se.concat(Br({key:`${ae}[0]`,value:oe[0],valueSpec:{zoom:{}},style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{zoom:wn,value:Z}}))}else se=se.concat(Z({key:`${ae}[0]`,value:oe[0],valueSpec:{},style:Y.style,styleSpec:Y.styleSpec},oe));return s.J(s.K(oe[1]))?se.concat([new s.V(`${ae}[1]`,oe[1],"expressions are not allowed in function stops.")]):se.concat(zn({key:`${ae}[1]`,value:oe[1],valueSpec:i,style:Y.style,styleSpec:Y.styleSpec}))}function Z(Y,se){const oe=s.B(Y.value),ae=s.D(Y.value),le=Y.value!==null?Y.value:se;if(p){if(oe!==p)return[new s.V(Y.key,le,`${oe} stop domain type must match previous stop domain type ${p}`)]}else p=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean"&&typeof ae!="number"&&typeof ae!="string"&&typeof ae!="boolean")return[new s.V(Y.key,le,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&l!=="categorical"){let me=`number expected, ${oe} found`;return s.G(i)&&l===void 0&&(me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(Y.key,le,me)]}return l!=="categorical"||oe!=="number"||typeof ae=="number"&&isFinite(ae)&&Math.floor(ae)===ae?l!=="categorical"&&oe==="number"&&typeof ae=="number"&&typeof x=="number"&&x!==void 0&&ae<x?[new s.V(Y.key,le,"stop domain values must appear in ascending order")]:(x=ae,l==="categorical"&&ae in E?[new s.V(Y.key,le,"stop domain values must be unique")]:(E[ae]=!0,[])):[new s.V(Y.key,le,`integer expected, found ${String(ae)}`)]}}function io(f){const i=(f.expressionContext==="property"?s.L:s.M)(s.K(f.value),f.valueSpec);if(i.result==="error")return i.value.map(p=>new s.V(`${f.key}${p.key}`,f.value,p.message));const l=i.value.expression||i.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!l.outputDefined())return[new s.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!s.N(l))return[new s.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return Sl(l,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!s.O(l,["zoom","feature-state"]))return[new s.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!s.Q(l))return[new s.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Sl(f,i){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const x of i.valueSpec.expression.parameters)l.delete(x);if(l.size===0)return[];const p=[];return f instanceof s.S&&l.has(f.name)?[new s.V(i.key,i.value,`["${f.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(f.eachChild(x=>{p.push(...Sl(x,i))}),p)}function Wa(f){const i=f.key,l=f.value,p=f.valueSpec,x=[];return Array.isArray(p.values)?p.values.indexOf(s.D(l))===-1&&x.push(new s.V(i,l,`expected one of [${p.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(p.values).indexOf(s.D(l))===-1&&x.push(new s.V(i,l,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(l)} found`)),x}function xc(f){return s.W(s.K(f.value))?io(s.C({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):mn(f)}function mn(f){const i=f.value,l=f.key;if(s.B(i)!=="array")return[new s.V(l,i,`array expected, ${s.B(i)} found`)];const p=f.styleSpec;let x,w=[];if(i.length<1)return[new s.V(l,i,"filter array must have at least 1 element")];switch(w=w.concat(Wa({key:`${l}[0]`,value:i[0],valueSpec:p.filter_operator,style:f.style,styleSpec:f.styleSpec})),s.D(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&s.D(i[1])==="$type"&&w.push(new s.V(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&w.push(new s.V(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(x=s.B(i[1]),x!=="string"&&w.push(new s.V(`${l}[1]`,i[1],`string expected, ${x} found`)));for(let E=2;E<i.length;E++)x=s.B(i[E]),s.D(i[1])==="$type"?w=w.concat(Wa({key:`${l}[${E}]`,value:i[E],valueSpec:p.geometry_type,style:f.style,styleSpec:f.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&w.push(new s.V(`${l}[${E}]`,i[E],`string, number, or boolean expected, ${x} found`));break;case"any":case"all":case"none":for(let E=1;E<i.length;E++)w=w.concat(mn({key:`${l}[${E}]`,value:i[E],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":x=s.B(i[1]),i.length!==2?w.push(new s.V(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):x!=="string"&&w.push(new s.V(`${l}[1]`,i[1],`string expected, ${x} found`))}return w}function vc(f,i){const l=f.key,p=f.style,x=f.layer,w=f.styleSpec,E=f.value,R=f.objectKey,L=w[`${i}_${f.layerType}`];if(!L)return[];const z=R.match(/^(.*)-transition$/);if(i==="paint"&&z&&L[z[1]]&&L[z[1]].transition)return zn({key:l,value:E,valueSpec:w.transition,style:p,styleSpec:w});const B=f.valueSpec||L[R];if(!B)return[new s.A(l,E,`unknown property "${R}"`)];let G;if(s.B(E)==="string"&&s.G(B)&&!B.tokens&&(G=/^{([^}]+)}$/.exec(E))){const Y=`\`{ "type": "identity", "property": ${G?JSON.stringify(G[1]):'"_"'} }\``;return[new s.V(l,E,`"${R}" does not support interpolation syntax
Use an identity property function instead: ${Y}.`)]}const Z=[];if(f.layerType==="symbol")R!=="text-field"||!p||p.glyphs||p.imports||Z.push(new s.V(l,E,'use of "text-field" requires a style "glyphs" property')),R==="text-font"&&s.X(s.K(E))&&s.D(E.type)==="identity"&&Z.push(new s.V(l,E,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&i==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&s.G(B)&&(s.Y(B)||s.H(B))){const Y=s.L(s.K(E),B),se=Y.value.expression||Y.value._styleExpression.expression;se&&!s.O(se,["measure-light"])&&(R==="model-emissive-strength"&&s.Q(se)&&s.N(se)||Z.push(new s.V(l,E,`${R} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Z.concat(zn({key:f.key,value:E,valueSpec:B,style:p,styleSpec:w,expressionContext:"property",propertyType:i,propertyKey:R}))}function ua(f){return vc(f,"paint")}function Tl(f){return vc(f,"layout")}function Bi(f){let i=[];const l=f.value,p=f.key,x=f.style,w=f.styleSpec;l.type||l.ref||i.push(new s.V(p,l,'either "type" or "ref" is required'));let E=s.D(l.type);const R=s.D(l.ref);if(l.id){const L=s.D(l.id);for(let z=0;z<f.arrayIndex;z++){const B=x.layers[z];s.D(B.id)===L&&i.push(new s.V(p,l.id,`duplicate layer id "${l.id}", previously used at line ${B.id.__line__}`))}}if("ref"in l){let L;["type","source","source-layer","filter","layout"].forEach(z=>{z in l&&i.push(new s.V(p,l[z],`"${z}" is prohibited for ref layers`))}),x.layers.forEach(z=>{s.D(z.id)===R&&(L=z)}),L?L.ref?i.push(new s.V(p,l.ref,"ref cannot reference another ref layer")):E=s.D(L.type):typeof R=="string"&&i.push(new s.V(p,l.ref,`ref layer "${R}" not found`))}else if(E!=="background"&&E!=="sky"&&E!=="slot")if(l.source){const L=x.sources&&x.sources[l.source],z=L&&s.D(L.type);L?z==="vector"&&E==="raster"?i.push(new s.V(p,l.source,`layer "${l.id}" requires a raster source`)):z==="raster"&&E!=="raster"?i.push(new s.V(p,l.source,`layer "${l.id}" requires a vector source`)):z!=="vector"||l["source-layer"]?z==="raster-dem"&&E!=="hillshade"?i.push(new s.V(p,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):z!=="raster-array"||["raster","raster-particle"].includes(E)?E!=="line"||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||z==="geojson"&&L.lineMetrics?E==="raster-particle"&&z!=="raster-array"&&i.push(new s.V(p,l.source,`layer "${l.id}" requires a 'raster-array' source.`)):i.push(new s.V(p,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new s.V(p,l.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new s.V(p,l,`layer "${l.id}" must specify a "source-layer"`)):i.push(new s.V(p,l.source,`source "${l.source}" not found`))}else i.push(new s.V(p,l,'missing required property "source"'));return i=i.concat(Br({key:p,value:l,valueSpec:w.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>zn({key:`${p}.type`,value:l.type,valueSpec:w.layer.type,style:f.style,styleSpec:f.styleSpec,object:l,objectKey:"type"}),filter:L=>xc(s.C({layerType:E},L)),layout:L=>Br({layer:l,key:L.key,value:L.value,valueSpec:{},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{"*":z=>Tl(s.C({layerType:E},z))}}),paint:L=>Br({layer:l,key:L.key,value:L.value,valueSpec:{},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{"*":z=>ua(s.C({layerType:E,layer:l},z))}})}})),i}function Ss(f){const i=f.value,l=f.key,p=s.B(i);return p!=="string"?[new s.V(l,i,`string expected, ${p} found`)]:[]}const pd={promoteId:function({key:f,value:i}){if(s.B(i)==="string")return Ss({key:f,value:i});{const l=[];for(const p in i)l.push(...Ss({key:`${f}.${p}`,value:i[p]}));return l}}};function md(f){const i=f.value,l=f.key,p=f.styleSpec,x=f.style;if(!i.type)return[new s.V(l,i,'"type" is required')];const w=s.D(i.type);let E=[];switch(["vector","raster","raster-dem","raster-array"].includes(w)&&(i.url||i.tiles||E.push(new s.A(l,i,'Either "url" or "tiles" is required.'))),w){case"vector":case"raster":case"raster-dem":case"raster-array":return E=E.concat(Br({key:l,value:i,valueSpec:p[`source_${w.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:pd})),E;case"geojson":if(E=Br({key:l,value:i,valueSpec:p.source_geojson,style:x,styleSpec:p,objectElementValidators:pd}),i.cluster)for(const R in i.clusterProperties){const[L,z]=i.clusterProperties[R],B=typeof L=="string"?[L,["accumulated"],["get",R]]:L;E.push(...io({key:`${l}.${R}.map`,value:z,expressionContext:"cluster-map"})),E.push(...io({key:`${l}.${R}.reduce`,value:B,expressionContext:"cluster-reduce"}))}return E;case"video":return Br({key:l,value:i,valueSpec:p.source_video,style:x,styleSpec:p});case"image":return Br({key:l,value:i,valueSpec:p.source_image,style:x,styleSpec:p});case"canvas":return[new s.V(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Wa({key:`${l}.type`,value:i.type,valueSpec:{values:bc(p)},style:x,styleSpec:p})}}function bc(f){return f.source.reduce((i,l)=>{const p=f[l];return p.type.type==="enum"&&(i=i.concat(Object.keys(p.type.values))),i},[])}function da(f){const i=f.value,l=f.styleSpec,p=l.light,x=f.style;let w=[];const E=s.B(i);if(i===void 0)return w;if(E!=="object")return w=w.concat([new s.V("light",i,`object expected, ${E} found`)]),w;for(const R in i){const L=R.match(/^(.*)-transition$/);w=w.concat(L&&p[L[1]]&&p[L[1]].transition?zn({key:R,value:i[R],valueSpec:l.transition,style:x,styleSpec:l}):p[R]?zn({key:R,value:i[R],valueSpec:p[R],style:x,styleSpec:l}):[new s.V(R,i[R],`unknown property "${R}"`)])}return w}function El(f){const i=f.value;let l=[];if(!i)return l;const p=s.B(i);if(p!=="object")return l=l.concat([new s.V("light-3d",i,`object expected, ${p} found`)]),l;const x=f.styleSpec,w=x["light-3d"],E=f.key,R=f.style,L=f.style.lights;for(const G of["type","id"])if(!(G in i))return l=l.concat([new s.V("light-3d",i,`missing property ${G} on light`)]),l;if(i.type&&L)for(let G=0;G<f.arrayIndex;G++){const Z=s.D(i.type),Y=L[G];s.D(Y.type)===Z&&l.push(new s.V(E,i.id,`duplicate light type "${i.type}", previously defined at line ${Y.id.__line__}`))}const z=`properties_light_${i.type}`;if(!(z in x))return l=l.concat([new s.V("light-3d",i,`Invalid light type ${i.type}`)]),l;const B=x[z];for(const G in i)if(G==="properties"){const Z=i[G],Y=s.B(Z);if(Y!=="object")return l=l.concat([new s.V("properties",Z,`object expected, ${Y} found`)]),l;for(const se in Z)l=l.concat(B[se]?zn({key:se,value:Z[se],valueSpec:B[se],style:R,styleSpec:x}):[new s.A(f.key,Z[se],`unknown property "${se}"`)])}else{const Z=G.match(/^(.*)-transition$/);l=l.concat(Z&&w[Z[1]]&&w[Z[1]].transition?zn({key:G,value:i[G],valueSpec:x.transition,style:R,styleSpec:x}):w[G]?zn({key:G,value:i[G],valueSpec:w[G],style:R,styleSpec:x}):[new s.A(G,i[G],`unknown property "${G}"`)])}return l}function wc(f){const i=f.value,l=f.key,p=f.style,x=f.styleSpec,w=x.terrain;let E=[];const R=s.B(i);if(i===void 0||R==="null")return E;if(R!=="object")return E=E.concat([new s.V("terrain",i,`object expected, ${R} found`)]),E;for(const L in i){const z=L.match(/^(.*)-transition$/);E=E.concat(z&&w[z[1]]&&w[z[1]].transition?zn({key:L,value:i[L],valueSpec:x.transition,style:p,styleSpec:x}):w[L]?zn({key:L,value:i[L],valueSpec:w[L],style:p,styleSpec:x}):[new s.A(L,i[L],`unknown property "${L}"`)])}if(i.source){const L=p.sources&&p.sources[i.source],z=L&&s.D(L.type);L?z!=="raster-dem"&&E.push(new s.V(l,i.source,`terrain cannot be used with a source of type ${String(z)}, it only be used with a "raster-dem" source type`)):E.push(new s.V(l,i.source,`source "${i.source}" not found`))}else E.push(new s.V(l,i,'terrain is missing required property "source"'));return E}function Bs(f){const i=f.value,l=f.style,p=f.styleSpec,x=p.fog;let w=[];const E=s.B(i);if(i===void 0)return w;if(E!=="object")return w=w.concat([new s.V("fog",i,`object expected, ${E} found`)]),w;for(const R in i){const L=R.match(/^(.*)-transition$/);w=w.concat(L&&x[L[1]]&&x[L[1]].transition?zn({key:R,value:i[R],valueSpec:p.transition,style:l,styleSpec:p}):x[R]?zn({key:R,value:i[R],valueSpec:x[R],style:l,styleSpec:p}):[new s.A(R,i[R],`unknown property "${R}"`)])}return w}const gd={"*":()=>[],array:ro,boolean:function(f){const i=f.value,l=f.key,p=s.B(i);return p!=="boolean"?[new s.V(l,i,`boolean expected, ${p} found`)]:[]},number:wn,color:function(f){const i=f.key,l=f.value,p=s.B(l);return p!=="string"?[new s.V(i,l,`color expected, ${p} found`)]:s.U.parseCSSColor(l)===null?[new s.V(i,l,`color expected, "${l}" found`)]:[]},enum:Wa,filter:xc,function:vi,layer:Bi,object:Br,source:md,model:s.Z,light:da,"light-3d":El,terrain:wc,fog:Bs,string:Ss,formatted:function(f){return Ss(f).length===0?[]:io(f)},resolvedImage:function(f){return Ss(f).length===0?[]:io(f)},projection:function(f){const i=f.value,l=f.styleSpec,p=l.projection,x=f.style;let w=[];const E=s.B(i);if(E==="object")for(const R in i)w=w.concat(zn({key:R,value:i[R],valueSpec:p[R],style:x,styleSpec:l}));else E!=="string"&&(w=w.concat([new s.V("projection",i,`object or string expected, ${E} found`)]));return w},import:function(f){const{value:i,styleSpec:l}=f,{data:p,...x}=i;Object.defineProperty(x,"__line__",{value:i.__line__,enumerable:!1});let w=Br(s.C({},f,{value:x,valueSpec:l.import}));return s.D(x.id)===""&&w.push(new s.V(`${f.key}.id`,x,"import id can't be an empty string")),p&&(w=w.concat(Xh(p,l,{key:`${f.key}.data`}))),w}};function zn(f,i=!1){const l=f.value,p=f.valueSpec,x=f.styleSpec;if(p.expression&&s.X(s.D(l)))return vi(f);if(p.expression&&s.J(s.K(l)))return io(f);if(p.type&&gd[p.type]){const w=gd[p.type](f);return i===!0&&w.length>0&&s.B(f.value)==="array"?io(f):w}return Br(s.C({},f,{valueSpec:p.type?x[p.type]:p}))}function No(f){const i=f.value,l=f.key,p=Ss(f);return p.length||(i.indexOf("{fontstack}")===-1&&p.push(new s.V(l,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&p.push(new s.V(l,i,'"glyphs" url must include a "{range}" token'))),p}function Xh(f,i=s._,l={}){return zn({key:l.key||"",value:f,valueSpec:i.$root,styleSpec:i,style:f,objectElementValidators:{glyphs:No,"*":()=>[]}})}function Ts(f,i=s._){return Ae(Xh(f,i))}const Cl=f=>Ae(md(f)),yd=f=>Ae(da(f)),Sc=f=>Ae(El(f)),_d=f=>Ae(wc(f)),Pl=f=>Ae(Bs(f)),Ke=f=>Ae(Bi(f)),ce=f=>Ae(xc(f)),de=f=>Ae(ua(f)),we=f=>Ae(Tl(f)),Re=f=>Ae(s.Z(f));function Ae(f){return f.slice().sort((i,l)=>i.line&&l.line?i.line-l.line:0)}function Be(f,i){let l=!1;if(i&&i.length)for(const p of i)p instanceof s.A?s.w(p.message):(f.fire(new s.t(new Error(p.message))),l=!0);return l}let Xe;class Ge extends s.E{constructor(i,l="flat"){super(),this._transitionable=new s.$(Xe||(Xe=new s.a0({anchor:new s.a1(s._.light.anchor),position:new s.a2(s._.light.position),color:new s.a1(s._.light.color),intensity:new s.a1(s._.light.intensity)}))),this.setLight(i,l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,l,p={}){this._validate(yd,i,p)||(this._transitionable.setTransitionOrValue(i),this.id=l)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,l,p){return(!p||p.validate!==!1)&&Be(this,i.call(Ts,s.l({value:l,style:{glyphs:!0,sprite:!0},styleSpec:s._})))}}const Ye=new s.a0({source:new s.a1(s._.terrain.source),exaggeration:new s.a1(s._.terrain.exaggeration)});let st=class extends s.E{constructor(f,i,l,p){super(),this.scope=l,this._transitionable=new s.$(Ye,l,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(f,i){this._transitionable.setTransitionOrValue(f,i)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new s.a3(f)).get("exaggeration")}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof s.a4}};const nt=45,yt=65,Rt=.05;function kt(f,i,l,p){const x=s.a7(nt,yt,l),[w,E]=rn(f,p);let R=1-Math.min(1,Math.exp((i-w)/(E-w)*-6));return R*=R*R,R=Math.min(1,1.00747*R),R*x*f.alpha}function rn(f,i){const l=.5/Math.tan(.5*i);return[f.range[0]+l,f.range[1]+l]}function on(f,i,l,p,x){const w=s.a6.vec3.transformMat4([],[i,l,p],x.mercatorFogMatrix);return kt(f,s.a6.vec3.length(w),x.pitch,x._fov)}function ln(f,i,l,p,x,w,E){const R=[[l,p,0],[x,p,0],[x,w,0],[l,w,0]];let L=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(const B of R){const G=s.a6.vec3.transformMat4([],B,i),Z=s.a6.vec3.length(G);L=Math.min(L,Z),z=Math.max(z,Z)}return[kt(f,L,E.pitch,E._fov),kt(f,z,E.pitch,E._fov)]}const an=new s.a0({range:new s.a1(s._.fog.range),color:new s.a1(s._.fog.color),"high-color":new s.a1(s._.fog["high-color"]),"space-color":new s.a1(s._.fog["space-color"]),"horizon-blend":new s.a1(s._.fog["horizon-blend"]),"star-intensity":new s.a1(s._.fog["star-intensity"]),"vertical-range":new s.a1(s._.fog["vertical-range"])});class Xn extends s.E{constructor(i,l,p,x){super(),this._transitionable=new s.$(an,p,new Map(x)),this.set(i,x),this._transitioning=this._transitionable.untransitioned(),this._transform=l,this.properties=new s.a8(an),this.scope=p}get state(){const i=this._transform,l=i.projection.name==="globe",p=s.a9(i.zoom),x=this.properties.get("range"),w=[.5,3];return{range:l?[s.aa(w[0],x[0],p),s.aa(w[1],x[1],p)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,l,p={}){if(this._validate(Pl,i,p))return;const x=s.l({},i);for(const w of Object.keys(s._.fog))x[w]===void 0&&(x[w]=s._.fog[w].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,l)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.a7(nt,yt,i))*l.a}getOpacityAtLatLng(i,l){return this._transform.projection.supportsFog?function(p,x,w){const E=s.a5.fromLngLat(x),R=w.elevation?w.elevation.getAtPointOrZero(E):0;return on(p,E.x,E.y,R,w)}(this.state,i,l):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];const l=this._transform.calculateFogTileMatrix(i.toUnwrapped());return ln(this.state,l,0,0,s.ab,s.ab,this._transform)}getOpacityForBounds(i,l,p,x,w){return this._transform.projection.supportsFog?ln(this.state,i,l,p,x,w,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?rn(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;const l=[4,5,6,7];for(const p of l){const x=i.points[p];let w;if(x[2]>=0)w=x;else{const E=i.points[p-4];w=s.ac(E,x,E[2]/(E[2]-x[2]))}if(on(this.state,w[0],w[1],0,this._transform)>=Rt)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,l,p){return(!p||p.validate!==!1)&&Be(this,i.call(Ts,s.l({value:l,style:{glyphs:!0,sprite:!0},styleSpec:s._})))}}class rr extends s.E{constructor(i,l,p,x){super(),this.scope=p,this._options=i,this.properties=new s.a8(l),this._transitionable=new s.$(l,p,new Map(x)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,l){this._options=i,this._transitionable.setTransitionOrValue(i.properties,l)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let gn,tr;class Er{constructor(i,l,p,x){this.screenBounds=i,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(i,l){let p,x;if(i instanceof s.P||typeof i[0]=="number"){const w=s.P.convert(i);p=[w],x=l.isPointAboveHorizon(w)}else{const w=s.P.convert(i[0]),E=s.P.convert(i[1]);p=[w,E],x=s.ae(w,E).every(R=>l.isPointAboveHorizon(R))}return new Er(p,l.getCameraPoint(),x,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return s.ae(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],x=s.ae(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?x[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(x[3]=this.cameraPoint)),s.af(x,i)}bufferedCameraGeometryGlobe(i){const l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],x=s.ae(l,p,i),w=this.cameraPoint.clone();switch(3*((w.y>l.y)+(w.y>p.y))+((w.x>l.x)+(w.x>p.x))){case 0:x[0]=w,x[4]=w.clone();break;case 1:x.splice(1,0,w);break;case 2:x[1]=w;break;case 3:x.splice(4,0,w);break;case 5:x.splice(2,0,w);break;case 6:x[3]=w;break;case 7:x.splice(3,0,w);break;case 8:x[2]=w}return x}containsTile(i,l,p,x=0){const w=i.queryPadding/l._pixelsPerMercatorPixel+1,E=p?this._bufferedCameraMercator(w,l):this._bufferedScreenMercator(w,l);let R=i.tileID.wrap+(E.unwrapped?x:0);const L=E.polygon.map(ae=>s.ag(i.tileTransform,ae,R));if(!s.ah(L,0,0,s.ab,s.ab))return;R=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const z=this.screenGeometryMercator.polygon.map(ae=>s.ai(i.tileTransform,ae,R)),B=z.map(ae=>new s.P(ae[0],ae[1])),G=l.getFreeCameraOptions().position||new s.a5(0,0,0),Z=s.ai(i.tileTransform,G,R),Y=z.map(ae=>{const le=s.a6.vec3.sub(ae,ae,Z);return s.a6.vec3.normalize(le,le),new s.aj(Z,le)}),se=s.ak(i,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:B,tilespaceRays:Y,bufferedTilespaceGeometry:L,bufferedTilespaceBounds:(oe=s.al(L),oe.min.x=s.ap(oe.min.x,0,s.ab),oe.min.y=s.ap(oe.min.y,0,s.ab),oe.max.x=s.ap(oe.max.x,0,s.ab),oe.max.y=s.ap(oe.max.y,0,s.ab),oe),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:se};var oe}_bufferedScreenMercator(i,l){const p=Di(i);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let x;return x=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),l):{polygon:this.bufferedScreenGeometry(i).map(w=>l.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[p]=x,x}}_bufferedCameraMercator(i,l){const p=Di(i);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let x;return x=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),l):{polygon:this.bufferedCameraGeometry(i).map(w=>l.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[p]=x,x}}_projectAndResample(i,l){const p=function(w,E){const R=s.a6.mat4.multiply([],E.pixelMatrix,E.globeMatrix),L=[0,-s.aq,0,1],z=[0,s.aq,0,1],B=[0,0,0,1];s.a6.vec4.transformMat4(L,L,R),s.a6.vec4.transformMat4(z,z,R),s.a6.vec4.transformMat4(B,B,R);const G=new s.P(L[0]/L[3],L[1]/L[3]),Z=new s.P(z[0]/z[3],z[1]/z[3]),Y=s.an(w,G)&&L[3]<B[3],se=s.an(w,Z)&&z[3]<B[3];if(!Y&&!se)return null;const oe=function(Pe,Te,Me){for(let Oe=1;Oe<Pe.length;Oe++){const ke=si(Te.pointCoordinate3D(Pe[Oe-1]).x),De=si(Te.pointCoordinate3D(Pe[Oe]).x);if(Me<0){if(ke<De)return{idx:Oe,t:-ke/(De-1-ke)}}else if(De<ke)return{idx:Oe,t:(1-ke)/(De+1-ke)}}return null}(w,E,Y?-1:1);if(!oe)return null;const{idx:ae,t:le}=oe;let me=ae>1?ei(w.slice(0,ae),E):[],ye=ae<w.length?ei(w.slice(ae),E):[];me=me.map(Pe=>new s.P(si(Pe.x),Pe.y)),ye=ye.map(Pe=>new s.P(si(Pe.x),Pe.y));const fe=[...me];fe.length===0&&fe.push(ye[ye.length-1]);const be=s.aa(fe[fe.length-1].y,(ye.length===0?me[0]:ye[0]).y,le);let ve;return ve=Y?[new s.P(0,be),new s.P(0,0),new s.P(1,0),new s.P(1,be)]:[new s.P(1,be),new s.P(1,1),new s.P(0,1),new s.P(0,be)],fe.push(...ve),ye.length===0?fe.push(me[0]):fe.push(...ye),{polygon:fe.map(Pe=>new s.a5(Pe.x,Pe.y)),unwrapped:!1}}(i,l);if(p)return p;const x=function(w,E){let R=!1,L=-1/0,z=0;for(let G=0;G<w.length-1;G++)w[G].x>L&&(L=w[G].x,z=G);for(let G=0;G<w.length-1;G++){const Z=(z+G)%(w.length-1),Y=w[Z],se=w[Z+1];Math.abs(Y.x-se.x)>.5&&(Y.x<se.x?(Y.x+=1,Z===0&&(w[w.length-1].x+=1)):(se.x+=1,Z+1===w.length-1&&(w[0].x+=1)),R=!0)}const B=s.am(E.center.lng);return R&&B<Math.abs(B-1)&&w.forEach(G=>{G.x-=1}),{polygon:w,unwrapped:R}}(ei(i,l).map(w=>new s.P(si(w.x),w.y)),l);return{polygon:x.polygon.map(w=>new s.a5(w.x,w.y)),unwrapped:x.unwrapped}}}function ei(f,i){return s.ao(f,l=>{const p=i.pointCoordinate3D(l);l.x=p.x,l.y=p.y},1/256)}function si(f){return f<0?1+f%1:f%1}function Di(f){return 100*f|0}function so(f,i,l,p,x){const w=function(R,L){if(R)return x(R);if(L){if(f.url&&L.tiles&&f.tiles&&delete f.tiles,L.variants){if(!Array.isArray(L.variants))return x(new Error("variants must be an array"));for(const B of L.variants){if(B==null||typeof B!="object"||B.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(B.capabilities))return x(new Error("capabilities must be an array"));if(B.capabilities.length===1&&B.capabilities[0]==="meshopt"){L=s.l(L,B);break}}}const z=s.ar(s.l(L,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);L.vector_layers&&(z.vectorLayers=L.vector_layers,z.vectorLayerIds=z.vectorLayers.map(B=>B.id)),L.raster_layers&&(z.rasterLayers=L.raster_layers,z.rasterLayerIds=z.rasterLayers.map(B=>B.id)),z.tiles=i.canonicalizeTileset(z,f.url),x(null,z)}},E=function(R,L,z){if(!R)return null;if(!L&&!z)return R;z=z||R.worldview_default;const B=Object.values(R.language||{});if(B.length===0)return null;const G=Object.values(R.worldview||{});if(G.length===0)return null;const Z=B.every(se=>se===L),Y=G.every(se=>se===z);return Z&&Y?R:L in(R.language_options||{})||z in(R.worldview_options||{})?null:R.language_options&&R.worldview_options?R:null}(f.data,l,p);return E?s.q.frame(()=>w(null,E)):f.url?s.n(i.transformRequest(i.normalizeSourceURL(f.url,null,l,p),s.R.Source),w):s.q.frame(()=>{const{data:R,...L}=f;w(null,L)})}class ha{constructor(i,l,p){this.bounds=s.as.convert(this.validateBounds(i)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const l=Math.pow(2,i.z),p=Math.floor(s.am(this.bounds.getWest())*l),x=Math.floor(s.at(this.bounds.getNorth())*l),w=Math.ceil(s.am(this.bounds.getEast())*l),E=Math.ceil(s.at(this.bounds.getSouth())*l);return i.x>=p&&i.x<w&&i.y>=x&&i.y<E}}class Yh extends s.E{constructor(i,l,p,x){if(super(),this.id=i,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.l(this,s.ar(l,["url","scheme","tileSize","promoteId"])),this._options=s.l({type:"vector"},l),this._collectResourceTiming=!!l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new s.au}load(i){this._loaded=!1,this.fire(new s.x("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map._worldview;this._tileJSONRequest=so(this._options,this.map._requestManager,l,p,(x,w)=>{this._tileJSONRequest=null,this._loaded=!0,x?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),p&&p.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new s.t(x))):w&&(s.l(this,w),w.bounds&&(this.tileBounds=new ha(w.bounds,this.minzoom,this.maxzoom)),wr(w.tiles,this.map._requestManager._customAccessToken),this.fire(new s.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.x("data",{dataType:"source",sourceDataType:"content"}))),i&&i(x)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=s.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}loadTile(i,l){const p=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),x=this.map._requestManager.transformRequest(p,s.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,E={request:x,data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,lut:w?{image:w.image.clone()}:null,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(E.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=l:i.request=i.actor.send("reloadTile",E,R.bind(this));else if(i.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",E,R.bind(this),void 0,!0);else{const L=s.aw.call({deduped:this._deduped},E,(z,B)=>{z||!B?R.call(this,z):(E.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},i.actor&&i.actor.send("loadTile",E,R.bind(this),void 0,!0))},!0);i.request={cancel:L}}function R(L,z){return delete i.request,i.aborted?l(null):L&&L.status!==404?l(L):(z&&z.resourceTiming&&(i.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&i.setExpiryData(z),i.loadVectorData(z,this.map.painter),s.ax(this.dispatcher),l(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,l){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class xd extends s.E{constructor(i,l,p,x){super(),this.id=i,this.dispatcher=p,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.l({type:"raster"},l),s.l(this,s.ar(l,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new s.x("dataloading",{dataType:"source"})),this._tileJSONRequest=so(this._options,this.map._requestManager,null,null,(l,p)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new s.t(l)):p&&(s.l(this,p),p.bounds&&(this.tileBounds=new ha(p.bounds,this.minzoom,this.maxzoom)),wr(p.tiles),this.fire(new s.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.x("data",{dataType:"source",sourceDataType:"content"}))),i&&i(l)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=s.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,l){const p=s.q.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);i.request=s.o(this.map._requestManager.transformRequest(x,s.R.Tile),(w,E,R,L)=>(delete i.request,i.aborted?(i.state="unloaded",l(null)):w?(i.state="errored",l(w)):E?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:R,expires:L}),i.setTexture(E,this.map.painter),i.state="loaded",s.ax(this.dispatcher),void l(null)):l(null)))}abortTile(i,l){i.request&&(i.request.cancel(),delete i.request),l&&l()}unloadTile(i,l){i.texture&&i.texture instanceof s.T?(i.destroy(!0),i.texture&&i.texture instanceof s.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),l&&l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Tc extends xd{constructor(i,l,p,x){super(i,l,p,x),this.type="raster-array",this.maxzoom=22,this._options=s.l({type:"raster-array"},l)}triggerRepaint(i){const l=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);l&&l.enabled&&p&&l._clearRenderCacheForTile(p.id,i.tileID),this.map.triggerRepaint()}loadTile(i,l){const p=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(p,s.R.Tile);i.requestParams=x,i.actor||(i.actor=this.dispatcher.getActor()),i.request=i.fetchHeader(void 0,(w,E,R,L)=>{if(delete i.request,i.aborted)return i.state="unloaded",l(null);if(w)return w.code===20?void 0:(i.state="errored",l(w));this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:R,expires:L}),i.state="empty",l(null)})}unloadTile(i,l){const p=i.texture;p&&p instanceof s.T?(i.destroy(!0),this.map.painter.saveTileTexture(p)):(i.destroy(),i.flushQueues(),i._isHeaderLoaded=!1,delete i._mrt,delete i.textureDescriptor),i.fbo&&(i.fbo.destroy(),delete i.fbo),delete i.request,delete i.requestParams,delete i.neighboringTiles,i.state="unloaded"}prepareTile(i,l,p){i._isHeaderLoaded&&(i.state!=="empty"&&(i.state="reloading"),i.fetchBand(l,p,(x,w)=>{if(x)return i.state="errored",this.fire(new s.t(x)),void this.triggerRepaint(i);w&&(i.setTexture(w,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(i){if(!this.rasterLayers)return 0;const l=this.rasterLayers.find(({id:w})=>w===i),p=l&&l.fields,x=p&&p.bands&&p.bands;return x?x[0]:0}getTextureDescriptor(i,l,p){if(!i)return;const x=l.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let w=null;l instanceof s.aB?w=l.paint.get("raster-array-band"):l instanceof s.aC&&(w=l.paint.get("raster-particle-array-band"));const E=w||this.getInitialBand(x);if(E!=null)if(i.textureDescriptor){if(!i.updateNeeded(x,E)||p)return Object.assign({},i.textureDescriptor,{texture:i.texture})}else this.prepareTile(i,x,E)}}const Kh={vector:Yh,raster:xd,"raster-dem":class extends xd{constructor(f,i,l,p){super(f,i,l,p),this.type="raster-dem",this.maxzoom=22,this._options=s.l({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(f,i){const l=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(x,w){x&&(f.state="errored",i(x)),w&&(f.dem=w,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",i(null))}f.request=s.o(this.map._requestManager.transformRequest(l,s.R.Tile),(function(x,w,E,R){if(delete f.request,f.aborted)f.state="unloaded",i(null);else if(x)f.state="errored",i(x);else if(w){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:E,expires:R});const L=ImageBitmap&&w instanceof ImageBitmap&&s.ay(),z=1-(w.width-s.az(w.width))/2;z<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const B=L?w:s.q.getImageData(w,z),G={uid:f.uid,coord:f.tileID,source:this.id,scope:this.scope,rawImageData:B,encoding:this.encoding,padding:z};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",G,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const i=f.canonical,l=Math.pow(2,i.z),p=(i.x-1+l)%l,x=i.x===0?f.wrap-1:f.wrap,w=(i.x+1+l)%l,E=i.x+1===l?f.wrap+1:f.wrap,R={};return R[new s.aA(f.overscaledZ,x,i.z,p,i.y).key]={backfilled:!1},R[new s.aA(f.overscaledZ,E,i.z,w,i.y).key]={backfilled:!1},i.y>0&&(R[new s.aA(f.overscaledZ,x,i.z,p,i.y-1).key]={backfilled:!1},R[new s.aA(f.overscaledZ,f.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},R[new s.aA(f.overscaledZ,E,i.z,w,i.y-1).key]={backfilled:!1}),i.y+1<l&&(R[new s.aA(f.overscaledZ,x,i.z,p,i.y+1).key]={backfilled:!1},R[new s.aA(f.overscaledZ,f.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},R[new s.aA(f.overscaledZ,E,i.z,w,i.y+1).key]={backfilled:!1}),R}},"raster-array":Tc,geojson:class extends s.E{constructor(f,i,l,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=i.data,this._options=s.l({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.minzoom!==void 0&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const x=s.ab/this.tileSize;this.workerOptions=s.l({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*x,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*x,extent:s.ab,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:s.ab,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*x,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new s.t(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new s.t(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const i=new Map;for(const l of this._data.features)i.set(l.id,l);for(const l of f.features)i.set(l.id,l);this._data.features=[...i.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},i),this}getClusterChildren(f,i){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},i),this}getClusterLeaves(f,i,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:i,offset:l},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.x("dataloading",{dataType:"source"})),this._loaded=!1;const i=s.l({append:f},this.workerOptions);i.scope=this.scope;const l=this._data;typeof l=="string"?(i.request=this.map._requestManager.transformRequest(s.q.resolveURL(l),s.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,(p,x)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new s.t(p));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(w.resourceTiming=x.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new s.x("data",w)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,i){const l=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,x=this._partialReload,w={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:p?{image:p.image.clone()}:null,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:x};f.request=this.actor.send(l,w,(E,R)=>x&&!R?(f.state="loaded",i(null)):(delete f.request,f.destroy(),f.aborted?i(null):E?i(E):(f.loadVectorData(R,this.map.painter,l==="reloadTile"),i(null))),void 0,l==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,i){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aD{constructor(f,i,l,p){super(f,i,l,p),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const i of f.urls)this.urls.push(this.map._requestManager.transformRequest(i,s.R.Source).url);s.aE(this.urls,(i,l)=>{this._loaded=!0,i?this.fire(new s.t(i)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const i=this.video.seekable;f<i.start(0)||f>i.end(0)?this.fire(new s.t(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,i=f.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(f,this.video,i.RGBA8),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aD,model:class extends s.E{constructor(f,i,l,p){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){const f=[];for(const i in this._options.models){const l=this._options.models[i],p=s.aG(this.map._requestManager.transformRequest(l.uri,s.R.Model).url).then(x=>{if(!x)return;const w=s.aH(x),E=new s.aI(i,l.position,l.orientation,w);E.computeBoundsAndApplyParent(),this.models.push(E)}).catch(x=>{this.fire(new s.t(new Error(`Could not load model ${i} from ${l.uri}: ${x.message}`)))});f.push(p)}return Promise.allSettled(f).then(()=>{this._loaded=!0,this.fire(new s.x("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this.fire(new s.t(new Error(`Could not load models: ${i.message}`)))})}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,i){}serialize(){return{type:"model"}}},"batched-model":class extends s.E{constructor(f,i,l,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=l,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}load(f){this._loaded=!1,this.fire(new s.x("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map._worldview;this._tileJSONRequest=so(this._options,this.map._requestManager,i,l,(p,x)=>{this._tileJSONRequest=null,this._loaded=!0,p?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new s.t(p))):x&&(s.l(this,x),x.bounds&&(this.tileBounds=new ha(x.bounds,this.minzoom,this.maxzoom)),wr(x.tiles,this.map._requestManager._customAccessToken),this.fire(new s.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.x("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,i){const l=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(l,s.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=i;else{if(f.buckets){const w=Object.values(f.buckets);for(const E of w)E.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,x.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,x.bind(this),void 0,!0);function x(w,E){return f.aborted?i(null):w&&w.status!==404?i(w):(E&&(E.resourceTiming&&(f.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&f.setExpiryData(E),f.buckets={...f.buckets,...E.buckets},E.featureIndex&&(f.latestFeatureIndex=E.featureIndex)),f.state="loaded",void i(null))}}serialize(){return s.l({},this._options)}},canvas:class extends s.aD{constructor(f,i,l,p){super(f,i,l,p),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(w=>typeof w!="number"))||this.fire(new s.t(new s.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.t(new s.V(`sources.${f}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new s.t(new s.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new s.t(new s.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.t(new s.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.t(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof s.aF||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(i,this.canvas,i.gl.RGBA8,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends s.E{constructor(f,i,l,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=i,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.t(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.t(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ha(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),s.l(this,s.ar(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.ar(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.x("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new s.x("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:i,y:l,z:p}=f.canonical;return this._implementation.hasTile({x:i,y:l,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,i){const{x:l,y:p,z:x}=f.tileID.canonical,w=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:l,y:p,z:x},{signal:w.signal})).then((function(E){return delete f.request,f.aborted?(f.state="unloaded",i(null)):E===void 0?(f.state="errored",i(null)):E===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",i(null)):function(R){return R instanceof ImageData||R instanceof HTMLCanvasElement||R instanceof ImageBitmap||R instanceof HTMLImageElement}(E)?(this.loadTileData(f,E),f.state="loaded",void i(null)):(f.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(E=>{E.code!==20&&(f.state="errored",i(E))}),f.request.cancel=()=>w.abort()}loadTileData(f,i){f.setTexture(i,this.map.painter)}unloadTile(f,i){if(f.texture&&f.texture instanceof s.T?(f.destroy(!0),f.texture&&f.texture instanceof s.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:l,y:p,z:x}=f.tileID.canonical;this._implementation.unloadTile({x:l,y:p,z:x})}i&&i()}abortTile(f,i){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),i&&i()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){const f=s.av(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new s.x("data",{dataType:"source",sourceDataType:"content"}))}}},Ec=function(f,i,l,p){const x=new Kh[i.type](f,i,l,p);if(x.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${x.id}`);return s.aJ(["load","abort","unload","serialize","prepare"],x),x};function Em(f,i){const l=s.a6.mat4.identity([]);return s.a6.mat4.scale(l,l,[.5*f.width,.5*-f.height,1]),s.a6.mat4.translate(l,l,[1,-1,0]),s.a6.mat4.multiply(l,l,f.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(l)}function Cm(f,i,l,p,x,w,E,R=!1){const L=f.tilesIn(p,E,R);L.sort(Cc);const z=[];for(const G of L)z.push({wrappedTileID:G.tile.tileID.wrapped().key,queryResults:G.tile.queryRenderedFeatures(i,l,f._state,G,x,w,Em(f.transform,G.tile.tileID),R)});const B=function(G){const Z={},Y={};for(const se of G){const oe=se.queryResults,ae=se.wrappedTileID,le=Y[ae]=Y[ae]||{};for(const me in oe){const ye=oe[me],fe=le[me]=le[me]||{},be=Z[me]=Z[me]||[];for(const ve of ye)fe[ve.featureIndex]||(fe[ve.featureIndex]=!0,be.push(ve))}}return Z}(z);for(const G in B)B[G].forEach(Z=>{const Y=Z.feature,se=Y.layer;se&&se.type!=="background"&&se.type!=="sky"&&se.type!=="slot"&&(Y.source=se.source,se["source-layer"]&&(Y.sourceLayer=se["source-layer"]),Y.state=Y.id!==void 0?f.getFeatureState(se["source-layer"],Y.id):{})});return B}function vd(f,i){const l=f.getRenderableIds().map(w=>f.getTileByID(w)),p=[],x={};for(let w=0;w<l.length;w++){const E=l[w],R=E.tileID.canonical.key;x[R]||(x[R]=!0,E.querySourceFeatures(p,i))}return p}function Cc(f,i){const l=f.tileID,p=i.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}const Vs=32,oo=33,ao=new Uint16Array(8184);for(let f=0;f<2046;f++){let i=f+2,l=0,p=0,x=0,w=0,E=0,R=0;for(1&i?x=w=E=Vs:l=p=R=Vs;(i>>=1)>1;){const z=l+x>>1,B=p+w>>1;1&i?(x=l,w=p,l=E,p=R):(l=x,p=w,x=E,w=R),E=z,R=B}const L=4*f;ao[L+0]=l,ao[L+1]=p,ao[L+2]=x,ao[L+3]=w}const as=new Uint16Array(2178),Lo=new Uint8Array(1089),bd=new Uint16Array(1089);function Pm(f){return f===0?-.03125:f===32?.03125:0}const Mm={type:2,extent:s.ab,loadGeometry:()=>[[new s.P(0,0),new s.P(s.ab+1,0),new s.P(s.ab+1,s.ab+1),new s.P(0,s.ab+1),new s.P(0,0)]]};class Oo{constructor(i,l,p,x,w){this.tileID=i,this.uid=s.aP(),this.uses=0,this.tileSize=l,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=w,x&&x.style&&(this._lastUpdatedBrightness=x.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",x&&x.transform&&(this.projection=x.transform.projection)}registerFadeDuration(i){const l=i+this.timeAdded;l<s.q.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aK(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,l,p){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(x,w){const E={};if(!w)return E;for(const R of x){const L=R.layerIds.map(z=>w.getLayer(z)).filter(Boolean);if(L.length!==0){R.layers=L,R.stateDependentLayerIds&&(R.stateDependentLayers=R.stateDependentLayerIds.map(z=>L.filter(B=>B.id===z)[0]));for(const z of L)E[z.fqid]=R}}return E}(i.buckets,l.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const w=this.buckets[x];if(w instanceof s.aR){if(this.hasSymbolBuckets=!0,!p)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const w=this.buckets[x];if(w instanceof s.aR&&w.hasRTLText){this.hasRTLText=!0,s.aS();break}}this.queryPadding=0;for(const x in this.buckets){const w=this.buckets[x],E=l.style.getOwnLayer(x);if(!E)continue;const R=E.queryRadius(w);this.queryPadding=Math.max(this.queryPadding,R)}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas),this._lastUpdatedBrightness=i.brightness}else this.collisionBoxArray=new s.aQ}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.fqid]}upload(i){for(const x in this.buckets){const w=this.buckets[x];w.uploadPending()&&w.upload(i)}const l=i.gl,p=this.imageAtlas;if(p&&!p.uploaded){const x=!!Object.keys(p.patternPositions).length;this.imageAtlasTexture=new s.T(i,p.image,l.RGBA8,{useMipmap:x}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(i,this.glyphAtlasImage,l.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(i,this.lineAtlas.image,l.R8),this.lineAtlas.uploaded=!0)}prepare(i,l,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture,p),!l||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const x=l.style.getBrightness();(this._lastUpdatedBrightness||x)&&(this._lastUpdatedBrightness&&x&&Math.abs(this._lastUpdatedBrightness-x)<.001||(this._lastUpdatedBrightness=x,this.updateBuckets(l)))}queryRenderedFeatures(i,l,p,x,w,E,R,L){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:x,pixelPosMatrix:R,transform:E,params:w,tileTransform:this.tileTransform},i,l,p):{}}querySourceFeatures(i,l){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const x=p.loadVTLayers(),w=l?l.sourceLayer:"",E=x._geojsonTileLayer||x[w];if(!E)return;const R=s.aT(l&&l.filter),{z:L,x:z,y:B}=this.tileID.canonical,G={z:L,x:z,y:B};for(let Z=0;Z<E.length;Z++){const Y=E.feature(Z);if(R.needGeometry){const ae=s.aU(Y,!0);if(!R.filter(new s.a3(this.tileID.overscaledZ),ae,this.tileID.canonical))continue}else if(!R.filter(new s.a3(this.tileID.overscaledZ),Y))continue;const se=p.getId(Y,w),oe=new s.aV(Y,L,z,B,se);oe.tile=G,i.push(oe)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const l=this.expirationTime;if(i.cacheControl){const p=s.aW(i.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const p=Date.now();let x=!1;if(this.expirationTime>p)x=!1;else if(l)if(this.expirationTime<l)x=!0;else{const w=this.expirationTime-l;w?this.expirationTime=p+Math.max(w,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,l){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(i).length!==0&&l&&this.updateBuckets(l)}updateBuckets(i){if(!this.latestFeatureIndex)return;const l=this.latestFeatureIndex.loadVTLayers(),p=i.style.listImages(),x=i.style.getBrightness();for(const w in this.buckets){if(!i.style.hasLayer(w))continue;const E=this.buckets[w],R=E.layers[0].sourceLayer||"_geojsonTileLayer",L=l[R],z=i.style.getOwnSourceCache(E.layers[0].source);let B={};z&&(B=z._state.getState(R,void 0)),E.update(B,L,p,this.imageAtlas&&this.imageAtlas.patternPositions||{},x),(E instanceof s.aX||E instanceof s.aY)&&i._terrain&&i._terrain.enabled&&z&&E.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(z.id,this.tileID);const G=i&&i.style&&i.style.getOwnLayer(w);G&&(this.queryPadding=Math.max(this.queryPadding,G.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=s.q.now()+i}setTexture(i,l){const p=l.context,x=p.gl;this.texture=this.texture||l.getTileTexture(i.width),this.texture&&this.texture instanceof s.T?this.texture.update(i):(this.texture=new s.T(p,i,x.RGBA8,{useMipmap:!0}),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE))}setDependencies(i,l){const p={};for(const x of l)p[x]=!0;this.dependencies[i]=p}hasDependency(i,l){for(const p of i){const x=this.dependencies[p];if(x){for(const w of l)if(x[w])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;const p=s.aZ(Mm,this.tileID.canonical,this.tileTransform)[0],x=new s.a_,w=new s.a$;for(let E=0;E<p.length;E++){const{x:R,y:L}=p[E];x.emplaceBack(R,L),w.emplaceBack(E)}w.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(w),this._tileDebugBuffer=i.createVertexBuffer(x,s.b0.members),this._tileDebugSegments=s.b1.simpleSegment(0,0,x.length,w.length)}_makeTileBoundsBuffers(i,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;const p=s.aZ(Mm,this.tileID.canonical,this.tileTransform)[0];let x,w;if(this.isRaster){const E=function(R,L){const z=s.aK(R,L),B=Math.pow(2,R.z);for(let ae=0;ae<oo;ae++)for(let le=0;le<oo;le++){const me=s.aL((R.x+(le+Pm(le))/Vs)/B),ye=s.aM((R.y+(ae+Pm(ae))/Vs)/B),fe=L.project(me,ye),be=ae*oo+le;as[2*be+0]=Math.round((fe.x*z.scale-z.x)*s.ab),as[2*be+1]=Math.round((fe.y*z.scale-z.y)*s.ab)}Lo.fill(0),bd.fill(0);for(let ae=2045;ae>=0;ae--){const le=4*ae,me=ao[le+0],ye=ao[le+1],fe=ao[le+2],be=ao[le+3],ve=me+fe>>1,Pe=ye+be>>1,Te=ve+Pe-ye,Me=Pe+me-ve,Oe=ye*oo+me,ke=be*oo+fe,De=Pe*oo+ve,Ue=Math.hypot((as[2*Oe+0]+as[2*ke+0])/2-as[2*De+0],(as[2*Oe+1]+as[2*ke+1])/2-as[2*De+1])>=16;Lo[De]=Lo[De]||(Ue?1:0),ae<1022&&(Lo[De]=Lo[De]||Lo[(ye+Me>>1)*oo+(me+Te>>1)]||Lo[(be+Me>>1)*oo+(fe+Te>>1)])}const G=new s.aN,Z=new s.aO;let Y=0;function se(ae,le){const me=le*oo+ae;return bd[me]===0&&(G.emplaceBack(as[2*me+0],as[2*me+1],ae*s.ab/Vs,le*s.ab/Vs),bd[me]=++Y),bd[me]-1}function oe(ae,le,me,ye,fe,be){const ve=ae+me>>1,Pe=le+ye>>1;if(Math.abs(ae-fe)+Math.abs(le-be)>1&&Lo[Pe*oo+ve])oe(fe,be,ae,le,ve,Pe),oe(me,ye,fe,be,ve,Pe);else{const Te=se(ae,le),Me=se(me,ye),Oe=se(fe,be);Z.emplaceBack(Te,Me,Oe)}}return oe(0,0,Vs,Vs,Vs,0),oe(Vs,Vs,0,0,0,Vs),{vertices:G,indices:Z}}(this.tileID.canonical,l);x=E.vertices,w=E.indices}else{x=new s.aN,w=new s.aO;for(const{x:R,y:L}of p)x.emplaceBack(R,L,0,0);const E=s.b2(x.int16,void 0,4);for(let R=0;R<E.length;R+=3)w.emplaceBack(E[R],E[R+1],E[R+2])}this._tileBoundsBuffer=i.createVertexBuffer(x,s.b3.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(w),this._tileBoundsSegments=s.b1.simpleSegment(0,0,x.length,w.length)}_makeGlobeTileDebugBuffers(i,l){const p=l.projection;if(!p||p.name!=="globe"||l.freezeTileCoverage)return;const x=this.tileID.canonical,w=s.b4(x,l),E=s.b5(w),R=s.a9(l.zoom);let L;R>0&&(L=s.a6.mat4.invert(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,x,l,E,L,R),this._makeGlobeTileDebugTextBuffer(i,x,l,E,L,R)}_globePoint(i,l,p,x,w,E,R){let L=s.b6(i,l,p);if(E){const z=1<<p.z,B=s.am(x.center.lng),G=s.at(x.center.lat),Z=(p.x+.5)/z-B;let Y=0;Z>.5?Y=-1:Z<-.5&&(Y=1);let se=(i/s.ab+p.x)/z+Y,oe=(l/s.ab+p.y)/z;se=(se-B)*x._pixelsPerMercatorPixel+B,oe=(oe-G)*x._pixelsPerMercatorPixel+G;const ae=[se*x.worldSize,oe*x.worldSize,0];s.a6.vec3.transformMat4(ae,ae,E),L=s.b7(L,ae,R)}return s.a6.vec3.transformMat4(L,L,w)}_makeGlobeTileDebugBorderBuffer(i,l,p,x,w,E){const R=new s.a_,L=new s.a$,z=new s.b8,B=(Z,Y,se,oe,ae)=>{const le=(se-Z)/(ae-1),me=(oe-Y)/(ae-1),ye=R.length;for(let fe=0;fe<ae;fe++){const be=Z+fe*le,ve=Y+fe*me;R.emplaceBack(be,ve);const Pe=this._globePoint(be,ve,l,p,x,w,E);z.emplaceBack(Pe[0],Pe[1],Pe[2]),L.emplaceBack(ye+fe)}},G=s.ab;B(0,0,G,0,16),B(G,0,G,G,16),B(G,G,0,G,16),B(0,G,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(L),this._tileDebugBuffer=i.createVertexBuffer(R,s.b0.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(z,s.b9.members),this._tileDebugSegments=s.b1.simpleSegment(0,0,R.length,L.length)}_makeGlobeTileDebugTextBuffer(i,l,p,x,w,E){const R=s.ab/4,L=new s.a_,z=new s.aO,B=new s.b8,G=25;z.reserve(32),L.reserve(G),B.reserve(G);const Z=(Y,se)=>G*Y+se;for(let Y=0;Y<G;Y++){const se=Y*R;for(let oe=0;oe<G;oe++){const ae=oe*R;L.emplaceBack(ae,se);const le=this._globePoint(ae,se,l,p,x,w,E);B.emplaceBack(le[0],le[1],le[2])}}for(let Y=0;Y<4;Y++)for(let se=0;se<4;se++){const oe=Z(Y,se),ae=Z(Y,se+1),le=Z(Y+1,se),me=Z(Y+1,se+1);z.emplaceBack(oe,ae,le),z.emplaceBack(le,ae,me)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(z),this._tileDebugTextBuffer=i.createVertexBuffer(L,s.b0.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(B,s.b9.members),this._tileDebugTextSegments=s.b1.simpleSegment(0,0,G,32)}destroy(i=!1){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!i&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.ba.setPbf(s.bb);class Jh extends Oo{constructor(i,l,p,x,w){super(i,l,p,x,w),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(i,l){const p=l.context,x=p.gl;this.texture=this.texture||l.getTileTexture(i.width),this.texture&&this.texture instanceof s.T?this.texture.update(i,{premultiply:!1}):this.texture=new s.T(p,i,x.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(i=16384,l){const p=this._mrt=new s.ba(30),x=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(i-1)}});return this.entireBuffer=null,this.request=s.bc(x,(w,E,R,L)=>{if(w)l(w);else try{const z=p.getHeaderLength(E);if(z>i)return void(this.request=this.fetchHeader(z,l));p.parseHeader(E),this._isHeaderLoaded=!0;let B=0;for(const G of Object.values(p.layers))B=Math.max(B,G.dataIndex[G.dataIndex.length-1].last_byte);E.byteLength>=B&&(this.entireBuffer=E),l(null,this.entireBuffer||E,R,L)}catch(z){l(z)}}),this.request}fetchBand(i,l,p){const x=this._mrt;if(!this._isHeaderLoaded||!x)return void p(new Error("Tile header is not ready"));const w=this.actor;if(!w)return void p(new Error("Can't fetch tile band without an actor"));let E;const R=(G,Z)=>{E.complete(G,Z),G?p(G):(this.updateTextureDescriptor(i,l),p(null,this.textureDescriptor&&this.textureDescriptor.img))},L=(G,Z)=>{if(G)return p(G);const Y=w.send("decodeRasterArray",{buffer:Z,task:E},R,void 0,!0);this._workQueue.push(()=>{Y&&Y.cancel(),E.cancel()})},z=x.getLayer(i);if(!z)return void p(new Error(`Unknown sourceLayer "${i}"`));if(z.hasDataForBand(l))return this.updateTextureDescriptor(i,l),void p(null,this.textureDescriptor?this.textureDescriptor.img:null);const B=z.getDataRange([l]);if(E=x.createDecodingTask(B),!E||E.tasks.length)if(this.flushQueues(),this.entireBuffer)L(null,this.entireBuffer.slice(B.firstByte,B.lastByte+1));else{const G=Object.assign({},this.requestParams,{headers:{Range:`bytes=${B.firstByte}-${B.lastByte}`}}),Z=s.bc(G,L);this._fetchQueue.push(()=>{Z.cancel(),E.cancel()})}else p(null)}updateNeeded(i,l){return(!this.textureDescriptor||this.textureDescriptor.band!==l||this.textureDescriptor.layer!==i)&&this.state!=="errored"}updateTextureDescriptor(i,l){if(!this._mrt)return;const p=this._mrt.getLayer(i);if(!p||!p.hasBand(l)||!p.hasDataForBand(l))return;const{bytes:x,tileSize:w,buffer:E,offset:R,scale:L}=p.getBandView(l),z=w+2*E,B={data:x,width:z,height:z},G=this.texture;G&&G instanceof s.T&&G.update(B,{premultiply:!1}),this.textureDescriptor={layer:i,band:l,img:B,buffer:E,offset:R,tileSize:w,format:p.pixelFormat,mix:[L,256*L,65536*L,16777216*L]}}}class sx{constructor(i,l){this.max=i,this.onRemove=l,this.reset()}reset(){for(const i in this.data)for(const l of this.data[i])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(i,l,p){const x=i.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const w={value:l,timeout:void 0};if(p!==void 0&&(w.timeout=setTimeout(()=>{this.remove(i,w)},p)),this.data[x].push(w),this.order.push(x),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const l=this.data[i].shift();return l.timeout&&clearTimeout(l.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),l.value}getByKey(i){const l=this.data[i];return l?l[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,l){if(!this.has(i))return this;const p=i.wrapped().key,x=l===void 0?0:this.data[p].indexOf(l),w=this.data[p][x];return this.data[p].splice(x,1),w.timeout&&clearTimeout(w.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(w.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(i){const l=[];for(const p in this.data)for(const x of this.data[p])i(x.value)||l.push(x);for(const p of l)this.remove(p.value.tileID,p)}}class tw{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,l,p){const x=String(l);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][x]=this.stateChanges[i][x]||{},s.l(this.stateChanges[i][x],p),this.deletedStates[i]===null){this.deletedStates[i]={};for(const w in this.state[i])w!==x&&(this.deletedStates[i][w]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][x]===null){this.deletedStates[i][x]={};for(const w in this.state[i][x])p[w]||(this.deletedStates[i][x][w]=null)}else for(const w in p)this.deletedStates[i]&&this.deletedStates[i][x]&&this.deletedStates[i][x][w]===null&&delete this.deletedStates[i][x][w]}removeFeatureState(i,l,p){if(this.deletedStates[i]===null)return;const x=String(l);if(this.deletedStates[i]=this.deletedStates[i]||{},p&&l!==void 0)this.deletedStates[i][x]!==null&&(this.deletedStates[i][x]=this.deletedStates[i][x]||{},this.deletedStates[i][x][p]=null);else if(l!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][x])for(p in this.deletedStates[i][x]={},this.stateChanges[i][x])this.deletedStates[i][x][p]=null;else this.deletedStates[i][x]=null;else this.deletedStates[i]=null}getState(i,l){const p=this.state[i]||{},x=this.stateChanges[i]||{},w=this.deletedStates[i];if(w===null)return{};if(l!==void 0){const R=String(l),L=s.l({},p[R],x[R]);if(w){const z=w[l];if(z===null)return{};for(const B in z)delete L[B]}return L}const E=s.l({},p,x);if(w)for(const R in w)delete E[R];return E}initializeTileState(i,l){i.setFeatureState(this.state,l)}coalesceChanges(i,l){const p={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const w={};for(const E in this.stateChanges[x])this.state[x][E]||(this.state[x][E]={}),s.l(this.state[x][E],this.stateChanges[x][E]),w[E]=this.state[x][E];p[x]=w}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const w={};if(this.deletedStates[x]===null)for(const E in this.state[x])w[E]={},this.state[x][E]={};else for(const E in this.deletedStates[x]){if(this.deletedStates[x][E]===null)this.state[x][E]={};else if(this.state[x][E])for(const R of Object.keys(this.deletedStates[x][E]))delete this.state[x][E][R];w[E]=this.state[x][E]}p[x]=p[x]||{},s.l(p[x],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const x in i)i[x].setFeatureState(p,l)}}class ls extends s.E{constructor(i,l,p){super(),this.id=i,this._onlySymbols=p,l.on("data",x=>{x.dataType==="source"&&x.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&x.dataType==="source"&&x.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new sx(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new tw,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(i){this.map=i,this._minTileCacheSize=this._minTileCacheSize===void 0&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const l=this._tiles[i];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,l){return i.isSymbolTile=this._onlySymbols,i.isExtraShadowCaster=this._shadowCasterTiles[i.tileID.key],this._source.loadTile(i,l)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i)}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i)}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const p=this._tiles[l];p.upload(i),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return s.bd(this._tiles).map(i=>i.tileID).sort(Ha).map(i=>i.key)}getRenderableIds(i,l){const p=[];for(const x in this._tiles)this._isIdRenderable(+x,i,l)&&p.push(this._tiles[x]);return i?p.sort((x,w)=>{const E=x.tileID,R=w.tileID,L=new s.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),z=new s.P(R.canonical.x,R.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-R.overscaledZ||z.y-L.y||z.x-L.x}).map(x=>x.tileID.key):p.map(x=>x.tileID).sort(Ha).map(x=>x.key)}hasRenderableParent(i){const l=this.findLoadedParent(i,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(i,l,p){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(l||!this._tiles[i].holdingForFade())&&(p||!this._shadowCasterTiles[i])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(+i,"reloading")}}_reloadTile(i,l){const p=this._tiles[i];p&&(p.state!=="loading"&&(p.state=l),this._loadTile(p,this._tileLoaded.bind(this,p,i,l)))}_tileLoaded(i,l,p,x){if(x)if(i.state="errored",x.status!==404)this._source.fire(new s.t(x,{tile:i}));else{if(this._source.fire(new s.x("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:i})),!(i.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const w=this.map.painter.terrain;this.update(this.transform,w.getScaledDemTileSize(),!0),w.resetTileLookupCache(this.id)}else this.update(this.transform)}else i.timeAdded=s.q.now(),p==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(l,i),this._source.type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new s.x("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const l=this.getRenderableIds();for(let x=0;x<l.length;x++){const w=l[x];if(i.neighboringTiles&&i.neighboringTiles[w]){const E=this.getTileByID(w);p(i,E),p(E,i)}}function p(x,w){if(!x.dem||x.dem.borderReady)return;x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0;let E=w.tileID.canonical.x-x.tileID.canonical.x;const R=w.tileID.canonical.y-x.tileID.canonical.y,L=Math.pow(2,x.tileID.canonical.z),z=w.tileID.key;E===0&&R===0||Math.abs(R)>1||(Math.abs(E)>1&&(Math.abs(E+L)===1?E+=L:Math.abs(E-L)===1&&(E-=L)),w.dem&&x.dem&&(x.dem.backfillBorder(w.dem,E,R),x.neighboringTiles&&x.neighboringTiles[z]&&(x.neighboringTiles[z].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,l,p,x){for(const w in this._tiles){let E=this._tiles[w];if(x[w]||!E.hasData()||E.tileID.overscaledZ<=l||E.tileID.overscaledZ>p)continue;let R=E.tileID;for(;E&&E.tileID.overscaledZ>l+1;){const z=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[z.key],E&&E.hasData()&&(R=z)}let L=R;for(;L.overscaledZ>l;)if(L=L.scaledTo(L.overscaledZ-1),i[L.key]){x[R.key]=R;break}}}findLoadedParent(i,l){if(i.key in this._loadedParentTiles){const p=this._loadedParentTiles[i.key];return p&&p.tileID.overscaledZ>=l?p:null}for(let p=i.overscaledZ-1;p>=l;p--){const x=i.scaledTo(p),w=this._getLoadedTile(x);if(w)return w}}_getLoadedTile(i){const l=this._tiles[i.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,l){l=l||this._source.tileSize;const p=Math.ceil(i.width/l)+1,x=Math.ceil(i.height/l)+1,w=Math.floor(p*x*5),E=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,w):w,R=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,E):E;this._cache.setMaxSize(R)}handleWrapJump(i){const l=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,l){const p={};for(const x in this._tiles){const w=this._tiles[x];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+l),p[w.tileID.key]=w}this._tiles=p;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(+x,this._tiles[x])}}update(i,l,p,x){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(i,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const w=this._source.type==="batched-model";let E;if(this.used||this.usedForTerrain){if(this._source.tileID)E=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new s.aA(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y));else if(this.tileCoverLift!==0){const z=i.clone();z.tileCoverLift=this.tileCoverLift,E=z.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.minzoom<=1&&i.projection.name==="globe"&&(E.push(new s.aA(1,0,1,0,0)),E.push(new s.aA(1,0,1,1,0)),E.push(new s.aA(1,0,1,0,1)),E.push(new s.aA(1,0,1,1,1)))}else if(E=i.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.hasTile){const z=this._source.hasTile.bind(this._source);E=E.filter(B=>z(B))}}else E=[];if(E.length>0&&this.castsShadows&&x&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!wd(this._source.type)){const z=i.coveringZoomLevel({tileSize:l||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),B=Math.min(z,this._source.maxzoom);if(w){const G=i.extendTileCover(E,B);for(const Z of G)E.push(Z)}else{const G=i.extendTileCover(E,B,x);for(const Z of G)this._shadowCasterTiles[Z.key]=!0,E.push(Z)}}const R=this._updateRetainedTiles(E);if(wd(this._source.type)&&E.length!==0){const z={},B={},G=Object.keys(R);for(const Y of G){const se=R[Y],oe=this._tiles[Y];if(!oe||oe.fadeEndTime&&oe.fadeEndTime<=s.q.now())continue;const ae=this.findLoadedParent(se,Math.max(se.overscaledZ-ls.maxOverzooming,this._source.minzoom));ae&&(this._addTile(ae.tileID),z[ae.tileID.key]=ae.tileID),B[Y]=se}const Z=E[E.length-1].overscaledZ;for(const Y in this._tiles){const se=this._tiles[Y];if(R[Y]||!se.hasData())continue;let oe=se.tileID;for(;oe.overscaledZ>Z;){oe=oe.scaledTo(oe.overscaledZ-1);const ae=this._tiles[oe.key];if(ae&&ae.hasData()&&B[oe.key]){R[Y]=se.tileID;break}}}for(const Y in z)R[Y]||(this._coveredTiles[Y]=!0,R[Y]=z[Y])}for(const z in R)this._tiles[z].clearFadeHold();const L=s.be(this._tiles,R);for(const z of L){const B=this._tiles[z];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(+z)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const l={};if(i.length===0)return l;const p={},x=i.reduce((z,B)=>Math.min(z,B.overscaledZ),1/0),w=i[0].overscaledZ,E=Math.max(w-ls.maxOverzooming,this._source.minzoom),R=Math.max(w+ls.maxUnderzooming,this._source.minzoom),L={};for(const z of i){const B=this._addTile(z);l[z.key]=z,B.hasData()||x<this._source.maxzoom&&(L[z.key]=z)}this._retainLoadedChildren(L,x,R,l);for(const z of i){let B=this._tiles[z.key];if(B.hasData())continue;if(z.canonical.z>=this._source.maxzoom){const Z=z.children(this._source.maxzoom)[0],Y=this.getTile(Z);if(Y&&Y.hasData()){l[Z.key]=Z;continue}}else{const Z=z.children(this._source.maxzoom);if(l[Z[0].key]&&l[Z[1].key]&&l[Z[2].key]&&l[Z[3].key])continue}let G=B.wasRequested();for(let Z=z.overscaledZ-1;Z>=E;--Z){const Y=z.scaledTo(Z);if(p[Y.key]||(p[Y.key]=!0,B=this.getTile(Y),!B&&G&&(B=this._addTile(Y)),B&&(l[Y.key]=Y,G=B.wasRequested(),B.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const l=[];let p,x=this._tiles[i].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){p=this._loadedParentTiles[x.key];break}l.push(x.key);const w=x.scaledTo(x.overscaledZ-1);if(p=this._getLoadedTile(w),p)break;x=w}for(const w of l)this._loadedParentTiles[w]=p}}_addTile(i){let l=this._tiles[i.key];if(l)return l.isExtraShadowCaster!==!0||this._shadowCasterTiles[i.key]||this._reloadTile(i.key,"reloading"),l;l=this._cache.getAndRemove(i),l&&(this._setTileReloadTimer(i.key,l),l.tileID=i,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,l)));const p=!!l;if(!p){const x=this.map?this.map.painter:null,w=this._source.tileSize*i.overscaleFactor();l=this._source.type==="raster-array"?new Jh(i,w,this.transform.tileZoom,x,this._isRaster):new Oo(i,w,this.transform.tileZoom,x,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,i.key,l.state))}return l?(l.uses++,this._tiles[i.key]=l,p||this._source.fire(new s.x("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(i,l){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const p=l.getExpiryTimeout();p&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},p))}_removeTile(i){const l=this._tiles[i];l&&(l.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),l.uses>0||(l.hasData()&&l.state!=="reloading"||l.state==="empty"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,l,p){const x=[],w=this.transform;if(!w)return x;const E=w.projection.name==="globe",R=s.am(w.center.lng);for(const L in this._tiles){const z=this._tiles[L];if(p&&z.clearQueryDebugViz(),z.holdingForFade())continue;let B;if(E){const G=z.tileID.canonical;if(G.z===0){const Z=[Math.abs(s.ap(R,...Pc(G,-1))-R),Math.abs(s.ap(R,...Pc(G,1))-R)];B=[0,2*Z.indexOf(Math.min(...Z))-1]}else{const Z=[Math.abs(s.ap(R,...Pc(G,-1))-R),Math.abs(s.ap(R,...Pc(G,0))-R),Math.abs(s.ap(R,...Pc(G,1))-R)];B=[Z.indexOf(Math.min(...Z))-1]}}else B=[0];for(const G of B){const Z=i.containsTile(z,w,l,G);Z&&x.push(Z)}}return x}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(i){return this._getRenderableCoordinates(i)}_getRenderableCoordinates(i,l){const p=this.getRenderableIds(i,l).map(w=>this._tiles[w].tileID),x=this.transform.projection.name==="globe";for(const w of p)w.projMatrix=this.transform.calculateProjMatrix(w.toUnwrapped()),w.expandedProjMatrix=x?this.transform.calculateProjMatrix(w.toUnwrapped(),!1,!0):w.projMatrix;return p}sortCoordinatesByDistance(i){const l=i.slice(),p=this.transform._camera.position,x=this.transform._camera.forward(),w={};for(const E of l){const R=1/(1<<E.canonical.z);w[E.key]=((E.canonical.x+.5)*R+E.wrap-p[0])*x[0]+((E.canonical.y+.5)*R-p[1])*x[1]-p[2]*x[2]}return l.sort((E,R)=>w[E.key]-w[R.key]),l}hasTransition(){if(this._source.hasTransition())return!0;if(wd(this._source.type))for(const i in this._tiles){const l=this._tiles[i];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=s.q.now())return!0}return!1}setFeatureState(i,l,p){this._state.updateState(i=i||"_geojsonTileLayer",l,p)}removeFeatureState(i,l,p){this._state.removeFeatureState(i=i||"_geojsonTileLayer",l,p)}getFeatureState(i,l){return this._state.getState(i=i||"_geojsonTileLayer",l)}setDependencies(i,l,p){const x=this._tiles[i];x&&x.setDependencies(l,p)}reloadTilesForDependencies(i,l){for(const p in this._tiles)this._tiles[p].hasDependency(i,l)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(i,l))}_preloadTiles(i,l){if(!this._sourceLoaded){const L=()=>{this._sourceLoaded&&(this._source.off("data",L),this._preloadTiles(i,l))};return void this._source.on("data",L)}const p=new Map,x=Array.isArray(i)?i:[i],w=this.map.painter.terrain,E=this.usedForTerrain&&w?w.getScaledDemTileSize():this._source.tileSize;for(const L of x){const z=L.coveringTiles({tileSize:E,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const B of z)p.set(B.key,B);this.usedForTerrain&&L.updateElevation(!1)}const R=Array.from(p.values());s.bf(R,(L,z)=>{const B=new Oo(L,this._source.tileSize*L.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(B,G=>{this._source.type==="raster-dem"&&B.dem&&this._backfillDEM(B),z(G,B)})},l)}}function Ha(f,i){const l=Math.abs(2*f.wrap)-+(f.wrap<0),p=Math.abs(2*i.wrap)-+(i.wrap<0);return f.overscaledZ-i.overscaledZ||p-l||i.canonical.y-f.canonical.y||i.canonical.x-f.canonical.x}function wd(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function Pc(f,i){const l=1<<f.z;return[f.x/l+i,(f.x+1)/l+i]}ls.maxOverzooming=10,ls.maxUnderzooming=3;class Am{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const i=!1,l=!1;for(const p in this.style._mergedLayers){const x=this.style._mergedLayers[p];if(x.type==="fill-extrusion")this.layers.push({layer:x,visible:i,visibilityChanged:l});else if(x.type==="model"){const w=this.style.getLayerSource(x);w&&w.type==="batched-model"&&this.layers.push({layer:x,visible:i,visibilityChanged:l})}}}onNewFrame(i){this.layersGotHidden=!1;for(const l of this.layers){const p=l.layer;let x=!1;p.type==="fill-extrusion"?x=!p.isHidden(i)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="model"&&(x=!p.isHidden(i)&&p.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!x&&l.visible,l.visible=x}}updateZOffset(i,l){this.currentBuildingBuckets=[];for(const x of this.layers){const w=x.layer,E=this.style.getLayerSourceCache(w);let R=1;w.type==="fill-extrusion"&&(R=x.visible?w.paint.get("fill-extrusion-vertical-scale"):0);let L=E?E.getTile(l):null;if(!L&&E&&l.canonical.z>E.getSource().minzoom){let z=l.scaledTo(Math.min(E.getSource().maxzoom,l.overscaledZ-1));for(;z.overscaledZ>=E.getSource().minzoom&&(L=E.getTile(z),!L&&z.overscaledZ!==0);)z=z.scaledTo(z.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:L?L.getBucket(w):null,tileID:L?L.tileID:l,verticalScale:R})}i.hasAnyZOffset=!1;let p=!1;for(let x=0;x<i.symbolInstances.length;x++){const w=i.symbolInstances.get(x),E=w.zOffset,R=this._getHeightAtTileOffset(l,w.tileAnchorX,w.tileAnchorY);w.zOffset=R!==Number.NEGATIVE_INFINITY?R:E,p||E===w.zOffset||(p=!0),i.hasAnyZOffset||w.zOffset===0||(i.hasAnyZOffset=!0)}p&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,l,p,x){let w=l,E=p;if(i.canonical.z!==x.canonical.z){const R=x.canonical,L=1/(1<<i.canonical.z-R.z);w=(l+i.canonical.x*s.ab)*L-R.x*s.ab|0,E=(p+i.canonical.y*s.ab)*L-R.y*s.ab|0}return{tileX:w,tileY:E}}_getHeightAtTileOffset(i,l,p){let x,w;for(let E=0;E<this.layers.length;++E){if(this.layers[E].layer.type!=="fill-extrusion")continue;const{bucket:R,tileID:L,verticalScale:z}=this.currentBuildingBuckets[E];if(!R)continue;const{tileX:B,tileY:G}=this._mapCoordToOverlappingTile(i,l,p,L),Z=R.getHeightAtTileCoord(B,G);Z&&Z.height!==void 0&&(Z.hidden?x=Z.height:w=Math.max(Z.height*z,w||0))}if(w!==void 0)return w;for(let E=0;E<this.layers.length;++E){const R=this.layers[E];if(R.layer.type!=="model"||!R.visible)continue;const{bucket:L,tileID:z}=this.currentBuildingBuckets[E];if(!L)continue;const{tileX:B,tileY:G}=this._mapCoordToOverlappingTile(i,l,p,z),Z=L.getHeightAtTileCoord(B,G);if(Z&&!Z.hidden)return Z.height===void 0&&x!==void 0?Math.min(Z.maxHeight,x)*Z.verticalScale:Z.height?Z.height*Z.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Mc(f,i){const l={};for(const p in f)p!=="ref"&&(l[p]=f[p]);return s.bg.forEach(p=>{p in i&&(l[p]=i[p])}),l}function Im(f){f=f.slice();const i=Object.create(null);for(let l=0;l<f.length;l++)i[f[l].id]=f[l];for(let l=0;l<f.length;l++)"ref"in f[l]&&(f[l]=Mc(f[l],i[f[l].ref]));return f}const Fn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Dm(f,i,l){l.push({command:Fn.addSource,args:[f,i[f]]})}function Yn(f,i,l){i.push({command:Fn.removeSource,args:[f]}),l[f]=!0}function nw(f,i,l,p){Yn(f,l,p),Dm(f,i,l)}function Xt(f,i,l){let p;for(p in f[l])if(f[l].hasOwnProperty(p)&&p!=="data"&&!s.bh(f[l][p],i[l][p]))return!1;for(p in i[l])if(i[l].hasOwnProperty(p)&&p!=="data"&&!s.bh(f[l][p],i[l][p]))return!1;return!0}function Sd(f,i,l,p,x,w){let E;for(E in i=i||{},f=f||{})f.hasOwnProperty(E)&&(s.bh(f[E],i[E])||l.push({command:w,args:[p,E,i[E],x]}));for(E in i)i.hasOwnProperty(E)&&!f.hasOwnProperty(E)&&(s.bh(f[E],i[E])||l.push({command:w,args:[p,E,i[E],x]}))}function Ml(f){return f.id}function Ac(f,i){return f[i.id]=i,f}class jo{constructor(i,l){this.reset(i,l)}reset(i,l){this.points=i||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=s.ap(i,0,1);let l=1,p=this._distances[l];const x=i*this.paddedLength+this.padding;for(;p<x&&l<this._distances.length;)p=this._distances[++l];const w=l-1,E=this._distances[w],R=p-E,L=R>0?(x-E)/R:0;return this.points[w].mult(1-L).add(this.points[l].mult(L))}}class Qh{constructor(i,l,p){const x=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(i/p),this.yCellCount=Math.ceil(l/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)x.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=l,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,l,p,x,w){this._forEachCell(l,p,x,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(w)}insertCircle(i,l,p,x){this._forEachCell(l-x,p-x,l+x,p+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(l),this.circles.push(p),this.circles.push(x)}_insertBoxCell(i,l,p,x,w,E){this.boxCells[w].push(E)}_insertCircleCell(i,l,p,x,w,E){this.circleCells[w].push(E)}_query(i,l,p,x,w,E){if(p<0||i>this.width||x<0||l>this.height)return!w&&[];const R=[];if(i<=0&&l<=0&&this.width<=p&&this.height<=x){if(w)return!0;for(let L=0;L<this.boxKeys.length;L++)R.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(let L=0;L<this.circleKeys.length;L++){const z=this.circles[3*L],B=this.circles[3*L+1],G=this.circles[3*L+2];R.push({key:this.circleKeys[L],x1:z-G,y1:B-G,x2:z+G,y2:B+G})}return E?R.filter(E):R}return this._forEachCell(i,l,p,x,this._queryCell,R,{hitTest:w,seenUids:{box:{},circle:{}}},E),w?R.length>0:R}_queryCircle(i,l,p,x,w){const E=i-p,R=i+p,L=l-p,z=l+p;if(R<0||E>this.width||z<0||L>this.height)return!x&&[];const B=[];return this._forEachCell(E,L,R,z,this._queryCellCircle,B,{hitTest:x,circle:{x:i,y:l,radius:p},seenUids:{box:{},circle:{}}},w),x?B.length>0:B}query(i,l,p,x,w){return this._query(i,l,p,x,!1,w)}hitTest(i,l,p,x,w){return this._query(i,l,p,x,!0,w)}hitTestCircle(i,l,p,x){return this._queryCircle(i,l,p,!0,x)}_queryCell(i,l,p,x,w,E,R,L){const z=R.seenUids,B=this.boxCells[w];if(B!==null){const Z=this.bboxes;for(const Y of B)if(!z.box[Y]){z.box[Y]=!0;const se=4*Y;if(i<=Z[se+2]&&l<=Z[se+3]&&p>=Z[se+0]&&x>=Z[se+1]&&(!L||L(this.boxKeys[Y]))){if(R.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[Y],x1:Z[se],y1:Z[se+1],x2:Z[se+2],y2:Z[se+3]})}}}const G=this.circleCells[w];if(G!==null){const Z=this.circles;for(const Y of G)if(!z.circle[Y]){z.circle[Y]=!0;const se=3*Y;if(this._circleAndRectCollide(Z[se],Z[se+1],Z[se+2],i,l,p,x)&&(!L||L(this.circleKeys[Y]))){if(R.hitTest)return E.push(!0),!0;{const oe=Z[se],ae=Z[se+1],le=Z[se+2];E.push({key:this.circleKeys[Y],x1:oe-le,y1:ae-le,x2:oe+le,y2:ae+le})}}}}}_queryCellCircle(i,l,p,x,w,E,R,L){const z=R.circle,B=R.seenUids,G=this.boxCells[w];if(G!==null){const Y=this.bboxes;for(const se of G)if(!B.box[se]){B.box[se]=!0;const oe=4*se;if(this._circleAndRectCollide(z.x,z.y,z.radius,Y[oe+0],Y[oe+1],Y[oe+2],Y[oe+3])&&(!L||L(this.boxKeys[se])))return E.push(!0),!0}}const Z=this.circleCells[w];if(Z!==null){const Y=this.circles;for(const se of Z)if(!B.circle[se]){B.circle[se]=!0;const oe=3*se;if(this._circlesCollide(Y[oe],Y[oe+1],Y[oe+2],z.x,z.y,z.radius)&&(!L||L(this.circleKeys[se])))return E.push(!0),!0}}}_forEachCell(i,l,p,x,w,E,R,L){const z=this._convertToXCellCoord(i),B=this._convertToYCellCoord(l),G=this._convertToXCellCoord(p),Z=this._convertToYCellCoord(x);for(let Y=z;Y<=G;Y++)for(let se=B;se<=Z;se++)if(w.call(this,i,l,p,x,this.xCellCount*se+Y,E,R,L))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,l,p,x,w,E){const R=x-i,L=w-l,z=p+E;return z*z>R*R+L*L}_circleAndRectCollide(i,l,p,x,w,E,R){const L=(E-x)/2,z=Math.abs(i-(x+L));if(z>L+p)return!1;const B=(R-w)/2,G=Math.abs(l-(w+B));if(G>B+p)return!1;if(z<=L||G<=B)return!0;const Z=z-L,Y=G-B;return Z*Z+Y*Y<=p*p}}const lo={unknown:0,flipRequired:1,flipNotRequired:2},zt=Math.tan(85*Math.PI/180);function Dn(f,i,l,p,x,w,E){const R=s.a6.mat4.create();if(l)if(w.name==="globe"){const L=s.bi(x,i);s.a6.mat4.multiply(R,R,L)}else{const L=s.a6.mat2.invert([],E);R[0]=L[0],R[1]=L[1],R[4]=L[2],R[5]=L[3],p||s.a6.mat4.rotateZ(R,R,x.angle)}else s.a6.mat4.multiply(R,x.labelPlaneMatrix,f);return R}function Rn(f,i,l,p,x,w,E){const R=Dn(f,i,l,p,x,w,E);return w.name==="globe"&&l||(R[2]=R[6]=R[10]=R[14]=0),R}function cs(f,i,l,p,x,w,E){if(l){if(w.name==="globe"){const R=Dn(f,i,l,p,x,w,E);return s.a6.mat4.invert(R,R),s.a6.mat4.multiply(R,f,R),R}{const R=s.a6.mat4.clone(f),L=s.a6.mat4.identity([]);return L[0]=E[0],L[1]=E[1],L[4]=E[2],L[5]=E[3],s.a6.mat4.multiply(R,R,L),p||s.a6.mat4.rotateZ(R,R,-x.angle),R}}return x.glCoordMatrix}function Vi(f,i,l,p){const x=[f,i,l,1];l?s.a6.vec4.transformMat4(x,x,p):tf(x,x,p);const w=x[3];return x[0]/=w,x[1]/=w,x[2]/=w,x}function On(f,i){return Math.min(.5+f/i*.5,1.5)}function ef(f,i){const l=f[0]/f[3],p=f[1]/f[3];return l>=-i[0]&&l<=i[0]&&p>=-i[1]&&p<=i[1]}function Ic(f,i,l,p,x,w,E,R,L,z){const B=l.transform,G=p?f.textSizeData:f.iconSizeData,Z=s.bj(G,l.transform.zoom),Y=B.projection.name==="globe",se=[256/l.width*2+1,256/l.height*2+1],oe=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;oe.clear();let ae=null;Y&&(ae=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const le=f.lineVertexArray,me=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,ye=l.transform.width/l.transform.height;let fe,be=!1;for(let ve=0;ve<me.length;ve++){const Pe=me.get(ve),{numGlyphs:Te,writingMode:Me}=Pe;if(Me!==s.bk.vertical||be||fe===s.bk.horizontal||(be=!0),fe=Me,(Pe.hidden||Me===s.bk.vertical)&&!be){zo(Te,oe);continue}be=!1;const Oe=new s.P(Pe.tileAnchorX,Pe.tileAnchorY);let{x:ke,y:De,z:Ue}=B.projection.projectTilePoint(Oe.x,Oe.y,z.canonical);if(L){const[at,dt,Wt]=L(Oe);ke+=at,De+=dt,Ue+=Wt}const et=[ke,De,Ue,1];if(s.a6.vec4.transformMat4(et,et,i),!ef(et,se)){zo(Te,oe);continue}const lt=et[3],Qe=On(l.transform.getCameraToCenterDistance(B.projection),lt),gt=s.bl(G,Z,Pe),$e=E?gt/Qe:gt*Qe,ot=Vi(ke,De,Ue,x);if(ot[3]<=0){zo(Te,oe);continue}let it={};const _t=E?null:L,vt=Or(Pe,$e,!1,R,i,x,w,f.glyphOffsetArray,le,oe,ae,ot,Oe,it,ye,_t,B.projection,z,E);be=vt.useVertical,_t&&vt.needsFlipping&&(it={}),(vt.notEnoughRoom||be||vt.needsFlipping&&Or(Pe,$e,!0,R,i,x,w,f.glyphOffsetArray,le,oe,ae,ot,Oe,it,ye,_t,B.projection,z,E).notEnoughRoom)&&zo(Te,oe)}p?(f.text.dynamicLayoutVertexBuffer.updateData(oe),ae&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(ae)):(f.icon.dynamicLayoutVertexBuffer.updateData(oe),ae&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(ae))}function Dc(f,i,l,p,x,w,E,R,L,z,B,G,Z,Y,se,oe){const{lineStartIndex:ae,glyphStartIndex:le,segment:me}=R,ye=le+R.numGlyphs,fe=ae+R.lineLength,be=i.getoffsetX(le),ve=i.getoffsetX(ye-1),Pe=kc(f*be,l,p,x,w,E,me,ae,fe,L,z,B,G,Z,!0,Y,se,oe);if(!Pe)return null;const Te=kc(f*ve,l,p,x,w,E,me,ae,fe,L,z,B,G,Z,!0,Y,se,oe);return Te?{first:Pe,last:Te}:null}function Xi(f,i,l,p){return f===s.bk.horizontal&&Math.abs(p)>Math.abs(l)?{useVertical:!0}:f===s.bk.vertical?p>0?{needsFlipping:!0}:null:i!==lo.unknown&&function(x,w){return x===0||Math.abs(w/x)>zt}(l,p)?i===lo.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function Or(f,i,l,p,x,w,E,R,L,z,B,G,Z,Y,se,oe,ae,le,me){const ye=i/24,fe=f.lineOffsetX*ye,be=f.lineOffsetY*ye,{lineStartIndex:ve,glyphStartIndex:Pe,numGlyphs:Te,segment:Me,writingMode:Oe,flipState:ke}=f,De=ve+f.lineLength,Ue=et=>{if(B){const[$e,ot,it]=et.up,_t=z.length;s.bm(B,_t+0,$e,ot,it),s.bm(B,_t+1,$e,ot,it),s.bm(B,_t+2,$e,ot,it),s.bm(B,_t+3,$e,ot,it)}const[lt,Qe,gt]=et.point;s.bn(z,lt,Qe,gt,et.angle)};if(Te>1){const et=Dc(ye,R,fe,be,l,G,Z,f,L,w,Y,oe,!1,ae,le,me);if(!et)return{notEnoughRoom:!0};if(p&&!l){let[lt,Qe,gt]=et.first.point,[$e,ot,it]=et.last.point;[lt,Qe]=Vi(lt,Qe,gt,E),[$e,ot]=Vi($e,ot,it,E);const _t=Xi(Oe,ke,($e-lt)*se,ot-Qe);if(f.flipState=_t&&_t.needsFlipping?lo.flipRequired:lo.flipNotRequired,_t)return _t}Ue(et.first);for(let lt=Pe+1;lt<Pe+Te-1;lt++){const Qe=kc(ye*R.getoffsetX(lt),fe,be,l,G,Z,Me,ve,De,L,w,Y,oe,!1,!1,ae,le,me);if(!Qe)return z.length-=4*(lt-Pe),{notEnoughRoom:!0};Ue(Qe)}Ue(et.last)}else{if(p&&!l){const lt=Vi(Z.x,Z.y,0,x),Qe=ve+Me+1,gt=new s.P(L.getx(Qe),L.gety(Qe)),$e=Vi(gt.x,gt.y,0,x),ot=$e[3]>0?$e:Rc(Z,gt,lt,1,x,void 0,ae,le.canonical),it=Xi(Oe,ke,(ot[0]-lt[0])*se,ot[1]-lt[1]);if(f.flipState=it&&it.needsFlipping?lo.flipRequired:lo.flipNotRequired,it)return it}const et=kc(ye*R.getoffsetX(Pe),fe,be,l,G,Z,Me,ve,De,L,w,Y,oe,!1,!1,ae,le,me);if(!et)return{notEnoughRoom:!0};Ue(et)}return{}}function ox(f,i,l,p,x){const{x:w,y:E,z:R}=p.projectTilePoint(f.x,f.y,i);if(!x)return Vi(w,E,R,l);const[L,z,B]=x(f);return Vi(w+L,E+z,R+B,l)}function Rc(f,i,l,p,x,w,E,R){const L=ox(f.sub(i)._unit()._add(f),R,x,E,w);return s.a6.vec3.sub(L,l,L),s.a6.vec3.normalize(L,L),s.a6.vec3.scaleAndAdd(L,l,L,p)}function kc(f,i,l,p,x,w,E,R,L,z,B,G,Z,Y,se,oe,ae,le){const me=p?f-i:f+i;let ye=me>0?1:-1,fe=0;p&&(ye*=-1,fe=Math.PI),ye<0&&(fe+=Math.PI);let be=R+E+(ye>0?0:1)|0,ve=x,Pe=x,Te=0,Me=0;const Oe=Math.abs(me),ke=[],De=[];let Ue=w,et=Ue;const lt=()=>Rc(et,Ue,Pe,Oe-Te+1,B,Z,oe,ae.canonical);for(;Te+Me<=Oe;){if(be+=ye,be<R||be>=L)return null;if(Pe=ve,et=Ue,ke.push(Pe),Y&&De.push(et),Ue=new s.P(z.getx(be),z.gety(be)),ve=G[be],!ve){const dt=ox(Ue,ae.canonical,B,oe,Z);ve=dt[3]>0?G[be]=dt:lt()}Te+=Me,Me=s.a6.vec3.distance(Pe,ve)}se&&Z&&(G[be]&&(ve=lt(),Me=s.a6.vec3.distance(Pe,ve)),G[be]=ve);const Qe=(Oe-Te)/Me,gt=Ue.sub(et)._mult(Qe)._add(et),$e=s.a6.vec3.sub([],ve,Pe),ot=s.a6.vec3.scaleAndAdd([],Pe,$e,Qe);let it=[0,0,1],_t=$e[0],vt=$e[1];if(le&&(it=oe.upVector(ae.canonical,gt.x,gt.y),it[0]!==0||it[1]!==0||it[2]!==1)){const dt=[it[2],0,-it[0]],Wt=s.a6.vec3.cross([],it,dt);s.a6.vec3.normalize(dt,dt),s.a6.vec3.normalize(Wt,Wt),_t=s.a6.vec3.dot($e,dt),vt=s.a6.vec3.dot($e,Wt)}if(l){const dt=s.a6.vec3.cross([],it,$e);s.a6.vec3.normalize(dt,dt),s.a6.vec3.scaleAndAdd(ot,ot,dt,l*ye)}const at=fe+Math.atan2(vt,_t);return ke.push(ot),Y&&De.push(gt),{point:ot,angle:at,path:ke,tilePath:De,up:it}}function zo(f,i){const l=i.length,p=l+4*f;i.resize(p),i.float32.fill(-1/0,4*l,4*p)}function tf(f,i,l){const p=i[0],x=i[1];return f[0]=l[0]*p+l[4]*x+l[12],f[1]=l[1]*p+l[5]*x+l[13],f[3]=l[3]*p+l[7]*x+l[15],f}const Es=100;class Ui{constructor(i,l,p=new Qh(i.width+200,i.height+200,25),x=new Qh(i.width+200,i.height+200,25)){this.transform=i,this.grid=p,this.ignoredGrid=x,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Es,this.screenBottomBoundary=i.height+Es,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=l}placeCollisionBox(i,l,p,x,w,E,R,L){let z=p.projectedAnchorX,B=p.projectedAnchorY,G=p.projectedAnchorZ;const Z=p.elevation,Y=p.tileID,se=i.getProjection();if(Z&&Y){const[ve,Pe,Te]=se.upVector(Y.canonical,p.tileAnchorX,p.tileAnchorY),Me=se.upVectorScale(Y.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=ve*Z*Me,B+=Pe*Z*Me,G+=Te*Z*Me}const oe=this.projectAndGetPerspectiveRatio(R,z,B,G,p.tileID,se.name==="globe"||!!Z||this.transform.pitch>0,se),ae=E*oe.perspectiveRatio,le=(p.x1*l+x.x-p.padding)*ae+oe.point.x,me=(p.y1*l+x.y-p.padding)*ae+oe.point.y,ye=(p.x2*l+x.x+p.padding)*ae+oe.point.x,fe=(p.y2*l+x.y+p.padding)*ae+oe.point.y,be=oe.perspectiveRatio<=.55||oe.occluded;return!this.isInsideGrid(le,me,ye,fe)||!w&&this.grid.hitTest(le,me,ye,fe,L)||be?{box:[],offscreen:!1,occluded:oe.occluded}:{box:[le,me,ye,fe],offscreen:this.isOffscreen(le,me,ye,fe),occluded:!1}}placeCollisionCircles(i,l,p,x,w,E,R,L,z,B,G,Z,Y,se,oe){const ae=[],le=this.transform.elevation,me=i.getProjection(),ye=le?le.getAtTileOffsetFunc(oe,this.transform.center.lat,this.transform.worldSize,me):null,fe=new s.P(p.tileAnchorX,p.tileAnchorY);let{x:be,y:ve,z:Pe}=me.projectTilePoint(fe.x,fe.y,oe.canonical);if(ye){const[gt,$e,ot]=ye(fe);be+=gt,ve+=$e,Pe+=ot}const Te=me.name==="globe",Me=this.projectAndGetPerspectiveRatio(R,be,ve,Pe,oe,Te||!!le||this.transform.pitch>0,me),{perspectiveRatio:Oe}=Me,ke=(G?E/Oe:E*Oe)/s.bq,De=Vi(be,ve,Pe,L),Ue=Me.signedDistanceFromCamera>0?Dc(ke,w,p.lineOffsetX*ke,p.lineOffsetY*ke,!1,De,fe,p,x,L,{},le&&!G?ye:null,G&&!!le,me,oe,G):null;let et=!1,lt=!1,Qe=!0;if(Ue&&!Me.occluded){const gt=.5*Y*Oe+se,$e=new s.P(-100,-100),ot=new s.P(this.screenRightBoundary,this.screenBottomBoundary),it=new jo,{first:_t,last:vt}=Ue,at=_t.path.length;let dt=[];for(let Nt=at-1;Nt>=1;Nt--)dt.push(_t.path[Nt]);for(let Nt=1;Nt<vt.path.length;Nt++)dt.push(vt.path[Nt]);const Wt=2.5*gt;z&&(dt=dt.map(([Nt,Kt,Bt],Zt)=>(ye&&!Te&&(Bt=ye(Zt<at-1?_t.tilePath[at-1-Zt]:vt.tilePath[Zt-at+2])[2]),Vi(Nt,Kt,Bt,z))),dt.some(Nt=>Nt[3]<=0)&&(dt=[]));let Ct=[];if(dt.length>0){let Nt=1/0,Kt=-1/0,Bt=1/0,Zt=-1/0;for(const vn of dt)Nt=Math.min(Nt,vn[0]),Bt=Math.min(Bt,vn[1]),Kt=Math.max(Kt,vn[0]),Zt=Math.max(Zt,vn[1]);Kt>=$e.x&&Nt<=ot.x&&Zt>=$e.y&&Bt<=ot.y&&(Ct=[dt.map(vn=>new s.P(vn[0],vn[1]))],(Nt<$e.x||Kt>ot.x||Bt<$e.y||Zt>ot.y)&&(Ct=s.bo(Ct,$e.x,$e.y,ot.x,ot.y)))}for(const Nt of Ct){it.reset(Nt,.25*gt);let Kt=0;Kt=it.length<=.5*gt?1:Math.ceil(it.paddedLength/Wt)+1;for(let Bt=0;Bt<Kt;Bt++){const Zt=Bt/Math.max(Kt-1,1),vn=it.lerp(Zt),yn=vn.x+Es,nr=vn.y+Es;ae.push(yn,nr,gt,0);const lr=yn-gt,yr=nr-gt,Us=yn+gt,Vr=nr+gt;if(Qe=Qe&&this.isOffscreen(lr,yr,Us,Vr),lt=lt||this.isInsideGrid(lr,yr,Us,Vr),!l&&this.grid.hitTestCircle(yn,nr,gt,Z)&&(et=!0,!B))return{circles:[],offscreen:!1,collisionDetected:et,occluded:!1}}}}return{circles:!B&&et||!lt?[]:ae,offscreen:Qe,collisionDetected:et,occluded:Me.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let p=1/0,x=1/0,w=-1/0,E=-1/0;for(const B of i){const G=new s.P(B.x+Es,B.y+Es);p=Math.min(p,G.x),x=Math.min(x,G.y),w=Math.max(w,G.x),E=Math.max(E,G.y),l.push(G)}const R=this.grid.query(p,x,w,E).concat(this.ignoredGrid.query(p,x,w,E)),L={},z={};for(const B of R){const G=B.key;if(L[G.bucketInstanceId]===void 0&&(L[G.bucketInstanceId]={}),L[G.bucketInstanceId][G.featureIndex])continue;const Z=[new s.P(B.x1,B.y1),new s.P(B.x2,B.y1),new s.P(B.x2,B.y2),new s.P(B.x1,B.y2)];s.bp(l,Z)&&(L[G.bucketInstanceId][G.featureIndex]=!0,z[G.bucketInstanceId]===void 0&&(z[G.bucketInstanceId]=[]),z[G.bucketInstanceId].push(G.featureIndex))}return z}insertCollisionBox(i,l,p,x,w){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:x,collisionGroupID:w},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,l,p,x,w){const E=l?this.ignoredGrid:this.grid,R={bucketInstanceId:p,featureIndex:x,collisionGroupID:w};for(let L=0;L<i.length;L+=4)E.insertCircle(R,i[L],i[L+1],i[L+2])}projectAndGetPerspectiveRatio(i,l,p,x,w,E,R){const L=[l,p,x,1];let z=!1;x||this.transform.pitch>0?(s.a6.vec4.transformMat4(L,L,i),this.fogState&&w&&R.name!=="globe"&&(z=function(Z,Y,se,oe,ae,le){const me=le.calculateFogTileMatrix(ae),ye=[Y,se,oe];return s.a6.vec3.transformMat4(ye,ye,me),kt(Z,s.a6.vec3.length(ye),le.pitch,le._fov)}(this.fogState,l,p,x,w.toUnwrapped(),this.transform)>.9)):tf(L,L,i);const B=L[3];return{point:new s.P((L[0]/B+1)/2*this.transform.width+Es,(-L[1]/B+1)/2*this.transform.height+Es),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(R)/B*.5,1.5),signedDistanceFromCamera:B,occluded:E&&L[2]>B||z}}isOffscreen(i,l,p,x){return p<Es||i>=this.screenRightBoundary||x<Es||l>this.screenBottomBoundary}isInsideGrid(i,l,p,x){return p>=0&&i<this.gridRightBoundary&&x>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const i=s.a6.mat4.identity([]);return s.a6.mat4.translate(i,i,[-100,-100,0]),i}}function Yi(f,i,l){const p=i.createTileMatrix(f,f.worldSize,l.toUnwrapped());return s.a6.mat4.multiply(new Float32Array(16),f.projMatrix,p)}function ax(f,i,l){if(i.projection.name===l.projection.name)return f.projMatrix;const p=l.clone();return p.setProjection(i.projection),Yi(p,i.getProjection(),f)}function qa(f,i,l){return i.name===l.projection.name?f.projMatrix:Yi(l,i,f)}class Wr{constructor(i,l,p,x){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?l:-l))):x&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Ki{constructor(i,l,p,x,w,E=!1){this.text=new Wr(i?i.text:null,l,p,w),this.icon=new Wr(i?i.icon:null,l,x,w),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class co{constructor(i,l,p,x=!1){this.text=i,this.icon=l,this.skipFade=p,this.clipped=x}}class mi{constructor(){this.invProjMatrix=s.a6.mat4.create(),this.viewportMatrix=s.a6.mat4.create(),this.circles=[]}}class Rm{constructor(i,l,p,x,w){this.bucketInstanceId=i,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=x,this.tileID=w}}class uo{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const l=++this.maxGroupID;this.collisionGroups[i]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[i]}}function Nc(f,i,l,p,x){const{horizontalAlign:w,verticalAlign:E}=s.bx(f),R=-(w-.5)*i,L=-(E-.5)*l,z=s.bw(f,p);return new s.P(R+z[0]*x,L+z[1]*x)}function Al(f,i,l,p,x){const w=new s.P(f,i);return l&&w._rotate(p?x:-x),w}class Il{constructor(i,l,p,x,w,E){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new Ui(this.transform,w),this.buildingIndex=E,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new uo(p),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,l,p,x){const w=p.getBucket(l),E=p.latestFeatureIndex;if(!w||!E||l.fqid!==w.layerIds[0])return;const R=w.layers[0].layout,L=w.layers[0].paint,z=p.collisionBoxArray,B=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),G=p.tileSize/s.ab,Z=p.tileID.toUnwrapped();this.transform.setProjection(w.projection);const Y=(se=p.tileID,oe=w.getProjection(),ae=this.transform,oe.name===this.projection?ae.calculateProjMatrix(se.toUnwrapped()):Yi(ae,oe,se));var se,oe,ae;const le=R.get("text-pitch-alignment")==="map",me=R.get("text-rotation-alignment")==="map";l.compileFilter();const ye=l.dynamicFilter(),fe=l.dynamicFilterNeedsFeature(),be=this.transform.calculatePixelsToTileUnitsMatrix(p),ve=Rn(Y,p.tileID.canonical,le,me,this.transform,w.getProjection(),be);let Pe=null;if(le){const Oe=cs(Y,p.tileID.canonical,le,me,this.transform,w.getProjection(),be);Pe=s.a6.mat4.multiply([],this.transform.labelPlaneMatrix,Oe)}let Te=null;ye&&p.latestFeatureIndex&&(Te={unwrappedTileID:Z,dynamicFilter:ye,dynamicFilterNeedsFeature:fe}),this.retainedQueryData[w.bucketInstanceId]=new Rm(w.bucketInstanceId,E,w.sourceLayerIndex,w.index,p.tileID);const Me={bucket:w,layout:R,paint:L,posMatrix:Y,textLabelPlaneMatrix:ve,labelToScreenMatrix:Pe,clippingData:Te,scale:B,textPixelRatio:G,holdingForFade:p.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:s.bj(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.bj(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(x)for(const Oe of w.sortKeyRanges){const{sortKey:ke,symbolInstanceStart:De,symbolInstanceEnd:Ue}=Oe;i.push({sortKey:ke,symbolInstanceStart:De,symbolInstanceEnd:Ue,parameters:Me})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Me})}attemptAnchorPlacement(i,l,p,x,w,E,R,L,z,B,G,Z,Y,se,oe,ae,le,me){const{textOffset0:ye,textOffset1:fe,crossTileID:be}=Z,ve=[ye,fe],Pe=Nc(i,p,x,ve,w),Te=this.collisionIndex.placeCollisionBox(se,w,l,Al(Pe.x,Pe.y,E,R,this.transform.angle),G,L,z,B.predicate);if(ae){const Me=se.getSymbolInstanceIconSize(me,this.transform.zoom,Z.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(se,Me,ae,Al(Pe.x,Pe.y,E,R,this.transform.angle),G,L,z,B.predicate).box.length===0)return}if(Te.box.length>0){let Me;return this.prevPlacement&&this.prevPlacement.variableOffsets[be]&&this.prevPlacement.placements[be]&&this.prevPlacement.placements[be].text&&(Me=this.prevPlacement.variableOffsets[be].anchor),this.variableOffsets[be]={textOffset:ve,width:p,height:x,anchor:i,textScale:w,prevAnchor:Me},this.markUsedJustification(se,i,Z,oe),se.allowVerticalPlacement&&(this.markUsedOrientation(se,oe,Z),this.placedOrientations[be]=oe),{shift:Pe,placedGlyphBoxes:Te}}}placeLayerBucketPart(i,l,p,x){const{bucket:w,layout:E,paint:R,posMatrix:L,textLabelPlaneMatrix:z,labelToScreenMatrix:B,clippingData:G,textPixelRatio:Z,holdingForFade:Y,collisionBoxArray:se,partiallyEvaluatedTextSize:oe,partiallyEvaluatedIconSize:ae,collisionGroup:le,latestFeatureIndex:me}=i.parameters,ye=E.get("text-optional"),fe=E.get("icon-optional"),be=E.get("text-allow-overlap"),ve=E.get("icon-allow-overlap"),Pe=E.get("text-rotation-alignment")==="map",Te=E.get("text-pitch-alignment")==="map",Me=E.get("symbol-z-elevate"),Oe=R.get("symbol-z-offset"),ke=R.get("symbol-elevation-reference")==="sea";this.transform.setProjection(w.projection);let De=be&&(ve||!w.hasIconData()||fe),Ue=ve&&(be||!w.hasTextData()||ye);const et=!Oe.isConstant();!w.collisionArrays&&se&&w.deserializeCollisionBoxes(se),p&&x&&w.updateCollisionDebugBuffers(this.transform.zoom,se);const lt=(Qe,gt,$e)=>{const{crossTileID:ot,numVerticalGlyphVertices:it}=Qe;let _t=null;if(G&&G.dynamicFilterNeedsFeature||et){const _n=this.retainedQueryData[w.bucketInstanceId];_t=me.loadFeature({featureIndex:Qe.featureIndex,bucketIndex:_n.bucketIndex,sourceLayerIndex:_n.sourceLayerIndex,layoutVertexArrayOffset:0})}if(G&&!(0,G.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},_t,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new s.P(Qe.tileAnchorX,Qe.tileAnchorY),this.transform.calculateDistanceTileData(G.unwrappedTileID)))return this.placements[ot]=new co(!1,!1,!1,!0),void l.add(ot);const vt=Oe.evaluate(_t,{});if(l.has(ot))return;if(Y)return void(this.placements[ot]=new co(!1,!1,!1));let at=!1,dt=!1,Wt=!0,Ct=!1,Nt=!1,Kt=null,Bt={box:null,offscreen:null,occluded:null},Zt={box:null,offscreen:null,occluded:null},vn=null,yn=null,nr=null,lr=0,yr=0,Us=0;$e.textFeatureIndex?lr=$e.textFeatureIndex:Qe.useRuntimeCollisionCircles&&(lr=Qe.featureIndex),$e.verticalTextFeatureIndex&&(yr=$e.verticalTextFeatureIndex);const Vr=_n=>{_n.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const Vn=this.transform.elevation;_n.elevation=ke?vt:vt+(Vn?Vn.getAtTileOffset(_n.tileID,_n.tileAnchorX,_n.tileAnchorY):0),_n.elevation+=Qe.zOffset},Cn=$e.textBox;if(Cn){Vr(Cn);const _n=Kn=>{let Lr=s.bk.horizontal;if(w.allowVerticalPlacement&&!Kn&&this.prevPlacement){const Ur=this.prevPlacement.placedOrientations[ot];Ur&&(this.placedOrientations[ot]=Ur,Lr=Ur,this.markUsedOrientation(w,Lr,Qe))}return Lr},Vn=(Kn,Lr)=>{if(w.allowVerticalPlacement&&it>0&&$e.verticalTextBox){for(const Ur of w.writingModes)if(Ur===s.bk.vertical?(Bt=Lr(),Zt=Bt):Bt=Kn(),Bt&&Bt.box&&Bt.box.length)break}else Bt=Kn()};if(E.get("text-variable-anchor")){let Kn=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ot]){const Nn=this.prevPlacement.variableOffsets[ot];Kn.indexOf(Nn.anchor)>0&&(Kn=Kn.filter(oi=>oi!==Nn.anchor),Kn.unshift(Nn.anchor))}const Lr=(Nn,oi,gi)=>{const ai=w.getSymbolInstanceTextSize(oe,Qe,this.transform.zoom,gt),fr=(Nn.x2-Nn.x1)*ai+2*Nn.padding,Qi=(Nn.y2-Nn.y1)*ai+2*Nn.padding,es=Qe.hasIconTextFit&&!ve?oi:null;es&&Vr(es);let $s={box:[],offscreen:!1,occluded:!1};const Ds=be?2*Kn.length:Kn.length;for(let fs=0;fs<Ds;++fs){const Gs=this.attemptAnchorPlacement(Kn[fs%Kn.length],Nn,fr,Qi,ai,Pe,Te,Z,L,le,fs>=Kn.length,Qe,gt,w,gi,es,oe,ae);if(Gs&&($s=Gs.placedGlyphBoxes,$s&&$s.box&&$s.box.length)){at=!0,Kt=Gs.shift;break}}return $s};Vn(()=>Lr(Cn,$e.iconBox,s.bk.horizontal),()=>{const Nn=$e.verticalTextBox;return Nn&&Vr(Nn),w.allowVerticalPlacement&&!(Bt&&Bt.box&&Bt.box.length)&&it>0&&Nn?Lr(Nn,$e.verticalIconBox,s.bk.vertical):{box:null,offscreen:null,occluded:null}}),Bt&&(at=Bt.box,Wt=Bt.offscreen,Ct=Bt.occluded);const Ur=_n(!(!Bt||!Bt.box));if(!at&&this.prevPlacement){const Nn=this.prevPlacement.variableOffsets[ot];Nn&&(this.variableOffsets[ot]=Nn,this.markUsedJustification(w,Nn.anchor,Qe,Ur))}}else{const Kn=(Lr,Ur)=>{const Nn=w.getSymbolInstanceTextSize(oe,Qe,this.transform.zoom,gt),oi=this.collisionIndex.placeCollisionBox(w,Nn,Lr,new s.P(0,0),be,Z,L,le.predicate);return oi&&oi.box&&oi.box.length&&(this.markUsedOrientation(w,Ur,Qe),this.placedOrientations[ot]=Ur),oi};Vn(()=>Kn(Cn,s.bk.horizontal),()=>{const Lr=$e.verticalTextBox;return w.allowVerticalPlacement&&it>0&&Lr?(Vr(Lr),Kn(Lr,s.bk.vertical)):{box:null,offscreen:null,occluded:null}}),_n(!!(Bt&&Bt.box&&Bt.box.length))}}if(vn=Bt,at=vn&&vn.box&&vn.box.length>0,Wt=vn&&vn.offscreen,Ct=vn&&vn.occluded,Qe.useRuntimeCollisionCircles){const _n=w.text.placedSymbolArray.get(Qe.centerJustifiedTextSymbolIndex>=0?Qe.centerJustifiedTextSymbolIndex:Qe.verticalPlacedTextSymbolIndex),Vn=s.bl(w.textSizeData,oe,_n),Kn=E.get("text-padding");yn=this.collisionIndex.placeCollisionCircles(w,be,_n,w.lineVertexArray,w.glyphOffsetArray,Vn,L,z,B,p,Te,le.predicate,Qe.collisionCircleDiameter*Vn/s.bq,Kn,this.retainedQueryData[w.bucketInstanceId].tileID),at=be||yn.circles.length>0&&!yn.collisionDetected,Wt=Wt&&yn.offscreen,Ct=yn.occluded}if($e.iconFeatureIndex&&(Us=$e.iconFeatureIndex),$e.iconBox){const _n=Vn=>{Vr(Vn);const Kn=Qe.hasIconTextFit&&Kt?Al(Kt.x,Kt.y,Pe,Te,this.transform.angle):new s.P(0,0),Lr=w.getSymbolInstanceIconSize(ae,this.transform.zoom,Qe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,Lr,Vn,Kn,ve,Z,L,le.predicate)};Zt&&Zt.box&&Zt.box.length&&$e.verticalIconBox?(nr=_n($e.verticalIconBox),dt=nr.box.length>0):(nr=_n($e.iconBox),dt=nr.box.length>0),Wt=Wt&&nr.offscreen,Nt=nr.occluded}const sr=ye||Qe.numHorizontalGlyphVertices===0&&it===0,Tr=fe||Qe.numIconVertices===0;if(sr||Tr?Tr?sr||(dt=dt&&at):at=dt&&at:dt=at=dt&&at,at&&vn&&vn.box&&this.collisionIndex.insertCollisionBox(vn.box,E.get("text-ignore-placement"),w.bucketInstanceId,Zt&&Zt.box&&yr?yr:lr,le.ID),dt&&nr&&this.collisionIndex.insertCollisionBox(nr.box,E.get("icon-ignore-placement"),w.bucketInstanceId,Us,le.ID),yn&&(at&&this.collisionIndex.insertCollisionCircles(yn.circles,E.get("text-ignore-placement"),w.bucketInstanceId,lr,le.ID),p)){const _n=w.bucketInstanceId;let Vn=this.collisionCircleArrays[_n];Vn===void 0&&(Vn=this.collisionCircleArrays[_n]=new mi);for(let Kn=0;Kn<yn.circles.length;Kn+=4)Vn.circles.push(yn.circles[Kn+0]),Vn.circles.push(yn.circles[Kn+1]),Vn.circles.push(yn.circles[Kn+2]),Vn.circles.push(yn.collisionDetected?1:0)}const ir=w.projection.name!=="globe";De=De&&(ir||!Ct),Ue=Ue&&(ir||!Nt),this.placements[ot]=new co(at||De,dt||Ue,Wt||w.justReloaded),l.add(ot)};if(Me&&this.buildingIndex&&(this.buildingIndex.updateZOffset(w,this.retainedQueryData[w.bucketInstanceId].tileID),w.updateZOffset()),w.sortFeaturesByY){const Qe=w.getSortedSymbolIndexes(this.transform.angle);for(let gt=Qe.length-1;gt>=0;--gt){const $e=Qe[gt];lt(w.symbolInstances.get($e),$e,w.collisionArrays[$e])}w.hasAnyZOffset&&s.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const Qe=w.getSortedIndexesByZOffset();for(let gt=0;gt<Qe.length;++gt){const $e=Qe[gt];lt(w.symbolInstances.get($e),$e,w.collisionArrays[$e])}}else for(let Qe=i.symbolInstanceStart;Qe<i.symbolInstanceEnd;Qe++)lt(w.symbolInstances.get(Qe),Qe,w.collisionArrays[Qe]);if(p&&w.bucketInstanceId in this.collisionCircleArrays){const Qe=this.collisionCircleArrays[w.bucketInstanceId];s.a6.mat4.invert(Qe.invProjMatrix,L),Qe.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(i,l,p,x){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:L,crossTileID:z}=p,B=s.bv(l),G=x===s.bk.vertical?L:B==="left"?w:B==="center"?E:B==="right"?R:-1;w>=0&&(i.text.placedSymbolArray.get(w).crossTileID=G>=0&&w!==G?0:z),E>=0&&(i.text.placedSymbolArray.get(E).crossTileID=G>=0&&E!==G?0:z),R>=0&&(i.text.placedSymbolArray.get(R).crossTileID=G>=0&&R!==G?0:z),L>=0&&(i.text.placedSymbolArray.get(L).crossTileID=G>=0&&L!==G?0:z)}markUsedOrientation(i,l,p){const x=l===s.bk.horizontal||l===s.bk.horizontalOnly?l:0,w=l===s.bk.vertical?l:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:R,rightJustifiedTextSymbolIndex:L,verticalPlacedTextSymbolIndex:z}=p,B=i.text.placedSymbolArray;E>=0&&(B.get(E).placedOrientation=x),R>=0&&(B.get(R).placedOrientation=x),L>=0&&(B.get(L).placedOrientation=x),z>=0&&(B.get(z).placedOrientation=w)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const x=l?l.symbolFadeChange(i):1,w=l?l.opacities:{},E=l?l.variableOffsets:{},R=l?l.placedOrientations:{};for(const L in this.placements){const z=this.placements[L],B=w[L];B?(this.opacities[L]=new Ki(B,x,z.text,z.icon,null,z.clipped),p=p||z.text!==B.text.placed||z.icon!==B.icon.placed):(this.opacities[L]=new Ki(null,x,z.text,z.icon,z.skipFade,z.clipped),p=p||z.text||z.icon)}for(const L in w){const z=w[L];if(!this.opacities[L]){const B=new Ki(z,x,!1,!1);B.isHidden()||(this.opacities[L]=B,p=p||z.text.placed||z.icon.placed)}}for(const L in E)this.variableOffsets[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.variableOffsets[L]=E[L]);for(const L in R)this.placedOrientations[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.placedOrientations[L]=R[L]);p?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:i)}updateLayerOpacities(i,l,p,x){const w=new Set;for(const E of l){const R=E.getBucket(i);R&&E.latestFeatureIndex&&i.fqid===R.layerIds[0]&&(this.updateBucketOpacities(R,w,E,E.collisionBoxArray,p,x,E.tileID,i.scope),R.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(R,E.tileID),R.updateZOffset()))}}updateBucketOpacities(i,l,p,x,w,E,R,L){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const z=i.layers[0].layout,B=i.layers[0].paint,G=!!i.layers[0].dynamicFilter(),Z=new Ki(null,0,!1,!1,!0),Y=z.get("text-allow-overlap"),se=z.get("icon-allow-overlap"),oe=z.get("text-variable-anchor"),ae=z.get("text-rotation-alignment")==="map",le=z.get("text-pitch-alignment")==="map",me=B.get("symbol-z-offset"),ye=B.get("symbol-elevation-reference")==="sea",fe=!me.isConstant(),be=new Ki(null,0,Y&&(se||!i.hasIconData()||z.get("icon-optional")),se&&(Y||!i.hasTextData()||z.get("text-optional")),!0);!i.collisionArrays&&x&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(x);const ve=(Te,Me,Oe)=>{for(let ke=0;ke<Me/4;ke++)Te.opacityVertexArray.emplaceBack(Oe)};let Pe=0;E&&i.updateReplacement(R,E);for(let Te=0;Te<i.symbolInstances.length;Te++){const Me=i.symbolInstances.get(Te),{numHorizontalGlyphVertices:Oe,numVerticalGlyphVertices:ke,crossTileID:De,numIconVertices:Ue,tileAnchorX:et,tileAnchorY:lt}=Me;let Qe=null;if(Me&&fe){const Ct=this.retainedQueryData[i.bucketInstanceId];Qe=p.latestFeatureIndex.loadFeature({featureIndex:Me.featureIndex,bucketIndex:Ct.bucketIndex,sourceLayerIndex:Ct.sourceLayerIndex,layoutVertexArrayOffset:0})}const gt=me.evaluate(Qe,{}),$e=l.has(De);let ot=this.opacities[De];$e?ot=Z:ot||(ot=be,this.opacities[De]=ot),l.add(De);const it=Oe>0||ke>0,_t=Ue>0,vt=this.placedOrientations[De],at=vt===s.bk.vertical,dt=vt===s.bk.horizontal||vt===s.bk.horizontalOnly;!it&&!_t||ot.isHidden()||Pe++;let Wt=!1;if((it||_t)&&E)for(const Ct of i.activeReplacements){if(s.br(Ct,w,s.bs.Symbol,L)||Ct.min.x>et||et>Ct.max.x||Ct.min.y>lt||lt>Ct.max.y)continue;const Nt=s.bt(et,lt,R.canonical,Ct.footprintTileId.canonical);if(Wt=s.bu(Nt,Ct.footprint),Wt)break}if(it){const Ct=Wt?Oc:Lc(ot.text);ve(i.text,Oe,at?Oc:Ct),ve(i.text,ke,dt?Oc:Ct);const Nt=ot.text.isHidden(),{leftJustifiedTextSymbolIndex:Kt,centerJustifiedTextSymbolIndex:Bt,rightJustifiedTextSymbolIndex:Zt,verticalPlacedTextSymbolIndex:vn}=Me,yn=i.text.placedSymbolArray,nr=Nt||at?1:0;Kt>=0&&(yn.get(Kt).hidden=nr),Bt>=0&&(yn.get(Bt).hidden=nr),Zt>=0&&(yn.get(Zt).hidden=nr),vn>=0&&(yn.get(vn).hidden=Nt||dt?1:0);const lr=this.variableOffsets[De];lr&&this.markUsedJustification(i,lr.anchor,Me,vt);const yr=this.placedOrientations[De];yr&&(this.markUsedJustification(i,"left",Me,yr),this.markUsedOrientation(i,yr,Me))}if(_t){const Ct=Wt?Oc:Lc(ot.icon),{placedIconSymbolIndex:Nt,verticalPlacedIconSymbolIndex:Kt}=Me,Bt=i.icon.placedSymbolArray,Zt=ot.icon.isHidden()?1:0;Nt>=0&&(ve(i.icon,Ue,at?Oc:Ct),Bt.get(Nt).hidden=Zt),Kt>=0&&(ve(i.icon,Me.numVerticalIconVertices,dt?Oc:Ct),Bt.get(Kt).hidden=Zt)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Ct=i.collisionArrays[Te];if(Ct){let Nt=new s.P(0,0),Kt=!0;if(Ct.textBox||Ct.verticalTextBox){if(oe){const Zt=this.variableOffsets[De];Zt?(Nt=Nc(Zt.anchor,Zt.width,Zt.height,Zt.textOffset,Zt.textScale),ae&&Nt._rotate(le?this.transform.angle:-this.transform.angle)):Kt=!1}G&&(Kt=!ot.clipped),Ct.textBox&&nf(i.textCollisionBox.collisionVertexArray,ot.text.placed,!Kt||at,gt,ye,Nt.x,Nt.y),Ct.verticalTextBox&&nf(i.textCollisionBox.collisionVertexArray,ot.text.placed,!Kt||dt,gt,ye,Nt.x,Nt.y)}const Bt=Kt&&!!(!dt&&Ct.verticalIconBox);Ct.iconBox&&nf(i.iconCollisionBox.collisionVertexArray,ot.icon.placed,Bt,gt,ye,Me.hasIconTextFit?Nt.x:0,Me.hasIconTextFit?Nt.y:0),Ct.verticalIconBox&&nf(i.iconCollisionBox.collisionVertexArray,ot.icon.placed,!Bt,gt,ye,Me.hasIconTextFit?Nt.x:0,Me.hasIconTextFit?Nt.y:0)}}}if(i.fullyClipped=Pe===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const Te=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=Te.invProjMatrix,i.placementViewportMatrix=Te.viewportMatrix,i.collisionCircleArray=Te.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,l){const p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>i}setStale(){this.stale=!0}}function nf(f,i,l,p,x,w,E){f.emplaceBack(i?1:0,l?1:0,w||0,E||0,p,x?1:0),f.emplaceBack(i?1:0,l?1:0,w||0,E||0,p,x?1:0),f.emplaceBack(i?1:0,l?1:0,w||0,E||0,p,x?1:0),f.emplaceBack(i?1:0,l?1:0,w||0,E||0,p,x?1:0)}const fa=Math.pow(2,25),rw=Math.pow(2,24),lx=Math.pow(2,17),us=Math.pow(2,16),iw=Math.pow(2,9),rf=Math.pow(2,8),cx=Math.pow(2,1);function Lc(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const i=f.placed?1:0,l=Math.floor(127*f.opacity);return l*fa+i*rw+l*lx+i*us+l*iw+i*rf+l*cx+i}const Oc=0;class sw{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,l,p,x,w){const E=this._bucketParts;for(;this._currentTileIndex<i.length;)if(l.getBucketParts(E,x,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((R,L)=>R.sortKey-L.sortKey));this._currentPartIndex<E.length;){const R=E[this._currentPartIndex];if(l.placeLayerBucketPart(R,this._seenCrossTileIDs,p,R.symbolInstanceStart===0),this._currentPartIndex++,w())return!0}return!1}}class Td{constructor(i,l,p,x,w,E,R,L,z){this.placement=new Il(i,w,E,R,L,z),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(i,l,p,x){const w=s.q.now(),E=()=>{const R=s.q.now()-w;return!this._forceFullPlacement&&R>2};for(;this._currentPlacementIndex>=0;){const R=l[i[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=L)&&(!R.maxzoom||R.maxzoom>L)){const z=R,B=z.layout.get("symbol-z-elevate"),G=z.layout.get("symbol-sort-key").constantOr(1)!==void 0,Z=z.layout.get("symbol-z-order"),Y=Z==="viewport-y"||Z==="auto"&&!(Z!=="viewport-y"&&G),se=z.layout.get("text-allow-overlap")||z.layout.get("icon-allow-overlap")||z.layout.get("text-ignore-placement")||z.layout.get("icon-ignore-placement"),oe=Y&&se,ae=this._inProgressLayer=this._inProgressLayer||new sw(z),le=s.av(R.source,R.scope);if(ae.continuePlacement(B||oe?x[le]:p[le],this.placement,this._showCollisionBoxes,R,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Dl=512/s.ab/2;class ow{constructor(i,l,p){this.tileID=i,this.bucketInstanceId=p,this.index=new s.by(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=i.canonical.x*s.ab,w=i.canonical.y*s.ab;for(let E=0;E<l.length;E++){const{key:R,crossTileID:L,tileAnchorX:z,tileAnchorY:B}=l.get(E),G=Math.floor((x+z)*Dl),Z=Math.floor((w+B)*Dl);this.index.add(G,Z),this.keys.push(R),this.crossTileIDs.push(L)}this.index.finish()}findMatches(i,l,p){const x=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),w=Dl/Math.pow(2,l.canonical.z-this.tileID.canonical.z),E=l.canonical.x*s.ab,R=l.canonical.y*s.ab;for(let L=0;L<i.length;L++){const z=i.get(L);if(z.crossTileID)continue;const{key:B,tileAnchorX:G,tileAnchorY:Z}=z,Y=Math.floor((E+G)*w),se=Math.floor((R+Z)*w),oe=this.index.range(Y-x,se-x,Y+x,se+x);for(const ae of oe){const le=this.crossTileIDs[ae];if(this.keys[ae]===B&&!p.has(le)){p.add(le),z.crossTileID=le;break}}}}}class jc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ux{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const l=Math.round((i-this.lng)/360);if(l!==0)for(const p in this.indexes){const x=this.indexes[p],w={};for(const E in x){const R=x[E];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+l),w[R.tileID.key]=R}this.indexes[p]=w}this.lng=i}addBucket(i,l,p){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let w=0;w<l.symbolInstances.length;w++)l.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const x=this.usedCrossTileIDs[i.overscaledZ];for(const w in this.indexes){const E=this.indexes[w];if(Number(w)>i.overscaledZ)for(const R in E){const L=E[R];L.tileID.isChildOf(i)&&L.findMatches(l.symbolInstances,i,x)}else{const R=E[i.scaledTo(Number(w)).key];R&&R.findMatches(l.symbolInstances,i,x)}}for(let w=0;w<l.symbolInstances.length;w++){const E=l.symbolInstances.get(w);E.crossTileID||(E.crossTileID=p.generate(),x.add(E.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new ow(i,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(i,l){for(const p of l.crossTileIDs)this.usedCrossTileIDs[i].delete(p)}removeStaleBuckets(i){let l=!1;for(const p in this.indexes){const x=this.indexes[p];for(const w in x)i[x[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,x[w]),delete x[w],l=!0)}return l}}class sf{constructor(){this.layerIndexes={},this.crossTileIDs=new jc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,l,p,x){let w=this.layerIndexes[i.fqid];w===void 0&&(w=this.layerIndexes[i.fqid]=new ux);let E=!1;const R={};x.name!=="globe"&&w.handleWrapJump(p);for(const L of l){const z=L.getBucket(i);z&&i.fqid===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(L.tileID,z,this.crossTileIDs)&&(E=!0),R[z.bucketInstanceId]=!0)}return w.removeStaleBuckets(R)&&(E=!0),E}pruneUnusedLayers(i){const l={};i.forEach(p=>{l[p]=!0});for(const p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}const Cs=771;class En{constructor(i,l,p,x){this.blendFunction=i,this.blendColor=l,this.mask=p,this.blendEquation=x}}En.Replace=[1,0,1,0],En.disabled=new En(En.Replace,s.bz.transparent,[!1,!1,!1,!1]),En.unblended=new En(En.Replace,s.bz.transparent,[!0,!0,!0,!0]),En.alphaBlended=new En([1,Cs,1,Cs],s.bz.transparent,[!0,!0,!0,!0]),En.alphaBlendedNonPremultiplied=new En([770,Cs,770,Cs],s.bz.transparent,[!0,!0,!0,!0]),En.multiply=new En([774,0,774,0],s.bz.transparent,[!0,!0,!0,!0]);class qt{constructor(i,l,p){this.func=i,this.mask=l,this.range=p}}qt.ReadOnly=!1,qt.ReadWrite=!0,qt.disabled=new qt(519,qt.ReadOnly,[0,1]);const km=7680;class un{constructor(i,l,p,x,w,E){this.test=i,this.ref=l,this.mask=p,this.fail=x,this.depthFail=w,this.pass=E}}un.disabled=new un({func:519,mask:0},0,0,km,km,km);const Nm=1029,Ed=2305;class tn{constructor(i,l,p){this.enable=i,this.mode=l,this.frontFace=p}}function Lm(f,i){const l=s.bC(f,3);s.a6.mat4.fromQuat(f,i),s.bE(f,3,l)}function of(f,i){const l=s.a6.quat.identity([]);return s.a6.quat.rotateZ(l,l,-i),s.a6.quat.rotateX(l,l,-f),l}function Om(f,i){const l=[f[0],f[1],0],p=[i[0],i[1],0];if(s.a6.vec3.length(l)>=1e-15){const E=s.a6.vec3.normalize([],l);s.a6.vec3.scale(p,E,s.a6.vec3.dot(p,E)),i[0]=p[0],i[1]=p[1]}const x=s.a6.vec3.cross([],i,f);if(s.a6.vec3.len(x)<1e-15)return null;const w=Math.atan2(-x[1],x[0]);return of(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),w)}tn.disabled=new tn(!1,Nm,Ed),tn.backCCW=new tn(!0,Nm,Ed),tn.backCW=new tn(!0,Nm,2304),tn.frontCW=new tn(!0,1028,2304),tn.frontCCW=new tn(!0,1028,Ed);class Za{constructor(i,l){this.position=i,this.orientation=l}get position(){return this._position}set position(i){if(i){const l=i instanceof s.a5?i:new s.a5(i[0],i[1],i[2]);this._renderWorldCopies&&(l.x=s.bA(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(i,l){if(this.orientation=null,!this.position)return;const p=this.position,x=this._elevation?this._elevation.getAtPointOrZero(s.a5.fromLngLat(i)):0,w=s.a5.fromLngLat(i,x),E=[w.x-p.x,w.y-p.y,w.z-p.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=Om(E,l)}setPitchBearing(i,l){this.orientation=of(s.bB(i),s.bB(-l))}}class Rl{constructor(i,l){this._transform=s.a6.mat4.identity([]),this.orientation=l,this.position=i}get mercatorPosition(){const i=this.position;return new s.a5(i[0],i[1],i[2])}get position(){const i=s.bC(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var l;i&&s.bE(this._transform,3,[(l=i)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||s.a6.quat.identity([]),i&&Lm(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,l){this._orientation=of(i,l),Lm(this._transform,this._orientation)}forward(){const i=s.bC(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=s.bC(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=s.bC(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,l){const p=new Float64Array(16);return s.a6.mat4.invert(p,this.getWorldToCamera(i,l)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,l,p){const x=this.position;s.a6.vec3.scale(x,x,-i);const w=new Float64Array(16);return s.a6.mat4.fromScaling(w,[p,p,p]),s.a6.mat4.translate(w,w,x),w[10]*=l,w}getWorldToCamera(i,l){const p=new Float64Array(16),x=new Float64Array(4),w=this.position;return s.a6.quat.conjugate(x,this._orientation),s.a6.vec3.scale(w,w,-i),s.a6.mat4.fromQuat(p,x),s.a6.mat4.translate(p,p,w),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(i,l,p,x){const w=new Float64Array(16);return s.a6.mat4.perspective(w,i,l,p,x),w}getCameraToClipOrthographic(i,l,p,x,w,E){const R=new Float64Array(16);return s.a6.mat4.ortho(R,i,l,p,x,w,E),R}getDistanceToElevation(i,l=!1){const p=i===0?0:s.bD(i,l?s.aM(this.position[1]):this.position[1]),x=this.forward();return(p-this.position[2])/x[2]}clone(){return new Rl([...this.position],[...this.orientation])}}const Ni={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class af{constructor(i=0,l=0,p=0,x=0){if(isNaN(i)||i<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=l,this.left=p,this.right=x}interpolate(i,l,p){return l.top!=null&&i.top!=null&&(this.top=s.aa(i.top,l.top,p)),l.bottom!=null&&i.bottom!=null&&(this.bottom=s.aa(i.bottom,l.bottom,p)),l.left!=null&&i.left!=null&&(this.left=s.aa(i.left,l.left,p)),l.right!=null&&i.right!=null&&(this.right=s.aa(i.right,l.right,p)),this}getCenter(i,l){const p=s.ap((this.left+i-this.right)/2,0,i),x=s.ap((this.top+l-this.bottom)/2,0,l);return new s.P(p,x)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new af(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const zc=(f,i,l)=>(1-l)*f+l*i,Fc=f=>f*f*f*f*f;class lf{constructor(i,l,p,x,w,E,R){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=i||0,this._maxZoom=l||22,this._minPitch=p??0,this._maxPitch=x??60,this.setProjection(E),this.setMaxBounds(R),this.width=0,this.height=0,this._center=new s.bK(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new af,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Rl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const i=new lf(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(i,l=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(i||p)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return s.ar(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=s.bL(this.projectionOptions);const p=this.getProjection(),x=!s.bh(l,p);return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.bL({name:"mercator"});const l=i!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.bD(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bA(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const l=-i*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=s.a6.mat2.create(),s.a6.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const l=s.ap(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=s.bB(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const l=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){const i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,l=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!l||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;l||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let x=0,w=0;for(let E=0;E<l.length;E++){const R=new s.P(l[E][0]*this.width,p+l[E][1]*(this.height-p)),L=i.pointCoordinate(R);if(!L)continue;const z=1/Math.hypot(L[0]-this._camera.position[0],L[1]-this._camera.position[1]);x+=L[3]*z,w+=z}return w===0?NaN:x/w}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*l,x=this._mercatorZfromZoom(i),w=this._mercatorZfromZoom(this._maxZoom),E=Math.max(x-p,w);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let p;p=i.z<this._camera.position[2]?[l.x,l.y,l.z]:[i.x,i.y,i.z];const x=s.a6.vec3.length(s.a6.vec3.sub([],this._camera.position,p));return s.ap(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let l=!1;if(i.orientation&&!s.a6.quat.exactEquals(i.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(i.orientation)),i.position){const p=[i.position.x,i.position.y,i.position.z];s.a6.vec3.exactEquals(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,l=new Za;return l.position=new s.a5(i[0],i[1],i[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(i){if(!s.a6.quat.length(i))return!1;s.a6.quat.normalize(i,i);const l=s.a6.vec3.transformQuat([],[0,0,-1],i),p=s.a6.vec3.transformQuat([],[0,-1,0],i);if(p[2]<0)return!1;const x=Om(l,p);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(i){const l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;i[2]=s.ap(i[2],x/p,x/l),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,l,p){this._unmodified=!1,this._edgeInsets.interpolate(i,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const l=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(i){const l=[new s.bM(0,i)];if(this.renderWorldCopies){const p=this.pointCoordinate(new s.P(0,0)),x=this.pointCoordinate(new s.P(this.width,0)),w=this.pointCoordinate(new s.P(this.width,this.height)),E=this.pointCoordinate(new s.P(0,this.height)),R=Math.floor(Math.min(p.x,x.x,w.x,E.x)),L=Math.floor(Math.max(p.x,x.x,w.x,E.x)),z=1;for(let B=R-z;B<=L+z;B++)B!==0&&l.push(new s.bM(B,i))}return l}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(i,l,p){let x=[];const w=p!==void 0,E=!w;if(E&&this.zoom<l||w&&p[0]===0&&p[1]===0)return x;const R=new Set,L=(B,G,Z,Y,se)=>{const oe=s.c1(G,B,Z,Y,se);R.has(oe)||(x.push(new s.aA(B,G,Z,Y,se)),R.add(oe))};for(let B=0;B<i.length;B++){const G=i[B];if(E&&G.canonical.z!==l)continue;const Z=G.canonical,Y=G.overscaledZ,se=G.wrap,oe=1<<Z.z,ae=Z.x+1<oe,le=Z.x>0,me=Z.y+1<oe,ye=Z.y>0,fe=G.wrap-(le?0:1),be=G.wrap+(ae?0:1),ve=le?Z.x-1:oe-1,Pe=ae?Z.x+1:0;if(w)p[0]<0?(L(Y,be,Z.z,Pe,Z.y),p[1]<0&&me&&(L(Y,se,Z.z,Z.x,Z.y+1),L(Y,be,Z.z,Pe,Z.y+1)),p[1]>0&&ye&&(L(Y,se,Z.z,Z.x,Z.y-1),L(Y,be,Z.z,Pe,Z.y-1))):p[0]>0?(L(Y,fe,Z.z,ve,Z.y),p[1]<0&&me&&(L(Y,se,Z.z,Z.x,Z.y+1),L(Y,fe,Z.z,ve,Z.y+1)),p[1]>0&&ye&&(L(Y,se,Z.z,Z.x,Z.y-1),L(Y,fe,Z.z,ve,Z.y-1))):p[1]<0&&me?L(Y,se,Z.z,Z.x,Z.y+1):ye&&L(Y,se,Z.z,Z.x,Z.y-1);else{const Te=G.visibleQuadrants;1&Te&&(L(Y,fe,Z.z,ve,Z.y),ye&&(L(Y,se,Z.z,Z.x,Z.y-1),L(Y,fe,Z.z,ve,Z.y-1))),2&Te&&(L(Y,be,Z.z,Pe,Z.y),ye&&(L(Y,se,Z.z,Z.x,Z.y-1),L(Y,be,Z.z,Pe,Z.y-1))),4&Te&&(L(Y,fe,Z.z,ve,Z.y),me&&(L(Y,se,Z.z,Z.x,Z.y+1),L(Y,fe,Z.z,ve,Z.y+1))),8&Te&&(L(Y,be,Z.z,Pe,Z.y),me&&(L(Y,se,Z.z,Z.x,Z.y+1),L(Y,be,Z.z,Pe,Z.y+1)))}}const z=[];for(const B of x)x.some(G=>B.isChildOf(G))||z.push(B);if(x=z.filter(B=>!i.some(G=>!!(B.overscaledZ<l&&G.isChildOf(B))||B.equals(G)||B.isChildOf(G))),E){const B=1<<l,G=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Z=[B*G.x,B*G.y],Y=4,se=Y*Y;x=x.filter(oe=>{const ae=oe.canonical.x+.5-Z[0],le=oe.canonical.y+.5-Z[1];return ae*ae+le*le<se})}return x}coveringTiles(i){let l=this.coveringZoomLevel(i);const p=l,x=this.elevation&&this.elevation.exaggeration(),w=x&&!i.isTerrainDEM,E=this.projection.name==="mercator";if(i.minzoom!==void 0&&l<i.minzoom)return[];i.maxzoom!==void 0&&l>i.maxzoom&&(l=i.maxzoom);const R=this.locationCoordinate(this.center),L=this.center.lat,z=1<<l,B=[z*R.x,z*R.y,0],G=this.projection.name==="globe",Z=!G,Y=s.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,Z),se=G?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),oe=z*s.bD(1,this.center.lat),ae=this._camera.position[2]/s.bD(1,this.center.lat),le=[z*se.x,z*se.y,ae*(Z?1:oe)],me=G||x,ye=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),fe=this.isLODDisabled(!0)?l:0;let be;if(this._elevation&&i.isTerrainDEM)be=1e4*this._elevation.exaggeration();else if(this._elevation){const $e=this._elevation.getMinMaxForVisibleTiles();be=$e?$e.max:this._centerAltitude}else be=this._centerAltitude;const ve=i.isTerrainDEM?-be:this._elevation?this._elevation.getMinElevationBelowMSL():0,Pe=this.projection.isReprojectedInTileSpace?s.bO(this):1,Te=$e=>{const it=new s.a5($e.x+25e-6,$e.y,$e.z),_t=new s.a5($e.x,$e.y+25e-6,$e.z),vt=$e.toLngLat(),at=it.toLngLat(),dt=_t.toLngLat(),Wt=this.locationCoordinate(vt),Ct=this.locationCoordinate(at),Nt=this.locationCoordinate(dt),Kt=Math.hypot(Ct.x-Wt.x,Ct.y-Wt.y),Bt=Math.hypot(Nt.x-Wt.x,Nt.y-Wt.y);return Math.sqrt(Kt*Bt)*Pe/25e-6},Me=$e=>{const ot=be,it=ve;return{aabb:s.bR(this,z,0,0,0,$e,it,ot,this.projection),zoom:0,x:0,y:0,minZ:it,maxZ:ot,wrap:$e,fullyVisible:!1}},Oe=[];let ke=[];const De=l,Ue=i.reparseOverscaled?p:l,et=(ae-this._centerAltitude)*oe,lt=$e=>{if(!this._elevation||!$e.tileID||!E)return;const ot=this._elevation.getMinMaxForTile($e.tileID),it=$e.aabb;ot?(it.min[2]=ot.min,it.max[2]=ot.max,it.center[2]=(it.min[2]+it.max[2])/2):($e.shouldSplit=gt($e),$e.shouldSplit||(it.min[2]=it.max[2]=it.center[2]=this._centerAltitude))},Qe=($e,ot)=>{if(.707*ot<$e)return 1;const it=ot/$e;return it/(1.4144271570014144+(Math.pow(1.1,it-1.4144271570014144+1)-1)/(1.1-1)-1)},gt=$e=>{if($e.zoom<fe)return!0;if($e.zoom===De)return!1;if($e.shouldSplit!=null)return $e.shouldSplit;const ot=$e.aabb.distanceX(le),it=$e.aabb.distanceY(le);let _t=et,vt=1;if(G){_t=$e.aabb.distanceZ(le);const Bt=Math.pow(2,$e.zoom),Zt=s.aM(($e.y+1)/Bt),vn=s.aM($e.y/Bt),yn=Math.min(Math.max(L,Zt),vn),nr=s.c5(yn)/s.c5(L);if(vt=yn===L?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,nr/this._mercatorScaleRatio),this.zoom<=s.c2&&$e.zoom===De-1&&nr>=.9)return!0}else if(w&&(_t=$e.aabb.distanceZ(le)*oe),this.projection.isReprojectedInTileSpace&&p<=5){const Bt=Math.pow(2,$e.zoom),Zt=Te(new s.a5(($e.x+.5)/Bt,($e.y+.5)/Bt));vt=Zt>.85?1:Zt}if(!E){const Bt=Math.sqrt(ot*ot+it*it+_t*_t);let Zt=(1<<De-$e.zoom)*ye*vt;return Zt*=Qe(Math.max(_t,et),Bt),Bt<Zt}let at=Number.MAX_VALUE,dt=0;const Wt=$e.aabb.getCorners(),Ct=[];for(const Bt of Wt){s.a6.vec3.sub(Ct,Bt,le),G||(w?Ct[2]*=oe:Ct[2]=et);const Zt=s.a6.vec3.dot(Ct,this._camera.forward());Zt<at&&(at=Zt,dt=Math.abs(Ct[2]))}let Nt=(1<<De-$e.zoom)*ye*vt;if(Nt*=Qe(Math.max(dt,et),at),at<Nt)return!0;const Kt=$e.aabb.closestPoint(B);return Kt[0]===B[0]&&Kt[1]===B[1]};if(this.renderWorldCopies)for(let $e=1;$e<=3;$e++)Oe.push(Me(-$e)),Oe.push(Me($e));for(Oe.push(Me(0));Oe.length>0;){const $e=Oe.pop(),ot=$e.x,it=$e.y;let _t=$e.fullyVisible;const vt=()=>this.projection.name==="globe"&&($e.y===0||$e.y===(1<<$e.zoom)-1);if(!_t){let at=me?$e.aabb.intersects(Y):$e.aabb.intersectsFlat(Y);if(at===0&&vt()){const dt=new s.bP($e.zoom,ot,it);at=s.bQ(this,z,dt,!0).intersects(Y)}if(at===0)continue;_t=at===2}if($e.zoom!==De&&gt($e))for(let at=0;at<4;at++){const dt=(ot<<1)+at%2,Wt=(it<<1)+(at>>1),Ct={aabb:E?$e.aabb.quadrant(at):s.bR(this,z,$e.zoom+1,dt,Wt,$e.wrap,$e.minZ,$e.maxZ,this.projection),zoom:$e.zoom+1,x:dt,y:Wt,wrap:$e.wrap,fullyVisible:_t,tileID:void 0,shouldSplit:void 0,minZ:$e.minZ,maxZ:$e.maxZ};w&&!G&&(Ct.tileID=new s.aA($e.zoom+1===De?Ue:$e.zoom+1,$e.wrap,$e.zoom+1,dt,Wt),lt(Ct)),Oe.push(Ct)}else{const at=$e.zoom===De?Ue:$e.zoom;if(i.minzoom&&i.minzoom>at)continue;let dt=0;if(!_t){let Kt=me?$e.aabb.intersectsPrecise(Y):$e.aabb.intersectsPreciseFlat(Y);if(Kt===0&&vt()){const Bt=new s.bP($e.zoom,ot,it);Kt=s.bQ(this,z,Bt,!0).intersectsPrecise(Y)}if(Kt===0)continue;if(i.calculateQuadrantVisibility)if(Y.containsPoint($e.aabb.center))dt=15;else for(let Bt=0;Bt<4;Bt++)$e.aabb.quadrant(Bt).intersects(Y)!==0&&(dt|=1<<Bt)}const Wt=B[0]-(.5+ot+($e.wrap<<$e.zoom))*(1<<l-$e.zoom),Ct=B[1]-.5-it,Nt=$e.tileID?$e.tileID:new s.aA(at,$e.wrap,$e.zoom,ot,it);i.calculateQuadrantVisibility&&(Nt.visibleQuadrants=dt),ke.push({tileID:Nt,distanceSq:Wt*Wt+Ct*Ct})}}if(this.fogCullDistSq){const $e=this.fogCullDistSq,ot=this.horizonLineFromTop();ke=ke.filter(it=>{const _t=[0,0,0,1],vt=[s.ab,s.ab,0,1],at=this.calculateFogTileMatrix(it.tileID.toUnwrapped());s.a6.vec4.transformMat4(_t,_t,at),s.a6.vec4.transformMat4(vt,vt,at);const dt=s.a6.vec4.min([],_t,vt),Wt=s.a6.vec4.max([],_t,vt),Ct=s.bS(dt,Wt);if(Ct===0)return!0;let Nt=!1;const Kt=this._elevation;if(Kt&&Ct>$e&&ot!==0){const Bt=this.calculateProjMatrix(it.tileID.toUnwrapped());let Zt;i.isTerrainDEM||(Zt=Kt.getMinMaxForTile(it.tileID)),Zt||(Zt={min:ve,max:be});const vn=s.c3(this.rotation),yn=[vn[0]*s.ab,vn[1]*s.ab,Zt.max];s.a6.vec3.transformMat4(yn,yn,Bt),Nt=(1-yn[1])*this.height*.5<ot}return Ct<$e||Nt})}return ke.sort(($e,ot)=>$e.distanceSq-ot.distanceSq).map($e=>$e.tileID)}resize(i,l){this.width=i,this.height=l,this.pixelsToGLUnits=[2/i,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const l=s.ap(i.lat,-s.bT,s.bT),p=this.projection.project(i.lng,l);return new s.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.bD(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,l){let p,x;const w=this.centerPoint;if(this.projection.name==="globe"){const R=this.worldSize;p=(l.x-w.x)/R,x=(l.y-w.y)/R}else{const R=this.pointCoordinate(l),L=this.pointCoordinate(w);p=R.x-L.x,x=R.y-L.y}const E=this.locationCoordinate(i);this.setLocation(new s.a5(E.x-p,E.y-x))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,l){const p=l?s.bD(l,i.lat):void 0,x=this.projection.project(i.lng,i.lat);return new s.a5(x.x,x.y,p)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,l){const p=l??this._centerAltitude,x=[i.x,i.y,0,1],w=[i.x,i.y,1,1];s.a6.vec4.transformMat4(x,x,this.pixelMatrixInverse),s.a6.vec4.transformMat4(w,w,this.pixelMatrixInverse);const E=w[3];s.a6.vec4.scale(x,x,1/x[3]),s.a6.vec4.scale(w,w,1/E);const R=x[2],L=w[2];return{p0:x,p1:w,t:R===L?0:(p-R)/(L-R)}}screenPointToMercatorRay(i){const l=[i.x,i.y,0,1],p=[i.x,i.y,1,1];return s.a6.vec4.transformMat4(l,l,this.pixelMatrixInverse),s.a6.vec4.transformMat4(p,p,this.pixelMatrixInverse),s.a6.vec4.scale(l,l,1/l[3]),s.a6.vec4.scale(p,p,1/p[3]),l[2]=s.bD(l[2],this._center.lat)*this.worldSize,p[2]=s.bD(p[2],this._center.lat)*this.worldSize,s.a6.vec4.scale(l,l,1/this.worldSize),s.a6.vec4.scale(p,p,1/this.worldSize),new s.aj([l[0],l[1],l[2]],s.a6.vec3.normalize([],s.a6.vec3.sub([],p,l)))}rayIntersectionCoordinate(i){const{p0:l,p1:p,t:x}=i,w=s.bD(l[2],this._center.lat),E=s.bD(p[2],this._center.lat);return new s.a5(s.aa(l[0],p[0],x)/this.worldSize,s.aa(l[1],p[1],x)/this.worldSize,s.aa(w,E,x))}pointCoordinate(i,l=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,l)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let l=this.projection.pointCoordinate3D(this,i.x,i.y);if(l)return new s.a5(l[0],l[1],l[2]);let p=0,x=this.horizonLineFromTop();if(i.y>x)return this.pointCoordinate(i);const w=.02*x,E=i.clone();for(let R=0;R<10&&x-p>w;R++){E.y=s.aa(p,x,.66);const L=this.projection.pointCoordinate3D(this,E.x,E.y);L?(x=E.y,l=L):p=E.y}return l?new s.a5(l[0],l[1],l[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=s.bU)return!this.isPointAboveHorizon(i);const l=this.pointCoordinate(i);return l.y>=0&&l.y<=1}_coordinatePoint(i,l){const p=l&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,x=[i.x*this.worldSize,i.y*this.worldSize,p+i.toAltitude(),1];return s.a6.vec4.transformMat4(x,x,this.pixelMatrix),x[3]>0?new s.P(x[0]/x[3],x[1]/x[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:l}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,w=this.pointLocation3D(new s.P(l,i)),E=this.pointLocation3D(new s.P(x,i)),R=this.pointLocation3D(new s.P(x,p)),L=this.pointLocation3D(new s.P(l,p));let z=Math.min(w.lng,E.lng,R.lng,L.lng),B=Math.max(w.lng,E.lng,R.lng,L.lng),G=Math.min(w.lat,E.lat,R.lat,L.lat),Z=Math.max(w.lat,E.lat,R.lat,L.lat);const Y=Math.pow(2,-this.zoom)/16*270,se=this.projection.name==="globe"?1:4,oe=(ae,le,me,ye,fe)=>{const be=(ae+me)/2,ve=(le+ye)/2,Pe=new s.P(be,ve),{lng:Te,lat:Me}=this.pointLocation3D(Pe),Oe=Math.max(0,z-Te,G-Me,Te-B,Me-Z);z=Math.min(z,Te),B=Math.max(B,Te),G=Math.min(G,Me),Z=Math.max(Z,Me),(fe<se||Oe>Y)&&(oe(ae,le,be,ve,fe+1),oe(be,ve,me,ye,fe+1))};if(oe(l,i,x,i,1),oe(x,i,x,p,1),oe(x,p,l,p,1),oe(l,p,l,i,1),this.projection.name==="globe"){const[ae,le]=s.bV(this);ae?(Z=90,B=180,z=-180):le&&(G=-90,B=180,z=-180)}return new s.as(new s.bK(z,G),new s.bK(B,Z))}_getBoundsRectangular(i,l){const{top:p,left:x}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,R=new s.P(x,p),L=new s.P(E,p),z=new s.P(E,w),B=new s.P(x,w);let G=this.pointCoordinate(R,i),Z=this.pointCoordinate(L,i);const Y=this.pointCoordinate(z,l),se=this.pointCoordinate(B,l),oe=(ae,le)=>(le.y-ae.y)/(le.x-ae.x);return G.y>1&&Z.y>=0?G=new s.a5((1-se.y)/oe(se,G)+se.x,1):G.y<0&&Z.y<=1&&(G=new s.a5(-se.y/oe(se,G)+se.x,0)),Z.y>1&&G.y>=0?Z=new s.a5((1-Y.y)/oe(Y,Z)+Y.x,1):Z.y<0&&G.y<=1&&(Z=new s.a5(-Y.y/oe(Y,Z)+Y.x,0)),new s.as().extend(this.coordinateLocation(G)).extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(se)).extend(this.coordinateLocation(Y))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=i.visibleDemTiles.reduce((p,x)=>{if(x.dem){const w=x.dem.tree;p.min=Math.min(p.min,w.minimums[0]),p.max=Math.max(p.max,w.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*i.exaggeration(),l.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return i?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-s.bT,this.maxLat=s.bT,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.am(this.minLng)*this.tileSize,this.worldMaxX=s.am(this.maxLng)*this.tileSize,this.worldMinY=s.at(this.maxLat)*this.tileSize,this.worldMaxY=s.at(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,l){return this.projection.createTileMatrix(this,l,i)}calculateDistanceTileData(i){const l=i.key,p=this._distanceTileDataCache;if(p[l])return p[l];const x=i.canonical,w=1/this.height,E=this.cameraWorldSize,R=E/this.zoomScale(x.z),L=(x.x+Math.pow(2,x.z)*i.wrap)*R,z=x.y*R,B=this.point;B.x*=E/this.worldSize,B.y*=E/this.worldSize;const G=this.angle,Z=Math.sin(-G),Y=-Math.cos(-G);return p[l]={bearing:[Z,Y],center:[(B.x-L)*w,(B.y-z)*w],scale:R/s.ab*w},p[l]}calculateFogTileMatrix(i){const l=i.key,p=this._fogTileMatrixCache;if(p[l])return p[l];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return s.a6.mat4.multiply(x,this.worldToFogMatrix,x),p[l]=new Float32Array(x),p[l]}calculateProjMatrix(i,l=!1,p=!1){const x=i.key;let w;if(w=p?this._expandedProjMatrixCache:l?this._alignedProjMatrixCache:this._projMatrixCache,w[x])return w[x];const E=this.calculatePosMatrix(i,this.worldSize);let R;return R=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:l?this.alignedProjMatrix:this.projMatrix,s.a6.mat4.multiply(E,R,E),w[x]=new Float32Array(E),w[x]}calculatePixelsToTileUnitsMatrix(i){const l=i.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];const x=s.bW(i,this);return p[l]=x,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,l=s.a6.mat4.fromScaling([],[i,i,i]);return s.a6.mat4.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const l=s.bD(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),x=this._camera.forward(),w=s.bD(1,this._center.lat);p[2]/=w,x[2]/=w,s.a6.vec3.normalize(x,x);const E=i.raycast(p,x,i.exaggeration());if(E){const R=s.a6.vec3.scaleAndAdd([],p,x,E),L=new s.a5(R[0],R[1],s.bD(R[2],s.aM(R[1]))),z=(L.z+s.a6.vec3.length([L.x-p[0],L.y-p[1],L.z-p[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=L.toAltitude(),this._center=this.coordinateLocation(L),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const l=this._elevation,p=s.bD(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(p),w=l.getAtPointOrZero(new s.a5(...x)),E=this.pixelsPerMeter/this.worldSize*w,R=this._minimumHeightOverTerrain(),L=x[2]-E;if(L<=R)if(L<0||i){const z=this.locationCoordinate(this._center,this._centerAltitude),B=[x[0],x[1],z.z-x[2]],G=s.a6.vec3.length(B);B[2]-=(R-L)/this._pixelsPerMercatorPixel;const Z=s.a6.vec3.length(B);if(Z===0)return;s.a6.vec3.scale(B,B,G/Z*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],z.z*this._pixelsPerMercatorPixel-B[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const Z=this.center;return Z.lat=s.ap(Z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(Z.lng=s.ap(Z.lng,this.minLng,this.maxLng)),this.center=Z,void(this._constraining=!1)}const l=this._unmodified,{x:p,y:x}=this.point;let w=0,E=p,R=x;const L=this.width/2,z=this.height/2,B=this.worldMinY*this.scale,G=this.worldMaxY*this.scale;if(x-z<B&&(R=B+z),x+z>G&&(R=G-z),G-B<this.height&&(w=Math.max(w,this.height/(G-B)),R=(G+B)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Z=this.worldMinX*this.scale,Y=this.worldMaxX*this.scale,se=this.worldSize/2-(Z+Y)/2;E=(p+se+this.worldSize)%this.worldSize-se,E-L<Z&&(E=Z+L),E+L>Y&&(E=Y-L),Y-Z<this.width&&(w=Math.max(w,this.width/(Y-Z)),E=(Y+Z)/2)}E===p&&R===x||(this.center=this.unproject(new s.P(E,R))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,l=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.bD(1,this.center.lat)/s.bD(1,s.c4));const x=s.bX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this.projection.zAxisUnit==="meters"?p:1,E=this._camera.getWorldToCamera(this.worldSize,w);let R;const L=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(L[8]=2*-i.x/this.width,L[9]=2*i.y/this.height,this.isOrthographic){let Me=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Oe=Me*this.aspect,ke=-Oe,De=-Me;Oe-=i.x,ke-=i.x,Me+=i.y,De+=i.y,R=this._camera.getCameraToClipOrthographic(ke,Oe,De,Me,this._nearZ,this._farZ),((Ue,et,lt,Qe)=>{for(let gt=0;gt<16;gt++)Ue[gt]=zc(et[gt],lt[gt],Qe)})(R,R,L,Fc(this.pitch>=15?1:this.pitch/15))}else R=L;const z=s.a6.mat4.mul([],L,E);let B=s.a6.mat4.mul([],R,E);if(this.projection.isReprojectedInTileSpace){const Me=this.locationCoordinate(this.center),Oe=s.a6.mat4.identity([]);s.a6.mat4.translate(Oe,Oe,[Me.x*this.worldSize,Me.y*this.worldSize,0]),s.a6.mat4.multiply(Oe,Oe,s.bY(this)),s.a6.mat4.translate(Oe,Oe,[-Me.x*this.worldSize,-Me.y*this.worldSize,0]),s.a6.mat4.multiply(B,B,Oe),s.a6.mat4.multiply(z,z,Oe),this.inverseAdjustmentMatrix=s.bZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.a6.mat4.scale([],B,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=B,this.invProjMatrix=s.a6.mat4.invert(new Float64Array(16),this.projMatrix),l){const Me=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Me[8]=2*-i.x/this.width,Me[9]=2*i.y/this.height,this.expandedFarZProjMatrix=s.a6.mat4.mul([],Me,E)}else this.expandedFarZProjMatrix=this.projMatrix;const G=s.a6.mat4.invert([],R);this.frustumCorners=s.b_.fromInvProjectionMatrix(G,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!l);const Z=new Float32Array(16);s.a6.mat4.identity(Z),s.a6.mat4.scale(Z,Z,[1,-1,1]),s.a6.mat4.rotateX(Z,Z,this._pitch),s.a6.mat4.rotateZ(Z,Z,this.angle);const Y=s.a6.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.a6.mat4.clone(Y);const se=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Y[8]=2*-i.x/this.width,Y[9]=2*(i.y+se)/this.height,this.skyboxMatrix=s.a6.mat4.multiply(Z,Y,Z);const oe=this.point,ae=oe.x,le=oe.y,me=this.width%2/2,ye=this.height%2/2,fe=Math.cos(this.angle),be=Math.sin(this.angle),ve=ae-Math.round(ae)+fe*me+be*ye,Pe=le-Math.round(le)+fe*ye+be*me,Te=new Float64Array(B);if(s.a6.mat4.translate(Te,Te,[ve>.5?ve-1:ve,Pe>.5?Pe-1:Pe,0]),this.alignedProjMatrix=Te,B=s.a6.mat4.create(),s.a6.mat4.scale(B,B,[this.width/2,-this.height/2,1]),s.a6.mat4.translate(B,B,[1,-1,0]),this.labelPlaneMatrix=B,B=s.a6.mat4.create(),s.a6.mat4.scale(B,B,[1,-1,1]),s.a6.mat4.translate(B,B,[-1,-1,0]),s.a6.mat4.scale(B,B,[2/this.width,2/this.height,1]),this.glCoordMatrix=B,this.pixelMatrix=s.a6.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,z),this._calcFogMatrices(),this._distanceTileDataCache={},B=s.a6.mat4.invert(new Float64Array(16),this.pixelMatrix),!B)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=B,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.b$(this);const Me=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.a6.vec3.transformMat4(Me,Me,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=B;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,p=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,w=[i,i,l];s.a6.vec3.scale(w,w,x),s.a6.vec3.scale(p,p,-1),s.a6.vec3.multiply(p,p,w);const E=s.a6.mat4.create();s.a6.mat4.translate(E,E,p),s.a6.mat4.scale(E,E,w),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,l,x)}_computeCameraPosition(i){const l=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),x=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-i/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-p[0]*w,x.y/this.worldSize-p[1]*w,i/this.worldSize*this._centerAltitude-p[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],x=i[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(w=Math.min((l-p)/x,1)),this._camera.position=s.a6.vec3.scaleAndAdd([],this._camera.position,i,w),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:x}=this._camera.getPitchBearing(),w=s.bD(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.bB(this._maxPitch)),R=Math.max((i[2]-w)/Math.cos(p),E),L=this._zoomFromMercatorZ(R);s.a6.vec3.scaleAndAdd(i,i,l,R),this._pitch=s.ap(p,s.bB(this.minPitch),s.bB(this.maxPitch)),this.angle=s.bA(x,-Math.PI,Math.PI),this._setZoom(s.ap(L,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.a5(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let l=0,p=s.bU,x=0,w=1/0;for(;p-l>1e-6&&p>l;){const E=l+.5*(p-l),R=this.tileSize*Math.pow(2,E),L=this.getCameraToCenterDistance(this.projection,E,R),z=this.scaleZoom(L/(i*this.tileSize)),B=Math.abs(E-z);B<w&&(w=B,x=E),E<z?l=E:p=E}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,l){const p=Math.min(i.x,l.x),x=Math.max(i.x,l.x),w=Math.min(i.y,l.y),E=Math.max(i.y,l.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const R=[new s.P(p,w),new s.P(x,E),new s.P(p,E),new s.P(x,w)],L=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const B of R){const G=this.pointRayIntersection(B);if(G.t<0)return!0;const Z=this.rayIntersectionCoordinate(G);if(Z.x<L||Z.y<0||Z.x>z||Z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.c0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(i,l){const p=s.a6.vec3.length(s.a6.vec3.sub([],this._camera.position,i)),x=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const i=function([l,p,x],w){const E=[l,p,x,1];s.a6.vec4.transformMat4(E,E,w);const R=E[3]=Math.max(E[3],1e-6);return E[0]/=R,E[1]/=R,E[2]/=R,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,i))}}getCameraToCenterDistance(i,l=this.zoom,p=this.worldSize){const x=s.bX(i,l,this.width,this.height,1024),w=i.pixelSpaceConversion(this.center.lat,p,x);let E=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(E=zc(1,E,Fc(this.pitch>=15?1:this.pitch/15))),E}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.a6.mat4.multiply(i,i,this.globeMatrix),i}getFrustum(i){return s.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,this.projection.zAxisUnit==="meters")}}const pa=(f,i)=>{if(i>0&&f.terrain&&s.w("Cutoff is currently disabled on terrain"),i<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const l=f.transform,p=Math.max(Math.abs(l._zoom-(f.minCutoffZoom-1)),1),x=l.isLODDisabled(!1)?s.a7(60,45,l.pitch):s.a7(30,15,l.pitch),w=l._farZ-l._nearZ,E=i*l.height,R=((1-(L=x))*l.cameraToCenterDistance+L*(l._farZ+E))*p;var L;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[l._nearZ,l._farZ,(R-l._nearZ)/w,(R-E-l._nearZ)/w]}}},Pr={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class jm{constructor(i,l){this.aabb=i,this.lastCascade=l}}class Mt{add(i,l){const p=this.receivers[i.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],l.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],l.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],l.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],l.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],l.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],l.max[2])):this.receivers[i.key]=new jm(l,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,l,p){const x=s.c9.fromPoints(i.points);let w=0;for(const E in this.receivers){const R=this.receivers[E];if(!R||!x.intersectsAabb(R.aabb))continue;R.aabb.min=x.closestPoint(R.aabb.min),R.aabb.max=x.closestPoint(R.aabb.max);const L=R.aabb.getCorners();for(let z=0;z<p.length;z++){let B=!0;for(const G of L){const Z=[G[0]*l,G[1]*l,G[2]];if(s.a6.vec3.transformMat4(Z,Z,p[z].matrix),Z[0]<-1||Z[0]>1||Z[1]<-1||Z[1]>1){B=!1;break}}if(R.lastCascade=z,w=Math.max(w,z),B)break}}return w+1}}class dx{constructor(i){this.painter=i,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Mt,this._depthMode=new qt(i.context.gl.LEQUAL,qt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,i.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),i.tp.registerParameter(Pr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),i.tp.registerParameter(Pr,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),i.tp.registerParameter(Pr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),i.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,l){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!l||!l.properties)return;const x=l.properties.get("shadow-intensity");if(!l.shadowsEnabled()||x<=0||(this._shadowLayerCount=p.style.order.reduce((se,oe)=>{const ae=p.style._mergedLayers[oe];return se+(ae.hasShadowPass()&&!ae.isHidden(i.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const w=p.context,E=Pr.shadowMapResolution,R=Pr.shadowMapResolution;if(this._cascades.length===0||Pr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let se=0;se<Pr.cascadeCount;++se){const oe=p._shadowMapDebug,ae=w.gl,le=w.createFramebuffer(E,R,oe,"texture"),me=new s.T(w,{width:E,height:R,data:null},ae.DEPTH_COMPONENT16);if(le.depthAttachment.set(me.texture),oe){const ye=new s.T(w,{width:E,height:R,data:null},ae.RGBA8);le.colorAttachment.set(ye.texture)}this._cascades.push({framebuffer:le,texture:me,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.bN,scale:0})}}this.shadowDirection=cf(l);let L=0;if(i.elevation){const se=i.elevation,oe=[1e4,-1e4];se.visibleDemTiles.filter(ae=>ae.dem).forEach(ae=>{const le=ae.dem.tree;oe[0]=Math.min(oe[0],le.minimums[0]),oe[1]=Math.max(oe[1],le.maximums[0])}),oe[0]!==1e4&&(L=(oe[1]-oe[0])*se.exaggeration())}const z=1.5*i.cameraToCenterDistance,B=3*z,G=new Float64Array(16);for(let se=0;se<this._cascades.length;++se){const oe=this._cascades[se];let ae=i.height/50,le=1;Pr.cascadeCount===1?le=B:se===0?le=z:(ae=z,le=B);const[me,ye]=df(i,this.shadowDirection,ae,le,Pr.shadowMapResolution,L);oe.scale=i.scale,oe.matrix=me,oe.boundingSphereRadius=ye,s.a6.mat4.invert(G,oe.matrix),oe.frustum=s.bN.fromInvProjectionMatrix(G,1,0,!0),oe.far=le}const Z=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[Z].far,this._cascades[Z].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Pr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Pr.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ni.ShadowMap0,this._uniformValues.u_shadowmap_1=Ni.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Y=p.transform.elevation;for(const se of this._groundShadowTiles){let oe={min:0,max:0};if(Y){const ae=Y.getMinMaxForTile(se);ae&&(oe=ae)}this.addShadowReceiver(se.toUnwrapped(),oe.min,oe.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(i){this._enabled=i}drawShadowPass(i,l){if(!this.enabled)return;const p=this.painter,x=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),x.viewport.set([0,0,Pr.shadowMapResolution,Pr.shadowMapResolution]);for(let w=0;w<this._numCascadesToRender;++w){p.currentShadowCascade=w,x.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),x.clear({color:s.bz.white,depth:1});for(const E of i.order){const R=i._mergedLayers[E];if(!R.hasShadowPass()||R.isHidden(p.transform.zoom))continue;const L=i.getLayerSourceCache(R),z=L?l[L.id]:void 0;(R.type==="model"||z&&z.length)&&p.renderLayer(p,L,R,z)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const i=this.painter,l=i.style,p=i.context,x=l.directionalLight,w=l.ambientLight;if(!x||!w)return;const E=[],R=pa(i,i.longestCutoffRange);R.shouldRenderCutoff&&E.push("RENDER_CUTOFF");const L=uf(l,x,w),z=new qt(p.gl.LEQUAL,qt.ReadOnly,i.depthRangeFor3D);for(const B of this._groundShadowTiles){const G=B.toUnwrapped(),Z=i.isTileAffectedByFog(B),Y=i.getOrCreateProgram("groundShadow",{defines:E,overrideFog:Z});this.setupShadows(G,Y),i.uploadCommonUniforms(p,Y,G,null,R);const se={u_matrix:i.transform.calculateProjMatrix(G),u_ground_shadow_factor:L};Y.draw(i,p.gl.TRIANGLES,z,un.disabled,En.multiply,tn.disabled,se,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,{},i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?En.unblended:En.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){const l=this.painter.transform,p=l.calculatePosMatrix(i,l.worldSize);return s.a6.mat4.multiply(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(i){return s.a6.mat4.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,l,p,x=0){if(!this.enabled)return;const w=this.painter.transform,E=this.painter.context,R=E.gl,L=this._uniformValues,z=new Float64Array(16),B=w.calculatePosMatrix(i,w.worldSize);for(let G=0;G<this._cascades.length;G++)s.a6.mat4.multiply(z,this._cascades[G].matrix,B),L[G===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(z),E.activeTexture.set(R.TEXTURE0+Ni.ShadowMap0+G),this._cascades[G].texture.bind(R.NEAREST,R.CLAMP_TO_EDGE);if(this.useNormalOffset=!!p,this.useNormalOffset){const G=s.c8(i.canonical),Z=2/w.tileSize*s.ab/Pr.shadowMapResolution,Y=Z*this._cascades[0].boundingSphereRadius,se=Z*this._cascades[this._cascades.length-1].boundingSphereRadius,oe=(p==="vector-tile"?1:3)/Math.pow(2,x-i.canonical.z-(1-w.zoom+Math.floor(w.zoom)));L.u_shadow_normal_offset=[G,Y*oe,se*oe],L.u_shadow_bias=[6e-5,.0012,.012]}else L.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(E,L)}setupShadowsFromMatrix(i,l,p=!1){if(!this.enabled)return;const x=this.painter.context,w=x.gl,E=this._uniformValues,R=new Float64Array(16);for(let L=0;L<Pr.cascadeCount;L++)s.a6.mat4.multiply(R,this._cascades[L].matrix,i),E[L===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(R),x.activeTexture.set(w.TEXTURE0+Ni.ShadowMap0+L),this._cascades[L].texture.bind(w.NEAREST,w.CLAMP_TO_EDGE);if(this.useNormalOffset=p,p){const L=Pr.normalOffset;E.u_shadow_normal_offset=[1,L,L],E.u_shadow_bias=[6e-5,.0012,.012]}else E.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(x,E)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,l,p,x){if(x[2]>=0)return{};const w=function(L,z,B){const G=B/(1<<L.canonical.z);return new s.c9([L.canonical.x*G+L.wrap*B,L.canonical.y*G+L.wrap*B,0],[(L.canonical.x+1)*G+L.wrap*B,(L.canonical.y+1)*G+L.wrap*B,z])}(i,l,p).getCorners(),E=l/-x[2];x[0]<0?(s.a6.vec3.add(w[0],w[0],[x[0]*E,0,0]),s.a6.vec3.add(w[3],w[3],[x[0]*E,0,0])):x[0]>0&&(s.a6.vec3.add(w[1],w[1],[x[0]*E,0,0]),s.a6.vec3.add(w[2],w[2],[x[0]*E,0,0])),x[1]<0?(s.a6.vec3.add(w[0],w[0],[0,x[1]*E,0]),s.a6.vec3.add(w[1],w[1],[0,x[1]*E,0])):x[1]>0&&(s.a6.vec3.add(w[2],w[2],[0,x[1]*E,0]),s.a6.vec3.add(w[3],w[3],[0,x[1]*E,0]));const R={};return R.vertices=w,R.planes=[Bc(w[1],w[0],w[4]),Bc(w[2],w[1],w[5]),Bc(w[3],w[2],w[6]),Bc(w[0],w[3],w[7])],R}addShadowReceiver(i,l,p){this._receivers.add(i,s.c9.fromTileIdAndHeight(i,l,p))}getMaxCascadeForTile(i){const l=this._receivers.get(i);return l&&l.lastCascade?l.lastCascade:0}}function Bc(f,i,l){const p=s.a6.vec3.sub([],l,i),x=s.a6.vec3.sub([],f,i),w=s.a6.vec3.cross([],p,x),E=s.a6.vec3.length(w);return E===0?[0,0,1,0]:(s.a6.vec3.scale(w,w,1/E),[w[0],w[1],w[2],-s.a6.vec3.dot(w,i)])}function cf(f){const i=f.properties.get("direction"),l=s.c7(i.x,i.y,i.z);l[2]=s.ap(l[2],0,75);const p=s.ca([l[0],l[1],l[2]]);return s.a6.vec3.fromValues(p.x,p.y,p.z)}function uf(f,i,l){const p=i.properties.get("color"),x=i.properties.get("intensity"),w=i.properties.get("direction"),E=[w.x,w.y,w.z],R=l.properties.get("color"),L=l.properties.get("intensity"),z=Math.max(s.a6.vec3.dot([0,0,1],E),0),B=[0,0,0];s.a6.vec3.scale(B,R.toRenderColor(f.getLut(i.scope)).toArray01Linear().slice(0,3),L);const G=[0,0,0];return s.a6.vec3.scale(G,p.toRenderColor(f.getLut(l.scope)).toArray01Linear().slice(0,3),z*x),s.cb([B[0]>0?B[0]/(B[0]+G[0]):0,B[1]>0?B[1]/(B[1]+G[1]):0,B[2]>0?B[2]/(B[2]+G[2]):0])}function df(f,i,l,p,x,w){const E=f.zoom,R=f.scale,L=f.worldSize,z=1/L,B=f.aspect,G=Math.sqrt(1+B*B)*Math.tan(.5*f.fovX),Z=G*G,Y=p-l,se=p+l;let oe,ae;Z>Y/se?(oe=p,ae=p*G):(oe=.5*se*(1+Z),ae=.5*Math.sqrt(Y*Y+2*(p*p+l*l)*Z+se*se*Z*Z));const le=f.projection.pixelsPerMeter(f.center.lat,L),me=f._camera.getCameraToWorldMercator(),ye=[0,0,-oe*z];s.a6.vec3.transformMat4(ye,ye,me);let fe=ae*z;const be=f._edgeInsets;if(!(be.left===0&&be.top===0&&be.right===0&&be.bottom===0||be.left===be.right&&be.top===be.bottom)){const _t=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?le:1),vt=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,l,p);vt[8]=2*-f.centerOffset.x/f.width,vt[9]=2*f.centerOffset.y/f.height;const at=new Float64Array(16);s.a6.mat4.mul(at,vt,_t);const dt=new Float64Array(16);s.a6.mat4.invert(dt,at);const Wt=s.bN.fromInvProjectionMatrix(dt,L,E,!0);for(const Ct of Wt.points){const Nt=((ve=Ct)[0]/=R,ve[1]/=R,ve[2]=s.bD(ve[2],f._center.lat),ve);fe=Math.max(fe,s.a6.vec3.len(s.a6.vec3.subtract([],ye,Nt)))}}var ve;fe*=x/(x-1);const Pe=Math.acos(i[2]),Te=Math.atan2(-i[0],-i[1]),Me=new Rl;Me.position=ye,Me.setPitchBearing(Pe,Te);const Oe=Me.getWorldToCamera(L,le),ke=fe*L,De=Math.min(f._mercatorZfromZoom(17)*L*-2,-2*ke),Ue=Me.getCameraToClipOrthographic(-ke,ke,-ke,ke,De,(ke+w*le)/i[2]),et=new Float64Array(16);s.a6.mat4.multiply(et,Ue,Oe);const lt=s.a6.vec3.fromValues(Math.floor(1e6*ye[0])/1e6*L,Math.floor(1e6*ye[1])/1e6*L,0),Qe=.5*x,gt=[0,0,0];s.a6.vec3.transformMat4(gt,lt,et),s.a6.vec3.scale(gt,gt,Qe);const $e=[Math.floor(gt[0]),Math.floor(gt[1]),Math.floor(gt[2])],ot=[0,0,0];s.a6.vec3.sub(ot,gt,$e),s.a6.vec3.scale(ot,ot,-1/Qe);const it=new Float64Array(16);return s.a6.mat4.identity(it),s.a6.mat4.translate(it,it,ot),s.a6.mat4.multiply(et,it,et),[et,ke]}class ma extends s.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.numModelsLoading={}}loadModel(i,l){return s.aG(this.requestManager.transformRequest(l,s.R.Model).url).then(p=>{if(!p)return;const x=s.aH(p),w=new s.aI(i,void 0,void 0,x);return w.computeBoundsAndApplyParent(),w}).catch(p=>{if(p&&p.status===404)return null;this.fire(new s.t(new Error(`Could not load model ${i} from ${l}: ${p.message}`)))})}load(i,l){this.models[l]||(this.models[l]={});const p=Object.keys(i);this.numModelsLoading[l]=(this.numModelsLoading[l]||0)+p.length;const x=[];for(const w of p)x.push(this.loadModel(w,i[w]));Promise.allSettled(x).then(w=>{for(let E=0;E<w.length;E++){const{status:R,value:L}=w[E];R==="fulfilled"&&L&&(this.models[l][p[E]]={model:L,numReferences:1})}this.numModelsLoading[l]-=p.length,this.fire(new s.x("data",{dataType:"style"}))}).catch(w=>{this.fire(new s.t(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(const i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,l){return!!this.getModel(i,l)}getModel(i,l){return this.models[l]||(this.models[l]={}),this.models[l][i]?this.models[l][i].model:void 0}addModel(i,l,p){this.models[p]||(this.models[p]={}),this.hasModel(i,p)&&this.models[p][i].numReferences++,this.load({[i]:this.requestManager.normalizeModelURL(l)},p)}addModels(i,l){this.models[l]||(this.models[l]={});const p={};for(const x in i)this.models[l][x]={},p[x]=this.requestManager.normalizeModelURL(i[x]);this.load(p,l)}addModelsFromBucket(i,l){this.models[l]||(this.models[l]={});const p={};for(const x of i)this.hasModel(x,l)?this.models[l][x].numReferences++:p[x]=this.requestManager.normalizeModelURL(x);this.load(p,l)}removeModel(i,l){if(this.models[l]&&this.models[l][i]&&(this.models[l][i].numReferences--,this.models[l][i].numReferences===0)){const p=this.models[l][i].model;delete this.models[l][i],p.destroy()}}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,l){this.models[l]||(this.models[l]={});for(const p in this.models[l])this.models[l][p].model&&this.models[l][p].model.upload(i.context)}}const zm=new s.a0({data:new s.a1(s._.colorTheme.data)}),Ps=(f,i)=>Be(f,i&&i.filter(l=>l.identifier!=="source.canvas")),hf=s.ar(Fn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Vc=s.ar(Fn,["setCenter","setZoom","setBearing","setPitch"]),hx={version:8,layers:[],sources:{}},fx={duration:300,delay:0};class Ms extends s.E{constructor(i,l={}){super(),this.map=i,this.scope=l.scope||"",this.globalId=null,this.fragments=[],this.importDepth=l.importDepth||0,this.importsCache=l.importsCache||new Map,this.resolvedImports=l.resolvedImports||new Set,this.transition=s.l({},fx),this._buildingIndex=new Am(this),this.crossTileSymbolIndex=new sf,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=l.styleChanges||new Fi,this.dispatcher=l.dispatcher?l.dispatcher:new s.cd(s.ce(),this),l.imageManager?this.imageManager=l.imageManager:(this.imageManager=new ws,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=l.glyphManager?l.glyphManager:new s.cf(i._requestManager,l.localFontFamily?s.cg.all:l.localIdeographFontFamily?s.cg.ideographs:s.cg.none,l.localFontFamily||l.localIdeographFontFamily),l.modelManager?this.modelManager=l.modelManager:(this.modelManager=new ma(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=l.configOptions?l.configOptions:new Map,this._configDependentLayers=l.configDependentLayers?l.configDependentLayers:new Set,this._config=l.config,this._initialConfig=l.initialConfig,this.dispatcher.broadcast("setReferrer",s.ch());const p=this;this._rtlTextPluginCallback=Ms.registerForPluginStateChange(x=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(w,E)=>{if(s.ci(w),E&&E.every(R=>R))for(const R in p._sourceCaches){const L=p._sourceCaches[R],z=L.getSource().type;z!=="vector"&&z!=="geojson"||L.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const w=this.getOwnSource(x.sourceId);if(w&&w.vectorLayerIds)for(const E in this._layers){const R=this._layers[E];R.source===w.id&&this._validateLayer(R)}})}load(i){return i?(typeof i=="string"?this.loadURL(i):this.loadJSON(i),this):this}_getGlobalId(i){if(!i)return null;if(typeof i=="string"){if(s.f(i))return i;const l=s.cj(i);if(!l.startsWith("http"))try{return new URL(l,location.href).toString()}catch{return l}return l}return`json://${s.ck(JSON.stringify(i))}`}_diffStyle(i,l,p){this.globalId=this._getGlobalId(i);const x=(w,E)=>{try{E(null,this.setState(w,p))}catch(R){E(R,!1)}};if(typeof i=="string"){const w=this.map._requestManager.normalizeStyleURL(i),E=this.map._requestManager.transformRequest(w,s.R.Style);s.n(E,(R,L)=>{R?this.fire(new s.t(R)):L&&x(L,l)})}else typeof i=="object"&&x(i,l)}loadURL(i,l={}){this.fire(new s.x("dataloading",{dataType:"style"}));const p=typeof l.validate=="boolean"?l.validate:!s.f(i);this.globalId=this._getGlobalId(i),i=this.map._requestManager.normalizeStyleURL(i,l.accessToken),this.resolvedImports.add(i);const x=this.importsCache.get(i);if(x)return this._load(x,p);const w=this.map._requestManager.transformRequest(i,s.R.Style);this._request=s.n(w,(E,R)=>{if(this._request=null,E)this.fire(new s.t(E));else if(R)return this.importsCache.set(i,R),this._load(R,p)})}loadJSON(i,l={}){this.fire(new s.x("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(i),this._request=s.q.frame(()=>{this._request=null,this._load(i,l.validate!==!1)})}loadEmpty(){this.fire(new s.x("dataloading",{dataType:"style"})),this._load(hx,!1)}_loadImports(i,l,p){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const w of i){const E=this._createFragmentStyle(w),R=new Promise(B=>{E.once("style.import.load",B),E.once("error",B)}).then(()=>this.mergeAll());if(x.push(R),this.resolvedImports.has(w.url)){E.loadEmpty();continue}const L=w.data||this.importsCache.get(w.url);L?(E.loadJSON(L,{validate:l}),this._isInternalStyle(L)&&(E.globalId=null)):w.url?E.loadURL(w.url,{validate:l}):E.loadEmpty();const z={style:E,id:w.id,config:w.config};if(p){const B=this.fragments.findIndex(({id:G})=>G===p);this.fragments=this.fragments.slice(0,B).concat(z).concat(this.fragments.slice(B))}else this.fragments.push(z)}return Promise.allSettled(x)}getImportGlobalIds(i=this,l=new Set){for(const p of i.fragments)p.style.globalId&&l.add(p.style.globalId),this.getImportGlobalIds(p.style,l);return[...l.values()]}_createFragmentStyle(i){const l=this.scope?s.av(i.id,this.scope):i.id;let p;const x=this._initialConfig&&this._initialConfig[l];(i.config||x)&&(p=s.l({},i.config,x));const w=new Ms(this.map,{scope:l,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,configDependentLayers:this._configDependentLayers});return w.setEventedParent(this.map,{style:w}),w}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(i){return this.isRootStyle()&&(i.fragment||!!i.schema&&i.fragment!==!1)}_load(i,l){const p=i.schema;if(this._isInternalStyle(i)){const E=s.l({},hx,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(E,l)}if(this.updateConfig(this._config,p),l&&Ps(this,Ts(i)))return;this._loaded=!0,this.stylesheet=s.cl(i);const x=()=>{for(const z in i.sources)this.addSource(z,i.sources[z],{validate:!1,isInitialLoad:!0});i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(i.glyphs,this.scope);const E=Im(this.stylesheet.layers);if(this._order=E.map(z=>z.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const z=this.stylesheet.lights[0];this.light=new Ge(z.properties,z.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ge(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const z of E){const B=s.cq(z,this.scope,this._styleColorTheme.lut,this.options);B.configDependencies.size!==0&&this._configDependentLayers.add(B.fqid),B.setEventedParent(this,{layer:{id:B.id}}),this._layers[B.id]=B,this._serializedLayers[B.id]=B.serialize();const G=this.getOwnLayerSourceCache(B),Z=!!this.directionalLight&&this.directionalLight.shadowsEnabled();G&&B.canCastShadows()&&Z&&(G.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const R=this.stylesheet.terrain;R&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(R,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.x("data",{dataType:"style"}));const L=this.isRootStyle();i.imports?this._loadImports(i.imports,l).then(()=>{this._reloadImports(),this.fire(new s.x(L?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.x(L?"style.load":"style.import.load")))},w=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=w,w){const E=this._evaluateColorThemeData(w);this._loadColorTheme(E).then(()=>{x()}).catch(R=>{s.w(`Couldn't load color theme from the stylesheet: ${R}`),x()})}else this._styleColorTheme.lut=null,x()}isRootStyle(){return this.importDepth===0}mergeAll(){let i,l,p,x,w,E,R,L;const z={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(B=>{if(B.stylesheet){if(B.light!=null&&(i=B.light),B.stylesheet.lights)for(const G of B.stylesheet.lights)G.type==="ambient"&&B.ambientLight!=null&&(l=B.ambientLight),G.type==="directional"&&B.directionalLight!=null&&(p=B.directionalLight);x=this._prioritizeTerrain(x,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(w=B.fog),B.stylesheet.camera!=null&&(L=B.stylesheet.camera),B.stylesheet.projection!=null&&(E=B.stylesheet.projection),B.stylesheet.transition!=null&&(R=B.stylesheet.transition),z[B.scope]=B._styleColorTheme}}),this.light=i,this.ambientLight=l,this.directionalLight=p,this.fog=w,this._styleColorThemeForScope=z,x===null?delete this.terrain:this.terrain=x,this.camera=L||{"camera-projection":"perspective"},this.projection=E||{name:"mercator"},this.transition=s.l({},fx,R),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(i){const l=p=>{for(const x of p.fragments)l(x.style);i(p)};l(this)}_prioritizeTerrain(i,l,p){const x=i&&i.drapeRenderMode===0;return p===null?l&&l.drapeRenderMode===0?l:x?i:null:l!=null&&(!i||x||l&&l.drapeRenderMode===1)?l:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(l=>{i=this._prioritizeTerrain(i,l.terrain,l.stylesheet.terrain)}),i===null?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle(l=>{l.stylesheet.projection!=null&&(i=l.stylesheet.projection)}),this.projection=i||{name:"mercator"}}mergeSources(){const i={},l={},p={};this.forEachFragmentStyle(x=>{for(const w in x._sourceCaches){const E=s.av(w,x.scope);i[E]=x._sourceCaches[w]}for(const w in x._otherSourceCaches){const E=s.av(w,x.scope);l[E]=x._otherSourceCaches[w]}for(const w in x._symbolSourceCaches){const E=s.av(w,x.scope);p[E]=x._symbolSourceCaches[w]}}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=l,this._mergedSymbolSourceCaches=p}mergeLayers(){const i={},l=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(w=>{for(const E of w._order){const R=w._layers[E];if(R.type==="slot"){const L=s.cm(E);if(i[L])continue;i[L]=[]}R.slot&&i[R.slot]?i[R.slot].push(R):l.push(R)}}),this._mergedOrder=[];const x=(w=[])=>{for(const E of w)if(E.type==="slot"){const R=s.cm(E.id);i[R]&&x(i[R]),this._mergedSlots.push(R)}else{const R=s.av(E.id,E.scope);this._mergedOrder.push(R),p[R]=E,E.is3D()&&(this._has3DLayers=!0),E.type==="circle"&&(this._hasCircleLayers=!0),E.type==="symbol"&&(this._hasSymbolLayers=!0),E.type==="clip"&&(this._clipLayerPresent=!0)}};x(l),this._mergedOrder.sort((w,E)=>{const R=p[w],L=p[E];return R.hasInitialOcclusionOpacityProperties?L.is3D()?1:0:R.is3D()&&L.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=s.l({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(i){return i.data?function(l,p,x){const w=s.l({},p);for(const R of Object.keys(s._.colorTheme))w[R]===void 0&&(w[R]=s._.colorTheme[R].default);const E=new s.$(zm,l,new Map(x));return E.setTransitionOrValue(w,x),E.untransitioned().possiblyEvaluate(new s.a3(0))}(this.scope,i,this.options).get("data"):null}_loadColorTheme(i){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const l=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,x)=>{const w="data:image/png;base64,";if(!i||i.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let E=i;E.startsWith(w)||(E=w+E);const R="mapbox-reserved-lut",L=new Image;L.src=E,L.onerror=()=>{this._styleColorTheme.lutLoading=!1,x(new Error("Failed to load image data"))},L.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==l)return void p();this._styleColorTheme.lutLoading=!1;const{width:z,height:B,data:G}=s.q.getImageData(L);if(B>32)return void x(new Error("The height of the image must be less than or equal to 32 pixels."));if(z!==B*B)return void x(new Error("The width of the image must be equal to the height squared."));this.getImage(R)&&this.removeImage(R),this.addImage(R,{data:new s.r({width:z,height:B},G),pixelRatio:1,sdf:!1,version:0});const Z=this.imageManager.getImage(R,this.scope);Z?(this._styleColorTheme.lut={image:Z.data,data:i},p()):x(new Error("Missing LUT image."))}})}getLut(i){const l=this._styleColorThemeForScope[i];return l?l.lut:null}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=function(l,p,x){let w,E,R;const L=s.q.devicePixelRatio>1?"@2x":"";let z=s.n(p.transformRequest(p.normalizeSpriteURL(l,L,".json"),s.R.SpriteJSON),(Z,Y)=>{z=null,R||(R=Z,w=Y,G())}),B=s.o(p.transformRequest(p.normalizeSpriteURL(l,L,".png"),s.R.SpriteImage),(Z,Y)=>{B=null,R||(R=Z,E=Y,G())});function G(){if(R)x(R);else if(w&&E){const Z=s.q.getImageData(E),Y={};for(const se in w){const{width:oe,height:ae,x:le,y:me,sdf:ye,pixelRatio:fe,stretchX:be,stretchY:ve,content:Pe}=w[se],Te=new s.r({width:oe,height:ae});s.r.copy(Z,Te,{x:le,y:me},{x:0,y:0},{width:oe,height:ae},null),Y[se]={data:Te,pixelRatio:fe,sdf:ye,stretchX:be,stretchY:ve,content:Pe}}x(null,Y)}}return{cancel(){z&&(z.cancel(),z=null),B&&(B.cancel(),B=null)}}}(i,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new s.t(l));else if(p)for(const x in p)this.imageManager.addImage(x,this.scope,p[x]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.x("data",{dataType:"style"}))})}_validateLayer(i){const l=this.getOwnSource(i.source);if(!l)return;const p=i.sourceLayer;p&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(p)===-1)&&this.fire(new s.t(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((i,l)=>{const p=this.fragments[l];return p&&p.style&&(i.data=p.style.serialize()),i})}_serializeSources(){const i={};for(const l in this._sourceCaches){const p=this._sourceCaches[l].getSource();i[p.id]||(i[p.id]=p.serialize())}return i}_serializeLayers(i){const l=[];for(const p of i){const x=this._layers[p];x&&x.type!=="custom"&&l.push(x.serialize())}return l}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&i.isDraped(this.getLayerSourceCache(i))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){const l=this.getOwnLayer(i);if(l)return l;this.fire(new s.t(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){const l=this.getOwnSource(i);if(l)return l;this.fire(new s.t(new Error(`The source '${i}' does not exist in the map's style.`)))}precompilePrograms(i,l){const p=this.map.painter;if(p)for(let x=i.minzoom||0;x<(i.maxzoom||25.5);x++){const w=i.getProgramIds();if(w)for(const E of w){const R=i.getDefaultProgramParams(E,l.zoom,this._styleColorTheme.lut);R&&(p.style=this,this.fog&&(p._fogVisible=!0,R.overrideFog=!0,p.getOrCreateProgram(E,R)),p._fogVisible=!1,R.overrideFog=!1,p.getOrCreateProgram(E,R),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(R.overrideRtt=!0,p.getOrCreateProgram(E,R)))}}}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);const l=this.calculateLightsBrightness();i.brightness=l||0,l!==this._brightness&&(this._brightness=l,this.dispatcher.broadcast("setBrightness",l));const p=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const E=this._changes.getLayerUpdatesByScope();for(const R in E){const{updatedIds:L,removedIds:z}=E[R];(L||z)&&(this._updateWorkerLayers(R,L,z),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._changes.reset()}const w={};for(const E in this._mergedSourceCaches){const R=this._mergedSourceCaches[E];w[E]=R.used,R.used=!1,R.tileCoverLift=0}for(const E of this._mergedOrder){const R=this._mergedLayers[E];if(R.recalculate(i,this._availableImages),!R.isHidden(i.zoom)){const L=this.getLayerSourceCache(R);L&&(L.used=!0,L.tileCoverLift=Math.max(L.tileCoverLift,R.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(R,i)}):this.precompilePrograms(R,i))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();for(const E in w){const R=this._mergedSourceCaches[E];w[E]!==R.used&&R.getSource().fire(new s.x("data",{sourceDataType:"visibility",dataType:"source",sourceId:R.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),p&&this.fire(new s.x("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=this._changes.getUpdatedImages();if(i.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],i);this._changes.resetUpdatedImages()}}_updateWorkerLayers(i,l,p){const x=this.getFragmentStyle(i);x&&this.dispatcher.broadcast("updateLayers",{layers:l?x._serializeLayers(l):[],scope:i,removedIds:p||[],options:x.options})}setState(i,l){if(this._checkLoaded(),Ps(this,Ts(i)))return!1;(i=s.cl(i)).layers=Im(i.layers);const p=function(E,R){if(!E)return[{command:Fn.setStyle,args:[R]}];let L=[];try{if(!s.bh(E.version,R.version))return[{command:Fn.setStyle,args:[R]}];if(s.bh(E.center,R.center)||L.push({command:Fn.setCenter,args:[R.center]}),s.bh(E.zoom,R.zoom)||L.push({command:Fn.setZoom,args:[R.zoom]}),s.bh(E.bearing,R.bearing)||L.push({command:Fn.setBearing,args:[R.bearing]}),s.bh(E.pitch,R.pitch)||L.push({command:Fn.setPitch,args:[R.pitch]}),s.bh(E.sprite,R.sprite)||L.push({command:Fn.setSprite,args:[R.sprite]}),s.bh(E.glyphs,R.glyphs)||L.push({command:Fn.setGlyphs,args:[R.glyphs]}),s.bh(E.imports,R.imports)||function(Y=[],se=[],oe){se=se||[];const ae=(Y=Y||[]).map(Ml),le=se.map(Ml),me=Y.reduce(Ac,{}),ye=se.reduce(Ac,{}),fe=ae.slice();let be,ve,Pe,Te;for(be=0,ve=0;be<ae.length;be++)Pe=ae[be],ye.hasOwnProperty(Pe)?ve++:(oe.push({command:Fn.removeImport,args:[Pe]}),fe.splice(fe.indexOf(Pe,ve),1));for(be=0,ve=0;be<le.length;be++)Pe=le[le.length-1-be],fe[fe.length-1-be]!==Pe&&(me.hasOwnProperty(Pe)?(oe.push({command:Fn.removeImport,args:[Pe]}),fe.splice(fe.lastIndexOf(Pe,fe.length-ve),1)):ve++,Te=fe[fe.length-be],oe.push({command:Fn.addImport,args:[ye[Pe],Te]}),fe.splice(fe.length-be,0,Pe));for(const Me of se){const Oe=me[Me.id];Oe&&!s.bh(Oe,Me)&&oe.push({command:Fn.updateImport,args:[Me.id,Me]})}}(E.imports,R.imports,L),s.bh(E.transition,R.transition)||L.push({command:Fn.setTransition,args:[R.transition]}),s.bh(E.light,R.light)||L.push({command:Fn.setLight,args:[R.light]}),s.bh(E.fog,R.fog)||L.push({command:Fn.setFog,args:[R.fog]}),s.bh(E.projection,R.projection)||L.push({command:Fn.setProjection,args:[R.projection]}),s.bh(E.lights,R.lights)||L.push({command:Fn.setLights,args:[R.lights]}),s.bh(E.camera,R.camera)||L.push({command:Fn.setCamera,args:[R.camera]}),!s.bh(E["color-theme"],R["color-theme"]))return[{command:Fn.setStyle,args:[R]}];const z={},B=[];(function(Y,se,oe,ae){let le;for(le in se=se||{},Y=Y||{})Y.hasOwnProperty(le)&&(se.hasOwnProperty(le)||Yn(le,oe,ae));for(le in se){if(!se.hasOwnProperty(le))continue;const me=se[le];Y.hasOwnProperty(le)?s.bh(Y[le],me)||(Y[le].type==="geojson"&&me.type==="geojson"&&Xt(Y,se,le)?oe.push({command:Fn.setGeoJSONSourceData,args:[le,me.data]}):nw(le,se,oe,ae)):Dm(le,se,oe)}})(E.sources,R.sources,B,z);const G=[];E.layers&&E.layers.forEach(Y=>{Y.source&&z[Y.source]?L.push({command:Fn.removeLayer,args:[Y.id]}):G.push(Y)});let Z=E.terrain;Z&&z[Z.source]&&(L.push({command:Fn.setTerrain,args:[void 0]}),Z=void 0),L=L.concat(B),s.bh(Z,R.terrain)||L.push({command:Fn.setTerrain,args:[R.terrain]}),function(Y,se,oe){se=se||[];const ae=(Y=Y||[]).map(Ml),le=se.map(Ml),me=Y.reduce(Ac,{}),ye=se.reduce(Ac,{}),fe=ae.slice(),be=Object.create(null);let ve,Pe,Te,Me,Oe,ke,De;for(ve=0,Pe=0;ve<ae.length;ve++)Te=ae[ve],ye.hasOwnProperty(Te)?Pe++:(oe.push({command:Fn.removeLayer,args:[Te]}),fe.splice(fe.indexOf(Te,Pe),1));for(ve=0,Pe=0;ve<le.length;ve++)Te=le[le.length-1-ve],fe[fe.length-1-ve]!==Te&&(me.hasOwnProperty(Te)?(oe.push({command:Fn.removeLayer,args:[Te]}),fe.splice(fe.lastIndexOf(Te,fe.length-Pe),1)):Pe++,ke=fe[fe.length-ve],oe.push({command:Fn.addLayer,args:[ye[Te],ke]}),fe.splice(fe.length-ve,0,Te),be[Te]=!0);for(ve=0;ve<le.length;ve++)if(Te=le[ve],Me=me[Te],Oe=ye[Te],!be[Te]&&!s.bh(Me,Oe))if(s.bh(Me.source,Oe.source)&&s.bh(Me["source-layer"],Oe["source-layer"])&&s.bh(Me.type,Oe.type)){for(De in Sd(Me.layout,Oe.layout,oe,Te,null,Fn.setLayoutProperty),Sd(Me.paint,Oe.paint,oe,Te,null,Fn.setPaintProperty),s.bh(Me.slot,Oe.slot)||oe.push({command:Fn.setSlot,args:[Te,Oe.slot]}),s.bh(Me.filter,Oe.filter)||oe.push({command:Fn.setFilter,args:[Te,Oe.filter]}),s.bh(Me.minzoom,Oe.minzoom)&&s.bh(Me.maxzoom,Oe.maxzoom)||oe.push({command:Fn.setLayerZoomRange,args:[Te,Oe.minzoom,Oe.maxzoom]}),Me)Me.hasOwnProperty(De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&De!=="slot"&&(De.indexOf("paint.")===0?Sd(Me[De],Oe[De],oe,Te,De.slice(6),Fn.setPaintProperty):s.bh(Me[De],Oe[De])||oe.push({command:Fn.setLayerProperty,args:[Te,De,Oe[De]]}));for(De in Oe)Oe.hasOwnProperty(De)&&!Me.hasOwnProperty(De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&De!=="slot"&&(De.indexOf("paint.")===0?Sd(Me[De],Oe[De],oe,Te,De.slice(6),Fn.setPaintProperty):s.bh(Me[De],Oe[De])||oe.push({command:Fn.setLayerProperty,args:[Te,De,Oe[De]]}))}else oe.push({command:Fn.removeLayer,args:[Te]}),ke=fe[fe.lastIndexOf(Te)+1],oe.push({command:Fn.addLayer,args:[Oe,ke]})}(G,R.layers,L)}catch(z){console.warn("Unable to compute style diff:",z),L=[{command:Fn.setStyle,args:[R]}]}return L}(this.serialize(),i).filter(E=>!(E.command in Vc));if(p.length===0)return!1;const x=p.filter(E=>!(E.command in hf));if(x.length>0)throw new Error(`Unimplemented: ${x.map(E=>E.command).join(", ")}.`);const w=[];return p.forEach(E=>{w.push(this[E.command].apply(this,E.args))}),l&&Promise.all(w).then(l),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(i,l){return this.getImage(i)?this.fire(new s.t(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,this.scope,l),this._afterImageUpdated(i),this)}updateImage(i,l){this.imageManager.updateImage(i,this.scope,l)}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._afterImageUpdated(i),this):this.fire(new s.t(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(i),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new s.x("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(i,l,p={}){return this._checkLoaded(),this._validate(Re,`models.${i}`,l,null,p)||(this.modelManager.addModel(i,l,this.scope),this._changes.setDirty()),this}hasModel(i){return this.modelManager.hasModel(i,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope),this):this.fire(new s.t(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,l,p={}){if(this._checkLoaded(),this.getOwnSource(i)!==void 0)throw new Error(`There is already a source with ID "${i}".`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(Cl,`sources.${i}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const x=Ec(i,l,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));const w=E=>{const R=(E?"symbol:":"other:")+x.id,L=s.av(R,this.scope),z=this._sourceCaches[R]=new ls(L,x,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=z,z.onAdd(this.map)};w(!1),l.type!=="vector"&&l.type!=="geojson"||w(!0),x.onAdd&&x.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();const l=this.getOwnSource(i);if(!l)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===i)return this.fire(new s.t(new Error(`Source "${i}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new s.t(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const p=this.getOwnSourceCaches(i);for(const x of p){const w=s.cm(x.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(x.id),x.fire(new s.x("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,l){this._checkLoaded(),this.getOwnSource(i).setData(l),this._changes.setDirty()}getOwnSource(i){const l=this.getOwnSourceCache(i);return l&&l.getSource()}getOwnSources(){const i=[];for(const l in this._otherSourceCaches){const p=this.getOwnSourceCache(l);p&&i.push(p.getSource())}return i}areTilesLoaded(){const i=this._mergedSourceCaches;for(const l in i){const p=i[l]._tiles;for(const x in p){const w=p[x];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;const l=this._getTransitionParameters();for(const x of i){if(this._validate(Sc,"lights",x))return;switch(x.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(x),w.updateTransitions(l)}else this.ambientLight=new rr(x,gn||(gn=new s.a0({color:new s.a1(s._.properties_light_ambient.color),intensity:new s.a1(s._.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(x),w.updateTransitions(l)}else this.directionalLight=new rr(x,tr||(tr=new s.a0({direction:new s.ad(s._.properties_light_directional.direction),color:new s.a1(s._.properties_light_directional.color),intensity:new s.a1(s._.properties_light_directional.intensity),"cast-shadows":new s.a1(s._.properties_light_directional["cast-shadows"]),"shadow-intensity":new s.a1(s._.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const p=new s.a3(this.z||0,l);this.ambientLight&&this.ambientLight.recalculate(p),this.directionalLight&&this.directionalLight.recalculate(p),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const i=this.directionalLight,l=this.ambientLight;if(!i||!l)return;const p=G=>.2126*(G[0]<=.03928?G[0]/12.92:Math.pow((G[0]+.055)/1.055,2.4))+.7152*(G[1]<=.03928?G[1]/12.92:Math.pow((G[1]+.055)/1.055,2.4))+.0722*(G[2]<=.03928?G[2]/12.92:Math.pow((G[2]+.055)/1.055,2.4)),x=i.properties.get("color").toRenderColor(null).toArray01(),w=i.properties.get("intensity"),E=i.properties.get("direction"),R=1-s.c7(E.x,E.y,E.z)[2]/90,L=p(x)*w*R,z=l.properties.get("color").toRenderColor(null).toArray01(),B=l.properties.get("intensity");return(L+p(z)*B)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(!i)return this;if(s.cn(i)){const l=s.co(i),p=this.fragments.find(({id:w})=>w===l);if(!p)throw new Error(`Style import not found: ${i}`);const x=s.cm(i);return p.style.getFragmentStyle(x)}{const l=this.fragments.find(({id:p})=>p===i);if(!l)throw new Error(`Style import not found: ${i}`);return l.style}}getConfigProperty(i,l){const p=this.getFragmentStyle(i);if(!p)return null;const x=s.av(l,p.scope),w=p.options.get(x),E=w?w.value||w.default:null;return E?E.serialize():null}setConfigProperty(i,l,p){const x=this.getFragmentStyle(i);if(!x)return;const w=x.stylesheet.schema;if(!w||!w[l])return;const E=s.M(p);if(E.result!=="success")return void Ps(this,E.value);const R=E.value.expression,L=s.av(l,x.scope),z=x.options.get(L);if(!z)return;let B;const{minValue:G,maxValue:Z,stepValue:Y,type:se,values:oe}=w[l],ae=s.M(w[l].default);ae.result==="success"&&(B=ae.value.expression),B?(this.options.set(L,{...z,value:R,default:B,minValue:G,maxValue:Z,stepValue:Y,type:se,values:oe}),this.updateConfigDependencies(l)):this.fire(new s.t(new Error(`No schema defined for the config option "${l}" in the "${i}" fragment.`)))}getConfig(i){const l=this.getFragmentStyle(i);if(!l)return null;const p=l.stylesheet.schema;if(!p)return null;const x={};for(const w in p){const E=s.av(w,l.scope),R=l.options.get(E),L=R?R.value||R.default:null;x[w]=L?L.serialize():null}return x}setConfig(i,l){const p=this.getFragmentStyle(i);p&&(p.updateConfig(l,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(i){const l=this.getFragmentStyle(i);return l?l.stylesheet.schema:null}setSchema(i,l){const p=this.getFragmentStyle(i);p&&(p.stylesheet.schema=l,p.updateConfig(p._config,l),this.updateConfigDependencies())}updateConfig(i,l){if(this._config=i,i||l)if(l)for(const p in l){let x,w;const E=s.M(l[p].default);if(E.result==="success"&&(x=E.value.expression),i&&i[p]!==void 0){const Z=s.M(i[p]);Z.result==="success"&&(w=Z.value.expression)}const{minValue:R,maxValue:L,stepValue:z,type:B,values:G}=l[p];if(x){const Z=s.av(p,this.scope);this.options.set(Z,{default:x,value:w,minValue:R,maxValue:L,stepValue:z,type:B,values:G})}else this.fire(new s.t(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new s.t(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(i){for(const l of this._configDependentLayers){const p=this.getLayer(l);if(p){if(i&&!p.configDependencies.has(i))continue;p.possiblyEvaluateVisibility(),this._updateLayer(p)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(l=>{if(l._styleColorTheme.colorTheme){const p=l._evaluateColorThemeData(l._styleColorTheme.colorTheme);(!l._styleColorTheme.lut&&p!==""||l._styleColorTheme.lut&&p!==l._styleColorTheme.lut.data)&&l.setColorTheme(l._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(i,l,p={}){this._checkLoaded();const x=i.id;if(this._layers[x])return void this.fire(new s.t(new Error(`Layer with id "${x}" already exists on this map`)));let w;if(i.type==="custom"){if(Ps(this,s.cp(i)))return;w=s.cq(i,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof i.source=="object"&&(this.addSource(x,i.source),i=s.cl(i),i=s.l(i,{source:x})),this._validate(Ke,`layers.${x}`,i,{arrayIndex:-1},p))return;w=s.cq(i,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[w.id]=w.serialize()}w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid);let E=this._order.length;if(l){const B=this._order.indexOf(l);if(B===-1)return void this.fire(new s.t(new Error(`Layer with id "${l}" does not exist on this map.`)));w.slot===this._layers[l].slot?E=B:s.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(E,0,x),this._layerOrderChanged=!0,this._layers[x]=w;const R=this.getOwnLayerSourceCache(w),L=!!this.directionalLight&&this.directionalLight.shadowsEnabled();R&&w.canCastShadows()&&L&&(R.castsShadows=!0);const z=this._changes.getRemovedLayer(w);if(z&&w.source&&R&&w.type!=="custom"){this._changes.discardLayerRemoval(w);const B=s.av(w.source,w.scope);z.type!==w.type?this._changes.updateSourceCache(B,"clear"):(this._changes.updateSourceCache(B,"reload"),R.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(i,l){this._checkLoaded();const p=this._checkLayer(i);if(!p||i===l)return;const x=this._order.indexOf(i);this._order.splice(x,1);let w=this._order.length;if(l){const E=this._order.indexOf(l);if(E===-1)return void this.fire(new s.t(new Error(`Layer with id "${l}" does not exist on this map.`)));p.slot===this._layers[l].slot?w=E:s.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(i){this._checkLoaded();const l=this._checkLayer(i);if(!l)return;l.setEventedParent(null);const p=this._order.indexOf(i);this._order.splice(p,1),delete this._layers[i],delete this._serializedLayers[i],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(l.fqid),this._changes.removeLayer(l);const x=this.getOwnLayerSourceCache(l);if(x&&x.castsShadows){let w=!1;for(const E in this._layers)if(this._layers[E].source===l.source&&this._layers[E].canCastShadows()){w=!0;break}x.castsShadows=w}l.onRemove&&l.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(const l in this._layers)if(this._layers[l].type===i)return!0;return!1}setLayerZoomRange(i,l,p){this._checkLoaded();const x=this._checkLayer(i);x&&(x.minzoom===l&&x.maxzoom===p||(l!=null&&(x.minzoom=l),p!=null&&(x.maxzoom=p),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(i,l){this._checkLoaded();const p=this._checkLayer(i);p&&p.slot!==l&&(p.slot=l,this._updateLayer(p))}setFilter(i,l,p={}){this._checkLoaded();const x=this._checkLayer(i);if(x&&!s.bh(x.filter,l))return l==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(ce,`layers.${x.id}.filter`,l,{layerType:x.type},p)||(x.filter=s.cl(l),this._updateLayer(x)))}getFilter(i){const l=this._checkLayer(i);if(l)return s.cl(l.filter)}setLayoutProperty(i,l,p,x={}){this._checkLoaded();const w=this._checkLayer(i);if(w&&!s.bh(w.getLayoutProperty(l),p)){if(p!=null&&(!x||x.validate!==!1)&&Ps(w,we.call(Ts,{key:`layers.${i}.layout.${l}`,layerType:w.type,objectKey:l,value:p,styleSpec:s._,style:{glyphs:!0,sprite:!0}})))return;w.setLayoutProperty(l,p),w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),this._updateLayer(w)}}getLayoutProperty(i,l){const p=this._checkLayer(i);if(p)return p.getLayoutProperty(l)}setPaintProperty(i,l,p,x={}){this._checkLoaded();const w=this._checkLayer(i);if(!w||s.bh(w.getPaintProperty(l),p)||p!=null&&(!x||x.validate!==!1)&&Ps(w,de.call(Ts,{key:`layers.${i}.paint.${l}`,layerType:w.type,objectKey:l,value:p,styleSpec:s._})))return;const E=w.setPaintProperty(l,p);w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),E&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(i,l){const p=this._checkLayer(i);if(p)return p.getPaintProperty(l)}setFeatureState(i,l){this._checkLoaded();const p=i.source,x=i.sourceLayer,w=this._checkSource(p);if(!w)return;const E=w.type;if(E==="geojson"&&x)return void this.fire(new s.t(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!x)return void this.fire(new s.t(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new s.t(new Error("The feature id parameter must be provided.")));const R=this.getOwnSourceCaches(p);for(const L of R)L.setFeatureState(x,i.id,l)}removeFeatureState(i,l){this._checkLoaded();const p=i.source,x=this._checkSource(p);if(!x)return;const w=x.type,E=w==="vector"?i.sourceLayer:void 0;if(w==="vector"&&!E)return void this.fire(new s.t(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new s.t(new Error("A feature id is required to remove its specific state property.")));const R=this.getOwnSourceCaches(p);for(const L of R)L.removeFeatureState(E,i.id,l)}getFeatureState(i){this._checkLoaded();const l=i.source,p=i.sourceLayer,x=this._checkSource(l);if(x){if(x.type!=="vector"||p)return i.id===void 0&&this.fire(new s.t(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(l)[0].getFeatureState(p,i.id);this.fire(new s.t(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=s.l({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return s.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const i=this.getTerrain(),l=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return s.cr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:l,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateLayer(i){this._changes.updateLayer(i);const l=this.getLayerSourceCache(i),p=s.av(i.source,i.scope),x=this._changes.getUpdatedSourceCaches();i.source&&!x[p]&&l&&l.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),l.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const l=R=>this._mergedLayers[R].is3D(),p=this.order,x={},w=[];for(let R=p.length-1;R>=0;R--){const L=p[R];if(l(L)){x[L]=R;for(const z of i){const B=z[L];if(B)for(const G of B)w.push(G)}}}w.sort((R,L)=>L.intersectionZ-R.intersectionZ);const E=[];for(let R=p.length-1;R>=0;R--){const L=p[R];if(l(L))for(let z=w.length-1;z>=0;z--){const B=w[z].feature;if(B.layer&&x[B.layer.id]<R)break;E.push(B),w.pop()}else for(const z of i){const B=z[L];if(B)for(const G of B)E.push(G.feature)}}return E}queryRenderedFeatures(i,l,p){l&&l.filter&&this._validate(ce,"queryRenderedFeatures.filter",l.filter,null,l),l.scope=this.scope,l.availableImages=this._availableImages,l.serializedLayers=this._serializedLayers;const x={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new s.t(new Error("parameters.layers must be an Array."))),[];for(const z of l.layers){const B=this._mergedLayers[z];if(!B)return this.fire(new s.t(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];x[B.source]=!0}}const w=[],E=l.serializedLayers||{},R=l&&l.layers?l.layers.some(z=>{const B=this.getLayer(z);return B&&B.is3D()}):this.has3DLayers(),L=Er.createFromScreenPoints(i,p);for(const z in this._mergedSourceCaches){const B=this._mergedSourceCaches[z].getSource();if(!B||B.scope!==l.scope)continue;const G=this._mergedSourceCaches[z].getSource().id;l.layers&&!x[G]||w.push(Cm(this._mergedSourceCaches[z],this._mergedLayers,E,L,l,p,R,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(z,B,G,Z,Y,se,oe){const ae={},le=se.queryRenderedSymbols(Z),me=[];for(const ye of Object.keys(le).map(Number))me.push(oe[ye]);me.sort(Cc);for(const ye of me){const fe=ye.featureIndex.lookupSymbolFeatures(le[ye.bucketInstanceId],B,ye.bucketIndex,ye.sourceLayerIndex,Y.filter,Y.layers,Y.availableImages,z);for(const be in fe){const ve=ae[be]=ae[be]||[],Pe=fe[be];Pe.sort((Te,Me)=>{const Oe=ye.featureSortOrder;if(Oe){const ke=Oe.indexOf(Te.featureIndex);return Oe.indexOf(Me.featureIndex)-ke}return Me.featureIndex-Te.featureIndex});for(const Te of Pe)ve.push(Te)}}for(const ye in ae)ae[ye].forEach(fe=>{const be=fe.feature,ve=G(z[ye]);if(!ve)return;const Pe=ve.getFeatureState(be.layer["source-layer"],be.id);be.source=be.layer.source,be.layer["source-layer"]&&(be.sourceLayer=be.layer["source-layer"]),be.state=Pe});return ae}(this._mergedLayers,E,this.getLayerSourceCache.bind(this),L.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(i,l){l&&l.filter&&this._validate(ce,"querySourceFeatures.filter",l.filter,null,l);const p=this.getOwnSourceCaches(i);let x=[];for(const w of p)x=x.concat(vd(w,l));return x}addSourceType(i,l,p){return Ms.getSourceType(i)?p(new Error(`A source type called "${i}" already exists.`)):(Ms.setSourceType(i,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:l.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,l,p={}){this._checkLoaded();const x=this.light.getLight();let w=!1;for(const R in i)if(!s.bh(i[R],x[R])){w=!0;break}if(!w)return;const E=this._getTransitionParameters();this.light.setLight(i,l,p),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(i,l=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),l===0&&delete this.terrain,i===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=i;const x=i.source==null;if(l===1){if(this.disableElevatedTerrain)return;if(typeof p.source=="object"){const R="terrain-dem-src";this.addSource(R,p.source),p=s.cl(p),p=s.l(p,{source:R})}const w=s.l({},p),E={};if(this.terrain&&x){w.source=this.terrain.get().source;const R=this.terrain?this.getFragmentStyle(this.terrain.scope):null;R&&(E.style=R.serialize())}if(this._validate(_d,"terrain",w,E))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&l!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,l),this.fire(new s.x("data",{dataType:"style"}))}else{const w=this.terrain,E=w.get();for(const R of Object.keys(s._.terrain))!p.hasOwnProperty(R)&&s._.terrain[R].default&&(p[R]=s._.terrain[R].default);for(const R in i)if(!s.bh(i[R],E[R])){w.set(i,this.options),this.stylesheet.terrain=i;const L=this._getTransitionParameters({duration:0});w.updateTransitions(L),this.fire(new s.x("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const l=this.fog=new Xn(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog;if(!s.bh(l.get(),i)){l.set(i,this.options),this.stylesheet.fog=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}}else this._createFog(i);this._markersNeedUpdate=!0}setColorTheme(i){this._checkLoaded();const l=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()};if(this._styleColorTheme.colorTheme=i,!i)return this._styleColorTheme.lut=null,void l();const p=this._evaluateColorThemeData(i);this._loadColorTheme(p).then(()=>{this.fire(new s.x("colorthemeset")),l()}).catch(x=>{s.w(`Couldn't set color theme: ${x}`)})}_getTransitionParameters(i){return{now:s.q.now(),transition:s.l(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;const i=[],l=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?i.push(p):l.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...l)}_createTerrain(i,l){const p=this.terrain=new st(i,l,this.scope,this.options);l===1&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});p.updateTransitions(x)}_force3DLayerUpdate(){for(const i in this._layers){const l=this._layers[i];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const l=this._layers[i];l.type==="symbol"&&this._updateLayer(l)}}_validate(i,l,p,x,w={}){if(w&&w.validate===!1)return!1;const E=s.l({},this.serialize());return Ps(this,i.call(Ts,s.l({key:l,style:E,value:p,styleSpec:s._},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.cs.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(i){const l=this.getSourceCaches(i);for(const p of l)p.clearTiles()}clearSources(){for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}reloadSource(i){const l=this.getSourceCaches(i);for(const p of l)p.resume(),p.reload()}reloadSources(){for(const i of this.getSources())i.reload&&i.reload()}updateSources(i){let l;this.directionalLight&&(l=cf(this.directionalLight));for(const p in this._mergedSourceCaches)this._mergedSourceCaches[p].update(i,void 0,void 0,l)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const l=this._sourceCaches[i];l.resume(),l.reload()}}_updatePlacement(i,l,p,x,w,E,R=!1){let L=!1,z=!1;const B={},G={};for(const Z of this._mergedOrder){const Y=this._mergedLayers[Z];if(Y.type!=="symbol")continue;const se=s.av(Y.source,Y.scope);let oe=B[se];if(!oe){const le=this.getLayerSourceCache(Y);if(!le)continue;const me=le.getRenderableIds(!0).map(ye=>le.getTileByID(ye));G[se]=me.slice(),oe=B[se]=me.sort((ye,fe)=>fe.tileID.overscaledZ-ye.tileID.overscaledZ||(ye.tileID.isLessThan(fe.tileID)?-1:1))}const ae=this.crossTileSymbolIndex.addLayer(Y,oe,l.center.lng,l.projection);L=L||ae}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),R=R||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new s.x("neworder")),(R||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.q.now(),l.zoom))&&(this.pauseablePlacement=new Td(l,this._mergedOrder,R,p,x,w,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,B,G),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.q.now()),z=!0),L&&this.pauseablePlacement.placement.setStale()),z||L){this._buildingIndex.onNewFrame(l.zoom);for(let Z=0;Z<this._mergedOrder.length;Z++){const Y=this._mergedLayers[this._mergedOrder[Z]];if(Y.type!=="symbol")continue;const se=this.isLayerClipped(Y);this.placement.updateLayerOpacities(Y,B[s.av(Y.source,Y.scope)],Z,se?E:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.q.now())}}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,l){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:w})=>w===i.id)!==-1)return void this.fire(new s.t(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!l)return p.push(i),this._loadImports([i],!0);const x=p.findIndex(({id:w})=>w===l);return x===-1&&this.fire(new s.t(new Error(`Import with id "${l}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,x).concat(i).concat(p.slice(x)),this._loadImports([i],!0,l)}updateImport(i,l){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(i);return x===-1?this:typeof l=="string"?(this.setImportUrl(i,l),this):(l.url&&l.url!==p[x].url&&this.setImportUrl(i,l.url),s.bh(l.config,p[x].config)||this.setImportConfig(i,l.config),s.bh(l.data,p[x].data)||this.setImportData(i,l.data),this)}moveImport(i,l){this._checkLoaded();let p=this.stylesheet.imports||[];const x=this.getImportIndex(i);if(x===-1)return this;const w=this.getImportIndex(l);if(w===-1)return this;const E=p[x],R=this.fragments[x];return p=p.filter(({id:L})=>L!==i),this.fragments=this.fragments.filter(({id:L})=>L!==i),this.stylesheet.imports=p.slice(0,w).concat(E).concat(p.slice(w)),this.fragments=this.fragments.slice(0,w).concat(R).concat(this.fragments.slice(w)),this.mergeLayers(),this}setImportUrl(i,l){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(i);if(x===-1)return this;p[x].url=l;const w=this.fragments[x];return w.style=this._createFragmentStyle(p[x]),w.style.on("style.import.load",()=>this.mergeAll()),w.style.loadURL(l),this}setImportData(i,l){this._checkLoaded();const p=this.getImportIndex(i),x=this.stylesheet.imports||[];return p===-1?this:l?(this.fragments[p].style.setState(l),this._reloadImports(),this):(delete x[p].data,this.setImportUrl(i,x[p].url))}setImportConfig(i,l){this._checkLoaded();const p=this.getImportIndex(i),x=this.stylesheet.imports||[];if(p===-1)return this;l?x[p].config=l:delete x[p].config;const w=this.fragments[p],E=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=l,w.style.updateConfig(l,E),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();const l=this.stylesheet.imports||[],p=this.getImportIndex(i);p!==-1&&(l.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(i){const l=(this.stylesheet.imports||[]).findIndex(p=>p.id===i);return l===-1&&this.fire(new s.t(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),l}getLayer(i){return this._mergedLayers[i]}getSources(){const i=[];for(const l in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[l];p&&i.push(p.getSource())}return i}getSource(i,l){const p=this.getSourceCache(i,l);return p&&p.getSource()}getLayerSource(i){const l=this.getLayerSourceCache(i);return l&&l.getSource()}getSourceCache(i,l){const p=s.av(i,l);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(i){const l=s.av(i.source,i.scope);return i.type==="symbol"?this._mergedSymbolSourceCaches[l]:this._mergedOtherSourceCaches[l]}getSourceCaches(i){if(i==null)return Object.values(this._mergedSourceCaches);const l=[];return this._mergedOtherSourceCaches[i]&&l.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&l.push(this._mergedSymbolSourceCaches[i]),l}updateSourceCaches(){const i=this._changes.getUpdatedSourceCaches();for(const l in i){const p=i[l];p==="reload"?this.reloadSource(l):p==="clear"&&this.clearSource(l)}}updateLayers(i){const l=this._changes.getUpdatedPaintProperties();for(const p of l){const x=this.getLayer(p);x&&x.updateTransitions(i)}}getImages(i,l,p){this.imageManager.getImages(l.icons,l.scope,p),this._updateTilesForChangedImages();const x=w=>{w&&w.setDependencies(l.tileID.key,l.type,l.icons)};x(this._otherSourceCaches[l.source]),x(this._symbolSourceCaches[l.source])}getGlyphs(i,l,p){this.glyphManager.getGlyphs(l.stacks,l.scope,p)}getResource(i,l,p){return s.ct(l,p)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){const l=[];return this._otherSourceCaches[i]&&l.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&l.push(this._symbolSourceCaches[i]),l}_isSourceCacheLoaded(i){const l=this.getOwnSourceCaches(i);return l.length===0?(this.fire(new s.t(new Error(`There is no source with ID '${i}'`))),!1):l.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(i,l){if(!this._clipLayerPresent&&i.type!=="fill-extrusion")return!1;const p=i.type==="fill-extrusion"&&i.sourceLayer==="building";if(i.is3D()){if(p||l&&l.type==="batched-model"||i.type==="model")return!0}else if(i.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(i=>{i.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ms.getSourceType=function(f){return Kh[f]},Ms.setSourceType=function(f,i){Kh[f]=i},Ms.registerForPluginStateChange=s.cc;var px=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Fm=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Bm=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,ff="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",mx=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,gx=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,yx=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,_x=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Vm=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,xx=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Cd=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const pf=[];Ya(px,pf),Ya(Bm,pf),Ya(Fm,pf);const Pd={"_prelude_fog.vertex.glsl":gx,"_prelude_terrain.vertex.glsl":mx,"_prelude_shadow.vertex.glsl":xx,"_prelude_fog.fragment.glsl":yx,"_prelude_shadow.fragment.glsl":Cd,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":_x,"_prelude_raster_particle.glsl":Vm},Uc={};kn("",mx),kn(yx,gx),kn(Cd,xx),kn(_x,""),kn(Vm,"");const Md=kn(Fm,Bm),mf=px;var Xa={background:kn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:kn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:kn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:kn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:kn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:kn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:kn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:kn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:kn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:kn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:kn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:kn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:kn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:kn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:kn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:kn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:kn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:kn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:kn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:kn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:kn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:kn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:kn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:kn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:kn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:kn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:kn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:kn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
}`),terrainRaster:kn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:kn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:kn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ff),skyboxGradient:kn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ff),skyboxCapture:kn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:kn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:kn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:kn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:kn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:kn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:kn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ya(f,i){const l=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of l)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=p.split(" ");for(const w of x)i.includes(w)||i.push(w)}}function kn(f,i){const l=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let x=i.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);x&&(x=x.map(z=>{const B=z.split(" ");return B[B.length-1]}),x=[...new Set(x)]);const w={},E=[],R=[];if(f=f.replace(l,(z,B)=>(R.push(B),"")),(i=i.replace(l,(z,B)=>(E.push(B),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let L=[...pf];Ya(f,L),Ya(i,L);for(const z of[...E,...R])Pd[z]||console.error(`Undefined include: ${z}`),Uc[z]||(Uc[z]=[],Ya(Pd[z],Uc[z])),L=[...L,...Uc[z]];return{fragmentSource:f=f.replace(p,(z,B,G,Z,Y)=>(w[Y]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
in ${G} ${Z} ${Y};
#else
uniform ${G} ${Z} u_${Y};
#endif
`:B==="initialize"?`
#ifdef HAS_UNIFORM_u_${Y}
    ${G} ${Z} ${Y} = u_${Y};
#endif
`:B==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Y}
    in ${G} ${Z} ${Y};
#endif
`:B==="initialize-attribute"?"":void 0)),vertexSource:i=i.replace(p,(z,B,G,Z,Y)=>{const se=Z==="float"?"vec2":Z,oe=Y.match(/color/)?"color":se;return B==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${Y}
in ${G} ${Z} a_${Y};
#endif
`:w[Y]?B==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
in ${G} ${se} a_${Y};
out ${G} ${Z} ${Y};
#else
uniform ${G} ${Z} u_${Y};
#endif
`:B==="initialize"?oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = a_${Y};
#else
    ${G} ${Z} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = unpack_mix_${oe}(a_${Y}, u_${Y}_t);
#else
    ${G} ${Z} ${Y} = u_${Y};
#endif
`:B==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Y}
    in ${G} ${Z} a_${Y};
    out ${G} ${Z} ${Y};
#endif
`:B==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Y}
    ${Y} = a_${Y};
#endif
`:void 0:B==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
in ${G} ${se} a_${Y};
#else
uniform ${G} ${Z} u_${Y};
#endif
`:B==="define-instanced"?oe==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${Y}0;
in vec4 a_${Y}1;
in vec4 a_${Y}2;
in vec4 a_${Y}3;
#else
uniform ${G} ${Z} u_${Y};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${G} ${se} a_${Y};
#else
uniform ${G} ${Z} u_${Y};
#endif
`:B==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${Y}
    ${G} ${Z} ${Y} = a_${Y};
#endif
`:oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${G} ${Z} ${Y} = a_${Y};
#else
    ${G} ${Z} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${G} ${Z} ${Y} = unpack_mix_${oe}(a_${Y}, u_${Y}_t);
#else
    ${G} ${Z} ${Y} = u_${Y};
#endif
`}),staticAttributes:x,usedDefines:L,vertexIncludes:E,fragmentIncludes:R}}class $c{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,l,p,x,w,E,R,L){this.context=i;let z=this.boundPaintVertexBuffers.length!==x.length;for(let G=0;!z&&G<x.length;G++)this.boundPaintVertexBuffers[G]!==x[G]&&(z=!0);let B=this.boundDynamicVertexBuffers.length!==R.length;for(let G=0;!B&&G<R.length;G++)this.boundDynamicVertexBuffers[G]!==R[G]&&(B=!0);if(!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==p||z||B||this.boundIndexBuffer!==w||this.boundVertexOffset!==E)this.freshBind(l,p,x,w,E,R,L);else{i.bindVertexArrayOES.set(this.vao);for(const G of R)G&&(G.bind(),L&&G.instanceCount&&G.setVertexAttribDivisor(i.gl,l,L));w&&w.dynamicDraw&&w.bind()}}freshBind(i,l,p,x,w,E,R){const L=i.numAttributes,z=this.context,B=z.gl;this.vao&&this.destroy(),this.vao=z.gl.createVertexArray(),z.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=x,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=E,l.enableAttributes(B,i),l.bind(),l.setVertexAttribPointers(B,i,w);for(const G of p)G.enableAttributes(B,i),G.bind(),G.setVertexAttribPointers(B,i,w);for(const G of E)G&&(G.enableAttributes(B,i),G.bind(),G.setVertexAttribPointers(B,i,w),R&&G.instanceCount&&G.setVertexAttribDivisor(B,i,R));x&&x.bind(),z.currentNumAttributes=L}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Ad(f,i){const l=Math.pow(2,i.canonical.z),p=i.canonical.y;return[new s.a5(0,p/l).toLngLat().lat,new s.a5(0,(p+1)/l).toLngLat().lat]}function gf(f,i,l,p,x,w,E){const R=f.context,L=R.gl,z=l.hillshadeFBO;if(!z)return;f.prepareDrawTile();const B=f.isTileAffectedByFog(i),G=f.getOrCreateProgram("hillshade",{overrideFog:B});R.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,z.colorAttachment.get());const Z=((ae,le,me,ye)=>{const fe=me.paint.get("hillshade-shadow-color"),be=me.paint.get("hillshade-highlight-color"),ve=me.paint.get("hillshade-accent-color"),Pe=me.paint.get("hillshade-emissive-strength");let Te=s.bB(me.paint.get("hillshade-illumination-direction"));if(me.paint.get("hillshade-illumination-anchor")==="viewport")Te-=ae.transform.angle;else if(ae.style&&ae.style.enable3dLights()&&ae.style.directionalLight){const Oe=ae.style.directionalLight.properties.get("direction"),ke=s.c7(Oe.x,Oe.y,Oe.z);Te=s.bB(ke[1])}const Me=!ae.options.moving;return{u_matrix:ye||ae.transform.calculateProjMatrix(le.tileID.toUnwrapped(),Me),u_image:0,u_latrange:Ad(0,le.tileID),u_light:[me.paint.get("hillshade-exaggeration"),Te],u_shadow:fe.toRenderColor(me.lut),u_highlight:be.toRenderColor(me.lut),u_emissive_strength:Pe,u_accent:ve.toRenderColor(me.lut)}})(f,l,p,f.terrain?i.projMatrix:null);f.uploadCommonUniforms(R,G,i.toUnwrapped());const{tileBoundsBuffer:Y,tileBoundsIndexBuffer:se,tileBoundsSegments:oe}=f.getTileBoundsBuffers(l);G.draw(f,L.TRIANGLES,x,w,E,tn.disabled,Z,p.id,Y,se,oe)}function yf(f,i,l){if(!i.needsDEMTextureUpload)return;const p=f.context,x=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||f.getTileTexture(l.stride);const w=l.getPixels();i.demTexture?i.demTexture.update(w,{premultiply:!1}):i.demTexture=new s.T(p,w,x.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function Id(f,i,l){const p=f.context,x=p.gl;if(!i.dem)return;const w=i.dem;if(p.activeTexture.set(x.TEXTURE1),yf(f,i,w),!i.demTexture)return;i.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const E=w.dim;p.activeTexture.set(x.TEXTURE0);let R=i.hillshadeFBO;if(!R){const Z=new s.T(p,{width:E,height:E,data:null},x.RGBA8);Z.bind(x.LINEAR,x.CLAMP_TO_EDGE),R=i.hillshadeFBO=p.createFramebuffer(E,E,!0,"renderbuffer"),R.colorAttachment.set(Z.texture)}p.bindFramebuffer.set(R.framebuffer),p.viewport.set([0,0,E,E]);const{tileBoundsBuffer:L,tileBoundsIndexBuffer:z,tileBoundsSegments:B}=f.getMercatorTileBoundsBuffers(),G=[];f.linearFloatFilteringSupported()&&G.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:G}).draw(f,x.TRIANGLES,qt.disabled,un.disabled,En.unblended,tn.disabled,((Z,Y)=>{const se=Y.stride,oe=s.a6.mat4.create();return s.a6.mat4.ortho(oe,0,s.ab,-s.ab,0,0,1),s.a6.mat4.translate(oe,oe,[0,-s.ab,0]),{u_matrix:oe,u_image:1,u_dimension:[se,se],u_zoom:Z.overscaledZ}})(i.tileID,w),l.id,L,z,B),i.needsHillshadePrepare=!1}class ar{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Um extends ar{getDefault(){return s.bz.transparent}set(i){const l=this.current;(i.r!==l.r||i.g!==l.g||i.b!==l.b||i.a!==l.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class vx extends ar{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class $m extends ar{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class _f extends ar{getDefault(){return[!0,!0,!0,!0]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Dd extends ar{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class bx extends ar{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class wx extends ar{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const l=this.current;(i.func!==l.func||i.ref!==l.ref||i.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Sx extends ar{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Gc extends ar{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=i,this.dirty=!1}}class Tx extends ar{getDefault(){return[0,1]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class aw extends ar{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=i,this.dirty=!1}}class lw extends ar{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class cw extends ar{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.BLEND):l.disable(l.BLEND),this.current=i,this.dirty=!1}}class Gm extends ar{getDefault(){const i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Wm extends ar{getDefault(){return s.bz.transparent}set(i){const l=this.current;(i.r!==l.r||i.g!==l.g||i.b!==l.b||i.a!==l.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Hm extends ar{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class qm extends ar{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=i,this.dirty=!1}}class Ex extends ar{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Cx extends ar{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let uw=class extends ar{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class Rd extends ar{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class kd extends ar{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Px extends ar{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class As extends ar{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Zm extends ar{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class xf extends ar{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class vf extends ar{getDefault(){return null}set(i){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Xm extends ar{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class Ym extends ar{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class bf extends ar{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Km extends ar{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Nd extends ar{constructor(i,l){super(i),this.context=i,this.parent=l}getDefault(){return null}}class wf extends Nd{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Jm extends Nd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Mx extends Nd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,this.attachment(),l.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Wc extends Jm{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const dw=(f,i,l)=>({u_matrix:f,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:l}),Ax=(f,i,l,p,x,w,E,R,L,z,B,G,Z,Y,se,oe)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:l,u_zoom_transition:x,u_merc_center:w,u_image0:0,u_frustum_tl:E,u_frustum_tr:R,u_frustum_br:L,u_frustum_bl:z,u_globe_pos:B,u_globe_radius:G,u_viewport:Z,u_grid_matrix:oe?Float32Array.from(oe):new Float32Array(9),u_skirt_height:Y,u_far_z_cutoff:se});function Ix(f,i){return f!=null&&i!=null&&!(!f.hasData()||!i.hasData())&&f.demTexture!=null&&i.demTexture!=null&&f.tileID.key!==i.tileID.key}const Hc=new class{constructor(){this.operations={}}newMorphing(f,i,l,p,x){if(f in this.operations){const w=this.operations[f];w.to.tileID.key!==l.tileID.key&&(w.queued=l)}else this.operations[f]={startTime:p,phase:0,duration:x,from:i,to:l,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const i=this.operations[f];return{from:i.from,to:i.to,phase:i.phase}}update(f){for(const i in this.operations){const l=this.operations[i];for(l.phase=(f-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,f)){delete this.operations[i];break}}}_nextOp(f,i){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=i,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Dx={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Rx(f,i,l){if(i===0)return 0;const p=i<1&&l===514?.25/i:1;return 6*Math.pow(1.5,22-f)*Math.max(i,1)*p}function Qm(f,i){const l=1<<f.z;return!i&&(f.x===0||f.x===l-1)||f.y===0||f.y===l-1}const Ld=f=>({u_matrix:f});function Sf(f,i,l,p,x){if(x>0){const w=s.q.now(),E=(w-f.timeAdded)/x,R=i?(w-i.timeAdded)/x:-1,L=l.getSource(),z=p.coveringZoomLevel({tileSize:L.tileSize,roundZoom:L.roundZoom}),B=!i||Math.abs(i.tileID.overscaledZ-z)>Math.abs(f.tileID.overscaledZ-z),G=B&&f.refreshedUponExpiration?1:s.ap(B?E:1-R,0,1);return f.refreshedUponExpiration&&E>=1&&(f.refreshedUponExpiration=!1),i?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}class qc extends ls{constructor(i){const l={type:"raster-dem",maxzoom:i.transform.maxZoom},p=new s.cd(s.ce(),null),x=Ec("mock-dem",l,p,i.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,l){i.state="loaded",l(null)}}class kx extends ls{constructor(i){const l=Ec("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new s.cd(s.ce(),null),i.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,l,p){if(i.freezeTileCoverage)return;this.transform=i;const x=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,E)=>{if(w[E.key]="",!this._tiles[E.key]){const R=new Oo(E,this._source.tileSize*E.overscaleFactor(),i.tileZoom);R.state="loaded",this._tiles[E.key]=R}return w},{});for(const w in this._tiles)w in x||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(i){const l=this.proxyCachedFBO[i];if(l!==void 0){const p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class eg extends s.aA{constructor(i,l,p){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class tg extends s.cE{constructor(i,l){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,x,w]=function(L){const z=new s.a_,B=new s.aO,G=131;z.reserve(17161),B.reserve(33800);const Z=s.ab/128,Y=s.ab+Z/2,se=Y+Z;for(let ae=-Z;ae<se;ae+=Z)for(let le=-Z;le<se;le+=Z){const me=le<0||le>Y||ae<0||ae>Y?24575:0,ye=s.ap(Math.round(le),0,s.ab),fe=s.ap(Math.round(ae),0,s.ab);z.emplaceBack(ye+me,fe)}const oe=(ae,le)=>{const me=le*G+ae;B.emplaceBack(me+1,me,me+G),B.emplaceBack(me+G,me+G+1,me+1)};for(let ae=1;ae<129;ae++)for(let le=1;le<129;le++)oe(le,ae);return[0,129].forEach(ae=>{for(let le=0;le<130;le++)oe(le,ae),oe(ae,le)}),[z,B,32768]}(),E=i.context;this.gridBuffer=E.createVertexBuffer(p,s.b0.members),this.gridIndexBuffer=E.createIndexBuffer(x),this.gridSegments=s.b1.simpleSegment(0,0,p.length,x.length),this.gridNoSkirtSegments=s.b1.simpleSegment(0,0,p.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new kx(l.map),this.orthoMatrix=s.a6.mat4.create(),s.a6.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.ab,0,s.ab,0,1);const R=E.gl;this._overlapStencilMode=new un({func:R.GEQUAL,mask:255},0,255,R.KEEP,R.KEEP,R.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new qc(l.map),this._pendingGroundEffectLayers=[]}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,l,p){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);const x=i.terrain.properties,w=i.terrain.drapeRenderMode===0,E=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.q.now();const R=i.terrain&&i.terrain.scope,L=x.get("source"),z=w?this._mockSourceCache:i.getSourceCache(L,R);if(!z)return void s.w(`Couldn't find terrain source "${L}".`);if(this.sourceCache=z,this._exaggeration=E?this.calculateExaggeration(l):x.get("exaggeration"),!l.projection.requiresDraping&&E&&this._exaggeration===0)return void this._disable();this.enabled=!0;const B=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const G=this.getScaledDemTileSize();this.sourceCache.update(l,G,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,B(),this._initializing=!0),B(),l.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0,this._previousZoom=l.zoom}else this._disable()}calculateExaggeration(i){const l=this._previousCameraAltitude,p=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=p;const x=l!=null?p-l:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const w=i.zoom,E=this._style.terrain;if(!this._previousUpdateTimestamp)return E.getExaggeration(w);let R=w-this._previousZoom;const L=this._previousUpdateTimestamp;let z=w;this._evaluationZoom!=null&&(z=this._evaluationZoom,Math.abs(w-z)>.5&&(R=.5*(w-z+R)),R*x<0&&(z+=R)),this._evaluationZoom=z;const B=E.getExaggeration(z),G=B===E.getExaggeration(Math.max(0,z-.1));if(G&&Math.abs(B-this._exaggeration)<.01)return B;let Z=Math.min(.1,.00375*(this._updateTimestamp-L));return(G||B<.1||Math.abs(R)<1e-4)&&(Z=Math.min(.2,4*Z)),s.aa(this._exaggeration,B,Z)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(s.a5.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=l.getIds().map(L=>{const z=l.getTileByID(L).tileID;return z.projMatrix=p.calculateProjMatrix(z.toUnwrapped()),z});(function(L,z){const B=z.transform.pointCoordinate(z.transform.getCameraPoint()),G=new s.P(B.x,B.y);L.sort((Z,Y)=>{if(Y.overscaledZ-Z.overscaledZ)return Y.overscaledZ-Z.overscaledZ;const se=new s.P(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),oe=new s.P(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),ae=G.mult(1<<Z.canonical.z);return ae.x-=.5,ae.y-=.5,ae.distSqr(se)-ae.distSqr(oe)})})(x,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},x.forEach(L=>{this.proxyToSource[L.key]={}}),this.terrainTileForTile={};const E=this._style._mergedSourceCaches;for(const L in E){const z=E[L];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,i[L],w),z.usedForTerrain))continue;const B=i[L];z.getSource().reparseOverscaled&&this._assignTerrainTiles(B)}this.proxiedCoords[l.id]=x.map(L=>new eg(L,L.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const R={};this._visibleDemTiles=[];for(const L of this.proxyCoords){const z=this.terrainTileForTile[L.key];if(!z)continue;const B=z.tileID.key;B in R||(this._visibleDemTiles.push(z),R[B]=B)}}_assignTerrainTiles(i){this._initializing||i.forEach(l=>{if(this.terrainTileForTile[l.key])return;const p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){const i=this.painter.context,l=i.gl;for(const p in this.terrainTileForTile){const x=this.terrainTileForTile[p],w=x.dem;!w||x.demTexture&&!x.needsDEMTextureUpload||(i.activeTexture.set(l.TEXTURE1),yf(this.painter,x,w))}}_prepareDemTileUniforms(i,l,p,x){if(!l||l.demTexture==null)return!1;const w=i.tileID.canonical,E=Math.pow(2,l.tileID.canonical.z-w.z),R=x||"";return p[`u_dem_tl${R}`]=[w.x*E%1,w.y*E%1],p[`u_dem_scale${R}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let i=0;const l=this._visibleDemTiles.reduce((p,x)=>{if(!x.dem)return p;const w=x.dem.tree.minimums[0];return w>0&&i++,p+w},0);return i?l/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,l=i.gl;i.activeTexture.set(l.TEXTURE2);const p=this._getLoadedAreaMinimum(),x=new s.cF({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(x,{premultiply:!1}):w=this._emptyDEMTexture=new s.T(i,x,l.R32F,{premultiply:!1}),w}setupElevationDraw(i,l,p){const x=this.painter.context,w=x.gl,E={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};E.u_exaggeration=this.exaggeration();let R=null,L=null,z=1;if(p&&p.morphing&&this._useVertexMorphing){const Y=p.morphing.srcDemTile,se=p.morphing.dstDemTile;z=p.morphing.phase,Y&&se&&(this._prepareDemTileUniforms(i,Y,E,"_prev")&&(L=Y),this._prepareDemTileUniforms(i,se,E)&&(R=se))}const B=Y=>Y&&Y.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST;let G=null;var Z;if(this.enabled?L&&R?(G=R.demTexture,x.activeTexture.set(w.TEXTURE4),L.demTexture.bind(B(L),w.CLAMP_TO_EDGE),E.u_dem_lerp=z):(R=this.terrainTileForTile[i.tileID.key],G=this._prepareDemTileUniforms(i,R,E)?R.demTexture:this.emptyDEMTexture):G=this.emptyDEMTexture,x.activeTexture.set(w.TEXTURE2),G&&(E.u_dem_size=(Z=G).size[0]===1?1:Z.size[0]-2,G.bind(B(R),w.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,l,E),p&&p.useMeterToDem&&R){const Y=(1<<R.tileID.canonical.z)*s.bD(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=Y}if(p&&p.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(x,E),this.painter.transform.projection.name==="globe"){const Y=this.globeUniformValues(this.painter.transform,i.tileID.canonical,p&&p.useDenormalizedUpVectorScale);l.setGlobeUniformValues(x,Y)}}globeUniformValues(i,l,p){const x=i.projection;return{u_tile_tl_up:x.upVector(l,0,0),u_tile_tr_up:x.upVector(l,s.ab,0),u_tile_br_up:x.upVector(l,s.ab,s.ab),u_tile_bl_up:x.upVector(l,0,s.ab),u_tile_up_scale:p?s.cG(1):x.upVectorScale(l,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const l=this.painter,p=this.painter.context;i.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,w,E,R,L){if(x.transform.projection.name==="globe")(function(z,B,G,Z,Y){const se=z.context,oe=se.gl;let ae,le;const me=z.transform,ye=s.cx(z,se,me),fe=(Ue,et)=>{if(le===et)return;const lt=[Dx[et],"PROJECTION_GLOBE_VIEW"];ye&&lt.push("CUSTOM_ANTIALIASING");const Qe=z.isTileAffectedByFog(Ue);ae=z.getOrCreateProgram("globeRaster",{defines:lt,overrideFog:Qe}),le=et},be=z.colorModeForRenderPass(),ve=new qt(oe.LEQUAL,qt.ReadWrite,z.depthRangeFor3D);Hc.update(Y);const Pe=s.cy(me),Te=[s.am(me.center.lng),s.at(me.center.lat)],Me=z.globeSharedBuffers,Oe=[me.width*s.q.devicePixelRatio,me.height*s.q.devicePixelRatio],ke=Float32Array.from(me.globeMatrix),De={useDenormalizedUpVectorScale:!0};{const Ue=z.transform,et=Rx(Ue.zoom,B.exaggeration(),B.sourceCache._source.tileSize);le=-1;const lt=oe.TRIANGLES;for(const Qe of Z){const gt=G.getTile(Qe),$e=un.disabled,ot=B.prevTerrainTileForTile[Qe.key],it=B.terrainTileForTile[Qe.key];Ix(ot,it)&&Hc.newMorphing(Qe.key,ot,it,Y,250),se.activeTexture.set(oe.TEXTURE0),gt.texture&&gt.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);const _t=Hc.getMorphValuesForProxy(Qe.key),vt=_t?1:0;_t&&s.C(De,{morphing:{srcDemTile:_t.from,dstDemTile:_t.to,phase:s.cw(_t.phase)}});const at=s.cz(Qe.canonical),dt=s.cA(at.getCenter().lat),Wt=s.cB(Qe.canonical,at,dt,Ue.worldSize/Ue._pixelsPerMercatorPixel),Ct=s.b5(s.cC(Qe.canonical)),Nt=Ax(Ue.expandedFarZProjMatrix,ke,Pe,Ct,s.a9(Ue.zoom),Te,Ue.frustumCorners.TL,Ue.frustumCorners.TR,Ue.frustumCorners.BR,Ue.frustumCorners.BL,Ue.globeCenterInViewSpace,Ue.globeRadius,Oe,et,Ue._farZ,Wt);if(fe(Qe,vt),ae&&(B.setupElevationDraw(gt,ae,De),z.uploadCommonUniforms(se,ae,Qe.toUnwrapped()),Me)){const[Kt,Bt,Zt]=Me.getGridBuffers(dt,et!==0);ae.draw(z,lt,ve,$e,be,tn.backCCW,Nt,"globe_raster",Kt,Bt,Zt)}}}if(Me&&(z.renderDefaultNorthPole||z.renderDefaultSouthPole)){const Ue=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ye&&Ue.push("CUSTOM_ANTIALIASING"),ae=z.getOrCreateProgram("globeRaster",{defines:Ue});for(const et of Z){const{x:lt,y:Qe,z:gt}=et.canonical,$e=Qe===0,ot=Qe===(1<<gt)-1,[it,_t,vt,at]=Me.getPoleBuffers(gt,!1);if(at&&($e||ot)){const dt=G.getTile(et);se.activeTexture.set(oe.TEXTURE0),dt.texture&&dt.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);let Wt=s.cD(gt,lt,me);const Ct=s.b5(s.cC(et.canonical)),Nt=(Kt,Bt)=>Kt.draw(z,oe.TRIANGLES,ve,un.disabled,be,tn.disabled,Ax(me.expandedFarZProjMatrix,Wt,Wt,Ct,0,Te,me.frustumCorners.TL,me.frustumCorners.TR,me.frustumCorners.BR,me.frustumCorners.BL,me.globeCenterInViewSpace,me.globeRadius,Oe,0,me._farZ),"globe_pole_raster",Bt,vt,at);B.setupElevationDraw(dt,ae,De),z.uploadCommonUniforms(se,ae,et.toUnwrapped()),$e&&z.renderDefaultNorthPole&&Nt(ae,it),ot&&z.renderDefaultSouthPole&&(Wt=s.a6.mat4.scale(s.a6.mat4.create(),Wt,[1,-1,1]),Nt(ae,_t))}}}})(x,w,E,R,L);else{const z=x.context,B=z.gl;let G,Z;const Y=x.shadowRenderer,se=pa(x,x.longestCutoffRange),oe=be=>{if(Z===be)return;const ve=[];ve.push(Dx[be]),se.shouldRenderCutoff&&ve.push("RENDER_CUTOFF"),G=x.getOrCreateProgram("terrainRaster",{defines:ve}),Z=be},ae=x.colorModeForRenderPass(),le=new qt(B.LEQUAL,qt.ReadWrite,x.depthRangeFor3D);Hc.update(L);const me=x.transform,ye=Rx(me.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let fe=[0,0,0];if(Y){const be=x.style.directionalLight,ve=x.style.ambientLight;be&&ve&&(fe=uf(x.style,be,ve))}{Z=-1;const be=B.TRIANGLES,[ve,Pe]=[w.gridIndexBuffer,w.gridSegments];for(const Te of R){const Me=E.getTile(Te),Oe=un.disabled,ke=w.prevTerrainTileForTile[Te.key],De=w.terrainTileForTile[Te.key];Ix(ke,De)&&Hc.newMorphing(Te.key,ke,De,L,250),z.activeTexture.set(B.TEXTURE0),Me.texture&&Me.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const Ue=Hc.getMorphValuesForProxy(Te.key),et=Ue?1:0;let lt;Ue&&(lt={morphing:{srcDemTile:Ue.from,dstDemTile:Ue.to,phase:s.cw(Ue.phase)}});const Qe=dw(Te.projMatrix,Qm(Te.canonical,me.renderWorldCopies)?ye/10:ye,fe);if(oe(et),!G)continue;w.setupElevationDraw(Me,G,lt);const gt=Te.toUnwrapped();Y&&Y.setupShadows(gt,G),x.uploadCommonUniforms(z,G,gt,null,se),G.draw(x,be,le,Oe,ae,tn.backCCW,Qe,"terrain_raster",w.gridBuffer,ve,Pe)}}}}(l,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const l=this.painter,p=this.painter.context,x=this.proxySourceCache,w=this.proxiedCoords[x.id],E=this._drapedRenderBatches.shift(),R=l.style.order,L=[];let z=0;for(const B of w){const G=x.getTileByID(B.proxyTileKey),Z=x.proxyCachedFBO[B.key]?x.proxyCachedFBO[B.key][i]:void 0,Y=Z!==void 0?x.renderCache[Z]:this.pool[z++],se=Z!==void 0;if(G.texture=Y.tex,se&&!Y.dirty){L.push(G.tileID);continue}let oe;p.bindFramebuffer.set(Y.fb.framebuffer),this.renderedToTile=!1,Y.dirty&&(p.clear({color:s.bz.transparent,stencil:0}),Y.dirty=!1);for(let ae=E.start;ae<=E.end;++ae){const le=l.style._mergedLayers[R[ae]];if(le.isHidden(l.transform.zoom))continue;const me=l.style.getLayerSourceCache(le),ye=me?this.proxyToSource[B.key][me.id]:[B];if(!ye)continue;const fe=ye;p.viewport.set([0,0,Y.fb.width,Y.fb.height]),oe!==(me?me.id:null)&&(this._setupStencil(Y,ye,le,me),oe=me?me.id:null),l.renderLayer(l,me,le,fe)}if(this._drapedRenderBatches.length===0)for(const ae of this._pendingGroundEffectLayers){const le=l.style._mergedLayers[R[ae]];if(le.isHidden(l.transform.zoom))continue;const me=l.style.getLayerSourceCache(le),ye=me?this.proxyToSource[B.key][me.id]:[B];if(!ye)continue;const fe=ye;p.viewport.set([0,0,Y.fb.width,Y.fb.height]),oe!==(me?me.id:null)&&(this._setupStencil(Y,ye,le,me),oe=me?me.id:null),l.renderLayer(l,me,le,fe)}this.renderedToTile?(Y.dirty=!0,L.push(G.tileID)):se||--z,z===5&&(z=0,this.renderToBackBuffer(L))}return this.renderToBackBuffer(L),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),E.end+1}postRender(){}isLayerOrderingCorrect(i){const l=i.order.length;let p=-1,x=l;for(let w=0;w<l;++w)this._style.isLayerDraped(i._mergedLayers[i.order[w]])?p=Math.max(p,w):x=Math.min(x,w);return x>p}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{i=Math.min(i,l.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,l,p){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const E=w.tileID,R=1<<E.overscaledZ,{x:L,y:z}=E.canonical,B=L/R,G=(L+1)/R,Z=z/R,Y=(z+1)/R;return{minx:B,miny:Z,maxx:G,maxy:Y,t:w.dem.tree.raycastRoot(B,Z,G,Y,i,l,p),tile:w}});x.sort((w,E)=>(w.t!==null?w.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(const w of x){if(w.t==null)return null;const E=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,i,l,p);if(E!=null)return E}return null}_createFBO(){const i=this.painter.context,l=i.gl,p=this.drapeBufferSize;i.activeTexture.set(l.TEXTURE0);const x=new s.T(i,{width:p[0],height:p[1],data:null},l.RGBA8);x.bind(l.LINEAR,l.CLAMP_TO_EDGE);const w=i.createFramebuffer(p[0],p[1],!0,null);return w.colorAttachment.set(x.texture),w.depthAttachment=new Wc(i,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:w,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const l=this._style._mergedLayers[i],p=l.isHidden(this.painter.transform.zoom);return l.type==="hillshade"||l.type==="custom"?!p&&l.shouldRedrape():!p&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const p of this._style.getSources())if(p instanceof Yh){i=!0;break}if(!i)return;const l={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],w=this._style.getLayerSourceCache(x);if(w&&!l[w.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof s.a4){l[w.id]=!0;for(const E of this.proxyCoords){const R=this.proxyToSource[E.key][w.id];if(R)for(const L of R)this._clearRenderCacheForTile(w.id,L)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof xd){i=!0;break}if(!i)return;const l={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],w=this._style.getLayerSourceCache(x);if(!w||l[w.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const E=x.paint.get("raster-fade-duration");for(const R of this.proxyCoords){const L=this.proxyToSource[R.key][w.id];if(L)for(const z of L){const B=Sf(w.getTile(z),w.findLoadedParent(z,0),w,this.painter.transform,E);(B.opacity!==1||B.mix!==0)&&this._clearRenderCacheForTile(w.id,z)}}}}_setupDrapedRenderBatches(){const i=this._style.order,l=i.length;if(l===0)return;const p=[];this._pendingGroundEffectLayers=[];let x,w=0,E=this._style._mergedLayers[i[w]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++w<l;)E=this._style._mergedLayers[i[w]];for(;w<l;++w){const R=this._style._mergedLayers[i[w]];R.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(R)?x===void 0&&(x=w):(R.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(w),x!==void 0&&(p.push({start:x,end:w-1}),x=void 0)))}if(x!==void 0&&p.push({start:x,end:w-1}),p.length!==0){const R=p[p.length-1];this._pendingGroundEffectLayers.every(L=>L>R.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(i){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const E=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let R=0;R<E.length;++R){const L=Object.values(E[R]);l.renderCachePool.push(...L)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,x=this._tilesDirty;for(let E=p.length-1;E>=0;E--){const R=p[E];if(l.getTileByID(R.key),l.proxyCachedFBO[R.key]!==void 0){const L=i[R.key],z=this.proxyToSource[R.key];let B=0;for(const G in z){const Z=z[G],Y=L[G];if(!Y||Y.length!==Z.length||Z.some((se,oe)=>se!==Y[oe]||x[G]&&x[G].hasOwnProperty(se.key))){B=-1;break}++B}for(const G in l.proxyCachedFBO[R.key])l.renderCache[l.proxyCachedFBO[R.key][G]].dirty=B<0||B!==Object.values(L).length}}const w=[...this._drapedRenderBatches];w.sort((E,R)=>R.end-R.start-(E.end-E.start));for(const E of w)for(const R of p){if(l.proxyCachedFBO[R.key])continue;let L=l.renderCachePool.pop();L===void 0&&l.renderCache.length<50&&(L=l.renderCache.length,l.renderCache.push(this._createFBO())),L!==void 0&&(l.proxyCachedFBO[R.key]={},l.proxyCachedFBO[R.key][E.start]=L,l.renderCache[L].dirty=!0)}this._tilesDirty={}}_setupStencil(i,l,p,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,E=w.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let R;if(p.isTileClipped())R=l.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);R=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+R>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=R,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):un.disabled}_renderTileClippingMasks(i,l){const p=this.painter,x=this.painter.context,w=x.gl;p._tileClippingMaskIDs={},x.setColorMode(En.disabled),x.setDepthMode(qt.disabled);const E=p.getOrCreateProgram("clippingMask");for(const R of i){const L=p._tileClippingMaskIDs[R.key]=--l;E.draw(p,w.TRIANGLES,qt.disabled,new un({func:w.ALWAYS,mask:0},L,255,w.KEEP,w.KEEP,w.REPLACE),En.disabled,tn.disabled,Ld(R.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(i){const l=this.painter.transform;if(i.x<0||i.x>l.width||i.y<0||i.y>l.height)return null;const p=[i.x,i.y,1,1];s.a6.vec4.transformMat4(p,p,l.pixelMatrixInverse),s.a6.vec4.scale(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;const x=l._camera.position,w=s.bD(1,l.center.lat),E=[x[0],x[1],x[2]/w,0],R=s.a6.vec3.subtract([],p.slice(0,3),E);s.a6.vec3.normalize(R,R);const L=this.raycast(E,R,this._exaggeration);return L!==null&&L?(s.a6.vec3.scaleAndAdd(E,E,R,L),E[3]=E[2],E[2]*=w,E):null}_setupProxiedCoordsForOrtho(i,l,p){if(i.getSource()instanceof s.aD)return this._setupProxiedCoordsForImageSource(i,l,p);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const x=this.proxiedCoords[i.id]=[],w=this.proxyCoords;for(let L=0;L<w.length;L++){const z=w[L],B=this._findTileCoveringTileID(z,i);if(B){const G=this._createProxiedId(z,B,p[z.key]&&p[z.key][i.id]);x.push(G),this.proxyToSource[z.key][i.id]=[G]}}let E=!1;const R=new Set;for(let L=0;L<l.length;L++){const z=i.getTile(l[L]);if(!z||!z.hasData())continue;const B=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(B&&B.tileID.canonical.z!==z.tileID.canonical.z){const G=this.proxyToSource[B.tileID.key][i.id],Z=this._createProxiedId(B.tileID,z,p[B.tileID.key]&&p[B.tileID.key][i.id]);G?G.splice(G.length-1,0,Z):this.proxyToSource[B.tileID.key][i.id]=[Z];const Y=this.proxyToSource[B.tileID.key][i.id];R.has(Y)||R.add(Y),x.push(Z),E=!0}}if(this._sourceTilesOverlap[i.id]=E,E&&this._debugParams.sortTilesHiZFirst)for(const L of R)L.sort((z,B)=>B.overscaledZ-z.overscaledZ)}_setupProxiedCoordsForImageSource(i,l,p){if(!i.getSource().loaded())return;const x=this.proxiedCoords[i.id]=[],w=this.proxyCoords,E=i.getSource(),R=E.tileID;if(!R)return;const L=new s.P(R.x,R.y)._div(1<<R.z),z=E.coordinates.map(s.a5.fromLngLat).reduce((G,Z)=>(G.min.x=Math.min(G.min.x,Z.x-L.x),G.min.y=Math.min(G.min.y,Z.y-L.y),G.max.x=Math.max(G.max.x,Z.x-L.x),G.max.y=Math.max(G.max.y,Z.y-L.y),G),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),B=(G,Z)=>{const Y=G.wrap+G.canonical.x/(1<<G.canonical.z),se=G.canonical.y/(1<<G.canonical.z),oe=s.ab/(1<<G.canonical.z),ae=Z.wrap+Z.canonical.x/(1<<Z.canonical.z),le=Z.canonical.y/(1<<Z.canonical.z);return Y+oe<ae+z.min.x||Y>ae+z.max.x||se+oe<le+z.min.y||se>le+z.max.y};for(let G=0;G<w.length;G++){const Z=w[G];for(let Y=0;Y<l.length;Y++){const se=i.getTile(l[Y]);if(!se||!se.hasData()||B(Z,se.tileID))continue;const oe=this._createProxiedId(Z,se,p[Z.key]&&p[Z.key][i.id]),ae=this.proxyToSource[Z.key][i.id];ae?ae.push(oe):this.proxyToSource[Z.key][i.id]=[oe],x.push(oe)}}}_createProxiedId(i,l,p){let x=this.orthoMatrix;if(p){const w=p.find(E=>E.key===l.tileID.key);if(w)return w}if(l.tileID.key!==i.key){const w=i.canonical.z-l.tileID.canonical.z;let E,R,L;x=s.a6.mat4.create();const z=l.tileID.wrap-i.wrap<<i.overscaledZ;w>0?(E=s.ab>>w,R=E*((l.tileID.canonical.x<<w)-i.canonical.x+z),L=E*((l.tileID.canonical.y<<w)-i.canonical.y)):(E=s.ab<<-w,R=s.ab*(l.tileID.canonical.x-(i.canonical.x+z<<-w)),L=s.ab*(l.tileID.canonical.y-(i.canonical.y<<-w))),s.a6.mat4.ortho(x,0,E,0,E,0,1),s.a6.mat4.translate(x,x,[R,L,0])}return new eg(l.tileID,i.key,x)}_findTileCoveringTileID(i,l){let p=l.getTile(i);if(p&&p.hasData())return p;const x=this._findCoveringTileCache[l.id],w=x[i.key];if(p=w?l.getTileByID(w):null,p&&p.hasData()||w===null)return p;let E=p?p.tileID:i,R=E.overscaledZ;const L=l.getSource().minzoom,z=[];if(!w){const G=l.getSource().maxzoom;if(i.canonical.z>=G){const Z=i.canonical.z-G;l.getSource().reparseOverscaled?(R=Math.max(i.canonical.z+2,l.transform.tileZoom),E=new s.aA(R,i.wrap,G,i.canonical.x>>Z,i.canonical.y>>Z)):Z!==0&&(R=G,E=new s.aA(R,i.wrap,G,i.canonical.x>>Z,i.canonical.y>>Z))}E.key!==i.key&&(z.push(E.key),p=l.getTile(E))}const B=G=>{z.forEach(Z=>{x[Z]=G}),z.length=0};for(R-=1;R>=L&&(!p||!p.hasData());R--){p&&B(p.tileID.key);const G=E.calculateScaledKey(R);if(p=l.getTileByID(G),p&&p.hasData())break;const Z=x[G];if(Z===null)break;Z===void 0?z.push(G):p=l.getTileByID(Z)}return B(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,l){let p=this._tilesDirty[i];p||(p=this._tilesDirty[i]={}),p[l.key]=!0}}function ng(f,i,l){const p=function(R,L,z){const B=s.a6.vec3.dot(L,R),G=s.a6.vec3.dot(z,[.2126,.7152,.0722]),Z=(se,oe,ae)=>(1-ae)*se+ae*oe,Y=Z(1-.3*Math.min(G,1),1,Math.min(B+1,1));return Z(.92,1,Math.asin(s.ap(L[2],-1,1))/Math.PI+.5)*Y}(f,[0,0,1],i),x=[0,0,0];s.a6.vec3.scale(x,l.slice(0,3),p);const w=[0,0,0];s.a6.vec3.scale(w,i.slice(0,3),f[2]);const E=[0,0,0];return s.a6.vec3.add(E,x,w),s.cb(E)}const kl=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Nx=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class Ka{static cacheKey(i,l,p,x){let w=`${l}${x?x.cacheKey:""}`;for(const E of p)i.usedDefines.includes(E)&&(w+=`/${E}`);return w}constructor(i,l,p,x,w,E){const R=i.gl;this.program=R.createProgram(),this.configuration=x,this.name=l,this.fixedDefines=[...E];const L=x?x.getBinderAttributes():[],z=(p.staticAttributes||[]).concat(L);let B=x?x.defines():[];B=B.concat(E.map(ae=>`#define ${ae}`));const G=`#version 300 es
`;let Z=G+B.concat("precision mediump float;",mf,Md.fragmentSource).join(`
`);for(const ae of p.fragmentIncludes)Z+=`
${Pd[ae]}`;Z+=`
${p.fragmentSource}`;let Y=G+B.concat("precision highp float;",mf,Md.vertexSource).join(`
`);for(const ae of p.vertexIncludes)Y+=`
${Pd[ae]}`;Y+=`
${p.vertexSource}`;const se=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);R.shaderSource(se,Z),R.compileShader(se),R.attachShader(this.program,se);const oe=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(oe,Y),R.compileShader(oe),R.attachShader(this.program,oe),this.attributes={},this.numAttributes=z.length;for(let ae=0;ae<this.numAttributes;ae++)if(z[ae]){const le=z[ae].startsWith("a_")?z[ae]:`a_${z[ae]}`;R.bindAttribLocation(this.program,ae,le),this.attributes[le]=ae}R.linkProgram(this.program),R.deleteShader(oe),R.deleteShader(se),this.fixedUniforms=w(i),this.binderUniforms=x?x.getUniforms(i):[],(E.includes("TERRAIN")||l.indexOf("symbol")!==-1||l.indexOf("circle")!==-1)&&(this.terrainUniforms=(ae=>({u_dem:new s.bJ(ae),u_dem_prev:new s.bJ(ae),u_dem_tl:new s.bG(ae),u_dem_scale:new s.bI(ae),u_dem_tl_prev:new s.bG(ae),u_dem_scale_prev:new s.bI(ae),u_dem_size:new s.bI(ae),u_dem_lerp:new s.bI(ae),u_exaggeration:new s.bI(ae),u_depth:new s.bJ(ae),u_depth_size_inv:new s.bG(ae),u_depth_range_unpack:new s.bG(ae),u_occluder_half_size:new s.bI(ae),u_occlusion_depth_offset:new s.bI(ae),u_meter_to_dem:new s.bI(ae),u_label_plane_matrix_inv:new s.bF(ae)}))(i)),E.includes("GLOBE")&&(this.globeUniforms=(ae=>({u_tile_tl_up:new s.bH(ae),u_tile_tr_up:new s.bH(ae),u_tile_br_up:new s.bH(ae),u_tile_bl_up:new s.bH(ae),u_tile_up_scale:new s.bI(ae)}))(i)),E.includes("FOG")&&(this.fogUniforms=(ae=>({u_fog_matrix:new s.bF(ae),u_fog_range:new s.bG(ae),u_fog_color:new s.c6(ae),u_fog_horizon_blend:new s.bI(ae),u_fog_vertical_limit:new s.bG(ae),u_fog_temporal_offset:new s.bI(ae),u_frustum_tl:new s.bH(ae),u_frustum_tr:new s.bH(ae),u_frustum_br:new s.bH(ae),u_frustum_bl:new s.bH(ae),u_globe_pos:new s.bH(ae),u_globe_radius:new s.bI(ae),u_globe_transition:new s.bI(ae),u_is_globe:new s.bJ(ae),u_viewport:new s.bG(ae)}))(i)),E.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ae=>({u_cutoff_params:new s.c6(ae)}))(i)),E.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ae=>({u_lighting_ambient_color:new s.bH(ae),u_lighting_directional_dir:new s.bH(ae),u_lighting_directional_color:new s.bH(ae),u_ground_radiance:new s.bH(ae)}))(i)),E.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ae=>({u_light_matrix_0:new s.bF(ae),u_light_matrix_1:new s.bF(ae),u_fade_range:new s.bG(ae),u_shadow_normal_offset:new s.bH(ae),u_shadow_intensity:new s.bI(ae),u_shadow_texel_size:new s.bI(ae),u_shadow_map_resolution:new s.bI(ae),u_shadow_direction:new s.bH(ae),u_shadow_bias:new s.bH(ae),u_shadowmap_0:new s.bJ(ae),u_shadowmap_1:new s.bJ(ae)}))(i))}}setTerrainUniformValues(i,l){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in l)p[x]&&p[x].set(this.program,x,l[x])}}setGlobeUniformValues(i,l){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in l)p[x]&&p[x].set(this.program,x,l[x])}}setFogUniformValues(i,l){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in l)p[x].set(this.program,x,l[x])}}setCutoffUniformValues(i,l){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in l)p[x].set(this.program,x,l[x])}}setLightsUniformValues(i,l){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in l)p[x].set(this.program,x,l[x])}}setShadowUniformValues(i,l){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;i.program.set(this.program);for(const x in l)p[x].set(this.program,x,l[x])}_drawDebugWireframe(i,l,p,x,w,E,R,L,z,B){const G=i.options.wireframe;if(G.terrain===!1&&G.layers2D===!1&&G.layers3D===!1)return;const Z=i.context;if(!(!(!G.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!G.layers2D||i._terrain&&i._terrain.renderingToTexture||!kl.includes(this.name))||!(!G.layers3D||!Nx.includes(this.name))))return;const Y=Z.gl,se=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,w,Z);if(!se)return;const oe=[...this.fixedDefines];oe.push("DEBUG_WIREFRAME");const ae=i.getOrCreateProgram(this.name,{config:this.configuration,defines:oe});Z.program.set(ae.program);const le=(fe,be,ve)=>{if(be[fe]&&ve[fe])for(const Pe in be[fe])ve[fe][Pe]&&ve[fe][Pe].set(ve.program,Pe,be[fe][Pe].current)};z&&z.setUniforms(ae.program,Z,ae.binderUniforms,R,{zoom:L}),le("fixedUniforms",this,ae),le("terrainUniforms",this,ae),le("globeUniforms",this,ae),le("fogUniforms",this,ae),le("lightsUniforms",this,ae),le("shadowUniforms",this,ae),se.bind(),Z.setColorMode(new En([Y.ONE,Y.ONE_MINUS_SRC_ALPHA,Y.ZERO,Y.ONE],s.bz.transparent,[!0,!0,!0,!1])),Z.setDepthMode(new qt(l.func===Y.LESS?Y.LEQUAL:l.func,qt.ReadOnly,l.range)),Z.setStencilMode(un.disabled);const me=3*E.primitiveLength*2,ye=3*E.primitiveOffset*2*2;B&&B>1?Y.drawElementsInstanced(Y.LINES,me,Y.UNSIGNED_SHORT,ye,B):Y.drawElements(Y.LINES,me,Y.UNSIGNED_SHORT,ye),w.bind(),Z.program.set(this.program),Z.setDepthMode(l),Z.setStencilMode(p),Z.setColorMode(x)}draw(i,l,p,x,w,E,R,L,z,B,G,Z,Y,se,oe,ae){const le=i.context,me=le.gl;if(this.failedToCreate)return;le.program.set(this.program),le.setDepthMode(p),le.setStencilMode(x),le.setColorMode(w),le.setCullFace(E);for(const be of Object.keys(this.fixedUniforms))this.fixedUniforms[be].set(this.program,be,R[be]);se&&se.setUniforms(this.program,le,this.binderUniforms,Z,{zoom:Y});const ye={[me.POINTS]:1,[me.LINES]:2,[me.TRIANGLES]:3,[me.LINE_STRIP]:1}[l],fe=ae&&ae>0?1:void 0;for(const be of G.get()){const ve=be.vaos||(be.vaos={});(ve[L]||(ve[L]=new $c)).bind(le,this,z,se?se.getPaintVertexBuffers():[],B,be.vertexOffset,oe||[],fe),ae&&ae>1?me.drawElementsInstanced(l,be.primitiveLength*ye,me.UNSIGNED_SHORT,be.primitiveOffset*ye*2,ae):B?me.drawElements(l,be.primitiveLength*ye,me.UNSIGNED_SHORT,be.primitiveOffset*ye*2):me.drawArrays(l,be.vertexOffset,be.vertexLength),l===me.TRIANGLES&&B&&this._drawDebugWireframe(i,p,x,w,B,be,Z,Y,se,ae)}}}function rg(f,i){const l=Math.pow(2,i.tileID.overscaledZ),p=i.tileSize*Math.pow(2,f.transform.tileZoom)/l,x=p*(i.tileID.canonical.x+i.tileID.wrap*l),w=p*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ak(i,1,f.transform.tileZoom),u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}const Tf=s.a6.mat4.create(),ig=(f,i,l,p,x,w,E,R,L,z,B,G,Z,Y,se,oe)=>{const ae=i.style.light,le=ae.properties.get("position"),me=[le.x,le.y,le.z],ye=s.a6.mat3.create();ae.properties.get("anchor")==="viewport"&&(s.a6.mat3.fromRotation(ye,-i.transform.angle),s.a6.vec3.transformMat3(me,me,ye));const fe=ae.properties.get("color"),be=i.transform,ve={u_matrix:f,u_lightpos:me,u_lightintensity:ae.properties.get("intensity"),u_lightcolor:[fe.r,fe.g,fe.b],u_vertical_gradient:+l,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Tf,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:w,u_width_scale:E,u_flood_light_color:Z,u_vertical_scale:Y,u_flood_light_intensity:se,u_ground_shadow_factor:oe};return be.projection.name==="globe"&&(ve.u_tile_id=[R.canonical.x,R.canonical.y,1<<R.canonical.z],ve.u_zoom_transition=z,ve.u_inv_rot_matrix=G,ve.u_merc_center=B,ve.u_up_dir=be.projection.upVector(new s.bP(0,0,0),B[0]*s.ab,B[1]*s.ab),ve.u_height_lift=L),ve},Lx=(f,i,l,p)=>({u_matrix:f,u_edge_radius:i,u_width_scale:l,u_vertical_scale:p}),sg=(f,i,l,p,x,w,E,R,L,z,B,G,Z,Y,se)=>{const oe=ig(f,i,l,p,x,w,E,R,z,B,G,Z,Y,se,1,[0,0,0]),ae={u_height_factor:-Math.pow(2,R.overscaledZ)/L.tileSize/8};return s.l(oe,rg(i,L),ae)},Ef=(f,i)=>({u_matrix:f,u_emissive_strength:i}),Ox=(f,i,l,p)=>s.l(Ef(f,i),rg(l,p)),jx=(f,i,l)=>({u_matrix:f,u_world:l,u_emissive_strength:i}),Od=(f,i,l,p,x)=>s.l(Ox(f,i,l,p),{u_world:x}),hw=(f,i,l,p)=>{const x=s.ab/l.tileSize;return{u_matrix:f,u_camera_to_center_distance:i.getCameraToCenterDistance(p),u_extrude_scale:[i.pixelsToGLUnits[0]/x,i.pixelsToGLUnits[1]/x]}},zx=(f,i,l=1)=>({u_matrix:f,u_color:i.toRenderColor(null),u_overlay:0,u_overlay_scale:l}),Fx=s.a6.mat4.create(),fw=(f,i,l,p,x,w,E)=>{const R=f.transform,L=R.projection.name==="globe",z=L?s.cI(R.zoom,i.canonical)*R._pixelsPerMercatorPixel:s.ak(l,1,w),B={u_matrix:i.projMatrix,u_extrude_scale:z,u_intensity:E,u_inv_rot_matrix:Fx,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(L){B.u_inv_rot_matrix=p,B.u_merc_center=x,B.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],B.u_zoom_transition=s.a9(R.zoom);const G=x[0]*s.ab,Z=x[1]*s.ab;B.u_up_dir=R.projection.upVector(new s.bP(0,0,0),G,Z)}return B};function Cf(f,[i,l,p,x],[w,E]){if(w===E)return[0,0,0,0];const R=255*(f-1)/(f*(E-w));return[i*R,l*R,p*R,x*R]}function Pf(f,i,[l,p]){return l===p?0:.5/f+(i-l)*(f-1)/(f*(p-l))}const jd=(f,i,l,p,x,w,E,R,L,z,B,G,Z,Y,se,oe,ae,le,me,ye,fe)=>({u_matrix:f,u_normalize_matrix:i,u_globe_matrix:l,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:w,u_scale_parent:z,u_fade_t:B.mix,u_opacity:B.opacity*G.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:G.paint.get("raster-brightness-min"),u_brightness_high:G.paint.get("raster-brightness-max"),u_saturation_factor:s.cJ(G.paint.get("raster-saturation")),u_contrast_factor:s.cK(G.paint.get("raster-contrast")),u_spin_weights:og(G.paint.get("raster-hue-rotate")),u_perspective_transform:Z,u_raster_elevation:Y,u_zoom_transition:E,u_merc_center:R,u_cutoff_params:L,u_colorization_mix:Cf(s.cL,oe,le),u_colorization_offset:Pf(s.cL,ae,le),u_color_ramp:se,u_texture_offset:[ye/(me+2*ye),me/(me+2*ye)],u_texture_res:[me+2*ye,me+2*ye],u_emissive_strength:fe});function og(f){f*=Math.PI/180;const i=Math.sin(f),l=Math.cos(f);return[(2*l+1)/3,(-Math.sqrt(3)*i-l+1)/3,(Math.sqrt(3)*i-l+1)/3]}const Fo=.05,Bx=(f,i,l,p,x,w,E,R,L,z,B,G)=>({u_matrix:f,u_normalize_matrix:i,u_globe_matrix:l,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:w,u_scale_parent:z,u_fade_t:B.mix,u_opacity:B.opacity,u_image0:0,u_image1:1,u_raster_elevation:G,u_zoom_transition:E,u_merc_center:R,u_cutoff_params:L}),Mf=(f,i,l,p,x,w,E,R,L,z)=>({u_particle_texture:f,u_particle_texture_side_len:i,u_tile_offset:l,u_velocity:p,u_color_ramp:w,u_velocity_res:x,u_max_speed:E,u_uv_offset:R,u_data_scale:[255*L[0],255*L[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[Fo,Fo]}),Af=(f,i,l,p,x,w,E,R,L,z)=>({u_particle_texture:f,u_particle_texture_side_len:i,u_velocity:l,u_velocity_res:p,u_max_speed:x,u_speed_factor:w,u_reset_rate:E,u_rand_seed:Math.random(),u_uv_offset:R,u_data_scale:[255*L[0],255*L[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[Fo,Fo]}),If=s.a6.mat4.create(),ag=(f,i,l,p,x,w,E,R,L,z,B,G,Z,Y,se,oe,ae,le,me,ye,fe)=>{const be=x.transform,ve={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:be.getCameraToCenterDistance(me),u_rotate_symbol:+l,u_aspect_ratio:be.width/be.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:E,u_coord_matrix:R,u_is_text:+z,u_elevation_from_sea:L?1:0,u_pitch_with_map:+p,u_texsize:B,u_texsize_icon:G,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:If,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:If,u_up_vector:[0,-1,0],u_color_adj_mat:ye,u_icon_transition:fe||0,u_gamma_scale:p?x.transform.getCameraToCenterDistance(me)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:s.q.devicePixelRatio,u_is_halo:+Z};return me.name==="globe"&&(ve.u_tile_id=[Y.canonical.x,Y.canonical.y,1<<Y.canonical.z],ve.u_zoom_transition=se,ve.u_inv_rot_matrix=ae,ve.u_merc_center=oe,ve.u_camera_forward=be._camera.forward(),ve.u_ecef_origin=s.cM(be.globeMatrix,Y.toUnwrapped()),ve.u_tile_matrix=Float32Array.from(be.globeMatrix),ve.u_up_vector=le),ve},Vx=(f,i,l,p)=>({u_matrix:f,u_emissive_strength:i,u_opacity:l,u_color:p}),Nl=(f,i,l,p,x,w,E,R,L)=>s.l(function(z,B,G,Z,Y,se){const{width:oe,height:ae}=Z.imageManager.getPixelSize(B),le=Math.pow(2,se.tileID.overscaledZ),me=se.tileSize*Math.pow(2,Z.transform.tileZoom)/le,ye=me*(se.tileID.canonical.x+se.tileID.wrap*le),fe=me*se.tileID.canonical.y;return{u_image:0,u_pattern_tl:G.tl,u_pattern_br:G.br,u_texsize:[oe,ae],u_pattern_size:G.displaySize,u_pattern_units_to_pixels:Y?[Z.transform.width,-1*Z.transform.height]:[1/s.ak(se,1,Z.transform.tileZoom),1/s.ak(se,1,Z.transform.tileZoom)],u_pixel_coord_upper:[ye>>16,fe>>16],u_pixel_coord_lower:[65535&ye,65535&fe]}}(0,w,E,p,R,L),{u_matrix:f,u_emissive_strength:i,u_opacity:l}),Zc=new Float32Array(s.a6.mat4.identity([])),Ot=(f,i,l,p,x,w,E,R,L,z,B,G,Z,Y=[0,0,0],se)=>{const oe=x.style.light,ae=oe.properties.get("position"),le=[-ae.x,-ae.y,ae.z],me=s.a6.mat3.create();oe.properties.get("anchor")==="viewport"&&(s.a6.mat3.fromRotation(me,-x.transform.angle),s.a6.vec3.transformMat3(le,le,me));const ye=B.alphaMode==="MASK",fe=oe.properties.get("color").toRenderColor(null),be=Z.paint.get("model-ambient-occlusion-intensity"),ve=Z.paint.get("model-color").constantOr(s.bz.white).toRenderColor(null),Pe=Z.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:f,u_lighting_matrix:i,u_normal_matrix:l,u_node_matrix:p||Zc,u_lightpos:le,u_lightintensity:oe.properties.get("intensity"),u_lightcolor:[fe.r,fe.g,fe.b],u_camera_pos:Y,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+ye,u_alphaCutoff:B.alphaCutoff,u_baseColorFactor:[E.r,E.g,E.b,E.a],u_emissiveFactor:[R[0],R[1],R[2],1],u_metallicFactor:L,u_roughnessFactor:z,u_baseColorTexture:Ni.BaseColor,u_metallicRoughnessTexture:Ni.MetallicRoughness,u_normalTexture:Ni.Normal,u_occlusionTexture:Ni.Occlusion,u_emissionTexture:Ni.Emission,u_lutTexture:Ni.LUT,u_color_mix:[ve.r,ve.g,ve.b,Pe],u_aoIntensity:be,u_emissive_strength:G,u_occlusionTextureTransform:se||[0,0,0,0]}},lg=(f,i=Zc,l=Zc)=>({u_matrix:f,u_instance:i,u_node_matrix:l}),Ux={fillExtrusion:f=>({u_matrix:new s.bF(f),u_lightpos:new s.bH(f),u_lightintensity:new s.bI(f),u_lightcolor:new s.bH(f),u_vertical_gradient:new s.bI(f),u_opacity:new s.bI(f),u_edge_radius:new s.bI(f),u_width_scale:new s.bI(f),u_ao:new s.bG(f),u_tile_id:new s.bH(f),u_zoom_transition:new s.bI(f),u_inv_rot_matrix:new s.bF(f),u_merc_center:new s.bG(f),u_up_dir:new s.bH(f),u_height_lift:new s.bI(f),u_flood_light_color:new s.bH(f),u_vertical_scale:new s.bI(f),u_flood_light_intensity:new s.bI(f),u_ground_shadow_factor:new s.bH(f)}),fillExtrusionDepth:f=>({u_matrix:new s.bF(f),u_edge_radius:new s.bI(f),u_width_scale:new s.bI(f),u_vertical_scale:new s.bI(f)}),fillExtrusionPattern:f=>({u_matrix:new s.bF(f),u_lightpos:new s.bH(f),u_lightintensity:new s.bI(f),u_lightcolor:new s.bH(f),u_vertical_gradient:new s.bI(f),u_height_factor:new s.bI(f),u_edge_radius:new s.bI(f),u_width_scale:new s.bI(f),u_ao:new s.bG(f),u_tile_id:new s.bH(f),u_zoom_transition:new s.bI(f),u_inv_rot_matrix:new s.bF(f),u_merc_center:new s.bG(f),u_up_dir:new s.bH(f),u_height_lift:new s.bI(f),u_image:new s.bJ(f),u_texsize:new s.bG(f),u_pixel_coord_upper:new s.bG(f),u_pixel_coord_lower:new s.bG(f),u_tile_units_to_pixels:new s.bI(f),u_opacity:new s.bI(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new s.bF(f),u_opacity:new s.bI(f),u_ao_pass:new s.bI(f),u_meter_to_tile:new s.bI(f),u_ao:new s.bG(f),u_flood_light_intensity:new s.bI(f),u_flood_light_color:new s.bH(f),u_attenuation:new s.bI(f),u_edge_radius:new s.bI(f),u_fb:new s.bJ(f),u_fb_size:new s.bI(f),u_dynamic_offset:new s.bI(f)}),fill:f=>({u_matrix:new s.bF(f),u_emissive_strength:new s.bI(f)}),fillPattern:f=>({u_matrix:new s.bF(f),u_emissive_strength:new s.bI(f),u_image:new s.bJ(f),u_texsize:new s.bG(f),u_pixel_coord_upper:new s.bG(f),u_pixel_coord_lower:new s.bG(f),u_tile_units_to_pixels:new s.bI(f)}),fillOutline:f=>({u_matrix:new s.bF(f),u_emissive_strength:new s.bI(f),u_world:new s.bG(f)}),fillOutlinePattern:f=>({u_matrix:new s.bF(f),u_emissive_strength:new s.bI(f),u_world:new s.bG(f),u_image:new s.bJ(f),u_texsize:new s.bG(f),u_pixel_coord_upper:new s.bG(f),u_pixel_coord_lower:new s.bG(f),u_tile_units_to_pixels:new s.bI(f)}),circle:s.cN,collisionBox:f=>({u_matrix:new s.bF(f),u_camera_to_center_distance:new s.bI(f),u_extrude_scale:new s.bG(f)}),collisionCircle:f=>({u_matrix:new s.bF(f),u_inv_matrix:new s.bF(f),u_camera_to_center_distance:new s.bI(f),u_viewport_size:new s.bG(f)}),debug:f=>({u_color:new s.cu(f),u_matrix:new s.bF(f),u_overlay:new s.bJ(f),u_overlay_scale:new s.bI(f)}),clippingMask:f=>({u_matrix:new s.bF(f)}),heatmap:f=>({u_extrude_scale:new s.bI(f),u_intensity:new s.bI(f),u_matrix:new s.bF(f),u_inv_rot_matrix:new s.bF(f),u_merc_center:new s.bG(f),u_tile_id:new s.bH(f),u_zoom_transition:new s.bI(f),u_up_dir:new s.bH(f)}),heatmapTexture:f=>({u_image:new s.bJ(f),u_color_ramp:new s.bJ(f),u_opacity:new s.bI(f)}),hillshade:f=>({u_matrix:new s.bF(f),u_image:new s.bJ(f),u_latrange:new s.bG(f),u_light:new s.bG(f),u_shadow:new s.cu(f),u_highlight:new s.cu(f),u_emissive_strength:new s.bI(f),u_accent:new s.cu(f)}),hillshadePrepare:f=>({u_matrix:new s.bF(f),u_image:new s.bJ(f),u_dimension:new s.bG(f),u_zoom:new s.bI(f)}),line:s.cO,linePattern:s.cP,raster:f=>({u_matrix:new s.bF(f),u_normalize_matrix:new s.bF(f),u_globe_matrix:new s.bF(f),u_merc_matrix:new s.bF(f),u_grid_matrix:new s.cv(f),u_tl_parent:new s.bG(f),u_scale_parent:new s.bI(f),u_fade_t:new s.bI(f),u_opacity:new s.bI(f),u_image0:new s.bJ(f),u_image1:new s.bJ(f),u_brightness_low:new s.bI(f),u_brightness_high:new s.bI(f),u_saturation_factor:new s.bI(f),u_contrast_factor:new s.bI(f),u_spin_weights:new s.bH(f),u_perspective_transform:new s.bG(f),u_raster_elevation:new s.bI(f),u_zoom_transition:new s.bI(f),u_merc_center:new s.bG(f),u_cutoff_params:new s.c6(f),u_colorization_mix:new s.c6(f),u_colorization_offset:new s.bI(f),u_color_ramp:new s.bJ(f),u_texture_offset:new s.bG(f),u_texture_res:new s.bG(f),u_emissive_strength:new s.bI(f)}),rasterParticle:f=>({u_matrix:new s.bF(f),u_normalize_matrix:new s.bF(f),u_globe_matrix:new s.bF(f),u_merc_matrix:new s.bF(f),u_grid_matrix:new s.cv(f),u_tl_parent:new s.bG(f),u_scale_parent:new s.bI(f),u_fade_t:new s.bI(f),u_opacity:new s.bI(f),u_image0:new s.bJ(f),u_image1:new s.bJ(f),u_raster_elevation:new s.bI(f),u_zoom_transition:new s.bI(f),u_merc_center:new s.bG(f),u_cutoff_params:new s.c6(f)}),rasterParticleTexture:f=>({u_texture:new s.bJ(f),u_opacity:new s.bI(f)}),rasterParticleDraw:f=>({u_particle_texture:new s.bJ(f),u_particle_texture_side_len:new s.bI(f),u_tile_offset:new s.bG(f),u_velocity:new s.bJ(f),u_color_ramp:new s.bJ(f),u_velocity_res:new s.bG(f),u_max_speed:new s.bI(f),u_uv_offset:new s.bG(f),u_data_scale:new s.bG(f),u_data_offset:new s.bI(f),u_particle_pos_scale:new s.bI(f),u_particle_pos_offset:new s.bG(f)}),rasterParticleUpdate:f=>({u_particle_texture:new s.bJ(f),u_particle_texture_side_len:new s.bI(f),u_velocity:new s.bJ(f),u_velocity_res:new s.bG(f),u_max_speed:new s.bI(f),u_speed_factor:new s.bI(f),u_reset_rate:new s.bI(f),u_rand_seed:new s.bI(f),u_uv_offset:new s.bG(f),u_data_scale:new s.bG(f),u_data_offset:new s.bI(f),u_particle_pos_scale:new s.bI(f),u_particle_pos_offset:new s.bG(f)}),symbol:f=>({u_is_size_zoom_constant:new s.bJ(f),u_is_size_feature_constant:new s.bJ(f),u_size_t:new s.bI(f),u_size:new s.bI(f),u_camera_to_center_distance:new s.bI(f),u_rotate_symbol:new s.bJ(f),u_aspect_ratio:new s.bI(f),u_fade_change:new s.bI(f),u_matrix:new s.bF(f),u_label_plane_matrix:new s.bF(f),u_coord_matrix:new s.bF(f),u_is_text:new s.bJ(f),u_elevation_from_sea:new s.bJ(f),u_pitch_with_map:new s.bJ(f),u_texsize:new s.bG(f),u_texsize_icon:new s.bG(f),u_texture:new s.bJ(f),u_texture_icon:new s.bJ(f),u_gamma_scale:new s.bI(f),u_device_pixel_ratio:new s.bI(f),u_tile_id:new s.bH(f),u_zoom_transition:new s.bI(f),u_inv_rot_matrix:new s.bF(f),u_merc_center:new s.bG(f),u_camera_forward:new s.bH(f),u_tile_matrix:new s.bF(f),u_up_vector:new s.bH(f),u_ecef_origin:new s.bH(f),u_is_halo:new s.bJ(f),u_icon_transition:new s.bI(f),u_color_adj_mat:new s.bF(f)}),background:f=>({u_matrix:new s.bF(f),u_emissive_strength:new s.bI(f),u_opacity:new s.bI(f),u_color:new s.cu(f)}),backgroundPattern:f=>({u_matrix:new s.bF(f),u_emissive_strength:new s.bI(f),u_opacity:new s.bI(f),u_image:new s.bJ(f),u_pattern_tl:new s.bG(f),u_pattern_br:new s.bG(f),u_texsize:new s.bG(f),u_pattern_size:new s.bG(f),u_pixel_coord_upper:new s.bG(f),u_pixel_coord_lower:new s.bG(f),u_pattern_units_to_pixels:new s.bG(f)}),terrainRaster:f=>({u_matrix:new s.bF(f),u_image0:new s.bJ(f),u_skirt_height:new s.bI(f),u_ground_shadow_factor:new s.bH(f)}),skybox:f=>({u_matrix:new s.bF(f),u_sun_direction:new s.bH(f),u_cubemap:new s.bJ(f),u_opacity:new s.bI(f),u_temporal_offset:new s.bI(f)}),skyboxGradient:f=>({u_matrix:new s.bF(f),u_color_ramp:new s.bJ(f),u_center_direction:new s.bH(f),u_radius:new s.bI(f),u_opacity:new s.bI(f),u_temporal_offset:new s.bI(f)}),skyboxCapture:f=>({u_matrix_3f:new s.cv(f),u_sun_direction:new s.bH(f),u_sun_intensity:new s.bI(f),u_color_tint_r:new s.c6(f),u_color_tint_m:new s.c6(f),u_luminance:new s.bI(f)}),globeRaster:f=>({u_proj_matrix:new s.bF(f),u_globe_matrix:new s.bF(f),u_normalize_matrix:new s.bF(f),u_merc_matrix:new s.bF(f),u_zoom_transition:new s.bI(f),u_merc_center:new s.bG(f),u_image0:new s.bJ(f),u_grid_matrix:new s.cv(f),u_skirt_height:new s.bI(f),u_far_z_cutoff:new s.bI(f),u_frustum_tl:new s.bH(f),u_frustum_tr:new s.bH(f),u_frustum_br:new s.bH(f),u_frustum_bl:new s.bH(f),u_globe_pos:new s.bH(f),u_globe_radius:new s.bI(f),u_viewport:new s.bG(f)}),globeAtmosphere:f=>({u_frustum_tl:new s.bH(f),u_frustum_tr:new s.bH(f),u_frustum_br:new s.bH(f),u_frustum_bl:new s.bH(f),u_horizon:new s.bI(f),u_transition:new s.bI(f),u_fadeout_range:new s.bI(f),u_color:new s.c6(f),u_high_color:new s.c6(f),u_space_color:new s.c6(f),u_temporal_offset:new s.bI(f),u_horizon_angle:new s.bI(f)}),model:f=>({u_matrix:new s.bF(f),u_lighting_matrix:new s.bF(f),u_normal_matrix:new s.bF(f),u_node_matrix:new s.bF(f),u_lightpos:new s.bH(f),u_lightintensity:new s.bI(f),u_lightcolor:new s.bH(f),u_camera_pos:new s.bH(f),u_opacity:new s.bI(f),u_baseColorFactor:new s.c6(f),u_emissiveFactor:new s.c6(f),u_metallicFactor:new s.bI(f),u_roughnessFactor:new s.bI(f),u_baseTextureIsAlpha:new s.bJ(f),u_alphaMask:new s.bJ(f),u_alphaCutoff:new s.bI(f),u_baseColorTexture:new s.bJ(f),u_metallicRoughnessTexture:new s.bJ(f),u_normalTexture:new s.bJ(f),u_occlusionTexture:new s.bJ(f),u_emissionTexture:new s.bJ(f),u_lutTexture:new s.bJ(f),u_color_mix:new s.c6(f),u_aoIntensity:new s.bI(f),u_emissive_strength:new s.bI(f),u_occlusionTextureTransform:new s.c6(f)}),modelDepth:f=>({u_matrix:new s.bF(f),u_instance:new s.bF(f),u_node_matrix:new s.bF(f)}),groundShadow:f=>({u_matrix:new s.bF(f),u_ground_shadow_factor:new s.bH(f)}),stars:f=>({u_matrix:new s.bF(f),u_up:new s.bH(f),u_right:new s.bH(f),u_intensity_multiplier:new s.bI(f)}),occlusion:f=>({u_matrix:new s.bF(f),u_anchorPos:new s.bH(f),u_screenSizePx:new s.bG(f),u_occluderSizePx:new s.bG(f),u_color:new s.c6(f)})};class ds{constructor(i,l,p,x){this.id=ds.uniqueIdxCounter,ds.uniqueIdxCounter++,this.context=i;const w=i.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||x||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){this.id=ds.uniqueIdxCounter,ds.uniqueIdxCounter++;const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}ds.uniqueIdxCounter=0;const Ll={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class $t{constructor(i,l,p,x,w,E){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=x,this.instanceCount=E,this.context=i;const R=i.gl;this.buffer=R.createBuffer(),i.bindVertexBuffer.set(this.buffer),R.bufferData(R.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?R.DYNAMIC_DRAW:R.STATIC_DRAW),this.dynamicDraw||w||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,l){for(let p=0;p<this.attributes.length;p++){const x=l.attributes[this.attributes[p].name];x!==void 0&&i.enableVertexAttribArray(x)}}setVertexAttribPointers(i,l,p){for(let x=0;x<this.attributes.length;x++){const w=this.attributes[x],E=l.attributes[w.name];E!==void 0&&i.vertexAttribPointer(E,w.components,i[Ll[w.type]],!1,this.itemSize,w.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(i,l,p){for(let x=0;x<this.attributes.length;x++){const w=l.attributes[this.attributes[x].name];w!==void 0&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(w,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Df{constructor(i,l,p,x,w){this.context=i,this.width=l,this.height=p;const E=this.framebuffer=i.gl.createFramebuffer();x&&(this.colorAttachment=new wf(i,E)),w&&(this.depthAttachmentType=w,this.depthAttachment=w==="renderbuffer"?new Jm(i,E):new Mx(i,E))}destroy(){const i=this.context.gl;if(this.colorAttachment){const l=this.colorAttachment.get();l&&i.deleteTexture(l)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const l=this.depthAttachment.get();l&&i.deleteRenderbuffer(l)}else{const l=this.depthAttachment.get();l&&i.deleteTexture(l)}i.deleteFramebuffer(this.framebuffer)}}class pw{constructor(i,l){this.gl=i,this.clearColor=new Um(this),this.clearDepth=new vx(this),this.clearStencil=new $m(this),this.colorMask=new _f(this),this.depthMask=new Dd(this),this.stencilMask=new bx(this),this.stencilFunc=new wx(this),this.stencilOp=new Sx(this),this.stencilTest=new Gc(this),this.depthRange=new Tx(this),this.depthTest=new aw(this),this.depthFunc=new lw(this),this.blend=new cw(this),this.blendFunc=new Gm(this),this.blendColor=new Wm(this),this.blendEquation=new Hm(this),this.cullFace=new qm(this),this.cullFaceSide=new Ex(this),this.frontFace=new Cx(this),this.program=new uw(this),this.activeTexture=new Rd(this),this.viewport=new kd(this),this.bindFramebuffer=new Px(this),this.bindRenderbuffer=new As(this),this.bindTexture=new Zm(this),this.bindVertexBuffer=new xf(this),this.bindElementBuffer=new vf(this),this.bindVertexArrayOES=new Xm(this),this.pixelStoreUnpack=new Ym(this),this.pixelStoreUnpackPremultiplyAlpha=new bf(this),this.pixelStoreUnpackFlipY=new Km(this),this.options=l?{...l}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxPointSize=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,l,p){return new ds(this,i,l,p)}createVertexBuffer(i,l,p,x,w){return new $t(this,i,l,p,x,w)}createRenderbuffer(i,l,p){const x=this.gl,w=x.createRenderbuffer();return this.bindRenderbuffer.set(w),x.renderbufferStorage(x.RENDERBUFFER,i,l,p),this.bindRenderbuffer.set(null),w}createFramebuffer(i,l,p,x){return new Df(this,i,l,p,x)}clear({color:i,depth:l,stencil:p,colorMask:x}){const w=this.gl;let E=0;i&&(E|=w.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set(x||[!0,!0,!0,!0])),l!==void 0&&(E|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),p!==void 0&&(E|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),w.clear(E)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){s.bh(i.blendFunction,En.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Rf;function kf(f,i,l,p,x,w,E){const R=f.context,L=R.gl,z=f.transform,B=f.getOrCreateProgram("collisionBox"),G=[];let Z=0,Y=0;for(let fe=0;fe<p.length;fe++){const be=p[fe],ve=i.getTile(be),Pe=ve.getBucket(l);if(!Pe)continue;const Te=ax(be,Pe,z);let Me=Te;x[0]===0&&x[1]===0||(Me=f.translatePosMatrix(Te,ve,x,w));const Oe=E?Pe.textCollisionBox:Pe.iconCollisionBox,ke=Pe.collisionCircleArray;if(ke.length>0){const De=s.a6.mat4.create(),Ue=Me;s.a6.mat4.mul(De,Pe.placementInvProjMatrix,z.glCoordMatrix),s.a6.mat4.mul(De,De,Pe.placementViewportMatrix),G.push({circleArray:ke,circleOffset:Y,transform:Ue,invTransform:De,projection:Pe.getProjection()}),Z+=ke.length/4,Y=Z}Oe&&(f.terrain&&f.terrain.setupElevationDraw(ve,B),B.draw(f,L.LINES,qt.disabled,un.disabled,f.colorModeForRenderPass(),tn.disabled,hw(Me,z,ve,Pe.getProjection()),l.id,Oe.layoutVertexBuffer,Oe.indexBuffer,Oe.segments,null,z.zoom,null,[Oe.collisionVertexBuffer,Oe.collisionVertexBufferExt]))}if(!E||!G.length)return;const se=f.getOrCreateProgram("collisionCircle"),oe=new s.cQ;oe.resize(4*Z),oe._trim();let ae=0;for(const fe of G)for(let be=0;be<fe.circleArray.length/4;be++){const ve=4*be,Pe=fe.circleArray[ve+0],Te=fe.circleArray[ve+1],Me=fe.circleArray[ve+2],Oe=fe.circleArray[ve+3];oe.emplace(ae++,Pe,Te,Me,Oe,0),oe.emplace(ae++,Pe,Te,Me,Oe,1),oe.emplace(ae++,Pe,Te,Me,Oe,2),oe.emplace(ae++,Pe,Te,Me,Oe,3)}(!Rf||Rf.length<2*Z)&&(Rf=function(fe){const be=2*fe,ve=new s.aO;ve.resize(be),ve._trim();for(let Pe=0;Pe<be;Pe++){const Te=6*Pe;ve.uint16[Te+0]=4*Pe+0,ve.uint16[Te+1]=4*Pe+1,ve.uint16[Te+2]=4*Pe+2,ve.uint16[Te+3]=4*Pe+2,ve.uint16[Te+4]=4*Pe+3,ve.uint16[Te+5]=4*Pe+0}return ve}(Z));const le=R.createIndexBuffer(Rf,!0),me=R.createVertexBuffer(oe,s.cR.members,!0);for(const fe of G){const be={u_matrix:fe.transform,u_inv_matrix:fe.invTransform,u_camera_to_center_distance:(ye=z).getCameraToCenterDistance(fe.projection),u_viewport_size:[ye.width,ye.height]};se.draw(f,L.TRIANGLES,qt.disabled,un.disabled,f.colorModeForRenderPass(),tn.disabled,be,l.id,me,le,s.b1.simpleSegment(0,2*fe.circleOffset,fe.circleArray.length,fe.circleArray.length/2),null,z.zoom)}var ye;me.destroy(),le.destroy()}const zd=s.a6.mat4.create();function cg(f){const i=f._camera.getWorldToCamera(f.worldSize,1),l=s.a6.mat4.multiply([],i,f.globeMatrix);s.a6.mat4.invert(l,l);const p=[0,0,0],x=[0,1,0,0];return s.a6.vec4.transformMat4(x,x,l),p[0]=x[0],p[1]=x[1],p[2]=x[2],s.a6.vec3.normalize(p,p),p}function mw({width:f,height:i,anchor:l,textOffset:p,textScale:x},w){const{horizontalAlign:E,verticalAlign:R}=s.bx(l),L=-(E-.5)*f,z=-(R-.5)*i,B=s.bw(l,p);return new s.P((L/x+B[0])*w,(z/x+B[1])*w)}function gw(f,i,l,p,x,w,E,R,L,z,B){const G=f.text.placedSymbolArray,Z=f.text.dynamicLayoutVertexArray,Y=f.icon.dynamicLayoutVertexArray,se={},oe=f.getProjection(),ae=qa(R,oe,w),le=w.elevation,me=oe.upVectorScale(R.canonical,w.center.lat,w.worldSize).metersToTile;Z.clear();for(let ye=0;ye<G.length;ye++){const fe=G.get(ye),{tileAnchorX:be,tileAnchorY:ve,numGlyphs:Pe}=fe,Te=fe.hidden||!fe.crossTileID||f.allowVerticalPlacement&&!fe.placedOrientation?null:p[fe.crossTileID];if(Te){let Me=0,Oe=0,ke=0;if(le){const it=le?le.getAtTileOffset(R,be,ve):0,[_t,vt,at]=oe.upVector(R.canonical,be,ve);Me=it*_t*me,Oe=it*vt*me,ke=it*at*me}let[De,Ue,et,lt]=Vi(fe.projectedAnchorX+Me,fe.projectedAnchorY+Oe,fe.projectedAnchorZ+ke,l?ae:E);const Qe=On(w.getCameraToCenterDistance(oe),lt);let gt=x.evaluateSizeForFeature(f.textSizeData,z,fe)*Qe/s.bq;l&&(gt*=f.tilePixelRatio/L);const $e=mw(Te,gt);l?({x:De,y:Ue,z:et}=oe.projectTilePoint(be+$e.x,ve+$e.y,R.canonical),[De,Ue,et]=Vi(De+Me,Ue+Oe,et+ke,E)):(i&&$e._rotate(-w.angle),De+=$e.x,Ue+=$e.y,et=0);const ot=f.allowVerticalPlacement&&fe.placedOrientation===s.bk.vertical?Math.PI/2:0;for(let it=0;it<Pe;it++)s.bn(Z,De,Ue,et,ot);B&&fe.associatedIconIndex>=0&&(se[fe.associatedIconIndex]={x:De,y:Ue,z:et,angle:ot})}else zo(Pe,Z)}if(B){Y.clear();const ye=f.icon.placedSymbolArray;for(let fe=0;fe<ye.length;fe++){const be=ye.get(fe),{numGlyphs:ve}=be,Pe=se[fe];if(be.hidden||!Pe)zo(ve,Y);else{const{x:Te,y:Me,z:Oe,angle:ke}=Pe;for(let De=0;De<ve;De++)s.bn(Y,Te,Me,Oe,ke)}}f.icon.dynamicLayoutVertexBuffer.updateData(Y)}f.text.dynamicLayoutVertexBuffer.updateData(Z)}function Fd(f,i,l,p,x,w,E={}){const R=l.paint.get("icon-translate"),L=l.paint.get("text-translate"),z=l.paint.get("icon-translate-anchor"),B=l.paint.get("text-translate-anchor"),G=l.layout.get("icon-rotation-alignment"),Z=l.layout.get("text-rotation-alignment"),Y=l.layout.get("icon-pitch-alignment"),se=l.layout.get("text-pitch-alignment"),oe=l.layout.get("icon-keep-upright"),ae=l.layout.get("text-keep-upright"),le=l.paint.get("icon-color-saturation"),me=l.paint.get("icon-color-contrast"),ye=l.paint.get("icon-color-brightness-min"),fe=l.paint.get("icon-color-brightness-max"),be=l.paint.get("symbol-elevation-reference")==="sea",ve=l.paint.get("text-occlusion-opacity").constantOr(0),Pe=f.context,Te=Pe.gl,Me=f.transform,Oe=G==="map",ke=Z==="map",De=Y==="map",Ue=se==="map",et=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let lt=!1;const Qe=f.depthModeForSublayer(0,qt.ReadOnly),gt=[s.am(Me.center.lng),s.at(Me.center.lat)],$e=l.layout.get("text-variable-anchor"),ot=Me.projection.name==="globe",it=[],_t=[0,-1,0];for(const vt of p){const at=i.getTile(vt),dt=at.getBucket(l);if(!dt||dt.projection.name==="mercator"&&ot||dt.fullyClipped)continue;const Wt=dt.projection.name==="globe",Ct=Wt?s.a9(Me.zoom):0,Nt=qa(vt,dt.getProjection(),Me),Kt=Me.calculatePixelsToTileUnitsMatrix(at),Bt=$e&&dt.hasTextData(),Zt=dt.hasIconTextFit()&&Bt&&dt.hasIconData(),vn=dt.getProjection().createInversionMatrix(Me,vt.canonical),yn=ir=>{Me.depthOcclusionForSymbolsAndCircles&&(l.hasInitialOcclusionOpacityProperties||f.terrain)&&(ir.push("DEPTH_D24"),ir.push("DEPTH_OCCLUSION"))},nr=()=>{const ir=Oe&&l.layout.get("symbol-placement")!=="point",_n=[];yn(_n);const Vn=ir||Zt,Kn=l.paint.get("icon-image-cross-fade").constantOr(0);f.terrainRenderModeElevated()&&De&&_n.push("PITCH_WITH_MAP_TERRAIN"),Wt&&(_n.push("PROJECTION_GLOBE_VIEW"),Vn&&_n.push("PROJECTED_POS_ON_VIEWPORT")),Kn>0&&_n.push("ICON_TRANSITION"),dt.icon.zOffsetVertexBuffer&&_n.push("Z_OFFSET"),le===0&&me===0&&ye===0&&fe===1||_n.push("COLOR_ADJUSTMENT"),dt.sdfIcons&&_n.push("RENDER_SDF");const Lr=dt.icon.programConfigurations.get(l.id),Ur=f.getOrCreateProgram("symbol",{config:Lr,defines:_n}),Nn=at.imageAtlasTexture?at.imageAtlasTexture.size:[0,0],oi=dt.iconSizeData,gi=s.bj(oi,Me.zoom),ai=De||Me.pitch!==0,fr=Dn(Nt,at.tileID.canonical,De,Oe,Me,dt.getProjection(),Kt),Qi=cs(Nt,at.tileID.canonical,De,Oe,Me,dt.getProjection(),Kt),es=f.translatePosMatrix(Qi,at,R,z,!0),$s=f.translatePosMatrix(Nt,at,R,z),Ds=Vn?zd:fr,fs=Oe&&!De&&!ir;let Gs=_t;!ot&&!Me.mercatorFromTransition||Oe||(Gs=cg(Me));const va=Wt?Gs:_t,il=l.getColorAdjustmentMatrix(le,me,ye,fe),$o=ag(oi.kind,gi,fs,De,f,$s,Ds,es,be,!1,Nn,[0,0],!0,vt,Ct,gt,vn,va,dt.getProjection(),il,Kn),su=at.imageAtlasTexture?at.imageAtlasTexture:null,ou=l.layout.get("icon-size").constantOr(0)!==1||dt.iconsNeedLinear,Yf=dt.sdfIcons||f.options.rotating||f.options.zooming||ou||ai?Te.LINEAR:Te.NEAREST,au=dt.sdfIcons&&l.paint.get("icon-halo-width").constantOr(1)!==0,pr=f.terrain&&De&&ir?s.a6.mat4.invert(s.a6.mat4.create(),fr):zd;if(ir&&dt.icon){const Vl=Me.elevation,Dw=Vl?Vl.getAtTileOffsetFunc(vt,Me.center.lat,Me.worldSize,dt.getProjection()):null,a0=Rn(Nt,at.tileID.canonical,De,Oe,Me,dt.getProjection(),Kt);Ic(dt,Nt,f,!1,a0,Qi,De,oe,Dw,vt)}return{program:Ur,buffers:dt.icon,uniformValues:$o,atlasTexture:su,atlasTextureIcon:null,atlasInterpolation:Yf,atlasInterpolationIcon:null,isSDF:dt.sdfIcons,hasHalo:au,tile:at,labelPlaneMatrixInv:pr}},lr=()=>{const ir=ke&&l.layout.get("symbol-placement")!=="point",_n=[],Vn=ir||$e||Zt;f.terrainRenderModeElevated()&&Ue&&_n.push("PITCH_WITH_MAP_TERRAIN"),Wt&&(_n.push("PROJECTION_GLOBE_VIEW"),Vn&&_n.push("PROJECTED_POS_ON_VIEWPORT")),dt.text.zOffsetVertexBuffer&&_n.push("Z_OFFSET"),dt.iconsInText&&_n.push("RENDER_TEXT_AND_SYMBOL"),_n.push("RENDER_SDF"),yn(_n);const Kn=dt.text.programConfigurations.get(l.id),Lr=f.getOrCreateProgram("symbol",{config:Kn,defines:_n});let Ur,Nn=[0,0],oi=null;const gi=dt.textSizeData;dt.iconsInText&&(Nn=at.imageAtlasTexture?at.imageAtlasTexture.size:[0,0],oi=at.imageAtlasTexture?at.imageAtlasTexture:null,Ur=Ue||Me.pitch!==0||f.options.rotating||f.options.zooming||gi.kind==="composite"||gi.kind==="camera"?Te.LINEAR:Te.NEAREST);const ai=at.glyphAtlasTexture?at.glyphAtlasTexture.size:[0,0],fr=s.bj(gi,Me.zoom),Qi=Dn(Nt,at.tileID.canonical,Ue,ke,Me,dt.getProjection(),Kt),es=cs(Nt,at.tileID.canonical,Ue,ke,Me,dt.getProjection(),Kt),$s=f.translatePosMatrix(es,at,L,B,!0),Ds=f.translatePosMatrix(Nt,at,L,B),fs=Vn?zd:Qi,Gs=ke&&!Ue&&!ir;let va=_t;!ot&&!Me.mercatorFromTransition||ke||(va=cg(Me));const il=ag(gi.kind,fr,Gs,Ue,f,Ds,fs,$s,be,!0,ai,Nn,!0,vt,Ct,gt,vn,Wt?va:_t,dt.getProjection(),ve),$o=at.glyphAtlasTexture?at.glyphAtlasTexture:null,su=Te.LINEAR,ou=l.paint.get("text-halo-width").constantOr(1)!==0,Yf=f.terrain&&Ue&&ir?s.a6.mat4.invert(s.a6.mat4.create(),Qi):zd;if(ir&&dt.text){const au=Me.elevation,pr=au?au.getAtTileOffsetFunc(vt,Me.center.lat,Me.worldSize,dt.getProjection()):null,Vl=Rn(Nt,at.tileID.canonical,Ue,ke,Me,dt.getProjection(),Kt);Ic(dt,Nt,f,!0,Vl,es,Ue,ae,pr,vt)}return{program:Lr,buffers:dt.text,uniformValues:il,atlasTexture:$o,atlasTextureIcon:oi,atlasInterpolation:su,atlasInterpolationIcon:Ur,isSDF:!0,hasHalo:ou,tile:at,labelPlaneMatrixInv:Yf}},yr=dt.icon.segments.get().length,Us=dt.text.segments.get().length,Vr=yr&&!E.onlyText?nr():null,Cn=Us&&!E.onlyIcons?lr():null,sr=l.paint.get("icon-opacity").constantOr(1),Tr=l.paint.get("text-opacity").constantOr(1);if(et&&dt.canOverlap){lt=!0;const ir=sr&&!E.onlyText?dt.icon.segments.get():[],_n=Tr&&!E.onlyIcons?dt.text.segments.get():[];for(const Vn of ir)it.push({segments:new s.b1([Vn]),sortKey:Vn.sortKey,state:Vr});for(const Vn of _n)it.push({segments:new s.b1([Vn]),sortKey:Vn.sortKey,state:Cn})}else E.onlyText||it.push({segments:sr?dt.icon.segments:new s.b1([]),sortKey:0,state:Vr}),E.onlyIcons||it.push({segments:Tr?dt.text.segments:new s.b1([]),sortKey:0,state:Cn})}lt&&it.sort((vt,at)=>vt.sortKey-at.sortKey);for(const vt of it){const at=vt.state;if(at)if(f.terrain?f.terrain.setupElevationDraw(at.tile,at.program,{useDepthForOcclusion:Me.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:at.labelPlaneMatrixInv}):f.setupDepthForOcclusion(Me.depthOcclusionForSymbolsAndCircles,at.program),Pe.activeTexture.set(Te.TEXTURE0),at.atlasTexture&&at.atlasTexture.bind(at.atlasInterpolation,Te.CLAMP_TO_EDGE,!0),at.atlasTextureIcon&&(Pe.activeTexture.set(Te.TEXTURE1),at.atlasTextureIcon&&at.atlasTextureIcon.bind(at.atlasInterpolationIcon,Te.CLAMP_TO_EDGE,!0)),f.uploadCommonLightUniforms(f.context,at.program),at.hasHalo){const dt=at.uniformValues;dt.u_is_halo=1,Bd(at.buffers,vt.segments,l,f,at.program,Qe,x,w,dt,2),dt.u_is_halo=0}else{if(at.isSDF){const dt=at.uniformValues;at.hasHalo&&(dt.u_is_halo=1,Bd(at.buffers,vt.segments,l,f,at.program,Qe,x,w,dt,1)),dt.u_is_halo=0}Bd(at.buffers,vt.segments,l,f,at.program,Qe,x,w,at.uniformValues,1)}}}function Bd(f,i,l,p,x,w,E,R,L,z){const B=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer];x.draw(p,p.context.gl.TRIANGLES,w,E,R,tn.disabled,L,l.id,f.layoutVertexBuffer,f.indexBuffer,i,l.paint,p.transform.zoom,f.programConfigurations.get(l.id),B,z)}function Nf(f,i,l,p,x,w,E){const R=f.context.gl,L=l.paint.get("fill-pattern"),z=l.is3D(),B=z?f.stencilModeFor3D():un.disabled,G=L&&L.constantOr(1);let Z,Y,se,oe,ae;E?(Y=G&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Z=R.LINES):(Y=G?"fillPattern":"fill",Z=R.TRIANGLES);for(const le of p){const me=i.getTile(le);if(G&&!me.patternsLoaded())continue;const ye=me.getBucket(l);if(!ye)continue;f.prepareDrawTile();const fe=ye.programConfigurations.get(l.id),be=f.isTileAffectedByFog(le),ve=f.getOrCreateProgram(Y,{config:fe,overrideFog:be});G&&(f.context.activeTexture.set(R.TEXTURE0),me.imageAtlasTexture&&me.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),fe.updatePaintBuffers());const Pe=L.constantOr(null);if(Pe&&me.imageAtlas){const Oe=me.imageAtlas.patternPositions[Pe.toString()];Oe&&fe.setConstantPatternPositions(Oe)}const Te=f.translatePosMatrix(le.projMatrix,me,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor")),Me=l.paint.get("fill-emissive-strength");if(E){oe=ye.indexBuffer2,ae=ye.segments2;const Oe=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[R.drawingBufferWidth,R.drawingBufferHeight];se=Y==="fillOutlinePattern"&&G?Od(Te,Me,f,me,Oe):jx(Te,Me,Oe)}else oe=ye.indexBuffer,ae=ye.segments,se=G?Ox(Te,Me,f,me):Ef(Te,Me);f.uploadCommonUniforms(f.context,ve,le.toUnwrapped()),ve.draw(f,Z,x,z?B:f.stencilModeForClipping(le),w,tn.disabled,se,l.id,ye.layoutVertexBuffer,oe,ae,l.paint,f.transform.zoom,fe,void 0)}}function Xc(f,i,l,p,x,w,E,R){l.resetLayerRenderingStats(f);const L=f.context,z=L.gl,B=f.transform,G=l.paint.get("fill-extrusion-pattern"),Z=G.constantOr(1),Y=l.paint.get("fill-extrusion-opacity"),se=f.style.enable3dLights(),oe=l.paint.get(se&&!Z?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ae=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),oe],le=l.layout.get("fill-extrusion-edge-radius"),me=le>0&&!l.paint.get("fill-extrusion-rounded-roof"),ye=me?0:le,fe=B.projection.name==="globe"?s.c_():0,be=B.projection.name==="globe",ve=be?s.a9(B.zoom):0,Pe=[s.am(B.center.lng),s.at(B.center.lat)],Te=l.paint.get("fill-extrusion-flood-light-color").toRenderColor(l.lut).toArray01().slice(0,3),Me=l.paint.get("fill-extrusion-flood-light-intensity"),Oe=l.paint.get("fill-extrusion-vertical-scale"),ke=l.paint.get("fill-extrusion-line-width").constantOr(1)!==0,De=pa(f,l.paint.get("fill-extrusion-cutoff-fade-range")),Ue=[];let et;be&&Ue.push("PROJECTION_GLOBE_VIEW"),ae[0]>0&&Ue.push("FAUX_AO"),me&&Ue.push("ZERO_ROOF_RADIUS"),R&&Ue.push("HAS_CENTROID"),Me>0&&Ue.push("FLOOD_LIGHT"),De.shouldRenderCutoff&&Ue.push("RENDER_CUTOFF"),ke&&Ue.push("RENDER_WALL_MODE");const lt=f.renderPass==="shadow",Qe=f.shadowRenderer,gt=lt&&!!Qe;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let $e=[0,0,0];if(Qe){const _t=f.style.directionalLight,vt=f.style.ambientLight;_t&&vt&&($e=uf(f.style,_t,vt)),et=Ue.concat(["SHADOWS_SINGLE_CASCADE"])}const ot=gt?"fillExtrusionDepth":Z?"fillExtrusionPattern":"fillExtrusion",it=l.getLayerRenderingStats();for(const _t of p){const vt=i.getTile(_t),at=vt.getBucket(l);if(!at||at.projection.name!==B.projection.name)continue;let dt=!1;Qe&&(dt=Qe.getMaxCascadeForTile(_t.toUnwrapped())===0);const Wt=f.isTileAffectedByFog(_t),Ct=at.programConfigurations.get(l.id),Nt=f.getOrCreateProgram(ot,{config:Ct,defines:dt?et:Ue,overrideFog:Wt});if(f.terrain&&f.terrain.setupElevationDraw(vt,Nt,{useMeterToDem:!0}),!at.centroidVertexBuffer){const lr=Nt.attributes.a_centroid_pos;lr!==void 0&&z.vertexAttrib2f(lr,0,0)}!lt&&Qe&&Qe.setupShadows(vt.tileID.toUnwrapped(),Nt,"vector-tile",vt.tileID.overscaledZ),Z&&(f.context.activeTexture.set(z.TEXTURE0),vt.imageAtlasTexture&&vt.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Ct.updatePaintBuffers());const Kt=G.constantOr(null);if(Kt&&vt.imageAtlas){const lr=vt.imageAtlas.patternPositions[Kt.toString()];lr&&Ct.setConstantPatternPositions(lr)}const Bt=l.paint.get("fill-extrusion-vertical-gradient"),Zt=1/at.tileToMeter;let vn;if(lt&&Qe){if(hg(vt.tileID,at,f))continue;const lr=Qe.calculateShadowPassMatrixFromTile(vt.tileID.toUnwrapped());vn=Lx(lr,ye,Zt,Oe)}else{const lr=f.translatePosMatrix(_t.expandedProjMatrix,vt,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),yr=B.projection.createInversionMatrix(B,_t.canonical);vn=Z?sg(lr,f,Bt,Y,ae,ye,Zt,_t,vt,fe,ve,Pe,yr,Te,Oe):ig(lr,f,Bt,Y,ae,ye,Zt,_t,fe,ve,Pe,yr,Te,Oe,Me,$e)}f.uploadCommonUniforms(L,Nt,_t.toUnwrapped(),null,De);let yn=at.segments;if(B.projection.name==="mercator"&&!lt&&(yn=at.getVisibleSegments(vt.tileID,f.terrain,f.transform.getFrustum(0)),!yn.get().length))continue;if(it)if(lt)for(const lr of yn.get())it.numRenderedVerticesInShadowPass+=lr.primitiveLength;else for(const lr of yn.get())it.numRenderedVerticesInTransparentPass+=lr.primitiveLength;const nr=[];(f.terrain||R)&&nr.push(at.centroidVertexBuffer),be&&nr.push(at.layoutVertexExtBuffer),ke&&nr.push(at.wallVertexBuffer),Nt.draw(f,L.gl.TRIANGLES,x,w,E,tn.backCCW,vn,l.id,at.layoutVertexBuffer,at.indexBuffer,yn,l.paint,f.transform.zoom,Ct,nr)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}function bi(f,i,l,p,x,w,E,R,L,z,B,G,Z,Y,se,oe,ae,le,me){const ye=f.context,fe=ye.gl,be=f.transform,ve=f.transform.zoom,Pe=[],Te=pa(f,l.paint.get("fill-extrusion-cutoff-fade-range"));z==="clear"?(Pe.push("CLEAR_SUBPASS"),me&&(Pe.push("CLEAR_FROM_TEXTURE"),ye.activeTexture.set(fe.TEXTURE0),me.bind(fe.LINEAR,fe.CLAMP_TO_EDGE))):z==="sdf"&&Pe.push("SDF_SUBPASS"),ae&&Pe.push("HAS_CENTROID"),Te.shouldRenderCutoff&&Pe.push("RENDER_CUTOFF");const Me=l.layout.get("fill-extrusion-edge-radius"),Oe=(ke,De,Ue,et,lt)=>{const Qe=De.programConfigurations.get(l.id),gt=f.isTileAffectedByFog(ke),$e=f.getOrCreateProgram("fillExtrusionGroundEffect",{config:Qe,defines:Pe,overrideFog:gt}),ot=((_t,vt,at,dt,Wt,Ct,Nt,Kt,Bt,Zt,vn)=>({u_matrix:vt,u_opacity:at,u_ao_pass:dt?1:0,u_meter_to_tile:Wt,u_ao:Ct,u_flood_light_intensity:Nt,u_flood_light_color:Kt,u_attenuation:Bt,u_edge_radius:Zt,u_fb:0,u_fb_size:vn,u_dynamic_offset:1}))(0,et,B,L,lt,[G,Z*lt],Y,se,oe,ve>=17?0:Me*lt,me?me.size[0]:0),it=[];ae&&it.push(De.hiddenByLandmarkVertexBuffer),f.uploadCommonUniforms(ye,$e,ke.toUnwrapped(),null,Te),$e.draw(f,ye.gl.TRIANGLES,x,w,E,R,ot,l.id,De.vertexBuffer,De.indexBuffer,Ue,l.paint,ve,Qe,it)};for(const ke of p){const De=i.getTile(ke),Ue=De.getBucket(l);if(!Ue||Ue.projection.name!==be.projection.name||!Ue.groundEffect||Ue.groundEffect&&!Ue.groundEffect.hasData())continue;const et=Ue.groundEffect,lt=1/Ue.tileToMeter;{const Qe=f.translatePosMatrix(ke.projMatrix,De,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),gt=et.getDefaultSegment();Oe(ke,et,gt,Qe,lt)}if(le)for(let Qe=0;Qe<4;Qe++){const gt=s.c$[Qe](ke),$e=i.getTile(gt);if(!$e)continue;const ot=$e.getBucket(l);if(!ot||ot.projection.name!==be.projection.name||!ot.groundEffect||ot.groundEffect&&!ot.groundEffect.hasData())continue;const it=ot.groundEffect;let _t,vt;Qe===0?(_t=[-s.ab,0,0],vt=1):Qe===1?(_t=[s.ab,0,0],vt=0):Qe===2?(_t=[0,-s.ab,0],vt=3):(_t=[0,s.ab,0],vt=2);const at=it.regionSegments[vt];if(!at)continue;const dt=new Float32Array(16);s.a6.mat4.translate(dt,ke.projMatrix,_t),Oe(ke,it,at,f.translatePosMatrix(dt,De,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),lt)}}}function Ja(f,i,l,p,x,w,E){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const R=w?w.findDEMTileFor(l):null;if(!(R&&R.dem||E))return;const L=le=>new s.P(Math.ceil((le+s.d2)*s.d3),0),z=le=>{const me=i.getSource().minzoom,ye=be=>{const ve=i.getTileByID(be);if(ve&&ve.hasData())return ve.getBucket(x)},fe=[0,-1,1];for(const be of fe){if(le.overscaledZ+be<me)continue;const ve=ye(le.calculateScaledKey(le.overscaledZ+be));if(ve)return ve}},B=[0,0,0],G=(le,me)=>(B[0]=Math.min(le.min.y,me.min.y),B[1]=Math.max(le.max.y,me.max.y),B[2]=s.ab-me.min.x>le.max.x?me.min.x-s.ab:le.max.x,B),Z=(le,me)=>(B[0]=Math.min(le.min.x,me.min.x),B[1]=Math.max(le.max.x,me.max.x),B[2]=s.ab-me.min.y>le.max.y?me.min.y-s.ab:le.max.y,B),Y=[(le,me)=>G(le,me),(le,me)=>G(me,le),(le,me)=>Z(le,me),(le,me)=>Z(me,le)],se=(le,me,ye,fe,be,ve,Pe)=>{if(!w)return 0;const Te=[[ve?ye:le,ve?le:ye,0],[ve?ye:me,ve?me:ye,0]],Me=Pe<0?s.ab+Pe:Pe,Oe=[ve?Me:(le+me)/2,ve?(le+me)/2:Me,0];return ye===0&&Pe<0||ye!==0&&Pe>0?w.getForTilePoints(be,[Oe],!0,fe):Te.push(Oe),w.getForTilePoints(l,Te,!0,R),Math.max(Te[0][2],Te[1][2],Oe[2])/w.exaggeration()};for(let le=0;le<4;le++){const me=p.borderFeatureIndices[le];if(me.length===0)continue;const ye=s.c$[le](l),fe=z(ye);if(!(fe&&fe instanceof s.d0)||p.borderDoneWithNeighborZ[le]===fe.canonical.z)continue;fe.centroidVertexArray.length===0&&fe.createCentroidsBuffer();const be=w?w.findDEMTileFor(ye):null;if(!(be&&be.dem||E))continue;const ve=(le<2?1:5)-le,Pe=fe.borderDoneWithNeighborZ[ve]!==p.canonical.z,Te=fe.borderFeatureIndices[ve];let Me=0;if(p.canonical.z!==fe.canonical.z){for(const Oe of me)p.showCentroid(p.featuresOnBorder[Oe]);if(Pe)for(const Oe of Te)fe.showCentroid(fe.featuresOnBorder[Oe]);p.borderDoneWithNeighborZ[le]=fe.canonical.z,fe.borderDoneWithNeighborZ[ve]=p.canonical.z}for(const Oe of me){const ke=p.featuresOnBorder[Oe],De=p.centroidData[ke.centroidDataIndex],Ue=ke.borders[le];let et;for(;Me<Te.length;){et=fe.featuresOnBorder[Te[Me]];const lt=et.borders[ve];if(lt[1]>Ue[0]+3||lt[0]>Ue[0]-3)break;fe.showCentroid(et),Me++}if(et&&Me<Te.length){const lt=Me;let Qe=0;for(;!(et.borders[ve][0]>Ue[1]-3)&&(Qe++,++Me!==Te.length);)et=fe.featuresOnBorder[Te[Me]];et=fe.featuresOnBorder[Te[lt]];let gt=!1;if(Qe>=1){const it=et.borders[ve];Math.abs(Ue[0]-it[0])<3&&Math.abs(Ue[1]-it[1])<3&&(Qe=1,gt=!0,Me=lt+1)}else if(Qe===0){p.showCentroid(ke);continue}const $e=fe.centroidData[et.centroidDataIndex];E&&gt&&(((oe=De).flags|(ae=$e).flags)&s.d1?(oe.flags|=s.d1,ae.flags|=s.d1):(oe.flags&=~s.d1,ae.flags&=~s.d1));const ot=ke.intersectsCount()>1||et.intersectsCount()>1;if(Qe>1)Me=lt,De.centroidXY=$e.centroidXY=new s.P(0,0);else if(be&&be.dem&&!ot){const it=Y[le](De,$e),_t=le%2?s.ab-1:0,vt=se(it[0],Math.min(s.ab-1,it[1]),_t,be,ye,le<2,it[2]);De.centroidXY=$e.centroidXY=L(vt)}else ot?De.centroidXY=$e.centroidXY=new s.P(0,0):(De.centroidXY=p.encodeBorderCentroid(ke),$e.centroidXY=fe.encodeBorderCentroid(et));p.writeCentroidToBuffer(De),fe.writeCentroidToBuffer($e)}else p.showCentroid(ke)}p.borderDoneWithNeighborZ[le]=fe.canonical.z,fe.borderDoneWithNeighborZ[ve]=p.canonical.z}var oe,ae;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}const $x=[1,0,0],ug=[0,1,0],dg=[0,0,1];function hg(f,i,l){const p=l.transform,x=l.shadowRenderer;if(!x)return!0;const w=f.toUnwrapped(),E=p.tileSize*x._cascades[l.currentShadowCascade].scale;let R=i.maxHeight;if(p.elevation){const oe=p.elevation.getMinMaxForTile(f);oe&&(R+=oe.max)}const L=[...x.shadowDirection];L[2]=-L[2];const z=x.computeSimplifiedTileShadowVolume(w,R,E,L);if(!z)return!1;const B=[$x,ug,dg,L,[L[0],0,L[2]],[0,L[1],L[2]]],G=p.projection.name==="globe",Z=p.scaleZoom(E),Y=s.bN.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,Z,!G),se=x.getCurrentCascadeFrustum();return Y.intersectsPrecise(z.vertices,z.planes,B)===0||se.intersectsPrecise(z.vertices,z.planes,B)===0}function fg(f){return[f[0]*s.d4,f[1]*s.d4,f[2]*s.d4,0]}function hs(f,i,l,p,x,w,E,R,L){const z=p.getSource(),B=l.globeSharedBuffers;if(!B)return;let G,Z,Y;if(i&&(G=p.getTile(i)),z instanceof s.aD?(Z=z.texture,Y=s.cD(0,0,l.transform)):G&&i&&(Z=G.texture,Y=s.cD(i.canonical.z,i.canonical.x,l.transform)),!Z||!Y)return;f||(Y=s.a6.mat4.scale(s.a6.mat4.create(),Y,[1,-1,1]));const se=l.context,oe=se.gl,ae=x.paint.get("raster-resampling")==="nearest"?oe.NEAREST:oe.LINEAR,le=l.colorModeForDrapableLayerRenderPass(w),me=E.defines;me.push("GLOBE_POLES");const ye=new qt(oe.LEQUAL,qt.ReadWrite,l.depthRangeFor3D),fe=Float32Array.from(l.transform.expandedFarZProjMatrix),be=Float32Array.from(s.b5(s.cC(new s.bP(0,0,0))));l.terrain&&l.terrain.prepareDrawTile(),se.activeTexture.set(oe.TEXTURE0),Z.bind(ae,oe.CLAMP_TO_EDGE),se.activeTexture.set(oe.TEXTURE1),Z.bind(ae,oe.CLAMP_TO_EDGE),Z.useMipmap&&se.extTextureFilterAnisotropic&&l.transform.pitch>20&&oe.texParameterf(oe.TEXTURE_2D,se.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,se.extTextureFilterAnisotropicMax);const[ve,Pe,Te,Me]=i?B.getPoleBuffers(i.canonical.z,!1):B.getPoleBuffers(0,!0),Oe=x.paint.get("raster-elevation");let ke;f?(ke=ve,l.renderDefaultNorthPole=Oe!==0):(ke=Pe,l.renderDefaultSouthPole=Oe!==0);const De=fg(E.mix),Ue=((lt,Qe,gt,$e,ot,it,_t,vt,at,dt,Wt,Ct,Nt)=>jd(lt,Qe,gt,new Float32Array(16),new Float32Array(9),[0,0],$e,[0,0],[0,0,0,0],1,{opacity:1,mix:0},it,[0,0],vt,2,dt,Wt,Ct,1,0,Nt))(fe,be,Y,s.a9(l.transform.zoom),0,x,0,Oe,0,De,E.offset,E.range,w),et=l.getOrCreateProgram("raster",{defines:me});l.uploadCommonUniforms(se,et,null),et.draw(l,oe.TRIANGLES,ye,L,le,R,Ue,x.id,ke,Te,Me)}function kr(f){const i=f._nearZ,l=f.projection.farthestPixelDistance(f),p=l-i,x=.2*f.height,w=i+x;return[i,l,(w-x-i)/p,(w-i)/p]}function Lf(f,i,l,p){if(f)return i instanceof Tc&&f instanceof Jh?i.getTextureDescriptor(f,l,!0):{texture:f.texture,mix:fg(p.mix),offset:p.offset,buffer:0,tileSize:1}}var pg=s.d5([{name:"a_index",type:"Int16",components:1}]);class Gx{constructor(i,l,p,x){const w={width:p[0],height:p[1],data:null},E=i.gl;this.targetColorTexture=new s.T(i,w,E.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(i,w,E.RGBA8,{useMipmap:!1}),this.context=i,this.updateParticleTexture(l,x),this.lastInvalidatedAt=0}updateParticleTexture(i,l){if(this.particleTextureDimension===l.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,x=l.width*l.height;this.particleTexture0=new s.T(this.context,l,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,l,p.RGBA8,{premultiply:!1,useMipmap:!1});const w=new s.d6;w.reserve(x);for(let E=0;E<x;E++)w.emplaceBack(E);this.particleIndexBuffer=this.context.createVertexBuffer(w,pg.members,!0),this.particleSegment=s.b1.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=l.width}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=s.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Wx(f,i,l){if(!f)return null;const p=i.getTextureDescriptor(f,l,!0);if(!p)return null;let{texture:x,mix:w,offset:E,tileSize:R,buffer:L,format:z}=p;if(!x||!z)return null;let B=!1;return z==="uint32"&&(B=!0,w[3]=0,w=Cf(s.d7,w,[0,l.paint.get("raster-particle-max-speed")]),E=Pf(s.d7,E,[0,l.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[L/(R+2*L),R/(R+2*L)],tileSize:R,scalarData:B,scale:w,offset:E,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[z]]}}function Hx(f){const i=f._nearZ,l=f.projection.farthestPixelDistance(f),p=l-i,x=.2*f.height,w=i+x;return[i,l,(w-x-i)/p,(w-i)/p]}const yw=new s.bz(1,0,0,1),Yc=new s.bz(0,1,0,1),Kc=new s.bz(0,0,1,1),bt=new s.bz(1,0,1,1),Gt=new s.bz(0,1,1,1);function ho(f,i,l,p,x,w,E){const R=f.context,L=f.transform,z=R.gl,B=L.projection.name==="globe",G=B?["PROJECTION_GLOBE_VIEW"]:[];let Z=s.a6.mat4.clone(l.projMatrix);if(B&&s.a9(L.zoom)>0){const De=s.b4(l.canonical,L),Ue=s.d8(De);Z=s.a6.mat4.multiply(new Float32Array(16),L.globeMatrix,Ue),s.a6.mat4.multiply(Z,L.projMatrix,Z)}const Y=s.a6.mat4.create();Y[12]+=2*x/(s.q.devicePixelRatio*L.width),Y[13]+=2*w/(s.q.devicePixelRatio*L.height),s.a6.mat4.multiply(Z,Y,Z);const se=f.getOrCreateProgram("debug",{defines:G}),oe=i.getTileByID(l.key);f.terrain&&f.terrain.setupElevationDraw(oe,se);const ae=qt.disabled,le=un.disabled,me=f.colorModeForRenderPass(),ye="$debug";R.activeTexture.set(z.TEXTURE0),f.emptyTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),B?oe._makeGlobeTileDebugBuffers(f.context,L):oe._makeDebugTileBoundsBuffers(f.context,L.projection);const fe=oe._tileDebugBuffer||f.debugBuffer,be=oe._tileDebugIndexBuffer||f.debugIndexBuffer,ve=oe._tileDebugSegments||f.debugSegments;if(se.draw(f,z.LINE_STRIP,ae,le,me,tn.disabled,zx(Z,p),ye,fe,be,ve,null,null,null,[oe._globeTileDebugBorderBuffer]),E){const De=oe.latestRawTileData,Ue=Math.floor((De&&De.byteLength||0)/1024);let et=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(et+=` => ${l.overscaledZ}`),et+=` ${oe.state}`,et+=` ${Ue}kb`,function(lt,Qe){lt.initDebugOverlayCanvas();const gt=lt.debugOverlayCanvas,$e=lt.context.gl,ot=lt.debugOverlayCanvas.getContext("2d");ot.clearRect(0,0,gt.width,gt.height),ot.shadowColor="white",ot.shadowBlur=2,ot.lineWidth=1.5,ot.strokeStyle="white",ot.textBaseline="top",ot.font="bold 36px Open Sans, sans-serif",ot.fillText(Qe,5,5),ot.strokeText(Qe,5,5),lt.debugOverlayTexture.update(gt),lt.debugOverlayTexture.bind($e.LINEAR,$e.CLAMP_TO_EDGE)}(f,et)}const Pe=i.getTile(l).tileSize,Te=512/Math.min(Pe,512)*(l.overscaledZ/L.zoom)*.5,Me=oe._tileDebugTextBuffer||f.debugBuffer,Oe=oe._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,ke=oe._tileDebugTextSegments||f.debugSegments;se.draw(f,z.TRIANGLES,ae,le,En.alphaBlended,tn.disabled,zx(Z,s.bz.transparent,Te),ye,Me,Oe,ke,null,null,null,[oe._globeTileDebugTextBuffer])}function Sr(f,i,l,p){Vd(f,0,i+l/2,f.transform.width,l,p)}function We(f,i,l,p){Vd(f,i-l/2,0,l,f.transform.height,p)}function Vd(f,i,l,p,x,w){const E=f.context,R=E.gl;R.enable(R.SCISSOR_TEST),R.scissor(i*s.q.devicePixelRatio,l*s.q.devicePixelRatio,p*s.q.devicePixelRatio,x*s.q.devicePixelRatio),E.clear({color:w}),R.disable(R.SCISSOR_TEST)}const Of=s.d5([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:mg}=Of;function fo(f,i,l,p){f.emplaceBack(i,l,p)}class gg{constructor(i){this.vertexArray=new s.d9,this.indices=new s.aO,fo(this.vertexArray,-1,-1,1),fo(this.vertexArray,1,-1,1),fo(this.vertexArray,-1,1,1),fo(this.vertexArray,1,1,1),fo(this.vertexArray,-1,-1,-1),fo(this.vertexArray,1,-1,-1),fo(this.vertexArray,-1,1,-1),fo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,mg),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=s.b1.simpleSegment(0,0,36,12)}}function Ol(f,i,l,p,x,w){const E=f.context.gl,R=i.paint.get("sky-atmosphere-color"),L=i.paint.get("sky-atmosphere-halo-color"),z=i.paint.get("sky-atmosphere-sun-intensity"),B=((G,Z,Y,se,oe)=>({u_matrix_3f:G,u_sun_direction:Z,u_sun_intensity:Y,u_color_tint_r:[se.r,se.g,se.b,se.a],u_color_tint_m:[oe.r,oe.g,oe.b,oe.a],u_luminance:5e-5}))(s.a6.mat3.fromMat4(s.a6.mat3.create(),p),x,z,R,L);E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+w,i.skyboxTexture,0),l.draw(f,E.TRIANGLES,qt.disabled,un.disabled,En.unblended,tn.frontCW,B,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const Jc=s.d5([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class _w{constructor(i){const l=new s.da;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const p=new s.aO;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(l,Jc.members),this.indexBuffer=i.createIndexBuffer(p),this.segments=s.b1.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const xw=s.d5([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class qx{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class jf{constructor(i){this.colorModeAlphaBlendedWriteRGB=new En([1,Cs,1,Cs],s.bz.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new En([1,0,1,0],s.bz.transparent,[!1,!1,!1,!0]),this.params=new qx,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){const l=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new _w(l);const p=this.params.sizeRange,x=this.params.intensityRange,w=function(B){const G=s.dd(30),Z=[];for(let Y=0;Y<B;++Y){const se=2*Math.PI*G(),oe=Math.acos(1-2*G())-.5*Math.PI;Z.push(s.a6.vec3.fromValues(Math.cos(oe)*Math.cos(se),Math.cos(oe)*Math.sin(se),Math.sin(oe)))}return Z}(this.params.starsCount),E=s.dd(300),R=new s.db,L=new s.aO;let z=0;for(let B=0;B<w.length;++B){const G=s.a6.vec3.scale([],w[B],200),Z=Math.max(0,1+.01*p*(1*E()-.5)),Y=Math.max(0,1+.01*x*(1*E()-.5));R.emplaceBack(G[0],G[1],G[2],-1,-1,Z,Y),R.emplaceBack(G[0],G[1],G[2],1,-1,Z,Y),R.emplaceBack(G[0],G[1],G[2],1,1,Z,Y),R.emplaceBack(G[0],G[1],G[2],-1,1,Z,Y),L.emplaceBack(z+0,z+1,z+2),L.emplaceBack(z+0,z+2,z+3),z+=4}this.starsVx=l.createVertexBuffer(R,xw.members),this.starsIdx=l.createIndexBuffer(L),this.starsSegments=s.b1.simpleSegment(0,0,R.length,L.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,l){const p=i.context,x=p.gl,w=i.transform,E=new qt(x.LEQUAL,qt.ReadOnly,[0,1]),R=s.a9(w.zoom),L=i.style.getLut(l.scope),z=l.properties.get("color").toRenderColor(L).toArray01(),B=l.properties.get("high-color").toRenderColor(L).toArray01(),G=l.properties.get("space-color").toRenderColor(L).toArray01PremultipliedAlpha(),Z=5e-4,Y=s.dc(l.properties.get("horizon-blend"),0,1,Z,.25),se=s.cx(i,p,w)&&Y===Z?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,oe=i.frameCounter/1e3%1,ae=s.a6.vec3.length(w.globeCenterInViewSpace),le=Math.sqrt(Math.pow(ae,2)-Math.pow(se,2)),me=Math.acos(le/ae),ye=fe=>{const be=w.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];fe&&be.push("ALPHA_PASS");const ve=i.getOrCreateProgram("globeAtmosphere",{defines:be}),Pe=((Me,Oe,ke,De,Ue,et,lt,Qe,gt,$e,ot,it)=>({u_frustum_tl:Me,u_frustum_tr:Oe,u_frustum_br:ke,u_frustum_bl:De,u_horizon:Ue,u_transition:et,u_fadeout_range:lt,u_color:Qe,u_high_color:gt,u_space_color:$e,u_temporal_offset:ot,u_horizon_angle:it}))(w.frustumCorners.TL,w.frustumCorners.TR,w.frustumCorners.BR,w.frustumCorners.BL,w.frustumCorners.horizon,R,Y,z,B,G,oe,me);i.uploadCommonUniforms(p,ve);const Te=this.atmosphereBuffer;Te&&ve.draw(i,x.TRIANGLES,E,un.disabled,fe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,tn.backCW,Pe,fe?"atmosphere_glow_alpha":"atmosphere_glow",Te.vertexBuffer,Te.indexBuffer,Te.segments)};ye(!1),ye(!0)}drawStars(i,l){const p=s.ap(l.properties.get("star-intensity"),0,1);if(p===0)return;const x=i.context,w=x.gl,E=i.transform,R=i.getOrCreateProgram("stars"),L=s.a6.quat.identity([]);s.a6.quat.rotateX(L,L,-E._pitch),s.a6.quat.rotateZ(L,L,-E.angle),s.a6.quat.rotateX(L,L,s.bB(E._center.lat)),s.a6.quat.rotateY(L,L,-s.bB(E._center.lng));const z=s.a6.mat4.fromQuat(new Float32Array(16),L),B=s.a6.mat4.multiply([],E.starsProjMatrix,z),G=s.a6.mat3.fromMat4([],z),Z=s.a6.mat3.invert([],G),Y=[0,1,0];s.a6.vec3.transformMat3(Y,Y,Z),s.a6.vec3.scale(Y,Y,this.params.sizeMultiplier);const se=[1,0,0];s.a6.vec3.transformMat3(se,se,Z),s.a6.vec3.scale(se,se,this.params.sizeMultiplier);const oe=(ae=Y,le=se,me=p,{u_matrix:Float32Array.from(B),u_up:ae,u_right:le,u_intensity_multiplier:me});var ae,le,me;i.uploadCommonUniforms(x,R),this.starsVx&&this.starsIdx&&R.draw(i,w.TRIANGLES,qt.disabled,un.disabled,this.colorModeAlphaBlendedWriteRGB,tn.disabled,oe,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function zf(f,i){const l=[...f],p=i.cameraWorldSizeForFog/i.worldSize,x=s.a6.mat4.identity([]);return s.a6.mat4.scale(x,x,[p,p,1]),s.a6.mat4.multiply(l,x,l),s.a6.mat4.multiply(l,i.worldToFogMatrix,l),l}function Ff(f,i,l,p,x){const w=l.material,E=p.context,{baseColorTexture:R,metallicRoughnessTexture:L}=w.pbrMetallicRoughness,{normalTexture:z,occlusionTexture:B,emissionTexture:G}=w;function Z(Y,se,oe){if(Y&&(f.push(se),E.activeTexture.set(E.gl.TEXTURE0+oe),Y.gfxTexture)){const{minFilter:ae,magFilter:le,wrapS:me,wrapT:ye}=Y.sampler;Y.gfxTexture.bindExtraParam(ae,le,me,ye)}}Z(R,"HAS_TEXTURE_u_baseColorTexture",Ni.BaseColor),Z(L,"HAS_TEXTURE_u_metallicRoughnessTexture",Ni.MetallicRoughness),Z(z,"HAS_TEXTURE_u_normalTexture",Ni.Normal),Z(B,"HAS_TEXTURE_u_occlusionTexture",Ni.Occlusion),Z(G,"HAS_TEXTURE_u_emissionTexture",Ni.Emission),x&&(x.texture||(x.texture=new s.df(p.context,x.image,[x.image.height,x.image.height,x.image.height],E.gl.RGBA8)),E.activeTexture.set(E.gl.TEXTURE0+Ni.LUT),x.texture&&x.texture.bind(E.gl.LINEAR,E.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),l.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(l.texcoordBuffer)),l.colorBuffer&&(f.push(l.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(l.colorBuffer)),l.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(l.normalBuffer)),l.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(l.pbrBuffer)),w.alphaMode!=="OPAQUE"&&w.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||f.push("DIFFUSE_SHADED"),f.push("USE_STANDARD_DERIVATIVES")}function Ud(f,i,l,p,x,w){const E=l.paint.get("model-opacity"),R=i.context,L=new qt(i.context.gl.LEQUAL,qt.ReadWrite,i.depthRangeFor3D),z=i.transform,B=f.mesh,G=B.material,Z=G.pbrMetallicRoughness,Y=i.style.fog;let se;se=i.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:s.a6.mat4.multiply([],p.zScaleMatrix,f.nodeModelMatrix),s.a6.mat4.multiply(se,p.negCameraPosMatrix,se);const oe=s.a6.mat4.invert([],se);s.a6.mat4.transpose(oe,oe);const ae=l.paint.get("model-emissive-strength").constantOr(0),le=Ot(new Float32Array(f.worldViewProjection),new Float32Array(se),new Float32Array(oe),null,i,E,Z.baseColorFactor.toRenderColor(null),G.emissiveFactor,Z.metallicFactor,Z.roughnessFactor,G,ae,l),me={defines:[]},ye=[];Ff(me.defines,ye,B,i,l.lut);const fe=i.shadowRenderer;fe&&(fe.useNormalOffset=!1);let be=null;if(Y){const Te=zf(f.nodeModelMatrix,i.transform);if(be=new Float32Array(Te),z.projection.name!=="globe"){const Me=B.aabb.min,Oe=B.aabb.max,[ke,De]=Y.getOpacityForBounds(Te,Me[0],Me[1],Oe[0],Oe[1]);me.overrideFog=ke>=Rt||De>=Rt}}const ve=pa(i,l.paint.get("model-cutoff-fade-range"));ve.shouldRenderCutoff&&me.defines.push("RENDER_CUTOFF");const Pe=i.getOrCreateProgram("model",me);i.uploadCommonUniforms(R,Pe,null,be,ve),i.renderPass!=="shadow"&&fe&&fe.setupShadowsFromMatrix(f.nodeModelMatrix,Pe),Pe.draw(i,R.gl.TRIANGLES,L,x,w,B.material.doubleSided?tn.disabled:tn.backCCW,le,l.id,B.vertexBuffer,B.indexBuffer,B.segments,l.paint,i.transform.zoom,void 0,ye)}function $d(f,i,l,p,x,w,E){let R;R=f.projection.name==="globe"?s.dg(l,f):[...l],s.a6.mat4.multiply(R,R,i.matrix);const L=s.a6.mat4.multiply([],p,R);if(i.meshes)for(const z of i.meshes){if(z.material.alphaMode!=="BLEND"){E.push({mesh:z,depth:0,modelIndex:x,worldViewProjection:L,nodeModelMatrix:R});continue}const B=s.a6.vec3.transformMat4([],z.centroid,L);B[2]>0&&w.push({mesh:z,depth:B[2],modelIndex:x,worldViewProjection:L,nodeModelMatrix:R})}if(i.children)for(const z of i.children)$d(f,z,l,p,x,w,E)}function Qc(f,i,l,p){const x=l.shadowRenderer;if(!x)return;const w=x.getShadowPassDepthMode(),E=x.getShadowPassColorMode(),R=x.calculateShadowPassMatrixFromMatrix(i),L=lg(R);l.getOrCreateProgram("modelDepth",{defines:l._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(l,l.context.gl.TRIANGLES,w,un.disabled,E,tn.backCCW,L,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,l.transform.zoom,void 0,void 0)}function Zx(f,i,l){const p=i.updateZoomBasedPaintProperties(),x=function(w,E,R){let L,z,B,G=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&G>0){const Z=w.terrain,Y=Z.findDEMTileFor(R);Y&&Y.dem?L=s.di.create(Z,R,Y):G=0}if(G===0&&(E.terrainElevationMin=0,E.terrainElevationMax=0),G===E.validForExaggeration&&(G===0||L&&L._demTile&&L._demTile.tileID===E.validForDEMTile.id&&L._dem._timestamp===E.validForDEMTile.timestamp))return!1;for(const Z in E.instancesPerModel){const Y=E.instancesPerModel[Z];for(let se=0;se<Y.instancedDataArray.length;++se){const oe=(L?G*L.getElevationAt(0|Y.instancedDataArray.float32[16*se],0|Y.instancedDataArray.float32[16*se+1],!0,!0):0)+Y.instancesEvaluatedElevation[se];Y.instancedDataArray.float32[16*se+6]=oe,z=z?Math.min(E.terrainElevationMin,oe):oe,B=B?Math.max(E.terrainElevationMax,oe):oe}}return E.terrainElevationMin=z||0,E.terrainElevationMax=B||0,E.validForExaggeration=G,E.validForDEMTile=L&&L._demTile?{id:L._demTile.tileID,timestamp:L._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,i,l);(p||x)&&(i.uploaded=!1,i.upload(f.context))}const po={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.c9([0,0,0],[s.ab,s.ab,0])};function vw(f,i){const l=1<<f.canonical.z,p=i.getFreeCameraOptions().position,x=i.elevation,w=f.canonical.x/l,E=(f.canonical.x+1)/l,R=f.canonical.y/l,L=(f.canonical.y+1)/l;let z=i._centerAltitude;if(x){const Y=x.getMinMaxForTile(f);Y&&Y.max>z&&(z=Y.max)}const B=s.ap(p.x,w,E)-p.x,G=s.ap(p.y,R,L)-p.y,Z=s.bD(z,i.center.lat)-p.z;return i._zoomFromMercatorZ(Math.sqrt(B*B+G*G+Z*Z))}function $i(f,i,l,p,x,w,E){const R=f.context,L=f.renderPass==="shadow",z=f.shadowRenderer,B=L&&z?z.getShadowPassDepthMode():new qt(R.gl.LEQUAL,qt.ReadWrite,f.depthRangeFor3D),G=f.isTileAffectedByFog(w);if(l.meshes)for(const Z of l.meshes){const Y=["MODEL_POSITION_ON_GPU"],se=[];let oe,ae,le;p.instancedDataArray.length>20&&Y.push("INSTANCED_ARRAYS");const me=pa(f,i.paint.get("model-cutoff-fade-range"));if(me.shouldRenderCutoff&&Y.push("RENDER_CUTOFF"),L&&z)oe=f.getOrCreateProgram("modelDepth",{defines:Y}),ae=lg(E.shadowTileMatrix,E.shadowTileMatrix,Float32Array.from(l.matrix)),le=z.getShadowPassColorMode();else{Ff(Y,se,Z,f,i.lut),oe=f.getOrCreateProgram("model",{defines:Y,overrideFog:G});const fe=Z.material,be=fe.pbrMetallicRoughness,ve=i.paint.get("model-opacity"),Pe=i.paint.get("model-emissive-strength").constantOr(0);ae=Ot(w.expandedProjMatrix,Float32Array.from(l.matrix),new Float32Array(16),null,f,ve,be.baseColorFactor.toRenderColor(null),fe.emissiveFactor,be.metallicFactor,be.roughnessFactor,fe,Pe,i,x),z&&(E.shadowUniformsInitialized?oe.setShadowUniformValues(R,z.getShadowUniformValues()):(z.setupShadows(w.toUnwrapped(),oe,"model-tile",w.overscaledZ),E.shadowUniformsInitialized=!0)),le=me.shouldRenderCutoff||ve<1||fe.alphaMode!=="OPAQUE"?En.alphaBlended:En.unblended}f.uploadCommonUniforms(R,oe,w.toUnwrapped(),null,me);const ye=Z.material.doubleSided?tn.disabled:tn.backCCW;if(p.instancedDataArray.length>20)se.push(p.instancedDataBuffer),oe.draw(f,R.gl.TRIANGLES,B,un.disabled,le,ye,ae,i.id,Z.vertexBuffer,Z.indexBuffer,Z.segments,i.paint,f.transform.zoom,void 0,se,p.instancedDataArray.length);else{const fe=L?"u_instance":"u_normal_matrix";for(let be=0;be<p.instancedDataArray.length;++be)ae[fe]=new Float32Array(p.instancedDataArray.arrayBuffer,64*be,16),oe.draw(f,R.gl.TRIANGLES,B,un.disabled,le,ye,ae,i.id,Z.vertexBuffer,Z.indexBuffer,Z.segments,i.paint,f.transform.zoom,void 0,se)}}if(l.children)for(const Z of l.children)$i(f,i,Z,p,x,w,E)}const bw=[1,-1,1];function Gd(f,i,l,p){if(!l.modelManager)return!0;const x=l.modelManager;if(!l.shadowRenderer)return!0;const w=l.shadowRenderer,E=i.aabb;let R=!0,L=f.maxHeight;if(L===0){let B=0;for(const G in f.instancesPerModel){const Z=x.getModel(G,p);Z?B=Math.max(B,Math.max(Math.max(Z.aabb.max[0],Z.aabb.max[1]),Z.aabb.max[2])):R=!1}L=f.maxScale*B*1.41+f.maxVerticalOffset,R&&(f.maxHeight=L)}E.max[2]=L,E.min[2]+=f.terrainElevationMin,E.max[2]+=f.terrainElevationMax,s.a6.vec3.transformMat4(E.min,E.min,i.tileMatrix),s.a6.vec3.transformMat4(E.max,E.max,i.tileMatrix);const z=E.intersects(w.getCurrentCascadeFrustum());return l.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=z===2),z===0}function xr(f,i){const l=f.uniformValues.u_cutoff_params[0],p=f.uniformValues.u_cutoff_params[1],x=f.uniformValues.u_cutoff_params[2],w=f.uniformValues.u_cutoff_params[3];return p===l||w===x?1:s.ap(((i-l)/(p-l)-x)/(w-x),0,1)}function Bn(f,i,l,p){if(i.pitch<20)return 1;const x=i.getWorldToCameraMatrix();s.a6.mat4.multiply(x,x,f);const w=s.a6.vec4.fromValues(l.min[0],l.min[1],l.min[2],1);let E=s.a6.vec4.transformMat4(s.a6.vec4.create(),w,x),R=E,L=E;w[1]=l.max[1],E=s.a6.vec4.transformMat4(s.a6.vec4.create(),w,x),R=E[1]<R[1]?E:R,L=E[1]>L[1]?E:L,w[0]=l.max[0],E=s.a6.vec4.transformMat4(s.a6.vec4.create(),w,x),R=E[1]<R[1]?E:R,L=E[1]>L[1]?E:L,w[1]=l.min[1],E=s.a6.vec4.transformMat4(s.a6.vec4.create(),w,x),R=E[1]<R[1]?E:R,L=E[1]>L[1]?E:L;const z=s.ap(p[0],0,1),B=100*i.pixelsPerMeter*s.ap(p[1],0,1),G=s.ap(p[2],0,1),Z=s.a6.vec4.lerp(s.a6.vec4.create(),R,L,z),Y=Math.tan(.5*i.fovX),se=-Z[2]*Y;if(B===0)return Z[1]<-Math.abs(se)?G:1;const oe=(-Math.abs(se)-Z[1])/B,ae=(me,ye,fe)=>(1-fe)*me+fe*ye,le=s.ap(ae(1,G,oe),G,1);return ae(1,le,s.ap((i.pitch-20)/20,0,1))}class Xx{}class Qa{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,l,p){{const G=this._storage.get(l.id);if(G)return G.lastUsedFrameIdx=i,G.buf}const x=p.gl,w=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),E=new ArrayBuffer(w),R=new Int16Array(E);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(E));const L=new s.dk;for(let G=0;G<w/2;G+=3){const Z=R[G],Y=R[G+1],se=R[G+2];L.emplaceBack(Z,Y),L.emplaceBack(Y,se),L.emplaceBack(se,Z)}const z=p.bindVertexArrayOES.current,B=new Xx;return B.buf=new ds(p,L),B.lastUsedFrameIdx=i,this._storage.set(l.id,B),p.bindVertexArrayOES.set(z),B.buf}update(i){for(const[l,p]of this._storage)i-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(l))}destroy(){for(const[i,l]of this._storage)l.buf.destroy(),this._storage.delete(i)}}class Bf{constructor(i){this.occluderSize=30,this.depthOffset=-1e-4,i.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),i.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const el={symbol:function(f,i,l,p,x){if(f.renderPass!=="translucent")return;const w=un.disabled,E=f.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(z,B,G,Z,Y,se,oe){const ae=B.transform,le=Y==="map",me=se==="map";for(const ye of z){const fe=Z.getTile(ye),be=fe.getBucket(G);if(!be||!be.text||!be.text.segments.get().length)continue;const ve=s.bj(be.textSizeData,ae.zoom),Pe=qa(ye,be.getProjection(),ae),Te=ae.calculatePixelsToTileUnitsMatrix(fe),Me=Dn(Pe,fe.tileID.canonical,me,le,ae,be.getProjection(),Te),Oe=be.hasIconTextFit()&&be.hasIconData();if(ve){const ke=Math.pow(2,ae.zoom-fe.tileID.overscaledZ);gw(be,le,me,oe,s.cS,ae,Me,ye,ke,ve,Oe)}}}(p,f,l,i,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),x);const R=l.paint.get("icon-opacity").constantOr(1)!==0,L=l.paint.get("text-opacity").constantOr(1)!==0;l.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(R||L)?Fd(f,i,l,p,w,E):(R&&Fd(f,i,l,p,w,E,{onlyIcons:!0}),L&&Fd(f,i,l,p,w,E,{onlyText:!0})),i.map.showCollisionBoxes&&(kf(f,i,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),kf(f,i,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(f,i,l,p){if(f.renderPass!=="translucent")return;const x=l.paint.get("circle-opacity"),w=l.paint.get("circle-stroke-width"),E=l.paint.get("circle-stroke-opacity"),R=l.layout.get("circle-sort-key").constantOr(1)!==void 0,L=l.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(w.constantOr(1)===0||E.constantOr(1)===0))return;const z=f.context,B=z.gl,G=f.transform,Z=f.depthModeForSublayer(0,qt.ReadOnly),Y=un.disabled,se=f.colorModeForDrapableLayerRenderPass(L),oe=G.projection.name==="globe",ae=[s.am(G.center.lng),s.at(G.center.lat)],le=[];for(let ye=0;ye<p.length;ye++){const fe=p[ye],be=i.getTile(fe),ve=be.getBucket(l);if(!ve||ve.projection.name!==G.projection.name)continue;const Pe=ve.programConfigurations.get(l.id),Te=s.cT(l),Me=f.isTileAffectedByFog(fe);oe&&Te.push("PROJECTION_GLOBE_VIEW"),Te.push("DEPTH_D24"),f.terrain&&G.depthOcclusionForSymbolsAndCircles&&Te.push("DEPTH_OCCLUSION");const Oe=f.getOrCreateProgram("circle",{config:Pe,defines:Te,overrideFog:Me}),ke=ve.layoutVertexBuffer,De=ve.globeExtVertexBuffer,Ue=ve.indexBuffer,et=G.projection.createInversionMatrix(G,fe.canonical),lt={programConfiguration:Pe,program:Oe,layoutVertexBuffer:ke,globeExtVertexBuffer:De,indexBuffer:Ue,uniformValues:s.cU(f,fe,be,et,ae,l),tile:be};if(R){const Qe=ve.segments.get();for(const gt of Qe)le.push({segments:new s.b1([gt]),sortKey:gt.sortKey,state:lt})}else le.push({segments:ve.segments,sortKey:0,state:lt})}R&&le.sort((ye,fe)=>ye.sortKey-fe.sortKey);const me={useDepthForOcclusion:G.depthOcclusionForSymbolsAndCircles};for(const ye of le){const{programConfiguration:fe,program:be,layoutVertexBuffer:ve,globeExtVertexBuffer:Pe,indexBuffer:Te,uniformValues:Me,tile:Oe}=ye.state,ke=ye.segments;f.terrain&&f.terrain.setupElevationDraw(Oe,be,me),f.uploadCommonUniforms(z,be,Oe.tileID.toUnwrapped()),be.draw(f,B.TRIANGLES,Z,Y,se,tn.disabled,Me,l.id,ve,Te,ke,l.paint,G.zoom,fe,[Pe])}},heatmap:function(f,i,l,p){if(l.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const x=f.context,w=x.gl,E=un.disabled,R=new En([w.ONE,w.ONE,w.ONE,w.ONE],s.bz.transparent,[!0,!0,!0,!0]);(function(Y,se,oe,ae){const le=Y.gl,me=se.width*ae,ye=se.height*ae;Y.activeTexture.set(le.TEXTURE1),Y.viewport.set([0,0,me,ye]);let fe=oe.heatmapFbo;if(!fe||fe&&(fe.width!==me||fe.height!==ye)){fe&&fe.destroy();const be=le.createTexture();le.bindTexture(le.TEXTURE_2D,be),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_WRAP_S,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_WRAP_T,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_MIN_FILTER,le.LINEAR),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_MAG_FILTER,le.LINEAR),fe=oe.heatmapFbo=Y.createFramebuffer(me,ye,!0,null),function(ve,Pe,Te,Me,Oe,ke){const De=ve.gl;De.texImage2D(De.TEXTURE_2D,0,ve.extRenderToTextureHalfFloat?De.RGBA16F:De.RGBA,Oe,ke,0,De.RGBA,ve.extRenderToTextureHalfFloat?De.HALF_FLOAT:De.UNSIGNED_BYTE,null),Me.colorAttachment.set(Te)}(Y,0,be,fe,me,ye)}else le.bindTexture(le.TEXTURE_2D,fe.colorAttachment.get()),Y.bindFramebuffer.set(fe.framebuffer)})(x,f,l,f.transform.projection.name==="globe"?.5:.25),x.clear({color:s.bz.transparent});const L=f.transform,z=L.projection.name==="globe",B=z?["PROJECTION_GLOBE_VIEW"]:[],G=z?tn.frontCCW:tn.disabled,Z=[s.am(L.center.lng),s.at(L.center.lat)];for(let Y=0;Y<p.length;Y++){const se=p[Y];if(i.hasRenderableParent(se))continue;const oe=i.getTile(se),ae=oe.getBucket(l);if(!ae||ae.projection.name!==L.projection.name)continue;const le=f.isTileAffectedByFog(se),me=ae.programConfigurations.get(l.id),ye=f.getOrCreateProgram("heatmap",{config:me,defines:B,overrideFog:le}),{zoom:fe}=f.transform;f.terrain&&f.terrain.setupElevationDraw(oe,ye),f.uploadCommonUniforms(x,ye,se.toUnwrapped());const be=L.projection.createInversionMatrix(L,se.canonical);ye.draw(f,w.TRIANGLES,qt.disabled,E,R,G,fw(f,se,oe,be,Z,fe,l.paint.get("heatmap-intensity")),l.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,l.paint,f.transform.zoom,me,z?[ae.globeExtVertexBuffer]:null)}x.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(x,w){const E=x.context,R=E.gl,L=w.heatmapFbo;if(!L)return;E.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,L.colorAttachment.get()),E.activeTexture.set(R.TEXTURE1);let z=w.colorRampTexture;z||(z=w.colorRampTexture=new s.T(E,w.colorRamp,R.RGBA8)),z.bind(R.LINEAR,R.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,R.TRIANGLES,qt.disabled,un.disabled,x.colorModeForRenderPass(),tn.disabled,((B,G,Z,Y)=>({u_image:0,u_color_ramp:1,u_opacity:G.paint.get("heatmap-opacity")}))(0,w),w.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,w.paint,x.transform.zoom)}(f,l))},line:function(f,i,l,p){if(f.renderPass!=="translucent")return;const x=l.paint.get("line-opacity"),w=l.paint.get("line-width");if(x.constantOr(1)===0||w.constantOr(1)===0)return;const E=l.paint.get("line-emissive-strength"),R=l.paint.get("line-occlusion-opacity"),L=f.context,z=L.gl,B=l.layout.get("line-z-offset"),G=!B.isConstant()||!!B.constantOr(0),Z=G?new qt(f.depthOcclusion?z.GREATER:z.LEQUAL,qt.ReadOnly,f.depthRangeFor3D):f.depthModeForSublayer(0,qt.ReadOnly),Y=f.colorModeForDrapableLayerRenderPass(E),se=f.terrain&&f.terrain.renderingToTexture,oe=se?1:s.q.devicePixelRatio,ae=l.paint.get("line-dasharray"),le=ae.constantOr(1),me=l.layout.get("line-cap"),ye=ae.constantOr(null),fe=me.constantOr(null),be=l.paint.get("line-pattern"),ve=be.constantOr(1),Pe=be.constantOr(null),Te=l.paint.get("line-opacity").constantOr(1);let Me=!ve&&Te!==1||f.depthOcclusion&&R>0&&R<1;const Oe=l.paint.get("line-gradient"),ke=ve?"linePattern":"line",De=s.cV(l);let Ue;if(se&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(Me=!1),R!==0&&f.depthOcclusion){const lt=l.paint._values["line-opacity"];lt&&lt.value&&lt.value.kind==="constant"?Ue=lt.value:s.w(`Occlusion opacity for layer ${l.id} is supported only when line-opacity isn't data-driven.`)}if(G&&(f.forceTerrainMode=!0),!G&&R!==0&&f.terrain&&!se)return void s.w(`Occlusion opacity for layer ${l.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const et=Me&&G?f.stencilModeFor3D():un.disabled;for(const lt of p){const Qe=i.getTile(lt);if(ve&&!Qe.patternsLoaded())continue;const gt=Qe.getBucket(l);if(!gt)continue;f.prepareDrawTile();const $e=gt.programConfigurations.get(l.id),ot=f.isTileAffectedByFog(lt),it=f.getOrCreateProgram(ke,{config:$e,defines:G?[...De,"ELEVATED"]:De,overrideFog:ot});if(Pe&&Qe.imageAtlas){const Ct=Qe.imageAtlas.patternPositions[Pe.toString()];Ct&&$e.setConstantPatternPositions(Ct)}if(!ve&&ye&&fe&&Qe.lineAtlas){const Ct=Qe.lineAtlas.getDash(ye,fe);Ct&&$e.setConstantPatternPositions(Ct)}let[_t,vt]=l.paint.get("line-trim-offset");(fe==="round"||fe==="square")&&_t!==vt&&(_t===0&&(_t-=1),vt===1&&(vt+=1));const at=se?lt.projMatrix:null,dt=ve?s.cW(f,Qe,l,at,oe,[_t,vt]):s.cX(f,Qe,l,at,gt.lineClipsArray.length,oe,[_t,vt]);if(Oe){const Ct=gt.gradients[l.id];let Nt=Ct.texture;if(l.gradientVersion!==Ct.version){let Kt=256;if(l.stepInterpolant){const Bt=i.getSource().maxzoom,Zt=lt.canonical.z===Bt?Math.ceil(1<<f.transform.maxZoom-lt.canonical.z):1;Kt=s.ap(s.cY(gt.maxLineLength/s.ab*1024*Zt),256,L.maxTextureSize)}Ct.gradient=s.cZ({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Kt,image:Ct.gradient||void 0,clips:gt.lineClipsArray}),Ct.texture?Ct.texture.update(Ct.gradient):Ct.texture=new s.T(L,Ct.gradient,z.RGBA8),Ct.version=l.gradientVersion,Nt=Ct.texture}L.activeTexture.set(z.TEXTURE1),Nt.bind(l.stepInterpolant?z.NEAREST:z.LINEAR,z.CLAMP_TO_EDGE)}le&&(L.activeTexture.set(z.TEXTURE0),Qe.lineAtlasTexture&&Qe.lineAtlasTexture.bind(z.LINEAR,z.REPEAT),$e.updatePaintBuffers()),ve&&(L.activeTexture.set(z.TEXTURE0),Qe.imageAtlasTexture&&Qe.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),$e.updatePaintBuffers()),G&&f.terrain.setupElevationDraw(Qe,it),f.uploadCommonUniforms(L,it,lt.toUnwrapped());const Wt=Ct=>{Ue!=null&&(Ue.value=Te*R),it.draw(f,z.TRIANGLES,Z,Ct,Y,tn.disabled,dt,l.id,gt.layoutVertexBuffer,gt.indexBuffer,gt.segments,l.paint,f.transform.zoom,$e,[gt.layoutVertexBuffer2,gt.patternVertexBuffer,gt.zOffsetVertexBuffer]),Ue!=null&&(Ue.value=Te)};if(Me&&!G){const Ct=f.stencilModeForClipping(lt).ref;Ct===0&&se&&L.clear({stencil:0});const Nt={func:z.EQUAL,mask:255};dt.u_alpha_discard_threshold=.8,Wt(new un(Nt,Ct,255,z.KEEP,z.KEEP,z.INVERT)),dt.u_alpha_discard_threshold=0,Wt(new un(Nt,Ct,255,z.KEEP,z.KEEP,z.KEEP))}else Me&&G&&(dt.u_alpha_discard_threshold=.001),Wt(G?et:f.stencilModeForClipping(lt))}Me&&(f.resetStencilClippingMasks(),se&&L.clear({stencil:0})),R===0||f.depthOcclusion||se||f.layersWithOcclusionOpacity.push(f.currentLayer),G&&(f.forceTerrainMode=!1)},fill:function(f,i,l,p){const x=l.paint.get("fill-color"),w=l.paint.get("fill-opacity"),E=l.is3D(),R=new qt(f.context.gl.LEQUAL,qt.ReadWrite,f.depthRangeFor3D);if(w.constantOr(1)===0)return;const L=l.paint.get("fill-emissive-strength"),z=f.colorModeForDrapableLayerRenderPass(L),B=l.paint.get("fill-pattern"),G=f.opaquePassEnabledForLayer()&&!B.constantOr(1)&&x.constantOr(s.bz.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===G){const Z=E?R:f.depthModeForSublayer(1,f.renderPass==="opaque"?qt.ReadWrite:qt.ReadOnly);Nf(f,i,l,p,Z,z,!1)}if(!E&&f.renderPass==="translucent"&&l.paint.get("fill-antialias")){const Z=E?R:f.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,qt.ReadOnly);Nf(f,i,l,p,Z,z,!0)}},"fill-extrusion":function(f,i,l,p){const x=l.paint.get("fill-extrusion-opacity"),w=f.context,E=w.gl,R=f.terrain,L=R&&R.renderingToTexture;if(x===0)return;const z=f.conflationActive&&f.style.isLayerClipped(l,i.getSource()),B=f.style.order.indexOf(l.fqid);if(z&&function(G,Z,Y,se,oe){for(const ae of se){const le=Z.getTile(ae).getBucket(Y);le&&(le.updateReplacement(ae,G.replacementSource,oe),le.uploadCentroid(G.context))}}(f,i,l,p,B),R||z)for(const G of p){const Z=i.getTile(G).getBucket(l);Z&&Ja(f.context,i,G,Z,l,R,z)}if(f.renderPass==="shadow"&&f.shadowRenderer){const G=f.shadowRenderer;if(R&&x<.65&&l._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.a4)return;const Z=G.getShadowPassDepthMode(),Y=G.getShadowPassColorMode();Xc(f,i,l,p,Z,un.disabled,Y,z)}else if(f.renderPass==="translucent"){const G=!l.paint.get("fill-extrusion-pattern").constantOr(1),Z=l.paint.get("fill-extrusion-color").constantOr(s.bz.white);if(!L&&Z.a!==0){const Y=new qt(f.context.gl.LEQUAL,qt.ReadWrite,f.depthRangeFor3D);x===1&&G?Xc(f,i,l,p,Y,un.disabled,En.unblended,z):(Xc(f,i,l,p,Y,un.disabled,En.disabled,z),Xc(f,i,l,p,Y,f.stencilModeFor3D(),f.colorModeForRenderPass(),z),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&G&&(!R&&f.transform.projection.name!=="globe"||L)){const Y=l.paint.get("fill-extrusion-opacity"),se=l.paint.get("fill-extrusion-ambient-occlusion-intensity"),oe=l.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ae=l.paint.get("fill-extrusion-flood-light-intensity"),le=l.paint.get("fill-extrusion-flood-light-color").toRenderColor(l.lut).toArray01().slice(0,3),me=se>0&&oe>0,ye=ae>0,fe=(ve,Pe,Te)=>(1-Te)*ve+Te*Pe,be=ve=>{const Pe=f.depthModeForSublayer(1,qt.ReadOnly,E.LEQUAL,!0),Te=l.paint.get(ve?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Me=fe(.1,3,Te),Oe=f._showOverdrawInspector;if(!Oe){const ke=new un({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),De=new En([E.ONE,E.ONE,E.ONE,E.ONE],s.bz.transparent,[!1,!1,!1,!0],E.MIN);bi(f,i,l,p,Pe,ke,De,tn.disabled,ve,"sdf",Y,se,oe,ae,le,Me,z,!1)}{const ke=Oe?un.disabled:new un({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),De=Oe?f.colorModeForRenderPass():new En([E.ONE_MINUS_DST_ALPHA,E.DST_ALPHA,E.ONE,E.ONE],s.bz.transparent,[!0,!0,!0,!0]);bi(f,i,l,p,Pe,ke,De,tn.disabled,ve,"color",Y,se,oe,ae,le,Me,z,!1)}};if(L){const ve=(Pe,Te,Me)=>{const Oe=f.depthModeForSublayer(1,qt.ReadOnly,E.LEQUAL,!1),ke=l.paint.get(Pe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),De=fe(.1,3,ke);{const Ue=new En([E.ONE,E.ONE,E.ONE,E.ONE],s.bz.transparent,[!1,!1,!1,!0]);bi(f,i,l,p,Oe,un.disabled,Ue,tn.disabled,Pe,"clear",Y,se,oe,ae,le,De,z,Te)}{const Ue=new un({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),et=new En([E.ONE,E.ONE,E.ONE,E.ONE],s.bz.transparent,[!1,!1,!1,!0],E.MIN);bi(f,i,l,p,Oe,Ue,et,tn.disabled,Pe,"sdf",Y,se,oe,ae,le,De,z,Te)}{const Ue=Pe?E.ZERO:E.ONE_MINUS_DST_ALPHA,et=new un({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),lt=new En([Ue,E.DST_ALPHA,E.ONE_MINUS_DST_ALPHA,E.ZERO],s.bz.transparent,[!0,!0,!0,!0]);bi(f,i,l,p,Oe,et,lt,tn.disabled,Pe,"color",Y,se,oe,ae,le,De,z,Te)}{const Ue=new En([E.ONE,E.ONE,E.ONE,Pe?E.ZERO:E.ONE],s.bz.transparent,[!1,!1,!1,!0],Pe?E.FUNC_ADD:E.MAX);bi(f,i,l,p,Oe,un.disabled,Ue,tn.disabled,Pe,"clear",Y,se,oe,ae,le,De,z,Te,Me)}};if(me||ye){let Pe;if(f.prepareDrawTile(),R){const Te=R.drapeBufferSize[0],Me=R.drapeBufferSize[1];Pe=R.framebufferCopyTexture,Pe&&(!Pe||Pe.size[0]===Te&&Pe.size[1]===Me)||(Pe&&Pe.destroy(),Pe=R.framebufferCopyTexture=new s.T(w,new s.r({width:Te,height:Me}),E.RGBA8)),Pe.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.copyTexImage2D(E.TEXTURE_2D,0,E.RGBA,0,0,Te,Me,0)}me&&ve(!0,!1,Pe),ye&&ve(!1,!0,Pe)}}else me&&be(!0),ye&&be(!1),(me||ye)&&f.resetStencilClippingMasks()}}},hillshade:function(f,i,l,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const x=f.context,w=f.terrain&&f.terrain.renderingToTexture,[E,R]=f.renderPass!=="translucent"||w?[{},p]:f.stencilConfigForOverlap(p);for(const L of R){const z=i.getTile(L);if(z.needsHillshadePrepare&&f.renderPass==="offscreen")Id(f,z,l);else if(f.renderPass==="translucent"){const B=f.depthModeForSublayer(0,qt.ReadOnly),G=l.paint.get("hillshade-emissive-strength"),Z=f.colorModeForDrapableLayerRenderPass(G),Y=w&&f.terrain?f.terrain.stencilModeForRTTOverlap(L):E[L.overscaledZ];gf(f,L,z,l,B,Y,Z)}}x.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,i,l,p,x,w){if(f.renderPass!=="translucent"||l.paint.get("raster-opacity")===0)return;const E=f.transform.projection.name==="globe",R=l.paint.get("raster-elevation")!==0,L=R&&E;if(f.renderElevatedRasterBackface&&!L)return;const z=f.context,B=z.gl,G=i.getSource(),Z=function(ve,Pe,Te,Me){const Oe=Pe.paint.get("raster-color"),ke=ve.type==="raster-array",De=[],Ue=Pe.paint.get("raster-resampling"),et=Pe.paint.get("raster-color-mix");let lt=Pe.paint.get("raster-color-range");const Qe=[et[0],et[1],et[2],0],gt=et[3];let $e=Ue==="nearest"?Me.NEAREST:Me.LINEAR;if(ke&&(De.push("RASTER_ARRAY"),Oe||De.push("RASTER_COLOR"),Ue==="linear"&&De.push("RASTER_ARRAY_LINEAR"),$e=Me.NEAREST,!lt&&ve.rasterLayers)){const ot=ve.rasterLayers.find(({id:it})=>it===Pe.sourceLayer);ot&&ot.fields&&ot.fields.range&&(lt=ot.fields.range)}if(lt=lt||[0,1],Oe){De.push("RASTER_COLOR"),Te.activeTexture.set(Me.TEXTURE2),Pe.updateColorRamp(lt);let ot=Pe.colorRampTexture;ot||(ot=Pe.colorRampTexture=new s.T(Te,Pe.colorRamp,Me.RGBA8)),ot.bind(Me.LINEAR,Me.CLAMP_TO_EDGE)}return{mix:Qe,range:lt,offset:gt,defines:De,resampling:$e}}(G,l,z,B);if(G instanceof s.aD&&!p.length&&!E)return;const Y=l.paint.get("raster-emissive-strength"),se=f.colorModeForDrapableLayerRenderPass(Y),oe=f.terrain&&f.terrain.renderingToTexture,ae=!f.options.moving,le=l.paint.get("raster-resampling")==="nearest"?B.NEAREST:B.LINEAR;if(G instanceof s.aD&&!p.length&&(G.onNorthPole||G.onSouthPole)){const ve=R?f.stencilModeFor3D():un.disabled;return void hs(!!G.onNorthPole,null,f,i,l,Y,Z,tn.disabled,ve)}if(!p.length)return;const[me,ye]=G instanceof s.aD||oe?[{},p]:f.stencilConfigForOverlap(p),fe=ye[ye.length-1].overscaledZ;L&&Z.defines.push("PROJECTION_GLOBE_VIEW"),R&&Z.defines.push("RENDER_CUTOFF");const be=(ve,Pe,Te)=>{for(const Me of ve){const Oe=Me.toUnwrapped(),ke=i.getTile(Me);if(oe&&(!ke||!ke.hasData()))continue;z.activeTexture.set(B.TEXTURE0);const De=Lf(ke,G,l,Z);if(!De||!De.texture)continue;const{texture:Ue,mix:et,offset:lt,tileSize:Qe,buffer:gt}=De;let $e,ot;oe?($e=qt.disabled,ot=Me.projMatrix):R?($e=new qt(B.LEQUAL,qt.ReadWrite,f.depthRangeFor3D),ot=E?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(Oe,ae)):($e=f.depthModeForSublayer(Me.overscaledZ-fe,l.paint.get("raster-opacity")===1?qt.ReadWrite:qt.ReadOnly,B.LESS),ot=f.transform.calculateProjMatrix(Oe,ae));const it=f.terrain&&oe?f.terrain.stencilModeForRTTOverlap(Me):me[Me.overscaledZ],_t=w?0:l.paint.get("raster-fade-duration");ke.registerFadeDuration(_t);const vt=i.findLoadedParent(Me,0),at=Sf(ke,vt,i,f.transform,_t);let dt,Wt;f.terrain&&f.terrain.prepareDrawTile(),z.activeTexture.set(B.TEXTURE0),Ue.bind(le,B.CLAMP_TO_EDGE),z.activeTexture.set(B.TEXTURE1),vt?(vt.texture&&vt.texture.bind(le,B.CLAMP_TO_EDGE),dt=Math.pow(2,vt.tileID.overscaledZ-ke.tileID.overscaledZ),Wt=[ke.tileID.canonical.x*dt%1,ke.tileID.canonical.y*dt%1]):Ue.bind(le,B.CLAMP_TO_EDGE),Ue.useMipmap&&z.extTextureFilterAnisotropic&&f.transform.pitch>20&&B.texParameterf(B.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const Ct=f.transform;let Nt;const Kt=R?kr(Ct):[0,0,0,0];let Bt,Zt,vn,yn,nr,lr=0;if(L&&G instanceof s.aD&&G.coordinates.length>3)Bt=Float32Array.from(s.b5(s.cC(new s.bP(0,0,0)))),Zt=Float32Array.from(Ct.globeMatrix),vn=Float32Array.from(s.cy(Ct)),yn=[s.am(Ct.center.lng),s.at(Ct.center.lat)],Nt=G.elevatedGlobePerspectiveTransform,nr=G.elevatedGlobeGridMatrix||new Float32Array(9);else if(L){const Cn=s.cz(Me.canonical);lr=s.cA(Cn.getCenter().lat),Bt=Float32Array.from(s.b5(s.cC(Me.canonical))),Zt=Float32Array.from(Ct.globeMatrix),vn=Float32Array.from(s.cy(Ct)),yn=[s.am(Ct.center.lng),s.at(Ct.center.lat)],Nt=[0,0],nr=Float32Array.from(s.cB(Me.canonical,Cn,lr,Ct.worldSize/Ct._pixelsPerMercatorPixel))}else Nt=G instanceof s.aD?G.perspectiveTransform:[0,0],Bt=new Float32Array(16),Zt=new Float32Array(9),vn=new Float32Array(16),yn=[0,0],nr=new Float32Array(9);const yr=jd(ot,Bt,Zt,vn,nr,Wt||[0,0],s.a9(f.transform.zoom),yn,Kt,dt||1,at,l,Nt,R?l.paint.get("raster-elevation"):0,2,et,lt,Z.range,Qe,gt,Y),Us=f.isTileAffectedByFog(Me),Vr=f.getOrCreateProgram("raster",{defines:Z.defines,overrideFog:Us});if(f.uploadCommonUniforms(z,Vr,Oe),G instanceof s.aD){const Cn=G.elevatedGlobeVertexBuffer,sr=G.elevatedGlobeIndexBuffer;if(oe||!E)G.boundsBuffer&&G.boundsSegments&&Vr.draw(f,B.TRIANGLES,$e,un.disabled,se,tn.disabled,yr,l.id,G.boundsBuffer,f.quadTriangleIndexBuffer,G.boundsSegments);else if(Cn&&sr){const Tr=Ct.zoom<=s.c2?G.elevatedGlobeSegments:G.getSegmentsForLongitude(Ct.center.lng);Tr&&Vr.draw(f,B.TRIANGLES,$e,un.disabled,se,Pe,yr,l.id,Cn,sr,Tr)}}else if(L){$e=new qt(B.LEQUAL,qt.ReadOnly,f.depthRangeFor3D);const Cn=f.globeSharedBuffers;if(Cn){const[sr,Tr,ir]=Cn.getGridBuffers(lr,!1);Vr.draw(f,B.TRIANGLES,$e,Te||it,f.colorModeForRenderPass(),Pe,yr,l.id,sr,Tr,ir)}}else{const{tileBoundsBuffer:Cn,tileBoundsIndexBuffer:sr,tileBoundsSegments:Tr}=f.getTileBoundsBuffers(ke);Vr.draw(f,B.TRIANGLES,$e,it,se,tn.disabled,yr,l.id,Cn,sr,Tr)}}if(!(G instanceof s.aD)&&L)for(const Me of ve){const Oe=Me.canonical.y===(1<<Me.canonical.z)-1;Me.canonical.y===0&&hs(!0,Me,f,i,l,Y,Z,Pe,Te||un.disabled),Oe&&hs(!1,Me,f,i,l,Y,Z,Pe===tn.frontCW?tn.backCW:tn.frontCW,Te||un.disabled)}};L?be(ye,f.renderElevatedRasterBackface?tn.backCW:tn.frontCW,f.stencilModeFor3D()):be(ye,tn.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,i,l,p,x,w){f.renderPass==="offscreen"&&function(E,R,L,z){if(!z.length)return;const B=E.context,G=B.gl,Z=R.getSource();if(!(Z instanceof Tc))return;const Y=Math.ceil(Math.sqrt(L.paint.get("raster-particle-count")));let se=L.particlePositionRGBAImage;if(!se||se.width!==Y){const ye=function(fe){const be=fe*fe,ve=new Uint8Array(4*be),Pe=function(Me){return Me|=0,Me=Math.imul(2747636419^Me,2654435769),Me=Math.imul(Me^Me>>>16,2654435769),((Me=Math.imul(Me^Me>>>16,2654435769))>>>0)/4294967296},Te=1/1.1;for(let Me=0;Me<be;Me++){const Oe=Te*(Pe(2*Me+0)+Fo),ke=Te*(Pe(2*Me+1)+Fo),De=255*Oe%1,Ue=255*ke%1,et=De,lt=ke-Ue/255,Qe=Ue;ve[4*Me+0]=255*(Oe-De/255),ve[4*Me+1]=255*et,ve[4*Me+2]=255*lt,ve[4*Me+3]=255*Qe}return ve}(Y);se=L.particlePositionRGBAImage=new s.r({width:Y,height:Y},ye)}let oe=L.particleFramebuffer;oe?oe.width!==Y&&(oe.destroy(),oe=L.particleFramebuffer=B.createFramebuffer(Y,Y,!0,null)):oe=L.particleFramebuffer=B.createFramebuffer(Y,Y,!0,null);const ae=[];for(const ye of z){const fe=R.getTile(ye);if(!(fe instanceof Jh))continue;const be=Wx(fe,Z,L);if(!be)continue;const ve=[fe.tileSize,fe.tileSize];let Pe=L.tileFramebuffer;Pe||(Pe=L.tileFramebuffer=B.createFramebuffer(ve[0],ve[1],!0,null));let Te=fe.rasterParticleState;Te||(Te=fe.rasterParticleState=new Gx(B,ye,ve,se));const Me=Te.update(L.lastInvalidatedAt);Te.particleTextureDimension!==Y&&Te.updateParticleTexture(ye,se);const Oe=Te.targetColorTexture;Te.targetColorTexture=Te.backgroundColorTexture,Te.backgroundColorTexture=Oe;const ke=Te.particleTexture0;Te.particleTexture0=Te.particleTexture1,Te.particleTexture1=ke,ae.push([ye,be,Te,Me])}if(ae.length===0)return;const le=s.q.now(),me=L.previousDrawTimestamp?.001*(le-L.previousDrawTimestamp):.0167;if(L.previousDrawTimestamp=le,L.hasColorMap()){B.activeTexture.set(G.TEXTURE0+2);let ye=L.colorRampTexture;ye||(ye=L.colorRampTexture=new s.T(B,L.colorRamp,G.RGBA8)),ye.bind(G.LINEAR,G.CLAMP_TO_EDGE)}B.bindFramebuffer.set(L.tileFramebuffer.framebuffer),function(ye,fe,be){const ve=ye.context,Pe=ve.gl,Te=fe.tileFramebuffer;ve.activeTexture.set(Pe.TEXTURE0);const Me={u_texture:0,u_opacity:1.05*(ke=fe.paint.get("raster-particle-fade-opacity-factor"))/(ke+.05)},Oe=ye.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ke;for(const De of be){const[,,Ue,et]=De;Te.colorAttachment.set(Ue.targetColorTexture.texture),ve.viewport.set([0,0,Te.width,Te.height]),ve.clear({color:s.bz.transparent}),et&&(Ue.backgroundColorTexture.bind(Pe.NEAREST,Pe.CLAMP_TO_EDGE),Oe.draw(ye,Pe.TRIANGLES,qt.disabled,un.disabled,En.alphaBlended,tn.disabled,Me,fe.id,ye.viewportBuffer,ye.quadTriangleIndexBuffer,ye.viewportSegments))}}(E,L,ae),function(ye,fe,be,ve){const Pe=ye.context,Te=Pe.gl,Me=be.tileFramebuffer,Oe=ye.transform.projection.name==="globe",ke=be.paint.get("raster-particle-max-speed");for(const De of ve){const[Ue,et,lt]=De;Pe.activeTexture.set(Te.TEXTURE0+0),et.texture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),Me.colorAttachment.set(lt.targetColorTexture.texture);const Qe=ye.getOrCreateProgram("rasterParticleDraw",{defines:et.defines,overrideFog:!1});Pe.activeTexture.set(Te.TEXTURE0+1);const gt=et.scalarData?[]:[0,1,2,3].map(it=>s.c$[it](Ue));gt.push(Ue);const $e=Ue.canonical.x,ot=Ue.canonical.y;for(const it of gt){const _t=fe.getTile(Oe?it.wrapped():it);if(!_t)continue;const vt=_t.rasterParticleState;if(!vt)continue;const at=it.canonical.x+(1<<it.canonical.z)*(it.wrap-Ue.wrap),dt=it.canonical.y;vt.particleTexture0.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);const Wt=Mf(1,vt.particleTexture0.size[0],[at-$e,dt-ot],0,et.texture.size,2,ke,et.textureOffset,et.scale,et.offset);Qe.draw(ye,Te.POINTS,qt.disabled,un.disabled,En.alphaBlended,tn.disabled,Wt,be.id,vt.particleIndexBuffer,void 0,vt.particleSegment)}}}(E,R,L,ae),B.bindFramebuffer.set(L.particleFramebuffer.framebuffer),function(ye,fe,be,ve){const Pe=ye.context,Te=Pe.gl,Me=fe.paint.get("raster-particle-max-speed"),Oe=ve*fe.paint.get("raster-particle-speed-factor")*.15,ke=function(Ue){return Math.pow(Ue,6)}(.01+1*fe.paint.get("raster-particle-reset-rate-factor")),De=fe.particleFramebuffer;Pe.viewport.set([0,0,De.width,De.height]);for(const Ue of be){const[,et,lt]=Ue;Pe.activeTexture.set(Te.TEXTURE0+0),et.texture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),Pe.activeTexture.set(Te.TEXTURE0+1);const Qe=lt.particleTexture0;Qe.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);const gt=Af(1,Qe.size[0],0,et.texture.size,Me,Oe,ke,et.textureOffset,et.scale,et.offset);De.colorAttachment.set(lt.particleTexture1.texture),Pe.clear({color:s.bz.transparent}),ye.getOrCreateProgram("rasterParticleUpdate",{defines:et.defines}).draw(ye,Te.TRIANGLES,qt.disabled,un.disabled,En.unblended,tn.disabled,gt,fe.id,ye.viewportBuffer,ye.quadTriangleIndexBuffer,ye.viewportSegments)}}(E,L,ae,me)}(f,i,l,p),f.renderPass==="translucent"&&(function(E,R,L,z,B){const G=E.context,Z=G.gl,Y=R.getSource().tileSize,se=5*(1-s.a7(s.bU,s.bU+1,E.transform.zoom))*Y+L.paint.get("raster-particle-elevation"),oe=!E.options.moving,ae=E.transform.projection.name==="globe";if(!z.length)return;const[le,me]=E.stencilConfigForOverlap(z),ye=[];ae&&ye.push("PROJECTION_GLOBE_VIEW");const fe=E.stencilModeFor3D();for(const be of me){const ve=be.toUnwrapped(),Pe=R.getTile(be);if(!Pe.rasterParticleState)continue;const Te=Pe.rasterParticleState,Me=100;Pe.registerFadeDuration(Me);const Oe=R.findLoadedParent(be,0),ke=Sf(Pe,Oe,R,E.transform,Me);let De,Ue;E.terrain&&E.terrain.prepareDrawTile(),G.activeTexture.set(Z.TEXTURE0),Te.targetColorTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),G.activeTexture.set(Z.TEXTURE1),Oe&&Oe.rasterParticleState?(Oe.rasterParticleState.targetColorTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),De=Math.pow(2,Oe.tileID.overscaledZ-Pe.tileID.overscaledZ),Ue=[Pe.tileID.canonical.x*De%1,Pe.tileID.canonical.y*De%1]):Te.targetColorTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const et=ae?Float32Array.from(E.transform.expandedFarZProjMatrix):E.transform.calculateProjMatrix(ve,oe),lt=E.transform,Qe=Hx(lt),gt=s.cz(be.canonical),$e=s.cA(gt.getCenter().lat);let ot,it,_t,vt,at;ae?(ot=Float32Array.from(s.b5(s.cC(be.canonical))),it=Float32Array.from(lt.globeMatrix),_t=Float32Array.from(s.cy(lt)),vt=[s.am(lt.center.lng),s.at(lt.center.lat)],at=Float32Array.from(s.cB(be.canonical,gt,$e,lt.worldSize/lt._pixelsPerMercatorPixel))):(ot=new Float32Array(16),it=new Float32Array(9),_t=new Float32Array(16),vt=[0,0],at=new Float32Array(9));const dt=Bx(et,ot,it,_t,at,Ue||[0,0],s.a9(E.transform.zoom),vt,Qe,De||1,ke,se),Wt=E.isTileAffectedByFog(be),Ct=E.getOrCreateProgram("rasterParticle",{defines:ye,overrideFog:Wt});if(E.uploadCommonUniforms(G,Ct,ve),ae){const Nt=new qt(Z.LEQUAL,qt.ReadOnly,E.depthRangeFor3D),Kt=0,Bt=E.globeSharedBuffers;if(Bt){const[Zt,vn,yn]=Bt.getGridBuffers($e,Kt!==0);Ct.draw(E,Z.TRIANGLES,Nt,fe,En.alphaBlended,E.renderElevatedRasterBackface?tn.frontCCW:tn.backCCW,dt,L.id,Zt,vn,yn)}}else{const Nt=E.depthModeForSublayer(0,qt.ReadOnly),Kt=le[be.overscaledZ],{tileBoundsBuffer:Bt,tileBoundsIndexBuffer:Zt,tileBoundsSegments:vn}=E.getTileBoundsBuffers(Pe);Ct.draw(E,Z.TRIANGLES,Nt,Kt,En.alphaBlended,tn.disabled,dt,L.id,Bt,Zt,vn)}}E.resetStencilClippingMasks()}(f,i,l,p),f.style.map.triggerRepaint())},background:function(f,i,l,p){const x=l.paint.get("background-color"),w=l.paint.get("background-opacity"),E=l.paint.get("background-emissive-strength"),R=l.paint.get("background-pitch-alignment")==="viewport";if(w===0)return;const L=f.context,z=L.gl,B=f.transform,G=B.tileSize,Z=l.paint.get("background-pattern");let Y;if(Z!==void 0&&(Z===null||(Y=f.imageManager.getPattern(Z.toString(),l.scope,f.style.getLut(l.scope)),!Y)))return;const se=!Z&&x.a===1&&w===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==se)return;const oe=un.disabled,ae=f.depthModeForSublayer(0,se==="opaque"?qt.ReadWrite:qt.ReadOnly),le=f.colorModeForDrapableLayerRenderPass(E),me=Z?"backgroundPattern":"background";let ye,fe=p;if(fe||(ye=f.getBackgroundTiles(),fe=Object.values(ye).map(be=>be.tileID)),Z&&(L.activeTexture.set(z.TEXTURE0),f.imageManager.bind(f.context,l.scope)),R){const be=f.getOrCreateProgram(me,{overrideFog:!1,overrideRtt:!0}),ve=new Float32Array(s.a6.mat4.identity([])),Pe=new s.aA(0,0,0,0,0),Te=Z?Nl(ve,E,w,f,0,l.scope,Y,R,{tileID:Pe,tileSize:G}):Vx(ve,E,w,x.toRenderColor(l.lut));be.draw(f,z.TRIANGLES,ae,oe,le,tn.disabled,Te,l.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(const be of fe){const ve=f.isTileAffectedByFog(be),Pe=f.getOrCreateProgram(me,{overrideFog:ve}),Te=be.toUnwrapped(),Me=p?be.projMatrix:f.transform.calculateProjMatrix(Te);f.prepareDrawTile();const Oe=i?i.getTile(be):ye?ye[be.key]:new Oo(be,G,B.zoom,f),ke=Z?Nl(Me,E,w,f,0,l.scope,Y,R,{tileID:be,tileSize:G}):Vx(Me,E,w,x.toRenderColor(l.lut));f.uploadCommonUniforms(L,Pe,Te);const{tileBoundsBuffer:De,tileBoundsIndexBuffer:Ue,tileBoundsSegments:et}=f.getTileBoundsBuffers(Oe);Pe.draw(f,z.TRIANGLES,ae,oe,le,tn.disabled,ke,l.id,De,Ue,et)}},sky:function(f,i,l){const p=f._atmosphere?s.a9(f.transform.zoom):1,x=l.paint.get("sky-opacity")*p;if(x===0)return;const w=f.context,E=l.paint.get("sky-type"),R=new qt(w.gl.LEQUAL,qt.ReadOnly,[0,1]),L=f.frameCounter/1e3%1;E==="atmosphere"?f.renderPass==="offscreen"?l.needsSkyboxCapture(f)&&(function(z,B,G,Z){const Y=z.context,se=Y.gl;let oe=B.skyboxFbo;if(!oe){oe=B.skyboxFbo=Y.createFramebuffer(32,32,!0,null),B.skyboxGeometry=new gg(Y),B.skyboxTexture=Y.gl.createTexture(),se.bindTexture(se.TEXTURE_CUBE_MAP,B.skyboxTexture),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_S,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_T,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MIN_FILTER,se.LINEAR),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MAG_FILTER,se.LINEAR);for(let ye=0;ye<6;++ye)se.texImage2D(se.TEXTURE_CUBE_MAP_POSITIVE_X+ye,0,se.RGBA,32,32,0,se.RGBA,se.UNSIGNED_BYTE,null)}Y.bindFramebuffer.set(oe.framebuffer),Y.viewport.set([0,0,32,32]);const ae=B.getCenter(z,!0),le=z.getOrCreateProgram("skyboxCapture"),me=new Float64Array(16);s.a6.mat4.identity(me),s.a6.mat4.rotateY(me,me,.5*-Math.PI),Ol(z,B,le,me,ae,0),s.a6.mat4.identity(me),s.a6.mat4.rotateY(me,me,.5*Math.PI),Ol(z,B,le,me,ae,1),s.a6.mat4.identity(me),s.a6.mat4.rotateX(me,me,.5*-Math.PI),Ol(z,B,le,me,ae,2),s.a6.mat4.identity(me),s.a6.mat4.rotateX(me,me,.5*Math.PI),Ol(z,B,le,me,ae,3),s.a6.mat4.identity(me),Ol(z,B,le,me,ae,4),s.a6.mat4.identity(me),s.a6.mat4.rotateY(me,me,Math.PI),Ol(z,B,le,me,ae,5),Y.viewport.set([0,0,z.width,z.height])}(f,l),l.markSkyboxValid(f)):f.renderPass==="sky"&&function(z,B,G,Z,Y){const se=z.context,oe=se.gl,ae=z.transform,le=z.getOrCreateProgram("skybox");se.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_CUBE_MAP,B.skyboxTexture);const me=((ye,fe,be,ve,Pe)=>({u_matrix:ye,u_sun_direction:fe,u_cubemap:0,u_opacity:ve,u_temporal_offset:Pe}))(ae.skyboxMatrix,B.getCenter(z,!1),0,Z,Y);z.uploadCommonUniforms(se,le),le.draw(z,oe.TRIANGLES,G,un.disabled,z.colorModeForRenderPass(),tn.backCW,me,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(f,l,R,x,L):E==="gradient"&&f.renderPass==="sky"&&function(z,B,G,Z,Y){const se=z.context,oe=se.gl,ae=z.transform,le=z.getOrCreateProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new gg(se)),se.activeTexture.set(oe.TEXTURE0);let me=B.colorRampTexture;me||(me=B.colorRampTexture=new s.T(se,B.colorRamp,oe.RGBA8)),me.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);const ye=((fe,be,ve,Pe,Te)=>({u_matrix:fe,u_color_ramp:0,u_center_direction:be,u_radius:s.bB(ve),u_opacity:Pe,u_temporal_offset:Te}))(ae.skyboxMatrix,B.getCenter(z,!1),B.paint.get("sky-gradient-radius"),Z,Y);z.uploadCommonUniforms(se,le),le.draw(z,oe.TRIANGLES,G,un.disabled,z.colorModeForRenderPass(),tn.backCW,ye,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(f,l,R,x,L)},debug:function(f,i,l,p,x,w){for(let E=0;E<l.length;E++)if(x){const z=new s.bz(p.r*.8,p.g*.8,p.b*.8,1);ho(f,i,l[E],p,-1,-1,w),ho(f,i,l[E],p,-1,1,w),ho(f,i,l[E],p,1,1,w),ho(f,i,l[E],p,1,-1,w),ho(f,i,l[E],z,0,0,w)}else ho(f,i,l[E],p,0,0,w)},custom:function(f,i,l,p){const x=f.context,w=l.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&l.isDraped(i)){if(f.renderPass==="offscreen"){const E=w.prerender;if(E){if(f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const R=f.transform.pointMerc;E.call(w,x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),s.a9(f.transform.zoom),[R.x,R.y],f.transform.pixelsPerMeterRatio)}else E.call(w,x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const R=w.renderToTile;if(R){const L=p[0].canonical,z=new s.a5(L.x+p[0].wrap*(1<<L.z),L.y,L.z);x.setDepthMode(qt.disabled),x.setStencilMode(un.disabled),x.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),R.call(w,x.gl,z),x.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),x.setStencilMode(un.disabled);const E=w.renderingMode==="3d"?new qt(f.context.gl.LEQUAL,qt.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,qt.ReadOnly);if(x.setDepthMode(E),f.transform.projection.name==="globe"){const R=f.transform.pointMerc;w.render(x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),s.a9(f.transform.zoom),[R.x,R.y],f.transform.pixelsPerMeterRatio)}else w.render(x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState(),x.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,i,l,p){if(f.renderPass==="opaque")return;const x=l.paint.get("model-opacity");if(x===0)return;const w=l.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!w||f.terrain&&x<.65&&l._transitionablePaint._values["model-opacity"].value.expression instanceof s.a4))return;const E=f.shadowRenderer,R=l.paint.get("model-receive-shadows");E&&(E.useNormalOffset=!0,R||(E.enabled=!1));const L=()=>{E&&(E.useNormalOffset=!0,R||(E.enabled=!0))},z=i.getSource();if(f.renderPass==="light-beam"&&z.type!=="batched-model")return;if(z.type==="vector"||z.type==="geojson")return function(le,me,ye,fe,be){const ve=le.transform;if(ve.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${ve.projection.name} projection is not yet implemented`);const Pe=ve.getFreeCameraOptions().position;if(!le.modelManager)return;const Te=le.modelManager;ye.modelManager=Te;const Me=le.shadowRenderer;if(!ye._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Oe=ye._unevaluatedLayout._values["model-id"],ke={...ye.layout.get("model-id").parameters},De=le.style.order.indexOf(ye.fqid);for(const Ue of fe){const et=me.getTile(Ue).getBucket(ye);if(!et||et.projection.name!==ve.projection.name)continue;const lt=et.getModelUris();lt&&!et.modelsRequested&&(Te.addModelsFromBucket(lt,be),et.modelsRequested=!0);const Qe=vw(Ue,ve);ke.zoom=Qe;const gt=Oe.possiblyEvaluate(ke);if(Zx(le,et,Ue),po.shadowUniformsInitialized=!1,po.useSingleShadowCascade=!!Me&&Me.getMaxCascadeForTile(Ue.toUnwrapped())===0,le.renderPass==="shadow"&&Me){if(le.currentShadowCascade===1&&et.isInsideFirstShadowMapFrustum)continue;const it=ve.calculatePosMatrix(Ue.toUnwrapped(),ve.worldSize);if(po.tileMatrix.set(it),po.shadowTileMatrix=Float32Array.from(Me.calculateShadowPassMatrixFromMatrix(it)),po.aabb.min.fill(0),po.aabb.max[0]=po.aabb.max[1]=s.ab,po.aabb.max[2]=0,Gd(et,po,le,ye.scope))continue}const $e=1<<Ue.canonical.z,ot=[((Pe.x-Ue.wrap)*$e-Ue.canonical.x)*s.ab,(Pe.y*$e-Ue.canonical.y)*s.ab,Pe.z*$e*s.ab];le.conflationActive&&Object.keys(et.instancesPerModel).length>0&&le.style.isLayerClipped(ye,me.getSource())&&et.updateReplacement(Ue,le.replacementSource,De,be)&&(et.uploaded=!1,et.upload(le.context));for(let it in et.instancesPerModel){const _t=et.instancesPerModel[it];_t.features.length>0&&(it=gt.evaluate(_t.features[0].feature,{}));const vt=Te.getModel(it,be);if(vt&&vt.uploaded)for(const at of vt.nodes)$i(le,ye,at,_t,ot,Ue,po)}}}(f,i,l,p,z.type==="vector"?l.scope:""),void L();if(!z.loaded())return;if(z.type==="batched-model")return function(le,me,ye,fe){ye.resetLayerRenderingStats(le);const be=le.context,ve=le.transform,Pe=le.style.fog,Te=le.shadowRenderer;if(ve.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${ve.projection.name} projection is not yet implemented`);const Me=le.transform.getFreeCameraOptions().position,Oe=s.a6.vec3.scale([],[Me.x,Me.y,Me.z],le.transform.worldSize),ke=s.a6.vec3.negate([],Oe),De=s.a6.mat4.identity([]),Ue=s.de(ve.center.lat,ve.zoom),et=s.a6.mat4.fromScaling([],[1,1,1/Ue]);s.a6.mat4.translate(De,De,ke);const lt=ye.paint.get("model-opacity"),Qe=new qt(be.gl.LEQUAL,qt.ReadWrite,le.depthRangeFor3D),gt=new qt(be.gl.LEQUAL,qt.ReadOnly,le.depthRangeFor3D),$e=new s.c9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ot=le.renderPass==="shadow",it=ot&&Te?Te.getCurrentCascadeFrustum():ve.getFrustum(ve.scaleZoom(ve.worldSize)),_t=ye.paint.get("model-front-cutoff"),vt=_t[2]<1,at=pa(le,ye.paint.get("model-cutoff-fade-range")),dt=ye.getLayerRenderingStats();(function(Wt,Ct,Nt,Kt){const Bt=Wt.terrain?Wt.terrain.exaggeration():0,Zt=Wt.transform.zoom;for(const vn of Kt){const yn=Ct.getTile(vn).getBucket(Nt);yn&&(Wt.conflationActive&&yn.updateReplacement(vn,Wt.replacementSource),yn.evaluateScale(Wt,Nt),Wt.terrain&&Bt>0&&yn.elevationUpdate(Wt.terrain,Bt,vn,Nt.source),yn.needsReEvaluation(Wt,Zt,Nt)&&yn.evaluate(Nt))}})(le,me,ye,fe),function(){let Wt,Ct,Nt;vt?(Wt=fe.length-1,Ct=-1,Nt=-1):(Wt=0,Ct=fe.length,Nt=1);const Kt=new Float64Array(16),Bt=s.a6.vec3.create(),Zt=new s.P(0,0);for(let vn=Wt;vn!==Ct;vn+=Nt){const yn=fe[vn],nr=me.getTile(yn).getBucket(ye);if(!nr||!nr.uploaded)continue;let lr=!1;Te&&(lr=Te.getMaxCascadeForTile(yn.toUnwrapped())===0);const yr=ve.calculatePosMatrix(yn.toUnwrapped(),ve.worldSize),Us=nr.modelTraits;!ot&&vt&&(s.a6.mat4.invert(Kt,yr),s.a6.vec3.transformMat4(Bt,Oe,Kt),Zt.x=Bt[0],Zt.y=Bt[1]);const Vr=[];for(const Cn of nr.getNodesInfo()){if(Cn.hiddenByReplacement||!Cn.node.meshes)continue;const sr=Cn.node;let Tr=0;le.terrain&&sr.elevation&&(Tr=sr.elevation*le.terrain.exaggeration());const ir=(()=>{const fr=Cn.aabb;return $e.min=[...fr.min],$e.max=[...fr.max],$e.min[2]+=Tr,$e.max[2]+=Tr,s.a6.vec3.transformMat4($e.min,$e.min,yr),s.a6.vec3.transformMat4($e.max,$e.max,yr),$e})(),_n=Cn.evaluatedScale;if(_n[0]<=1&&_n[1]<=1&&_n[2]<=1&&ir.intersects(it)===0)continue;if(!ot&&vt){const fr=.16666666666666666;Cn.cameraCollisionOpacity=Oe[0]>ir.min[0]&&Oe[0]<ir.max[0]&&Oe[1]>ir.min[1]&&Oe[1]<ir.max[1]&&Oe[2]*Ue<ir.max[2]&&sr.footprint&&s.bu(Zt,sr.footprint)?Math.max(Cn.cameraCollisionOpacity-fr,0):Math.min(1,Cn.cameraCollisionOpacity+fr)}const Vn=[...yr],Kn=sr.anchor?sr.anchor[0]:0,Lr=sr.anchor?sr.anchor[1]:0;s.a6.mat4.translate(Vn,Vn,[Kn*(_n[0]-1),Lr*(_n[1]-1),Tr]),s.a6.vec3.exactEquals(_n,s.dh)||s.a6.mat4.scale(Vn,Vn,_n);const Ur=s.a6.mat4.multiply([],Vn,sr.matrix),Nn=s.a6.mat4.multiply([],ve.expandedFarZProjMatrix,Ur),oi=s.a6.mat4.multiply([],ve.expandedFarZProjMatrix,Vn),gi=s.a6.vec4.transformMat4([],[Kn,Lr,Tr,1],Nn)[2];sr.hidden=!1;let ai=lt;ot||(vt&&(ai*=Cn.cameraCollisionOpacity,ai*=Bn(Vn,ve,Cn.aabb,_t)),ai*=xr(at,gi)),ai!==0?Vr.push({nodeInfo:Cn,depth:gi,opacity:ai,wvpForNode:Nn,wvpForTile:oi,nodeModelMatrix:Ur,tileModelMatrix:Vn}):sr.hidden=!0}ot||Vr.sort((Cn,sr)=>!vt||Cn.opacity===1&&sr.opacity===1?Cn.depth<sr.depth?-1:1:Cn.opacity===1?-1:sr.opacity===1?1:Cn.depth>sr.depth?-1:1);for(const Cn of Vr){const sr=Cn.nodeInfo,Tr=sr.node;let ir=s.a6.mat4.multiply([],et,Cn.tileModelMatrix);s.a6.mat4.multiply(ir,De,ir);const _n=s.a6.mat4.invert([],ir);s.a6.mat4.transpose(_n,_n),s.a6.mat4.scale(_n,_n,bw),ir=s.a6.mat4.multiply(ir,ir,Tr.matrix);const Vn=le.renderPass==="light-beam",Kn=Us&s.dj.HasMapboxMeshFeatures,Lr=Kn?0:sr.evaluatedRMEA[0][2];for(let Ur=0;Ur<Tr.meshes.length;++Ur){const Nn=Tr.meshes[Ur],oi=Ur===Tr.lightMeshIndex;let gi=Cn.wvpForNode;if(oi){if(!Vn&&!le.terrain&&le.shadowRenderer){le.currentLayer<le.firstLightBeamLayer&&(le.firstLightBeamLayer=le.currentLayer);continue}gi=Cn.wvpForTile}else if(Vn)continue;const ai={defines:[]},fr=[];if(Ff(ai.defines,fr,Nn,le,ye.lut),Kn||ai.defines.push("DIFFUSE_SHADED"),lr&&ai.defines.push("SHADOWS_SINGLE_CASCADE"),dt&&(ot?dt.numRenderedVerticesInShadowPass+=Nn.vertexArray.length:dt.numRenderedVerticesInTransparentPass+=Nn.vertexArray.length),ot){Qc(Nn,Cn.nodeModelMatrix,le,ye);continue}let Qi=null;if(Pe){const va=zf(Cn.nodeModelMatrix,le.transform);if(Qi=new Float32Array(va),ve.projection.name!=="globe"){const il=Nn.aabb.min,$o=Nn.aabb.max,[su,ou]=Pe.getOpacityForBounds(va,il[0],il[1],$o[0],$o[1]);ai.overrideFog=su>=Rt||ou>=Rt}}const es=Nn.material;let $s;es.occlusionTexture&&es.occlusionTexture.offsetScale&&($s=es.occlusionTexture.offsetScale,ai.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!ot&&Te&&(Te.useNormalOffset=!!Nn.normalBuffer);const Ds=le.getOrCreateProgram("model",ai);!ot&&Te&&Te.setupShadowsFromMatrix(Cn.tileModelMatrix,Ds,Te.useNormalOffset),le.uploadCommonUniforms(be,Ds,null,Qi);const fs=es.pbrMetallicRoughness;fs.metallicFactor=.9,fs.roughnessFactor=.5;const Gs=Ot(new Float32Array(gi),new Float32Array(ir),new Float32Array(_n),new Float32Array(Tr.matrix),le,Cn.opacity,fs.baseColorFactor.toRenderColor(null),es.emissiveFactor,fs.metallicFactor,fs.roughnessFactor,es,Lr,ye,[0,0,0],$s);!oi&&(sr.hasTranslucentParts||Cn.opacity<1)&&Ds.draw(le,be.gl.TRIANGLES,Qe,un.disabled,En.disabled,tn.backCCW,Gs,ye.id,Nn.vertexBuffer,Nn.indexBuffer,Nn.segments,ye.paint,le.transform.zoom,void 0,fr),Ds.draw(le,be.gl.TRIANGLES,oi?gt:Qe,un.disabled,oi||Cn.opacity<1||sr.hasTranslucentParts?En.alphaBlended:En.unblended,tn.backCCW,Gs,ye.id,Nn.vertexBuffer,Nn.indexBuffer,Nn.segments,ye.paint,le.transform.zoom,void 0,fr)}}}}()}(f,i,l,p),void L();if(z.type!=="model")return;const B=z.getModels(),G=[],Z=f.transform.getFreeCameraOptions().position,Y=s.a6.vec3.scale([],[Z.x,Z.y,Z.z],f.transform.worldSize);s.a6.vec3.negate(Y,Y);const se=[],oe=[];let ae=0;for(const le of B){const me=l.paint.get("model-rotation").constantOr(null),ye=l.paint.get("model-scale").constantOr(null),fe=l.paint.get("model-translation").constantOr(null);le.computeModelMatrix(f,me,ye,fe,!0,!0,!1);const be=s.a6.mat4.identity([]),ve=s.de(le.position.lat,f.transform.zoom),Pe=s.a6.mat4.fromScaling([],[1,1,1/ve]);s.a6.mat4.translate(be,be,Y),G.push({zScaleMatrix:Pe,negCameraPosMatrix:be});for(const Te of le.nodes)$d(f.transform,Te,le.matrix,f.transform.expandedFarZProjMatrix,ae,se,oe);ae++}if(se.sort((le,me)=>me.depth-le.depth),f.renderPass!=="shadow"){if(x===1)for(const le of oe)Ud(le,f,l,G[le.modelIndex],un.disabled,f.colorModeForRenderPass());else{for(const le of oe)Ud(le,f,l,G[le.modelIndex],un.disabled,En.disabled);for(const le of oe)Ud(le,f,l,G[le.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(const le of se)Ud(le,f,l,G[le.modelIndex],un.disabled,f.colorModeForRenderPass());L()}else{for(const le of oe)Qc(le.mesh,le.nodeModelMatrix,f,l);for(const le of se)Qc(le.mesh,le.nodeModelMatrix,f,l);L()}}},Vf={model:function(f,i,l){const p=i.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(l.modelManager&&l.modelManager.upload(l,p.type==="vector"?f.scope:""));if(p.type==="batched-model"||p.type!=="model")return;const x=p.getModels();for(const w of x)w.upload(l.context)},raster:function(f,i,l){const p=i.getSource();if(!(p instanceof Tc&&p.loaded()))return;const x=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const w=f.paint.get("raster-array-band")||p.getInitialBand(x);if(w==null)return;const E=i.getIds().map(R=>i.getTileByID(R));for(const R of E)R.updateNeeded(x,w)&&p.prepareTile(R,x,w)},"raster-particle":function(f,i,l){const p=i.getSource();if(!(p instanceof Tc&&p.loaded()))return;const x=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const w=f.paint.get("raster-particle-array-band")||p.getInitialBand(x);if(w==null)return;const E=i.getIds().map(R=>i.getTileByID(R));for(const R of E)R.updateNeeded(x,w)&&p.prepareTile(R,x,w)}};class yg{constructor(i,l,p,x){this.context=new pw(i,l),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=x,this._timeStamp=s.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const w=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const R of w)this._debugParams.enabledLayers[R]=!0;x.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),x.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),x.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const R of w)x.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],R);this.occlusionParams=new Bf(x),this.setup(),this.numSublayers=ls.maxUnderzooming+ls.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.dl,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new dx(this),this._wireframeDebugCache=new Qa,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const E=new s.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,E,i.RGBA8),this._clippingActiveLastFrame=!1}updateTerrain(i,l){const p=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new tg(this,i));const x=this._terrain;this.transform.elevation=p?x:null,x.update(i,this.transform,l),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(i){const l=i.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,x]=l.getFovAdjustedRange(this.transform._fov);if(p>x)return void(this.transform.fogCullDistSq=null);const w=p+.78*(x-p);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(i){i&&!this._terrain&&(this._terrain=new tg(this,this.style)),this._forceTerrainMode=i}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,l){if(this.width=i*s.q.devicePixelRatio,this.height=l*s.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const i=this.context,l=new s.a_;l.emplaceBack(0,0),l.emplaceBack(s.ab,0),l.emplaceBack(0,s.ab),l.emplaceBack(s.ab,s.ab),this.tileExtentBuffer=i.createVertexBuffer(l,s.b0.members),this.tileExtentSegments=s.b1.simpleSegment(0,0,4,2);const p=new s.a_;p.emplaceBack(0,0),p.emplaceBack(s.ab,0),p.emplaceBack(0,s.ab),p.emplaceBack(s.ab,s.ab),this.debugBuffer=i.createVertexBuffer(p,s.b0.members),this.debugSegments=s.b1.simpleSegment(0,0,4,5);const x=new s.a_;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(x,s.b0.members),this.viewportSegments=s.b1.simpleSegment(0,0,4,2);const w=new s.aN;w.emplaceBack(0,0,0,0),w.emplaceBack(s.ab,0,s.ab,0),w.emplaceBack(0,s.ab,0,s.ab),w.emplaceBack(s.ab,s.ab,s.ab,s.ab),this.mercatorBoundsBuffer=i.createVertexBuffer(w,s.b3.members),this.mercatorBoundsSegments=s.b1.simpleSegment(0,0,4,2);const E=new s.aO;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(E);const R=new s.a$;for(const z of[0,1,3,2,0])R.emplaceBack(z);this.debugIndexBuffer=i.createIndexBuffer(R),this.emptyTexture=new s.T(i,new s.r({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA8),this.identityMat=s.a6.mat4.create();const L=this.context.gl;this.stencilClearMode=new un({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,qt.disabled,this.stencilClearMode,En.disabled,tn.disabled,Ld(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,l,p){if(!l||this.currentStencilSource===l.id||!i.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let R=!1;for(const L of p)if(this._tileClippingMaskIDs[L.key]===void 0){R=!0;break}if(!R)return}this.currentStencilSource=l.id;const x=this.context,w=x.gl;this.nextStencilID+p.length>256&&this.clearStencil(),x.setColorMode(En.disabled),x.setDepthMode(qt.disabled);const E=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const R of p){const L=l.getTile(R),z=this._tileClippingMaskIDs[R.key]=this.nextStencilID++,{tileBoundsBuffer:B,tileBoundsIndexBuffer:G,tileBoundsSegments:Z}=this.getTileBoundsBuffers(L);E.draw(this,w.TRIANGLES,qt.disabled,new un({func:w.ALWAYS,mask:0},z,255,w.KEEP,w.KEEP,w.REPLACE),En.disabled,tn.disabled,Ld(R.projMatrix),"$clipping",B,G,Z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,l=this.context.gl;return new un({func:l.NOTEQUAL,mask:255},i,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const l=this.context.gl;return new un({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(i){const l=this.context.gl,p=i.sort((E,R)=>R.overscaledZ-E.overscaledZ),x=p[p.length-1].overscaledZ,w=p[0].overscaledZ-x+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const E={};for(let R=0;R<w;R++)E[R+x]=new un({func:l.GEQUAL,mask:255},R+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=w,[E,p]}return[{[x]:un.disabled},p]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new En([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new s.bz(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?En.unblended:En.alphaBlended}colorModeForDrapableLayerRenderPass(i){const l=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new En([l.ONE,l.ONE_MINUS_SRC_ALPHA,l.CONSTANT_ALPHA,l.ONE_MINUS_SRC_ALPHA],new s.bz(0,0,0,i===void 0?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(i,l,p,x=!1){if(this.depthOcclusion)return new qt(this.context.gl.GREATER,qt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return qt.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new qt(p||this.context.gl.LEQUAL,l,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const i=this.context.gl,l=Math.ceil(this.width),p=Math.ceil(this.height),x=this.context.bindFramebuffer.get(),w=i.getParameter(i.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===l&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),l!==0&&p!==0&&(this.depthFBO=new Df(this.context,l,p,!1,"texture"),this.depthTexture=new s.T(this.context,{width:l,height:p,data:null},i.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(x),i.bindTexture(i.TEXTURE_2D,w),this.depthFBO&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),i.blitFramebuffer(0,0,l,p,0,0,l,p,i.DEPTH_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((i,l)=>i+l/this._fpsHistory.length,0))}render(i,l){const p=s.q.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=i.map.repaint,this.style=i,this.options=l;const x=this.style._mergedLayers,w=this.style.order.filter(ke=>{const De=x[ke];return!(De.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[De.type]});let E=!1,R=!1;for(const ke of w){const De=x[ke];De.type==="circle"&&(E=!0),De.type==="symbol"&&(De.hasInitialOcclusionOpacityProperties?R=!0:E=!0)}const L=w.map(ke=>x[ke]),z=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(s.q.now()),this.imageManager.beginFrame();let B=0,G=!1;for(const ke in z){const De=z[ke];De.used&&(De.prepare(this.context),De.getSource().usedInConflation&&++B)}let Z=!1;for(const ke of L)ke.isHidden(this.transform.zoom)||(ke.type==="clip"&&(Z=!0),this.prepareLayer(ke));const Y={},se={},oe={},ae={},le={};for(const ke in z){const De=z[ke];Y[ke]=De.getVisibleCoordinates(),se[ke]=Y[ke].slice().reverse(),oe[ke]=De.getVisibleCoordinates(!0).reverse(),ae[ke]=De.getShadowCasterCoordinates(),le[ke]=De.sortCoordinatesByDistance(Y[ke])}const me=ke=>{const De=this.style.getLayerSourceCache(ke);return De&&De.used?De.getSource():null};if(B||Z||this._clippingActiveLastFrame){const ke=[],De=[];let Ue=0;for(const et of L)this.isSourceForClippingOrConflation(et,me(et))&&(ke.push(et),De.push(Ue)),Ue++;if(ke&&(Z||ke.length>1)||this._clippingActiveLastFrame){Z=!1;const et=[];for(let lt=0;lt<ke.length;lt++){const Qe=ke[lt],gt=De[lt],$e=this.style.getLayerSourceCache(Qe);if(!$e||!$e.used||!$e.getSource().usedInConflation&&Qe.type!=="clip")continue;let ot=s.dn,it=s.bs.None;const _t=[];let vt=!0;if(Qe.type==="clip"){ot=gt;for(const at of Qe.layout.get("clip-layer-types"))it|=at==="model"?s.bs.Model:at==="symbol"?s.bs.Symbol:s.bs.FillExtrusion;for(const at of Qe.layout.get("clip-layer-scope"))_t.push(at);Qe.isHidden(this.transform.zoom)?vt=!1:Z=!0}vt&&et.push({layer:Qe.fqid,cache:$e,order:ot,clipMask:it,clipScope:_t})}this.replacementSource.setSources(et),G=!0}}this._clippingActiveLastFrame=Z,G||this.replacementSource.clear(),this.conflationActive=G,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ke=0;ke<L.length;ke++){const De=L[ke],Ue=De.cutoffRange();if(this.longestCutoffRange=Math.max(Ue,this.longestCutoffRange),Ue>0){const et=me(De);et&&(this.minCutoffZoom=Math.max(et.minzoom,this.minCutoffZoom)),De.minzoom&&(this.minCutoffZoom=Math.max(De.minzoom,this.minCutoffZoom))}De.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ke),this._lastOcclusionLayer=ke)}const ye=this.style&&this.style.fog;ye?(this._fogVisible=ye.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ye.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(oe),this.opaquePassCutoff=0);const fe=this._shadowRenderer;if(fe){fe.updateShadowParameters(this.transform,this.style.directionalLight);for(const ke in z)for(const De of Y[ke]){let Ue={min:0,max:0};this.terrain&&(Ue=this.terrain.getMinMaxForTile(De)||Ue),fe.addShadowReceiver(De.toUnwrapped(),Ue.min,Ue.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.dm(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new jf(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!er.has(this.context.gl))return;this.renderPass="offscreen";for(const ke of L){const De=i.getLayerSourceCache(ke);if(!ke.hasOffscreenPass()||ke.isHidden(this.transform.zoom))continue;const Ue=De?se[De.id]:void 0;(ke.type==="custom"||ke.type==="raster"||ke.type==="raster-particle"||ke.isSky()||Ue&&Ue.length)&&this.renderLayer(this,De,ke,Ue)}this.depthRangeFor3D=[0,1-(L.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ae)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const be=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ve=(()=>{if(l.showOverdrawInspector)return s.bz.black;const ke=this.style.fog;if(ke&&this.transform.projection.supportsFog){const De=this.style.getLut(ke.scope);if(!be){const Ue=ke.properties.get("color").toRenderColor(De).toArray01();return new s.bz(...Ue)}if(be){const Ue=ke.properties.get("space-color").toRenderColor(De).toArray01();return new s.bz(...Ue)}}return s.bz.transparent})();if(this.context.clear({color:ve,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&be&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const ke=L[this.currentLayer],De=i.getLayerSourceCache(ke);if(ke.isSky())continue;const Ue=De?(ke.is3D()?le:se)[De.id]:void 0;this._renderTileClippingMasks(ke,De,Ue),this.renderLayer(this,De,ke,Ue)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&be&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.a9(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const ke=L[this.currentLayer],De=i.getLayerSourceCache(ke);ke.isSky()&&this.renderLayer(this,De,ke,De?se[De.id]:void 0)}function Pe(ke,De){let Ue;return De&&(Ue=(ke.type==="symbol"?oe:ke.is3D()?le:se)[De.id]),Ue}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<w.length;){const ke=L[this.currentLayer];if(ke.type==="raster"||ke.type==="raster-particle"){const De=i.getLayerSourceCache(ke);this.renderLayer(this,De,ke,Pe(ke,De))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Te=0;fe&&(Te=fe.getShadowCastingLayerCount());let Me=!1,Oe=-1;for(let ke=0;ke<w.length;++ke){const De=L[ke];De.isHidden(this.transform.zoom)||De.is3D()&&(Oe=ke)}for(R&&Oe===-1&&(E=!0);this.currentLayer<w.length;){const ke=L[this.currentLayer],De=i.getLayerSourceCache(ke);if(ke.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(ke)){if(ke.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(E&&!Me&&this.terrain&&!this.transform.isOrthographic&&(Me=!0,this.blitDepth()),R&&Oe!==-1&&this.currentLayer===Oe+1&&!this.transform.isOrthographic&&this.blitDepth(),ke.is3D()||this.terrain||this._renderTileClippingMasks(ke,De,De?Y[De.id]:void 0),this.renderLayer(this,De,ke,Pe(ke,De)),!this.terrain&&fe&&Te>0&&ke.hasShadowPass()&&--Te==0&&(fe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Ue=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ue;this.currentLayer++){const et=L[this.currentLayer];if(!et.hasLightBeamPass())continue;const lt=i.getLayerSourceCache(et);this.renderLayer(this,lt,et,lt?se[lt.id]:void 0)}this.currentLayer=Ue,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ue=this.currentLayer;this.depthOcclusion=!0;for(const et of this.layersWithOcclusionOpacity){this.currentLayer=et;const lt=L[this.currentLayer],Qe=i.getLayerSourceCache(lt),gt=Qe?se[Qe.id]:void 0;lt.is3D()||this.terrain||this._renderTileClippingMasks(lt,Qe,Qe?Y[Qe.id]:void 0),this.renderLayer(this,Qe,lt,gt)}this.depthOcclusion=!1,this.currentLayer=Ue,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ke=null;L.forEach(De=>{const Ue=i.getLayerSourceCache(De);Ue&&!De.isHidden(this.transform.zoom)&&Ue.getVisibleCoordinates().length&&(!ke||ke.getSource().maxzoom<Ue.getSource().maxzoom)&&(ke=Ue)}),ke&&this.options.showTileBoundaries&&el.debug(this,ke,ke.getVisibleCoordinates(),s.bz.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&el.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.bz(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ke){const De=ke.transform.padding;Sr(ke,ke.transform.height-(De.top||0),3,yw),Sr(ke,De.bottom||0,3,Yc),We(ke,De.left||0,3,Kc),We(ke,ke.transform.width-(De.right||0),3,bt);const Ue=ke.transform.centerPoint;(function(et,lt,Qe,gt){Vd(et,lt-1,Qe-10,2,20,gt),Vd(et,lt-10,Qe-1,20,2,gt)})(ke,Ue.x,ke.transform.height-Ue.y,Gt)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),G||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);const{unsupportedLayers:l}=this.transform.projection,p=!l||!l.includes(i.type);if(Vf[i.type]&&(p||this.terrain&&i.type==="custom")){const x=this.style.getLayerSourceCache(i);Vf[i.type](i,x,this)}this.gpuTimingEnd()}renderLayer(i,l,p,x){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||x&&x.length)&&(this.id=p.id,this.gpuTimingStart(p),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(p.type)&&(!i.terrain||p.type!=="custom")||p.type==="clip"||el[p.type](i,l,p,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery,p=this.context.gl;let x=this.gpuTimers[i.id];x||(x=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:p.createQuery()}),x.calls++,p.beginQuery(l.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,l=this.context.gl,p=l.createQuery();this.deferredRenderGpuTimeQueries.push(p),l.beginQuery(i.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const l={};for(const p in i){const x=i[p],w=this.context.extTimerQuery,E=w.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(x.query),l[p]=E}return l}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery,p=this.context.gl;let x=0;for(const w of i)x+=l.getQueryParameter(w,p.QUERY_RESULT)/1e6,l.deleteQueryEXT(w);return x}translatePosMatrix(i,l,p,x,w){if(!p[0]&&!p[1])return i;const E=w?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(E){const z=Math.sin(E),B=Math.cos(E);p=[p[0]*B-p[1]*z,p[0]*z+p[1]*B]}const R=[w?p[0]:s.ak(l,p[0],this.transform.zoom),w?p[1]:s.ak(l,p[1],this.transform.zoom),0],L=new Float32Array(16);return s.a6.mat4.translate(L,i,R),L}saveTileTexture(i){const l=i.size[0],p=this._tileTextures[l];p?p.push(i):this._tileTextures[l]=[i]}getTileTexture(i){const l=this._tileTextures[i];return l&&l.length>0?l.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(i,l,p){const x=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,w=[];return this.style&&this.style.enable3dLights()&&(i==="globeRaster"||i==="terrainRaster"?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||w.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||w.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?w.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):w.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&w.push("GLOBE"),!this._fogVisible||x||l!==void 0&&!l||w.push("FOG","FOG_DITHERING"),x&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(i,l){this.cache=this.cache||{};const p=l&&l.defines||[],x=l&&l.config,w=this.currentGlobalDefines(i,l&&l.overrideFog,l&&l.overrideRtt).concat(p),E=Ka.cacheKey(Xa[i],i,w,x);return this.cache[E]||(this.cache[E]=new Ka(this.context,i,Xa[i],x,Ux[i],w)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,l){if(this.style.enable3dLights()){const p=this.style.directionalLight,x=this.style.ambientLight;if(p&&x){const w=((E,R,L)=>{const z=E.properties.get("direction"),B=E.properties.get("color").toRenderColor(L.getLut(E.scope)).toArray01(),G=E.properties.get("intensity"),Z=R.properties.get("color").toRenderColor(L.getLut(R.scope)).toArray01(),Y=R.properties.get("intensity"),se=[z.x,z.y,z.z],oe=s.cH(Z,Y),ae=s.cH(B,G);return{u_lighting_ambient_color:oe,u_lighting_directional_dir:se,u_lighting_directional_color:ae,u_ground_radiance:ng(se,ae,oe)}})(p,x,this.style);l.setLightsUniformValues(i,w)}}}uploadCommonUniforms(i,l,p,x,w){if(this.uploadCommonLightUniforms(i,l),this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const R=E.getOpacity(this.transform.pitch),L=((z,B,G,Z,Y,se,oe,ae,le,me,ye,fe)=>{const be=z.transform,ve=B.properties.get("color").toRenderColor(z.style.getLut(B.scope)).toArray01();ve[3]=Z;const Pe=z.frameCounter/1e3%1,[Te,Me]=B.properties.get("vertical-range");return{u_fog_matrix:G?be.calculateFogTileMatrix(G):fe||z.identityMat,u_fog_range:B.getFovAdjustedRange(be._fov),u_fog_color:ve,u_fog_horizon_blend:B.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Te,Me),Me],u_fog_temporal_offset:Pe,u_frustum_tl:Y,u_frustum_tr:se,u_frustum_br:oe,u_frustum_bl:ae,u_globe_pos:le,u_globe_radius:me,u_viewport:ye,u_globe_transition:s.a9(be.zoom),u_is_globe:+(be.projection.name==="globe")}})(this,E,p,R,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.q.devicePixelRatio,this.transform.height*s.q.devicePixelRatio],x);l.setFogUniformValues(i,L)}w&&l.setCutoffUniformValues(i,w.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,l=i.createTexture();return i.bindTexture(i.TEXTURE_2D,l),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const x of p)l[x.key]=i[x.key]||new Oo(x,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(i,l){return!(!i.is3D()||i.type!=="clip"&&(i.minzoom&&i.minzoom>this.transform.zoom||(this.style._clipLayerPresent||i.sourceLayer!=="building")&&(!l||l.type!=="batched-model")))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let l=this._cachedTileFogOpacities[i.key];return l||(this._cachedTileFogOpacities[i.key]=l=this.style.fog.getOpacityForTile(i)),l[0]>=Rt||l[1]>=Rt}setupDepthForOcclusion(i,l,p){const x=this.context,w=x.gl,E=!!p;var R;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),x.activeTexture.set(w.TEXTURE3),i&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((R=this.depthRangeFor3D)[1]-R[0]),-1-2*R[0]/(R[1]-R[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),x.activeTexture.set(w.TEXTURE0),E||l.setTerrainUniformValues(x,p)}}function ga(f,i){let l=!1,p=null;const x=()=>{p=null,l&&(f(),p=setTimeout(x,i),l=!1)};return()=>(l=!0,p||x(),p)}class tl{constructor(i){this._hashName=i&&encodeURIComponent(i),s.aJ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ga(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const l=ya(i);if(this._hashName){const p=this._hashName;let x=!1;const w=location.hash.slice(1).split("&").map(E=>{const R=E.split("=")[0];return R===p?(x=!0,`${R}=${l}`):E}).filter(E=>E);return x||w.push(`${p}=${l}`),`#${w.join("&")}`}return`#${l}`}_getCurrentHash(){const i=location.hash.replace("#","");if(this._hashName){let l;return i.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(p=>isNaN(p))){const p=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(l[3]||0):i.getBearing();return i.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:p,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function ya(f,i){const l=f.getCenter(),p=Math.round(100*f.getZoom())/100,x=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,x),E=Math.round(l.lng*w)/w,R=Math.round(l.lat*w)/w,L=f.getBearing(),z=f.getPitch();let B=i?`/${E}/${R}/${p}`:`${p}/${R}/${E}`;return(L||z)&&(B+="/"+Math.round(10*L)/10),z&&(B+=`/${Math.round(z)}`),B}const jl={linearity:.3,easing:s.dp(0,0,.3,1)},Uf=s.l({deceleration:2500,maxSpeed:1400},jl),_g=s.l({deceleration:20,maxSpeed:1400},jl),xg=s.l({deceleration:1e3,maxSpeed:360},jl),vg=s.l({deceleration:1e3,maxSpeed:90},jl);class nl{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.q.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,l=s.q.now();for(;i.length>0&&l-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const l={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)l.zoom+=w.zoomDelta||0,l.bearing+=w.bearingDelta||0,l.pitch+=w.pitchDelta||0,w.panDelta&&l.pan._add(w.panDelta),w.around&&(l.around=w.around),w.pinchAround&&(l.pinchAround=w.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(l.pan.mag()){const w=zl(l.pan.mag(),p,s.l({},Uf,i||{}));x.offset=l.pan.mult(w.amount/l.pan.mag()),x.center=this._map.transform.center,eu(x,w)}if(l.zoom){const w=zl(l.zoom,p,_g);x.zoom=this._map.transform.zoom+w.amount,eu(x,w)}if(l.bearing){const w=zl(l.bearing,p,xg);x.bearing=this._map.transform.bearing+s.ap(w.amount,-179,179),eu(x,w)}if(l.pitch){const w=zl(l.pitch,p,vg);x.pitch=this._map.transform.pitch+w.amount,eu(x,w)}if(x.zoom||x.bearing){const w=l.pinchAround===void 0?l.around:l.pinchAround;x.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function eu(f,i){(!f.duration||f.duration<i.duration)&&(f.duration=i.duration,f.easing=i.easing)}function zl(f,i,l){const{maxSpeed:p,linearity:x,deceleration:w}=l,E=s.ap(f*x/(i/1e3),-p,p),R=Math.abs(E)/(w*x);return{easing:l.easing,duration:1e3*R,amount:E*(R/2)}}class Ji extends s.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,p,x={}){const w=ft(l.getCanvasContainer(),p),E=l.unproject(w);super(i,s.l({point:w,lngLat:E,originalEvent:p},x)),this._defaultPrevented=!1,this.target=l}}class tu extends s.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,p){const x=i==="touchend"?p.changedTouches:p.touches,w=ut(l.getCanvasContainer(),x),E=w.map(L=>l.unproject(L)),R=w.reduce((L,z,B,G)=>L.add(z.div(G.length)),new s.P(0,0));super(i,{points:w,point:R,lngLats:E,lngLat:l.unproject(R),originalEvent:p}),this._defaultPrevented=!1}}class Ri extends s.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l){super("wheel",{originalEvent:l}),this._defaultPrevented=!1}}class bg{constructor(i,l){this._map=i,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new Ri(this._map,i))}mousedown(i,l){return this._mousedownPos=l,this._firePreventable(new Ji(i.type,this._map,i))}mouseup(i){this._map.fire(new Ji(i.type,this._map,i))}preclick(i){const l=s.l({},i);l.type="preclick",this._map.fire(new Ji(l.type,this._map,l))}click(i,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(i),this._map.fire(new Ji(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new Ji(i.type,this._map,i))}mouseover(i){this._map.fire(new Ji(i.type,this._map,i))}mouseout(i){this._map.fire(new Ji(i.type,this._map,i))}touchstart(i){return this._firePreventable(new tu(i.type,this._map,i))}touchmove(i){this._map.fire(new tu(i.type,this._map,i))}touchend(i){this._map.fire(new tu(i.type,this._map,i))}touchcancel(i){this._map.fire(new tu(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wg{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new Ji(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ji("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Ji(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class nu{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,l){this.isEnabled()&&i.shiftKey&&i.button===0&&(Ee(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(i,l){if(!this._active)return;const p=l,x=this._startPos,w=this._lastPos;if(!x||!w||w.equals(p)||!this._box&&p.dist(x)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=te("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const E=Math.min(x.x,p.x),R=Math.max(x.x,p.x),L=Math.min(x.y,p.y),z=Math.max(x.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${L}px)`,this._box.style.width=R-E+"px",this._box.style.height=z-L+"px")})}mouseupWindow(i,l){if(!this._active)return;const p=this._startPos,x=l;if(p&&i.button===0){if(this.reset(),Ne(),p.x!==x.x||p.y!==x.y)return this._map.fire(new s.x("boxzoomend",{originalEvent:i})),{cameraAnimation:w=>w.fitScreenCoordinates(p,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),He(),delete this._startPos,delete this._lastPos}_fireEvent(i,l){return this._map.fire(new s.x(i,{originalEvent:l}))}}function _a(f,i){const l={};for(let p=0;p<f.length;p++)l[f[p].identifier]=i[p];return l}class Sg{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),p.length===this.numTouches&&(this.centroid=function(x){const w=new s.P(0,0);for(const E of x)w._add(E);return w.div(x.length)}(l),this.touches=_a(p,l)))}touchmove(i,l,p){if(this.aborted||!this.centroid)return;const x=_a(p,l);for(const w in this.touches){const E=x[w];(!E||E.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(i,l,p){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Wd{constructor(i){this.singleTap=new Sg(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,l,p){this.singleTap.touchstart(i,l,p)}touchmove(i,l,p){this.singleTap.touchmove(i,l,p)}touchend(i,l,p){const x=this.singleTap.touchend(i,l,p);if(x){const w=i.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(x)<30;if(w&&E||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Tg{constructor(){this._zoomIn=new Wd({numTouches:1,numTaps:2}),this._zoomOut=new Wd({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,l,p){this._zoomIn.touchstart(i,l,p),this._zoomOut.touchstart(i,l,p)}touchmove(i,l,p){this._zoomIn.touchmove(i,l,p),this._zoomOut.touchmove(i,l,p)}touchend(i,l,p){const x=this._zoomIn.touchend(i,l,p),w=this._zoomOut.touchend(i,l,p);return x?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(x)},{originalEvent:i})}):w?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(w)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Hd={0:1,2:2};class qd{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,l){return!1}_move(i,l){return{}}mousedown(i,l){if(this._lastPoint)return;const p=mt(i);this._correctButton(i,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(i,l){const p=this._lastPoint;if(p){if(i.preventDefault(),this._eventButton!=null&&function(x,w){const E=Hd[w];return x.buttons===void 0||(x.buttons&E)!==E}(i,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}}mouseupWindow(i){this._lastPoint&&mt(i)===this._eventButton&&(this._moved&&Ne(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $f extends qd{mousedown(i,l){super.mousedown(i,l),this._lastPoint&&(this._active=!0)}_correctButton(i,l){return l===0&&!i.ctrlKey}_move(i,l){return{around:l,panDelta:l.sub(i)}}}class Gf extends qd{_correctButton(i,l){return l===0&&i.ctrlKey||l===2}_move(i,l){const p=.8*(l.x-i.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(i){i.preventDefault()}}class Wf extends qd{_correctButton(i,l){return l===0&&i.ctrlKey||l===2}_move(i,l){const p=-.5*(l.y-i.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(i){i.preventDefault()}}class Yx{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),s.aJ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(i,l,p){return this._calculateTransform(i,l,p)}touchmove(i,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!s.dq())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,l,p)}}touchend(i,l,p){this._calculateTransform(i,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,l,p){p.length>0&&(this._active=!0);const x=_a(p,l),w=new s.P(0,0),E=new s.P(0,0);let R=0;for(const z in x){const B=x[z],G=this._touches[z];G&&(w._add(B),E._add(B.sub(G)),R++,x[z]=B)}if(this._touches=x,R<this._minTouches||!E.mag())return;const L=E.div(R);return this._sum._add(L),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(R),panDelta:L}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=te("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Hf{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,l,p){return{}}touchstart(i,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(i,l,p){const x=this._firstTwoTouches;if(!x)return;i.preventDefault();const[w,E]=x,R=Zd(p,l,w),L=Zd(p,l,E);if(!R||!L)return;const z=this._aroundCenter?null:R.add(L).div(2);return this._move([R,L],z,i)}touchend(i,l,p){if(!this._firstTwoTouches)return;const[x,w]=this._firstTwoTouches,E=Zd(p,l,x),R=Zd(p,l,w);E&&R||(this._active&&Ne(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Zd(f,i,l){for(let p=0;p<f.length;p++)if(f[p].identifier===l)return i[p]}function Eg(f,i){return Math.log(f/i)/Math.LN2}class Kx extends Hf{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,l){const p=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Eg(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Eg(this._distance,p),pinchAround:l}}}function Cg(f,i){return 180*f.angleWith(i)/Math.PI}class Jx extends Hf{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,l){const p=this._vector;if(this._vector=i[0].sub(i[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Cg(this._vector,p),pinchAround:l}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const l=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const x=Cg(i,p);return Math.abs(x)<l}}function qf(f){return Math.abs(f.y)>Math.abs(f.x)}class Qx extends Hf{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,qf(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,l,p){const x=this._lastPoints;if(!x)return;const w=i[0].sub(x[0]),E=i[1].sub(x[1]);return this._map._cooperativeGestures&&!s.dq()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(w,E,p.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(w.y+E.y)/2*-.5})}gestureBeginsVertically(i,l,p){if(this._valid!==void 0)return this._valid;const x=i.mag()>=2,w=l.mag()>=2;if(!x&&!w)return;if(!x||!w)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=i.y>0==l.y>0;return qf(i)&&qf(l)&&E}}const e0={panStep:100,bearingStep:15,pitchStep:10};class t0{constructor(){const i=e0;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let l=0,p=0,x=0,w=0,E=0;switch(i.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:i.shiftKey?p=-1:(i.preventDefault(),w=-1);break;case 39:i.shiftKey?p=1:(i.preventDefault(),w=1);break;case 38:i.shiftKey?x=1:(i.preventDefault(),E=-1);break;case 40:i.shiftKey?x=-1:(i.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,x=0),{cameraAnimation:R=>{const L=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:n0,zoom:l?Math.round(L)+l*(i.shiftKey?2:1):L,bearing:R.getBearing()+p*this._bearingStep,pitch:R.getPitch()+x*this._pitchStep,offset:[-w*this._panStep,-E*this._panStep],center:R.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function n0(f){return f*(2-f)}const Pg=4.000244140625,ww=1/450;class Sw{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._handler=l,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ww,s.aJ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||s.dq()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const p=s.q.now(),x=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,l!==0&&l%Pg==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=l,this._timeout=window.setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(x*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),i.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=i,this._delta-=l,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=ft(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>Pg?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&B!==0&&(B=1/B);const G=l(),Z=Math.pow(2,G),Y=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):Z;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(Y*B))),this._type==="wheel"&&(this._startZoom=G,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:l(),x=this._startZoom,w=this._easing;let E,R=!1;if(this._type==="wheel"&&x&&w){const z=Math.min((s.q.now()-this._lastWheelEventTime)/200,1),B=w(z);E=s.aa(x,p,B),z<1?this._frameId||(this._frameId=!0):R=!0}else E=p,R=!0;this._active=!0,R&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let L=E-l();return L*this._lastDelta<0&&(L=0),{noInertia:!0,needsRenderFrame:!R,zoomDelta:L,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let l=s.dr;if(this._prevEase){const p=this._prevEase,x=(s.q.now()-p.start)/p.duration,w=p.easing(x+.01)-p.easing(x),E=.27/Math.sqrt(w*w+1e-4)*.01,R=Math.sqrt(.0729-E*E);l=s.dp(E,R,.25,1)}return this._prevEase={start:s.q.now(),duration:i,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=te("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Nr{constructor(i,l){this._clickZoom=i,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class r0{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,l){return i.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(i.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tw{constructor(){this._tap=new Wd({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,l,p){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(i,l,p))}touchmove(i,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const x=l[0],w=x.y-this._swipePoint.y;return this._swipePoint=x,i.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(i,l,p)}touchend(i,l,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(i,l,p)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ew{constructor(i,l,p){this._el=i,this._mousePan=l,this._touchPan=p}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Xd{constructor(i,l,p){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class i0{constructor(i,l,p,x){this._el=i,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ru=f=>f.zoom||f.drag||f.pitch||f.rotate;class Zf extends s.x{}class xa{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,l){const p=s.a6.vec3.sub([],l,i);this.radius=s.a6.vec3.length(p[2]<0?s.a6.vec3.div([],p,this.constants):[p[0],p[1],0])}projectRay(i){s.a6.vec3.div(i,i,this.constants),s.a6.vec3.normalize(i,i),s.a6.vec3.mul(i,i,this.constants);const l=s.a6.vec3.scale([],i,this.radius);if(l[2]>0){const p=s.a6.vec3.scale([],[0,0,1],s.a6.vec3.dot(l,[0,0,1])),x=s.a6.vec3.scale([],s.a6.vec3.normalize([],[l[0],l[1],0]),this.radius),w=s.a6.vec3.add([],l,s.a6.vec3.scale([],s.a6.vec3.sub([],s.a6.vec3.add([],x,p),l),2));l[0]=w[0],l[1]=w[1]}return l}}function Fl(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Gi{constructor(i,l){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new nl(i),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new xa,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),s.aJ(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,w,E]of this._listeners){const R=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(w,R,E)}}destroy(){for(const[i,l,p]of this._listeners){const x=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(l,x,p)}}_addDefaultHandlers(i){const l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new bg(l,i));const x=l.boxZoom=new nu(l,i);this._add("boxZoom",x);const w=new Tg,E=new r0;l.doubleClickZoom=new Nr(E,w),this._add("tapZoom",w),this._add("clickZoom",E);const R=new Tw;this._add("tapDragZoom",R);const L=l.touchPitch=new Qx(l);this._add("touchPitch",L);const z=new Gf(i),B=new Wf(i);l.dragRotate=new Xd(i,z,B),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);const G=new $f(i),Z=new Yx(l,i);l.dragPan=new Ew(p,G,Z),this._add("mousePan",G),this._add("touchPan",Z,["touchZoom","touchRotate"]);const Y=new Jx,se=new Kx;l.touchZoomRotate=new i0(p,se,Y,R),this._add("touchRotate",Y,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]),this._add("blockableMapEvent",new wg(l));const oe=l.scrollZoom=new Sw(l,this);this._add("scrollZoom",oe,["mousePan"]);const ae=l.keyboard=new t0;this._add("keyboard",ae);for(const le of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[le]&&l[le].enable(i[le])}_add(i,l,p){this._handlers.push({handlerName:i,handler:l,allowed:p}),this._handlersById[i]=l}stop(i){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ru(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,l,p){for(const x in i)if(x!==p&&(!l||l.indexOf(x)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const l=[];for(const p of i)this._el.contains(p.target)&&l.push(p);return l}handleEvent(i,l){this._updatingCamera=!0;const p=i.type==="renderFrame",x=p?void 0:i,w={needsRenderFrame:!1},E={},R={},L=i.touches?this._getMapTouches(i.touches):void 0,z=L?ut(this._el,L):p?void 0:ft(this._el,i);for(const{handlerName:Z,handler:Y,allowed:se}of this._handlers){if(!Y.isEnabled())continue;let oe;this._blockedByActive(R,se,Z)?Y.reset():Y[l||i.type]&&(oe=Y[l||i.type](i,z,L),this.mergeHandlerResult(w,E,oe,Z,x),oe&&oe.needsRenderFrame&&this._triggerRenderFrame()),(oe||Y.isActive())&&(R[Z]=Y)}const B={};for(const Z in this._previousActiveHandlers)R[Z]||(B[Z]=x);this._previousActiveHandlers=R,(Object.keys(B).length||Fl(w))&&(this._changes.push([w,E,B]),this._triggerRenderFrame()),(Object.keys(R).length||Fl(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=w;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))}mergeHandlerResult(i,l,p,x,w){if(!p)return;s.l(i,p);const E={handlerName:x,originalEvent:p.originalEvent||w};p.zoomDelta!==void 0&&(l.zoom=E),p.panDelta!==void 0&&(l.drag=E),p.pitchDelta!==void 0&&(l.pitch=E),p.bearingDelta!==void 0&&(l.rotate=E)}_applyChanges(){const i={},l={},p={};for(const[x,w,E]of this._changes)x.panDelta&&(i.panDelta=(i.panDelta||new s.P(0,0))._add(x.panDelta)),x.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(i.around=x.around),x.aroundCoord!==void 0&&(i.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(i.pinchAround=x.pinchAround),x.noInertia&&(i.noInertia=x.noInertia),s.l(l,w),s.l(p,E);this._updateMapTransform(i,l,p),this._changes=[]}_updateMapTransform(i,l,p){const x=this._map,w=x.transform,E=me=>[me.x,me.y,me.z];if((me=>{const ye=this._eventsInProgress.drag;return ye&&!this._handlersById[ye.handlerName].isActive()})()&&!Fl(i)){const me=w.zoom;w.cameraElevationReference="sea",this._originalZoom!=null&&w._orthographicProjectionAtLowPitch&&w.projection.name!=="globe"&&w.pitch===0?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),me!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&x._stop(!0),!Fl(i))return void this._fireEvents(l,p,!0);let{panDelta:R,zoomDelta:L,bearingDelta:z,pitchDelta:B,around:G,aroundCoord:Z,pinchAround:Y}=i;w._isCameraConstrained&&(L>0&&(L=0),w._isCameraConstrained=!1),Y!==void 0&&(G=Y),(L||(me=>l[me]&&!this._eventsInProgress[me])("drag"))&&G&&(this._dragOrigin=E(w.pointCoordinate3D(G)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",x._stop(!0),G=G||x.transform.centerPoint,z&&(w.bearing+=z),B&&(w.pitch+=B),w._updateCameraState();const se=[0,0,0];if(R)if(w.projection.name==="mercator"){const me=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(G).dir),ye=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(G.sub(R)).dir);se[0]=ye[0]-me[0],se[1]=ye[1]-me[1]}else{const me=w.pointCoordinate(G);if(w.projection.name==="globe"){R=R.rotate(-w.angle);const ye=w._pixelsPerMercatorPixel/w.worldSize;se[0]=-R.x*s.ds(s.aM(me.y))*ye,se[1]=-R.y*s.ds(w.center.lat)*ye}else{const ye=w.pointCoordinate(G.sub(R));me&&ye&&(se[0]=ye.x-me.x,se[1]=ye.y-me.y)}}const oe=w.zoom,ae=[0,0,0];if(L){const me=E(Z||w.pointCoordinate3D(G)),ye={dir:s.a6.vec3.normalize([],s.a6.vec3.sub([],me,w._camera.position))};if(ye.dir[2]<0){const fe=w.zoomDeltaToMovement(me,L);s.a6.vec3.scale(ae,ye.dir,fe)}}const le=s.a6.vec3.add(se,se,ae);w._translateCameraConstrained(le),L&&Math.abs(w.zoom-oe)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(l,p,!0)}_fireEvents(i,l,p){const x=ru(this._eventsInProgress),w=ru(i),E={};for(const B in i){const{originalEvent:G}=i[B];this._eventsInProgress[B]||(E[`${B}start`]=G),this._eventsInProgress[B]=i[B]}!x&&w&&this._fireEvent("movestart",w.originalEvent);for(const B in E)this._fireEvent(B,E[B]);w&&this._fireEvent("move",w.originalEvent);for(const B in i){const{originalEvent:G}=i[B];this._fireEvent(B,G)}const R={};let L;for(const B in this._eventsInProgress){const{handlerName:G,originalEvent:Z}=this._eventsInProgress[B];this._handlersById[G].isActive()||(delete this._eventsInProgress[B],L=l[G]||Z,R[`${B}end`]=L)}for(const B in R)this._fireEvent(B,R[B]);const z=ru(this._eventsInProgress);if(p&&(x||w)&&!z){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),G=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;B?(G(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:L})):(this._map.fire(new s.x("moveend",{originalEvent:L})),G(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,l){this._map.fire(new s.x(i,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new Zf("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Bo="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Mg extends s.E{constructor(i,l){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,s.aJ(["_renderFrameCallback"],this)}getCenter(){return new s.bK(this.transform.center.lng,this.transform.center.lat)}setCenter(i,l){return this.jumpTo({center:i},l)}panBy(i,l,p){return i=s.P.convert(i).mult(-1),this.panTo(this.transform.center,s.l({offset:i},l),p)}panTo(i,l,p){return this.easeTo(s.l({center:i},l),p)}getZoom(){return this.transform.zoom}setZoom(i,l){return this.jumpTo({zoom:i},l),this}zoomTo(i,l,p){return this.easeTo(s.l({zoom:i},l),p)}zoomIn(i,l){return this.zoomTo(this.getZoom()+1,i,l),this}zoomOut(i,l){return this.zoomTo(this.getZoom()-1,i,l),this}getBearing(){return this.transform.bearing}setBearing(i,l){return this.jumpTo({bearing:i},l),this}getPadding(){return this.transform.padding}setPadding(i,l){return this.jumpTo({padding:i},l),this}rotateTo(i,l,p){return this.easeTo(s.l({bearing:i},l),p)}resetNorth(i,l){return this.rotateTo(0,s.l({duration:1e3},i),l),this}resetNorthPitch(i,l){return this.easeTo(s.l({bearing:0,pitch:0,duration:1e3},i),l),this}snapToNorth(i,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,l):this}getPitch(){return this.transform.pitch}setPitch(i,l){return this.jumpTo({pitch:i},l),this}cameraForBounds(i,l){i=s.as.convert(i);const p=l&&l.bearing||0,x=l&&l.pitch||0,w=i.getNorthWest(),E=i.getSouthEast();return this._cameraForBounds(this.transform,w,E,p,x,l)}_extendPadding(i){const l={top:0,right:0,bottom:0,left:0};return i==null?s.l({},l,this.transform.padding):typeof i=="number"?{top:i,bottom:i,right:i,left:i}:s.l({},l,i)}_extendCameraOptions(i){return(i=s.l({offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=this._extendPadding(i.padding),i}_minimumAABBFrustumDistance(i,l){const p=l.max[0]-l.min[0],x=l.max[1]-l.min[1];return p/x>i.aspect?p/(2*Math.tan(.5*i.fovX)*i.aspect):x/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,l,p,x,w,E){const R=i.clone(),L=this._extendCameraOptions(E);R.bearing=x,R.pitch=w;const z=s.bK.convert(l),B=s.bK.convert(p),G=.5*(z.lat+B.lat),Z=.5*(z.lng+B.lng),Y=s.dt(G,Z),se=s.a6.vec3.normalize([],Y),oe=s.a6.vec3.normalize([],s.a6.vec3.cross([],se,[0,1,0])),ae=s.a6.vec3.cross([],oe,se),le=[oe[0],oe[1],oe[2],0,ae[0],ae[1],ae[2],0,se[0],se[1],se[2],0,0,0,0,1],me=[Y,s.dt(z.lat,z.lng),s.dt(B.lat,z.lng),s.dt(B.lat,B.lng),s.dt(z.lat,B.lng),s.dt(G,z.lng),s.dt(G,B.lng),s.dt(z.lat,Z),s.dt(B.lat,Z)];let ye=s.c9.fromPoints(me.map(it=>[s.a6.vec3.dot(oe,it),s.a6.vec3.dot(ae,it),s.a6.vec3.dot(se,it)]));const fe=s.a6.vec3.transformMat4([],ye.center,le);s.a6.vec3.squaredLength(fe)===0&&s.a6.vec3.set(fe,0,0,1),s.a6.vec3.normalize(fe,fe),s.a6.vec3.scale(fe,fe,s.aq),R.center=s.du(fe);const be=R.getWorldToCameraMatrix(),ve=s.a6.mat4.invert(new Float64Array(16),be);ye=s.c9.applyTransform(ye,s.a6.mat4.multiply([],be,le));const Pe=this._extendAABB(ye,R,L,x);if(!Pe)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ye=Pe,s.a6.vec3.transformMat4(fe,fe,be);const Te=.5*(ye.max[2]-ye.min[2]),Me=this._minimumAABBFrustumDistance(R,ye),Oe=s.a6.vec3.scale([],[0,0,1],Te),ke=s.a6.vec3.add(Oe,fe,Oe),De=Me+(R.pitch===0?0:s.a6.vec3.distance(fe,ke)),Ue=R.globeCenterInViewSpace,et=s.a6.vec3.sub([],fe,[Ue[0],Ue[1],Ue[2]]);s.a6.vec3.normalize(et,et),s.a6.vec3.scale(et,et,De);const lt=s.a6.vec3.add([],fe,et);s.a6.vec3.transformMat4(lt,lt,ve);const Qe=s.dw/s.aq,gt=s.a6.vec3.length(lt),$e=s.bD(Math.max(gt*Qe-s.dw,Number.EPSILON),0),ot=Math.min(R.zoomFromMercatorZAdjusted($e),L.maxZoom);return ot>.5*(s.c2+s.bU)?(R.setProjection({name:"mercator"}),R.zoom=ot,this._cameraForBounds(R,l,p,x,w,E)):{center:R.center,zoom:ot,bearing:x,pitch:w}}_extendAABB(i,l,p,x){const w=.5*((p.padding.left||0)+(p.padding.right||0)),E=.5*((p.padding.top||0)+(p.padding.bottom||0)),R=E,L=w,z=w,B=E,G=l.width-(L+z),Z=l.height-(R+B),Y=s.a6.vec3.sub([],i.max,i.min),se=Math.min(G/Y[0],Z/Y[1]),oe=Math.min(l.scaleZoom(l.scale*se),p.maxZoom);if(isNaN(oe))return null;const ae=l.scale/l.zoomScale(oe),le=new s.c9([i.min[0]-L*ae,i.min[1]-B*ae,i.min[2]],[i.max[0]+z*ae,i.max[1]+R*ae,i.max[2]]),me=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new s.P(p.offset.x,p.offset.y):s.P.convert(p.offset)).rotate(-s.bB(x));return le.center[0]-=me.x*ae,le.center[1]+=me.y*ae,le}queryTerrainElevation(i,l){const p=this.transform.elevation;return p?(l=s.l({},{exaggerated:!0},l),p.getAtPoint(s.a5.fromLngLat(i),null,l.exaggerated)):null}_cameraForBounds(i,l,p,x,w,E){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,l,p,x,w,E);const R=i.clone(),L=this._extendCameraOptions(E);R.bearing=x,R.pitch=w;const z=s.bK.convert(l),B=s.bK.convert(p),G=new s.bK(z.lng,B.lat),Z=new s.bK(B.lng,z.lat),Y=R.project(z),se=R.project(B),oe=this.queryTerrainElevation(z),ae=this.queryTerrainElevation(B),le=this.queryTerrainElevation(G),me=this.queryTerrainElevation(Z),ye=[[Y.x,Y.y,Math.min(oe||0,ae||0,le||0,me||0)],[se.x,se.y,Math.max(oe||0,ae||0,le||0,me||0)]];let fe=s.c9.fromPoints(ye);const be=R.getWorldToCameraMatrix(),ve=s.a6.mat4.invert(new Float64Array(16),be);fe=s.c9.applyTransform(fe,be);const Pe=this._extendAABB(fe,R,L,x);if(!Pe)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");fe=Pe;const Te=.5*s.a6.vec3.sub([],fe.max,fe.min)[2],Me=this._minimumAABBFrustumDistance(R,fe),Oe=[0,0,1,0];s.a6.vec4.transformMat4(Oe,Oe,be),s.a6.vec4.normalize(Oe,Oe);const ke=s.a6.vec3.scale([],Oe,Me+Te),De=s.a6.vec3.add([],fe.center,ke);s.a6.vec3.transformMat4(fe.center,fe.center,ve),s.a6.vec3.transformMat4(De,De,ve);const Ue=R.unproject(new s.P(fe.center[0],fe.center[1])),et=s.dv(R.projection,Ue),lt=Math.pow(2,et),Qe=Math.min(R._zoomFromMercatorZ(De[2]*R.pixelsPerMeter*lt/R.worldSize),L.maxZoom);return R.mercatorFromTransition&&Qe<.5*(s.c2+s.bU)?(R.setProjection({name:"globe"}),R.zoom=Qe,this._cameraForBounds(R,l,p,x,w,E)):{center:Ue,zoom:Qe,bearing:x,pitch:w}}fitBounds(i,l,p){const x=this.cameraForBounds(i,l);return this._fitInternal(x,l,p)}fitScreenCoordinates(i,l,p,x,w){const E=s.P.convert(i),R=s.P.convert(l),L=new s.P(Math.min(E.x,R.x),Math.min(E.y,R.y)),z=new s.P(Math.max(E.x,R.x),Math.max(E.y,R.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,R))return this;const B=this.transform.pointLocation3D(L),G=this.transform.pointLocation3D(z),Z=this.transform.pointLocation3D(new s.P(L.x,z.y)),Y=this.transform.pointLocation3D(new s.P(z.x,L.y)),se=[Math.min(B.lng,G.lng,Z.lng,Y.lng),Math.min(B.lat,G.lat,Z.lat,Y.lat)],oe=[Math.max(B.lng,G.lng,Z.lng,Y.lng),Math.max(B.lat,G.lat,Z.lat,Y.lat)],ae=x&&x.pitch?x.pitch:this.getPitch(),le=this._cameraForBounds(this.transform,se,oe,p,ae,x);return this._fitInternal(le,x,w)}_fitInternal(i,l,p){return i?(l=s.l(i,l)).linear?this.easeTo(l,p):this.flyTo(l,p):this}jumpTo(i,l){this.stop();const p=i.preloadOnly?this.transform.clone():this.transform;let x=!1,w=!1,E=!1;"zoom"in i&&p.zoom!==+i.zoom&&(x=!0,p.zoom=+i.zoom),i.center!==void 0&&(p.center=s.bK.convert(i.center)),"bearing"in i&&p.bearing!==+i.bearing&&(w=!0,p.bearing=+i.bearing),"pitch"in i&&p.pitch!==+i.pitch&&(E=!0,p.pitch=+i.pitch);const R=typeof i.padding=="number"?this._extendPadding(i.padding):i.padding;if(i.padding!=null&&!p.isPaddingEqual(R))if(i.retainPadding===!1){const L=p.clone();L.padding=R,p.setLocationAtPoint(p.center,L.centerPoint)}else p.padding=R;return i.preloadOnly?(this._preloadTiles(p),this):(this.fire(new s.x("movestart",l)).fire(new s.x("move",l)),x&&this.fire(new s.x("zoomstart",l)).fire(new s.x("zoom",l)).fire(new s.x("zoomend",l)),w&&this.fire(new s.x("rotatestart",l)).fire(new s.x("rotate",l)).fire(new s.x("rotateend",l)),E&&this.fire(new s.x("pitchstart",l)).fire(new s.x("pitch",l)).fire(new s.x("pitchend",l)),this.fire(new s.x("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(Bo),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,l){const p=this.transform;if(!p.projection.supportsFreeCamera)return s.w(Bo),this;this.stop();const x=p.zoom,w=p.pitch,E=p.bearing;p.setFreeCameraOptions(i);const R=x!==p.zoom,L=w!==p.pitch,z=E!==p.bearing;return this.fire(new s.x("movestart",l)).fire(new s.x("move",l)),R&&this.fire(new s.x("zoomstart",l)).fire(new s.x("zoom",l)).fire(new s.x("zoomend",l)),z&&this.fire(new s.x("rotatestart",l)).fire(new s.x("rotate",l)).fire(new s.x("rotateend",l)),L&&this.fire(new s.x("pitchstart",l)).fire(new s.x("pitch",l)).fire(new s.x("pitchend",l)),this.fire(new s.x("moveend",l)),this}easeTo(i,l){this._stop(!1,i.easeId),((i=s.l({offset:[0,0],duration:500,easing:s.dr},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const p=this.transform,x=this.getZoom(),w=this.getBearing(),E=this.getPitch(),R=this.getPadding(),L="zoom"in i?+i.zoom:x,z="bearing"in i?this._normalizeBearing(i.bearing,w):w,B="pitch"in i?+i.pitch:E,G=this._extendPadding(i.padding),Z=s.P.convert(i.offset);let Y,se,oe;if(p.projection.name==="globe"){const Oe=s.a5.fromLngLat(p.center),ke=Z.rotate(-p.angle);Oe.x+=ke.x/p.worldSize,Oe.y+=ke.y/p.worldSize;const De=Oe.toLngLat(),Ue=s.bK.convert(i.center||De);this._normalizeCenter(Ue),Y=p.centerPoint.add(ke),se=new s.P(Oe.x,Oe.y).mult(p.worldSize),oe=new s.P(s.am(Ue.lng),s.at(Ue.lat)).mult(p.worldSize).sub(se)}else{Y=p.centerPoint.add(Z);const Oe=p.pointLocation(Y),ke=s.bK.convert(i.center||Oe);this._normalizeCenter(ke),se=p.project(Oe),oe=p.project(ke).sub(se)}const ae=p.zoomScale(L-x);let le,me;i.around&&(le=s.bK.convert(i.around),me=p.locationPoint(le));const ye=this._zooming||L!==x,fe=this._rotating||w!==z,be=this._pitching||B!==E,ve=!p.isPaddingEqual(G),Pe=i.retainPadding===!1?p.clone():p,Te=Oe=>ke=>{if(ye&&(Oe.zoom=s.aa(x,L,ke)),fe&&(Oe.bearing=s.aa(w,z,ke)),be&&(Oe.pitch=s.aa(E,B,ke)),ve&&(Pe.interpolatePadding(R,G,ke),Y=Pe.centerPoint.add(Z)),le)Oe.setLocationAtPoint(le,me);else{const De=Oe.zoomScale(Oe.zoom-x),Ue=L>x?Math.min(2,ae):Math.max(.5,ae),et=Math.pow(Ue,1-ke),lt=Oe.unproject(se.add(oe.mult(ke*et)).mult(De));Oe.setLocationAtPoint(Oe.renderWorldCopies?lt.wrap():lt,Y)}return i.preloadOnly||this._fireMoveEvents(l),Oe};if(i.preloadOnly){const Oe=this._emulate(Te,i.duration,p);return this._preloadTiles(Oe),this}const Me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ye,this._rotating=fe,this._pitching=be,this._padding=ve,this._easeId=i.easeId,this._prepareEase(l,i.noMoveStart,Me),this._ease(Te(p),Oe=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(l,Oe)},i),this}_prepareEase(i,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),l||p.moving||this.fire(new s.x("movestart",i)),this._zooming&&!p.zooming&&this.fire(new s.x("zoomstart",i)),this._rotating&&!p.rotating&&this.fire(new s.x("rotatestart",i)),this._pitching&&!p.pitching&&this.fire(new s.x("pitchstart",i))}_fireMoveEvents(i){this.fire(new s.x("move",i)),this._zooming&&this.fire(new s.x("zoom",i)),this._rotating&&this.fire(new s.x("rotate",i)),this._pitching&&this.fire(new s.x("pitch",i))}_afterEase(i,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,x=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new s.x("zoomend",i)),x&&this.fire(new s.x("rotateend",i)),w&&this.fire(new s.x("pitchend",i)),this.fire(new s.x("moveend",i))}flyTo(i,l){if(this._prefersReducedMotion(i)){const it=s.ar(i,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(it,l)}this.stop(),i=s.l({offset:[0,0],speed:1.2,curve:1.42,easing:s.dr},i);const p=this.transform,x=this.getZoom(),w=this.getBearing(),E=this.getPitch(),R=this.getPadding(),L="zoom"in i?s.ap(+i.zoom,p.minZoom,p.maxZoom):x,z="bearing"in i?this._normalizeBearing(i.bearing,w):w,B="pitch"in i?+i.pitch:E,G=this._extendPadding(i.padding),Z=p.zoomScale(L-x),Y=s.P.convert(i.offset);let se=p.centerPoint.add(Y);const oe=p.pointLocation(se),ae=s.bK.convert(i.center||oe);this._normalizeCenter(ae);const le=p.project(oe),me=p.project(ae).sub(le);let ye=i.curve;const fe=Math.max(p.width,p.height),be=fe/Z,ve=me.mag();if("minZoom"in i){const it=s.ap(Math.min(i.minZoom,x,L),p.minZoom,p.maxZoom),_t=fe/p.zoomScale(it-x);ye=Math.sqrt(_t/ve*2)}const Pe=ye*ye;function Te(it){const _t=(be*be-fe*fe+(it?-1:1)*Pe*Pe*ve*ve)/(2*(it?be:fe)*Pe*ve);return Math.log(Math.sqrt(_t*_t+1)-_t)}function Me(it){return(Math.exp(it)-Math.exp(-it))/2}function Oe(it){return(Math.exp(it)+Math.exp(-it))/2}const ke=Te(0);let De=function(it){return Oe(ke)/Oe(ke+ye*it)},Ue=function(it){return fe*((Oe(ke)*(Me(_t=ke+ye*it)/Oe(_t))-Me(ke))/Pe)/ve;var _t},et=(Te(1)-ke)/ye;if(Math.abs(ve)<1e-6||!isFinite(et)){if(Math.abs(fe-be)<1e-6)return this.easeTo(i,l);const it=be<fe?-1:1;et=Math.abs(Math.log(be/fe))/ye,Ue=function(){return 0},De=function(_t){return Math.exp(it*ye*_t)}}i.duration="duration"in i?+i.duration:1e3*et/("screenSpeed"in i?+i.screenSpeed/ye:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const lt=w!==z,Qe=B!==E,gt=!p.isPaddingEqual(G),$e=i.retainPadding===!1?p.clone():p,ot=it=>_t=>{const vt=_t*et,at=1/De(vt);it.zoom=_t===1?L:x+it.scaleZoom(at),lt&&(it.bearing=s.aa(w,z,_t)),Qe&&(it.pitch=s.aa(E,B,_t)),gt&&($e.interpolatePadding(R,G,_t),se=$e.centerPoint.add(Y));const dt=_t===1?ae:it.unproject(le.add(me.mult(Ue(vt))).mult(at));return it.setLocationAtPoint(it.renderWorldCopies?dt.wrap():dt,se),it._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(l),it};if(i.preloadOnly){const it=this._emulate(ot,i.duration,p);return this._preloadTiles(it),this}return this._zooming=!0,this._rotating=lt,this._pitching=Qe,this._padding=gt,this._prepareEase(l,!1),this._ease(ot(p),()=>this._afterEase(l),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(i){}_cancelRenderFrame(i){}_stop(i,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,l)}if(!i){const p=this.handlers;p&&p.stop(!1)}return this}_ease(i,l,p){p.animate===!1||p.duration===0?(i(1),l()):(this._easeStart=s.q.now(),this._easeOptions=p,this._onEaseFrame=i,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((s.q.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,l){i=s.bA(i,-180,180);const p=Math.abs(i-l);return Math.abs(i-360-l)<p&&(i-=360),Math.abs(i+360-l)<p&&(i+=360),i}_normalizeCenter(i){const l=this.transform;if(l.maxBounds||l.projection.name!=="globe"&&!l.renderWorldCopies)return;const p=i.lng-l.center.lng;i.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&s.q.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,l,p){const x=Math.ceil(15*l/1e3),w=[],E=i(p.clone());for(let R=0;R<=x;R++){const L=E(R/x);w.push(L.clone())}return w}_preloadTiles(i,l){}}class Xf{constructor(i={}){this.options=i,s.aJ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const l=this.options&&this.options.compact,p=i._getUIString("AttributionControl.ToggleAttribution");this._map=i,this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=te("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const x=te("span","mapboxgl-ctrl-icon",this._compactButton);return x.setAttribute("aria-hidden","true"),x.setAttribute("title",p),this._innerContainer=te("div","mapboxgl-ctrl-attrib-inner",this._container),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(i){const p=l.reduce((x,w,E)=>(w.value&&(x+=`${w.key}=${w.value}${E<l.length-1?"&":""}`),x),"?");i.href=`${s.e.FEEDBACK_URL}/${p}#${ya(this._map,!0)}`,i.rel="noopener nofollow"}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const l=this._map.style._mergedSourceCaches;for(const x in l){const w=l[x];if(w.used){const E=w.getSource();E.attribution&&i.indexOf(E.attribution)<0&&i.push(E.attribution)}}i.sort((x,w)=>x.length-w.length),i=i.filter((x,w)=>{for(let E=w+1;E<i.length;E++)if(i[E].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const p=i.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,i.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ag{constructor(){s.aJ(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=te("div","mapboxgl-ctrl");const l=te("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const l in i){const p=i[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const l=i[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class s0{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const l=++this._id;return this._queue.push({callback:i,id:l,cancelled:!1}),l}remove(i){const l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(const x of p)if(x.id===i)return void(x.cancelled=!0)}run(i=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const p of l)if(!p.cancelled&&(p.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Yd{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const l=s.cw((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,l,p){this._start=this.getValue(l),this._end=i,this._startTime=l,this._endTime=l+p}}const Cw={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Pw{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Ig{constructor(i){this.map=i,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this)}add(i,l){if(this.typeById.has(i))throw new Error(`Interaction id "${i}" already exists.`);const{type:p,filter:x}=l;if(x){const E=s.M(x,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(E.result==="error")throw new Error(E.value.map(R=>`${R.key}: ${R.message}`).join(", "));this.filters.set(i,E.value)}const w=this.interactionsByType.get(p)||new Map;w.size===0&&(this.map.on(p,this.handleType),this.interactionsByType.set(p,w)),w.set(i,l),this.typeById.set(i,p)}remove(i){const l=this.typeById.get(i);if(!l)return;this.typeById.delete(i),this.filters.delete(i);const p=this.interactionsByType.get(l);p&&(p.delete(i),p.size===0&&this.map.off(l,this.handleType))}handleType(i){const l=i.features||this.map.queryRenderedFeatures(i.point);if(!l)return;const p=this.interactionsByType.get(i.type),x={zoom:0};for(const[w,E]of p){const R=this.filters.get(w),{handler:L,layers:z}=E;for(const B of l)if((!z||z.includes(B.layer.id))&&(!R||R.evaluate(x,B))&&L({id:w,feature:B,interaction:E})!==!1)break}}}const Dg={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},Kd={showCompass:!0,showZoom:!0,visualizePitch:!1};class iu{constructor(i,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new Gf({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,p&&(this.mousePitch=new Wf({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),s.aJ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(i,l){this.mouseRotate.mousedown(i,l),this.mousePitch&&this.mousePitch.mousedown(i,l),Ee()}move(i,l){const p=this.map,x=this.mouseRotate.mousemoveWindow(i,l),w=x&&x.bearingDelta;if(w&&p.setBearing(p.getBearing()+w),this.mousePitch){const E=this.mousePitch.mousemoveWindow(i,l),R=E&&E.pitchDelta;R&&p.setPitch(p.getPitch()+R)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){He(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(s.l({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),ft(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,ft(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ut(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=ut(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Vo(f,i,l){if(f=new s.bK(f.lng,f.lat),i){const p=new s.bK(f.lng-360,f.lat),x=new s.bK(f.lng+360,f.lat),w=360*Math.ceil(Math.abs(f.lng-l.center.lng)/360),E=l.locationPoint(f).distSqr(i),R=i.x<0||i.y<0||i.x>l.width||i.y>l.height;l.locationPoint(p).distSqr(i)<E&&(R||Math.abs(p.lng-l.center.lng)<w)?f=p:l.locationPoint(x).distSqr(i)<E&&(R||Math.abs(x.lng-l.center.lng)<w)&&(f=x)}for(;Math.abs(f.lng-l.center.lng)>180;){const p=l.locationPoint(f);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;f.lng>l.center.lng?f.lng-=360:f.lng+=360}return f}const Is={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Uo extends s.E{constructor(i,l){if(super(),(i instanceof HTMLElement||l)&&(i=s.l({element:i},l)),s.aJ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=s.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=te("div");const w=41,E=27,R=Q("svg",{display:"block",height:w*this._scale+"px",width:E*this._scale+"px",viewBox:`0 0 ${E} ${w}`},this._element),L=Q("radialGradient",{id:"shadowGradient"},Q("defs",{},R));Q("stop",{offset:"10%","stop-opacity":.4},L),Q("stop",{offset:"100%","stop-opacity":.05},L),Q("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},R),Q("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},R),Q("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},R),Q("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},R),this._offset=s.P.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const p=this._element.classList;for(const w in Is)p.remove(`mapboxgl-marker-anchor-${w}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`);const x=i&&i.className?i.className.trim().split(/\s+/):[];p.add(...x),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=s.bK.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const l=i.code,p=i.charCode||i.keyCode;l!=="Space"&&l!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(i){const l=i.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,l=this._pos;if(!i||!l)return!1;const p=i.unproject(l),x=i.getFreeCameraOptions();if(!x.position)return!1;const w=x.position.toLngLat();return w.distanceTo(p)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const l=this._pos;if(!l||l.x<0||l.x>i.transform.width||l.y<0||l.y>i.transform.height)return void this._clearFadeTimer();const p=i.unproject(l);let x;i._showingGlobe()&&s.dz(i.transform,this._lngLat)?x=0:(x=1-i._queryFogOpacity(p),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${Is[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const i=this._pos,l=this._map,p=this.getPitchAlignment();if(!l||!i||p!=="map")return"";if(!l._showingGlobe()){const L=l.getPitch();return L?`rotateX(${L}deg)`:""}const x=s.c0(s.dA(l.transform,this._lngLat)),w=i.sub(s.dB(l.transform)),E=Math.abs(w.x)+Math.abs(w.y);if(E===0)return"";const R=x/E;return`rotateX(${-w.y*R}deg) rotateY(${w.x*R}deg)`}_calculateZTransform(){const i=this._pos,l=this._map;if(!l||!i)return"";let p=0;const x=this.getRotationAlignment();if(x==="map")if(l._showingGlobe()){const w=l.project(new s.bK(this._lngLat.lng,this._lngLat.lat+.001)),E=l.project(new s.bK(this._lngLat.lng,this._lngLat.lat-.001)).sub(w);p=s.c0(Math.atan2(E.y,E.x))-90}else p=-l.getBearing();else if(x==="horizon"){const w=s.a7(4,6,l.getZoom()),E=s.dB(l.transform);E.y+=w*l.transform.height;const R=i.sub(E),L=s.c0(Math.atan2(R.y,R.x));p=(L>90?L-270:L+90)*(1-w)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=Vo(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),i===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=s.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){const l=this._map;if(!l)return;const p=this._pointerdownPos,x=this._positionDelta;if(p&&x){if(!this._isDragging){const w=this._clickTolerance||l._clickTolerance;if(i.point.dist(p)<w)return;this._isDragging=!0}this._pos=i.point.sub(x),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.x("dragstart"))),this.fire(new s.x("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.x("dragend")),this._state="inactive"}_addDragHandler(i){const l=this._map,p=this._pos;l&&p&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(p),this._pointerdownPos=i.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const l=this._map;return l&&(i?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Bl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},rl={maxWidth:100,unit:"metric"},Mw={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Aw={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Iw=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function o0(f=new s.P(0,0),i="bottom"){if(typeof f=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(i){case"top":return new s.P(0,f);case"top-left":return new s.P(l,l);case"top-right":return new s.P(-l,l);case"bottom":return new s.P(0,-f);case"bottom-left":return new s.P(l,-l);case"bottom-right":return new s.P(-l,-l);case"left":return new s.P(f,0);case"right":return new s.P(-f,0)}return new s.P(0,0)}return f instanceof s.P||Array.isArray(f)?s.P.convert(f):s.P.convert(f[i]||[0,0])}return{version:k,supported:U.supported,setRTLTextPlugin:s.dC,getRTLTextPluginStatus:s.dD,Map:class extends Mg{constructor(f){F.mark(O.create);const i=f;if((f=s.l({},Dg,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&s.dx(window)&&(f.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new lf(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new s0,this._domRenderTaskQueue=new s0,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.aP(),this._locale=s.l({},Cw,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Yd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new dn(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?{...f.contextCreateOptions}:{},typeof f.container=="string"){const l=document.getElementById(f.container);if(!l)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=l}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),s.aJ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Pw),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Gi(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||s.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new tl(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){i.center==null&&i.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const l=f.bounds;l&&(this.resize(),this.fitBounds(l,s.l({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new Xf({customAttribution:f.customAttribution})),this._logoControl=new Ag,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new s.x(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new s.x(`${l.dataType}dataloading`,l))}),this._interactions=new Ig(this)}_getMapId(){return this._mapId}addControl(f,i){if(i===void 0&&(i=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new s.t(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[i];return i.indexOf("bottom")!==-1?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new s.t(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(f);return i>-1&&this._controls.splice(i,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new s.x("movestart",f)).fire(new s.x("move",f)),this.fire(new s.x("resize",f)),i&&this.fire(new s.x("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(s.as.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new s.x("zoomstart")).fire(new s.x("zoom")).fire(new s.x("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new s.x("zoomstart")).fire(new s.x("zoom")).fire(new s.x("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new s.x("pitchstart")).fire(new s.x("pitch")).fire(new s.x("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new s.x("pitchstart")).fire(new s.x("pitch")).fire(new s.x("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(i=>i==="auto"?navigator.language:i):f}setLanguage(f){const i=this._parseLanguage(f);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,i=f.projection.name;let l;i==="globe"&&f.zoom>=s.bU?(f.setMercatorFromTransition(),l=!0):i==="mercator"&&f.zoom<s.bU&&(f.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,i){return this._updateProjection(f||i||{name:"mercator"})}_updateProjection(f){let i;return i=f.name==="globe"&&this.transform.zoom>=s.bU?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f){return this.transform.locationPoint3D(s.bK.convert(f))}unproject(f){return this.transform.pointLocation3D(s.P.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,i,l){if(f==="mouseenter"||f==="mouseover"){let p=!1;const x=E=>{const R=i.filter(z=>this.getLayer(z)),L=R.length?this.queryRenderedFeatures(E.point,{layers:R}):[];L.length?p||(p=!0,l.call(this,new Ji(f,this,E.originalEvent,{features:L}))):p=!1},w=()=>{p=!1};return{layers:new Set(i),listener:l,delegates:{mousemove:x,mouseout:w}}}if(f==="mouseleave"||f==="mouseout"){let p=!1;const x=E=>{const R=i.filter(L=>this.getLayer(L));(R.length?this.queryRenderedFeatures(E.point,{layers:R}):[]).length?p=!0:p&&(p=!1,l.call(this,new Ji(f,this,E.originalEvent)))},w=E=>{p&&(p=!1,l.call(this,new Ji(f,this,E.originalEvent)))};return{layers:new Set(i),listener:l,delegates:{mousemove:x,mouseout:w}}}{const p=x=>{const w=i.filter(R=>this.getLayer(R)),E=w.length?this.queryRenderedFeatures(x.point,{layers:w}):[];E.length&&(x.features=E,l.call(this,x),delete x.features)};return{layers:new Set(i),listener:l,delegates:{[f]:p}}}}on(f,i,l){if(typeof i=="function"||l===void 0)return super.on(f,i);if(Array.isArray(i)||(i=[i]),i){for(const x of i)if(!this._isValidId(x))return this}const p=this._createDelegatedListener(f,i,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const x in p.delegates)this.on(x,p.delegates[x]);return this}once(f,i,l){if(typeof i=="function"||l===void 0)return super.once(f,i);if(Array.isArray(i)||(i=[i]),i){for(const x of i)if(!this._isValidId(x))return this}const p=this._createDelegatedListener(f,i,l);for(const x in p.delegates)this.once(x,p.delegates[x]);return this}off(f,i,l){if(typeof i=="function"||l===void 0)return super.off(f,i);const p=new Set(Array.isArray(i)?i:[i]);for(const E of p)if(!this._isValidId(E))return this;const x=(E,R)=>{if(E.size!==R.size)return!1;for(const L of E)if(!R.has(L))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[f]:void 0;return w&&(E=>{for(let R=0;R<E.length;R++){const L=E[R];if(L.listener===l&&x(L.layers,p)){for(const z in L.delegates)this.off(z,L.delegates[z]);return E.splice(R,1),this}}})(w),this}queryRenderedFeatures(f,i){if(!this.style)return[];if(i!==void 0||f===void 0||f instanceof s.P||Array.isArray(f)||(i=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],(i=i||{}).layers&&Array.isArray(i.layers)){for(const l of i.layers)if(!this._isValidId(l))return[]}return this.style.queryRenderedFeatures(f,i,this.transform)}querySourceFeatures(f,i){return this._isValidId(f)?this.style.querySourceFeatures(f,i):[]}isPointOnSurface(f){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&s.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(f))}addInteraction(f,i){return this._interactions.add(f,i),this}removeInteraction(f){return this._interactions.remove(f),this}setStyle(f,i){return i=s.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&f&&i.diff!==!1&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(f,(l,p)=>{l?(s.w(`Unable to perform style diff: ${String(l.message||l.error||l)}. Rebuilding the style from scratch.`),this._updateStyle(f,i)):p&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(f,i))}_getUIString(f){const i=this._locale[f];if(i==null)throw new Error(`Missing UI string '${f}'`);return i}_updateStyle(f,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const l=s.l({},i);i&&i.config&&(l.initialConfig=i.config,delete l.config),this.style=new Ms(this,l).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ms(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new s.t(new Error("IDs can't be empty."))),!1):!s.cn(f)||(this.fire(new s.t(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}addSource(f,i){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,i),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,i,l){this._lazyInitEmptyStyle(),this.style.addSourceType(f,i,l)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,i,{pixelRatio:l=1,sdf:p=!1,stretchX:x,stretchY:w,content:E}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:R,height:L,data:z}=s.q.getImageData(i);this.style.addImage(f,{data:new s.r({width:R,height:L},z),pixelRatio:l,stretchX:x,stretchY:w,content:E,sdf:p,version:0})}else if(i.width===void 0||i.height===void 0)this.fire(new s.t(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:R,height:L}=i,z=i;this.style.addImage(f,{data:new s.r({width:R,height:L},new Uint8Array(z.data)),pixelRatio:l,stretchX:x,stretchY:w,content:E,sdf:p,version:0,userImage:z}),z.onAdd&&z.onAdd(this,f)}}updateImage(f,i){this._lazyInitEmptyStyle();const l=this.style.getImage(f);if(!l)return void this.fire(new s.t(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?s.q.getImageData(i):i,{width:x,height:w,data:E}=p;if(x===void 0||w===void 0)return void this.fire(new s.t(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==l.data.width||w!==l.data.height)return void this.fire(new s.t(new Error(`The width and height of the updated image (${x}, ${w})
                must be that same as the previous version of the image
                (${l.data.width}, ${l.data.height})`)));const R=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);l.data.replace(E,R),this.style.updateImage(f,l)}hasImage(f){return f?!!this.style&&!!this.style.getImage(f):(this.fire(new s.t(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,i){s.o(this._requestManager.transformRequest(f,s.R.Image),(l,p)=>{i(l,p instanceof HTMLImageElement?s.q.getImageData(p):p)})}listImages(){return this.style.listImages()}addModel(f,i){this._lazyInitEmptyStyle(),this.style.addModel(f,i)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new s.t(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,i){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,i),this._update(!0)):this}getSlot(f){const i=this.getLayer(f);return i&&i.slot||null}setSlot(f,i){return this.style.setSlot(f,i),this.style.mergeLayers(),this._update(!0)}addImport(f,i){return this.style.addImport(f,i),this}updateImport(f,i){return typeof i!="string"&&i.id!==f?(this.removeImport(f),this.addImport(i)):(this.style.updateImport(f,i),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,i){return this.style.moveImport(f,i),this._update(!0)}moveLayer(f,i){return this._isValidId(f)?(this.style.moveLayer(f,i),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const i=this.style.getOwnLayer(f);return i?i.type==="custom"?i.implementation:i.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,i,l){return this._isValidId(f)?(this.style.setLayerZoomRange(f,i,l),this._update(!0)):this}setFilter(f,i,l={}){return this._isValidId(f)?(this.style.setFilter(f,i,l),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,i,l,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,i,l,p),this._update(!0)):this}getPaintProperty(f,i){return this._isValidId(f)?this.style.getPaintProperty(f,i):null}setLayoutProperty(f,i,l,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,i,l,p),this._update(!0)):this}getLayoutProperty(f,i){return this._isValidId(f)?this.style.getLayoutProperty(f,i):null}getSchema(f){return this.style.getSchema(f)}setSchema(f,i){return this.style.setSchema(f,i),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,i){return this.style.setConfig(f,i),this._update(!0)}getConfigProperty(f,i){return this.style.getConfigProperty(f,i)}setConfigProperty(f,i,l){return this.style.setConfigProperty(f,i,l),this._update(!0)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const i=f[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.bK.convert(f),this.transform):0}setFeatureState(f,i){return this._isValidId(f.source)?(this.style.setFeatureState(f,i),this._update()):this}removeFeatureState(f,i){return this._isValidId(f.source)?(this.style.removeFeatureState(f,i),this._update()):this}getFeatureState(f){return this._isValidId(f.source)?this.style.getFeatureState(f):null}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let l,p,x,w=this._container;for(;w&&(!p||!x);){const E=window.getComputedStyle(w).transform;E&&E!=="none"&&(l=E.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(p=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(x=l[3])),w=w.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=x?Math.abs(i/x):i}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=te("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=te("div","mapboxgl-canvas-container",f);this._canvas=te("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=te("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(x=>{p[x]=te("div",`mapboxgl-ctrl-${x}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,i){const l=s.q.devicePixelRatio||1;this._canvas.width=l*Math.ceil(f),this._canvas.height=l*Math.ceil(i),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${i}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const i=this._markers.indexOf(f);i!==-1&&this._markers.splice(i,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const i=this._popups.indexOf(f);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const f=s.l({},U.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",f);i?(Qr(i,!0),this.painter=new yg(i,this._contextCreateOptions,this.transform,this._tp),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.m.testSupport(i)):this.fire(new s.t(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.x("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new s.x("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let i;this.fire(new s.x("renderstart")),++this._frameId;const l=this.painter.context.extTimerQuery,p=s.q.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=x.createQuery(),x.beginQuery(l.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,B=this.transform.pitch,G=s.q.now(),Z=new s.a3(z,{now:G,fadeDuration:w,pitch:B,transition:this.style.transition});this.style.update(Z)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(p),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(p);const R=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,this.painter.replacementSource);if(R&&(this._placementDirty=R.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.x("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,F.mark(O.load),this.fire(new s.x("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const z=s.q.now()-p;x.endQuery(l.TIME_ELAPSED_EXT),setTimeout(()=>{const B=x.getQueryParameter(i,x.QUERY_RESULT)/1e6;x.deleteQuery(i),this.fire(new s.x("gpu-timing-frame",{cpuTime:z,gpuTime:B}))},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const B=this.painter.queryGpuTimers(z);this.fire(new s.x("gpu-timing-layer",{layerTimes:B}))},50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const B=this.painter.queryGpuTimeDeferredRender(z);this.fire(new s.x("gpu-timing-deferred-render",{gpuTime:B}))},50)}const L=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(L||this._repaint)this.triggerRepaint();else{const z=this.idle();if(z&&(E=this._updateAverageElevation(p,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new s.x("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const B=this._calculateSpeedIndex();this.fire(new s.x("speedindexcompleted",{speedIndex:B})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||L||(this._fullyLoaded=!0,F.mark(O.fullLoad),this._performanceMetricsCollection&&Jr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const i of this._markers)f&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!f||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(f,i=!1){const l=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(i||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const x=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=f;const E=Math.abs(x-w);if(E>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(w),l(w);this._averageElevation.easeTo(w,f,300)}else if(E>1e-4)return this._averageElevation.jumpTo(w),l(w)}return!!this._averageElevation.isEasing(f)&&l(this._averageElevation.getValue(f))}_authenticate(){Ie(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===Yt||f.status===401)){const i=this.painter.context.gl;Qr(i,!1),this._logoControl instanceof Ag&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.t(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Cr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Qt(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const l=this.painter.context.gl,p=l.createFramebuffer();function x(w){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,w,0);const E=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,E),E}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(x(f),i.canvasCopies.map(x),i.timeStamps)}_canvasPixelComparison(f,i,l){let p=l[1]-l[0];const x=f.length/4;for(let w=0;w<i.length;w++){const E=i[w];let R=0;for(let L=0;L<E.length;L+=4)E[L]===f[L]&&E[L+1]===f[L+1]&&E[L+2]===f[L+2]&&E[L+3]===f[L+3]&&(R+=1);p+=(l[w+2]-l[w+1])*(1-R/x)}return p}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),er.delete(this.painter.context.gl),hr.remove(),Ut.remove(),this._removed=!0,this.fire(new s.x("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=s.q.frame(i=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(i)}))}_preloadTiles(f){const i=this.style?this.style.getSourceCaches():[];return s.bf(i,(l,p)=>l._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,i){s.dy(f,i)}get version(){return k}},NavigationControl:class{constructor(f={}){this.options=s.l({},Kd,f),this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(s.aJ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),te("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),te("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aJ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:i}):l.resetNorth({},{originalEvent:i}))}),this._compassIcon=te("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const i=f.getZoom(),l=i===f.getMaxZoom(),p=i===f.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new iu(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,i){const l=te("button",f,this._container);return l.type="button",l.addEventListener("click",i),l}_setButtonTitle(f,i){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${i}`);f.setAttribute("aria-label",l),f.firstElementChild&&f.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends s.E{constructor(f={}){super();const i=navigator.geolocation;this.options=s.l({geolocation:i},Bl,f),s.aJ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ga(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const i=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,f(l)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(l=>i(l.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(f){const i=this._map.getMaxBounds(),l=f.coords;return!!i&&(l.longitude<i.getWest()||l.longitude>i.getEast()||l.latitude<i.getSouth()||l.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new s.x("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.x("geolocate",f)),this._finish()}}_updateCamera(f){const i=new s.bK(f.coords.longitude,f.coords.latitude),l=f.coords.accuracy,p=this._map.getBearing(),x=s.l({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(l),x,{geolocateSource:!0})}_updateMarker(f){if(f){const i=new s.bK(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,i=s.bD(1,f._center.lat)*f.worldSize,l=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.x("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=te("button","mapboxgl-ctrl-geolocate",this._container),te("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=te("div","mapboxgl-user-location"),this._dotElement.appendChild(te("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(te("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Uo({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=te("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Uo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.x("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.x("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.x("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.x("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Xf,ScaleControl:class{constructor(f={}){this.options=s.l({},rl,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aJ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,i=this._map,l=i._containerHeight/2,p=i._containerWidth/2-f/2,x=i.unproject([p,l]),w=i.unproject([p+f,l]),E=x.distanceTo(w);if(this.options.unit==="imperial"){const R=3.2808*E;R>5280?this._setScale(f,R/5280,"mile"):this._setScale(f,R,"foot")}else this.options.unit==="nautical"?this._setScale(f,E/1852,"nautical-mile"):E>=1e3?this._setScale(f,E/1e3,"kilometer"):this._setScale(f,E,"meter")}_setScale(f,i,l){this._map._requestDomTask(()=>{const p=function(w){const E=Math.pow(10,`${Math.floor(w)}`.length-1);let R=w/E;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(L){const z=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*z)/z}(R),E*R}(i),x=p/i;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(p):`${p}&nbsp;${Mw[l]}`,this._container.style.width=f*x+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:s.w("Full screen control 'container' must be a DOM element.")),s.aJ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=te("button","mapboxgl-ctrl-fullscreen",this._controlContainer);te("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.E{constructor(f){super(),this.options=s.l(Object.create(Aw),f),s.aJ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new s.x("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new s.x("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=s.bK.convert(f),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const i=document.createDocumentFragment(),l=document.createElement("body");let p;for(l.innerHTML=f;p=l.firstChild,p;)i.appendChild(p);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=te("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(f),this.options.closeButton){const l=this._closeButton=te("button","mapboxgl-popup-close-button",i);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let i;return this._classList.delete(f)?i=!1:(this._classList.add(f),i=!0),this._updateClassList(),i}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const i=this._map,l=this._container,p=this._pos;if(!i||!l||!p)return"bottom";const x=l.offsetWidth,w=l.offsetHeight,E=p.x<x/2,R=p.x>i.transform.width-x/2;if(p.y+f<w)return E?"top-left":R?"top-right":"top";if(p.y>i.transform.height-w){if(E)return"bottom-left";if(R)return"bottom-right"}return E?"left":R?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),f.className=i.join(" ")}_update(f){const i=this._map,l=this._content;if(!i||!this._lngLat&&!this._trackPointer||!l)return;let p=this._container;if(p||(p=this._container=te("div","mapboxgl-popup",i.getContainer()),this._tip=te("div","mapboxgl-popup-tip",p),p.appendChild(l)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Vo(this._lngLat,this._pos,i.transform)),!this._trackPointer||f){const x=this._pos=this._trackPointer&&f instanceof s.P?f:i.project(this._lngLat),w=o0(this.options.offset),E=this._anchor=this._getAnchor(w.y),R=o0(this.options.offset,E),L=x.add(R).round();i._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${Is[E]} translate(${L.x}px,${L.y}px)`)})}if(!this._marker&&i._showingGlobe()){const x=s.dz(i.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Iw);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:Uo,Style:Ms,LngLat:s.bK,LngLatBounds:s.as,Point:s.P,MercatorCoordinate:s.a5,FreeCameraOptions:Za,Evented:s.E,config:s.e,prewarm:s.dE,clearPrewarmedResources:s.dF,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(f){s.e.ACCESS_TOKEN=f},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(f){s.e.API_URL=f},get workerCount(){return s.dG.workerCount},set workerCount(f){s.dG.workerCount=f},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){s.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){s.dH(f)},get workerUrl(){return s.dI.workerUrl},set workerUrl(f){s.dI.workerUrl=f},get workerClass(){return s.dI.workerClass},set workerClass(f){s.dI.workerClass=f},get workerParams(){return s.dI.workerParams},set workerParams(f){s.dI.workerParams=f},get dracoUrl(){return s.dJ()},set dracoUrl(f){s.dK(f)},get meshoptUrl(){return s.dL()},set meshoptUrl(f){s.dM(f)},setNow:s.q.setNow,restoreNow:s.q.restoreNow}});var b=m;return b})})($V);var kle=$V.exports;const jy=Y1(kle);function Nle(e){return Kr({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z"},child:[]}]})(e)}function WV(e){return Kr({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"},child:[]}]})(e)}function Lle(e){return Kr({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"},child:[]}]})(e)}function Ole(e){return Kr({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 12h-2v-2h2v2zm0-4h-2V6h2v4z"},child:[]}]})(e)}function jle(e){return Kr({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"},child:[]}]})(e)}function zle(e){return Kr({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M4 16v6h16v-6c0-1.1-.9-2-2-2H6c-1.1 0-2 .9-2 2zm14 2H6v-2h12v2zM12 2C9.24 2 7 4.24 7 7l5 7 5-7c0-2.76-2.24-5-5-5zm0 9L9 7c0-1.66 1.34-3 3-3s3 1.34 3 3l-3 4z"},child:[]}]})(e)}function Fle(e){return Kr({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M6 17.59 7.41 19 12 14.42 16.59 19 18 17.59l-6-6z"},child:[]},{tag:"path",attr:{d:"m6 11 1.41 1.41L12 7.83l4.59 4.58L18 11l-6-6z"},child:[]}]})(e)}function Ble(e){return Kr({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 2C8.13 2 5 5.13 5 9c0 1.74.5 3.37 1.41 4.84.95 1.54 2.2 2.86 3.16 4.4.47.75.81 1.45 1.17 2.26.26.55.47 1.5 1.26 1.5s1-.95 1.25-1.5c.37-.81.7-1.51 1.17-2.26.96-1.53 2.21-2.85 3.16-4.4C18.5 12.37 19 10.74 19 9c0-3.87-3.13-7-7-7zm0 9.75a2.5 2.5 0 0 1 0-5 2.5 2.5 0 0 1 0 5z"},child:[]}]})(e)}function HV(e){return Kr({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M15 11V5l-3-3-3 3v2H3v14h18V11h-6zm-8 8H5v-2h2v2zm0-4H5v-2h2v2zm0-4H5V9h2v2zm6 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V9h2v2zm0-4h-2V5h2v2zm6 12h-2v-2h2v2zm0-4h-2v-2h2v2z"},child:[]}]})(e)}function DA(e){return Kr({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19.3 16.9c.4-.7.7-1.5.7-2.4 0-2.5-2-4.5-4.5-4.5S11 12 11 14.5s2 4.5 4.5 4.5c.9 0 1.7-.3 2.4-.7l3.2 3.2 1.4-1.4-3.2-3.2zm-3.8.1c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5zM12 20v2C6.48 22 2 17.52 2 12S6.48 2 12 2c4.84 0 8.87 3.44 9.8 8h-2.07A8 8 0 0 0 15 4.59V5c0 1.1-.9 2-2 2h-2v2c0 .55-.45 1-1 1H8v2h2v3H9l-4.79-4.79C4.08 10.79 4 11.38 4 12c0 4.41 3.59 8 8 8z"},child:[]}]})(e)}function qV(e){return Kr({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H5.17l-.59.59-.58.58V4h16v12zm-9-4h2v2h-2zm0-6h2v4h-2z"},child:[]}]})(e)}function Vle(e){return Kr({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M12 192h424c6.6 0 12 5.4 12 12v260c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V204c0-6.6 5.4-12 12-12zm436-44v-36c0-26.5-21.5-48-48-48h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v36c0 6.6 5.4 12 12 12h424c6.6 0 12-5.4 12-12z"},child:[]}]})(e)}function j_(e){return Kr({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"},child:[]}]})(e)}function ZV(e){return Kr({tag:"svg",attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(e)}jy.accessToken="pk.eyJ1IjoiY2V5dm95IiwiYSI6ImNseW1uNTV0ZDBkemwya3Fya2hmc3p1b3QifQ.MA5PmGoZ9MUqmCcKG2nOhQ";let Cy;const Ule=({setCurrentStep:e})=>{const[t]=W.useState({latitude:7.8731,longitude:80.7718,zoom:7,width:"100%",height:"70vh"}),r=W.useRef(null),o=W.useRef(null),u=W.useRef(null),[m,_]=W.useState([]),[b,s]=W.useState(!1),[k,O]=W.useState(0),[F,q]=W.useState([]),[H,J]=W.useState({start:0,end:9}),{locations:U,distanceAndDurations:te,questionnaire:Q}=qi(ft=>ft.trip),ee=xl(),re=W.useCallback(async()=>{const ft=new FormData;ft.append("environment",Q.environment),ft.append("step",1),await Jt.post("/get_start",ft).then(({data:ut})=>{_(ut==null?void 0:ut.locations),(ut==null?void 0:ut.locations.length)<9&&J({start:0,end:ut==null?void 0:ut.locations.length})}).catch(()=>{Mn("Failed to load data")})},[Q.environment]),xe=(ft,ut)=>{const mt=[...U],[pt]=mt.splice(ft,1);mt.splice(ut,0,pt),ee(uW(mt))},Ee=W.useCallback(async()=>{if(U.length<2)return ee(e2());const ft=U.map(ut=>[ut.longitude,ut.latitude]).join(";");await fetch(`https://api.mapbox.com/directions-matrix/v1/mapbox/driving/${ft}?annotations=distance,duration&access_token=${jy.accessToken}`).then(ut=>ut.json()).then(ut=>{var mt,pt;if(ut&&ut.durations&&ut.distances){const en=[];let Yt=0;for(let dn=0;dn<ut.durations.length-1;dn++)en.push({distance:ut.distances[dn][dn+1]/1e3,duration:ut.durations[dn][dn+1],from:(mt=U[dn])==null?void 0:mt.id,to:(pt=U[dn+1])==null?void 0:pt.id}),Yt+=ut.durations[dn][dn+1];O(Yt),ee(dW(en))}}).catch(ut=>{console.error("Error fetching distance and duration:",ut)})},[U,ee]),He=W.useCallback(()=>{try{F&&F.forEach(ft=>ft.remove()),U&&U.forEach(ft=>{var mt,pt;const ut=ft;if(ut.latitude&&ut.longitude){const en=new jy.Marker().setLngLat([ut.longitude,ut.latitude]).addTo(u.current).setPopup(new jy.Popup({closeButton:!0}).setHTML(`<div class="p-1">
                      <span><strong>City:</strong> ${(mt=m.find(Yt=>Yt.id===ut.id))==null?void 0:mt.city}</span><br>
                      <span><strong>Description:</strong> ${(pt=m.find(Yt=>Yt.id===ut.id))==null?void 0:pt.description}</span><br>
                    </div>`));q(Yt=>[...Yt,en])}else console.error(`Invalid location data: ${ut.title}`,ut)})}catch(ft){console.error("Error initializing geocoder or adding markers:",ft)}},[U]);W.useEffect(()=>{re()},[re]),W.useEffect(()=>{Ee()},[U,Ee]),W.useEffect(()=>{if(r.current)return Cy=new jy.Map({container:r.current,style:"mapbox://styles/mapbox/streets-v11",center:[t.longitude,t.latitude],zoom:t.zoom}),u.current=Cy,()=>{Cy==null||Cy.remove()}},[r,t]),W.useEffect(()=>{He()},[U,He]);const qe=()=>U.length<2?(Mn("Select at least 2 places to continue"),!1):k/3600>Q.days*7?(Mn(`Total duration is more than ${Q.days*7} hours. Please select less places or increase the number of days`),!1):!0,Ne=ft=>{ft.preventDefault(),qe()&&e(3)};return S.jsxs(Bae,{backend:Rle,children:[S.jsxs("div",{className:"relative flex w-full flex-col justify-center gap-5 lg:flex-row",children:[S.jsxs("div",{className:"flex w-full flex-col items-center lg:w-1/2 xl:w-3/5",children:[S.jsx("div",{className:"grid h-fit grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-3",children:m.slice(H.start,H.end).map(ft=>S.jsx($le,{item:ft},ft.id))}),(m==null?void 0:m.length)===0&&S.jsx("p",{className:"text-sm italic",children:"No locations found"}),(m==null?void 0:m.length)>9&&S.jsxs("div",{className:"mt-4 flex w-full justify-between gap-2 border-b border-b-sky-700/30 pb-4",children:[S.jsxs(Pn,{size:"sm",disabled:H.start===0,className:"w-28 bg-sky-700 shadow-sm drop-shadow-lg",onClick:()=>J({start:H.start-9,end:H.end%9*9}),children:[S.jsx(ZQ,{className:"me-1 size-4"}),"Previous"]}),S.jsxs(Pn,{size:"sm",disabled:H.end>=m.length,className:"w-28 bg-sky-700 shadow-sm drop-shadow-lg",onClick:()=>J({start:H.start+9,end:m.length>H.end+9?H.end+9:m.length}),children:["Next ",S.jsx(XQ,{className:"ms-1 size-4"})]})]})]}),S.jsxs("div",{className:`fixed start-0 top-0 z-[99999] ${b?"translate-y-0":"-translate-y-full"} flex h-full w-full items-center justify-center bg-black/30 p-5 backdrop-blur-sm duration-100`,children:[S.jsx("button",{onClick:()=>s(!1),className:"absolute end-5 top-5 rounded-full bg-black p-2 text-white shadow-sm",children:S.jsx(ZV,{className:"size-5"})}),S.jsx("div",{className:"h-[90vh] w-full max-w-3xl rounded-md",id:"map-container",ref:r,style:{width:"100%",height:"90vh"},children:S.jsx("div",{ref:o,id:"geocoder",className:"geocoder-container"})})]}),S.jsxs("div",{className:"flex w-full flex-col gap-y-5 lg:w-1/2 xl:w-2/5",children:[S.jsxs("div",{className:"",children:[S.jsx("div",{className:"flex justify-end",children:S.jsxs(Pn,{size:"sm",onClick:()=>s(!0),className:"flex gap-x-1 bg-sky-700 shadow-sm drop-shadow-lg",children:[S.jsx(QQ,{className:"size-5"}),"View on Map"]})}),S.jsx("h3",{className:"mb-2 font-medium",children:"Selected Places:"}),S.jsx("ul",{className:"flex flex-col gap-y-2",children:U==null?void 0:U.map((ft,ut)=>S.jsx(Gle,{index:ut,card:(m==null?void 0:m.find(mt=>mt.id===ft.id))||{},moveCard:xe,handleCardSelection:()=>ee(Qz({id:ft.id,days:1}))},ut))}),(U==null?void 0:U.length)===0&&S.jsx("p",{className:"text-sm italic",children:"No places selected"})]}),S.jsxs("div",{className:"selected-list",children:[S.jsx("h3",{className:"mb-2 font-medium",children:"Distances and Durations:"}),S.jsx("ul",{className:"flex flex-col gap-y-2",children:te==null?void 0:te.map((ft,ut)=>{var mt,pt;return S.jsxs("li",{className:"flex flex-col items-center justify-between rounded-md border bg-white p-4 shadow-sm drop-shadow-xl",children:[S.jsxs("p",{className:"w-full text-start text-sm",children:[S.jsx("span",{className:"font-medium",children:"From : "}),(mt=m.find(en=>en.id===ft.from))==null?void 0:mt.title]}),S.jsxs("p",{className:"w-full text-start text-sm",children:[S.jsx("span",{className:"font-medium",children:"To : "}),(pt=m.find(en=>en.id===ft.to))==null?void 0:pt.title]}),S.jsxs("p",{className:"mt-2 w-full border-t border-sky-700/50 pt-2 text-start text-sm",children:[S.jsx("span",{className:"font-medium",children:"Distance : "}),ft.distance.toFixed(2)," km"]}),S.jsxs("p",{className:"w-full text-start text-sm",children:[S.jsx("span",{className:"font-medium",children:"Duration : "}),new Date((ft==null?void 0:ft.duration)*1e3).toISOString().substring(11,16)," ","hours"]})]},ut)})}),U.length<2&&S.jsx("p",{className:"text-sm italic",children:"Select at least 2 places to view distances and durations"})]})]})]}),S.jsxs("div",{className:"mt-8 flex justify-between gap-4",children:[S.jsx(Pn,{onClick:()=>e(1),className:"mt-4 w-28 rounded-md bg-gray-500 px-4 py-2 text-white",children:"Back"}),S.jsx(Pn,{onClick:Ne,className:"mt-4 w-28 rounded-md bg-sky-700 px-4 py-2 text-white",children:"Next"})]})]})},$le=({item:e})=>{const t=xl(),{locations:r}=qi(o=>o.trip);return S.jsxs("div",{className:"relative w-full max-w-md overflow-hidden rounded-lg bg-white shadow-md drop-shadow-xl",children:[S.jsx("img",{src:"http://localhost:8000/"+(e==null?void 0:e.image)+`?${new Date().getSeconds()}`,alt:"gallery",className:"h-48 w-full rounded-lg object-cover"}),S.jsxs("div",{className:"p-4 pb-16",children:[S.jsx("h2",{className:"line-clamp-2 font-medium",children:e==null?void 0:e.title}),S.jsx("p",{className:"mb-1 flex w-fit rounded bg-fuchsia-700 px-2 py-0.5 text-xs text-white",children:e==null?void 0:e.category}),S.jsxs("p",{className:"flex items-end gap-x-1 text-xs capitalize text-gray-600",children:[S.jsx(uc,{className:"-ms-1 size-5 text-red-600"}),S.jsxs("span",{className:"line-clamp-1",children:[e==null?void 0:e.city,", ",e==null?void 0:e.province.replace(/-/g," ")," Province"]})]}),S.jsx("p",{className:"mt-2 text-xs text-gray-700",children:e==null?void 0:e.description})]}),S.jsx("div",{className:"absolute bottom-0 start-0 mt-5 flex w-full items-center justify-between gap-2 p-4",children:S.jsx("div",{className:"flex w-full items-center justify-end gap-2",children:S.jsxs(jt,{htmlFor:e==null?void 0:e.id,children:[S.jsx(qh,{id:e==null?void 0:e.id,checked:r.some(o=>o.id===(e==null?void 0:e.id)),onCheckedChange:()=>{t(Qz({id:e==null?void 0:e.id,latitude:e==null?void 0:e.latitude,longitude:e==null?void 0:e.longitude}))},className:"peer sr-only"}),S.jsx("div",{className:"flex w-32 cursor-pointer justify-center rounded-full bg-sky-600 py-2.5 text-white peer-aria-checked:bg-red-500",children:r.some(o=>o.id===(e==null?void 0:e.id))?"Selected":"Select"})]})})})]},e==null?void 0:e.id)},Gle=({card:e,index:t,moveCard:r,handleCardSelection:o})=>{const[,u]=_le({accept:"CARD",hover(b){b.index!==t&&(r(b.index,t),b.index=t)}}),[{isDragging:m},_]=ule({type:"CARD",item:{index:t},collect:b=>({isDragging:b.isDragging()})});return S.jsxs("li",{ref:b=>_(u(b)),className:`flex items-center justify-between gap-2 rounded-md border bg-white p-3 shadow-sm drop-shadow-xl ${m?"cursor-grabbing":"cursor-grab"}`,children:[S.jsx(Lle,{className:"size-5"}),S.jsx("span",{className:"line-clamp-1",children:e.title}),S.jsx(ZV,{onClick:o,className:"remove-icon"})]})},Wle=({setCurrentStep:e})=>{const{questionnaire:t}=qi(b=>b.trip),r=xl(),[o,u]=W.useState({people:"",arrival:"",days:"",budget:"",language:"",environment:""}),m=b=>(Object.keys(b).forEach(k=>{if(!b[k])return u(O=>({...O,[k]:`${k} is required`})),!1}),b.environment.length?!0:(u(k=>({...k,environment:"environment is required"})),!1)),_=b=>{b.preventDefault(),m(t)&&e(2)};return S.jsx("div",{className:"flex w-full justify-center",children:S.jsxs("form",{onSubmit:_,className:"flex w-full max-w-4xl flex-col items-center justify-center",children:[S.jsxs("div",{className:"mb-2 w-full",children:[S.jsx(jt,{htmlFor:"people",children:"How many people are traveling with you :"}),S.jsxs(Ci,{value:t.people,onValueChange:b=>r(ah({key:"people",value:parseInt(b)})),children:[S.jsx(_i,{className:"w-full border-gray-400/80",children:S.jsx(Mi,{placeholder:"Select a peoples count"})}),S.jsx(xi,{children:S.jsx(Pi,{children:Array.from({length:25},(b,s)=>s+1).map(b=>S.jsx(ii,{value:b,children:b},b))})})]}),o.people&&S.jsx("p",{className:"text-sm text-red-500",children:o.people})]}),S.jsxs("div",{className:"mb-2 w-full",children:[S.jsx(jt,{htmlFor:"arrival",children:"When do you plan to arrive :"}),S.jsxs(lm,{children:[S.jsx(cm,{asChild:!0,children:S.jsxs(Pn,{variant:"outline",className:Zn("w-full justify-start border-gray-400/80 text-left font-normal hover:bg-white",!t.arrival&&"text-muted-foreground"),children:[S.jsx(gl,{className:"mr-2 h-4 w-4"}),t.arrival?Ei(t.arrival,"PPP"):S.jsx("span",{children:"Pick a date"})]})}),S.jsx(jh,{className:"w-auto p-0",align:"start",children:S.jsx(Lh,{mode:"single",selected:t.arrival,onSelect:b=>r(ah({key:"arrival",value:b})),initialFocus:!0,disabled:b=>b<new Date(new Date().setHours(0,0,0,0))})})]}),o.arrival&&S.jsx("p",{className:"text-sm text-red-500",children:o.arrival})]}),S.jsxs("div",{className:"mb-2 w-full",children:[S.jsx(jt,{htmlFor:"days",children:"How many days do you plan to stay :"}),S.jsxs(Ci,{value:t.days,onValueChange:b=>r(ah({key:"days",value:parseInt(b)})),children:[S.jsx(_i,{className:"w-full border-gray-400/80",children:S.jsx(Mi,{placeholder:"Select a days count"})}),S.jsx(xi,{children:S.jsx(Pi,{children:Array.from({length:30},(b,s)=>s+1).map(b=>S.jsx(ii,{value:b,children:b},b))})})]}),o.days&&S.jsx("p",{className:"text-sm text-red-500",children:o.days})]}),S.jsxs("div",{className:"mb-2 w-full",children:[S.jsx(jt,{htmlFor:"budget",children:"What is your maximum budget for your trip?"}),S.jsxs(Ci,{value:t.budget,onValueChange:b=>r(ah({key:"budget",value:parseInt(b)})),children:[S.jsx(_i,{className:"w-full border-gray-400/80",children:S.jsx(Mi,{placeholder:"Select a budget"})}),S.jsx(xi,{children:S.jsx(Pi,{children:js.budget.map(b=>S.jsx(ii,{value:b.value,children:b.label},b.value))})})]}),o.budget&&S.jsx("p",{className:"text-sm text-red-500",children:o.budget})]}),S.jsxs("div",{className:"mb-2 w-full",children:[S.jsx(jt,{htmlFor:"environment",children:"What kind of environments are you interested in :"}),S.jsx("div",{className:"my-2 grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-3",children:js.environments.map(b=>S.jsxs("div",{className:"flex items-center gap-2",children:[S.jsx(qh,{id:b,checked:t.environment.includes(b),onCheckedChange:s=>{r(ah(s?{key:"environment",value:[...t.environment,b]}:{key:"environment",value:t.environment.filter(k=>k!==b)}))}}),S.jsx(jt,{htmlFor:b,className:"capitalize",children:b})]},b))}),o.environment&&S.jsx("p",{className:"text-sm text-red-500",children:o.environment})]}),S.jsxs("div",{className:"mb-2 w-full",children:[S.jsx(jt,{htmlFor:"language",children:"Which languages do you speak :"}),S.jsxs(Ci,{value:t.language,onValueChange:b=>r(ah({key:"language",value:b})),children:[S.jsx(_i,{className:"w-full border-gray-400/80",children:S.jsx(Mi,{placeholder:"Select a language"})}),S.jsx(xi,{children:S.jsx(Pi,{children:js.languages.map(b=>S.jsx(ii,{value:b.value,children:b.label},b.value))})})]}),o.language&&S.jsx("p",{className:"text-sm text-red-500",children:o.language})]}),S.jsx(Pn,{className:"mt-4 w-full max-w-lg rounded-md bg-sky-700 px-4 py-2 text-white",children:"Next"})]})})};function Hle(e,t){const r=W.createContext(t),o=m=>{const{children:_,...b}=m,s=W.useMemo(()=>b,Object.values(b));return S.jsx(r.Provider,{value:s,children:_})};o.displayName=e+"Provider";function u(m){const _=W.useContext(r);if(_)return _;if(t!==void 0)return t;throw new Error(`\`${m}\` must be used within \`${e}\``)}return[o,u]}function RA(e,t=[]){let r=[];function o(m,_){const b=W.createContext(_),s=r.length;r=[...r,_];const k=F=>{var Q;const{scope:q,children:H,...J}=F,U=((Q=q==null?void 0:q[e])==null?void 0:Q[s])||b,te=W.useMemo(()=>J,Object.values(J));return S.jsx(U.Provider,{value:te,children:H})};k.displayName=m+"Provider";function O(F,q){var U;const H=((U=q==null?void 0:q[e])==null?void 0:U[s])||b,J=W.useContext(H);if(J)return J;if(_!==void 0)return _;throw new Error(`\`${F}\` must be used within \`${m}\``)}return[k,O]}const u=()=>{const m=r.map(_=>W.createContext(_));return function(b){const s=(b==null?void 0:b[e])||m;return W.useMemo(()=>({[`__scope${e}`]:{...b,[e]:s}}),[b,s])}};return u.scopeName=e,[o,qle(u,...t)]}function qle(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const o=e.map(u=>({useScope:u(),scopeName:u.scopeName}));return function(m){const _=o.reduce((b,{useScope:s,scopeName:k})=>{const F=s(m)[`__scope${k}`];return{...b,...F}},{});return W.useMemo(()=>({[`__scope${t.scopeName}`]:_}),[_])}};return r.scopeName=t.scopeName,r}function Zle(e,t){return W.useReducer((r,o)=>t[r][o]??r,e)}var XV=e=>{const{present:t,children:r}=e,o=Xle(t),u=typeof r=="function"?r({present:o.isPresent}):W.Children.only(r),m=gr(o.ref,Yle(u));return typeof r=="function"||o.isPresent?W.cloneElement(u,{ref:m}):null};XV.displayName="Presence";function Xle(e){const[t,r]=W.useState(),o=W.useRef({}),u=W.useRef(e),m=W.useRef("none"),_=e?"mounted":"unmounted",[b,s]=Zle(_,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return W.useEffect(()=>{const k=Ev(o.current);m.current=b==="mounted"?k:"none"},[b]),Ii(()=>{const k=o.current,O=u.current;if(O!==e){const q=m.current,H=Ev(k);e?s("MOUNT"):H==="none"||(k==null?void 0:k.display)==="none"?s("UNMOUNT"):s(O&&q!==H?"ANIMATION_OUT":"UNMOUNT"),u.current=e}},[e,s]),Ii(()=>{if(t){let k;const O=t.ownerDocument.defaultView??window,F=H=>{const U=Ev(o.current).includes(H.animationName);if(H.target===t&&U&&(s("ANIMATION_END"),!u.current)){const te=t.style.animationFillMode;t.style.animationFillMode="forwards",k=O.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=te)})}},q=H=>{H.target===t&&(m.current=Ev(o.current))};return t.addEventListener("animationstart",q),t.addEventListener("animationcancel",F),t.addEventListener("animationend",F),()=>{O.clearTimeout(k),t.removeEventListener("animationstart",q),t.removeEventListener("animationcancel",F),t.removeEventListener("animationend",F)}}else s("ANIMATION_END")},[t,s]),{isPresent:["mounted","unmountSuspended"].includes(b),ref:W.useCallback(k=>{k&&(o.current=getComputedStyle(k)),r(k)},[])}}function Ev(e){return(e==null?void 0:e.animationName)||"none"}function Yle(e){var o,u;let t=(o=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:o.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(u=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:u.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var kA="Collapsible",[Kle,dde]=RA(kA),[Jle,NA]=Kle(kA),YV=W.forwardRef((e,t)=>{const{__scopeCollapsible:r,open:o,defaultOpen:u,disabled:m,onOpenChange:_,...b}=e,[s=!1,k]=hc({prop:o,defaultProp:u,onChange:_});return S.jsx(Jle,{scope:r,disabled:m,contentId:To(),open:s,onOpenToggle:W.useCallback(()=>k(O=>!O),[k]),children:S.jsx(jn.div,{"data-state":OA(s),"data-disabled":m?"":void 0,...b,ref:t})})});YV.displayName=kA;var KV="CollapsibleTrigger",JV=W.forwardRef((e,t)=>{const{__scopeCollapsible:r,...o}=e,u=NA(KV,r);return S.jsx(jn.button,{type:"button","aria-controls":u.contentId,"aria-expanded":u.open||!1,"data-state":OA(u.open),"data-disabled":u.disabled?"":void 0,disabled:u.disabled,...o,ref:t,onClick:In(e.onClick,u.onOpenToggle)})});JV.displayName=KV;var LA="CollapsibleContent",QV=W.forwardRef((e,t)=>{const{forceMount:r,...o}=e,u=NA(LA,e.__scopeCollapsible);return S.jsx(XV,{present:r||u.open,children:({present:m})=>S.jsx(Qle,{...o,ref:t,present:m})})});QV.displayName=LA;var Qle=W.forwardRef((e,t)=>{const{__scopeCollapsible:r,present:o,children:u,...m}=e,_=NA(LA,r),[b,s]=W.useState(o),k=W.useRef(null),O=gr(t,k),F=W.useRef(0),q=F.current,H=W.useRef(0),J=H.current,U=_.open||b,te=W.useRef(U),Q=W.useRef();return W.useEffect(()=>{const ee=requestAnimationFrame(()=>te.current=!1);return()=>cancelAnimationFrame(ee)},[]),Ii(()=>{const ee=k.current;if(ee){Q.current=Q.current||{transitionDuration:ee.style.transitionDuration,animationName:ee.style.animationName},ee.style.transitionDuration="0s",ee.style.animationName="none";const re=ee.getBoundingClientRect();F.current=re.height,H.current=re.width,te.current||(ee.style.transitionDuration=Q.current.transitionDuration,ee.style.animationName=Q.current.animationName),s(o)}},[_.open,o]),S.jsx(jn.div,{"data-state":OA(_.open),"data-disabled":_.disabled?"":void 0,id:_.contentId,hidden:!U,...m,ref:O,style:{"--radix-collapsible-content-height":q?`${q}px`:void 0,"--radix-collapsible-content-width":J?`${J}px`:void 0,...e.style},children:U&&u})});function OA(e){return e?"open":"closed"}var ece=YV;const tce=ece,nce=JV,rce=QV,ice=({setCurrentStep:e})=>{const{user:t}=qi(re=>re.user),{questionnaire:r,locations:o,summery:u}=qi(re=>re.trip),m=xl(),[_,b]=W.useState([]),[s,k]=W.useState(null),[O,F]=W.useState(!1),q=yc(),H=W.useCallback(async()=>{const re=new FormData;re.append("locations",o.map(xe=>xe.id).join(",")),re.append("step",2),re.append("language",r.language),re.append("start_date",r.arrival),re.append("end_date",new Date(r.arrival).setDate(new Date(r.arrival).getDate()+r.days)),re.append("people",r.people),await Jt.post("/get_start",re).then(({data:xe})=>{b(xe==null?void 0:xe.guides),k(xe==null?void 0:xe.accommodations)}).catch(()=>{Mn("Failed to load data")})},[o,r.arrival,r.days,r.language,r.people]),J=()=>u.accommodations.length===0?(Mn("Please select accommodations"),!1):u.guide===null?(Mn("Please select a guide"),!1):!0,U=async re=>{if(re.preventDefault(),!J())return;const xe=new FormData;xe.append("locations",o.map(ft=>ft.id).join(",")),xe.append("step",3),xe.append("language",r.language),xe.append("people",r.people),xe.append("budget",r.budget),xe.append("environment",r.environment.join(",")),xe.append("guide",u.guide),xe.append("accommodations",u.accommodations.join(",")),xe.append("accommodation_prices",u.accommodationPrices.join(","));const Ee=new Date(r.arrival),He=`${Ee.getFullYear()}-${Ee.getMonth()+1}-${Ee.getDate()}`;xe.append("start_date",He);const qe=new Date(new Date(Ee).setDate(Ee.getDate()+r.days));console.log(qe);const Ne=`${qe.getFullYear()}-${qe.getMonth()+1}-${qe.getDate()}`;xe.append("end_date",Ne),await Jt.post("/get_start/finish",xe).then(()=>{fi("Trip saved successfully"),m(cW()),m(e2()),m(hW()),m(mW()),q("/dashboard")}).catch(()=>{Mn("Failed to load data")})},te=()=>{let re=0;return u.accommodationPrices.forEach(xe=>{re+=xe}),re},Q=()=>u.guidePrice*r.days,ee=()=>r.people*1e3*r.days+te()+Q();return W.useEffect(()=>{H()},[H]),S.jsxs("div",{className:"flex w-full flex-col items-center justify-center",children:[S.jsx("h2",{className:"mb-2 w-full text-lg font-medium",children:"Accommodations"}),s&&Object.keys(s).map((re,xe)=>{const Ee=s[re];return S.jsxs(W.Fragment,{children:[S.jsx("h3",{className:"mb-1 mt-4 w-full text-gray-800",children:re}),S.jsxs("div",{className:"mb-2 w-full",children:[Ee&&S.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4",children:Ee==null?void 0:Ee.map((He,qe)=>S.jsxs("div",{className:"flex flex-col rounded-lg border border-gray-300 bg-white p-4 shadow-sm drop-shadow-2xl",children:[S.jsx("img",{src:"http://localhost:8000/"+(He==null?void 0:He.image)+`?${new Date().getSeconds()}`,alt:"gallery",className:"mb-3 h-full max-h-48 w-full rounded-lg object-cover"}),S.jsxs("div",{className:"flex items-center justify-between",children:[S.jsx("h4",{className:"text-lg font-medium",children:He==null?void 0:He.name}),S.jsx(Pn,{onClick:()=>{m(pW({id:He==null?void 0:He.id,price:He==null?void 0:He.price}))},size:"sm",className:"h-7 bg-sky-700",children:u.accommodations.includes(He==null?void 0:He.id)?"Remove":"Select"})]}),S.jsxs("p",{className:"text-sm text-gray-500",children:["Category :",He==null?void 0:He.category]}),S.jsxs("p",{className:"text-sm text-gray-500",children:["Price :",He==null?void 0:He.price]}),S.jsxs("p",{className:"text-sm text-gray-500",children:["Max. Guests :",He==null?void 0:He.max_guests]}),S.jsxs("p",{className:"text-sm text-gray-500",children:["Address :",He==null?void 0:He.address]}),S.jsxs("p",{className:"text-sm text-gray-500",children:["Facilities :",He==null?void 0:He.facilities]}),S.jsx("p",{className:"text-end text-sm font-medium text-emerald-500 underline",children:S.jsx(ui,{to:He==null?void 0:He.website,children:"Visit website"})})]},qe))}),(Ee==null?void 0:Ee.length)===0&&S.jsx("p",{className:"text-xs text-gray-600",children:"No accommodation available for this location."})]})]},xe)}),S.jsx("h2",{className:"my-2 w-full text-lg font-medium",children:"Guides"}),S.jsx("div",{className:"mb-2 w-full",children:S.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4",children:_==null?void 0:_.map((re,xe)=>S.jsxs("div",{className:"flex flex-col rounded-lg border border-gray-300 bg-white p-4 shadow-sm drop-shadow-2xl",children:[S.jsxs("div",{className:"flex items-center justify-between",children:[S.jsx("h4",{className:"text-lg font-medium",children:re==null?void 0:re.name}),S.jsx(Pn,{onClick:()=>{m(fW({id:re==null?void 0:re.id,price:re==null?void 0:re.cost}))},size:"sm",className:"h-7 bg-sky-700",children:u.guide===(re==null?void 0:re.id)?"Remove":"Select"})]}),S.jsxs("p",{className:"text-sm text-gray-500",children:["Email : ",re==null?void 0:re.email]}),S.jsxs("p",{className:"text-sm text-gray-500",children:["Phone : ",re==null?void 0:re.contact]}),S.jsxs("p",{className:"text-sm text-gray-500",children:["Price : ",re==null?void 0:re.cost]}),S.jsxs("p",{className:"text-sm text-gray-500",children:["Experience : ",re==null?void 0:re.experience]}),S.jsxs("p",{className:"text-sm text-gray-500",children:["Rating : ",re==null?void 0:re.ratings]}),S.jsxs("p",{className:"text-sm text-gray-500",children:["Description : ",re==null?void 0:re.description]})]},xe))})}),S.jsxs(tce,{open:O,onOpenChange:F,className:"sticky bottom-2 mt-5 w-full max-w-xl rounded-md border border-gray-300 bg-white px-4 shadow-sm drop-shadow-xl",children:[S.jsx(nce,{asChild:!0,children:S.jsxs(Pn,{variant:"ghost",size:"sm",className:"absolute end-1 top-1 rounded-full",children:[S.jsx(tZ,{className:"h-4 w-4"}),S.jsx("span",{className:"sr-only",children:"Toggle"})]})}),S.jsx("h2",{className:"my-2 font-medium",children:"Budget Details (LKR - Approx.)"}),S.jsxs("div",{className:"mb-2 w-full",children:[S.jsxs(rce,{children:[S.jsxs("div",{className:"flex items-center justify-between text-sm",children:[S.jsx("h3",{className:"",children:"Foods"}),S.jsx("p",{className:"",children:(r.people*1e3*r.days).toFixed(2)})]}),S.jsxs("div",{className:"flex items-center justify-between text-sm",children:[S.jsx("h3",{className:"",children:"Accommodations"}),S.jsx("p",{className:"",children:te().toFixed(2)})]}),S.jsxs("div",{className:"flex items-center justify-between border-b-[1.5px] border-dashed border-gray-600 pb-2 text-sm",children:[S.jsx("h3",{className:"",children:"Guides"}),S.jsx("p",{className:"",children:Q().toFixed(2)})]})]}),S.jsxs("div",{className:"mt-2 flex items-center justify-between border-gray-400 text-sm font-medium",children:[S.jsx("h3",{className:"",children:"Total"}),S.jsx("p",{className:"",children:ee().toFixed(2)})]}),S.jsxs("div",{className:"flex items-center justify-between text-sm font-medium",children:[S.jsx("h3",{className:"",children:"Your Budget"}),S.jsx("p",{className:"",children:r.budget.toFixed(2)})]}),S.jsxs("div",{className:"flex items-center justify-between text-sm font-medium",children:[S.jsx("h3",{className:"",children:"Remaining"}),S.jsx("p",{className:ee()>r.budget?"text-red-500":"text-green-500",children:(r.budget-ee()).toFixed(2)})]}),S.jsxs("div",{className:"flex gap-x-2",children:[S.jsx(Pn,{onClick:()=>e(2),className:"mt-4 w-full rounded-md bg-gray-700 px-4 py-2 text-white",children:"Back"}),t&&S.jsx(Pn,{onClick:U,className:"mt-4 w-full rounded-md bg-sky-700 px-4 py-2 text-white",children:"Save Trip"})]})]})]})]})},sce=()=>{const[e,t]=W.useState(1);return S.jsxs("div",{className:"flex min-h-screen w-full flex-col items-center",children:[S.jsx(ko,{}),S.jsxs("section",{className:"mt-20 w-full px-4 py-8 xl:container",children:[S.jsx("div",{className:"mb-8 flex justify-center space-x-16",children:[1,2,3].map(r=>S.jsx("div",{className:`relative flex h-10 w-10 items-center justify-center rounded-full text-xl font-semibold ${r!==3&&"after:absolute after:start-full after:h-1 after:w-16"} ${e>=r?"bg-sky-700 text-white":"bg-gray-300"} ${e>=r+1?"after:bg-sky-700":"after:bg-gray-300"}`,children:r},r))}),S.jsxs("h1",{className:"mb-8 text-center text-2xl font-medium md:text-3xl",children:[e===1&&S.jsx("span",{children:"Get Started"}),e===2&&S.jsx("span",{children:"Destinations"}),e===3&&S.jsx("span",{children:"Summery"})]}),e===1&&S.jsx(Wle,{setCurrentStep:t}),e===2&&S.jsx(Ule,{setCurrentStep:t}),e===3&&S.jsx(ice,{setCurrentStep:t})]}),S.jsx("div",{className:"flex-grow"}),S.jsx(Ro,{})]})},oce=()=>{const[e,t]=W.useState(!1);W.useEffect(()=>{const o=()=>{window.scrollY>500?t(!0):t(!1)};return window.addEventListener("scroll",o),()=>{window.removeEventListener("scroll",o)}},[]);const r=()=>{e&&window.scrollTo({top:0,behavior:"smooth"})};return S.jsxs("button",{className:`fixed right-3 z-[999] flex h-10 w-10 items-center justify-center rounded-full bg-sky-700 text-white outline-none backdrop-blur-lg backdrop-filter duration-200 ease-in bottom-4 ${e?"scale-100":"scale-0"}`,onClick:r,children:[S.jsx(Fle,{className:"h-6 w-6"}),S.jsx("span",{className:"sr-only",children:"Back to top"})]})},ace=()=>{const[e]=u2(),[t,r]=W.useState(!1),[o,u]=W.useState(!1),[m,_]=W.useState(""),[b,s]=W.useState(!1),k=e.get("verify"),O=W.useCallback(async()=>{let F=new FormData;F.append("code",k),s(!0),await Jt.post("/verify_email",F).then(({data:q})=>{q.status===200&&(r(!0),u(!1))}).catch(q=>{var H,J;u(!0),r(!1),(J=(H=q==null?void 0:q.response)==null?void 0:H.data)!=null&&J.message?_(q.response.data.message):_("Something went wrong. Please try again.")}).finally(()=>{s(!1)})},[k]);return W.useEffect(()=>{k!==""&&k!==null?O():s(!1)},[k,O]),S.jsxs("div",{className:"flex min-h-screen flex-col",children:[S.jsx(ko,{}),S.jsx("div",{className:"flex-grow"}),S.jsxs("section",{className:"container mx-auto mt-20 flex flex-col items-center justify-center px-4 py-8",children:[(k===""||k===null)&&S.jsx("p",{className:"font-Poppins text-lg",children:"Verification code is empty."}),b&&S.jsx("p",{className:"font-Poppins text-lg",children:"Loading..."}),t&&!b&&S.jsx(lce,{}),o&&!b&&S.jsx(cce,{errorMessage:m})]}),S.jsx("div",{className:"flex-grow"}),S.jsx(Ro,{})]})},lce=()=>S.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[S.jsx(GF,{size:72,className:"inline-block text-emerald-600"}),S.jsx("p",{className:"my-5 font-Poppins text-lg",children:"Your Account has been confirmed successfully. Thank you!"}),S.jsx(ui,{to:"/login",className:"w-fit rounded-md bg-sky-600 px-20 py-1.5 text-white hover:bg-sky-700",children:"Login"})]}),cce=({errorMessage:e})=>S.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[S.jsx(jle,{size:72,className:"inline-block text-red-600"}),S.jsx("p",{className:"mb-5 font-Poppins text-lg",children:e||"Something went wrong. Please try again."}),S.jsx(ui,{to:"/",className:"w-fit rounded-md bg-sky-600 px-20 py-1.5 text-white hover:bg-sky-700",children:"Home"})]}),uce=()=>{const[e,t]=W.useState({email:""}),[r,o]=W.useState({email:""}),[u,m]=W.useState(!1),_=k=>k.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(k.email)?!0:(o(O=>({...O,email:"Invalid email"})),!1):(o(O=>({...O,email:"Email is required"})),!1),b=k=>{t(O=>({...O,[k.target.name]:k.target.value})),o(O=>({...O,[k.target.name]:""}))},s=async k=>{if(k.preventDefault(),!_(e))return;m(!0),o({email:""});const O=new FormData;Object.keys(e).forEach(F=>O.append(F,e[F])),await Jt.post("/forgot_password",O).then(({data:F})=>{fi(F.message)}).catch(F=>{const q=F.response.data;if(F.response.status===500)return Mn(q.message);o(H=>({...H,[q==null?void 0:q.property]:q.message}))}).finally(()=>{m(!1)})};return S.jsxs("div",{className:"flex min-h-screen flex-col",children:[S.jsx(ko,{}),S.jsx("div",{className:"flex-grow"}),S.jsx("section",{className:"container mx-auto mt-20 px-4 py-8",children:S.jsxs("div",{className:"flex w-full flex-col gap-5 rounded-md border border-gray-300/60 bg-white shadow-sm drop-shadow-xl lg:flex-row",children:[S.jsxs("form",{onSubmit:s,onChange:b,className:"flex w-full flex-col items-center justify-center p-6 lg:w-1/2",children:[S.jsx("h1",{className:"mb-1 w-full text-2xl font-medium text-gray-800",children:"Forgot Password"}),S.jsx("p",{className:"mb-3 w-full text-xs text-gray-600",children:"Enter your email address to reset your password"}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"email",children:"Email"}),S.jsx(bn,{id:"email",name:"email",type:"email",maxLength:"50",placeholder:"john@example.com",className:"w-full border-gray-400/80 p-2"}),r.email&&S.jsx("p",{className:"text-sm text-red-500",children:r.email})]}),S.jsx(Pn,{disabled:u,className:"mt-4 w-full max-w-lg rounded-md bg-sky-700 px-4 py-2 text-white",children:u?"Loading...":"Send Reset Link"}),S.jsxs("p",{className:"mt-4 text-sm text-gray-600",children:["Try to login?"," ",S.jsx(ui,{to:"/sign-up",className:"ms-1 text-sky-700 hover:underline",children:"Login"})]})]}),S.jsx("div",{className:"hidden min-h-[30rem] w-full items-center justify-center lg:flex lg:w-1/2",children:S.jsx("img",{src:"/images/slide01.jpg",alt:"contact us",className:"h-full w-full rounded-r-md object-cover"})})]})}),S.jsx("div",{className:"flex-grow"}),S.jsx(Ro,{})]})},u4={password:"",confirmPassword:""},d4={password:"",confirmPassword:""},dce=()=>{const[e]=u2(),[t,r]=W.useState(d4),[o,u]=W.useState(u4),[m,_]=W.useState({verify:!0,reset:!1}),[b,s]=W.useState(!1),[k,O]=W.useState(""),F=yc(),q=e.get("verify"),H=Q=>Q.password?Q.password.length<8?(u(ee=>({...ee,password:"Password must be at least 8 characters"})),!1):Q.password!==Q.confirmPassword?(u(ee=>({...ee,confirmPassword:"Passwords do not match"})),!1):!0:(u(ee=>({...ee,password:"Password is required"})),!1),J=Q=>{r(ee=>({...ee,[Q.target.name]:Q.target.value})),u(ee=>({...ee,[Q.target.name]:""}))},U=W.useCallback(async()=>{let Q=new FormData;Q.append("code",q),_(ee=>({...ee,verify:!0})),await Jt.post("/verify_reset_password",Q).then(({data:ee})=>{ee.status===200&&(s(!0),O(ee.email))}).catch(ee=>{Mn(ee.response.data.message||"Something went wrong. Please try again.")}).finally(()=>{_(ee=>({...ee,verify:!1}))})},[q]),te=async Q=>{if(Q.preventDefault(),!H(t))return;_(re=>({...re,reset:!0})),u(u4);const ee=new FormData;Object.keys(t).forEach(re=>ee.append(re,t[re])),ee.append("code",q),await Jt.post("/reset_password",ee).then(({data:re})=>{fi(re.message),r(d4),F("/login")}).catch(re=>{const xe=re.response.data;if(re.response.status===500)return Mn(xe.message);u(Ee=>({...Ee,[xe==null?void 0:xe.property]:xe.message}))}).finally(()=>{_(re=>({...re,reset:!1}))})};return W.useEffect(()=>{q!==""&&q!==null?U():_(Q=>({...Q,verify:!1}))},[q,U]),S.jsxs("div",{className:"flex min-h-screen flex-col",children:[S.jsx(ko,{}),S.jsx("div",{className:"flex-grow"}),S.jsx("section",{className:"container mx-auto mt-20 px-4 py-8",children:S.jsxs("div",{className:"flex w-full flex-col gap-5 rounded-md border border-gray-300/60 bg-white shadow-sm drop-shadow-xl lg:flex-row",children:[b&&S.jsxs("form",{onSubmit:te,onChange:J,className:"flex w-full flex-col items-center justify-center p-6 lg:w-4/5 xl:w-1/2",children:[S.jsx("h1",{className:"mb-1 w-full text-2xl font-medium text-gray-800",children:"Reset Password"}),S.jsxs("p",{className:"mb-3 w-full text-xs text-gray-600",children:["Enter your new password to reset your account associated with"," ",k]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"password",children:"Password"}),S.jsx(bn,{id:"password",name:"password",type:"password",maxLength:"100",placeholder:"********",className:"w-full border-gray-400/80 p-2"}),o.password&&S.jsx("p",{className:"text-sm text-red-500",children:o.password})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"confirmPassword",children:"Confirm Password"}),S.jsx(bn,{id:"confirmPassword",name:"confirmPassword",type:"password",maxLength:"100",placeholder:"********",className:"w-full border-gray-400/80 p-2"}),o.confirmPassword&&S.jsx("p",{className:"text-sm text-red-500",children:o.confirmPassword})]}),S.jsx(Pn,{disabled:m.reset,className:"mt-4 w-full max-w-lg rounded-md bg-sky-700 px-4 py-2 text-white",children:m.reset?"Waiting...":"Reset Password"}),S.jsxs("p",{className:"mt-4 text-sm text-gray-600",children:["Try to sign in?",S.jsx(ui,{to:"/login",className:"ms-1 text-sky-700 hover:underline",children:"Login"})]})]}),!b&&S.jsxs("div",{className:"flex flex-col items-center justify-center p-6 lg:w-4/5 xl:w-1/2",children:[(q===""||q===null)&&S.jsx("p",{className:"font-Poppins text-lg",children:"Verification code is empty."}),m.verify&&S.jsx("p",{className:"font-Poppins text-lg",children:"Loading..."})]}),S.jsx("div",{className:"hidden min-h-[35rem] w-full items-center justify-center lg:flex lg:w-1/2",children:S.jsx("img",{src:"/images/slide04.jpeg",alt:"contact us",className:"h-full w-full rounded-r-md object-cover"})})]})}),S.jsx("div",{className:"flex-grow"}),S.jsx(Ro,{})]})};function Zh(e){return Kr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none"},child:[{tag:"path",attr:{d:"M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z",fill:"currentColor"},child:[]}]})(e)}function hce(e){return Kr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none"},child:[{tag:"path",attr:{d:"M8.51428 20H4.51428C3.40971 20 2.51428 19.1046 2.51428 18V6C2.51428 4.89543 3.40971 4 4.51428 4H8.51428V6H4.51428V18H8.51428V20Z",fill:"currentColor"},child:[]},{tag:"path",attr:{d:"M13.8418 17.385L15.262 15.9768L11.3428 12.0242L20.4857 12.0242C21.038 12.0242 21.4857 11.5765 21.4857 11.0242C21.4857 10.4719 21.038 10.0242 20.4857 10.0242L11.3236 10.0242L15.304 6.0774L13.8958 4.6572L7.5049 10.9941L13.8418 17.385Z",fill:"currentColor"},child:[]}]})(e)}const r_=[{value:"hotel",label:"Hotel"},{value:"kabana",label:"Kabana"},{value:"mountain hotel",label:"Mountain hotel"},{value:"camp",label:"Camp"},{value:"cottage",label:"Cottage"}],e8=[{value:"wifi",label:"Wifi"},{value:"parking",label:"Parking"},{value:"restaurant",label:"Restaurant"},{value:"bar",label:"Bar"},{value:"swimming pool",label:"Swimming pool"},{value:"gym",label:"Gym"},{value:"spa",label:"Spa"},{value:"pets allowed",label:"Pets allowed"},{value:"room service",label:"Room service"},{value:"laundry",label:"Laundry"},{value:"air conditioning",label:"Air conditioning"},{value:"heating",label:"Heating"},{value:"tv",label:"TV"},{value:"telephone",label:"Telephone"},{value:"minibar",label:"Minibar"},{value:"safe",label:"Safe"},{value:"hairdryer",label:"Hairdryer"},{value:"iron",label:"Iron"},{value:"desk",label:"Desk"},{value:"seating area",label:"Seating area"},{value:"balcony",label:"Balcony"},{value:"patio",label:"Patio"},{value:"view",label:"View"},{value:"private bathroom",label:"Private bathroom"},{value:"bathtub",label:"Bathtub"},{value:"shower",label:"Shower"},{value:"bidet",label:"Bidet"},{value:"free toiletries",label:"Free toiletries"}],fce=()=>{const[e,t]=W.useState(""),[r,o]=W.useState(!1),[u,m]=W.useState([]),_=async()=>{await Jt.get("/accommodation").then(({data:b})=>{m(b==null?void 0:b.accommodations)}).catch(()=>{Mn("Failed to load data")})};return W.useEffect(()=>{(async()=>{await Jt.get(`/accommodation?search=${e}`).then(({data:s})=>{m(s==null?void 0:s.accommodations)}).catch(()=>{Mn("Failed to load data")})})()},[e]),W.useEffect(()=>{_()},[]),S.jsxs("div",{className:"flex w-full flex-col items-center gap-5",children:[S.jsx(pce,{isOpen:r,setIsOpen:o,loadData:_}),S.jsxs("section",{className:"container mx-auto mt-10 px-4 py-8",children:[S.jsxs("div",{className:"mb-5 flex flex-col items-center justify-center gap-2 sm:flex-row",children:[S.jsx(bn,{placeholder:"Search accommodations...",className:"max-w-lg border-sky-600/80 !outline-0 !ring-0",value:e,onChange:b=>t(b.target.value)}),S.jsxs(Pn,{onClick:()=>o(!0),className:"w-full max-w-[13rem] bg-sky-600 hover:bg-sky-700",children:[S.jsx(Va,{className:"size-5"}),"Add Accommodation"]})]}),S.jsx("div",{className:"flex w-full justify-center pt-2",children:S.jsx(gce,{items:u,loadData:_})})]})]})},pce=({isOpen:e,setIsOpen:t,loadData:r})=>{const o={name:"",address:"",category:r_[0].value,city:"",website:"",maxGuests:"",price:0,description:"",contactNo:"",facilities:[],image:null},u={name:"",address:"",category:"",city:"",website:"",maxGuests:"",price:"",description:"",contactNo:"",facilities:"",image:""},[m,_]=W.useState(o),[b,s]=W.useState(u),[k,O]=W.useState(!1),F=H=>(Object.keys(H).forEach(U=>{if(!H[U]||H[U]===null)return s(te=>({...te,[U]:`${U} is required`})),!1}),H.description.length>500?(s(U=>({...U,description:"Description length must be less than 500 characters"})),!1):H.image&&H.image.size>1024*1024*2?(s(U=>({...U,image:"Image size must be less than 2MB"})),!1):H.facilities.length?!0:(s(U=>({...U,facilities:"Facilities is required"})),!1)),q=async H=>{if(H.preventDefault(),!F(m))return;O(!0),s(u);const J=new FormData;Object.keys(m).forEach(U=>J.append(U,m[U])),await Jt.post("/accommodation",J).then(({data:U})=>{fi(U.message),_(o),r(),t(!1)}).catch(U=>{const te=U.response.data;if(U.response.status===500)return Mn(te.message);s(Q=>({...Q,[te==null?void 0:te.property]:te.message}))}).finally(()=>{O(!1)})};return S.jsx($a,{open:e,onOpenChange:t,children:S.jsxs(sa,{className:"max-h-[90%] max-w-2xl overflow-y-auto",children:[S.jsxs(oa,{children:[S.jsx(aa,{children:"Add New Accommodation"}),S.jsx(la,{className:"text-xs font-medium",children:"Add new accommodation details."})]}),S.jsxs("form",{onSubmit:q,className:"flex w-full flex-col items-center justify-center",children:[S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"name",children:"Name"}),S.jsx(bn,{id:"name",name:"name",type:"text",maxLength:"50",placeholder:"Galle fort hotel",value:m.name,onChange:H=>_(J=>({...J,name:H.target.value})),className:"w-full border-gray-400/80 p-2"}),b.name&&S.jsx("p",{className:"text-sm text-red-500",children:b.name})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"address",children:"Address"}),S.jsx(bn,{id:"address",name:"address",type:"text",maxLength:"256",placeholder:"Galle fort",value:m.address,onChange:H=>_(J=>({...J,address:H.target.value})),className:"w-full border-gray-400/80 p-2"}),b.address&&S.jsx("p",{className:"text-sm text-red-500",children:b.address})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"category",children:"Category"}),S.jsxs(Ci,{defaultValue:r_[0].value,onValueChange:H=>_(J=>({...J,category:H})),children:[S.jsx(_i,{className:"w-full border-gray-400/80",children:S.jsx(Mi,{placeholder:"Select a category"})}),S.jsx(xi,{children:S.jsx(Pi,{children:r_.map(H=>S.jsx(ii,{value:H.value,children:H.label},H.value))})})]}),b.category&&S.jsx("p",{className:"text-sm text-red-500",children:b.category})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"city",children:"Near City"}),S.jsx(bn,{id:"city",name:"city",type:"text",maxLength:"50",placeholder:"Galle",value:m.city,onChange:H=>_(J=>({...J,city:H.target.value})),className:"w-full border-gray-400/80 p-2"}),b.city&&S.jsx("p",{className:"text-sm text-red-500",children:b.city})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"website",children:"Website"}),S.jsx(bn,{id:"website",name:"website",type:"text",maxLength:"256",placeholder:"https://example.com",value:m.website,onChange:H=>_(J=>({...J,website:H.target.value})),className:"w-full border-gray-400/80 p-2"}),b.website&&S.jsx("p",{className:"text-sm text-red-500",children:b.website})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"max-guest",children:"Max Guest"}),S.jsx(bn,{id:"max-guest",name:"maxGuests",type:"number",maxLength:"50",placeholder:"10",value:m.maxGuests,onChange:H=>_(J=>({...J,maxGuests:H.target.value})),className:"w-full border-gray-400/80 p-2"}),b.maxGuests&&S.jsx("p",{className:"text-sm text-red-500",children:b.maxGuests})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"price",children:"One Night Price (LKR)"}),S.jsx(bn,{id:"price",name:"price",type:"number",maxLength:"50",placeholder:"1000",value:m.price,onChange:H=>_(J=>({...J,price:H.target.value})),className:"w-full border-gray-400/80 p-2"}),b.price&&S.jsx("p",{className:"text-sm text-red-500",children:b.price})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"contact-no",children:"Contact No"}),S.jsx(bn,{id:"contact-no",name:"contactNo",type:"text",maxLength:"50",placeholder:"0712345678",value:m.contactNo,onChange:H=>_(J=>({...J,contactNo:H.target.value})),className:"w-full border-gray-400/80 p-2"}),b.contactNo&&S.jsx("p",{className:"text-sm text-red-500",children:b.contactNo})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"description",children:"Description"}),S.jsx(ca,{id:"description",name:"description",rows:"5",maxLength:"500",placeholder:"Galle fort is a historical fort...",value:m.description,onChange:H=>_(J=>({...J,description:H.target.value})),className:"w-full border-gray-400/80 p-2"}),b.description&&S.jsx("p",{className:"text-sm text-red-500",children:b.description})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"facilities",children:"Facilities"}),S.jsx("div",{className:"my-2 grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-3",children:e8.map(H=>S.jsxs("div",{className:"flex items-center gap-2",children:[S.jsx(qh,{id:H,checked:m.facilities.includes(H.value),onCheckedChange:J=>{_(J?{...m,facilities:[...m.facilities,H.value]}:{...m,facilities:m.facilities.filter(U=>U!==H.value)})}}),S.jsx(jt,{htmlFor:H.value,className:"capitalize",children:H.label})]},H.value))}),b.facilities&&S.jsx("p",{className:"text-sm text-red-500",children:b.facilities})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"location-image",children:"Accommodation Image"}),!m.image&&S.jsxs("label",{htmlFor:"location-image",children:[S.jsx("input",{type:"file",id:"location-image",className:"peer sr-only",accept:"image/*",onChange:H=>{const J=H.target.files[0];_(U=>({...U,image:J}))}}),S.jsx("div",{className:"mt-2 flex h-28 w-28 cursor-pointer items-center justify-center rounded-sm bg-gray-400 p-2 text-white",children:S.jsx(Va,{className:"size-10"})})]}),m.image&&S.jsxs("div",{className:"relative mt-2 h-28 w-28",children:[S.jsx(Zh,{className:"absolute end-1 top-1 size-5 cursor-pointer rounded-full bg-black p-1 text-white",onClick:()=>_(H=>({...H,image:null}))}),S.jsx("img",{src:URL.createObjectURL(m.image),alt:"location",className:"h-28 w-28 rounded-md border border-gray-400/80 object-cover"})]}),b.image&&S.jsx("p",{className:"text-sm text-red-500",children:b.image})]})]}),S.jsx(bl,{children:S.jsx(Pn,{type:"submit",onClick:q,disabled:k,className:"mt-4 w-full max-w-[13rem] rounded-md bg-sky-700 px-4 py-2 text-white",children:k?"Loading...":"Add Accommodation"})})]})})},mce=({id:e,item:t,isOpen:r,setIsOpen:o,loadData:u})=>{const m={name:(t==null?void 0:t.name)||"",address:(t==null?void 0:t.address)||"",category:(t==null?void 0:t.category)||r_[0].value,city:(t==null?void 0:t.city)||"",website:(t==null?void 0:t.website)||"",maxGuests:(t==null?void 0:t.max_guests)||"",price:(t==null?void 0:t.price)||0,contactNo:(t==null?void 0:t.contact_no)||"",description:(t==null?void 0:t.description)||"",facilities:(t==null?void 0:t.facilities.split(","))||[],image:(t==null?void 0:t.image)||""},_={name:"",address:"",category:"",city:"",website:"",maxGuests:"",price:"",contactNo:"",description:"",facilities:"",image:""},[b,s]=W.useState(m),[k,O]=W.useState(_),[F,q]=W.useState(!1),H=U=>(Object.keys(U).forEach(Q=>{if(!U[Q])return O(ee=>({...ee,[Q]:`${Q} is required`})),!1}),U.description.length>500?(O(Q=>({...Q,description:"Description length must be less than 500 characters"})),!1):typeof U.image!="string"&&U.image&&U.image.size>1024*1024*2?(O(Q=>({...Q,image:"Image size must be less than 2MB"})),!1):U.facilities.length?!0:(O(Q=>({...Q,facilities:"Facilities is required"})),!1)),J=async U=>{if(U.preventDefault(),!H(b))return;q(!0),O(_);const te=new FormData;Object.keys(b).forEach(Q=>te.append(Q,b[Q])),te.append("type","UPDATE"),te.append("id",e),await Jt.post("/accommodation",te).then(({data:Q})=>{fi(Q.message),s(m),u(),o(!1)}).catch(Q=>{const ee=Q.response.data;if(Q.response.status===500)return Mn(ee.message);O(re=>({...re,[ee==null?void 0:ee.property]:ee.message}))}).finally(()=>{q(!1)})};return W.useEffect(()=>{t&&s({name:t==null?void 0:t.name,address:t==null?void 0:t.address,category:t==null?void 0:t.category,city:t==null?void 0:t.city,website:t==null?void 0:t.website,maxGuests:t==null?void 0:t.max_guests,price:t==null?void 0:t.price,contactNo:t==null?void 0:t.contact_no,description:t==null?void 0:t.description,facilities:t==null?void 0:t.facilities.split(","),image:t==null?void 0:t.image})},[t]),S.jsx($a,{open:r,onOpenChange:o,children:S.jsxs(sa,{className:"max-h-[90%] max-w-2xl overflow-y-auto",children:[S.jsxs(oa,{children:[S.jsx(aa,{children:"Update Accommodation"}),S.jsx(la,{className:"text-xs font-medium",children:"Update accommodation details."})]}),S.jsxs("form",{onSubmit:J,className:"flex w-full flex-col items-center justify-center",children:[S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"name",children:"Name"}),S.jsx(bn,{id:"name",name:"name",type:"text",maxLength:"50",placeholder:"Galle fort hotel",value:b.name,onChange:U=>s(te=>({...te,name:U.target.value})),className:"w-full border-gray-400/80 p-2"}),k.name&&S.jsx("p",{className:"text-sm text-red-500",children:k.name})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"address",children:"Address"}),S.jsx(bn,{id:"address",name:"address",type:"text",maxLength:"256",placeholder:"Galle fort",value:b.address,onChange:U=>s(te=>({...te,address:U.target.value})),className:"w-full border-gray-400/80 p-2"}),k.address&&S.jsx("p",{className:"text-sm text-red-500",children:k.address})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"category",children:"Category"}),S.jsxs(Ci,{value:b.category,onValueChange:U=>s(te=>({...te,category:U})),children:[S.jsx(_i,{className:"w-full border-gray-400/80",children:S.jsx(Mi,{placeholder:"Select a category"})}),S.jsx(xi,{children:S.jsx(Pi,{children:r_.map(U=>S.jsx(ii,{value:U.value,children:U.label},U.value))})})]}),k.category&&S.jsx("p",{className:"text-sm text-red-500",children:k.category})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"city",children:"Near City"}),S.jsx(bn,{id:"city",name:"city",type:"text",maxLength:"50",placeholder:"Galle",value:b.city,onChange:U=>s(te=>({...te,city:U.target.value})),className:"w-full border-gray-400/80 p-2"}),k.city&&S.jsx("p",{className:"text-sm text-red-500",children:k.city})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"website",children:"Website"}),S.jsx(bn,{id:"website",name:"website",type:"text",maxLength:"256",placeholder:"https://example.com",value:b.website,onChange:U=>s(te=>({...te,website:U.target.value})),className:"w-full border-gray-400/80 p-2"}),k.website&&S.jsx("p",{className:"text-sm text-red-500",children:k.website})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"max-guest",children:"Max Guest"}),S.jsx(bn,{id:"max-guest",name:"maxGuests",type:"number",maxLength:"50",placeholder:"10",value:b.maxGuests,onChange:U=>s(te=>({...te,maxGuests:U.target.value})),className:"w-full border-gray-400/80 p-2"}),k.maxGuests&&S.jsx("p",{className:"text-sm text-red-500",children:k.maxGuests})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"price",children:"One Night Price (LKR)"}),S.jsx(bn,{id:"price",name:"price",type:"number",maxLength:"50",placeholder:"1000",value:b.price,onChange:U=>s(te=>({...te,price:U.target.value})),className:"w-full border-gray-400/80 p-2"}),k.price&&S.jsx("p",{className:"text-sm text-red-500",children:k.price})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"contact-no",children:"Contact No"}),S.jsx(bn,{id:"contact-no",name:"contactNo",type:"text",maxLength:"50",placeholder:"0712345678",value:b.contactNo,onChange:U=>s(te=>({...te,contactNo:U.target.value})),className:"w-full border-gray-400/80 p-2"}),k.contactNo&&S.jsx("p",{className:"text-sm text-red-500",children:k.contactNo})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"description",children:"Description"}),S.jsx(ca,{id:"description",name:"description",rows:"5",maxLength:"500",placeholder:"Galle fort is a historical fort...",value:b.description,onChange:U=>s(te=>({...te,description:U.target.value})),className:"w-full border-gray-400/80 p-2"}),k.description&&S.jsx("p",{className:"text-sm text-red-500",children:k.description})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"facilities",children:"Facilities"}),S.jsx("div",{className:"my-2 grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-3",children:e8.map(U=>S.jsxs("div",{className:"flex items-center gap-2",children:[S.jsx(qh,{id:U,checked:b.facilities.includes(U.value),onCheckedChange:te=>{s(te?{...b,facilities:[...b.facilities,U.value]}:{...b,facilities:b.facilities.filter(Q=>Q!==U.value)})}}),S.jsx(jt,{htmlFor:U.value,className:"capitalize",children:U.label})]},U.value))}),k.facilities&&S.jsx("p",{className:"text-sm text-red-500",children:k.facilities})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"location-image",children:"Accommodation Image"}),!b.image&&S.jsxs("label",{htmlFor:"location-image",children:[S.jsx("input",{type:"file",id:"location-image",className:"peer sr-only",accept:"image/*",onChange:U=>{const te=U.target.files[0];s(Q=>({...Q,image:te}))}}),S.jsx("div",{className:"mt-2 flex h-28 w-28 cursor-pointer items-center justify-center rounded-sm bg-gray-400 p-2 text-white",children:S.jsx(Va,{className:"size-10"})})]}),b.image&&S.jsxs("div",{className:"relative mt-2 h-28 w-28",children:[S.jsx(Zh,{className:"absolute end-1 top-1 size-5 cursor-pointer rounded-full bg-black p-1 text-white",onClick:()=>s(U=>({...U,image:null}))}),S.jsx("img",{src:typeof b.image=="string"?"http://localhost:8000/"+(t==null?void 0:t.image)+`?${new Date().getSeconds()}`:URL.createObjectURL(b.image),alt:"location",className:"h-28 w-28 rounded-md border border-gray-400/80 object-cover"})]}),k.image&&S.jsx("p",{className:"text-sm text-red-500",children:k.image})]})]}),S.jsx(bl,{children:S.jsx(Pn,{type:"submit",onClick:J,disabled:F,className:"mt-4 w-full max-w-[13rem] rounded-md bg-sky-700 px-4 py-2 text-white",children:F?"Loading...":"Update Accommodation"})})]})})},gce=({items:e,loadData:t})=>{const[r,o]=W.useState(!1),[u,m]=W.useState(null);return e!=null&&e.length?S.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4",children:[S.jsx(mce,{isOpen:r,setIsOpen:o,item:u,id:u==null?void 0:u.id,loadData:t}),e==null?void 0:e.map(_=>{var b;return S.jsxs("div",{className:"w-full max-w-md rounded-lg bg-white shadow-md drop-shadow-xl",children:[S.jsx("img",{src:"http://localhost:8000/"+(_==null?void 0:_.image)+`?${new Date().getSeconds()}`,alt:"gallery",className:"h-48 w-full rounded-lg object-cover"}),S.jsx("div",{onClick:()=>{m(_),o(!0)},className:"absolute right-2 top-1 h-8 w-8 cursor-pointer rounded-full bg-white p-2 text-sky-700",children:S.jsx(j_,{})}),S.jsxs("div",{className:"p-4",children:[S.jsxs("h2",{className:"line-clamp-2 font-medium",children:[_==null?void 0:_.name,S.jsx("span",{className:"mb-1 ms-2 w-fit rounded bg-fuchsia-700 px-2 py-0.5 text-xs text-white",children:_==null?void 0:_.category})]}),S.jsxs("p",{className:"flex items-end justify-between gap-x-1 text-xs capitalize text-gray-600",children:[S.jsxs("span",{className:"flex items-end gap-x-1",children:[S.jsx(uc,{className:"-ms-1 size-5 text-red-600"}),_==null?void 0:_.city]}),S.jsxs("span",{className:"",children:["Max Guests: ",_==null?void 0:_.max_guests]})]}),S.jsxs("p",{className:"mt-1 text-xs text-gray-700",children:["Contact No: ",_==null?void 0:_.contact_no]}),S.jsxs("p",{className:"mt-1 text-xs text-gray-700",children:["One Night Price: LKR ",(b=_==null?void 0:_.price)==null?void 0:b.toFixed(2)]}),S.jsxs("p",{className:"mt-1 text-xs text-gray-700",children:["Website:"," ",S.jsx(ui,{to:_==null?void 0:_.website,className:"text-sky-600 underline",children:_==null?void 0:_.website})]}),S.jsx("div",{className:"mt-2 flex flex-wrap gap-x-3 gap-y-2",children:_==null?void 0:_.facilities.split(",").map((s,k)=>S.jsxs("div",{className:"flex items-center gap-1 text-xs capitalize text-gray-700",children:[S.jsx(qh,{checked:!0,readOnly:!0,className:"!border-none !bg-emerald-600 p-[0.3px]"}),S.jsx("span",{children:s})]},k))}),S.jsx("p",{className:"mt-2 line-clamp-4 text-sm text-gray-700",children:_==null?void 0:_.description})]})]},_==null?void 0:_.id)})]}):S.jsx("div",{className:"flex w-full items-center justify-center pt-5",children:S.jsx("h1",{className:"text-gray-600",children:"No accommodations found"})})},yce=()=>{const[e,t]=W.useState([]),r=async()=>{await Jt.get("/statistics").then(({data:o})=>{t(o)}).catch(()=>{Mn("Failed to fetch statistics")})};return W.useEffect(()=>{r()},[]),S.jsxs("div",{className:"flex w-full flex-col items-center gap-5",children:[S.jsx("div",{className:"z-[1] mt-8 flex w-full max-w-xl flex-col gap-4 md:max-w-5xl md:flex-row md:items-center md:justify-between",children:["traveler","guide","accommodation"].map((o,u)=>S.jsxs("div",{className:"flex w-full flex-col items-center justify-center rounded-md border border-gray-700/20 bg-white p-4 shadow-sm drop-shadow-lg md:w-1/3",children:[S.jsxs("h2",{className:"text-lg font-semibold",children:["Total ",o,"s"]}),S.jsx("p",{className:"text-3xl font-bold",children:e[`total_${o}s`]}),S.jsxs("p",{className:"mt-1 w-full border-t border-sky-500/50 pt-2 text-center",children:[S.jsx("span",{className:"me-1 text-sm font-semibold",children:"Monthly Gain:"}),S.jsxs("span",{className:"text-sm font-semibold capitalize text-green-500",children:[e[`monthly_${o}s_gain`]," ",o,"s"]})]})]},u))}),S.jsxs("div",{className:"flex w-full max-w-xl flex-col gap-3 md:max-w-5xl md:flex-row",children:[S.jsxs("div",{className:"w-full rounded-md border border-gray-700/20 bg-white p-4",children:[S.jsxs("div",{className:"flex flex-col items-center",children:[S.jsx("h2",{className:"mt-8 text-lg font-semibold",children:"Total Locations"}),S.jsx("p",{className:"text-4xl font-bold",children:e.total_locations})]}),S.jsx("div",{className:"",children:S.jsxs("div",{className:"mt-8 flex w-full flex-col items-center gap-5",children:[S.jsx("h2",{className:"text-lg font-semibold",children:"Locations by Province"}),e.locations_by_province&&e.locations_by_province.map(({province:o,total_locations:u},m)=>S.jsxs("div",{className:"flex w-full items-center justify-between",children:[S.jsx("p",{className:"justify-between text-sm text-gray-600",children:no.find(_=>_.value===o).label}),S.jsx("div",{className:"mx-3 flex-grow border border-dashed border-gray-600"}),S.jsxs("p",{className:"flex",children:[u," location",u>1&&"s"]})]},m))]})})]}),S.jsxs("div",{className:"w-full rounded-md border border-gray-700/20 bg-white p-4",children:[S.jsxs("div",{className:"flex flex-col items-center",children:[S.jsx("h2",{className:"mt-8 text-lg font-semibold",children:"Total Events"}),S.jsx("p",{className:"text-4xl font-bold",children:e.total_events})]}),S.jsx("div",{className:"",children:S.jsxs("div",{className:"mt-8 flex w-full flex-col items-center gap-5",children:[S.jsx("h2",{className:"text-lg font-semibold",children:"Events by Province"}),e.events_by_province&&e.events_by_province.map(({province:o,total_events:u},m)=>S.jsxs("div",{className:"flex w-full items-center justify-between",children:[S.jsx("p",{className:"justify-between text-sm text-gray-600",children:no.find(_=>_.value===o).label}),S.jsx("div",{className:"mx-3 flex-grow border border-dashed border-gray-600"}),S.jsxs("p",{className:"flex",children:[u," location",u>1&&"s"]})]},m))]})})]})]})]})},lE=[{label:"0-1 years",value:"0-1 years"},{label:"1-2 years",value:"1-2 years"},{label:"2-5 years",value:"2-5 years"},{label:"5-10 years",value:"5-10 years"},{label:"10+ years",value:"10+ years"}],_ce=()=>{var J;const{user:e}=qi(U=>U.user),{guide:t}=e,r=xl(),o={license:(t==null?void 0:t.license)||"",description:(t==null?void 0:t.description)||"",cost:(t==null?void 0:t.cost)||0,languages:((J=t==null?void 0:t.languages)==null?void 0:J.split(","))||[],contact:(t==null?void 0:t.contact)||"",experience:(t==null?void 0:t.experience)||lE[0].value},u={license:"",description:"",cost:"",languages:"",contact:"",experience:""},[m,_]=W.useState(o),[b,s]=W.useState(u),[k,O]=W.useState(!1),F=U=>(Object.keys(U).forEach(Q=>{if(!U[Q])return s(ee=>({...ee,[Q]:`${Q} is required`})),!1}),U.description.length>500?(s(Q=>({...Q,description:"Description length must be less than 500 characters"})),!1):U.languages.length===0?(s(Q=>({...Q,languages:"At least one language is required"})),!1):!0),q=async()=>{await Jt.get("/authorize").then(async({data:U})=>{U!=null&&U.user&&r(fm(U==null?void 0:U.user))}).catch(()=>{r(nm())})},H=async U=>{if(U.preventDefault(),!F(m))return;O(!0),s(u);const te=new FormData;Object.keys(m).forEach(Q=>te.append(Q,m[Q])),(t==null?void 0:t.id)!==null&&te.append("type","UPDATE"),await Jt.post("/guide",te).then(async({data:Q})=>{fi(Q.message),await q()}).catch(Q=>{const ee=Q.response.data;if(Q.response.status===500)return Mn(ee.message);s(re=>({...re,[ee==null?void 0:ee.property]:ee.message}))}).finally(()=>{O(!1)})};return S.jsxs("div",{className:"flex w-full flex-col items-center gap-5",children:[(t==null?void 0:t.id)===null&&S.jsx("div",{className:"mt-5 flex w-full max-w-3xl flex-col items-center rounded-md bg-red-500 px-5 py-2",children:S.jsx("p",{className:"text-sm font-medium text-white",children:"You have not provided your guide details yet."})}),t!==null&&(t==null?void 0:t.is_verified)===0&&S.jsx("div",{className:"mt-5 flex w-full max-w-3xl flex-col items-center rounded-md bg-amber-500 px-5 py-2",children:S.jsx("p",{className:"text-sm font-medium text-white",children:"Your guide details are not verified yet."})}),S.jsxs("form",{onSubmit:H,className:"mt-8 flex w-full max-w-3xl flex-col items-center justify-center",children:[S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"license",children:"Guide License"}),S.jsx(bn,{id:"license",name:"license",type:"text",maxLength:"256",placeholder:"N-31005",value:m.license,onChange:U=>_(te=>({...te,license:U.target.value})),className:"w-full border-gray-400/80 p-2"}),b.license&&S.jsx("p",{className:"text-sm text-red-500",children:b.license})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"cost",children:"Cost for Day (LKR)"}),S.jsx(bn,{id:"cost",name:"cost",type:"number",placeholder:"1000",value:m.cost,onChange:U=>_(te=>({...te,cost:U.target.value})),className:"w-full border-gray-400/80 p-2"}),b.cost&&S.jsx("p",{className:"text-sm text-red-500",children:b.cost})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"experience",children:"Experience"}),S.jsxs(Ci,{defaultValue:lE[0].value,onValueChange:U=>_(te=>({...te,experience:U})),children:[S.jsx(_i,{className:"w-full border-gray-400/80",children:S.jsx(Mi,{placeholder:"Select a experience"})}),S.jsx(xi,{children:S.jsx(Pi,{children:lE.map(U=>S.jsx(ii,{value:U.value,children:U.label},U.value))})})]}),b.experience&&S.jsx("p",{className:"text-sm text-red-500",children:b.experience})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"contact",children:"Contact Number"}),S.jsx(bn,{id:"contact",name:"contact",type:"text",placeholder:"0712345678",value:m.contact,onChange:U=>_(te=>({...te,contact:U.target.value})),className:"w-full border-gray-400/80 p-2"}),b.contact&&S.jsx("p",{className:"text-sm text-red-500",children:b.contact})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"languages",children:"Languages You Can Guide In (Select all that apply)"}),S.jsx("div",{className:"my-2 grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-3",children:js.languages.map(U=>S.jsxs("div",{className:"flex items-center gap-2",children:[S.jsx(qh,{id:U.value,checked:m.languages.includes(U.value),onCheckedChange:te=>{_(te?{...m,languages:[...m.languages,U.value]}:{...m,languages:m.languages.filter(Q=>Q!==U.value)})}}),S.jsx(jt,{htmlFor:U.value,className:"capitalize",children:U.label})]},U.value))}),b.languages&&S.jsx("p",{className:"text-sm text-red-500",children:b.languages})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"description",children:"Description"}),S.jsx(ca,{id:"description",name:"description",rows:"5",maxLength:"500",placeholder:"I am a professional guide with 5 years of experience...",value:m.description,onChange:U=>_(te=>({...te,description:U.target.value})),className:"w-full border-gray-400/80 p-2"}),b.description&&S.jsx("p",{className:"text-sm text-red-500",children:b.description})]}),S.jsx(Pn,{type:"submit",className:"mt-5 w-full max-w-sm rounded-md bg-primary p-2 text-white",disabled:k,children:k?"Loading...":"Submit"})]})]})};function Kb(e){return Kr({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M401.4 224h-214l83-79.4c11.9-12.5 11.9-32.7 0-45.2s-31.2-12.5-43.2 0L89 233.4c-6 5.8-9 13.7-9 22.4v.4c0 8.7 3 16.6 9 22.4l138.1 134c12 12.5 31.3 12.5 43.2 0 11.9-12.5 11.9-32.7 0-45.2l-83-79.4h214c16.9 0 30.6-14.3 30.6-32 .1-18-13.6-32-30.5-32z"},child:[]}]})(e)}function xce(e){return Kr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M13 8V16C13 17.6569 11.6569 19 10 19H7.82929C7.41746 20.1652 6.30622 21 5 21C3.34315 21 2 19.6569 2 18C2 16.3431 3.34315 15 5 15C6.30622 15 7.41746 15.8348 7.82929 17H10C10.5523 17 11 16.5523 11 16V8C11 6.34315 12.3431 5 14 5H17V2L22 6L17 10V7H14C13.4477 7 13 7.44772 13 8Z"},child:[]}]})(e)}function vce(e){return Kr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4H21V6H3V4ZM3 11H15V13H3V11ZM3 18H21V20H3V18Z"},child:[]}]})(e)}const ni={Traveler:"TRAVELER",Guide:"GUIDE",Accommodations:"ACCOMMODATIONS",Admin:"ADMIN"},Jb=({urls:e})=>{const{user:t}=qi(J=>J.user),r=(t==null?void 0:t.role)===ni.Admin||!1,[o,u]=W.useState(!1),[m,_]=W.useState(!1),b=yc(),s=xl(),k=ad(),{pathname:O}=k,F=W.useRef(),q=()=>{Jt.post("/logout").then(()=>{s(nm()),b("/login")})},H=async J=>{const U=J.target.files[0],te=new FormData;te.append("profileImage",U),te.append("type","profileImage"),await Jt.post("/update_account",te).then(({data:Q})=>{fi("Profile image updated successfully"),s(fm(Q==null?void 0:Q.user))}).catch(()=>{Mn("Failed to update profile image")})};return W.useEffect(()=>{const J=U=>{F.current&&!F.current.contains(U.target)&&u(!1)};return document.addEventListener("mousedown",J),()=>{document.removeEventListener("mousedown",J)}},[F]),S.jsxs("div",{className:"",children:[S.jsxs("div",{className:"absolute flex w-full justify-between border-b bg-white px-2 py-2.5 shadow-sm drop-shadow-2xl lg:justify-start lg:py-4 lg:ps-80",children:[S.jsx(ui,{to:"/",children:S.jsx(fM,{})}),S.jsx("button",{"data-drawer-target":"default-sidebar","data-drawer-toggle":"default-sidebar","aria-controls":"default-sidebar",onClick:()=>u(!o),type:"button",className:Zn("inline-flex items-center rounded-lg p-2 text-sm outline-none duration-300 lg:hidden",o&&"scale-0"),children:S.jsx(vce,{className:"h-7 w-7 text-sky-700"})})]}),S.jsx(bce,{isOpen:m,setIsOpen:_}),S.jsx("aside",{ref:F,id:"default-sidebar",className:`${o?"translate-x-0":"-translate-x-full"} fixed left-0 top-0 z-40 h-screen w-72 transition-transform lg:translate-x-0`,"aria-label":"Sidebar",children:S.jsxs("div",{className:"flex h-full flex-col overflow-y-auto bg-sky-950 px-3 py-4",children:[S.jsx("button",{onClick:()=>u(!o),className:"self-end text-white lg:hidden",children:S.jsx(DJ,{className:"h-5 w-5"})}),S.jsxs("div",{className:"mb-4 mt-3 flex flex-col items-center border-b border-sky-400 pb-4",children:[(t==null?void 0:t.profileImage)==null&&S.jsxs("div",{className:"relative",children:[S.jsx("div",{className:"flex h-28 w-28 items-center justify-center rounded-full bg-sky-500 text-7xl text-white",children:t==null?void 0:t.name.charAt(0)}),S.jsxs("label",{htmlFor:"profile-image",children:[S.jsx("input",{type:"file",id:"profile-image",className:"peer sr-only",accept:"image/*",onChange:H}),S.jsx("div",{className:"absolute bottom-1 right-2 h-8 w-8 cursor-pointer rounded-full bg-sky-700 p-2 text-white",children:S.jsx(j_,{})})]})]}),(t==null?void 0:t.profileImage)!=null&&S.jsxs("div",{className:"relative",children:[S.jsx("img",{src:"http://localhost:8000/"+(t==null?void 0:t.profileImage)+`?${new Date().getSeconds()}`,alt:t==null?void 0:t.name.charAt(0),className:"flex h-28 w-28 items-center justify-center rounded-full border-2 border-sky-500 bg-sky-500 text-7xl text-white"}),S.jsxs("label",{htmlFor:"profile-image",children:[S.jsx("input",{type:"file",id:"profile-image",className:"peer sr-only",accept:"image/*",onChange:H}),S.jsx("div",{className:"absolute bottom-1 right-2 h-8 w-8 cursor-pointer rounded-full bg-sky-700 p-2 text-white",children:S.jsx(j_,{})})]})]}),S.jsx("p",{className:"mb-1 mt-3 font-medium text-white",children:t==null?void 0:t.name}),S.jsx("p",{className:"rounded-full border border-sky-300 bg-sky-600 px-4 py-0.5 text-xs font-medium capitalize text-white",children:t==null?void 0:t.role.toLowerCase()})]}),S.jsx("ul",{className:"space-y-2 font-medium",children:e==null?void 0:e.map((J,U)=>S.jsx("li",{children:S.jsxs(ui,{to:J.link,className:`group flex items-center rounded-lg p-2 text-white ${O===J.link?"bg-sky-600 hover:bg-sky-700":"hover:bg-sky-500/30"}`,children:[J.icon,S.jsx("span",{className:"ms-2",children:J.name})]})},U))}),S.jsx("div",{className:"flex flex-grow flex-col"}),S.jsxs("div",{className:"flex items-center justify-between border-t border-sky-400 px-2 pt-6",children:[S.jsxs("button",{onClick:q,className:"flex items-center gap-x-2 font-medium text-white hover:text-sky-300",children:[S.jsx(hce,{className:"h-5 w-5"}),S.jsx("span",{children:"Logout"})]}),!r&&S.jsxs("button",{onClick:()=>_(!0),className:"flex items-center gap-x-2 font-medium text-white hover:text-sky-300",children:["Feedback",S.jsx(Ole,{})]})]})]})})]})},bce=({isOpen:e,setIsOpen:t})=>{const[r,o]=W.useState(""),[u,m]=W.useState(!1),_=async()=>{if(!r||r.length<1)return Mn("Feedback is required");const b=new FormData;b.append("feedback",r),b.append("type","SYSTEM"),m(!0),await Jt.post("/feedbacks",b).then(()=>{fi("Feedback submitted successfully"),t(!1),o("")}).catch(s=>{var k,O;(O=(k=s==null?void 0:s.response)==null?void 0:k.data)!=null&&O.message?Mn(s.response.data.message):Mn("Failed to submit feedback")}).finally(()=>{m(!1)})};return S.jsx($a,{open:e,onOpenChange:t,children:S.jsxs(sa,{className:"max-w-2xl overflow-y-auto max-h-[90vh]",children:[S.jsxs(oa,{children:[S.jsx(aa,{children:"Submit Feedback"}),S.jsx(la,{className:"text-xs font-medium",children:"Please describe your feedback in detail so that we can help you better."})]}),S.jsxs("div",{className:"mt-3 grid gap-2",children:[S.jsxs(jt,{htmlFor:"feedback",className:"flex items-center justify-between",children:["Feedback",S.jsxs("span",{className:"text-sm text-gray-500",children:[(r==null?void 0:r.length)||0,"/1000"]})]}),S.jsx(ca,{id:"feedback",className:"border-gray-400/80",value:r,maxLength:1e3,onChange:b=>o(b.target.value),rows:8,placeholder:"Write your feedback here"})]}),S.jsx(bl,{children:S.jsx(Pn,{type:"button",className:"bg-sky-600 text-white hover:bg-sky-700",onClick:_,children:u?"Submitting...":"Submit Feedback"})})]})})},wce=[{icon:S.jsx(DA,{}),name:"Travels",link:"/dashboard"},{icon:S.jsx(Ab,{}),name:"Settings",link:"/dashboard/settings"},{icon:S.jsx(Kb,{}),name:"Back To Home",link:"/"}],Sce=()=>S.jsx(Jb,{urls:wce}),Tce=[{icon:S.jsx(WV,{}),name:"Dashboard",link:"/dashboard"},{icon:S.jsx(HV,{}),name:"Request Locations",link:"/dashboard/request-locations"},{icon:S.jsx(xce,{}),name:"Guide Requests",link:"/dashboard/guide-requests"},{icon:S.jsx(qV,{}),name:"Received Feedback",link:"/dashboard/received-feedback"},{icon:S.jsx(Ab,{}),name:"Settings",link:"/dashboard/settings"},{icon:S.jsx(Kb,{}),name:"Back To Home",link:"/"}],Ece=()=>S.jsx(Jb,{urls:Tce}),Cce=[{icon:S.jsx(DA,{}),name:"Accommodations",link:"/dashboard"},{icon:S.jsx(Ab,{}),name:"Settings",link:"/dashboard/settings"},{icon:S.jsx(Kb,{}),name:"Back To Home",link:"/"}],Pce=()=>S.jsx(Jb,{urls:Cce}),Mce=[{icon:S.jsx(WV,{}),name:"Dashboard",link:"/dashboard"},{icon:S.jsx(DA,{}),name:"Locations",link:"/dashboard/locations"},{icon:S.jsx(HV,{}),name:"Locations Requests",link:"/dashboard/location-requests"},{icon:S.jsx(Vle,{}),name:"Events",link:"/dashboard/events"},{icon:S.jsx(zle,{}),name:"Guide Approval",link:"/dashboard/guide-approval"},{icon:S.jsx(Nle,{}),name:"Accounts",link:"/dashboard/accounts"},{icon:S.jsx(qV,{}),name:"Received Feedback",link:"/dashboard/system-feedback"},{icon:S.jsx(Ab,{}),name:"Settings",link:"/dashboard/settings"},{icon:S.jsx(Kb,{}),name:"Back To Home",link:"/"}],Ace=()=>S.jsx(Jb,{urls:Mce}),wl=()=>{const{user:e}=qi(r=>r.user),{role:t}=e;return t===ni.Traveler?S.jsx(Sce,{}):t===ni.Guide?S.jsx(Ece,{}):t===ni.Accommodations?S.jsx(Pce,{}):t===ni.Admin?S.jsx(Ace,{}):null};function Ice(e){return Kr({tag:"svg",attr:{version:"1.2",baseProfile:"tiny",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M3.1 11.3l3.6 3.3-1 4.6c-.1.6.1 1.2.6 1.5.2.2.5.3.8.3.2 0 .4 0 .6-.1 0 0 .1 0 .1-.1l4.1-2.3 4.1 2.3s.1 0 .1.1c.5.2 1.1.2 1.5-.1.5-.3.7-.9.6-1.5l-1-4.6c.4-.3 1-.9 1.6-1.5l1.9-1.7.1-.1c.4-.4.5-1 .3-1.5s-.6-.9-1.2-1h-.1l-4.7-.5-1.9-4.3s0-.1-.1-.1c-.1-.7-.6-1-1.1-1-.5 0-1 .3-1.3.8 0 0 0 .1-.1.1l-1.9 4.3-4.7.5h-.1c-.5.1-1 .5-1.2 1-.1.6 0 1.2.4 1.6z"},child:[]}]})(e)}const Dce=()=>{const[e,t]=W.useState([]),[r,o]=W.useState(!1),[u,m]=W.useState(null),_=async()=>{await Jt.get("/travels").then(({data:b})=>{t(b==null?void 0:b.travels)}).catch(()=>{Mn("Failed to fetch trips")})};return W.useEffect(()=>{_()},[]),S.jsxs("div",{className:"mt-5 flex w-full flex-col items-center gap-5",children:[S.jsx(Rce,{isOpen:r,setIsOpen:o,guideId:u}),e&&e.map((b,s)=>S.jsxs("div",{className:"flex w-full flex-col justify-center rounded-md border border-gray-700/20 bg-white p-4 shadow-sm drop-shadow-lg xl:max-w-5xl",children:[S.jsxs("p",{className:"text-sm text-gray-600",children:["Arrivals on : ",new Date(b==null?void 0:b.arrival).toDateString()]}),S.jsxs("p",{className:"text-sm text-gray-600",children:["Departures on : ",new Date(b==null?void 0:b.departure).toDateString()]}),S.jsxs("p",{className:"text-sm text-gray-600",children:["Budget : ",b==null?void 0:b.budget," LKR"]}),S.jsxs("div",{className:"relative",children:[S.jsxs("p",{className:"mt-2 border-t border-dashed border-gray-500 pt-2 text-sm text-gray-600",children:["Guide : ",b==null?void 0:b.guide_name]}),S.jsxs("p",{className:"text-sm text-gray-600",children:["Guide Status : ",b==null?void 0:b.guide_status]}),S.jsxs("p",{className:"text-sm text-gray-600",children:["Guide Contact : ",b==null?void 0:b.guide_contact]}),(b==null?void 0:b.guide_status)==="APPROVED"&&new Date(b==null?void 0:b.departure)<new Date&&S.jsx("div",{className:"flex justify-end",children:S.jsx(Pn,{size:"sm",className:"h-8 bg-sky-600 px-2 text-white hover:bg-sky-700",onClick:()=>{o(!0),m(b==null?void 0:b.guide)},children:"Submit Feedback"})})]}),S.jsx("p",{className:"mt-2 border-t border-dashed border-gray-500 pt-2 text-sm font-medium text-gray-600",children:"Accommodations"}),b==null?void 0:b.accommodations.map((k,O)=>S.jsxs("div",{className:"my-1 border-b border-t border-sky-700/50 py-1 text-sm text-gray-600",children:[S.jsxs("p",{children:["Name : ",k==null?void 0:k.name," - ",k==null?void 0:k.category]}),S.jsxs("p",{children:["Price : ",k==null?void 0:k.price," LKR / Day"]}),S.jsxs("p",{children:["Address : ",k==null?void 0:k.address]})]},O)),S.jsx("p",{className:"mt-2 border-t border-dashed border-gray-500 pt-2 text-sm font-medium text-gray-600",children:"Locations"}),b==null?void 0:b.locations.map((k,O)=>S.jsxs("div",{className:"my-1 border-b border-t border-sky-700/50 py-1 text-sm text-gray-600",children:[S.jsxs("p",{children:["Name : ",k==null?void 0:k.title]}),S.jsxs("p",{children:["Category : ",k==null?void 0:k.category]}),S.jsxs("p",{children:["City : ",k==null?void 0:k.city]}),S.jsxs("p",{className:"capitalize",children:["Province : ",k==null?void 0:k.province," Province"]})]},O))]},s)),(e==null?void 0:e.length)===0&&S.jsx("div",{className:"flex w-full flex-col items-center justify-center rounded-md border border-gray-700/20 bg-white p-4 shadow-sm drop-shadow-lg xl:max-w-5xl",children:S.jsx("p",{className:"text-sm text-gray-600",children:"No trips available"})})]})},Rce=({isOpen:e,setIsOpen:t,guideId:r})=>{const[o,u]=W.useState(""),[m,_]=W.useState(5),[b,s]=W.useState(!1),k=async()=>{if(!o||o.length<1)return Mn("Feedback is required");const O=new FormData;O.append("feedback",o),O.append("rating",m),O.append("guide_id",r),O.append("type","GUIDE"),s(!0),await Jt.post("/feedbacks",O).then(()=>{fi("Feedback submitted successfully"),t(!1),u("")}).catch(F=>{var q,H;(H=(q=F==null?void 0:F.response)==null?void 0:q.data)!=null&&H.message?Mn(F.response.data.message):Mn("Failed to submit feedback")}).finally(()=>{s(!1)})};return S.jsx($a,{open:e,onOpenChange:t,children:S.jsxs(sa,{className:"max-w-2xl overflow-y-auto max-h-[90vh]",children:[S.jsxs(oa,{children:[S.jsx(aa,{children:"Submit Feedback"}),S.jsx(la,{className:"text-xs font-medium",children:"Please describe your feedback in detail so that we can help you better."})]}),S.jsxs("div",{className:"pt-4",children:[S.jsx(jt,{htmlFor:"rating",className:"text-start",children:"Rating"}),S.jsxs("div",{className:"flex items-center gap-x-2",children:[[1,2,3,4,5].map(O=>S.jsx(Pn,{variant:"ghost",className:`${m>=O?"!text-amber-500":"text-gray-300 hover:text-amber-400"} !border-none !bg-transparent px-0 !outline-none !ring-0`,onClick:()=>_(O),children:S.jsx(Ice,{className:"h-5 w-5"})},O)),S.jsx("span",{className:"text-sm font-medium",children:m?`${m} of 5 stars`:"No rating"})]})]}),S.jsxs("div",{className:"",children:[S.jsxs(jt,{htmlFor:"feedback",className:"flex items-center justify-between",children:["Feedback",S.jsxs("span",{className:"text-sm text-gray-500",children:[(o==null?void 0:o.length)||0,"/1000"]})]}),S.jsx(ca,{id:"feedback",className:"border-gray-400/80",value:o,maxLength:1e3,onChange:O=>u(O.target.value),rows:8,placeholder:"Write your feedback here"})]}),S.jsx(bl,{children:S.jsx(Pn,{type:"button",className:"bg-sky-600 text-white hover:bg-sky-700",onClick:k,children:b?"Submitting...":"Submit Feedback"})})]})})},kce=()=>{const{user:e}=qi(r=>r.user),{role:t}=e;return S.jsxs("div",{className:"w-full",children:[S.jsx(wl,{}),S.jsxs("div",{className:"flex w-full justify-center px-4 py-16 lg:ms-72 lg:w-[calc(100%_-_18rem)]",children:[ni.Admin===t&&S.jsx(yce,{}),ni.Guide===t&&S.jsx(_ce,{}),ni.Accommodations===t&&S.jsx(fce,{}),ni.Traveler===t&&S.jsx(Dce,{})]})]})},Cv={currentPassword:"",password:"",confirmPassword:"",name:"",email:""},Nce=()=>{const{user:e}=qi(Q=>Q.user),t={currentPassword:"",password:"",confirmPassword:"",name:(e==null?void 0:e.name)||"",email:(e==null?void 0:e.email)||""},[r,o]=W.useState(t),[u,m]=W.useState(Cv),[_,b]=W.useState({password:!1,name:!1,email:!1}),s=yc(),k=xl(),O=Q=>{o(ee=>({...ee,[Q.target.name]:Q.target.value})),m(ee=>({...ee,[Q.target.name]:""}))},F=Q=>{if(!Q.currentPassword)return m(ee=>({...ee,currentPassword:"Current password is required"})),!1;if(!Q.password)return m(ee=>({...ee,password:"Password is required"})),!1;if(Q.password.length<8){m(ee=>({...ee,password:"Password must be at least 8 characters"}));return}return Q.password===Q.currentPassword?(m(ee=>({...ee,password:"New password must be different from the current password"})),!1):Q.password!==Q.confirmPassword?(m(ee=>({...ee,confirmPassword:"Passwords do not match"})),!1):!0},q=Q=>Q.name?Q.name.length<3?(m(ee=>({...ee,name:"Name must be at least 3 characters"})),!1):Q.name===e.name?(m(ee=>({...ee,name:"New name must be different from the current name"})),!1):!0:(m(ee=>({...ee,name:"Name is required"})),!1),H=Q=>Q.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(Q.email)?Q.email===e.email?(m(ee=>({...ee,email:"New email must be different from the current email"})),!1):!0:(m(ee=>({...ee,email:"Invalid email"})),!1):(m(ee=>({...ee,email:"Email is required"})),!1),J=async Q=>{if(Q.preventDefault(),!F(r))return;b(re=>({...re,password:!0})),m(Cv);const ee=new FormData;ee.append("currentPassword",r.currentPassword),ee.append("password",r.password),ee.append("confirmPassword",r.confirmPassword),ee.append("type","password"),await Jt.post("/update_account",ee).then(({data:re})=>{fi(re.message),o(t),k(nm()),s("/login")}).catch(re=>{const xe=re.response.data;if(re.response.status===500)return Mn(xe.message);m(Ee=>({...Ee,[xe==null?void 0:xe.property]:xe.message}))}).finally(()=>{b(re=>({...re,password:!1}))})},U=async Q=>{if(Q.preventDefault(),!q(r))return;b(re=>({...re,name:!0})),m(Cv);const ee=new FormData;ee.append("name",r.name),ee.append("type","name"),await Jt.post("/update_account",ee).then(({data:re})=>{fi(re.message),re!=null&&re.user&&k(fm(re==null?void 0:re.user))}).catch(re=>{const xe=re.response.data;if(re.response.status===500)return Mn(xe.message);m(Ee=>({...Ee,[xe==null?void 0:xe.property]:xe.message}))}).finally(()=>{b(re=>({...re,name:!1}))})},te=async Q=>{if(Q.preventDefault(),!H(r))return;b(re=>({...re,email:!0})),m(Cv);const ee=new FormData;ee.append("email",r.email),ee.append("type","email"),await Jt.post("/update_account",ee).then(({data:re})=>{fi(re.message),o(t),k(nm()),s("/login")}).catch(re=>{const xe=re.response.data;if(re.response.status===500)return Mn(xe.message);m(Ee=>({...Ee,[xe==null?void 0:xe.property]:xe.message}))}).finally(()=>{b(re=>({...re,email:!1}))})};return S.jsxs("div",{className:"w-full",children:[S.jsx(wl,{}),S.jsx("div",{className:"flex min-h-screen w-full items-center justify-center px-4 py-16 lg:ms-72 lg:w-[calc(100%_-_18rem)]",children:S.jsxs("div",{className:"my-10 grid grid-cols-1 gap-8 md:grid-cols-2 md:gap-3 xl:gap-8",children:[S.jsxs("form",{onSubmit:J,onChange:O,className:"flex h-fit w-full flex-col items-center justify-center rounded-md bg-white p-6 shadow-sm drop-shadow-lg md:row-span-2",children:[S.jsx("h1",{className:"mb-1 w-full text-2xl font-medium text-gray-800",children:"Change Password"}),S.jsx("p",{className:"mb-3 w-full text-xs text-gray-600",children:"Please enter your current password and new password to change your password."}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"currentPassword",children:"Current Password"}),S.jsx(bn,{id:"currentPassword",name:"currentPassword",type:"password",maxLength:"100",placeholder:"********",className:"w-full border-gray-400/80 p-2"}),u.currentPassword&&S.jsx("p",{className:"text-sm text-red-500",children:u.currentPassword})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"password",children:"Password"}),S.jsx(bn,{id:"password",name:"password",type:"password",maxLength:"100",placeholder:"********",className:"w-full border-gray-400/80 p-2"}),u.password&&S.jsx("p",{className:"text-sm text-red-500",children:u.password})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"confirmPassword",children:"Confirm Password"}),S.jsx(bn,{id:"confirmPassword",name:"confirmPassword",type:"password",maxLength:"100",placeholder:"********",className:"w-full border-gray-400/80 p-2"}),u.confirmPassword&&S.jsx("p",{className:"text-sm text-red-500",children:u.confirmPassword})]}),S.jsx(Pn,{disabled:_.password,className:"mt-4 w-full max-w-lg rounded-md bg-sky-700 px-4 py-2 text-white",children:_.password?"Changing...":"Change Password"})]}),S.jsxs("form",{onSubmit:U,className:"flex w-full flex-col items-center justify-center rounded-md bg-white p-6 shadow-sm drop-shadow-lg",children:[S.jsx("h1",{className:"mb-1 w-full text-2xl font-medium text-gray-800",children:"Change Name"}),S.jsx("p",{className:"mb-3 w-full text-xs text-gray-600",children:"Please enter your new name to change your name."}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"name",children:"Name"}),S.jsx(bn,{id:"name",name:"name",type:"text",maxLength:"100",placeholder:"John Doe",value:r.name,onChange:Q=>o({...r,name:Q.target.value}),className:"w-full border-gray-400/80 p-2"}),u.name&&S.jsx("p",{className:"text-sm text-red-500",children:u.name})]}),S.jsx(Pn,{disabled:_.name,className:"mt-4 w-full max-w-lg rounded-md bg-sky-700 px-4 py-2 text-white",children:_.name?"Changing...":"Change Name"})]}),S.jsxs("form",{onSubmit:te,className:"flex w-full flex-col items-center justify-center rounded-md bg-white p-6 shadow-sm drop-shadow-lg",children:[S.jsx("h1",{className:"mb-1 w-full text-2xl font-medium text-gray-800",children:"Change Email"}),S.jsx("p",{className:"mb-3 w-full text-xs text-gray-600",children:"Please enter your new email to change your email."}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"email",children:"Email"}),S.jsx(bn,{id:"email",name:"email",type:"email",maxLength:"100",placeholder:"john@example.com",value:r.email,onChange:Q=>o({...r,email:Q.target.value}),className:"w-full border-gray-400/80 p-2"}),u.email&&S.jsx("p",{className:"text-sm text-red-500",children:u.email})]}),S.jsx(Pn,{disabled:_.email,className:"mt-4 w-full max-w-lg rounded-md bg-sky-700 px-4 py-2 text-white",children:_.email?"Changing...":"Change Email"})]})]})})]})},Lce=()=>{const[e,t]=W.useState(""),[r,o]=W.useState(!1),[u,m]=W.useState([]),_=async()=>{await Jt.get("/location").then(({data:b})=>{m(b==null?void 0:b.locations)}).catch(()=>{Mn("Failed to load data")})};return W.useEffect(()=>{(async()=>{await Jt.get(`/location?search=${e}`).then(({data:s})=>{m(s==null?void 0:s.locations)}).catch(()=>{Mn("Failed to load data")})})()},[e]),W.useEffect(()=>{_()},[]),S.jsxs("div",{className:"flex w-full flex-col items-center gap-5",children:[S.jsx(Oce,{isOpen:r,setIsOpen:o,loadData:_}),S.jsxs("section",{className:"container mx-auto mt-10 px-4 py-8",children:[S.jsxs("div",{className:"mb-5 flex flex-col items-center justify-center gap-2 sm:flex-row",children:[S.jsx(bn,{placeholder:"Search locations...",className:"max-w-lg border-sky-600/80 !outline-0 !ring-0",value:e,onChange:b=>t(b.target.value)}),S.jsxs(Pn,{onClick:()=>o(!0),className:"w-full max-w-[10rem] bg-sky-600 hover:bg-sky-700",children:[S.jsx(Va,{className:"size-5"}),"Add Location"]})]}),S.jsx("div",{className:"flex w-full justify-center pt-2",children:S.jsx(zce,{items:u,loadData:_})})]})]})},Oce=({isOpen:e,setIsOpen:t,loadData:r})=>{const o={title:"",city:"",province:no[0].value,category:js.environments[0],lat:"",long:"",description:"",image:null},u={title:"",city:"",province:"",category:"",lat:"",long:"",description:"",image:""},[m,_]=W.useState(o),[b,s]=W.useState(u),[k,O]=W.useState(!1),F=H=>(Object.keys(H).forEach(U=>{if(!H[U])return s(te=>({...te,[U]:`${U} is required`})),!1}),H.description.length>500?(s(U=>({...U,description:"Description length must be less than 500 characters"})),!1):H.image&&H.image.size>1024*1024*2?(s(U=>({...U,image:"Image size must be less than 2MB"})),!1):!0),q=async H=>{if(H.preventDefault(),!F(m))return;O(!0),s(u);const J=new FormData;Object.keys(m).forEach(U=>J.append(U,m[U])),await Jt.post("/location",J).then(({data:U})=>{fi(U.message),_(o),r(),t(!1)}).catch(U=>{const te=U.response.data;if(U.response.status===500)return Mn(te.message);s(Q=>({...Q,[te==null?void 0:te.property]:te.message}))}).finally(()=>{O(!1)})};return S.jsx($a,{open:e,onOpenChange:t,children:S.jsxs(sa,{className:"max-w-2xl overflow-y-auto max-h-[90vh]",children:[S.jsxs(oa,{children:[S.jsx(aa,{children:"Add New Location"}),S.jsx(la,{className:"text-xs font-medium",children:"Add new location to the system. user will be able to see this location."})]}),S.jsxs("form",{onSubmit:q,className:"flex w-full flex-col items-center justify-center",children:[S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"title",children:"Title"}),S.jsx(bn,{id:"title",name:"title",type:"text",maxLength:"256",placeholder:"Galle fort",value:m.title,onChange:H=>_(J=>({...J,title:H.target.value})),className:"w-full border-gray-400/80 p-2"}),b.title&&S.jsx("p",{className:"text-sm text-red-500",children:b.title})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"city",children:"Near City"}),S.jsx(bn,{id:"city",name:"city",type:"text",maxLength:"50",placeholder:"Galle",value:m.city,onChange:H=>_(J=>({...J,city:H.target.value})),className:"w-full border-gray-400/80 p-2"}),b.city&&S.jsx("p",{className:"text-sm text-red-500",children:b.city})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"province",children:"Province"}),S.jsxs(Ci,{defaultValue:no[0].value,onValueChange:H=>_(J=>({...J,province:H})),children:[S.jsx(_i,{className:"w-full border-gray-400/80",children:S.jsx(Mi,{placeholder:"Select a province"})}),S.jsx(xi,{children:S.jsx(Pi,{children:no.map(H=>S.jsx(ii,{value:H.value,children:H.label},H.value))})})]}),b.province&&S.jsx("p",{className:"text-sm text-red-500",children:b.province})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"category",children:"Category"}),S.jsxs(Ci,{defaultValue:js.environments[0],onValueChange:H=>_(J=>({...J,category:H})),children:[S.jsx(_i,{className:"w-full border-gray-400/80 capitalize",children:S.jsx(Mi,{placeholder:"Select a category"})}),S.jsx(xi,{children:S.jsx(Pi,{children:js.environments.map(H=>S.jsx(ii,{value:H,className:"capitalize",children:H},H))})})]}),b.category&&S.jsx("p",{className:"text-sm text-red-500",children:b.category})]}),S.jsxs("div",{className:"flex w-full flex-col gap-x-2 sm:flex-row",children:[S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"lat",children:"Latitude"}),S.jsx(bn,{id:"lat",name:"lat",type:"text",maxLength:"50",placeholder:"6.0535",value:m.lat,onChange:H=>_(J=>({...J,lat:H.target.value})),className:"w-full border-gray-400/80 p-2"}),b.lat&&S.jsx("p",{className:"text-sm text-red-500",children:b.lat})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"long",children:"Longitude"}),S.jsx(bn,{id:"long",name:"long",type:"text",maxLength:"50",placeholder:"80.2210",value:m.long,onChange:H=>_(J=>({...J,long:H.target.value})),className:"w-full border-gray-400/80 p-2"}),b.long&&S.jsx("p",{className:"text-sm text-red-500",children:b.long})]})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"description",children:"Description"}),S.jsx(ca,{id:"description",name:"description",rows:"5",maxLength:"500",placeholder:"Galle fort is a historical fort...",value:m.description,onChange:H=>_(J=>({...J,description:H.target.value})),className:"w-full border-gray-400/80 p-2"}),b.description&&S.jsx("p",{className:"text-sm text-red-500",children:b.description})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"location-image",children:"Location Image"}),!m.image&&S.jsxs("label",{htmlFor:"location-image",children:[S.jsx("input",{type:"file",id:"location-image",className:"peer sr-only",accept:"image/*",onChange:H=>{const J=H.target.files[0];_(U=>({...U,image:J}))}}),S.jsx("div",{className:"mt-2 flex h-28 w-28 cursor-pointer items-center justify-center rounded-sm bg-gray-400 p-2 text-white",children:S.jsx(Va,{className:"size-10"})})]}),m.image&&S.jsxs("div",{className:"relative mt-2 h-28 w-28",children:[S.jsx(Zh,{className:"absolute end-1 top-1 size-5 cursor-pointer rounded-full bg-black p-1 text-white",onClick:()=>_(H=>({...H,image:null}))}),S.jsx("img",{src:URL.createObjectURL(m.image),alt:"location",className:"h-28 w-28 rounded-md border border-gray-400/80 object-cover"})]}),b.image&&S.jsx("p",{className:"text-sm text-red-500",children:b.image})]})]}),S.jsx(bl,{children:S.jsx(Pn,{type:"submit",onClick:q,disabled:k,className:"mt-4 w-full max-w-[10rem] rounded-md bg-sky-700 px-4 py-2 text-white",children:k?"Loading...":"Add Location"})})]})})},jce=({id:e,item:t,isOpen:r,setIsOpen:o,loadData:u})=>{const m={title:(t==null?void 0:t.title)||"",city:(t==null?void 0:t.city)||"",province:(t==null?void 0:t.province)||"",category:(t==null?void 0:t.category)||"",lat:(t==null?void 0:t.latitude)||"",long:(t==null?void 0:t.longitude)||"",description:(t==null?void 0:t.description)||"",image:(t==null?void 0:t.image)||""},_={title:"",city:"",province:"",category:"",lat:"",long:"",description:"",image:""},[b,s]=W.useState(m),[k,O]=W.useState(_),[F,q]=W.useState(!1),H=U=>(Object.keys(U).forEach(Q=>{if(!U[Q])return O(ee=>({...ee,[Q]:`${Q} is required`})),!1}),U.description.length>500?(O(Q=>({...Q,description:"Description length must be less than 500 characters"})),!1):typeof U.image!="string"&&U.image&&U.image.size>1024*1024*2?(O(Q=>({...Q,image:"Image size must be less than 2MB"})),!1):!0),J=async U=>{if(U.preventDefault(),!H(b))return;q(!0),O(_);const te=new FormData;Object.keys(b).forEach(Q=>te.append(Q,b[Q])),te.append("type","UPDATE"),te.append("id",e),await Jt.post("/location",te).then(({data:Q})=>{fi(Q.message),s(m),u(),o(!1)}).catch(Q=>{const ee=Q.response.data;if(Q.response.status===500)return Mn(ee.message);O(re=>({...re,[ee==null?void 0:ee.property]:ee.message}))}).finally(()=>{q(!1)})};return W.useEffect(()=>{t&&s({title:t==null?void 0:t.title,city:t==null?void 0:t.city,province:t==null?void 0:t.province,category:t==null?void 0:t.category,lat:t==null?void 0:t.latitude,long:t==null?void 0:t.longitude,description:t==null?void 0:t.description,image:t==null?void 0:t.image})},[t]),S.jsx($a,{open:r,onOpenChange:o,children:S.jsxs(sa,{className:"max-w-2xl overflow-y-auto max-h-[90vh]",children:[S.jsxs(oa,{children:[S.jsx(aa,{children:"Update Location"}),S.jsx(la,{className:"text-xs font-medium",children:"Update location details."})]}),S.jsxs("form",{onSubmit:J,className:"flex w-full flex-col items-center justify-center",children:[S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"title",children:"Title"}),S.jsx(bn,{id:"title",name:"title",type:"text",maxLength:"256",placeholder:"Galle fort",value:b.title,onChange:U=>s(te=>({...te,title:U.target.value})),className:"w-full border-gray-400/80 p-2"}),k.title&&S.jsx("p",{className:"text-sm text-red-500",children:k.title})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"city",children:"Near City"}),S.jsx(bn,{id:"city",name:"city",type:"text",maxLength:"50",placeholder:"Galle",value:b.city,onChange:U=>s(te=>({...te,city:U.target.value})),className:"w-full border-gray-400/80 p-2"}),k.city&&S.jsx("p",{className:"text-sm text-red-500",children:k.city})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"city",children:"Near City"}),S.jsxs(Ci,{value:b.province,onValueChange:U=>s(te=>({...te,province:U})),children:[S.jsx(_i,{className:"w-full border-gray-400/80",children:S.jsx(Mi,{placeholder:"Select a province"})}),S.jsx(xi,{children:S.jsx(Pi,{children:no.map(U=>S.jsx(ii,{value:U.value,children:U.label},U.value))})})]}),k.province&&S.jsx("p",{className:"text-sm text-red-500",children:k.province})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"category",children:"Category"}),S.jsxs(Ci,{value:b.category,onValueChange:U=>s(te=>({...te,category:U})),children:[S.jsx(_i,{className:"w-full border-gray-400/80 capitalize",children:S.jsx(Mi,{placeholder:"Select a category"})}),S.jsx(xi,{children:S.jsx(Pi,{children:js.environments.map(U=>S.jsx(ii,{value:U,className:"capitalize",children:U},U))})})]}),k.category&&S.jsx("p",{className:"text-sm text-red-500",children:k.category})]}),S.jsxs("div",{className:"flex w-full flex-col gap-x-2 sm:flex-row",children:[S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"lat",children:"Latitude"}),S.jsx(bn,{id:"lat",name:"lat",type:"text",maxLength:"50",placeholder:"6.0535",value:b.lat,onChange:U=>s(te=>({...te,lat:U.target.value})),className:"w-full border-gray-400/80 p-2"}),k.lat&&S.jsx("p",{className:"text-sm text-red-500",children:k.lat})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"long",children:"Longitude"}),S.jsx(bn,{id:"long",name:"long",type:"text",maxLength:"50",placeholder:"80.2210",value:b.long,onChange:U=>s(te=>({...te,long:U.target.value})),className:"w-full border-gray-400/80 p-2"}),k.long&&S.jsx("p",{className:"text-sm text-red-500",children:k.long})]})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"description",children:"Description"}),S.jsx(ca,{id:"description",name:"description",rows:"5",maxLength:"500",placeholder:"Galle fort is a historical fort...",value:b.description,onChange:U=>s(te=>({...te,description:U.target.value})),className:"w-full border-gray-400/80 p-2"}),k.description&&S.jsx("p",{className:"text-sm text-red-500",children:k.description})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"location-image",children:"Location Image"}),!b.image&&S.jsxs("label",{htmlFor:"location-image",children:[S.jsx("input",{type:"file",id:"location-image",className:"peer sr-only",accept:"image/*",onChange:U=>{const te=U.target.files[0];s(Q=>({...Q,image:te}))}}),S.jsx("div",{className:"mt-2 flex h-28 w-28 cursor-pointer items-center justify-center rounded-sm bg-gray-400 p-2 text-white",children:S.jsx(Va,{className:"size-10"})})]}),b.image&&S.jsxs("div",{className:"relative mt-2 h-28 w-28",children:[S.jsx(Zh,{className:"absolute end-1 top-1 size-5 cursor-pointer rounded-full bg-black p-1 text-white",onClick:()=>s(U=>({...U,image:null}))}),S.jsx("img",{src:typeof b.image=="string"?"http://localhost:8000/"+(t==null?void 0:t.image)+`?${new Date().getSeconds()}`:URL.createObjectURL(b.image),alt:"location",className:"h-28 w-28 rounded-md border border-gray-400/80 object-cover"})]}),k.image&&S.jsx("p",{className:"text-sm text-red-500",children:k.image})]})]}),S.jsx(bl,{children:S.jsx(Pn,{type:"submit",onClick:J,disabled:F,className:"mt-4 w-full max-w-[10rem] rounded-md bg-sky-700 px-4 py-2 text-white",children:F?"Loading...":"Update Location"})})]})})},zce=({items:e,loadData:t})=>{const[r,o]=W.useState(!1),[u,m]=W.useState(null);return e!=null&&e.length?S.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[S.jsx(jce,{isOpen:r,setIsOpen:o,item:u,id:u==null?void 0:u.id,loadData:t}),e==null?void 0:e.map(_=>S.jsxs("div",{className:"w-full max-w-md rounded-lg bg-white shadow-md drop-shadow-xl",children:[S.jsx("img",{src:"http://localhost:8000/"+(_==null?void 0:_.image)+`?${new Date().getSeconds()}`,alt:"gallery",className:"h-48 w-full rounded-lg object-cover"}),S.jsx("div",{onClick:()=>{m(_),o(!0)},className:"absolute right-2 top-1 h-8 w-8 cursor-pointer rounded-full bg-white p-2 text-sky-700",children:S.jsx(j_,{})}),S.jsxs("div",{className:"p-4",children:[S.jsx("h2",{className:"line-clamp-2 font-medium",children:_==null?void 0:_.title}),S.jsx("p",{className:"mb-1 flex w-fit rounded bg-fuchsia-700 px-2 py-0.5 text-xs text-white",children:_==null?void 0:_.category}),S.jsxs("p",{className:"flex items-end gap-x-1 text-xs capitalize text-gray-600",children:[S.jsx(uc,{className:"-ms-1 size-5 text-red-600"}),_==null?void 0:_.city,", ",_==null?void 0:_.province.replace(/-/g," ")," Province"]}),S.jsx("p",{className:"mt-2 line-clamp-4 text-sm text-gray-700",children:_==null?void 0:_.description})]})]},_==null?void 0:_.id))]}):S.jsx("div",{className:"flex w-full items-center justify-center pt-5",children:S.jsx("h1",{className:"text-gray-600",children:"No locations found"})})},Fce=()=>{const{user:e}=qi(r=>r.user),{role:t}=e;return S.jsxs("div",{className:"w-full",children:[S.jsx(wl,{}),S.jsx("div",{className:"flex w-full justify-center px-4 py-16 lg:ms-72 lg:w-[calc(100%_-_18rem)]",children:ni.Admin===t&&S.jsx(Lce,{})})]})},Bce=()=>{const[e,t]=W.useState(""),[r,o]=W.useState(!1),[u,m]=W.useState([]),_=async()=>{await Jt.get("/location/my").then(({data:b})=>{m(b==null?void 0:b.locations)}).catch(()=>{Mn("Failed to load data")})};return W.useEffect(()=>{(async()=>{await Jt.get(`/location/my?search=${e}`).then(({data:s})=>{m(s==null?void 0:s.locations)}).catch(()=>{Mn("Failed to load data")})})()},[e]),W.useEffect(()=>{_()},[]),S.jsxs("div",{className:"flex w-full flex-col items-center gap-5",children:[S.jsx(Vce,{isOpen:r,setIsOpen:o,loadData:_}),S.jsxs("section",{className:"container mx-auto mt-10 px-4 py-8",children:[S.jsxs("div",{className:"mb-5 flex flex-col items-center justify-center gap-2 sm:flex-row",children:[S.jsx(bn,{placeholder:"Search locations...",className:"max-w-lg border-sky-600/80 !outline-0 !ring-0",value:e,onChange:b=>t(b.target.value)}),S.jsxs(Pn,{onClick:()=>o(!0),className:"w-full max-w-[10rem] bg-sky-600 hover:bg-sky-700",children:[S.jsx(Va,{className:"size-5"}),"Add Location"]})]}),S.jsx("div",{className:"flex w-full justify-center pt-2",children:S.jsx(Uce,{items:u,loadData:_})})]})]})},Vce=({isOpen:e,setIsOpen:t,loadData:r})=>{const o={title:"",city:"",province:no[0].value,category:js.environments[0],lat:"",long:"",description:"",image:null},u={title:"",city:"",province:"",category:"",lat:"",long:"",description:"",image:""},[m,_]=W.useState(o),[b,s]=W.useState(u),[k,O]=W.useState(!1),F=H=>(Object.keys(H).forEach(U=>{if(!H[U])return s(te=>({...te,[U]:`${U} is required`})),!1}),H.description.length>500?(s(U=>({...U,description:"Description length must be less than 500 characters"})),!1):H.image&&H.image.size>1024*1024*2?(s(U=>({...U,image:"Image size must be less than 2MB"})),!1):!0),q=async H=>{if(H.preventDefault(),!F(m))return;O(!0),s(u);const J=new FormData;Object.keys(m).forEach(U=>J.append(U,m[U])),await Jt.post("/location",J).then(({data:U})=>{fi(U.message),_(o),r(),t(!1)}).catch(U=>{var Q;const te=(Q=U==null?void 0:U.response)==null?void 0:Q.data;if(U.response.status===500)return Mn(te.message);s(ee=>({...ee,[te==null?void 0:te.property]:te.message}))}).finally(()=>{O(!1)})};return S.jsx($a,{open:e,onOpenChange:t,children:S.jsxs(sa,{className:"max-w-2xl overflow-y-auto max-h-[90vh]",children:[S.jsxs(oa,{children:[S.jsx(aa,{children:"Add New Location"}),S.jsx(la,{className:"text-xs font-medium",children:"Add new location to the system. user will be able to see this location."})]}),S.jsxs("form",{onSubmit:q,s:!0,className:"flex w-full flex-col items-center justify-center",children:[S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"title",children:"Title"}),S.jsx(bn,{id:"title",name:"title",type:"text",maxLength:"256",placeholder:"N-31005",value:m.title,onChange:H=>_(J=>({...J,title:H.target.value})),className:"w-full border-gray-400/80 p-2"}),b.title&&S.jsx("p",{className:"text-sm text-red-500",children:b.title})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"city",children:"Near City"}),S.jsx(bn,{id:"city",name:"city",type:"text",maxLength:"50",placeholder:"Galle",value:m.city,onChange:H=>_(J=>({...J,city:H.target.value})),className:"w-full border-gray-400/80 p-2"}),b.city&&S.jsx("p",{className:"text-sm text-red-500",children:b.city})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"province",children:"Province"}),S.jsxs(Ci,{defaultValue:no[0].value,onValueChange:H=>_(J=>({...J,province:H})),children:[S.jsx(_i,{className:"w-full border-gray-400/80",children:S.jsx(Mi,{placeholder:"Select a province"})}),S.jsx(xi,{children:S.jsx(Pi,{children:no.map(H=>S.jsx(ii,{value:H.value,children:H.label},H.value))})})]}),b.province&&S.jsx("p",{className:"text-sm text-red-500",children:b.province})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"category",children:"Category"}),S.jsxs(Ci,{defaultValue:js.environments[0],onValueChange:H=>_(J=>({...J,category:H})),children:[S.jsx(_i,{className:"w-full border-gray-400/80 capitalize",children:S.jsx(Mi,{placeholder:"Select a category"})}),S.jsx(xi,{children:S.jsx(Pi,{children:js.environments.map(H=>S.jsx(ii,{value:H,className:"capitalize",children:H},H))})})]}),b.category&&S.jsx("p",{className:"text-sm text-red-500",children:b.category})]}),S.jsxs("div",{className:"flex w-full flex-col gap-x-2 sm:flex-row",children:[S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"lat",children:"Latitude"}),S.jsx(bn,{id:"lat",name:"lat",type:"text",maxLength:"50",placeholder:"6.0535",value:m.lat,onChange:H=>_(J=>({...J,lat:H.target.value})),className:"w-full border-gray-400/80 p-2"}),b.lat&&S.jsx("p",{className:"text-sm text-red-500",children:b.lat})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"long",children:"Longitude"}),S.jsx(bn,{id:"long",name:"long",type:"text",maxLength:"50",placeholder:"80.2210",value:m.long,onChange:H=>_(J=>({...J,long:H.target.value})),className:"w-full border-gray-400/80 p-2"}),b.long&&S.jsx("p",{className:"text-sm text-red-500",children:b.long})]})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"description",children:"Description"}),S.jsx(ca,{id:"description",name:"description",rows:"5",maxLength:"500",placeholder:"Galle fort is a historical fort...",value:m.description,onChange:H=>_(J=>({...J,description:H.target.value})),className:"w-full border-gray-400/80 p-2"}),b.description&&S.jsx("p",{className:"text-sm text-red-500",children:b.description})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"location-image",children:"Location Image"}),!m.image&&S.jsxs("label",{htmlFor:"location-image",children:[S.jsx("input",{type:"file",id:"location-image",className:"peer sr-only",accept:"image/*",onChange:H=>{const J=H.target.files[0];_(U=>({...U,image:J}))}}),S.jsx("div",{className:"mt-2 flex h-28 w-28 cursor-pointer items-center justify-center rounded-sm bg-gray-400 p-2 text-white",children:S.jsx(Va,{className:"size-10"})})]}),m.image&&S.jsxs("div",{className:"relative mt-2 h-28 w-28",children:[S.jsx(Zh,{className:"absolute end-1 top-1 size-5 cursor-pointer rounded-full bg-black p-1 text-white",onClick:()=>_(H=>({...H,image:null}))}),S.jsx("img",{src:URL.createObjectURL(m.image),alt:"location",className:"h-28 w-28 rounded-md border border-gray-400/80 object-cover"})]}),b.image&&S.jsx("p",{className:"text-sm text-red-500",children:b.image})]})]}),S.jsx(bl,{children:S.jsx(Pn,{type:"submit",onClick:q,disabled:k,className:"mt-4 w-full max-w-[10rem] rounded-md bg-sky-700 px-4 py-2 text-white",children:k?"Loading...":"Add Location"})})]})})},Uce=({items:e})=>e!=null&&e.length?S.jsx("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:e==null?void 0:e.map(t=>{var r;return S.jsxs("div",{className:"w-full max-w-md rounded-lg bg-white shadow-md drop-shadow-xl",children:[S.jsx("img",{src:"http://localhost:8000/"+(t==null?void 0:t.image)+`?${new Date().getSeconds()}`,alt:"gallery",className:"h-48 w-full rounded-lg object-cover"}),S.jsx("p",{className:"absolute end-1 top-1 flex w-fit rounded-sm bg-slate-950 px-3 py-0.5 text-xs font-medium capitalize text-white",children:(r=t==null?void 0:t.status)==null?void 0:r.toLowerCase()}),S.jsxs("div",{className:"p-4",children:[S.jsx("h2",{className:"line-clamp-2 font-medium",children:t==null?void 0:t.title}),S.jsx("p",{className:"mb-1 flex w-fit rounded bg-fuchsia-700 px-2 py-0.5 text-xs text-white",children:t==null?void 0:t.category}),S.jsxs("p",{className:"flex items-end gap-x-1 text-xs capitalize text-gray-600",children:[S.jsx(uc,{className:"-ms-1 size-5 text-red-600"}),t==null?void 0:t.city,", ",t==null?void 0:t.province.replace(/-/g," ")," Province"]}),S.jsx("p",{className:"mt-2 line-clamp-4 text-sm text-gray-700",children:t==null?void 0:t.description})]})]},t==null?void 0:t.id)})}):S.jsx("div",{className:"flex w-full items-center justify-center pt-5",children:S.jsx("h1",{className:"text-gray-600",children:"No locations found"})}),$ce=()=>{const{user:e}=qi(o=>o.user),{role:t,guide:r}=e;return(r==null?void 0:r.id)===null||(r==null?void 0:r.is_verified)===0?S.jsx(qy,{to:"/dashboard"}):S.jsxs("div",{className:"w-full",children:[S.jsx(wl,{}),S.jsx("div",{className:"flex w-full justify-center px-4 py-16 lg:ms-72 lg:w-[calc(100%_-_18rem)]",children:ni.Guide===t&&S.jsx(Bce,{})})]})};var Gce="DismissableLayer",iP="dismissableLayer.update",Wce="dismissableLayer.pointerDownOutside",Hce="dismissableLayer.focusOutside",h4,t8=W.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),n8=W.forwardRef((e,t)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:o,onPointerDownOutside:u,onFocusOutside:m,onInteractOutside:_,onDismiss:b,...s}=e,k=W.useContext(t8),[O,F]=W.useState(null),q=(O==null?void 0:O.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,H]=W.useState({}),J=gr(t,qe=>F(qe)),U=Array.from(k.layers),[te]=[...k.layersWithOutsidePointerEventsDisabled].slice(-1),Q=U.indexOf(te),ee=O?U.indexOf(O):-1,re=k.layersWithOutsidePointerEventsDisabled.size>0,xe=ee>=Q,Ee=Xce(qe=>{const Ne=qe.target,ft=[...k.branches].some(ut=>ut.contains(Ne));!xe||ft||(u==null||u(qe),_==null||_(qe),qe.defaultPrevented||b==null||b())},q),He=Yce(qe=>{const Ne=qe.target;[...k.branches].some(ut=>ut.contains(Ne))||(m==null||m(qe),_==null||_(qe),qe.defaultPrevented||b==null||b())},q);return hB(qe=>{ee===k.layers.size-1&&(o==null||o(qe),!qe.defaultPrevented&&b&&(qe.preventDefault(),b()))},q),W.useEffect(()=>{if(O)return r&&(k.layersWithOutsidePointerEventsDisabled.size===0&&(h4=q.body.style.pointerEvents,q.body.style.pointerEvents="none"),k.layersWithOutsidePointerEventsDisabled.add(O)),k.layers.add(O),f4(),()=>{r&&k.layersWithOutsidePointerEventsDisabled.size===1&&(q.body.style.pointerEvents=h4)}},[O,q,r,k]),W.useEffect(()=>()=>{O&&(k.layers.delete(O),k.layersWithOutsidePointerEventsDisabled.delete(O),f4())},[O,k]),W.useEffect(()=>{const qe=()=>H({});return document.addEventListener(iP,qe),()=>document.removeEventListener(iP,qe)},[]),S.jsx(jn.div,{...s,ref:J,style:{pointerEvents:re?xe?"auto":"none":void 0,...e.style},onFocusCapture:In(e.onFocusCapture,He.onFocusCapture),onBlurCapture:In(e.onBlurCapture,He.onBlurCapture),onPointerDownCapture:In(e.onPointerDownCapture,Ee.onPointerDownCapture)})});n8.displayName=Gce;var qce="DismissableLayerBranch",Zce=W.forwardRef((e,t)=>{const r=W.useContext(t8),o=W.useRef(null),u=gr(t,o);return W.useEffect(()=>{const m=o.current;if(m)return r.branches.add(m),()=>{r.branches.delete(m)}},[r.branches]),S.jsx(jn.div,{...e,ref:u})});Zce.displayName=qce;function Xce(e,t=globalThis==null?void 0:globalThis.document){const r=ra(e),o=W.useRef(!1),u=W.useRef(()=>{});return W.useEffect(()=>{const m=b=>{if(b.target&&!o.current){let s=function(){r8(Wce,r,k,{discrete:!0})};const k={originalEvent:b};b.pointerType==="touch"?(t.removeEventListener("click",u.current),u.current=s,t.addEventListener("click",u.current,{once:!0})):s()}else t.removeEventListener("click",u.current);o.current=!1},_=window.setTimeout(()=>{t.addEventListener("pointerdown",m)},0);return()=>{window.clearTimeout(_),t.removeEventListener("pointerdown",m),t.removeEventListener("click",u.current)}},[t,r]),{onPointerDownCapture:()=>o.current=!0}}function Yce(e,t=globalThis==null?void 0:globalThis.document){const r=ra(e),o=W.useRef(!1);return W.useEffect(()=>{const u=m=>{m.target&&!o.current&&r8(Hce,r,{originalEvent:m},{discrete:!1})};return t.addEventListener("focusin",u),()=>t.removeEventListener("focusin",u)},[t,r]),{onFocusCapture:()=>o.current=!0,onBlurCapture:()=>o.current=!1}}function f4(){const e=new CustomEvent(iP);document.dispatchEvent(e)}function r8(e,t,r,{discrete:o}){const u=r.originalEvent.target,m=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&u.addEventListener(e,t,{once:!0}),o?pF(u,m):u.dispatchEvent(m)}var Kce="Portal",i8=W.forwardRef((e,t)=>{var b;const{container:r,...o}=e,[u,m]=W.useState(!1);Ii(()=>m(!0),[]);const _=r||u&&((b=globalThis==null?void 0:globalThis.document)==null?void 0:b.body);return _?Dz.createPortal(S.jsx(jn.div,{...o,ref:t}),_):null});i8.displayName=Kce;function Jce(e,t){return W.useReducer((r,o)=>t[r][o]??r,e)}var Qb=e=>{const{present:t,children:r}=e,o=Qce(t),u=typeof r=="function"?r({present:o.isPresent}):W.Children.only(r),m=gr(o.ref,eue(u));return typeof r=="function"||o.isPresent?W.cloneElement(u,{ref:m}):null};Qb.displayName="Presence";function Qce(e){const[t,r]=W.useState(),o=W.useRef({}),u=W.useRef(e),m=W.useRef("none"),_=e?"mounted":"unmounted",[b,s]=Jce(_,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return W.useEffect(()=>{const k=Pv(o.current);m.current=b==="mounted"?k:"none"},[b]),Ii(()=>{const k=o.current,O=u.current;if(O!==e){const q=m.current,H=Pv(k);e?s("MOUNT"):H==="none"||(k==null?void 0:k.display)==="none"?s("UNMOUNT"):s(O&&q!==H?"ANIMATION_OUT":"UNMOUNT"),u.current=e}},[e,s]),Ii(()=>{if(t){let k;const O=t.ownerDocument.defaultView??window,F=H=>{const U=Pv(o.current).includes(H.animationName);if(H.target===t&&U&&(s("ANIMATION_END"),!u.current)){const te=t.style.animationFillMode;t.style.animationFillMode="forwards",k=O.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=te)})}},q=H=>{H.target===t&&(m.current=Pv(o.current))};return t.addEventListener("animationstart",q),t.addEventListener("animationcancel",F),t.addEventListener("animationend",F),()=>{O.clearTimeout(k),t.removeEventListener("animationstart",q),t.removeEventListener("animationcancel",F),t.removeEventListener("animationend",F)}}else s("ANIMATION_END")},[t,s]),{isPresent:["mounted","unmountSuspended"].includes(b),ref:W.useCallback(k=>{k&&(o.current=getComputedStyle(k)),r(k)},[])}}function Pv(e){return(e==null?void 0:e.animationName)||"none"}function eue(e){var o,u;let t=(o=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:o.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(u=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:u.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var cE=0;function tue(){W.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??p4()),document.body.insertAdjacentElement("beforeend",e[1]??p4()),cE++,()=>{cE===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),cE--}},[])}function p4(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var s8=VB(),uE=function(){},ew=W.forwardRef(function(e,t){var r=W.useRef(null),o=W.useState({onScrollCapture:uE,onWheelCapture:uE,onTouchMoveCapture:uE}),u=o[0],m=o[1],_=e.forwardProps,b=e.children,s=e.className,k=e.removeScrollBar,O=e.enabled,F=e.shards,q=e.sideCar,H=e.noIsolation,J=e.inert,U=e.allowPinchZoom,te=e.as,Q=te===void 0?"div":te,ee=e.gapMode,re=pA(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),xe=q,Ee=BB([r,t]),He=_s(_s({},re),u);return W.createElement(W.Fragment,null,O&&W.createElement(xe,{sideCar:s8,removeScrollBar:k,shards:F,noIsolation:H,inert:J,setCallbacks:m,allowPinchZoom:!!U,lockRef:r,gapMode:ee}),_?W.cloneElement(W.Children.only(b),_s(_s({},He),{ref:Ee})):W.createElement(Q,_s({},He,{className:s,ref:Ee}),b))});ew.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};ew.classNames={fullWidth:Qy,zeroRight:Jy};var sP=!1;if(typeof window<"u")try{var Mv=Object.defineProperty({},"passive",{get:function(){return sP=!0,!0}});window.addEventListener("test",Mv,Mv),window.removeEventListener("test",Mv,Mv)}catch{sP=!1}var xp=sP?{passive:!1}:!1,nue=function(e){return e.tagName==="TEXTAREA"},o8=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return r[t]!=="hidden"&&!(r.overflowY===r.overflowX&&!nue(e)&&r[t]==="visible")},rue=function(e){return o8(e,"overflowY")},iue=function(e){return o8(e,"overflowX")},m4=function(e,t){var r=t.ownerDocument,o=t;do{typeof ShadowRoot<"u"&&o instanceof ShadowRoot&&(o=o.host);var u=a8(e,o);if(u){var m=l8(e,o),_=m[1],b=m[2];if(_>b)return!0}o=o.parentNode}while(o&&o!==r.body);return!1},sue=function(e){var t=e.scrollTop,r=e.scrollHeight,o=e.clientHeight;return[t,r,o]},oue=function(e){var t=e.scrollLeft,r=e.scrollWidth,o=e.clientWidth;return[t,r,o]},a8=function(e,t){return e==="v"?rue(t):iue(t)},l8=function(e,t){return e==="v"?sue(t):oue(t)},aue=function(e,t){return e==="h"&&t==="rtl"?-1:1},lue=function(e,t,r,o,u){var m=aue(e,window.getComputedStyle(t).direction),_=m*o,b=r.target,s=t.contains(b),k=!1,O=_>0,F=0,q=0;do{var H=l8(e,b),J=H[0],U=H[1],te=H[2],Q=U-te-m*J;(J||Q)&&a8(e,b)&&(F+=Q,q+=J),b instanceof ShadowRoot?b=b.host:b=b.parentNode}while(!s&&b!==document.body||s&&(t.contains(b)||t===b));return(O&&(Math.abs(F)<1||!u)||!O&&(Math.abs(q)<1||!u))&&(k=!0),k},Av=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},g4=function(e){return[e.deltaX,e.deltaY]},y4=function(e){return e&&"current"in e?e.current:e},cue=function(e,t){return e[0]===t[0]&&e[1]===t[1]},uue=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},due=0,vp=[];function hue(e){var t=W.useRef([]),r=W.useRef([0,0]),o=W.useRef(),u=W.useState(due++)[0],m=W.useState(mA)[0],_=W.useRef(e);W.useEffect(function(){_.current=e},[e]),W.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(u));var U=FB([e.lockRef.current],(e.shards||[]).map(y4),!0).filter(Boolean);return U.forEach(function(te){return te.classList.add("allow-interactivity-".concat(u))}),function(){document.body.classList.remove("block-interactivity-".concat(u)),U.forEach(function(te){return te.classList.remove("allow-interactivity-".concat(u))})}}},[e.inert,e.lockRef.current,e.shards]);var b=W.useCallback(function(U,te){if("touches"in U&&U.touches.length===2||U.type==="wheel"&&U.ctrlKey)return!_.current.allowPinchZoom;var Q=Av(U),ee=r.current,re="deltaX"in U?U.deltaX:ee[0]-Q[0],xe="deltaY"in U?U.deltaY:ee[1]-Q[1],Ee,He=U.target,qe=Math.abs(re)>Math.abs(xe)?"h":"v";if("touches"in U&&qe==="h"&&He.type==="range")return!1;var Ne=m4(qe,He);if(!Ne)return!0;if(Ne?Ee=qe:(Ee=qe==="v"?"h":"v",Ne=m4(qe,He)),!Ne)return!1;if(!o.current&&"changedTouches"in U&&(re||xe)&&(o.current=Ee),!Ee)return!0;var ft=o.current||Ee;return lue(ft,te,U,ft==="h"?re:xe,!0)},[]),s=W.useCallback(function(U){var te=U;if(!(!vp.length||vp[vp.length-1]!==m)){var Q="deltaY"in te?g4(te):Av(te),ee=t.current.filter(function(Ee){return Ee.name===te.type&&(Ee.target===te.target||te.target===Ee.shadowParent)&&cue(Ee.delta,Q)})[0];if(ee&&ee.should){te.cancelable&&te.preventDefault();return}if(!ee){var re=(_.current.shards||[]).map(y4).filter(Boolean).filter(function(Ee){return Ee.contains(te.target)}),xe=re.length>0?b(te,re[0]):!_.current.noIsolation;xe&&te.cancelable&&te.preventDefault()}}},[]),k=W.useCallback(function(U,te,Q,ee){var re={name:U,delta:te,target:Q,should:ee,shadowParent:fue(Q)};t.current.push(re),setTimeout(function(){t.current=t.current.filter(function(xe){return xe!==re})},1)},[]),O=W.useCallback(function(U){r.current=Av(U),o.current=void 0},[]),F=W.useCallback(function(U){k(U.type,g4(U),U.target,b(U,e.lockRef.current))},[]),q=W.useCallback(function(U){k(U.type,Av(U),U.target,b(U,e.lockRef.current))},[]);W.useEffect(function(){return vp.push(m),e.setCallbacks({onScrollCapture:F,onWheelCapture:F,onTouchMoveCapture:q}),document.addEventListener("wheel",s,xp),document.addEventListener("touchmove",s,xp),document.addEventListener("touchstart",O,xp),function(){vp=vp.filter(function(U){return U!==m}),document.removeEventListener("wheel",s,xp),document.removeEventListener("touchmove",s,xp),document.removeEventListener("touchstart",O,xp)}},[]);var H=e.removeScrollBar,J=e.inert;return W.createElement(W.Fragment,null,J?W.createElement(m,{styles:uue(u)}):null,H?W.createElement(WB,{gapMode:e.gapMode}):null)}function fue(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const pue=$B(s8,hue);var c8=W.forwardRef(function(e,t){return W.createElement(ew,_s({},e,{ref:t,sideCar:pue}))});c8.classNames=ew.classNames;var jA="Dialog",[u8,d8]=RA(jA),[mue,Ga]=u8(jA),h8=e=>{const{__scopeDialog:t,children:r,open:o,defaultOpen:u,onOpenChange:m,modal:_=!0}=e,b=W.useRef(null),s=W.useRef(null),[k=!1,O]=hc({prop:o,defaultProp:u,onChange:m});return S.jsx(mue,{scope:t,triggerRef:b,contentRef:s,contentId:To(),titleId:To(),descriptionId:To(),open:k,onOpenChange:O,onOpenToggle:W.useCallback(()=>O(F=>!F),[O]),modal:_,children:r})};h8.displayName=jA;var f8="DialogTrigger",p8=W.forwardRef((e,t)=>{const{__scopeDialog:r,...o}=e,u=Ga(f8,r),m=gr(t,u.triggerRef);return S.jsx(jn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":u.open,"aria-controls":u.contentId,"data-state":BA(u.open),...o,ref:m,onClick:In(e.onClick,u.onOpenToggle)})});p8.displayName=f8;var zA="DialogPortal",[gue,m8]=u8(zA,{forceMount:void 0}),g8=e=>{const{__scopeDialog:t,forceMount:r,children:o,container:u}=e,m=Ga(zA,t);return S.jsx(gue,{scope:t,forceMount:r,children:W.Children.map(o,_=>S.jsx(Qb,{present:r||m.open,children:S.jsx(i8,{asChild:!0,container:u,children:_})}))})};g8.displayName=zA;var X1="DialogOverlay",y8=W.forwardRef((e,t)=>{const r=m8(X1,e.__scopeDialog),{forceMount:o=r.forceMount,...u}=e,m=Ga(X1,e.__scopeDialog);return m.modal?S.jsx(Qb,{present:o||m.open,children:S.jsx(yue,{...u,ref:t})}):null});y8.displayName=X1;var yue=W.forwardRef((e,t)=>{const{__scopeDialog:r,...o}=e,u=Ga(X1,r);return S.jsx(c8,{as:dc,allowPinchZoom:!0,shards:[u.contentRef],children:S.jsx(jn.div,{"data-state":BA(u.open),...o,ref:t,style:{pointerEvents:"auto",...o.style}})})}),Vh="DialogContent",_8=W.forwardRef((e,t)=>{const r=m8(Vh,e.__scopeDialog),{forceMount:o=r.forceMount,...u}=e,m=Ga(Vh,e.__scopeDialog);return S.jsx(Qb,{present:o||m.open,children:m.modal?S.jsx(_ue,{...u,ref:t}):S.jsx(xue,{...u,ref:t})})});_8.displayName=Vh;var _ue=W.forwardRef((e,t)=>{const r=Ga(Vh,e.__scopeDialog),o=W.useRef(null),u=gr(t,r.contentRef,o);return W.useEffect(()=>{const m=o.current;if(m)return zb(m)},[]),S.jsx(x8,{...e,ref:u,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:In(e.onCloseAutoFocus,m=>{var _;m.preventDefault(),(_=r.triggerRef.current)==null||_.focus()}),onPointerDownOutside:In(e.onPointerDownOutside,m=>{const _=m.detail.originalEvent,b=_.button===0&&_.ctrlKey===!0;(_.button===2||b)&&m.preventDefault()}),onFocusOutside:In(e.onFocusOutside,m=>m.preventDefault())})}),xue=W.forwardRef((e,t)=>{const r=Ga(Vh,e.__scopeDialog),o=W.useRef(!1),u=W.useRef(!1);return S.jsx(x8,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:m=>{var _,b;(_=e.onCloseAutoFocus)==null||_.call(e,m),m.defaultPrevented||(o.current||(b=r.triggerRef.current)==null||b.focus(),m.preventDefault()),o.current=!1,u.current=!1},onInteractOutside:m=>{var s,k;(s=e.onInteractOutside)==null||s.call(e,m),m.defaultPrevented||(o.current=!0,m.detail.originalEvent.type==="pointerdown"&&(u.current=!0));const _=m.target;((k=r.triggerRef.current)==null?void 0:k.contains(_))&&m.preventDefault(),m.detail.originalEvent.type==="focusin"&&u.current&&m.preventDefault()}})}),x8=W.forwardRef((e,t)=>{const{__scopeDialog:r,trapFocus:o,onOpenAutoFocus:u,onCloseAutoFocus:m,..._}=e,b=Ga(Vh,r),s=W.useRef(null),k=gr(t,s);return tue(),S.jsxs(S.Fragment,{children:[S.jsx(tx,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:u,onUnmountAutoFocus:m,children:S.jsx(n8,{role:"dialog",id:b.contentId,"aria-describedby":b.descriptionId,"aria-labelledby":b.titleId,"data-state":BA(b.open),..._,ref:k,onDismiss:()=>b.onOpenChange(!1)})}),S.jsxs(S.Fragment,{children:[S.jsx(bue,{titleId:b.titleId}),S.jsx(Sue,{contentRef:s,descriptionId:b.descriptionId})]})]})}),FA="DialogTitle",v8=W.forwardRef((e,t)=>{const{__scopeDialog:r,...o}=e,u=Ga(FA,r);return S.jsx(jn.h2,{id:u.titleId,...o,ref:t})});v8.displayName=FA;var b8="DialogDescription",w8=W.forwardRef((e,t)=>{const{__scopeDialog:r,...o}=e,u=Ga(b8,r);return S.jsx(jn.p,{id:u.descriptionId,...o,ref:t})});w8.displayName=b8;var S8="DialogClose",T8=W.forwardRef((e,t)=>{const{__scopeDialog:r,...o}=e,u=Ga(S8,r);return S.jsx(jn.button,{type:"button",...o,ref:t,onClick:In(e.onClick,()=>u.onOpenChange(!1))})});T8.displayName=S8;function BA(e){return e?"open":"closed"}var E8="DialogTitleWarning",[vue,C8]=Hle(E8,{contentName:Vh,titleName:FA,docsSlug:"dialog"}),bue=({titleId:e})=>{const t=C8(E8),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return W.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},wue="DialogDescriptionWarning",Sue=({contentRef:e,descriptionId:t})=>{const o=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${C8(wue).contentName}}.`;return W.useEffect(()=>{var m;const u=(m=e.current)==null?void 0:m.getAttribute("aria-describedby");t&&u&&(document.getElementById(t)||console.warn(o))},[o,e,t]),null},Tue=h8,Eue=p8,Cue=g8,Pue=y8,Mue=_8,Aue=v8,Iue=w8,P8=T8,M8="AlertDialog",[Due,hde]=RA(M8,[d8]),_c=d8(),A8=e=>{const{__scopeAlertDialog:t,...r}=e,o=_c(t);return S.jsx(Tue,{...o,...r,modal:!0})};A8.displayName=M8;var Rue="AlertDialogTrigger",I8=W.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...o}=e,u=_c(r);return S.jsx(Eue,{...u,...o,ref:t})});I8.displayName=Rue;var kue="AlertDialogPortal",D8=e=>{const{__scopeAlertDialog:t,...r}=e,o=_c(t);return S.jsx(Cue,{...o,...r})};D8.displayName=kue;var Nue="AlertDialogOverlay",R8=W.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...o}=e,u=_c(r);return S.jsx(Pue,{...u,...o,ref:t})});R8.displayName=Nue;var qp="AlertDialogContent",[Lue,Oue]=Due(qp),k8=W.forwardRef((e,t)=>{const{__scopeAlertDialog:r,children:o,...u}=e,m=_c(r),_=W.useRef(null),b=gr(t,_),s=W.useRef(null);return S.jsx(vue,{contentName:qp,titleName:N8,docsSlug:"alert-dialog",children:S.jsx(Lue,{scope:r,cancelRef:s,children:S.jsxs(Mue,{role:"alertdialog",...m,...u,ref:b,onOpenAutoFocus:In(u.onOpenAutoFocus,k=>{var O;k.preventDefault(),(O=s.current)==null||O.focus({preventScroll:!0})}),onPointerDownOutside:k=>k.preventDefault(),onInteractOutside:k=>k.preventDefault(),children:[S.jsx(hF,{children:o}),S.jsx(zue,{contentRef:_})]})})})});k8.displayName=qp;var N8="AlertDialogTitle",L8=W.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...o}=e,u=_c(r);return S.jsx(Aue,{...u,...o,ref:t})});L8.displayName=N8;var O8="AlertDialogDescription",j8=W.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...o}=e,u=_c(r);return S.jsx(Iue,{...u,...o,ref:t})});j8.displayName=O8;var jue="AlertDialogAction",z8=W.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...o}=e,u=_c(r);return S.jsx(P8,{...u,...o,ref:t})});z8.displayName=jue;var F8="AlertDialogCancel",B8=W.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...o}=e,{cancelRef:u}=Oue(F8,r),m=_c(r),_=gr(t,u);return S.jsx(P8,{...m,...o,ref:_})});B8.displayName=F8;var zue=({contentRef:e})=>{const t=`\`${qp}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${qp}\` by passing a \`${O8}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${qp}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return W.useEffect(()=>{var o;document.getElementById((o=e.current)==null?void 0:o.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},Fue=A8,Bue=I8,Vue=D8,V8=R8,U8=k8,$8=z8,G8=B8,W8=L8,H8=j8;const Uh=Fue,$h=Bue,Uue=Vue,q8=W.forwardRef(({className:e,...t},r)=>S.jsx(V8,{className:Zn("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));q8.displayName=V8.displayName;const Yu=W.forwardRef(({className:e,...t},r)=>S.jsxs(Uue,{children:[S.jsx(q8,{}),S.jsx(U8,{ref:r,className:Zn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));Yu.displayName=U8.displayName;const Ku=({className:e,...t})=>S.jsx("div",{className:Zn("flex flex-col space-y-2 text-center sm:text-left",e),...t});Ku.displayName="AlertDialogHeader";const Ju=({className:e,...t})=>S.jsx("div",{className:Zn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Ju.displayName="AlertDialogFooter";const Qu=W.forwardRef(({className:e,...t},r)=>S.jsx(W8,{ref:r,className:Zn("text-lg font-semibold",e),...t}));Qu.displayName=W8.displayName;const ed=W.forwardRef(({className:e,...t},r)=>S.jsx(H8,{ref:r,className:Zn("text-sm text-muted-foreground",e),...t}));ed.displayName=H8.displayName;const td=W.forwardRef(({className:e,...t},r)=>S.jsx($8,{ref:r,className:Zn(R_(),e),...t}));td.displayName=$8.displayName;const nd=W.forwardRef(({className:e,...t},r)=>S.jsx(G8,{ref:r,className:Zn(R_({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));nd.displayName=G8.displayName;const $ue=()=>{const[e,t]=W.useState([]),r=async()=>{await Jt.get("/location?status=PENDING").then(({data:u})=>{t(u==null?void 0:u.locations)}).catch(()=>{Mn("Failed to load data")})},o=async(u,m)=>{const _=new FormData;_.append("status",m),_.append("id",u),_.append("type","APPROVE"),await Jt.post("/location",_).then(()=>{r(),fi(`Location ${m.toLowerCase()} successfully`)}).catch(()=>{Mn("Failed to approve location")})};return W.useEffect(()=>{r()},[]),S.jsxs("div",{className:"w-full",children:[S.jsx(wl,{}),S.jsxs("div",{className:"flex w-full justify-center px-4 py-16 lg:ms-72 lg:w-[calc(100%_-_18rem)]",children:[S.jsx("div",{className:"mt-8 grid max-w-7xl grid-cols-1 gap-4 xl:grid-cols-2",children:e.map((u,m)=>S.jsxs("div",{className:"flex w-full flex-col gap-x-3 rounded-lg border border-gray-300 bg-white p-1 shadow-md sm:flex-row",children:[S.jsx("div",{className:"flex items-center justify-center sm:w-1/2",children:S.jsx("img",{src:"http://localhost:8000/"+(u==null?void 0:u.image)+`?${new Date().getSeconds()}`,alt:"gallery",className:"h-full w-full rounded-lg object-cover"})}),S.jsxs("div",{className:"flex flex-col items-center justify-between p-4 sm:w-1/2",children:[S.jsx("h1",{className:"line-clamp-2 text-lg font-medium",children:u.title}),S.jsxs("p",{className:"line-clamp-2 flex w-full text-start text-sm text-gray-700",children:[S.jsx(Ble,{className:"-ms-1 size-5 text-red-600"}),u.city,", ",u.province," Province"]}),S.jsxs("div",{className:"mb-2 flex w-full items-center justify-between",children:[S.jsxs("p",{className:"text-sm text-gray-700",children:[S.jsx("span",{className:"text-red-600",children:"Latitude : "}),u.latitude]}),S.jsxs("p",{className:"text-sm text-gray-700",children:[S.jsx("span",{className:"text-red-600",children:"Longitude : "}),u.longitude]})]}),S.jsx("p",{className:"line-clamp-4 text-sm text-gray-700",children:u.description}),S.jsxs("div",{className:"mt-4 flex space-x-2",children:[S.jsxs(Uh,{children:[S.jsx($h,{asChild:!0,children:S.jsx(Pn,{size:"sm",className:"w-28 bg-green-500 py-2 text-white",children:"Approve"})}),S.jsxs(Yu,{children:[S.jsxs(Ku,{children:[S.jsx(Qu,{children:"Are you absolutely sure?"}),S.jsx(ed,{children:"This action cannot be undone. This will approve the location. Do you want to continue?"})]}),S.jsxs(Ju,{children:[S.jsx(nd,{children:"Cancel"}),S.jsx(td,{onClick:()=>o(u.id,"APPROVED"),children:"Continue"})]})]})]}),S.jsxs(Uh,{children:[S.jsx($h,{asChild:!0,children:S.jsx(Pn,{size:"sm",className:"w-28 bg-red-500 py-2 text-white",children:"Reject"})}),S.jsxs(Yu,{children:[S.jsxs(Ku,{children:[S.jsx(Qu,{children:"Are you absolutely sure?"}),S.jsx(ed,{children:"This action cannot be undone. This will reject the location. Are you sure you want to continue?"})]}),S.jsxs(Ju,{children:[S.jsx(nd,{children:"Cancel"}),S.jsx(td,{onClick:()=>o(u.id,"REJECTED"),children:"Continue"})]})]})]})]})]})]},m))}),e.length===0&&S.jsx("div",{className:"mt-10 flex w-full items-center justify-center",children:S.jsx("h1",{className:"text-lg font-medium",children:"No location requests"})})]})]})},Gue=()=>{const[e,t]=W.useState([]),r=async()=>{await Jt.get("/guide").then(({data:u})=>{t(u==null?void 0:u.guides)}).catch(()=>{Mn("Failed to load data")})},o=async(u,m)=>{const _=new FormData;_.append("id",u),_.append("type","VERIFY"),await Jt.post("/guide",_).then(()=>{r(),fi(`Guide ${m.toLowerCase()} successfully`)}).catch(()=>{Mn("Failed to approve guide")})};return W.useEffect(()=>{r()},[]),S.jsxs("div",{className:"w-full",children:[S.jsx(wl,{}),S.jsxs("div",{className:"flex w-full justify-center px-4 py-16 lg:ms-72 lg:w-[calc(100%_-_18rem)]",children:[S.jsx("div",{className:"mt-8 grid max-w-7xl grid-cols-1 gap-4 xl:grid-cols-2",children:e==null?void 0:e.map((u,m)=>S.jsxs("div",{className:"flex w-full flex-col gap-x-3 rounded-lg border border-gray-300 bg-white p-4 shadow-md",children:[S.jsx("h1",{className:"line-clamp-2 text-lg font-medium",children:u.name}),S.jsxs("p",{className:"text-sm text-gray-700",children:[S.jsx("span",{className:"font-medium",children:"License: "}),u.license]}),S.jsxs("p",{className:"text-sm text-gray-700",children:[S.jsx("span",{className:"font-medium",children:"Contact: "}),u.contact]}),S.jsxs("p",{className:"text-sm text-gray-700",children:[S.jsx("span",{className:"font-medium",children:"Experience: "}),u.experience]}),S.jsxs("p",{className:"text-sm text-gray-700",children:[S.jsx("span",{className:"font-medium",children:"Charge per day:"}),u.cost]}),S.jsx("p",{className:"mt-2 line-clamp-4 text-sm text-gray-700",children:u.description}),S.jsx("div",{className:"mt-4 flex justify-end space-x-2",children:S.jsxs(Uh,{children:[S.jsx($h,{asChild:!0,children:S.jsx(Pn,{size:"sm",className:"w-28 bg-green-500 py-2 text-white",children:"Approve"})}),S.jsxs(Yu,{children:[S.jsxs(Ku,{children:[S.jsx(Qu,{children:"Are you absolutely sure?"}),S.jsx(ed,{children:"This action cannot be undone. This will approve the guide and make them available for the users."})]}),S.jsxs(Ju,{children:[S.jsx(nd,{children:"Cancel"}),S.jsx(td,{onClick:()=>o(u==null?void 0:u.user,"APPROVED"),children:"Continue"})]})]})]})})]},m))}),(e==null?void 0:e.length)===0&&S.jsx("div",{className:"mt-10 flex w-full items-center justify-center",children:S.jsx("h1",{className:"text-lg font-medium",children:"No location requests"})})]})]})},Wue=()=>{const[e,t]=W.useState([]),r=async()=>{await Jt.get("/travels").then(({data:u})=>{t(u==null?void 0:u.travels)}).catch(()=>{Mn("Failed to fetch trips")})},o=async(u,m)=>{const _=new FormData;_.append("id",u),_.append("status",m),Jt.post("/travels",_).then(()=>{r()}).catch(()=>{Mn("Something went wrong")})};return W.useEffect(()=>{r()},[]),S.jsxs("div",{className:"mt-5 flex w-full flex-col items-center gap-5",children:[e&&(e==null?void 0:e.map((u,m)=>S.jsxs("div",{className:"flex w-full flex-col justify-center rounded-md border border-gray-700/20 bg-white p-4 shadow-sm drop-shadow-lg xl:max-w-5xl",children:[S.jsxs("p",{className:"text-sm text-gray-600",children:["Arrivals on : ",new Date(u==null?void 0:u.arrival).toDateString()]}),S.jsxs("p",{className:"text-sm text-gray-600",children:["Departures on : ",new Date(u==null?void 0:u.departure).toDateString()]}),S.jsxs("p",{className:"text-sm text-gray-600",children:["Budget : ",u==null?void 0:u.budget," LKR"]}),S.jsxs("p",{className:"text-sm text-gray-600",children:["Status : ",u==null?void 0:u.guide_status]}),S.jsxs("p",{className:"mt-2 border-t border-dashed border-gray-500 pt-2 text-sm text-gray-600",children:["Traveler : ",u==null?void 0:u.traveler_name]}),S.jsx("p",{className:"mt-2 border-t border-dashed border-gray-500 pt-2 text-sm font-medium text-gray-600",children:"Accommodations"}),u==null?void 0:u.accommodations.map((_,b)=>S.jsxs("div",{className:"my-1 border-b border-t border-sky-700/50 py-1 text-sm text-gray-600",children:[S.jsxs("p",{children:["Name : ",_==null?void 0:_.name," - ",_==null?void 0:_.category]}),S.jsxs("p",{children:["Price : ",_==null?void 0:_.price," LKR / Day"]}),S.jsxs("p",{children:["Address : ",_==null?void 0:_.address]})]},b)),S.jsx("p",{className:"mt-2 border-t border-dashed border-gray-500 pt-2 text-sm font-medium text-gray-600",children:"Locations"}),u==null?void 0:u.locations.map((_,b)=>S.jsxs("div",{className:"my-1 border-b border-t border-sky-700/50 py-1 text-sm text-gray-600",children:[S.jsxs("p",{children:["Name : ",_==null?void 0:_.title]}),S.jsxs("p",{children:["Category : ",_==null?void 0:_.category]}),S.jsxs("p",{children:["City : ",_==null?void 0:_.city]}),S.jsxs("p",{className:"capitalize",children:["Province : ",_==null?void 0:_.province," Province"]})]},b)),u.guide_status==="PENDING"&&S.jsxs("div",{className:"mt-4 flex space-x-2",children:[S.jsxs(Uh,{children:[S.jsx($h,{asChild:!0,children:S.jsx(Pn,{size:"sm",className:"w-28 bg-green-500 py-2 text-white",children:"Approve"})}),S.jsxs(Yu,{children:[S.jsxs(Ku,{children:[S.jsx(Qu,{children:"Are you absolutely sure?"}),S.jsx(ed,{children:"This action cannot be undone. This will approve the trip and make it available for the users."})]}),S.jsxs(Ju,{children:[S.jsx(nd,{children:"Cancel"}),S.jsx(td,{onClick:()=>o(u.id,"APPROVED"),children:"Continue"})]})]})]}),S.jsxs(Uh,{children:[S.jsx($h,{asChild:!0,children:S.jsx(Pn,{size:"sm",className:"w-28 bg-red-500 py-2 text-white",children:"Reject"})}),S.jsxs(Yu,{children:[S.jsxs(Ku,{children:[S.jsx(Qu,{children:"Are you absolutely sure?"}),S.jsx(ed,{children:"This action cannot be undone. This will reject the trip. Are you sure you want to continue?"})]}),S.jsxs(Ju,{children:[S.jsx(nd,{children:"Cancel"}),S.jsx(td,{onClick:()=>o(u.id,"REJECTED"),children:"Continue"})]})]})]})]})]},m))),(e==null?void 0:e.length)===0&&S.jsx("div",{className:"flex w-full flex-col items-center justify-center rounded-md border border-gray-700/20 bg-white p-4 shadow-sm drop-shadow-lg xl:max-w-5xl",children:S.jsx("p",{className:"text-sm text-gray-600",children:"No trips available"})})]})},Hue=()=>{const{user:e}=qi(o=>o.user),{role:t,guide:r}=e;return(r==null?void 0:r.id)===null||(r==null?void 0:r.is_verified)===0?S.jsx(qy,{to:"/dashboard"}):S.jsxs("div",{className:"w-full",children:[S.jsx(wl,{}),S.jsx("div",{className:"flex w-full justify-center px-4 py-16 lg:ms-72 lg:w-[calc(100%_-_18rem)]",children:ni.Guide===t&&S.jsx(Wue,{})})]})},que=()=>{const[e,t]=W.useState([]),r=async()=>{await Jt.get("/feedbacks").then(({data:o})=>{t(o==null?void 0:o.feedbacks)}).catch(()=>{Mn("Failed to fetch feedbacks")})};return W.useEffect(()=>{r()},[]),S.jsxs("div",{className:"mt-5 flex w-full flex-col items-center gap-5",children:[e&&(e==null?void 0:e.map((o,u)=>S.jsxs("div",{className:"flex w-full flex-col justify-center rounded-md border border-gray-700/20 bg-white p-4 shadow-sm drop-shadow-lg xl:max-w-5xl",children:[S.jsxs("p",{className:"flex w-full justify-between gap-x-2 text-sm text-gray-600",children:[o==null?void 0:o.name,S.jsx("span",{className:"text-xs italic",children:new Date(o==null?void 0:o.created_at).toUTCString()})]}),S.jsx("p",{className:"mt-2 text-sm text-gray-600",children:o==null?void 0:o.feedback})]},u))),(e==null?void 0:e.length)===0&&S.jsx("div",{className:"flex w-full flex-col items-center justify-center rounded-md border border-gray-700/20 bg-white p-4 shadow-sm drop-shadow-lg xl:max-w-5xl",children:S.jsx("p",{className:"text-sm text-gray-600",children:"No feedbacks available"})})]})},Zue=()=>{const[e,t]=W.useState([]),r=async()=>{await Jt.get("/feedbacks").then(({data:o})=>{t(o==null?void 0:o.feedbacks)}).catch(()=>{Mn("Failed to fetch feedbacks")})};return W.useEffect(()=>{r()},[]),S.jsxs("div",{className:"mt-5 flex w-full flex-col items-center gap-5",children:[e&&(e==null?void 0:e.map((o,u)=>S.jsxs("div",{className:"flex w-full flex-col justify-center rounded-md border border-gray-700/20 bg-white p-4 shadow-sm drop-shadow-lg xl:max-w-5xl",children:[S.jsxs("p",{className:"flex w-full justify-between gap-x-2 text-sm text-gray-600",children:[o==null?void 0:o.name,S.jsx("span",{className:"text-xs italic",children:new Date(o==null?void 0:o.created_at).toUTCString()})]}),S.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Ratings : ",o==null?void 0:o.rating]}),S.jsx("p",{className:"text-sm text-gray-600",children:o==null?void 0:o.feedback})]},u))),(e==null?void 0:e.length)===0&&S.jsx("div",{className:"flex w-full flex-col items-center justify-center rounded-md border border-gray-700/20 bg-white p-4 shadow-sm drop-shadow-lg xl:max-w-5xl",children:S.jsx("p",{className:"text-sm text-gray-600",children:"No feedbacks available"})})]})},_4=()=>{const{user:e}=qi(r=>r.user),{role:t}=e;return S.jsxs("div",{className:"w-full",children:[S.jsx(wl,{}),S.jsxs("div",{className:"flex w-full justify-center px-4 py-16 lg:ms-72 lg:w-[calc(100%_-_18rem)]",children:[ni.Admin===t&&S.jsx(que,{}),ni.Guide===t&&S.jsx(Zue,{})]})]})},Xue=()=>{const[e,t]=W.useState([]),r=async()=>{await Jt.get("/accounts").then(({data:u})=>{t(u==null?void 0:u.users)}).catch(()=>{Mn("Failed to fetch users")})},o=async(u,m)=>{const _=new FormData;_.append("id",u),_.append("status",m),await Jt.post("/accounts",_).then(()=>{r()}).catch(()=>{Mn(`Failed to ${m.toLowerCase()} user`)})};return W.useEffect(()=>{r()},[]),S.jsxs("div",{className:"mt-5 flex w-full flex-col items-center gap-2",children:[e&&(e==null?void 0:e.map((u,m)=>S.jsxs("div",{className:"flex w-full flex-col justify-center rounded-md border border-gray-700/20 bg-white p-4 shadow-sm drop-shadow-lg sm:flex-row sm:items-center xl:max-w-5xl",children:[S.jsxs("p",{className:"flex w-full justify-between gap-x-2 text-sm text-gray-600 sm:flex-col",children:[u==null?void 0:u.name,S.jsx("span",{className:"text-xs italic",children:u.role})]}),u.is_active===1&&S.jsxs(Uh,{children:[S.jsx($h,{asChild:!0,children:S.jsx(Pn,{size:"sm",className:"mt-2 w-32 rounded-md bg-red-500 px-2 py-1 text-xs text-white hover:bg-red-600",children:"Deactivate"})}),S.jsxs(Yu,{children:[S.jsxs(Ku,{children:[S.jsx(Qu,{children:"Are you absolutely sure?"}),S.jsx(ed,{children:"This will deactivate the user account. Are you sure you want to continue?"})]}),S.jsxs(Ju,{children:[S.jsx(nd,{children:"Cancel"}),S.jsx(td,{onClick:()=>o(u.id,"DEACTIVATE"),children:"Continue"})]})]})]}),u.is_active===0&&S.jsxs(Uh,{children:[S.jsx($h,{asChild:!0,children:S.jsx(Pn,{size:"sm",className:"mt-2 w-32 rounded-md bg-green-500 px-2 py-1 text-xs text-white hover:bg-green-600",children:"Activate"})}),S.jsxs(Yu,{children:[S.jsxs(Ku,{children:[S.jsx(Qu,{children:"Are you absolutely sure?"}),S.jsx(ed,{children:"This will activate the user account. Are you sure you want to continue?"})]}),S.jsxs(Ju,{children:[S.jsx(nd,{children:"Cancel"}),S.jsx(td,{onClick:()=>o(u.id,"ACTIVATE"),children:"Continue"})]})]})]})]},m))),(e==null?void 0:e.length)===0&&S.jsx("div",{className:"flex w-full flex-col items-center justify-center rounded-md border border-gray-700/20 bg-white p-4 shadow-sm drop-shadow-lg xl:max-w-5xl",children:S.jsx("p",{className:"text-sm text-gray-600",children:"No users available"})})]})},Yue=()=>{const{user:e}=qi(r=>r.user),{role:t}=e;return S.jsxs("div",{className:"w-full",children:[S.jsx(wl,{}),S.jsx("div",{className:"flex w-full justify-center px-4 py-16 lg:ms-72 lg:w-[calc(100%_-_18rem)]",children:ni.Admin===t&&S.jsx(Xue,{})})]})},Kue=()=>{const[e,t]=W.useState(""),[r,o]=W.useState(!1),[u,m]=W.useState([]),_=async()=>{await Jt.get("/event").then(({data:b})=>{m(b==null?void 0:b.events)}).catch(()=>{Mn("Failed to load data")})};return W.useEffect(()=>{(async()=>{await Jt.get(`/event?search=${e}`).then(({data:s})=>{m(s==null?void 0:s.events)}).catch(()=>{Mn("Failed to load data")})})()},[e]),W.useEffect(()=>{_()},[]),S.jsxs("div",{className:"flex w-full flex-col items-center gap-5",children:[S.jsx(Jue,{isOpen:r,setIsOpen:o,loadData:_}),S.jsxs("section",{className:"container mx-auto mt-10 px-4 py-8",children:[S.jsxs("div",{className:"mb-5 flex flex-col items-center justify-center gap-2 sm:flex-row",children:[S.jsx(bn,{placeholder:"Search events...",className:"max-w-lg border-sky-600/80 !outline-0 !ring-0",value:e,onChange:b=>t(b.target.value)}),S.jsxs(Pn,{onClick:()=>o(!0),className:"w-full max-w-[10rem] bg-sky-600 hover:bg-sky-700",children:[S.jsx(Va,{className:"size-5"}),"Add Event"]})]}),S.jsx("div",{className:"flex w-full justify-center pt-2",children:S.jsx(ede,{items:u,loadData:_})})]})]})},Jue=({isOpen:e,setIsOpen:t,loadData:r})=>{const o={title:"",start:new Date,end:new Date,city:"",province:no[0].value,category:e_[0].value,description:"",image:null},u={title:"",city:"",start:"",end:"",province:"",category:"",description:"",image:""},[m,_]=W.useState(o),[b,s]=W.useState(u),[k,O]=W.useState(!1),F=H=>(Object.keys(H).forEach(U=>{if(!H[U])return s(te=>({...te,[U]:`${U} is required`})),!1}),H.description.length>500?(s(U=>({...U,description:"Description length must be less than 500 characters"})),!1):H.image&&H.image.size>1024*1024*2?(s(U=>({...U,image:"Image size must be less than 2MB"})),!1):!0),q=async H=>{if(H.preventDefault(),!F(m))return;O(!0),s(u);const J=new FormData;Object.keys(m).forEach(U=>J.append(U,m[U])),J.set("start",`${m.start.getFullYear()}-${m.start.getMonth()+1}-${m.start.getDate()}`),J.set("end",`${m.end.getFullYear()}-${m.end.getMonth()+1}-${m.end.getDate()}`),await Jt.post("/event",J).then(({data:U})=>{fi(U.message),_(o),r(),t(!1)}).catch(U=>{const te=U.response.data;if(U.response.status===500)return Mn(te.message);s(Q=>({...Q,[te==null?void 0:te.property]:te.message}))}).finally(()=>{O(!1)})};return S.jsx($a,{open:e,onOpenChange:t,children:S.jsxs(sa,{className:"max-w-2xl overflow-y-auto max-h-[90vh]",children:[S.jsxs(oa,{children:[S.jsx(aa,{children:"Add New Events"}),S.jsx(la,{className:"text-xs font-medium",children:"Add new events to the system."})]}),S.jsxs("form",{onSubmit:q,className:"flex w-full flex-col items-center justify-center",children:[S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"title",children:"Title"}),S.jsx(bn,{id:"title",name:"title",type:"text",maxLength:"256",placeholder:"Galle fort",value:m.title,onChange:H=>_(J=>({...J,title:H.target.value})),className:"w-full border-gray-400/80 p-2"}),b.title&&S.jsx("p",{className:"text-sm text-red-500",children:b.title})]}),S.jsxs("div",{className:"mb-2 w-full",children:[S.jsx(jt,{htmlFor:"start",children:"Start Date"}),S.jsxs(lm,{children:[S.jsx(cm,{asChild:!0,children:S.jsxs(Pn,{variant:"outline",className:Zn("w-full justify-start border-gray-400/80 text-left font-normal hover:bg-white",!m.start&&"text-muted-foreground"),children:[S.jsx(gl,{className:"mr-2 h-4 w-4"}),m.start?Ei(m.start,"PPP"):S.jsx("span",{children:"Pick a date"})]})}),S.jsx(jh,{className:"w-auto p-0",align:"start",children:S.jsx(Lh,{mode:"single",selected:m.start,onSelect:H=>_(J=>({...J,start:H})),initialFocus:!0,disabled:H=>H<new Date(new Date().setHours(0,0,0,0))})})]}),b.start&&S.jsx("p",{className:"text-sm text-red-500",children:b.start})]}),S.jsxs("div",{className:"mb-2 w-full",children:[S.jsx(jt,{htmlFor:"end",children:"End Date"}),S.jsxs(lm,{children:[S.jsx(cm,{asChild:!0,children:S.jsxs(Pn,{variant:"outline",className:Zn("w-full justify-start border-gray-400/80 text-left font-normal hover:bg-white",!m.end&&"text-muted-foreground"),children:[S.jsx(gl,{className:"mr-2 h-4 w-4"}),m.end?Ei(m.end,"PPP"):S.jsx("span",{children:"Pick a date"})]})}),S.jsx(jh,{className:"w-auto p-0",align:"start",children:S.jsx(Lh,{mode:"single",selected:m.end,onSelect:H=>_(J=>({...J,end:H})),initialFocus:!0,disabled:H=>H<new Date(new Date().setHours(0,0,0,0))})})]}),b.end&&S.jsx("p",{className:"text-sm text-red-500",children:b.end})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"city",children:"Near City"}),S.jsx(bn,{id:"city",name:"city",type:"text",maxLength:"50",placeholder:"Galle",value:m.city,onChange:H=>_(J=>({...J,city:H.target.value})),className:"w-full border-gray-400/80 p-2"}),b.city&&S.jsx("p",{className:"text-sm text-red-500",children:b.city})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"province",children:"Province"}),S.jsxs(Ci,{defaultValue:no[0].value,onValueChange:H=>_(J=>({...J,province:H})),children:[S.jsx(_i,{className:"w-full border-gray-400/80",children:S.jsx(Mi,{placeholder:"Select a province"})}),S.jsx(xi,{children:S.jsx(Pi,{children:no.map(H=>S.jsx(ii,{value:H.value,children:H.label},H.value))})})]}),b.province&&S.jsx("p",{className:"text-sm text-red-500",children:b.province})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"category",children:"Category"}),S.jsxs(Ci,{defaultValue:e_[0].value,onValueChange:H=>_(J=>({...J,category:H})),children:[S.jsx(_i,{className:"w-full border-gray-400/80 capitalize",children:S.jsx(Mi,{placeholder:"Select a category"})}),S.jsx(xi,{children:S.jsx(Pi,{children:e_.map(H=>S.jsx(ii,{value:H.value,children:H.label},H.value))})})]}),b.category&&S.jsx("p",{className:"text-sm text-red-500",children:b.category})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"description",children:"Description"}),S.jsx(ca,{id:"description",name:"description",rows:"5",maxLength:"500",placeholder:"Galle fort is a historical fort...",value:m.description,onChange:H=>_(J=>({...J,description:H.target.value})),className:"w-full border-gray-400/80 p-2"}),b.description&&S.jsx("p",{className:"text-sm text-red-500",children:b.description})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"event-image",children:"Event Image"}),!m.image&&S.jsxs("label",{htmlFor:"event-image",children:[S.jsx("input",{type:"file",id:"event-image",className:"peer sr-only",accept:"image/*",onChange:H=>{const J=H.target.files[0];_(U=>({...U,image:J}))}}),S.jsx("div",{className:"mt-2 flex h-28 w-28 cursor-pointer items-center justify-center rounded-sm bg-gray-400 p-2 text-white",children:S.jsx(Va,{className:"size-10"})})]}),m.image&&S.jsxs("div",{className:"relative mt-2 h-28 w-28",children:[S.jsx(Zh,{className:"absolute end-1 top-1 size-5 cursor-pointer rounded-full bg-black p-1 text-white",onClick:()=>_(H=>({...H,image:null}))}),S.jsx("img",{src:URL.createObjectURL(m.image),alt:"event",className:"h-28 w-28 rounded-md border border-gray-400/80 object-cover"})]}),b.image&&S.jsx("p",{className:"text-sm text-red-500",children:b.image})]})]}),S.jsx(bl,{children:S.jsx(Pn,{type:"submit",onClick:q,disabled:k,className:"mt-4 w-full max-w-[10rem] rounded-md bg-sky-700 px-4 py-2 text-white",children:k?"Loading...":"Add Event"})})]})})},Que=({id:e,item:t,isOpen:r,setIsOpen:o,loadData:u})=>{const m={title:(t==null?void 0:t.title)||"",city:(t==null?void 0:t.city)||"",start:new Date((t==null?void 0:t.start)||new Date),end:new Date((t==null?void 0:t.end)||new Date),province:(t==null?void 0:t.province)||"",category:(t==null?void 0:t.category)||"",description:(t==null?void 0:t.description)||"",image:(t==null?void 0:t.image)||""},_={title:"",city:"",start:"",end:"",province:"",category:"",description:"",image:""},[b,s]=W.useState(m),[k,O]=W.useState(_),[F,q]=W.useState(!1),H=U=>(Object.keys(U).forEach(Q=>{if(!U[Q])return O(ee=>({...ee,[Q]:`${Q} is required`})),!1}),U.description.length>500?(O(Q=>({...Q,description:"Description length must be less than 500 characters"})),!1):typeof U.image!="string"&&U.image&&U.image.size>1024*1024*2?(O(Q=>({...Q,image:"Image size must be less than 2MB"})),!1):!0),J=async U=>{if(U.preventDefault(),!H(b))return;q(!0),O(_);const te=new FormData;Object.keys(b).forEach(Q=>te.append(Q,b[Q])),te.append("type","UPDATE"),te.append("id",e),te.set("start",`${b.start.getFullYear()}-${b.start.getMonth()+1}-${b.start.getDate()}`),te.set("end",`${b.end.getFullYear()}-${b.end.getMonth()+1}-${b.end.getDate()}`),await Jt.post("/event",te).then(({data:Q})=>{fi(Q.message),s(m),u(),o(!1)}).catch(Q=>{const ee=Q.response.data;if(Q.response.status===500)return Mn(ee.message);O(re=>({...re,[ee==null?void 0:ee.property]:ee.message}))}).finally(()=>{q(!1)})};return W.useEffect(()=>{t&&s({title:t==null?void 0:t.title,city:t==null?void 0:t.city,province:t==null?void 0:t.province,category:t==null?void 0:t.category,start:new Date(t==null?void 0:t.start),end:new Date(t==null?void 0:t.end),description:t==null?void 0:t.description,image:t==null?void 0:t.image})},[t]),S.jsx($a,{open:r,onOpenChange:o,children:S.jsxs(sa,{className:"max-w-2xl overflow-y-auto max-h-[90vh]",children:[S.jsxs(oa,{children:[S.jsx(aa,{children:"Update Event"}),S.jsx(la,{className:"text-xs font-medium",children:"Update event details."})]}),S.jsxs("form",{onSubmit:J,className:"flex w-full flex-col items-center justify-center",children:[S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"title",children:"Title"}),S.jsx(bn,{id:"title",name:"title",type:"text",maxLength:"256",placeholder:"Galle fort",value:b.title,onChange:U=>s(te=>({...te,title:U.target.value})),className:"w-full border-gray-400/80 p-2"}),k.title&&S.jsx("p",{className:"text-sm text-red-500",children:k.title})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"city",children:"Near City"}),S.jsx(bn,{id:"city",name:"city",type:"text",maxLength:"50",placeholder:"Galle",value:b.city,onChange:U=>s(te=>({...te,city:U.target.value})),className:"w-full border-gray-400/80 p-2"}),k.city&&S.jsx("p",{className:"text-sm text-red-500",children:k.city})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"city",children:"Near City"}),S.jsxs(Ci,{value:b.province,onValueChange:U=>s(te=>({...te,province:U})),children:[S.jsx(_i,{className:"w-full border-gray-400/80",children:S.jsx(Mi,{placeholder:"Select a province"})}),S.jsx(xi,{children:S.jsx(Pi,{children:no.map(U=>S.jsx(ii,{value:U.value,children:U.label},U.value))})})]}),k.province&&S.jsx("p",{className:"text-sm text-red-500",children:k.province})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"category",children:"Category"}),S.jsxs(Ci,{value:b.category,onValueChange:U=>s(te=>({...te,category:U})),children:[S.jsx(_i,{className:"w-full border-gray-400/80 capitalize",children:S.jsx(Mi,{placeholder:"Select a category"})}),S.jsx(xi,{children:S.jsx(Pi,{children:e_.map(U=>S.jsx(ii,{value:U.value,children:U.label},U.value))})})]}),k.category&&S.jsx("p",{className:"text-sm text-red-500",children:k.category})]}),S.jsxs("div",{className:"mb-2 w-full",children:[S.jsx(jt,{htmlFor:"start",children:"Start Date"}),S.jsxs(lm,{children:[S.jsx(cm,{asChild:!0,children:S.jsxs(Pn,{variant:"outline",className:Zn("w-full justify-start border-gray-400/80 text-left font-normal hover:bg-white",!(b!=null&&b.start)&&"text-muted-foreground"),children:[S.jsx(gl,{className:"mr-2 h-4 w-4"}),b!=null&&b.start?Ei(b==null?void 0:b.start,"PPP"):S.jsx("span",{children:"Pick a date"})]})}),S.jsx(jh,{className:"w-auto p-0",align:"start",children:S.jsx(Lh,{mode:"single",selected:b.start,onSelect:U=>s(te=>({...te,start:U})),initialFocus:!0,disabled:U=>U<new Date(new Date().setHours(0,0,0,0))})})]}),k.start&&S.jsx("p",{className:"text-sm text-red-500",children:k.start})]}),S.jsxs("div",{className:"mb-2 w-full",children:[S.jsx(jt,{htmlFor:"end",children:"End Date"}),S.jsxs(lm,{children:[S.jsx(cm,{asChild:!0,children:S.jsxs(Pn,{variant:"outline",className:Zn("w-full justify-start border-gray-400/80 text-left font-normal hover:bg-white",!(b!=null&&b.end)&&"text-muted-foreground"),children:[S.jsx(gl,{className:"mr-2 h-4 w-4"}),b!=null&&b.end?Ei(b==null?void 0:b.end,"PPP"):S.jsx("span",{children:"Pick a date"})]})}),S.jsx(jh,{className:"w-auto p-0",align:"start",children:S.jsx(Lh,{mode:"single",selected:b.end,onSelect:U=>s(te=>({...te,end:U})),initialFocus:!0,disabled:U=>U<new Date(new Date().setHours(0,0,0,0))})})]}),k.end&&S.jsx("p",{className:"text-sm text-red-500",children:k.end})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"description",children:"Description"}),S.jsx(ca,{id:"description",name:"description",rows:"5",maxLength:"500",placeholder:"Galle fort is a historical fort...",value:b.description,onChange:U=>s(te=>({...te,description:U.target.value})),className:"w-full border-gray-400/80 p-2"}),k.description&&S.jsx("p",{className:"text-sm text-red-500",children:k.description})]}),S.jsxs("div",{className:"mt-2 w-full",children:[S.jsx(jt,{htmlFor:"event-image",children:"Event Image"}),!b.image&&S.jsxs("label",{htmlFor:"event-image",children:[S.jsx("input",{type:"file",id:"event-image",className:"peer sr-only",accept:"image/*",onChange:U=>{const te=U.target.files[0];s(Q=>({...Q,image:te}))}}),S.jsx("div",{className:"mt-2 flex h-28 w-28 cursor-pointer items-center justify-center rounded-sm bg-gray-400 p-2 text-white",children:S.jsx(Va,{className:"size-10"})})]}),b.image&&S.jsxs("div",{className:"relative mt-2 h-28 w-28",children:[S.jsx(Zh,{className:"absolute end-1 top-1 size-5 cursor-pointer rounded-full bg-black p-1 text-white",onClick:()=>s(U=>({...U,image:null}))}),S.jsx("img",{src:typeof b.image=="string"?"http://localhost:8000/"+(t==null?void 0:t.image)+`?${new Date().getSeconds()}`:URL.createObjectURL(b.image),alt:"event",className:"h-28 w-28 rounded-md border border-gray-400/80 object-cover"})]}),k.image&&S.jsx("p",{className:"text-sm text-red-500",children:k.image})]})]}),S.jsx(bl,{children:S.jsx(Pn,{type:"submit",onClick:J,disabled:F,className:"mt-4 w-full max-w-[10rem] rounded-md bg-sky-700 px-4 py-2 text-white",children:F?"Loading...":"Update Event"})})]})})},ede=({items:e,loadData:t})=>{const[r,o]=W.useState(!1),[u,m]=W.useState(null);return e!=null&&e.length?S.jsxs("div",{className:"mt-4 grid w-full grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[S.jsx(Que,{isOpen:r,setIsOpen:o,item:u,id:u==null?void 0:u.id,loadData:t}),e==null?void 0:e.map(_=>S.jsxs("div",{className:"w-full max-w-md rounded-lg bg-white shadow-md drop-shadow-xl",children:[S.jsx("img",{src:"http://localhost:8000/"+(_==null?void 0:_.image)+`?${new Date().getSeconds()}`,alt:"gallery",className:"h-48 w-full rounded-lg object-cover"}),S.jsx("div",{onClick:()=>{m(_),o(!0)},className:"absolute right-2 top-1 h-8 w-8 cursor-pointer rounded-full bg-white p-2 text-sky-700",children:S.jsx(j_,{})}),S.jsxs("div",{className:"p-4",children:[S.jsxs("h2",{className:"mb-2 line-clamp-2 font-medium",children:[_.title,S.jsx("span",{className:"flex w-fit rounded bg-fuchsia-700 px-2 py-0.5 text-xs text-white",children:_.category})]}),S.jsxs("p",{className:"flex items-end gap-x-1 text-xs text-gray-600",children:[S.jsx(uc,{className:"-ms-1 size-5 text-red-600"}),_.city," , ",_.province," Province"]}),S.jsxs("p",{className:"mt-1 flex items-end gap-x-1 text-xs text-gray-600",children:[S.jsx(gl,{className:"size-4 text-red-600"}),Ei(new Date(_==null?void 0:_.start),"PPP")," -"," ",Ei(new Date(_==null?void 0:_.end),"PPP")]}),S.jsx("div",{className:"flex justify-center",children:S.jsxs($a,{children:[S.jsx(hV,{children:S.jsx(Pn,{className:"mt-5 border-sky-800 duration-300 hover:bg-sky-800 hover:text-white",variant:"outline",size:"sm",children:"More Details"})}),S.jsxs(sa,{children:[S.jsxs(oa,{children:[S.jsxs(aa,{children:[_.title,S.jsx("span",{className:"ms-2 rounded bg-fuchsia-700 px-2 py-0.5 text-xs text-white",children:_.category})]}),S.jsx(la,{children:"More details about the event and the location."})]}),S.jsxs("div",{className:"",children:[S.jsx("img",{src:"http://localhost:8000/"+(_==null?void 0:_.image)+`?${new Date().getSeconds()}`,alt:"gallery",className:"my-3 h-48 w-full rounded-lg object-cover"}),S.jsxs("p",{className:"flex items-end gap-x-1 text-xs text-gray-600",children:[S.jsx(uc,{className:"-ms-1 size-5 text-red-600"}),_.city," , ",_.province," Province"]}),S.jsxs("p",{className:"mt-1 flex items-end gap-x-1 text-xs text-gray-600",children:[S.jsx(gl,{className:"size-4 text-red-600"}),Ei(new Date(_.start),"PPP")," -"," ",Ei(new Date(_.end),"PPP")]}),S.jsx("p",{className:"mt-2 line-clamp-4 text-sm text-gray-700",children:_.description})]})]})]})})]})]},_.id))]}):S.jsx("div",{className:"flex w-full items-center justify-center pt-5",children:S.jsx("h1",{className:"text-gray-600",children:"No events found"})})},tde=()=>{const{user:e}=qi(r=>r.user),{role:t}=e;return S.jsxs("div",{className:"w-full",children:[S.jsx(wl,{}),S.jsx("div",{className:"flex w-full justify-center px-4 py-16 lg:ms-72 lg:w-[calc(100%_-_18rem)]",children:ni.Admin===t&&S.jsx(Kue,{})})]})};function nde(){return Jt.defaults.baseURL="http://localhost:8000/",Jt.defaults.withCredentials=!0,S.jsxs("main",{children:[S.jsx(aoe,{}),S.jsx(mH,{children:S.jsxs(aH,{children:[S.jsx(vr,{path:"/",element:S.jsx(AJ,{})}),S.jsx(vr,{path:"/login",element:S.jsx(poe,{})}),S.jsx(vr,{path:"/sign-up",element:S.jsx(moe,{})}),S.jsx(vr,{path:"/verification",element:S.jsx(ace,{})}),S.jsx(vr,{path:"/forgot-password",element:S.jsx(uce,{})}),S.jsx(vr,{path:"/reset-password",element:S.jsx(dce,{})}),S.jsx(vr,{path:"/gallery",element:S.jsx(GQ,{})}),S.jsx(vr,{path:"/events",element:S.jsx(loe,{})}),S.jsx(vr,{path:"/about-us",element:S.jsx(uoe,{})}),S.jsx(vr,{path:"/contact-us",element:S.jsx(foe,{})}),S.jsx(vr,{path:"/currency",element:S.jsx(goe,{})}),S.jsx(vr,{element:S.jsx(vy,{allowedRoles:[ni.Traveler,ni.Guide,ni.Accommodations,ni.Admin]}),children:S.jsxs(vr,{path:"/dashboard",element:S.jsx(Uv,{}),children:[S.jsx(vr,{index:!0,element:S.jsx(kce,{})}),S.jsx(vr,{path:"settings",element:S.jsx(Nce,{})})]})}),S.jsx(vr,{element:S.jsx(vy,{allowedRoles:[ni.Traveler]}),children:S.jsx(vr,{path:"get-start",element:S.jsx(sce,{})})}),S.jsx(vr,{element:S.jsx(vy,{allowedRoles:[ni.Accommodations]})}),S.jsx(vr,{element:S.jsx(vy,{allowedRoles:[ni.Guide]}),children:S.jsxs(vr,{path:"/dashboard",element:S.jsx(Uv,{}),children:[S.jsx(vr,{path:"request-locations",element:S.jsx($ce,{})}),S.jsx(vr,{path:"guide-requests",element:S.jsx(Hue,{})}),S.jsx(vr,{path:"received-feedback",element:S.jsx(_4,{})})]})}),S.jsx(vr,{element:S.jsx(vy,{allowedRoles:[ni.Admin]}),children:S.jsxs(vr,{path:"/dashboard",element:S.jsx(Uv,{}),children:[S.jsx(vr,{path:"locations",element:S.jsx(Fce,{})}),S.jsx(vr,{path:"location-requests",element:S.jsx($ue,{})}),S.jsx(vr,{path:"guide-approval",element:S.jsx(Gue,{})}),S.jsx(vr,{path:"system-feedback",element:S.jsx(_4,{})}),S.jsx(vr,{path:"accounts",element:S.jsx(Yue,{})}),S.jsx(vr,{path:"events",element:S.jsx(tde,{})})]})}),S.jsx(vr,{path:"*",element:S.jsx(IJ,{})})]})}),S.jsx(oce,{})]})}Rz(document.getElementById("root")).render(S.jsx(W.StrictMode,{children:S.jsx(v9,{store:yW,children:S.jsx(nde,{})})}));
